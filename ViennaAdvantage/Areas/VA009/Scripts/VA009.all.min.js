/*Version 1.0.33.0*/VA009=window.VA009||{},function(n,t){n.PaymentForm=function(){function of(){sf();hf();cf();et.loadOrg();et.loadPaymentMethods();et.loadStatus();bf();y=1;au(li,ai,y,hr,oi,ki,yt,di,yi.val(),99,si,rr.val(),ur.val(),vu);pu=!0;a.on("click",cu);sr.autocomplete({minLength:0,source:function(n,t){n.term.trim().length!=0&&yf(n.term,t,"GetBPName")},select:function(n,i){vt.indexOf(i.item.ids)==-1&&(fi.find("li").length>0?(fi.append("<ul><li id=VA009_li_"+i.item.ids+'><img src="Areas/VA009/Images/cross.png" alt="'+VIS.Msg.getMsg("VA009_Cancel")+'" title="'+VIS.Msg.getMsg("VA009_Cancel")+'" class="VA009-cross-btn" id=VA009_Delimg_'+i.item.ids+"> <span>"+i.item.value+"<\/span><\/li>"),vt.push(i.item.ids),ft("cb.C_BPartner_ID",vt)):(fi.append("<ul><li id=VA009_li_"+i.item.ids+'><img src="Areas/VA009/Images/cross.png" alt="'+VIS.Msg.getMsg("VA009_Cancel")+'" title="'+VIS.Msg.getMsg("VA009_Cancel")+'" class="VA009-cross-btn" id=VA009_Delimg_'+i.item.ids+"> <span>"+i.item.value+"<\/span><\/li>"),vt.push(i.item.ids),ft("cb.C_BPartner_ID",vt)),t(this).val(""),a.find(".VA009-payment-wrap").remove(),f.find(".VA009-right-data-main").remove(),f.find(".VA009-accordion").remove(),y=1,w())}})}function sf(){ot='<div class="VA009-main-container" id="VA009-main-container_'+u.windowNo+'"> <table id="VA009_table_'+u.windowNo+'" style="width: 100%;"><tr><td id="VA009_tdLeft_'+u.windowNo+'" style="width: 200px; position: relative;"> <div class="VA009-left-part" id=VA009_leftpart_'+u.windowNo+">";_btnToggle="<div class='VA009-left-title' ><img src='"+VIS.Application.contextUrl+"Areas/VA009/Images/lines.png' class='VA009-toggle-btn' alt='lines' id='VA009_toggleImg_"+u.windowNo+"' ><\/div>";ot+=_btnToggle;ot+='<div class="VA009-left-part" style="overflow:auto;" id=VA009_leftpartdata_'+u.windowNo+">";ot+='<div class="VA009-left-data"> <label>'+VIS.Msg.getMsg("VA009_Org")+"<\/label> <select id = VA009_Org_"+u.windowNo+'> <\/select>  <div class="VA009-value-list" id= VA009_OrgdataDiv_'+u.windowNo+"> <\/div> <\/div>";ot+='<div class="VA009-left-data"> <label>'+VIS.Msg.getMsg("VA009_BPartner")+'<\/label> <input type="text" id = VA009_BPartner_'+u.windowNo+'> <div class="VA009-value-list" id= VA009_BPdataDiv_'+u.windowNo+">      <\/div> <\/div>";ot+='<div class="VA009-left-data"> <label>'+VIS.Msg.getMsg("VA009_PayMthd")+"<\/label> <select id = VA009_PayMthd_"+u.windowNo+'>   <\/select>  <div class="VA009-value-list" id= VA009_PayMthddataDiv_'+u.windowNo+">      <\/div> <\/div>";ot+='<div class="VA009-left-data"> <label>'+VIS.Msg.getMsg("VA009_Status")+"<\/label> <select id = VA009_Status_"+u.windowNo+'>  <\/select>  <div class="VA009-value-list" id= VA009_StatusdataDiv_'+u.windowNo+">      <\/div> <\/div>";ot+='<div class="VA009-left-data"> <label>'+VIS.Msg.getMsg("VA009_Duedate")+"<\/label> <select id = VA009_DueDate_"+u.windowNo+'><option value=""><\/option> <option  value=0>'+VIS.Msg.getMsg("VA009_Current")+"<\/option>  <option value=7>"+VIS.Msg.getMsg("VA009_7Days")+"<\/option>  <option value=14 >"+VIS.Msg.getMsg("VA009_14Days")+"<\/option> <option value=30 >"+VIS.Msg.getMsg("VA009_30Days")+"<\/option> <option value=60 >"+VIS.Msg.getMsg("VA009_60Days")+"<\/option> <option value=90>"+VIS.Msg.getMsg("VA009_90Days")+'<\/option>" <\/select>  <div class="VA009-value-list" id= VA009_DueDatedataDiv_'+u.windowNo+"> <\/div>  <\/div> ";ot+='<div class="VA009-left-data"> <label>'+VIS.Msg.getMsg("VA009_TransactionType")+"<\/label> <select id = VA009_TransactionType_"+u.windowNo+'><option value=""><\/option> <option  value=0>'+VIS.Msg.getMsg("VA009_Order")+"<\/option>  <option value=1>"+VIS.Msg.getMsg("VA009_Invoice")+'<\/option>" <\/select>  <div class="VA009-value-list" id= VA009_TransactionTypeDiv_'+u.windowNo+"> <\/div>  <\/div>";ot+='<div class="VA009-left-data"> <label>'+VIS.Msg.getMsg("VA009_FromDate")+'<\/label> <input type="date" id="VA009_FromDate_'+u.windowNo+'"> <\/div>';ot+='<div class="VA009-left-data"> <label>'+VIS.Msg.getMsg("VA009_ToDate")+'<\/label> <input type="date" id="VA009_ToDate_'+u.windowNo+'"> <\/div> <\/div><\/div><\/td>';d=ot;d+='<td><div class="VA009-content-area" id="VA009-content-area_'+u.windowNo+'">';ci='<div class="VA009-middle-wrap" id="VA009-middle-wrap_'+u.windowNo+'">';ci+='<div class="VA009-mid-top-wrap" id="VA009-mid-top-wrap_'+u.windowNo+'"> ';ci+='<div class="VA009-tabs-wrap"> <ul class="VA009-tabs"> <li class="VA009-active-tab" id = VA009_CR_Tab_'+u.windowNo+">"+VIS.Msg.getMsg("VA009_CR_Tab")+"<\/li> <li  id = VA009_CP_Tab_"+u.windowNo+">"+VIS.Msg.getMsg("VA009_CP_Tab")+'<\/li><li style="display:none;" id = VA009_XML_Tab_'+u.windowNo+">"+VIS.Msg.getMsg("VA009_GenXML_Tab")+"<\/li><\/ul><\/div>";ci+='<div class="VA009-icons-wrap">';ci+="<span><img src='"+VIS.Application.contextUrl+"Areas/VA009/Images/cheque.png' alt='"+VIS.Msg.getMsg("VA009_Check")+"' title='"+VIS.Msg.getMsg("VA009_Check")+"' id='VA009_Chkimg_"+u.windowNo+"' ><\/span> <span><img src='"+VIS.Application.contextUrl+"Areas/VA009/Images/cash.png' alt='"+VIS.Msg.getMsg("VA009_Cash")+"' title='"+VIS.Msg.getMsg("VA009_Cash")+"'  id='VA009_Cashimg_"+u.windowNo+"' ><\/span><span><img src='"+VIS.Application.contextUrl+"Areas/VA009/Images/batch.png' alt='"+VIS.Msg.getMsg("VA009_Batch")+"' title='"+VIS.Msg.getMsg("VA009_Batch")+"' id='VA009_Batchimg_"+u.windowNo+"' ><\/span><span><img src='"+VIS.Application.contextUrl+"Areas/VA009/Images/split.png' alt='"+VIS.Msg.getMsg("VA009_Split")+"' title='"+VIS.Msg.getMsg("VA009_Split")+"'  id='VA009_Splitimg_"+u.windowNo+"'><\/span><span><img src='"+VIS.Application.contextUrl+"Areas/VA009/Images/generatepay.png' alt='"+VIS.Msg.getMsg("VA009_PayMannual")+"' title='"+VIS.Msg.getMsg("VA009_PayMannual")+"'  id='VA009_PayMannualimg_"+u.windowNo+"'><\/span><span><img src='"+VIS.Application.contextUrl+"Areas/VA009/Images/b2b.png' alt='"+VIS.Msg.getMsg("VA009_BankToBankTransfer")+"' title='"+VIS.Msg.getMsg("VA009_BankToBankTransfer")+"'  id='VA009_BankToBankimg_"+u.windowNo+"'><\/span><\/div>";d+=ci;d+="<\/div>";d+='  <div class="VA009-mid-search" id="VA009-mid-search_'+u.windowNo+'">';d+=' <div class="VA009-selectall"><input type="checkbox" id="VA009_SelectAll_'+u.windowNo+'"> <label>Select All<\/label><\/div>';d+=' <div class="VA009-selectall" style=" margin-left: 15px; "><label style=" font-weight: bold; text-decoration: underline; ">Total Amount (In Base): <\/label><label id="VA009_TotalSelected_'+u.windowNo+'"" style="font-weight: bold;"> 0 <\/label><\/div>';d+='<div class="VA009-search-wrap" style="float: right !important;"> <input value="" placeholder="Search..." type="text" id=VA009_SrchTxtbx_'+u.windowNo+'> <a class="VA009-search-icon" id=VA009_SrchBtn_'+u.windowNo+'><span class="glyphicon glyphicon-search"><\/span><\/a> <\/div>';d+="<\/div>";d+=' <div class="VA009-payment-list" id = VA009_Paymntlst_'+u.windowNo+">";d+="<\/div>";d+="<\/div>";d+=' <div class="VA009-right-wrap">';d+='<div class="VA009-tabs-wrap"> <ul class="VA009-right-tabs"> <li class="VA009-active-tab" id=VA009_Funds_'+u.windowNo+">"+VIS.Msg.getMsg("VA009_Bank")+"<\/li><li id=VA009_Cashbooks_"+u.windowNo+">"+VIS.Msg.getMsg("VA009_Cashbook")+"<\/li><\/ul> <\/div>";d+='<div class="VA009-icons-wrap"> <ul class="VA009-right-tabs"> <li class="VA009-active-tab" id = VA009_Refresh_'+u.windowNo+">"+VIS.Msg.getMsg("VA009_Refresh")+"<\/li><\/ul> <\/div>";d+=' <div class="VA009-right-content" id = VA009_Banklst_'+u.windowNo+">";d+="<\/div><\/div><\/td><\/tr><\/table>";h.append(d)}function hf(){g=h.find("#VA009_Org_"+u.windowNo);ii=h.find("#VA009_OrgdataDiv_"+u.windowNo);nt=h.find("#VA009_PayMthd_"+u.windowNo);ri=h.find("#VA009_PayMthddataDiv_"+u.windowNo);tt=h.find("#VA009_Status_"+u.windowNo);ui=h.find("#VA009_StatusdataDiv_"+u.windowNo);tu=h.find("#VA009_toggleImg_"+u.windowNo);ir=h.find("#VA009_leftpartdata_"+u.windowNo);or=h.find("#VA009_leftpart_"+u.windowNo);a=h.find("#VA009_Paymntlst_"+u.windowNo);f=h.find("#VA009_Banklst_"+u.windowNo);kt=h.find("#VA009_CR_Tab_"+u.windowNo);wi=h.find("#VA009_CP_Tab_"+u.windowNo);cr=h.find("#VA009_XML_Tab_"+u.windowNo);_SelectedOrgDiv=h.find("#VA009_OrgdataDiv_"+u.windowNo);sr=h.find("#VA009_BPartner_"+u.windowNo);fi=h.find("#VA009_BPdataDiv_"+u.windowNo);bu=h.find("#VA009_Selectedtxt_"+u.windowNo);uu=h.find("#VA009_Chkimg_"+u.windowNo);fu=h.find("#VA009_Cashimg_"+u.windowNo);eu=h.find("#VA009_Batchimg_"+u.windowNo);ou=h.find("#VA009_Splitimg_"+u.windowNo);ku=h.find("#VA009_PayMannualimg_"+u.windowNo);du=h.find("#VA009_BankToBankimg_"+u.windowNo);gu=h.find("#VA009_table_"+u.windowNo);su=h.find("#VA009_tdLeft_"+u.windowNo);yi=h.find("#VA009_SrchTxtbx_"+u.windowNo);tf=h.find("#VA009_SrchBtn_"+u.windowNo);ht=h.find("#VA009_DueDate_"+u.windowNo);pi=h.find("#VA009_DueDatedataDiv_"+u.windowNo);st=h.find("#VA009_TransactionType_"+u.windowNo);gi=h.find("#VA009_TransactionTypeDiv_"+u.windowNo);rr=h.find("#VA009_FromDate_"+u.windowNo);ur=h.find("#VA009_ToDate_"+u.windowNo);ir.height(or.height()-43);hi=h.find("#VA009_SelectAll_"+u.windowNo);rf=h.find("#VA009_Refresh_"+u.windowNo);fr=h.find("#VA009_Cashbooks_"+u.windowNo);er=h.find("#VA009_Funds_"+u.windowNo);pt=h.find("#VA009_TotalSelected_"+u.windowNo)}function cf(){g.on("change",function(){g.val()>0&&(ii.find("li").length>0?rt.indexOf(g.val())==-1?(ii.find("ul").append("<li id=VA009_li_"+g.val()+'><img src="Areas/VA009/Images/cross.png" alt="'+VIS.Msg.getMsg("VA009_Cancel")+'" title="'+VIS.Msg.getMsg("VA009_Cancel")+'" class="VA009-cross-btn" id=VA009_Delimg_'+g.val()+"> <span>"+VIS.Utility.encodeText(g.children()[g[0].selectedIndex].text)+"<\/span><\/li>"),rt.push(g.val()),ft("cs.AD_Org_ID",rt)):VIS.ADialog.info("VA009_AlrdySlctd"):(ii.append("<ul><li id=VA009_li_"+g.val()+'><img src="Areas/VA009/Images/cross.png" alt="'+VIS.Msg.getMsg("VA009_Cancel")+'" title="'+VIS.Msg.getMsg("VA009_Cancel")+'" class="VA009-cross-btn" id=VA009_Delimg_'+g.val()+"> <span>"+VIS.Utility.encodeText(g.children()[g[0].selectedIndex].text)+"<\/span><\/li>"),rt.push(g.val()),ft("cs.AD_Org_ID",rt)));g.prop("selectedIndex",0);a.find(".VA009-payment-wrap").remove();f.find(".VA009-right-data-main").remove();f.find(".VA009-accordion").remove();y=1;o=[];l=[];p=[];k=[];w()});ii.on("click",function(n){var i,r;n.target.localName=="img"&&(i="#"+n.target.id,t(i).parent().remove(),r=n.target.id.slice(n.target.id.lastIndexOf("_")+1,n.target.id.length),rt=jQuery.grep(rt,function(n){return n!=r}),ii.find("li").length>0?ft("cs.AD_Org_ID",rt):(oi="",ii.find("ul").remove()),a.find(".VA009-payment-wrap").remove(),f.find(".VA009-right-data-main").remove(),f.find(".VA009-accordion").remove(),y=1,o=[],l=[],p=[],k=[],w())});fi.on("click",function(n){var i,r;n.target.localName=="img"&&(i="#"+n.target.id,t(i).parent().remove(),r=n.target.id.slice(n.target.id.lastIndexOf("_")+1,n.target.id.length),vt=jQuery.grep(vt,function(n){return n!=r}),fi.find("li").length>0?ft("cb.C_BPartner_ID",vt):(di="",fi.find("ul").remove()),a.find(".VA009-payment-wrap").remove(),f.find(".VA009-right-data-main").remove(),f.find(".VA009-accordion").remove(),y=1,o=[],l=[],p=[],k=[],w())});nt.on("change",function(){ri.find("li").length>0?dt.indexOf(nt.val())==-1?(ri.find("ul").append('<li ><img src="Areas/VA009/Images/cross.png" alt="'+VIS.Msg.getMsg("VA009_Cancel")+'" title="'+VIS.Msg.getMsg("VA009_Cancel")+'" class="VA009-cross-btn" id=VA009_DelPayimg_'+nt.val()+"> <span>"+VIS.Utility.encodeText(nt.children()[nt[0].selectedIndex].text)+"<\/span><\/li>"),dt.push(nt.val()),ft("pm.VA009_PaymentMethod_ID",dt)):VIS.ADialog.info("VA009_AlrdySlctd"):(ri.append("<ul id=VA009_PayMthUL_"+nt.val()+' ><li ><img src="Areas/VA009/Images/cross.png" alt="'+VIS.Msg.getMsg("VA009_Cancel")+'" title="'+VIS.Msg.getMsg("VA009_Cancel")+'" class="VA009-cross-btn" id=VA009_DelPayimg_'+nt.val()+"> <span>"+VIS.Utility.encodeText(nt.children()[nt[0].selectedIndex].text)+"<\/span><\/li> <\/ul>"),dt.push(nt.val()),ft("pm.VA009_PaymentMethod_ID",dt));nt.prop("selectedIndex",0);a.find(".VA009-payment-wrap").remove();f.find(".VA009-right-data-main").remove();f.find(".VA009-accordion").remove();y=1;o=[];l=[];p=[];k=[];w()});ri.on("click",function(n){var i,r;n.target.localName=="img"&&(i="#"+n.target.id,t(i).parent().remove(),r=n.target.id.slice(n.target.id.lastIndexOf("_")+1,n.target.id.length),dt=jQuery.grep(dt,function(n){return n!=r}),ri.find("li").length>0?ft("pm.VA009_PaymentMethod_ID",dt):(ki="",ri.find("ul").remove()),a.find(".VA009-payment-wrap").remove(),f.find(".VA009-right-data-main").remove(),f.find(".VA009-accordion").remove(),y=1,o=[],l=[],p=[],k=[],w())});tt.on("change",function(){ui.find("li").length>0?gt.indexOf(tt.val())==-1?(ui.find("ul").append('<li ><img src="Areas/VA009/Images/cross.png" alt="'+VIS.Msg.getMsg("VA009_Cancel")+'" title="'+VIS.Msg.getMsg("VA009_Cancel")+'" class="VA009-cross-btn" id=VA009_DelStaimg_'+tt.val()+"> <span>"+VIS.Utility.encodeText(tt.children()[tt[0].selectedIndex].text)+"<\/span><\/li>"),gt.push(tt.val()),ft("cs.VA009_ExecutionStatus",gt)):VIS.ADialog.info("VA009_AlrdySlctd"):(ui.append("<ul id=VA009_StatusUL_"+tt.val()+' ><li ><img src="Areas/VA009/Images/cross.png" alt="'+VIS.Msg.getMsg("VA009_Cancel")+'" title="'+VIS.Msg.getMsg("VA009_Cancel")+'" class="VA009-cross-btn" id=VA009_DelStaimg_'+tt.val()+"> <span>"+VIS.Utility.encodeText(tt.children()[tt[0].selectedIndex].text)+"<\/span><\/li> <\/ul>"),gt.push(tt.val()),ft("cs.VA009_ExecutionStatus",gt));tt.prop("selectedIndex",0);a.find(".VA009-payment-wrap").remove();f.find(".VA009-right-data-main").remove();f.find(".VA009-accordion").remove();y=1;o=[];l=[];p=[];k=[];w()});ui.on("click",function(n){var i,r;n.target.localName=="img"&&(i="#"+n.target.id,t(i).parent().remove(),r=n.target.id.slice(n.target.id.lastIndexOf("_")+1,n.target.id.length),gt.splice(gt.indexOf(r),1),ui.find("li").length>0?ft("cs.VA009_ExecutionStatus",gt):(yt="",ui.find("ul").remove()),a.find(".VA009-payment-wrap").remove(),f.find(".VA009-right-data-main").remove(),f.find(".VA009-accordion").remove(),y=1,o=[],l=[],p=[],k=[],w())});st.on("change",function(){gi.find("li").length>0?ni.indexOf(st.val())==-1?(gi.find("ul").append('<li ><img src="Areas/VA009/Images/cross.png" alt="'+VIS.Msg.getMsg("VA009_Cancel")+'" title="'+VIS.Msg.getMsg("VA009_Cancel")+'" class="VA009-cross-btn" id=VA009_DelStaimg_'+st.val()+"> <span>"+VIS.Utility.encodeText(st.children()[st[0].selectedIndex].text)+"<\/span><\/li>"),ni.push(st.val())):VIS.ADialog.info("VA009_AlrdySlctd"):(gi.find("ul").remove(),gi.append("<ul id=VA009_StatusUL_"+st.val()+' ><li ><img src="Areas/VA009/Images/cross.png" alt="'+VIS.Msg.getMsg("VA009_Cancel")+'" title="'+VIS.Msg.getMsg("VA009_Cancel")+'" class="VA009-cross-btn" id=VA009_DelStaimg_'+st.val()+"> <span>"+VIS.Utility.encodeText(st.children()[st[0].selectedIndex].text)+"<\/span><\/li> <\/ul>"),ni.push(st.val()));st.prop("selectedIndex",0);a.find(".VA009-payment-wrap").remove();f.find(".VA009-right-data-main").remove();f.find(".VA009-accordion").remove();y=1;o=[];l=[];p=[];k=[];for(var n in ni)n!=0&&(si+=","),si+=""+ni[n]+"";w()});gi.on("click",function(n){var r,u,i;if(n.target.localName=="img"){r="#"+n.target.id;t(r).parent().remove();u=n.target.id.slice(n.target.id.lastIndexOf("_")+1,n.target.id.length);ni.splice(ni.indexOf(u),1);si="";for(i in ni)i!=0&&(si+=","),si+=""+ni[i]+"";a.find(".VA009-payment-wrap").remove();f.find(".VA009-right-data-main").remove();f.find(".VA009-accordion").remove();y=1;o=[];l=[];p=[];k=[];w()}});rr.on("change",function(){a.find(".VA009-payment-wrap").remove();f.find(".VA009-right-data-main").remove();f.find(".VA009-accordion").remove();y=1;o=[];l=[];p=[];k=[];w()});ur.on("change",function(){a.find(".VA009-payment-wrap").remove();f.find(".VA009-right-data-main").remove();f.find(".VA009-accordion").remove();y=1;o=[];l=[];p=[];k=[];w()});a.on("scroll",lf);a.on("click",function(n){if(n.target.className=="VA009-info-icon"){var i=t(n.target);i.hasClass("VA009-info-icon")&&(infoWinID=i.data("uid"),tr(infoWinID,"Business Partner Info","C_BPartner_ID"))}});tu.on("click",function(n){n.stopPropagation();var i=su.width();i>50&&t(ir).hide();su.animate({width:i>50?40:200},300,"swing",function(){i<51&&t(ir).show()})});uu.on("click",function(){wi.hasClass("VA009-active-tab")?o.length>0||l.length>0?et.Cheque_Pay_Dialog():VIS.ADialog.info("VA009_PlzSelct1Pay"):kt.hasClass("VA009-active-tab")?o.length>0||l.length>0?et.Cheque_Rec_Dialog():VIS.ADialog.info("VA009_PlzSelct1Pay"):VIS.ADialog.info(_iscustomer+"/"+_isvendor)});fu.on("click",function(){o.length>0&&l.length>0?VIS.ADialog.info("VA009_AdvPaymentCantTaken"):l.length>0?VIS.ADialog.info("VA009_AdvPaymentCantTaken"):o.length>0?et.Cash_Dialog():VIS.ADialog.info("VA009_PlzSelct1Pay")});eu.on("click",function(){et.Batch_OpenDialog()});ou.on("click",function(){o.length>0||l.length>0?o.length==1&&l.length==0?et.Split_Dialog():o.length==0&&l.length==1?et.Split_Dialog():VIS.ADialog.info("VA009_PlzSelctOnly1Pay"):VIS.ADialog.info("VA009_PlzSelct1Pay")});ku.on("click",function(){o.length>0||l.length>0?et.Pay_ManualDialog():VIS.ADialog.info("VA009_PlzSelct1Pay")});du.on("click",function(){et.B2B_Dialog()});ht.on("change",function(){pi.find("li").length>0?ti.indexOf(ht.val())==-1?(pi.find("ul").append('<li ><img src="Areas/VA009/Images/cross.png" alt="'+VIS.Msg.getMsg("VA009_Cancel")+'" title="'+VIS.Msg.getMsg("VA009_Cancel")+'" class="VA009-cross-btn" id=VA009_DelDueimg_'+ht.val()+"> <span>"+VIS.Utility.encodeText(ht.children()[ht[0].selectedIndex].text)+"<\/span><\/li>"),ti.push(ht.val()),ft("DueDate",ti)):VIS.ADialog.info("VA009_AlrdySlctd"):(pi.append("<ul id=VA009_PayMthUL_"+ht.val()+' ><li ><img src="Areas/VA009/Images/cross.png" alt="'+VIS.Msg.getMsg("VA009_Cancel")+'" title="'+VIS.Msg.getMsg("VA009_Cancel")+'" class="VA009-cross-btn" id=VA009_DelDueimg_'+ht.val()+"> <span>"+VIS.Utility.encodeText(ht.children()[ht[0].selectedIndex].text)+"<\/span><\/li> <\/ul>"),ti.push(ht.val()),ft("DueDate",ti));ht.prop("selectedIndex",0);a.find(".VA009-payment-wrap").remove();f.find(".VA009-right-data-main").remove();f.find(".VA009-accordion").remove();y=1;o=[];l=[];p=[];k=[];w()});pi.on("click",function(n){var i,r;n.target.localName=="img"&&(i="#"+n.target.id,t(i).parent().remove(),r=n.target.id.slice(n.target.id.lastIndexOf("_")+1,n.target.id.length),ti=jQuery.grep(ti,function(n){return n!=r}),pi.find("li").length>0?ft("DueDate",ti):(yr=99,pi.find("ul").remove()),a.find(".VA009-payment-wrap").remove(),f.find(".VA009-right-data-main").remove(),f.find(".VA009-accordion").remove(),y=1,au(li,ai,y,hr,oi,ki,yt,di,yi.val(),yr,si,rr.val(),ur.val(),vu))});yi.on("keypress",function(n){n.keyCode==13&&(a.find(".VA009-payment-wrap").remove(),f.find(".VA009-right-data-main").remove(),f.find(".VA009-accordion").remove(),y=1,w(),yi.val(""))});tf.on("click",function(){a.find(".VA009-payment-wrap").remove();f.find(".VA009-right-data-main").remove();f.find(".VA009-accordion").remove();y=1;w();yi.val("")});kt.on("click",function(){a.find(".VA009-payment-wrap").remove();f.find(".VA009-right-data-main").remove();f.find(".VA009-accordion").remove();ai="ARI";li="Y";y=1;w();kr(kt);lu()});wi.on("click",function(){a.find(".VA009-payment-wrap").remove();f.find(".VA009-right-data-main").remove();f.find(".VA009-accordion").remove();y=1;ai="API";li="Y";y=1;w();kr(wi);lu()});cr.on("click",function(){kr(cr);et.XML_Dialog()});hi.on("click",function(n){var f=t(n.target),i,r,u;if(pt.text(0),n.target.type=="checkbox")if(f.prop("checked")==!0){for(a.find(":checkbox").not(":disabled").prop("checked",!0),i=[],r=0;r<ar.length;r++)i.target=t(a.find(".VA009-payment-wrap").find(".VA009-clckd-checkbx[data-uid^="+ar[r]+"]"))[0],!i.target==!1&&(t(i.target).prop("disabled")||cu(i));for(u=0;u<lr.length;u++)i.target=t(a.find(".VA009-payment-wrap").find(".VA009-clckd-checkbx[data-uid^="+lr[u]+"]"))[0],!i.target==!1&&cu(i)}else o=[],l=[],a.find(":checkbox").prop("checked",!1),hi.find(":checkbox").prop("checked",!1),pt.text(0)});rf.on("click",function(){a.find(".VA009-payment-wrap").remove();f.find(".VA009-right-data-main").remove();f.find(".VA009-accordion").remove();ai="ARI";li="Y";y=1;w();kr(kt);lu()});fr.on("click",function(){fr.removeClass("VA009-active-tab");er.removeClass("VA009-active-tab");fr.addClass("VA009-active-tab");f.find(".VA009-right-data-main").hide();f.find(".VA009-accordion").hide();ei=h.find("#VA009_cashbkdiv_"+u.windowNo);ei.show()});er.on("click",function(){fr.removeClass("VA009-active-tab");er.removeClass("VA009-active-tab");er.addClass("VA009-active-tab");f.find(".VA009-right-data-main").show();f.find(".VA009-accordion").show();ei=h.find("#VA009_cashbkdiv_"+u.windowNo);ei.hide()})}function kr(n){kt.removeClass("VA009-active-tab");wi.removeClass("VA009-active-tab");cr.removeClass("VA009-active-tab");n.addClass("VA009-active-tab");hi.prop("checked",!1);o=[];l=[];pt.text(0)}function cu(n){var i=t(n.target),u,h,s,f,r,e;i.hasClass("glyphicon glyphicon-edit")?(iu=i.data("uid"),u=i.data("invoiceid"),h=i.data("transactiontype"),h=="Invoice"?kt.hasClass("VA009-active-tab")?tr(u,"Invoice (Customer)","C_Invoice_ID"):tr(u,"Invoice (Vendor)","C_Invoice_ID"):h=="Order"&&(kt.hasClass("VA009-active-tab")?tr(u,"Sales Order","C_Order_ID"):tr(u,"Purchase Order","C_Order_ID")),iu=0):n.target.type=="checkbox"?i.prop("checked")==!0?(i.data("name")=="Invoice"?(o.push(i.data("uid")),p.push({ID:i.data("uid"),PM:i.data()})):(l.push(i.data("uid")),k.push({ID:i.data("uid"),PM:i.data()})),vi=i.data("uid"),f=VIS.Utility.Util.getValueOfDecimal(pt.text()).toFixed(2),r=VIS.Utility.Util.getValueOfDecimal(i.data("baseamt")).toFixed(2),(i.data("docbasetype")=="ARC"||i.data("docbasetype")=="APC")&&(r=-1*r),e=VIS.Utility.Util.getValueOfDecimal(f)+VIS.Utility.Util.getValueOfDecimal(r),pt.text(VIS.Utility.Util.getValueOfDecimal(e).toFixed(2))):(s=i.data("uid"),o=jQuery.grep(o,function(n){return n!=s}),l=jQuery.grep(l,function(n){return n!=s}),p=jQuery.grep(p,function(n){return n.ID!=s}),k=jQuery.grep(k,function(n){return n.ID!=s}),vi=0,f=VIS.Utility.Util.getValueOfDecimal(pt.text()).toFixed(2),r=VIS.Utility.Util.getValueOfDecimal(i.data("baseamt")).toFixed(2),(i.data("docbasetype")=="ARC"||i.data("docbasetype")=="APC")&&(r=-1*r),e=VIS.Utility.Util.getValueOfDecimal(f)-VIS.Utility.Util.getValueOfDecimal(r),pt.text(VIS.Utility.Util.getValueOfDecimal(e).toFixed(2))):i.hasClass("VA009_AddNoteimg")&&(vi=i.data("uid"),et.ChatWindow())}function ft(n,t){if(n.contains("Org"))oi=" AND "+n+" IN ("+t+")";else if(n.contains("PaymentMethod"))ki=" AND "+n+" IN ("+t+")";else if(n.contains("BPartner"))di=" AND "+n+" IN ("+t+")";else if(n.contains("Status")){if(t!=""){yt=" AND "+n+" IN (";for(var i in t)yt+="'"+t[i]+"',";yt=yt.slice(0,-1)+")"}}else n.contains("DueDate")&&(yr=Math.max.apply(Math,ti))}function lu(){vt=[];o=[];l=[];a.find(":checkbox").prop("checked",!1);hi.find(":checkbox").prop("checked",!1);p=[];k=[];pt.text(0)}function dr(n,t){function i(t){if(t.length>0){n.find("option").remove();n.append("<option value='0'><\/option>");for(var i in t)n.append("<option value="+VIS.Utility.Util.getValueOfInt(t[i].C_Bank_ID)+">"+VIS.Utility.encodeText(t[i].Name)+"<\/option>");n.prop("selectedIndex",0)}}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadBank",{Orgs:t.toString()},i)}function lf(){t(this).scrollTop()+t(this).innerHeight()>=this.scrollHeight&&y<noPages&&(y++,rt.length==1&&(oi=rt.indexOf(VIS.context.getAD_Org_ID())==-1?"":"AND cs.AD_Org_ID IN ("+VIS.context.getAD_Org_ID()+")"),w())}function af(n){e[0].style.visibility="visible";t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GeneratePaymentsBtoB",type:"POST",datatype:"json",contentType:"application/json",data:JSON.stringify({recordData:JSON.stringify(n)}),success:function(n){nr=JSON.parse(n);nr.length>0?($note.text(nr),$note.css("visibility","visible")):VIS.ADialog.info("VA009_SavedSuccessfully");e[0].style.visibility="hidden"},error:function(n){nr=n;$note.text(nr);$note.css("visibility","visible");e[0].style.visibility="hidden"}})}function uf(){function r(){$xml=null;i=null}var i,n;$xml=t("<div class='VA009-popform-content' style='min-height:333px !important'>");i="";i+="<div class='VA009-popform-data'><label>"+VIS.Msg.getMsg("VA009_GenXML_Tab")+"<\/label><\/div>  <div class='VA009-table-container' id='VA009_btnPopupGrid'>  <\/div> <\/div>";$xml.append(i);n=new VIS.ChildDialog;n.setContent($xml);n.setTitle(VIS.Msg.getMsg("VA009_GenXML_Tab"));n.setWidth("60%");n.setEnableResize(!0);n.setModal(!0);n.show();wu=$xml.find("#VA009_btnPopupGrid");pf();n.onOkClick=function(){VIS.ADialog.info("VA009_GenXML_Tab")};n.onCancelCLick=function(){r()};n.onClose=function(){r()}}function vf(){var n,t;try{if(n=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/GetBatchProcess",null,null),n!=null){var i=n.AD_Process_ID,r=n.Name,s=n.ClassName,h=n.EntityType;i>0?(t=new VIS.ParameterDialog(u.windowNo,u),t.initDialog(i,r,h,s,!1),t.onCloseMain=function(n){e[0].style.visibility=n?"visible":"hidden"},t.showDialog(),t=null):VIS.ADialog.info("ProcessNotFound",!0,"","")}a.find(".VA009-payment-wrap").remove();f.find(".VA009-right-data-main").remove();f.find(".VA009-accordion").remove();y=1;o=[];l=[];p=[];k=[];w();e[0].style.visibility="hidden"}catch(c){}}function yf(n,i,r){t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/"+r,dataType:"json",data:{searchText:n},success:function(n){var r=JSON.parse(n);datasource=[];i(t.map(r,function(n){return{label:n.Name,value:n.Name,ids:n.C_BPartner_ID}}));t(self.div).autocomplete("search","");t(self.div).trigger("focus")}})}function au(n,i,r,u,f,o,s,h,c,l,a,v,y,p){e[0].style.visibility="visible";gr=f+o+s+h;ff(n,i,gr);t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetData",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!0,data:{pageNo:r,pageSize:u,whereQry:bi,OrgWhr:f,SearchText:c,WhrDueDate:l,TransType:a,FromDate:v,ToDate:y},success:function(n){p(n)},error:function(){VIS.ADialog.error("VA009_ErrorLoadingPayments");e[0].style.visibility="hidden"}})}function vu(n){var et=0,ot="",s="",i=JSON.parse(n),r,nt,p,tt,w,yt,rt,o,vt,v,g;if(i.paymentdata.length>0){hi.is(":checked")&&hi.prop("checked",!1);y==1&&i.paymentdata.length>0&&(paymentCount=i.paymentdata[0].paymentCount,noPages=Math.ceil(paymentCount/yu));for(r in i.paymentdata)et=et+1,i.paymentdata[r].TransactionType=="Invoice"?ar.indexOf(i.paymentdata[r].C_InvoicePaySchedule_ID)===-1?ar.push(i.paymentdata[r].C_InvoicePaySchedule_ID):console.log("This item already exists"):lr.indexOf(i.paymentdata[r].C_InvoicePaySchedule_ID)===-1?lr.push(i.paymentdata[r].C_InvoicePaySchedule_ID):console.log("This item already exists"),i.paymentdata[r].VA009_plannedduedate!=null?(nt=new Date(i.paymentdata[r].VA009_plannedduedate),nt=nt.toLocaleDateString(),p=nt):p=i.paymentdata[r].Systemdate,i.paymentdata[r].VA009_FollowupDate!=null?(tt=new Date(i.paymentdata[r].VA009_FollowupDate),tt=tt.toLocaleDateString(),w=tt):w=i.paymentdata[r].Systemdate,yt=i.paymentdata[r].DueAmt,rt="N",i.paymentdata[r].CurrencyCode==i.paymentdata[r].BaseCurrencyCode&&(rt="Y"),ot=i.paymentdata[r].PaymwentBaseType=="S"?"cheque-white.png":i.paymentdata[r].PaymwentBaseType=="B"?"cash-white.png":"batch-white.png",s='<div class="VA009-payment-wrap" data-UID="'+i.paymentdata[r].C_InvoicePaySchedule_ID+'"> <div class="row" data-UID="'+i.paymentdata[r].C_InvoicePaySchedule_ID+'"><div class="col-md-4 col-sm-4 width-sm-35" style="padding-right:0px;"> <input type="checkbox" class="VA009-clckd-checkbx" data-UID="'+i.paymentdata[r].C_InvoicePaySchedule_ID+'" data-BaseAmt="'+i.paymentdata[r].BaseAmt+'" data-NAME="'+i.paymentdata[r].TransactionType+'" data-PaymentRule="'+i.paymentdata[r].PaymentRule+'" data-PaymentType="'+i.paymentdata[r].PaymentType+'" data-PaymentTriggerBy="'+i.paymentdata[r].PaymentTriggerBy+'" data-PaymwentBaseType="'+i.paymentdata[r].PaymwentBaseType+'" data-DocBaseType="'+i.paymentdata[r].DocBaseType+'" data-CurrencyCode="'+i.paymentdata[r].CurrencyCode+'"  alt="'+VIS.Msg.getMsg("VA009_Select")+'" title="'+VIS.Msg.getMsg("VA009_Select")+'" '+(i.paymentdata[r].IsHoldPayment=="Y"?"disabled":"")+'><div class="VA009-pay-left"><div class="VA009-pay-img-wrap"><span class=\'VA009-pay-img\'><img src=\''+VIS.Application.contextUrl+"Areas/VA009/Images/"+ot+"' alt=''><\/span> <span class='VA009-pay-status'>"+i.paymentdata[r].VA009_ExecutionStatus+'<\/span> <\/div> <div class="VA009-pay-text"><p>'+i.paymentdata[r].C_Bpartner+"<\/p><span>"+i.paymentdata[r].C_BP_Group+"<\/span> <span>"+i.paymentdata[r].DocumentNo+"<\/span> <span>"+i.paymentdata[r].VA009_PaymentMethod+'<\/span> <\/div><\/div><\/div><div class="col-md-3 col-sm-3 width-sm-30 sm-padd" style="padding-right:0;">',w!=""&&p!=""?s+=' <div class="VA009-left-data VA009-pay-mid-sec"><span title="Due Date">'+p+'<\/span> <span class="glyphicon glyphicon-play play-icon"><\/span> <span title="Planned Due Date">'+w+"<\/span> <\/div> ":w==""&&p!=""?s+=' <div class="VA009-left-data VA009-pay-mid-sec"><span title="Due Date">'+p+"<\/span><\/div> ":w!=""&&p==""&&(s+=' <div class="VA009-left-data VA009-pay-mid-sec"><span title="Planned Due Date">'+w+"<\/span><\/div> "),s+=Globalize.format(i.paymentdata[r].VA009_RecivedAmt>0)?' <div class="VA009-left-data VA009-pay-mid-sec"> <span class="VA009-color-gray" title="'+(i.paymentdata[r].TransactionType=="Invoice"?VIS.Msg.getMsg("InvoiceAmount"):VIS.Msg.getMsg("VA009_OrderAmount"))+'">'+i.paymentdata[r].CurrencyCode+" "+Globalize.format(i.paymentdata[r].TotalInvAmt,"N")+' <\/span> <br> <span class="glyphicon glyphicon-ok play-icon"><\/span> <span class="VA009-color-gray" title="'+(ai=="ARI"?VIS.Msg.getMsg("VA009_TotRecAmt"):VIS.Msg.getMsg("VA009_TotPaidAmt"))+'">'+i.paymentdata[r].CurrencyCode+" "+Globalize.format(i.paymentdata[r].VA009_RecivedAmt,"N")+" <\/span><\/div> ":' <div class="VA009-left-data VA009-pay-mid-sec"> <span class="VA009-color-gray" title="'+(i.paymentdata[r].TransactionType=="Invoice"?VIS.Msg.getMsg("InvoiceAmount"):VIS.Msg.getMsg("VA009_OrderAmount"))+'">'+i.paymentdata[r].CurrencyCode+" "+Globalize.format(i.paymentdata[r].TotalInvAmt,"N")+" <\/span> <\/div> ",s+=' <div class="VA009-left-data VA009-pay-mid-sec"> <span data-UID="'+i.paymentdata[r].C_InvoicePaySchedule_ID+'" class="VA009_AddNote" style=" cursor: pointer;"><img class="VA009_AddNoteimg" data-UID="'+i.paymentdata[r].C_InvoicePaySchedule_ID+'" alt="'+VIS.Msg.getMsg("VA009_AddNote")+'" title="'+VIS.Msg.getMsg("VA009_AddNote")+'" src="'+VIS.Application.contextUrl+'Areas/VA009/Images/add-note.png"> <\/img><\/span> <\/div>  <div class="VA009-left-data VA009-pay-mid-sec" id="VA009-LastChat_'+u.windowNo+'"> <span class="VA009-Chatcolor-gray" id=VA009-Chatcolor-gray_'+i.paymentdata[r].C_InvoicePaySchedule_ID+">"+i.paymentdata[r].LastChat+'<\/span> <\/div>  <\/div> <div class="col-md-2 col-sm-2 width-sm-20 sm-padd" style="padding-right:0;"><div class="VA009-transactionType"> <span>'+i.paymentdata[r].TransactionType+(i.paymentdata[r].IsHoldPayment=="Y"?" ("+VIS.Msg.getMsg("VA009_HoldPayment")+")":"")+"<\/span> ",s+=i.paymentdata[r].DocBaseType=="APC"||i.paymentdata[r].DocBaseType=="ARC"?'<br><span style="text-decoration: underline;color: red;font-size: 12px;">Credit Memo<\/span> <\/div><\/div>':" <\/div><\/div>",s+=' <div class="col-md-3 col-sm-3">  <div class="VA009-right-part"><span class="glyphicon glyphicon-edit" data-UID="'+i.paymentdata[r].C_InvoicePaySchedule_ID+'" data-InvoiceID="'+i.paymentdata[r].C_Invoice_ID+'" data-TransactionType ="'+i.paymentdata[r].TransactionType+'" data-IsHoldPayment ="'+i.paymentdata[r].IsHoldPayment+'"  alt="'+VIS.Msg.getMsg("VA009_Edit")+'" title="'+VIS.Msg.getMsg("VA009_Edit")+'"><\/span> <span class="VA009-info-icon" style="margin-right: 8px;" data-UID="'+i.paymentdata[r].C_BPartner_ID+'" alt="'+VIS.Msg.getMsg("VA009_Info")+'" title="'+VIS.Msg.getMsg("VA009_Info")+'"><\/span><div class="VA009-pay-amount" id=VA009_ConvertedAmt_'+u.windowNo+"_"+i.paymentdata[r].C_InvoicePaySchedule_ID+'> <span title="Amount Due">'+i.paymentdata[r].CurrencyCode+" "+Globalize.format(i.paymentdata[r].DueAmt,"N")+"<\/span><br> <\/div> <\/div> <\/div><\/div><\/div>",a.append(s),nu=h.find("#VA009_ConvertedAmt_"+u.windowNo+"_"+i.paymentdata[r].C_InvoicePaySchedule_ID),rt=="N"&&nu.append('<span class="VA009-color-gray" title="Amount Due">'+i.paymentdata[r].BaseCurrencyCode+" "+Globalize.format(i.paymentdata[r].convertedAmt,"N")+"<\/span> ")}if(i.bankdetails.length>0){f.find(".VA009-right-data-main").remove();f.find(".VA009-accordion").remove();var wt=0,st="",ht,ut=0,ft=0,k=[],c=[],d=[],ct,b,lt,l="pull-right VA009-color-green",it="pull-right VA009-color-green",bt="VA009-color-green",at=t('<div class="VA009-accordion"><\/div>');for(o in i.bankdetails)i.bankdetails[o].CurrentBalance<0&&(l="pull-right VA009-color-red"),i.bankdetails[o].UnreconsiledAmt<0&&(it="pull-right VA009-color-red"),st==i.bankdetails[o].CurrencyCode1?(lt=f.find("#VA009_bankdtl_"+i.bankdetails[o].CurrencyCode1),ht='<span class="pull-head"> '+i.bankdetails[o].BankName+" "+i.bankdetails[o].BankAccountNumber+'<\/span> <p style="margin-bottom: 0;">'+VIS.Msg.getMsg("VA009_Reconciled")+' <span class="'+l+'">'+i.bankdetails[o].CurrencyCode1+" "+Globalize.format(i.bankdetails[o].CurrentBalance,"N")+"<\/span><\/p> <p>"+VIS.Msg.getMsg("VA009_Unreconciled")+' <a class="'+it+'">'+i.bankdetails[o].CurrencyCode1+" "+Globalize.format(i.bankdetails[o].UnreconsiledAmt,"N")+"<\/a><\/p>",lt.append(ht),ut=ut+i.bankdetails[o].CurrentBalance,ft=ft+i.bankdetails[o].UnreconsiledAmt):(ct='<div class="panel-group" id="accordion_'+i.bankdetails[o].C_Bank_ID+'" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><div class="panel-heading" role="tab" id="headingOne_'+i.bankdetails[o].C_Bank_ID+'"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#accordion_'+i.bankdetails[o].C_Bank_ID+'" href="#collapseOne_'+i.bankdetails[o].C_Bank_ID+'" aria-expanded="true" aria-controls="collapseOne" class="VA009-Accordion-head" id=VA009_TotalAmtCurr_'+i.bankdetails[o].CurrencyCode1+'><\/a><\/h4><\/div><div id="collapseOne_'+i.bankdetails[o].C_Bank_ID+'" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne" style="height: auto;"><div class="panel-body" id=VA009_bankdtl_'+i.bankdetails[o].CurrencyCode1+'><span class="pull-head"> '+i.bankdetails[o].BankName+" "+i.bankdetails[o].BankAccountNumber+'<\/span><p style="margin-bottom: 0;">'+VIS.Msg.getMsg("VA009_Reconciled")+' <span class="'+l+'">'+i.bankdetails[o].CurrencyCode1+" "+Globalize.format(i.bankdetails[o].CurrentBalance,"N")+"<\/span><\/p> <p>"+VIS.Msg.getMsg("VA009_Unreconciled")+' <a class="'+it+'">'+i.bankdetails[o].CurrencyCode1+" "+Globalize.format(i.bankdetails[o].UnreconsiledAmt,"N")+"<\/a><\/p> <\/div><\/div><\/div> <\/div>",at.append(ct),f.append(at),ut+=i.bankdetails[o].CurrentBalance,ft+=i.bankdetails[o].UnreconsiledAmt),c.indexOf(i.bankdetails[o].CurrencyCode1)==-1?(c.push(i.bankdetails[o].CurrencyCode1),b=c.indexOf(i.bankdetails[o].CurrencyCode1),k[b]=0,d[b]=0):b=c.indexOf(i.bankdetails[o].CurrencyCode1),k[b]=parseFloat(k[b])+parseFloat(i.bankdetails[o].CurrentBalance),d[b]=parseFloat(d[b])+parseFloat(i.bankdetails[o].UnreconsiledAmt),wt=i.bankdetails[o].C_Bank_ID,st=i.bankdetails[o].CurrencyCode1,l="pull-right VA009-color-green",it="pull-right VA009-color-green";for(v in c)vt=f.find("#VA009_TotalAmtCurr_"+c[v]),l=k[v]<0?"VA009-color-red":"VA009-color-green",bt=d[v]<0?"VA009-color-red":"VA009-color-green",vt.append('<div class="VA009-panel-head-total"> <div><span class="VA009-head-currency-name">'+c[v]+'<\/span><span><i class="glyphicon glyphicon-chevron-down pull-right"><\/i><\/span><\/div><p>'+VIS.Msg.getMsg("VA009_Reconciled")+' <span class="'+l+'">'+c[v]+" "+Globalize.format(k[v],"N")+" <\/span><\/p> <p>"+VIS.Msg.getMsg("VA009_Unreconciled")+' <a class="VA009-color-green">'+c[v]+" "+Globalize.format(d[v],"N")+"<\/a><\/p><\/div>");f.append("<\/div><\/div>")}else f.find(".VA009-right-data-main").remove(),f.find(".VA009-accordion").remove();if(i.Cbk.length>0){f.append(' <div class="VA009-right-data-main" style="display: none;" id=VA009_cashbkdiv_'+u.windowNo+"> <\/div>");ei=h.find("#VA009_cashbkdiv_"+u.windowNo);ei.append(" <h5>"+VIS.Msg.getMsg("VA009_Cashbook")+"<\/h5> ");for(g in i.Cbk)i.Cbk[g].Csb_Amt<0&&(l="pull-right VA009-color-red"),ei.append('<div class="VA009-right-data">  <p class="VA009-data-top">  <span class="pull-left"> '+i.Cbk[g].CashBookName+'<\/span> <span class="'+l+'">'+i.Cbk[g].CBCurrencyCode+" "+Globalize.format(i.Cbk[g].Csb_Amt,"N")+"<\/span>  <\/p>  <\/div>"),l="pull-right VA009-color-green"}sr.val("");pt.text(0);e[0].style.visibility="hidden"}function pf(){e[0].style.visibility="visible";t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetPaymentScheduleBatch",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!0,data:{FileName:"Hell",RecordID:1221},success:function(n){n=JSON.parse(n);wf(n)},error:function(){VIS.ADialog.error("VA009_ErrorLoadingPayments");e[0].style.visibility="hidden"}})}function wf(n){var i,r,t;if(e[0].style.visibility="hidden",console.log(n.result),console.log(n),n.result)for(r="",t=0;t<n.result.length;t++)i='<div class="VA009-payment-wrap" data-UID="'+n.result[t].DocumentNo+'"> <div class="row" data-UID="'+n.result[t].DocumentNo+'"><div class="col-md-4 col-sm-4 width-sm-35" style="padding-right:0px;"> <input type="checkbox" class="VA009-clckd-checkbx" data-UID="'+n.result[t].DocumentNo+'" data-BaseAmt="'+n.paymentdata[t].BaseAmt+'"  data-NAME="'+n.result[t].DocumentNo+'" data-PaymentRule="'+n.result[t].PaymentRule+'" data-PaymentType="'+n.result[t].PaymentType+'" data-PaymentTriggerBy="'+n.result[t].PaymentTriggerBy+'" data-PaymwentBaseType="'+n.result[t].PaymwentBaseType+'" data-DocBaseType="'+n.result[t].DocBaseType+'" data-CurrencyCode="'+n.result[t].CurrencyCode+'"  alt="'+VIS.Msg.getMsg("VA009_Select")+'" title="'+VIS.Msg.getMsg("VA009_Select")+'"><div class="VA009-pay-left"><div class="VA009-pay-img-wrap"><span class=\'VA009-pay-img\'><img src=\''+VIS.Application.contextUrl+"Areas/VA009/Images/"+r+"' alt=''><\/span> <span class='VA009-pay-status'>"+n.result[t].VA009_ExecutionStatus+'<\/span> <\/div> <div class="VA009-pay-text"><p>'+n.result[t].C_Bpartner+"<\/p><span>"+n.result[t].C_BP_Group+"<\/span> <span>"+n.result[t].DocumentNo+"<\/span> <span>"+n.result[t].PaymentMethod+'<\/span> <\/div><\/div><\/div><div class="col-md-3 col-sm-3 width-sm-30 sm-padd" style="padding-right:0;">',n.result[t].VA009_DocumentDate!=""&&(i+=' <div class="VA009-left-data VA009-pay-mid-sec"><span title="Due Date">'+n.result[t].VA009_DocumentDate+"<\/span> <\/div> "),i+=Globalize.format(n.result[t].VA009_RecivedAmt>0)?' <div class="VA009-left-data VA009-pay-mid-sec"> <span class="VA009-color-gray" title="Invoice Amount">'+n.result[t].ISO_CODE+" "+Globalize.format(n.result[t].VA009_ConvertedAmt,"N")+' <\/span> <br> <span class="glyphicon glyphicon-ok play-icon"><\/span> <span class="VA009-color-gray" title="Total Recieved Amount">'+n.result[t].CurrencyCode+" "+Globalize.format(n.result[t].VA009_RecivedAmt,"N")+" <\/span><\/div> ":' <div class="VA009-left-data VA009-pay-mid-sec"> <span class="VA009-color-gray" title="Invoice Amount">'+n.result[t].ISO_CODE+" "+Globalize.format(n.result[t].VA009_ConvertedAmt,"N")+" <\/span> <\/div> ",i+=' <div class="VA009-left-data VA009-pay-mid-sec"> <span data-UID="'+n.result[t].DocumentNo+'" class="VA009_AddNote" style=" cursor: pointer;"><img class="VA009_AddNoteimg" data-UID="'+n.result[t].DocumentNo+'" alt="'+VIS.Msg.getMsg("VA009_AddNote")+'" title="'+VIS.Msg.getMsg("VA009_AddNote")+'" src="'+VIS.Application.contextUrl+'Areas/VA009/Images/add-note.png"> <\/img><\/span> <\/div>  <div class="VA009-left-data VA009-pay-mid-sec" id="VA009-LastChat_'+u.windowNo+'"> <span class="VA009-Chatcolor-gray" id=VA009-Chatcolor-gray_'+n.result[t].DocumentNo+">"+n.result[t].LastChat+'<\/span> <\/div>  <\/div> <div class="col-md-2 col-sm-2 width-sm-20 sm-padd" style="padding-right:0;"><div class="VA009-transactionType"> <span>'+n.result[t].TransactionType+"<\/span> ",i+=n.result[t].DocBaseType=="APC"||n.result[t].DocBaseType=="ARC"?'<br><span style="text-decoration: underline;color: red;font-size: 12px;">Credit Memo<\/span> <\/div><\/div>':" <\/div><\/div>",i+=' <div class="col-md-3 col-sm-3">  <div class="VA009-right-part"><span class="glyphicon glyphicon-edit" data-UID="'+n.result[t].DocumentNo+'" data-InvoiceID="'+n.result[t].C_Invoice_ID+'" data-TransactionType ="'+n.result[t].TransactionType+'" alt="'+VIS.Msg.getMsg("VA009_Edit")+'" title="'+VIS.Msg.getMsg("VA009_Edit")+'"><\/span> <span class="VA009-info-icon" style="margin-right: 8px;" data-UID="'+n.result[t].C_BPartner_ID+'" alt="'+VIS.Msg.getMsg("VA009_Info")+'" title="'+VIS.Msg.getMsg("VA009_Info")+'"><\/span><div class="VA009-pay-amount" id=VA009_ConvertedAmt_'+u.windowNo+"_"+n.result[t].DocumentNo+'> <span title="Amount Due">'+n.result[t].ISO_CODE+" "+Globalize.format(n.result[t].VA009_ConvertedAmt,"N")+"<\/span><br> <\/div> <\/div> <\/div><\/div><\/div>",wu.append(i)}function bf(){e=t("<div class='vis-apanel-busy'>");e.css({position:"absolute",width:"98%",height:"97%","text-align":"center","z-index":"999"});e[0].style.visibility="visible";h.append(e)}function w(){au(li,ai,y,hr,oi,ki,yt,di,yi.val(),yr,si,rr.val(),ur.val(),vu)}var et,tr,ff;this.frame;this.windowNo;var u=this,h=t('<div class="VA009-assign-content">'),d,ot,ci,gr="",ef,nu;Orgname="";var li="Y",ai="ARI",g,ii,nt,ri,tt,ui,tu,ir,or,a,sr,fi,f,y=1,hr=20,yu=20,kt,wi,cr,iu=0,pu=!1,bi="",ei,rt=[],vt=[],o=[],lr=[],ar=[],dt=[],gt=[],oi="",ki="",di="",yt="",si="",ni=[],st,gi,rr,ur,l=[],p=[],k=[],wu=null,nr="",bu,ru,uu,fu,eu,ou,ku,du,gu,su,v=[],ti=[],vr=[],hu="",yr=99,ut=[],n,i,r,c,s,kf=t(window).height(),vi=0,nf=0,e=null,yi,tf,ht,pi,pt=null,wt=null,bt=null,pr=null,lt=null,wr=null,it=null,hi=null,rf=null,fr=null,er=null,b=null,ct=null,br=null,at=0;this.Initialize=function(){of()};et={loadOrg:function(){function n(n){var t;if(g.append(" <option value = 0><\/option>"),n.length>0)for(t in n)g.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].AD_Org_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>");g.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadOrganization",null,n)},loadPaymentMethods:function(){function n(n){if(nt.append(" <option value = 0><\/option>"),n.length>0)for(var t in n)nt.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].VA009_PaymentMethod_ID)+">"+VIS.Utility.encodeText(n[t].VA009_Name)+"<\/option>");nt.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadPaymentMethod",null,n)},loadStatus:function(){function n(n){if(tt.append(" <option value = 0><\/option>"),n.length>0)for(var t in n)tt.append("<option value="+n[t].Value+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>");tt.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadStatus",null,n)},Cheque_Pay_Dialog:function(){function tt(t){t!=""?(e[0].style.visibility="hidden",VIS.ADialog.info("VA009_PleaseSelctonlyCheque")):(wt.show(),dr($POP_cmbBank,rt),$POP_cmbBank.css("background-color",n(!0)),$POP_cmbBankAccount.css("background-color",n(!0)),b.css("background-color",n(!0)),ft(),st(ht),lt(),ot())}function ft(){var n=[];n.length==0&&(n.push({field:"C_Bpartner",caption:VIS.Msg.getMsg("VA009_Vendor"),sortable:!0,size:"12%"}),n.push({field:"C_InvoicePaySchedule_ID",caption:VIS.Msg.getMsg("VA009_Schedule"),sortable:!0,size:"7%"}),n.push({field:"Description",caption:VIS.Msg.getMsg("Description"),sortable:!0,size:"15%",editable:{type:"text"}}),n.push({field:"CurrencyCode",caption:VIS.Msg.getMsg("VA009_Currency"),sortable:!0,size:"8%"}),n.push({field:"DueAmt",caption:VIS.Msg.getMsg("VA009_DueAmt"),sortable:!0,size:"12%",render:"float:2"}),n.push({field:"ConvertedAmt",caption:VIS.Msg.getMsg("VA009_ConvertedAmt"),sortable:!0,size:"12%",render:"float:2"}),n.push({field:"VA009_RecivedAmt",caption:VIS.Msg.getMsg("VA009_PayAmt"),sortable:!0,size:"12%",render:"float:2",editable:{type:"float"}}),n.push({field:"OverUnder",caption:VIS.Msg.getMsg("VA009_OverUnder"),sortable:!0,size:"8%",render:"float:2"}),n.push({field:"Writeoff",caption:VIS.Msg.getMsg("VA009_Writeoff"),sortable:!0,size:"8%",render:"float:2",editable:{type:"float"}}),n.push({field:"Discount",caption:VIS.Msg.getMsg("VA009_Discount"),sortable:!0,size:"8%",render:"float:2",editable:{type:"float"}}),n.push({field:"CheckNumber",caption:VIS.Msg.getMsg("VA009_ChkNo"),sortable:!0,size:"12%",editable:{type:"text"}}),n.push({field:"CheckDate",caption:VIS.Msg.getMsg("VA009_CheckDate"),sortable:!0,size:"10%",render:"date",style:"text-align: left",editable:{type:"date"}}),n.push({field:"recid",caption:VIS.Msg.getMsg("VA009_srno"),sortable:!0,size:"1%"}),n.push({field:"TransactionType",caption:VIS.Msg.getMsg("VA009_TransactionType"),sortable:!0,size:"1%"}));i=null;i=wr.w2grid({name:"CheuePaybleGrid_"+VIS.Env.getWindowNo(),recordHeight:25,columns:n,multiSelect:!0,onEditField:function(n){n.column==6||n.column==8||n.column==9?i.get(n.recid).TransactionType=="Order"&&(n.isCancelled=!0):$POp_cmbPaySelectn.val()=="P"&&(n.isCancelled=!0)},onChange:function(n){window.setTimeout(function(){if(i.getChanges(n.recid)!=undefined){var t=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/GetCurrencyPrecision",{BankAccount_ID:$POP_cmbBankAccount.val(),CurrencyFrom:"B"},null);if(n.column==6){if(n.value_new==""&&(n.value_new=0),n.value_new>i.records[n.index].ConvertedAmt){VIS.ADialog.error("MoreScheduleAmount");n.value_new=n.value_original;i.get(n.recid).changes.VA009_RecivedAmt=n.value_new;i.get(n.recid).VA009_RecivedAmt=n.value_new;i.refreshCell(n.recid,"VA009_RecivedAmt");return}i.records[n.index].VA009_RecivedAmt=n.value_new;(i.get(i.getSelection()).PaymwentBaseType=="ARR"||i.get(i.getSelection()).PaymwentBaseType=="APP")&&(n.value_new<i.get(i.getSelection()).ConvertedAmt?(i.get(i.getSelection()).ConvertedAmt<0?i.get(n.recid).TransactionType=="Order"?(i.get(n.recid).changes.Discount=i.get(i.getSelection()).ConvertedAmt-n.value_new,i.get(n.recid).Discount=i.get(n.recid).changes.Discount.toFixed(t),i.get(n.recid).changes.Writeoff=0,i.get(n.recid).Writeoff=0,i.get(n.recid).changes.OverUnder=0,i.get(n.recid).OverUnder=0):(i.get(n.recid).changes.OverUnder=i.get(i.getSelection()).ConvertedAmt-n.value_new,i.get(n.recid).OverUnder=i.get(n.recid).changes.OverUnder.toFixed(t),i.get(n.recid).changes.Writeoff=0,i.get(n.recid).changes.Discount=0):i.get(n.recid).TransactionType=="Order"?(i.get(n.recid).changes.Discount=(i.get(i.getSelection()).ConvertedAmt-n.value_new).toFixed(t),i.get(n.recid).Discount=i.get(n.recid).changes.Discount,i.get(n.recid).changes.Writeoff=0,i.get(n.recid).Writeoff=0,i.get(n.recid).changes.OverUnder=0,i.get(n.recid).OverUnder=0):(i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-n.value_new).toFixed(t),i.get(n.recid).OverUnder=VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder),i.get(n.recid).changes.Writeoff=0,i.get(n.recid).Writeoff=0,i.get(n.recid).changes.Discount=0),i.refreshCell(n.recid,"OverUnder"),i.refreshCell(n.recid,"Discount"),i.refreshCell(n.recid,"Writeoff")):n.value_new==i.get(i.getSelection()).ConvertedAmt?(i.get(n.recid).changes.OverUnder=0,i.get(n.recid).OverUnder=0,i.get(n.recid).changes.Discount=0,i.get(n.recid).changes.Writeoff=0,i.get(n.recid).Discount=0,i.get(n.recid).Writeoff=0,i.get(n.recid).changes.VA009_RecivedAmt=n.value_new,i.get(n.recid).VA009_RecivedAmt=n.value_new,i.refreshCell(n.recid,"OverUnder"),i.refreshCell(n.recid,"Discount"),i.refreshCell(n.recid,"Writeoff"),i.refreshCell(n.recid,"VA009_RecivedAmt")):n.value_new>i.get(i.getSelection()).ConvertedAmt&&(i.get(i.getSelection()).ConvertedAmt<0?(i.get(n.recid).changes.OverUnder=0,i.get(n.recid).OverUnder=0,i.get(n.recid).changes.Writeoff=(i.get(i.getSelection()).ConvertedAmt-n.value_new).toFixed(t),i.get(n.recid).Writeoff=VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff)):(i.get(n.recid).changes.OverUnder=i.get(i.getSelection()).ConvertedAmt-n.value_new,i.get(n.recid).OverUnder=i.get(n.recid).changes.OverUnder.toFixed(t),i.get(n.recid).changes.Writeoff=0,i.get(n.recid).Writeoff=0),i.get(n.recid).changes.Discount=0,i.get(n.recid).Discount=0,i.refreshCell(n.recid,"OverUnder"),i.refreshCell(n.recid,"Discount"),i.refreshCell(n.recid,"Writeoff")))}n.column==8&&(n.value_new==""&&(n.value_new=0),i.records[n.index].Writeoff=n.value_new,(i.get(i.getSelection()).PaymwentBaseType=="ARR"||i.get(i.getSelection()).PaymwentBaseType=="APP")&&(n.value_new>i.get(i.getSelection()).ConvertedAmt?(i.get(i.getSelection()).ConvertedAmt<0?i.get(n.recid).changes.Discount==undefined&&i.get(n.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)>0?(i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Discount))).toFixed(t),i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Discount))).toFixed(t)):(i.get(n.recid).changes.VA009_RecivedAmt=(-1*(-1*i.get(i.getSelection()).ConvertedAmt+(n.value_new+i.get(i.getSelection()).OverUnder+i.get(i.getSelection()).Discount))).toFixed(t),i.get(n.recid).VA009_RecivedAmt=(-1*(-1*i.get(i.getSelection()).ConvertedAmt+(n.value_new+i.get(i.getSelection()).OverUnder+i.get(i.getSelection()).Discount))).toFixed(t)):i.get(n.recid).changes.Discount==undefined?VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)>0?(i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Discount))).toFixed(t),i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Discount))).toFixed(t)):(i.get(n.recid).changes.VA009_RecivedAmt=(-1*(-1*i.get(i.getSelection()).ConvertedAmt+(n.value_new+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)+i.get(i.getSelection()).Discount))).toFixed(t),i.get(n.recid).VA009_RecivedAmt=(-1*(-1*i.get(i.getSelection()).ConvertedAmt+(n.value_new+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)+i.get(i.getSelection()).Discount))).toFixed(t)):i.get(n.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)>0?(i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Discount))).toFixed(t),i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Discount))).toFixed(t)):(i.get(n.recid).changes.VA009_RecivedAmt=(-1*(-1*i.get(i.getSelection()).ConvertedAmt+(n.value_new+i.get(i.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Discount)))).toFixed(t),i.get(n.recid).VA009_RecivedAmt=(-1*(-1*i.get(i.getSelection()).ConvertedAmt+(n.value_new+i.get(i.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Discount)))).toFixed(t)):VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)>0?(i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Discount))).toFixed(t),i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Discount))).toFixed(t)):(i.get(n.recid).changes.VA009_RecivedAmt=(-1*(-1*i.get(i.getSelection()).ConvertedAmt+(n.value_new+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Discount)))).toFixed(t),i.get(n.recid).VA009_RecivedAmt=(-1*(-1*i.get(i.getSelection()).ConvertedAmt+(n.value_new+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Discount)))).toFixed(t)):VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)>0?(i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Discount))).toFixed(t),i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Discount))).toFixed(t)):(i.get(n.recid).changes.VA009_RecivedAmt=(n.value_new-i.get(i.getSelection()).ConvertedAmt).toFixed(t),i.get(n.recid).VA009_RecivedAmt=(n.value_new-i.get(i.getSelection()).ConvertedAmt).toFixed(t)),i.refreshCell(n.recid,"VA009_RecivedAmt"),i.refreshCell(n.recid,"OverUnder")):n.value_new<=i.get(i.getSelection()).ConvertedAmt&&(i.get(n.recid).changes.Discount==undefined&&i.get(n.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)>0?(i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Discount))).toFixed(t),i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Discount))).toFixed(t)):(i.get(n.recid).changes.VA009_RecivedAmt=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).OverUnder+i.get(i.getSelection()).Discount)).toFixed(t),i.get(n.recid).VA009_RecivedAmt=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).OverUnder+i.get(i.getSelection()).Discount)).toFixed(t)):i.get(n.recid).changes.Discount==undefined?VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)>0?(i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Discount))).toFixed(t),i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Discount))).toFixed(t)):(i.get(n.recid).changes.VA009_RecivedAmt=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)+i.get(i.getSelection()).Discount)).toFixed(t),i.get(n.recid).VA009_RecivedAmt=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)+i.get(i.getSelection()).Discount)).toFixed(t)):i.get(n.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)>0?(i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Discount))).toFixed(t),i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Discount))).toFixed(t)):(i.get(n.recid).changes.VA009_RecivedAmt=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Discount))).toFixed(t),i.get(n.recid).VA009_RecivedAmt=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).OverUnder+i.get(n.recid).changes.Discount)).toFixed(t)):VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)>0?(i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Discount))).toFixed(t),i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Discount))).toFixed(t)):(i.get(n.recid).changes.VA009_RecivedAmt=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Discount))).toFixed(t),i.get(n.recid).VA009_RecivedAmt=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Discount))).toFixed(t)),i.refreshCell(n.recid,"VA009_RecivedAmt"),i.refreshCell(n.recid,"OverUnder"))));n.column==9&&(n.value_new==""&&(n.value_new=0),i.records[n.index].Discount=n.value_new,(i.get(i.getSelection()).PaymwentBaseType=="ARR"||i.get(i.getSelection()).PaymwentBaseType=="APP")&&(n.value_new>i.get(i.getSelection()).ConvertedAmt?(i.get(i.getSelection()).ConvertedAmt<0?i.get(n.recid).changes.Writeoff==undefined&&i.get(n.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)>0?(i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff))).toFixed(t),i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff))).toFixed(t)):(i.get(n.recid).changes.VA009_RecivedAmt=(-1*(-1*i.get(i.getSelection()).ConvertedAmt+(n.value_new+i.get(i.getSelection()).OverUnder+i.get(i.getSelection()).Writeoff))).toFixed(t),i.get(n.recid).VA009_RecivedAmt=(-1*(-1*i.get(i.getSelection()).ConvertedAmt+(n.value_new+i.get(i.getSelection()).OverUnder+i.get(i.getSelection()).Writeoff))).toFixed(t)):i.get(n.recid).changes.Writeoff==undefined?VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)>0?(i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff))).toFixed(t),i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff))).toFixed(t)):(i.get(n.recid).changes.VA009_RecivedAmt=(-1*(-1*i.get(i.getSelection()).ConvertedAmt+(n.value_new+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)+i.get(i.getSelection()).Writeoff))).toFixed(t),i.get(n.recid).VA009_RecivedAmt=(-1*(-1*i.get(i.getSelection()).ConvertedAmt+(n.value_new+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)+i.get(i.getSelection()).Writeoff))).toFixed(t)):i.get(n.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)>0?(i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff))).toFixed(t),i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff))).toFixed(t)):(i.get(n.recid).changes.VA009_RecivedAmt=(-1*(-1*i.get(i.getSelection()).ConvertedAmt+(n.value_new+i.get(i.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff)))).toFixed(t),i.get(n.recid).VA009_RecivedAmt=(-1*(-1*i.get(i.getSelection()).ConvertedAmt+(n.value_new+i.get(i.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff)))).toFixed(t)):VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)>0?(i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff))).toFixed(t),i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff))).toFixed(t)):(i.get(n.recid).changes.VA009_RecivedAmt=(-1*(-1*i.get(i.getSelection()).ConvertedAmt+(n.value_new+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff)))).toFixed(t),i.get(n.recid).VA009_RecivedAmt=(-1*(-1*i.get(i.getSelection()).ConvertedAmt+(n.value_new+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff)))).toFixed(t)):VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)>0?(i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff))).toFixed(t),i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff))).toFixed(t)):(i.get(n.recid).changes.VA009_RecivedAmt=(n.value_new-i.get(i.getSelection()).ConvertedAmt).toFixed(t),i.get(n.recid).VA009_RecivedAmt=(n.value_new-i.get(i.getSelection()).ConvertedAmt).toFixed(t)),i.refreshCell(n.recid,"VA009_RecivedAmt"),i.refreshCell(n.recid,"OverUnder")):n.value_new<=i.get(i.getSelection()).ConvertedAmt&&(i.get(n.recid).changes.Writeoff==undefined&&i.get(n.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)>0?(i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff))).toFixed(t),i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff))).toFixed(t)):(i.get(n.recid).changes.VA009_RecivedAmt=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).OverUnder+i.get(i.getSelection()).Writeoff)).toFixed(t),i.get(n.recid).VA009_RecivedAmt=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).OverUnder+i.get(i.getSelection()).Writeoff)).toFixed(t)):i.get(n.recid).changes.Writeoff==undefined?VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)>0?(i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff))).toFixed(t),i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff))).toFixed(t)):(i.get(n.recid).changes.VA009_RecivedAmt=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)+i.get(i.getSelection()).Writeoff)).toFixed(t),i.get(n.recid).VA009_RecivedAmt=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)+i.get(i.getSelection()).Writeoff)).toFixed(t)):i.get(n.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)>0?(i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff))).toFixed(t),i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff))).toFixed(t)):(i.get(n.recid).changes.VA009_RecivedAmt=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff))).toFixed(t),i.get(n.recid).VA009_RecivedAmt=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff))).toFixed(t)):VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)>0?(i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff))).toFixed(t),i.get(n.recid).changes.OverUnder=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+i.get(i.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff))).toFixed(t)):(i.get(n.recid).changes.VA009_RecivedAmt=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff))).toFixed(t),i.get(n.recid).VA009_RecivedAmt=(i.get(i.getSelection()).ConvertedAmt-(n.value_new+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(i.get(n.recid).changes.Writeoff))).toFixed(t)),i.refreshCell(n.recid,"VA009_RecivedAmt"),i.refreshCell(n.recid,"OverUnder"))))}n.column==10&&(i.records[n.index].CheckNumber=n.value_new);n.column==11&&(i.records[n.index].CheckDate=n.value_new);n.column==2&&(i.records[n.index].Description=n.value_new)},100)}});i.hideColumn("recid");i.hideColumn("TransactionType")}function et(){$POP_cmbBank=it.find("#VA009_POP_cmbBank_"+u.windowNo);$POP_cmbBankAccount=it.find("#VA009_POP_cmbBankAccount_"+u.windowNo);$POP_txtAccttNo=it.find("#VA009_AccountBalance"+u.windowNo);$POP_txtChqNo=it.find("#VA009_Chqnotxt_"+u.windowNo);wr=it.find("#VA009_btnPopupGrid");$POp_cmbPaySelectn=it.find("#VA009_POP_cmbPaySelectn_"+u.windowNo);$pop_cmbCurrencyType=it.find("#VA009_POP_cmbCurrencyType_"+u.windowNo);$POP_PayMthd=it.find("#VA009_POP_cmbPaymthd_"+u.windowNo);$POPtxtCheckNumber=it.find("#VA009_POP_textCheckNo_"+u.windowNo);b=it.find("#VA009_AccountDate_"+u.windowNo);$POP_Consolidate=it.find("#VA009_chkConsolidate_"+u.windowNo);ct=it.find("#VA009_TransactionDate"+u.windowNo)}function ot(){function n(n){if(n.length>0)for(var t in n)$POP_PayMthd.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].VA009_PaymentMethod_ID)+">"+VIS.Utility.encodeText(n[t].VA009_Name)+"<\/option>");$POP_PayMthd.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadChequePaymentMethod",null,n)}function st(n){t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetPopUpData",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{InvPayids:o.toString(),bank_id:c,acctno:d,chkno:VIS.Utility.encodeText(_Cheque_no),OrderPayids:l.toString()},success:function(t){n(t)},error:function(){e[0].style.visibility="hidden";VIS.ADialog.error("VA009_ErrorLoadingPayments")}})}function ht(n){var r,u,t;v=[];r=JSON.parse(n);ut=r;for(u in r)t={},t.recid=r[u].recid,t.C_Bpartner=r[u].C_Bpartner,t.C_Invoice_ID=r[u].C_Invoice_ID,t.C_BPartner_ID=r[u].C_BPartner_ID,t.C_InvoicePaySchedule_ID=r[u].C_InvoicePaySchedule_ID,t.CurrencyCode=r[u].CurrencyCode,t.DueAmt=r[u].DueAmt,t.VA009_RecivedAmt=r[u].DueAmt,t.OverUnder="0",t.Writeoff="0",t.Discount="0",t.ConvertedAmt=r[u].DueAmt,t.C_Currency_ID=r[u].C_Currency_ID,t.AD_Org_ID=r[u].AD_Org_ID,t.AD_Client_ID=r[u].AD_Client_ID,t.CheckDate=(new Date).toString("MM/DD/YYYY"),t.CheckNumber=null,t.ValidMonths=null,t.VA009_PaymentMode=r[u].VA009_PaymentMode,t.PaymwentBaseType=r[u].PaymwentBaseType,t.TransactionType=r[u].TransactionType,t.DocBaseType=r[u].DocBaseType,v.push(t);w2utils.encodeTags(v);i.add(v);e[0].style.visibility="hidden"}function lt(){function n(n){if($pop_cmbCurrencyType.append("<option value='0'><\/option>"),n.length>0){for(var t in n)$pop_cmbCurrencyType.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>"),VIS.Utility.encodeText(n[t].IsDefault)=="Y"&&(at=VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID));$pop_cmbCurrencyType.val(at)}}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/loadCurrencyType",null,n)}function n(n){return n?"#FFB6C1":"White"}function g(n){var r,u,t;i.clear();v=[];r=JSON.parse(n);ut=r;for(u in r)t={},t.recid=r[u].recid,t.C_Bpartner=r[u].C_Bpartner,t.C_Invoice_ID=r[u].C_Invoice_ID,t.C_BPartner_ID=r[u].C_BPartner_ID,t.C_InvoicePaySchedule_ID=r[u].C_InvoicePaySchedule_ID,t.CurrencyCode=r[u].CurrencyCode,t.DueAmt=r[u].DueAmt,t.VA009_RecivedAmt=r[u].convertedAmt,t.OverUnder="0",t.Writeoff="0",t.Discount="0",t.ConvertedAmt=r[u].convertedAmt,t.C_Currency_ID=r[u].C_Currency_ID,t.AD_Org_ID=r[u].AD_Org_ID,t.AD_Client_ID=r[u].AD_Client_ID,t.CheckDate=(new Date).toString("MM/DD/YYYY"),t.CheckNumber=null,t.ValidMonths=null,t.VA009_PaymentMode=r[u].VA009_PaymentMode,t.PaymwentBaseType=r[u].PaymwentBaseType,t.TransactionType=r[u].TransactionType,t.DocBaseType=r[u].DocBaseType,v.push(t);r[0].ERROR=="ConversionNotFound"&&VIS.ADialog.info("VA009_ConversionNotFound");w2utils.encodeTags(v);i.add(v)}function vt(n){n=JSON.parse(n);a.find(".VA009-payment-wrap").remove();f.find(".VA009-right-data-main").remove();f.find(".VA009-accordion").remove();y=1;o=[];l=[];p=[];k=[];w();e[0].style.visibility="hidden";VIS.ADialog.info("",null,n,null)}function yt(n){if(n=JSON.parse(n),a.find(".VA009-payment-wrap").remove(),f.find(".VA009-right-data-main").remove(),f.find(".VA009-accordion").remove(),y=1,o=[],l=[],p=[],k=[],w(),e[0].style.visibility="hidden",n!="")VIS.ADialog.info("",null,n,null);else{var i=new VIS.Apps.AForms.VPayPrint,t=new VIS.CFrame;t.setName(VIS.Msg.getMsg("Check Print"));t.setTitle(VIS.Msg.getMsg("Check Print"));t.hideHeader(!0);t.setContent(i);t.show();i.initialize()}}function nt(){_Cheque=null;$cheque=null;it=null;STAT_cmbBank=null;STAT_cmbBankAccount=null;STAT_txtStatementNo=null;STAT_ctrlLoadFile=null;STAT_ctrlLoadFileTxt=null;i.destroy()}var c,d,s,r,h;wr;_Cheque_no="";c=0;d=0;e[0].style.visibility="visible";it=t("<div class='VA009-popform-content' style='min-height:450px !important'>");s="";s+="<div class='VA009-popfrm-wrap'> <div class='VA009-popCheck-data'><label>"+VIS.Msg.getMsg("VA009_Bank")+"<\/label><select id='VA009_POP_cmbBank_"+u.windowNo+"'><\/select><\/div> <div class='VA009-popCheck-data'><label>"+VIS.Msg.getMsg("VA009_BankAccount")+"<\/label><select id='VA009_POP_cmbBankAccount_"+u.windowNo+"'><\/select><\/div><div class='VA009-popCheck-data'><label>"+VIS.Msg.getMsg("VA009_AccountBalance")+"<\/label><input type='text' style='background-color: #ededed;' id='VA009_AccountBalance"+u.windowNo+"' disabled/> <\/div><div class='VA009-popCheck-data'><label>"+VIS.Msg.getMsg("VA009_Chqnolbl")+"<\/label><input type='text' style='background-color: #ededed;' id='VA009_Chqnotxt_"+u.windowNo+"' disabled/> <\/div><div class='VA009-popCheck-data'><label>"+VIS.Msg.getMsg("VA009_PaymentSelection")+"<\/label><select id='VA009_POP_cmbPaySelectn_"+u.windowNo+'\'> <option value="M">'+VIS.Msg.getMsg("VA009_PayManully")+'<\/option> <option value="P">'+VIS.Msg.getMsg("VA009_PayPrint")+"<\/option><\/select><\/div><div class='VA009-popCheck-data'><label>"+VIS.Msg.getMsg("VA009_CurrencyType")+"<\/label><select id='VA009_POP_cmbCurrencyType_"+u.windowNo+"'><\/select><\/div><div class='VA009-popCheck-data' id='VA009_POP_textCheckNoDiv'><label><div style=' padding-left: 0 !important;'><div style=\"padding-left: 0; \"><input type=\"checkbox\" style=\"float: left;\" id=\"VA009_chkConsolidate_"+u.windowNo+'"> <label style="margin-bottom: 0;font-weight: normal;">'+VIS.Msg.getMsg("VA009_ConsolidateCheck")+"<\/label><\/div><\/div><\/label><input type='text' style='background-color: #ededed;' placeholder='"+VIS.Msg.getMsg("VA009_ChkNo")+"' disabled id='VA009_POP_textCheckNo_"+u.windowNo+"'><\/div> <div class='VA009-popCheck-data'><label>"+VIS.Msg.getMsg("AccountDate")+"<\/label><input type='date' id='VA009_AccountDate_"+u.windowNo+"' style='height: 30px;border-radius: 0;'> <\/div><div class='VA009-popCheck-data'><label>"+VIS.Msg.getMsg("TransactionDate")+"<\/label><input type='date' id='VA009_TransactionDate"+u.windowNo+"' > <\/div><div style='display: none !important' class='VA009-popCheck-data'><label>"+VIS.Msg.getMsg("VA009_PayMthd")+"<\/label><select id='VA009_POP_cmbPaymthd_"+u.windowNo+"'><\/select><\/div><div class='VA009-grid-container'><div class='VA009-table-container' id='VA009_btnPopupGrid'><\/div><\/div><\/div>";it.append(s);et();r=new Date;h=r.getFullYear()+"-"+("0"+(r.getMonth()+1)).slice(-2)+"-"+("0"+r.getDate()).slice(-2);b.val(h);ct.val(h);wt=new VIS.ChildDialog;wt.setContent(it);wt.setTitle(VIS.Msg.getMsg("VA009_LoadChequePayment"));wt.setWidth("80%");wt.setEnableResize(!0);wt.setModal(!0);(o.toString()!=""||l.toString()!="")&&tt("");$POP_cmbBank.on("change",function(){function t(n){if($POP_cmbBankAccount.append("<option value='0'><\/option>"),n!=null&&n.length>0)for(var t in n)$POP_cmbBankAccount.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_BankAccount_ID)+">"+VIS.Utility.encodeText(n[t].AccountNo)+"<\/option>")}$POP_cmbBankAccount.empty();$POP_cmbBank.val()=="0"?($POP_cmbBank.css("background-color",n(!0)),$POP_cmbBankAccount.css("background-color",n(!0))):$POP_cmbBank.css("background-color",n(!1));$POP_txtAccttNo.val("");$POP_txtChqNo.val("");VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadBankAccount",{Bank_ID:$POP_cmbBank.val(),Orgs:[]},t)});$POP_cmbBankAccount.on("change",function(){function i(t){$POP_cmbBankAccount.val()=="0"?$POP_cmbBankAccount.css("background-color",n(!0)):$POP_cmbBankAccount.css("background-color",n(!1));t!=null&&($POP_txtAccttNo.val(Globalize.format(t.CurrentBalance,"N")),$POP_txtChqNo.val(t.CurrentNext));t==null&&($POP_txtAccttNo.val("0"),$POP_txtChqNo.val("0"))}$POP_cmbBankAccount.val()=="0"?$POP_cmbBankAccount.css("background-color",n(!0)):$POP_cmbBankAccount.css("background-color",n(!1));$POP_txtAccttNo.val("");$POP_txtChqNo.val("");VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/GetBankAccountData",{BankAccount:$POP_cmbBankAccount.val()},i);t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetConvertedAmt",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(ut),BankAccount:$POP_cmbBankAccount.val(),CurrencyType:$pop_cmbCurrencyType.val()},success:function(n){g(n)},error:function(n){console.log(n);VIS.ADialog.error("VA009_ErrorLoadingPayments")}})});$pop_cmbCurrencyType.on("change",function(){t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetConvertedAmt",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(ut),BankAccount:$POP_cmbBankAccount.val(),CurrencyType:$pop_cmbCurrencyType.val()},success:function(n){g(n)},error:function(n){console.log(n);VIS.ADialog.error("VA009_ErrorLoadingPayments")}})});$POP_Consolidate.on("click",function(i){var r=t(i.target);i.target.type=="checkbox"&&(r.prop("checked")==!0?($POPtxtCheckNumber.removeAttr("disabled"),$POPtxtCheckNumber.css("background-color","white"),$POPtxtCheckNumber.css("background-color",n(!0))):($POPtxtCheckNumber.val(""),$POPtxtCheckNumber.attr("disabled","disabled"),$POPtxtCheckNumber.css("background-color",n(!1)),$POPtxtCheckNumber.css("background-color","#ededed")))});$POPtxtCheckNumber.on("change",function(){var u,r,t;if($POPtxtCheckNumber.val()=="")$POPtxtCheckNumber.css("background-color",n(!0));else{for($POPtxtCheckNumber.css("background-color",n(!1)),wr=it.find("#VA009_btnPopupGrid"),u=[],r=[],t=0;t<i.records.length;t++)u.indexOf(i.records[t].C_BPartner_ID)<0?(u.push(i.records[t].C_BPartner_ID),t==0?(i.records[t].CheckNumber=$POPtxtCheckNumber.val(),r.push($POPtxtCheckNumber.val())):(i.records[t].CheckNumber=VIS.Utility.Util.getValueOfInt(r[r.length-1])+1,r.push(VIS.Utility.Util.getValueOfInt(r[r.length-1])+1))):u.indexOf(i.records[t].C_BPartner_ID)>-1?i.records[t].CheckNumber=r[u.indexOf(i.records[t].C_BPartner_ID)]:console.log("Skip"),i.refreshCell(i.records[t].recid,"CheckNumber");console.log("BPartner IDS =  "+u)}});$POp_cmbPaySelectn.on("change",function(){var n;if($POp_cmbPaySelectn.val()=="P")for($POP_Consolidate.prop("cheched",!1),$POP_Consolidate.attr("disabled","disabled"),$POPtxtCheckNumber.val(""),n=0;n<i.records.length;n++){if(i.records[n].TransactionType=="Order")return VIS.ADialog.info("VA009_CannotPrintOrder"),$POp_cmbPaySelectn.val("M"),!1;i.records[n].CheckNumber="";i.records[n].CheckDate=null;i.refreshCell(i.records[n].recid,"CheckNumber");i.refreshCell(i.records[n].recid,"CheckDate")}else $POP_Consolidate.removeAttr("disabled")});wt.onOkClick=function(){var u=[],h,n,r,c,f,o,s;if(i.selectAll(),h=0,i.getSelection().length>0)if(VIS.Utility.Util.getValueOfInt($POP_cmbBank.val())>0)if(VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val())>0)if(VIS.Utility.Util.getValueOfInt($POP_PayMthd.val())>0)if(b.val()!=""&&b.val()!=null)for(n=0;n<i.getSelection().length;n++){if(r={},c=0,r.C_BPartner_ID=i.get(i.getSelection()[n]).C_BPartner_ID,r.Description=i.get(i.getSelection()[n]).Description,r.C_Invoice_ID=i.get(i.getSelection()[n]).C_Invoice_ID,r.AD_Org_ID=i.get(i.getSelection()[n]).AD_Org_ID,r.AD_Client_ID=i.get(i.getSelection()[n]).AD_Client_ID,r.C_InvoicePaySchedule_ID=i.get(i.getSelection()[n]).C_InvoicePaySchedule_ID,r.C_BankAccount_ID=VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val()),r.C_Currency_ID=i.get(i.getSelection()[n]).C_Currency_ID,r.DueAmt=i.get(i.getSelection()[n]).DueAmt,r.ConvertedAmt=i.get(i.getSelection()[n]).ConvertedAmt,r.PaymwentBaseType=i.get(i.getSelection()[n]).PaymwentBaseType,r.TransactionType=i.get(i.getSelection()[n]).TransactionType,i.get(i.getSelection()[n]).VA009_RecivedAmt!=null&&i.get(i.getSelection()[n]).VA009_RecivedAmt!="")r.VA009_RecivedAmt=i.get(i.getSelection()[n]).VA009_RecivedAmt;else return VIS.ADialog.info("VA009_PLPayAmt"),i.selectNone(),!1;if(r.OverUnder=i.get(i.getSelection()[n]).OverUnder,r.Writeoff=i.get(i.getSelection()[n]).Writeoff,r.Discount=i.get(i.getSelection()[n]).Discount,r.DateTrx=VIS.Utility.Util.getValueOfDate(ct.val()),r.DateAcct=VIS.Utility.Util.getValueOfDate(b.val()),r.From="Pay",$POp_cmbPaySelectn.val()=="M"){if(i.get(i.getSelection()[n]).CheckDate!=""&&i.get(i.getSelection()[n]).CheckDate!=null){if(f=new Date(i.get(i.getSelection()[n]).CheckDate),f=new Date(f.setHours(0,0,0,0)),o=new Date(b.val()),o=new Date(o.setHours(0,0,0,0)),f>o)return VIS.ADialog.info("VIS_CheckDateCantbeGreaterSys"),i.selectNone(),!1;r.CheckDate=VIS.Utility.Util.getValueOfDate(i.get(i.getSelection()[n]).CheckDate)}else return VIS.ADialog.info("VA009_PLCheckDate"),i.selectNone(),!1;if(i.get(i.getSelection()[n]).CheckNumber!=""&&i.get(i.getSelection()[n]).CheckNumber!=null)r.CheckNumber=i.get(i.getSelection()[n]).CheckNumber;else return VIS.ADialog.info("VA009_PLCheckNumber"),i.selectNone(),!1}if(i.get(i.getSelection()[n]).VA009_RecivedAmt==0)return VIS.ADialog.info("VA009_PLRecivedAmt"),i.selectNone(),!1;if(r.CurrencyType=$pop_cmbCurrencyType.val(),r.VA009_PaymentMethod_ID=$POP_PayMthd.val(),n>0&&(s=t.grep(u,function(t){return i.get(i.getSelection()[n]).C_BPartner_ID==t.C_BPartner_ID&&i.get(i.getSelection()[n]).CheckNumber==t.CheckNumber&&i.get(i.getSelection()[n]).TransactionType!=t.TransactionType}),s&&s.length>0))return VIS.ADialog.info("VA009_SameCheckNo"),i.selectNone(),!1;u.push(r)}else return VIS.ADialog.info("VA009_PLSelectAcctDate"),i.selectNone(),!1;else return VIS.ADialog.info("VA009_PLSelectPaymentMethod"),i.selectNone(),!1;else return VIS.ADialog.info("VA009_PLSelectBankAccount"),i.selectNone(),!1;else return VIS.ADialog.info("VA009_PLSelectBank"),i.selectNone(),!1;$POp_cmbPaySelectn.val()=="M"?(e[0].style.visibility="visible",t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GeneratePayments",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(u)},success:function(n){vt(n)},error:function(n){console.log(n);e[0].style.visibility="hidden";VIS.ADialog.error("VA009_ErrorLoadingPayments")}})):$POp_cmbPaySelectn.val()=="P"&&(e[0].style.visibility="visible",t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GeneratePaymentsBatchOfRule",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(u)},success:function(n){yt(n)},error:function(n){console.log(n);e[0].style.visibility="hidden";VIS.ADialog.error("VA009_ErrorLoadingPayments")}}))};wt.onCancelCLick=function(){i.clear();nt()};wt.onClose=function(){i.clear();nt()}},Cheque_Rec_Dialog:function(){function tt(n){n!=""?(e[0].style.visibility="hidden",VIS.ADialog.info("VA009_PleaseSelctonlyCheque")):(bt.show(),ot(),dr($RPOP_cmbBank,rt),$RPOP_cmbBank.css("background-color",i(!0)),$RPOP_cmbBankAccount.css("background-color",i(!0)),b.css("background-color",i(!0)),st(ht),ft(),et())}function it(){$RPOP_cmbBank=lt.find("#VA009_POP_cmbBank_"+u.windowNo);$RPOP_cmbBankAccount=lt.find("#VA009_POP_cmbBankAccount_"+u.windowNo);$POP_PayMthd=lt.find("#VA009_POP_cmbPaymthd_"+u.windowNo);pr=lt.find("#VA009_btnPopupRecGrid");$pop_cmbCurrencyType=lt.find("#VA009_POP_cmbCurrencyType_"+u.windowNo);b=lt.find("#VA009_AccountDate_"+u.windowNo);ct=lt.find("#VA009_TransactionDate"+u.windowNo)}function ft(){function n(n){if($pop_cmbCurrencyType.append("<option value='0'><\/option>"),n.length>0){for(var t in n)$pop_cmbCurrencyType.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>"),VIS.Utility.encodeText(n[t].IsDefault)=="Y"&&(at=VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID));$pop_cmbCurrencyType.val(at)}}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/loadCurrencyType",null,n)}function et(){function n(n){if(n.length>1&&$POP_PayMthd.append(" <option value = 0><\/option>"),n.length>0)for(var t in n)$POP_PayMthd.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].VA009_PaymentMethod_ID)+">"+VIS.Utility.encodeText(n[t].VA009_Name)+"<\/option>");$POP_PayMthd.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadChequePaymentMethod",null,n)}function i(n){return n?"#FFB6C1":"White"}function g(t){var r,u,i;n.clear();v=[];r=JSON.parse(t);ut=r;for(u in r)i={},i.recid=r[u].recid,i.C_Bpartner=r[u].C_Bpartner,i.C_Invoice_ID=r[u].C_Invoice_ID,i.C_BPartner_ID=r[u].C_BPartner_ID,i.C_InvoicePaySchedule_ID=r[u].C_InvoicePaySchedule_ID,i.CurrencyCode=r[u].CurrencyCode,i.DueAmt=r[u].DueAmt,i.VA009_RecivedAmt=r[u].convertedAmt,i.OverUnder="0",i.Writeoff="0",i.Discount="0",i.ConvertedAmt=r[u].convertedAmt,i.C_Currency_ID=r[u].C_Currency_ID,i.AD_Org_ID=r[u].AD_Org_ID,i.AD_Client_ID=r[u].AD_Client_ID,i.CheckDate=(new Date).toString("MM/DD/YYYY"),i.CheckNumber=null,i.ValidMonths=null,i.VA009_PaymentMode=r[u].VA009_PaymentMode,i.PaymwentBaseType=r[u].PaymwentBaseType,i.TransactionType=r[u].TransactionType,i.DocBaseType=r[u].DocBaseType,v.push(i);r[0].ERROR=="ConversionNotFound"&&VIS.ADialog.info("VA009_ConversionNotFound");w2utils.encodeTags(v);n.add(v)}function ot(){v=[];var t=[];t.length==0&&(t.push({field:"C_Bpartner",caption:VIS.Msg.getMsg("VA009_BPartner"),sortable:!0,size:"12%"}),t.push({field:"C_InvoicePaySchedule_ID",caption:VIS.Msg.getMsg("VA009_Schedule"),sortable:!0,size:"8%"}),t.push({field:"Description",caption:VIS.Msg.getMsg("Description"),sortable:!0,size:"15%",editable:{type:"text"}}),t.push({field:"CurrencyCode",caption:VIS.Msg.getMsg("VA009_Currency"),sortable:!0,size:"8%"}),t.push({field:"DueAmt",caption:VIS.Msg.getMsg("VA009_DueAmt"),sortable:!0,size:"12%",render:"float:2"}),t.push({field:"ConvertedAmt",caption:VIS.Msg.getMsg("VA009_ConvertedAmt"),sortable:!0,size:"12%",render:"float:2"}),t.push({field:"VA009_RecivedAmt",caption:VIS.Msg.getMsg("VA009_ReceivedAmt"),sortable:!0,size:"12%",render:"float:2",editable:{type:"float"}}),t.push({field:"OverUnder",caption:VIS.Msg.getMsg("VA009_OverUnder"),sortable:!0,size:"8%",render:"float:2"}),t.push({field:"Writeoff",caption:VIS.Msg.getMsg("VA009_Writeoff"),sortable:!0,size:"8%",render:"float:2",editable:{type:"float"}}),t.push({field:"Discount",caption:VIS.Msg.getMsg("VA009_Discount"),sortable:!0,size:"8%",render:"float:2",editable:{type:"float"}}),t.push({field:"CheckNumber",caption:VIS.Msg.getMsg("VA009_ChkNo"),sortable:!0,size:"8%",editable:{type:"text"}}),t.push({field:"CheckDate",caption:VIS.Msg.getMsg("VA009_CheckDate"),sortable:!0,size:"10%",render:"date",style:"text-align: left",editable:{type:"date"}}),t.push({field:"recid",caption:VIS.Msg.getMsg("VA009_srno"),sortable:!0,size:"1%"}),t.push({field:"TransactionType",caption:VIS.Msg.getMsg("VA009_TransactionType"),sortable:!0,size:"1%"}));n=null;n=pr.w2grid({name:"CheueRecevableGrid_"+VIS.Env.getWindowNo(),recordHeight:25,columns:t,method:"GET",multiSelect:!0,show:{toolbarSave:!0},onEditField:function(t){(t.column==6||t.column==8||t.column==9)&&n.get(t.recid).TransactionType=="Order"&&(t.isCancelled=!0)},onChange:function(t){window.setTimeout(function(){if(n.getChanges(t.recid)!=undefined){var i=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/GetCurrencyPrecision",{BankAccount_ID:$RPOP_cmbBankAccount.val(),CurrencyFrom:"B"},null);if(t.column==6){if(t.value_new==""&&(t.value_new=0),t.value_new>n.records[t.index].ConvertedAmt){VIS.ADialog.error("MoreScheduleAmount");t.value_new=t.value_original;n.get(t.recid).changes.VA009_RecivedAmt=t.value_new;n.get(t.recid).VA009_RecivedAmt=t.value_new;n.refreshCell(t.recid,"VA009_RecivedAmt");return}n.records[t.index].VA009_RecivedAmt=t.value_new;(n.get(n.getSelection()).PaymwentBaseType=="ARR"||n.get(n.getSelection()).PaymwentBaseType=="APP")&&(t.value_new>n.get(n.getSelection()).ConvertedAmt?(n.get(n.getSelection()).ConvertedAmt>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-t.value_new).toFixed(i),n.get(t.recid).OverUnder=n.get(t.recid).changes.OverUnder,n.get(t.recid).changes.Writeoff=0):(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-t.value_new).toFixed(i),n.get(t.recid).OverUnder=n.get(t.recid).changes.OverUnder,n.get(t.recid).changes.Writeoff=0,n.get(t.recid).Writeoff=0),n.get(t.recid).changes.Discount=0,n.refreshCell(t.recid,"OverUnder"),n.refreshCell(t.recid,"Discount"),n.refreshCell(t.recid,"Writeoff")):t.value_new==n.get(n.getSelection()).ConvertedAmt?(n.get(t.recid).changes.OverUnder=0,n.get(t.recid).OverUnder=0,n.get(t.recid).changes.Discount=0,n.get(t.recid).changes.Writeoff=0,n.get(t.recid).Discount=0,n.get(t.recid).Writeoff=0,n.get(t.recid).changes.VA009_RecivedAmt=t.value_new,n.get(t.recid).VA009_RecivedAmt=t.value_new,n.refreshCell(t.recid,"OverUnder"),n.refreshCell(t.recid,"Discount"),n.refreshCell(t.recid,"Writeoff"),n.refreshCell(t.recid,"VA009_RecivedAmt")):t.value_new<n.get(n.getSelection()).ConvertedAmt&&(n.get(n.getSelection()).ConvertedAmt>0?n.get(t.recid).TransactionType=="Order"?(n.get(t.recid).changes.Discount=(n.get(n.getSelection()).ConvertedAmt-t.value_new).toFixed(i),n.get(t.recid).Discount=n.get(t.recid).changes.Discount,n.get(t.recid).changes.Writeoff=0,n.get(t.recid).Writeoff=0,n.get(t.recid).changes.OverUnder=0,n.get(t.recid).OverUnder=0):(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-t.value_new).toFixed(i),n.get(t.recid).OverUnder=n.get(t.recid).changes.OverUnder,n.get(t.recid).changes.Writeoff=0,n.get(t.recid).Writeoff=0,n.get(t.recid).changes.Discount=0,n.get(t.recid).Discount=0):n.get(t.recid).TransactionType=="Order"?(n.get(t.recid).changes.Discount=(n.get(n.getSelection()).ConvertedAmt-t.value_new).toFixed(i),n.get(t.recid).Discount=n.get(t.recid).changes.Discount,n.get(t.recid).changes.Writeoff=0,n.get(t.recid).Writeoff=0,n.get(t.recid).changes.OverUnder=0,n.get(t.recid).OverUnder=0):(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-t.value_new).toFixed(i),n.get(t.recid).OverUnder=n.get(t.recid).changes.OverUnder,n.get(t.recid).changes.Writeoff=0,n.get(t.recid).Writeoff=0,n.get(t.recid).changes.Discount=0,n.get(t.recid).Discount=0),n.refreshCell(t.recid,"OverUnder"),n.refreshCell(t.recid,"Discount"),n.refreshCell(t.recid,"Writeoff")))}t.column==8&&(t.value_new==""&&(t.value_new=0),n.records[t.index].Writeoff=t.value_new,n.get(n.getSelection()).PaymwentBaseType=="APP"?t.value_new>n.get(n.getSelection()).ConvertedAmt?(n.get(t.recid).changes.VA009_RecivedAmt=((t.value_new-n.get(n.getSelection()).ConvertedAmt)*-1).toFixed(i),n.get(t.recid).VA009_RecivedAmt=((t.value_new-n.get(n.getSelection()).ConvertedAmt)*-1).toFixed(i),n.refreshCell(t.recid,"VA009_RecivedAmt")):t.value_new<n.get(n.getSelection()).ConvertedAmt&&(n.get(t.recid).changes.Discount==undefined&&n.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i),n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i)):(n.get(t.recid).changes.VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).OverUnder+n.get(n.getSelection()).Discount)).toFixed(i),n.get(t.recid).VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).OverUnder+n.get(n.getSelection()).Discount)).toFixed(i)):n.get(t.recid).changes.Discount==undefined?VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i),n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i)):(n.get(t.recid).changes.VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder)+n.get(n.getSelection()).Discount)).toFixed(i),n.get(t.recid).VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder)+n.get(n.getSelection()).Discount)).toFixed(i)):n.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i),n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i)):(n.get(t.recid).changes.VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i),n.get(t.recid).VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i)):VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i),n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i)):(n.get(t.recid).changes.VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i),n.get(t.recid).VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i)),n.refreshCell(t.recid,"VA009_RecivedAmt"),n.refreshCell(t.recid,"OverUnder")):n.get(n.getSelection()).PaymwentBaseType=="ARR"&&(t.value_new>n.get(n.getSelection()).ConvertedAmt?(n.get(n.getSelection()).ConvertedAmt<0?n.get(t.recid).changes.Discount==undefined&&n.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i),n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i)):(n.get(t.recid).changes.VA009_RecivedAmt=(-1*(-1*n.get(n.getSelection()).ConvertedAmt+(t.value_new+n.get(n.getSelection()).OverUnder+n.get(n.getSelection()).Discount))).toFixed(i),n.get(t.recid).VA009_RecivedAmt=(-1*(-1*n.get(n.getSelection()).ConvertedAmt+(t.value_new+n.get(n.getSelection()).OverUnder+n.get(n.getSelection()).Discount))).toFixed(i)):n.get(t.recid).changes.Discount==undefined?VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i),n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i)):(n.get(t.recid).changes.VA009_RecivedAmt=(-1*(-1*n.get(n.getSelection()).ConvertedAmt+(t.value_new+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder)+n.get(n.getSelection()).Discount))).toFixed(i),n.get(t.recid).VA009_RecivedAmt=(-1*(-1*n.get(n.getSelection()).ConvertedAmt+(t.value_new+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder)+n.get(n.getSelection()).Discount))).toFixed(i)):n.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i),n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i)):(n.get(t.recid).changes.VA009_RecivedAmt=(-1*(-1*n.get(n.getSelection()).ConvertedAmt+(t.value_new+n.get(n.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount)))).toFixed(i),n.get(t.recid).VA009_RecivedAmt=(-1*(-1*n.get(n.getSelection()).ConvertedAmt+(t.value_new+n.get(n.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount)))).toFixed(i)):VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i),n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i)):(n.get(t.recid).changes.VA009_RecivedAmt=(-1*(-1*n.get(n.getSelection()).ConvertedAmt+(t.value_new+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount)))).toFixed(i),n.get(t.recid).VA009_RecivedAmt=(-1*(-1*n.get(n.getSelection()).ConvertedAmt+(t.value_new+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount)))).toFixed(i)):VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i),n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i)):(n.get(t.recid).changes.VA009_RecivedAmt=(t.value_new-n.get(n.getSelection()).ConvertedAmt).toFixed(i),n.get(t.recid).VA009_RecivedAmt=(t.value_new-n.get(n.getSelection()).ConvertedAmt).toFixed(i)),n.refreshCell(t.recid,"VA009_RecivedAmt"),n.refreshCell(t.recid,"OverUnder")):t.value_new<=n.get(n.getSelection()).ConvertedAmt&&(n.get(t.recid).changes.Discount==undefined&&n.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i),n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i)):(n.get(t.recid).changes.VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).OverUnder+n.get(n.getSelection()).Discount)).toFixed(i),n.get(t.recid).VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).OverUnder+n.get(n.getSelection()).Discount)).toFixed(i)):n.get(t.recid).changes.Discount==undefined?VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i),n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i)):(n.get(t.recid).changes.VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder)+n.get(n.getSelection()).Discount)).toFixed(i),n.get(t.recid).VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder)+n.get(n.getSelection()).Discount)).toFixed(i)):n.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i),n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i)):(n.get(t.recid).changes.VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i),n.get(t.recid).VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i)):VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i),n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i)):(n.get(t.recid).changes.VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i),n.get(t.recid).VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Discount))).toFixed(i)),n.refreshCell(t.recid,"VA009_RecivedAmt"),n.refreshCell(t.recid,"OverUnder"))));t.column==9&&(t.value_new==""&&(t.value_new=0),n.records[t.index].Discount=t.value_new,n.get(n.getSelection()).PaymwentBaseType=="APP"?t.value_new>n.get(n.getSelection()).ConvertedAmt?(n.get(t.recid).changes.VA009_RecivedAmt=((t.value_new-n.get(n.getSelection()).ConvertedAmt)*-1).toFixed(i),n.get(t.recid).VA009_RecivedAmt=((t.value_new-n.get(n.getSelection()).ConvertedAmt)*-1).toFixed(i),n.refreshCell(t.recid,"VA009_RecivedAmt")):t.value_new<n.get(n.getSelection()).ConvertedAmt&&(n.get(t.recid).changes.Writeoff==undefined&&n.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).Writeoff))).toFixed(i),n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).Writeoff))).toFixed(i)):(n.get(t.recid).changes.VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).OverUnder+n.get(n.getSelection()).Writeoff)).toFixed(i),n.get(t.recid).VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).OverUnder+n.get(n.getSelection()).Writeoff)).toFixed(i)):n.get(t.recid).changes.Writeoff==undefined?VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).Writeoff))).toFixed(i),n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).Writeoff))).toFixed(i)):(n.get(t.recid).changes.VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder)+n.get(n.getSelection()).Writeoff)).toFixed(i),n.get(t.recid).VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder)+n.get(n.getSelection()).Writeoff)).toFixed(i)):n.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).Writeoff))).toFixed(i),n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).Writeoff))).toFixed(i)):(n.get(t.recid).changes.VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Writeoff))).toFixed(i),n.get(t.recid).VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Writeoff))).toFixed(i)):VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).Writeoff))).toFixed(i),n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).Writeoff))).toFixed(i)):(n.get(t.recid).changes.VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Writeoff))).toFixed(i),n.get(t.recid).VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Writeoff))).toFixed(i)),n.refreshCell(t.recid,"VA009_RecivedAmt"),n.refreshCell(t.recid,"OverUnder")):n.get(n.getSelection()).PaymwentBaseType=="ARR"&&(t.value_new>n.get(n.getSelection()).ConvertedAmt?(n.get(n.getSelection()).ConvertedAmt<0?n.get(t.recid).changes.Writeoff==undefined&&n.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).Writeoff))).toFixed(i),n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).Writeoff))).toFixed(i)):(n.get(t.recid).changes.VA009_RecivedAmt=(-1*(-1*n.get(n.getSelection()).ConvertedAmt+(t.value_new+n.get(n.getSelection()).OverUnder+n.get(n.getSelection()).Writeoff))).toFixed(i),n.get(t.recid).VA009_RecivedAmt=(-1*(-1*n.get(n.getSelection()).ConvertedAmt+(t.value_new+n.get(n.getSelection()).OverUnder+n.get(n.getSelection()).Writeoff))).toFixed(i)):n.get(t.recid).changes.Writeoff==undefined?VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).Writeoff))).toFixed(i),n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).Writeoff))).toFixed(i)):(n.get(t.recid).changes.VA009_RecivedAmt=(-1*(-1*n.get(n.getSelection()).ConvertedAmt+(t.value_new+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder)+n.get(n.getSelection()).Writeoff))).toFixed(i),n.get(t.recid).VA009_RecivedAmt=(-1*(-1*n.get(n.getSelection()).ConvertedAmt+(t.value_new+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder)+n.get(n.getSelection()).Writeoff))).toFixed(i)):n.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).Writeoff))).toFixed(i),n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).Writeoff))).toFixed(i)):(n.get(t.recid).changes.VA009_RecivedAmt=(-1*(-1*n.get(n.getSelection()).ConvertedAmt+(t.value_new+n.get(n.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Writeoff)))).toFixed(i),n.get(t.recid).VA009_RecivedAmt=(-1*(-1*n.get(n.getSelection()).ConvertedAmt+(t.value_new+n.get(n.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Writeoff)))).toFixed(i)):VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).Writeoff))).toFixed(i),n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).Writeoff))).toFixed(i)):(n.get(t.recid).changes.VA009_RecivedAmt=(-1*(-1*n.get(n.getSelection()).ConvertedAmt+(t.value_new+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Writeoff)))).toFixed(i),n.get(t.recid).VA009_RecivedAmt=(-1*(-1*n.get(n.getSelection()).ConvertedAmt+(t.value_new+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Writeoff)))).toFixed(i)):VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).Writeoff))).toFixed(i),n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).Writeoff))).toFixed(i)):(n.get(t.recid).changes.VA009_RecivedAmt=(t.value_new-n.get(n.getSelection()).ConvertedAmt).toFixed(i),n.get(t.recid).VA009_RecivedAmt=(t.value_new-n.get(n.getSelection()).ConvertedAmt).toFixed(i)),n.refreshCell(t.recid,"VA009_RecivedAmt"),n.refreshCell(t.recid,"OverUnder")):t.value_new<=n.get(n.getSelection()).ConvertedAmt&&(n.get(t.recid).changes.Writeoff==undefined&&n.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).Writeoff))).toFixed(i),n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).Writeoff))).toFixed(i)):(n.get(t.recid).changes.VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).OverUnder+n.get(n.getSelection()).Writeoff)).toFixed(i),n.get(t.recid).VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).OverUnder+n.get(n.getSelection()).Writeoff)).toFixed(i)):n.get(t.recid).changes.Writeoff==undefined?VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).Writeoff))).toFixed(i),n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).Writeoff))).toFixed(i)):(n.get(t.recid).changes.VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder)+n.get(n.getSelection()).Writeoff)).toFixed(i),n.get(t.recid).VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder)+n.get(n.getSelection()).Writeoff)).toFixed(i)):n.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).Writeoff))).toFixed(i),n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).Writeoff))).toFixed(i)):(n.get(t.recid).changes.VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Writeoff))).toFixed(i),n.get(t.recid).VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Writeoff))).toFixed(i)):VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).Writeoff))).toFixed(i),n.get(t.recid).changes.OverUnder=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+n.get(n.getSelection()).VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.get(n.getSelection()).Writeoff))).toFixed(i)):(n.get(t.recid).changes.VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Writeoff))).toFixed(i),n.get(t.recid).VA009_RecivedAmt=(n.get(n.getSelection()).ConvertedAmt-(t.value_new+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Writeoff))).toFixed(i)),n.refreshCell(t.recid,"VA009_RecivedAmt"),n.refreshCell(t.recid,"OverUnder"))))}t.column==10&&(n.records[t.index].CheckNumber=t.value_new);t.column==11&&(n.records[t.index].CheckDate=t.value_new);t.column==2&&(n.records[t.index].Description=t.value_new)},100)}});n.hideColumn("recid");n.hideColumn("TransactionType")}function st(n){t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetPopUpData",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{InvPayids:o.toString(),bank_id:c,acctno:d,chkno:VIS.Utility.encodeText(_Cheque_no),OrderPayids:l.toString()},success:function(t){n(t)},error:function(){e[0].style.visibility="hidden";VIS.ADialog.error("VA009_ErrorLoadingPayments")}})}function ht(t){var r,u,i;v=[];r=JSON.parse(t);ut=r;for(u in r)i={},i.recid=r[u].recid,i.C_Bpartner=r[u].C_Bpartner,i.C_Invoice_ID=r[u].C_Invoice_ID,i.C_BPartner_ID=r[u].C_BPartner_ID,i.C_InvoicePaySchedule_ID=r[u].C_InvoicePaySchedule_ID,i.CurrencyCode=r[u].CurrencyCode,i.DueAmt=r[u].DueAmt,i.VA009_RecivedAmt=r[u].DueAmt,i.OverUnder="0",i.Writeoff="0",i.Discount="0",i.ConvertedAmt=r[u].DueAmt,i.C_Currency_ID=r[u].C_Currency_ID,i.AD_Org_ID=r[u].AD_Org_ID,i.AD_Client_ID=r[u].AD_Client_ID,i.CheckDate=(new Date).toString("MM/DD/YYYY"),i.CheckNumber=null,i.ValidMonths=null,i.VA009_PaymentMode=r[u].VA009_PaymentMode,i.TransactionType=r[u].TransactionType,i.PaymwentBaseType=r[u].PaymwentBaseType,v.push(i);w2utils.encodeTags(v);n.add(v);e[0].style.visibility="hidden"}function vt(n){n=JSON.parse(n);a.find(".VA009-payment-wrap").remove();f.find(".VA009-right-data-main").remove();f.find(".VA009-accordion").remove();y=1;o=[];l=[];p=[];k=[];w();e[0].style.visibility="hidden";VIS.ADialog.info("",null,n,null)}function nt(){r=null;lt=null;STAT_cmbBank=null;STAT_cmbBankAccount=null;STAT_txtStatementNo=null;STAT_ctrlLoadFile=null;STAT_ctrlLoadFileTxt=null;n.destroy()}var c,d,r,s,h;pr;_Cheque_no="";c=0;d=0;e[0].style.visibility="visible";lt=t("<div class='VA009-popform-content' style='min-height:385px !important'>");r="";r+="<div class='VA009-popfrm-wrap' style='height:auto;'> <div class='VA009-popCheck-data'><label>"+VIS.Msg.getMsg("VA009_Bank")+"<\/label><select id='VA009_POP_cmbBank_"+u.windowNo+"'><\/select><\/div> <div class='VA009-popCheck-data'><label>"+VIS.Msg.getMsg("VA009_BankAccount")+"<\/label><select id='VA009_POP_cmbBankAccount_"+u.windowNo+"'><\/select><\/div><div class='VA009-popCheck-data'><label>"+VIS.Msg.getMsg("VA009_CurrencyType")+"<\/label><select id='VA009_POP_cmbCurrencyType_"+u.windowNo+"'><\/select><\/div><div class='VA009-popCheck-data'><label>"+VIS.Msg.getMsg("VA009_PayMthd")+"<\/label><select id='VA009_POP_cmbPaymthd_"+u.windowNo+"'><\/select><\/div><div class='VA009-popCheck-data'><label>"+VIS.Msg.getMsg("AccountDate")+"<\/label><input type='date' id='VA009_AccountDate_"+u.windowNo+"' style='height: 30px;border-radius: 0;'> <\/div><div class='VA009-popCheck-data'><label>"+VIS.Msg.getMsg("TransactionDate")+"<\/label><input type='date' id='VA009_TransactionDate"+u.windowNo+"' > <\/div><div class='VA009-grid-container'><div class='VA009-table-container' id='VA009_btnPopupRecGrid'><\/div><\/div>";lt.append(r);it();s=new Date;h=s.getFullYear()+"-"+("0"+(s.getMonth()+1)).slice(-2)+"-"+("0"+s.getDate()).slice(-2);b.val(h);ct.val(h);bt=new VIS.ChildDialog;bt.setContent(lt);bt.setTitle(VIS.Msg.getMsg("VA009_LoadChequePaymentRec"));bt.setWidth("80%");bt.setEnableResize(!0);bt.setModal(!0);(o.toString()!=""||l.toString()!="")&&tt("");$RPOP_cmbBank.on("change",function(){function n(n){if($RPOP_cmbBankAccount.append("<option value='0'><\/option>"),n!=null&&n.length>0)for(var t in n)$RPOP_cmbBankAccount.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_BankAccount_ID)+">"+VIS.Utility.encodeText(n[t].AccountNo)+"<\/option>")}$RPOP_cmbBankAccount.empty();$RPOP_cmbBank.val()=="0"?($RPOP_cmbBank.css("background-color",i(!0)),$RPOP_cmbBankAccount.css("background-color",i(!0))):$RPOP_cmbBank.css("background-color",i(!1));VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadBankAccount",{Bank_ID:$RPOP_cmbBank.val(),Orgs:[]},n)});$RPOP_cmbBankAccount.on("change",function(){$RPOP_cmbBankAccount.val()=="0"?$RPOP_cmbBankAccount.css("background-color",i(!0)):$RPOP_cmbBankAccount.css("background-color",i(!1));t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetConvertedAmt",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(ut),BankAccount:$RPOP_cmbBankAccount.val(),CurrencyType:$pop_cmbCurrencyType.val()},success:function(n){g(n)},error:function(n){console.log(n);VIS.ADialog.error("VA009_ErrorLoadingPayments")}})});$pop_cmbCurrencyType.on("change",function(){t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetConvertedAmt",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(ut),BankAccount:$RPOP_cmbBankAccount.val(),CurrencyType:$pop_cmbCurrencyType.val()},success:function(n){g(n)},error:function(n){console.log(n);VIS.ADialog.error("VA009_ErrorLoadingPayments")}})});bt.onOkClick=function(){var o=[],i,r,s,u,f;if(n.sort(["C_BPartner_ID","CheckNumber"],"asc"),n.selectAll(),n.getSelection().length>0)if(VIS.Utility.Util.getValueOfInt($RPOP_cmbBank.val())>0)if(VIS.Utility.Util.getValueOfInt($RPOP_cmbBankAccount.val())>0)if(VIS.Utility.Util.getValueOfInt($POP_PayMthd.val())>0)if(b.val()!=""&&b.val()!=null)for(i=0;i<n.getSelection().length;i++){if(r={},s=0,r.C_BPartner_ID=n.get(n.getSelection()[i]).C_BPartner_ID,r.Description=n.get(n.getSelection()[i]).Description,r.C_Invoice_ID=n.get(n.getSelection()[i]).C_Invoice_ID,r.AD_Org_ID=n.get(n.getSelection()[i]).AD_Org_ID,r.AD_Client_ID=n.get(n.getSelection()[i]).AD_Client_ID,r.C_Currency_ID=n.get(n.getSelection()[i]).C_Currency_ID,r.C_InvoicePaySchedule_ID=n.get(n.getSelection()[i]).C_InvoicePaySchedule_ID,r.TransactionType=n.get(n.getSelection()[i]).TransactionType,n.get(n.getSelection()[i]).CheckDate!=""){if(u=new Date(n.get(n.getSelection()[i]).CheckDate),u=new Date(u.setHours(0,0,0,0)),f=new Date(b.val()),f=new Date(f.setHours(0,0,0,0)),u>f)return VIS.ADialog.info("VIS_CheckDateCantbeGreaterSys"),n.selectNone(),!1;r.CheckDate=VIS.Utility.Util.getValueOfDate(n.get(n.getSelection()[i]).CheckDate)}else return VIS.ADialog.info("VA009_PLCheckDate"),n.selectNone(),!1;if(r.DateTrx=VIS.Utility.Util.getValueOfDate(ct.val()),r.DateAcct=VIS.Utility.Util.getValueOfDate(b.val()),r.C_BankAccount_ID=VIS.Utility.Util.getValueOfInt($RPOP_cmbBankAccount.val()),r.C_Bank_ID=VIS.Utility.Util.getValueOfInt($RPOP_cmbBank.val()),r.DueAmt=n.get(n.getSelection()[i]).DueAmt,r.ConvertedAmt=n.get(n.getSelection()[i]).ConvertedAmt,r.PaymwentBaseType=n.get(n.getSelection()[i]).PaymwentBaseType,r.OverUnder=n.get(n.getSelection()[i]).OverUnder,r.Discount=n.get(n.getSelection()[i]).Discount,r.Writeoff=n.get(n.getSelection()[i]).Writeoff,r.From="Rec",n.get(n.getSelection()[i]).CheckNumber!=null&&n.get(n.getSelection()[i]).CheckNumber!="")r.CheckNumber=n.get(n.getSelection()[i]).CheckNumber;else return VIS.ADialog.info("VA009_PLCheckNumber"),n.selectNone(),!1;if(n.get(n.getSelection()[i]).VA009_RecivedAmt!=null&&n.get(n.getSelection()[i]).VA009_RecivedAmt!="")r.VA009_RecivedAmt=n.get(n.getSelection()[i]).VA009_RecivedAmt;else return VIS.ADialog.info("VA009_PLRecivedAmt"),n.selectNone(),!1;r.CurrencyType=$pop_cmbCurrencyType.val();r.VA009_PaymentMethod_ID=$POP_PayMthd.val();o.push(r)}else return VIS.ADialog.info("VA009_PLSelectAcctDate"),n.selectNone(),!1;else return VIS.ADialog.info("VA009_PLSelectPaymentMethod"),n.selectNone(),!1;else return VIS.ADialog.info("VA009_PLSelectBankAccount"),n.selectNone(),!1;else return VIS.ADialog.info("VA009_PLSelectBank"),n.selectNone(),!1;e[0].style.visibility="visible";t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GeneratePayments",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(o)},success:function(n){vt(n)},error:function(n){console.log(n);e[0].style.visibility="hidden";VIS.ADialog.error("VA009_ErrorLoadingPayments")}})};bt.onCancelCLick=function(){n.clear();nt()};bt.onClose=function(){n.clear();nt()}},Cash_Dialog:function(){function ot(){function n(n){if($pop_cmbCurrencyType.append("<option value='0'><\/option>"),n.length>0){for(var t in n)$pop_cmbCurrencyType.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>"),VIS.Utility.encodeText(n[t].IsDefault)=="Y"&&(at=VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID));$pop_cmbCurrencyType.val(at)}}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/loadCurrencyType",null,n)}function h(n){return n?"#FFB6C1":"White"}function st(){var n=[];n.length==0&&(n.push({field:"C_Bpartner",caption:VIS.Msg.getMsg("VA009_BPartner"),sortable:!0,size:"15%"}),n.push({field:"Description",caption:VIS.Msg.getMsg("Description"),sortable:!0,size:"15%",editable:{type:"text"}}),n.push({field:"CurrencyCode",caption:VIS.Msg.getMsg("VA009_Currency"),sortable:!0,size:"8%"}),n.push({field:"DueAmt",caption:VIS.Msg.getMsg("VA009_DueAmt"),sortable:!0,size:"12%",render:"float:2"}),n.push({field:"ConvertedAmt",caption:VIS.Msg.getMsg("VA009_ConvertedAmt"),sortable:!0,size:"13%",render:"float:2"}),n.push({field:"VA009_RecivedAmt",caption:VIS.Msg.getMsg("VA009_ReceivedAmt"),sortable:!0,size:"12%",render:"float:2",editable:{type:"float"}}),n.push({field:"OverUnder",caption:VIS.Msg.getMsg("VA009_OverUnder"),sortable:!0,size:"9%",render:"float:2"}),n.push({field:"Writeoff",caption:VIS.Msg.getMsg("VA009_Writeoff"),sortable:!0,size:"9%",render:"float:2",editable:{type:"float"}}),n.push({field:"Discount",caption:VIS.Msg.getMsg("VA009_Discount"),sortable:!0,size:"9%",render:"float:2",editable:{type:"float"}}),n.push({field:"recid",caption:VIS.Msg.getMsg("VA009_srno"),sortable:!0,size:"1%"}));r=null;r=g.w2grid({name:"CashGrid",recordHeight:25,columns:n,method:"GET",multiSelect:!0,onEditField:function(n){(n.column==6||n.column==8||n.column==9)&&r.get(n.recid).TransactionType=="Order"&&(n.isCancelled=!0)}});r.hideColumn("recid")}function ht(){function n(n){if($Cash_cmbcashbk.css("background-color",h(!0)),$Cash_cmbcashbk.append("<option value='0'><\/option>"),n.length>0)for(var t in n)$Cash_cmbcashbk.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_CashBook_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>");$Cash_cmbcashbk.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadCashBook",{Orgs:rt.toString()},n)}function lt(){$Cash_cmbcashbk=$cash.find("#VA009_POP_Txtcashbk_"+u.windowNo);$Cash_OpngBal=$cash.find("#VA009_POP_Txtopngbal_"+u.windowNo);g=$cash.find("#VA009_btnPopupGrid");$pop_cmbCurrencyType=$cash.find("#VA009_POP_cmbCurrencyType_"+u.windowNo);b=$cash.find("#VA009_AccountDate_"+u.windowNo);b.css("background-color",h(!0));ct=$cash.find("#VA009_TransactionDate"+u.windowNo)}function vt(n){t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetPopUpData",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{InvPayids:o.toString(),bank_id:ft,acctno:et,chkno:VIS.Utility.encodeText(it)},success:function(t){n(t)},error:function(){e[0].style.visibility="hidden";VIS.ADialog.error("VA009_ErrorLoadingPayments")}})}function d(n){var i,u,t;r.clear();v=[];i=JSON.parse(n);ut=i;for(u in i)t={},t.recid=i[u].recid,t.C_Bpartner=i[u].C_Bpartner,t.C_Invoice_ID=i[u].C_Invoice_ID,t.C_InvoicePaySchedule_ID=i[u].C_InvoicePaySchedule_ID,t.CurrencyCode=i[u].CurrencyCode,t.DueAmt=i[u].DueAmt,t.C_BPartner_ID=i[u].C_BPartner_ID,t.C_Currency_ID=i[u].C_Currency_ID,t.AD_Org_ID=i[u].AD_Org_ID,t.AD_Client_ID=i[u].AD_Client_ID,t.VA009_PaymentMode=i[u].VA009_PaymentMode,t.ConvertedAmt=i[u].convertedAmt,t.PaymwentBaseType=i[u].PaymwentBaseType,t.OverUnder="0",t.Writeoff="0",t.Discount="0",t.VA009_RecivedAmt=i[u].convertedAmt,v.push(t);i[0].ERROR=="ConversionNotFound"&&VIS.ADialog.info("VA009_ConversionNotFound");w2utils.encodeTags(v);r.add(v);e[0].style.visibility="hidden"}function yt(n){n=JSON.parse(n);a.find(".VA009-payment-wrap").remove();f.find(".VA009-right-data-main").remove();f.find(".VA009-accordion").remove();y=1;o=[];l=[];p=[];k=[];w();e[0].style.visibility="hidden";VIS.ADialog.info("",null,n,null)}function tt(){i=null;$cash=null;STAT_cmbBank=null;STAT_cmbBankAccount=null;STAT_txtStatementNo=null;STAT_ctrlLoadFile=null;STAT_ctrlLoadFileTxt=null;w2ui.CashGrid.destroy()}var g,it="",ft=0,et=0,i,s,c,n,nt;e[0].style.visibility="visible";$cash=t("<div class='VA009-popform-content' style='min-height:385px !important'>");i="";i+="<div class='VA009-popfrm-wrap'> <div class='VA009-popform-data'><label>"+VIS.Msg.getMsg("VA009_lblcashbook")+"<\/label><select id='VA009_POP_Txtcashbk_"+u.windowNo+"'> <\/select><\/div> <div class='VA009-popform-data'><label>"+VIS.Msg.getMsg("VA009_lblopngbal")+"<\/label><input type='text' id='VA009_POP_Txtopngbal_"+u.windowNo+"' disabled/> <\/div><div class='VA009-popform-data'><label>"+VIS.Msg.getMsg("VA009_CurrencyType")+"<\/label><select id='VA009_POP_cmbCurrencyType_"+u.windowNo+"'><\/select><\/div><div class='VA009-popform-data'><label>"+VIS.Msg.getMsg("AccountDate")+"<\/label><input type='date' id='VA009_AccountDate_"+u.windowNo+"' style='height: 30px;border-radius: 0;'> <\/div><div class='VA009-popform-data'><label>"+VIS.Msg.getMsg("TransactionDate")+"<\/label><input type='date' id='VA009_TransactionDate"+u.windowNo+"' > <\/div><div class='VA009-table-container' id='VA009_btnPopupGrid'>  <\/div><\/div>";$cash.append(i);lt();s=new Date;c=s.getFullYear()+"-"+("0"+(s.getMonth()+1)).slice(-2)+"-"+("0"+s.getDate()).slice(-2);b.val(c);ct.val(c);n=new VIS.ChildDialog;n.setContent($cash);n.setTitle(VIS.Msg.getMsg("VA009_LoadCashPayment"));n.setWidth("60%");n.setEnableResize(!0);n.setModal(!0);o.toString()!=""&&(nt=null,nt==null?(n.show(),st(),vt(d),ht(),ot()):(e[0].style.visibility="hidden",VIS.ADialog.info("VA009_PleaseSelctonlyCash")));$Cash_cmbcashbk.on("change",function(){function i(i){i!=null&&($Cash_OpngBal.val(i.CompletedBalance),n=i.C_Currency_ID,nf=n);window.setTimeout(function(){t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetCashJournalConvertedAmt",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(ut),CurrencyCashBook:n,CurrencyType:$pop_cmbCurrencyType.val()},success:function(n){d(n)},error:function(n){console.log(n);VIS.ADialog.error("VA009_ErrorLoadingPayments")}})},200)}$Cash_OpngBal.val("");$Cash_cmbcashbk.val()=="0"?$Cash_cmbcashbk.css("background-color",h(!0)):$Cash_cmbcashbk.css("background-color",h(!1));VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/GetCashBookData",{CashBook:$Cash_cmbcashbk.val()},i);var n=0});$pop_cmbCurrencyType.on("change",function(){t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetCashJournalConvertedAmt",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(ut),CurrencyCashBook:nf,CurrencyType:$pop_cmbCurrencyType.val()},success:function(n){d(n)},error:function(n){console.log(n);VIS.ADialog.error("VA009_ErrorLoadingPayments")}})});r.on("change",function(n){window.setTimeout(function(){if(w2ui.CashGrid.getChanges(n.recid)!=undefined){var t=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/GetCurrencyPrecision",{BankAccount_ID:$Cash_cmbcashbk.val(),CurrencyFrom:"C"},null);if(n.column==1&&(r.records[n.index].Description=n.value_new),n.column==5){if(n.value_new==""&&(n.value_new=0),n.value_new>r.records[n.index].ConvertedAmt){VIS.ADialog.error("MoreScheduleAmount");n.value_new=n.value_original;r.get(n.recid).changes.VA009_RecivedAmt=n.value_new;r.get(n.recid).VA009_RecivedAmt=n.value_new;r.refreshCell(n.recid,"VA009_RecivedAmt");return}r.records[n.index].VA009_RecivedAmt=n.value_new;(r.get(r.getSelection()).PaymwentBaseType=="ARR"||r.get(r.getSelection()).PaymwentBaseType=="APP")&&(n.value_new>r.get(r.getSelection()).ConvertedAmt?(r.get(r.getSelection()).ConvertedAmt>0?(r.get(n.recid).changes.OverUnder=(r.get(r.getSelection()).ConvertedAmt-n.value_new).toFixed(t),r.get(n.recid).OverUnder=VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.OverUnder),r.get(n.recid).changes.Writeoff=0):(r.get(n.recid).changes.OverUnder=(r.get(r.getSelection()).ConvertedAmt-n.value_new).toFixed(t),r.get(n.recid).OverUnder=VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.OverUnder),r.get(n.recid).changes.Writeoff=0,r.get(n.recid).Writeoff=0),r.get(n.recid).changes.Discount=0,r.refreshCell(n.recid,"OverUnder"),r.refreshCell(n.recid,"Discount"),r.refreshCell(n.recid,"Writeoff")):n.value_new==r.get(r.getSelection()).ConvertedAmt?(r.get(n.recid).changes.OverUnder=0,r.get(n.recid).OverUnder=0,r.get(n.recid).changes.Discount=0,r.get(n.recid).changes.Writeoff=0,r.get(n.recid).Discount=0,r.get(n.recid).Writeoff=0,r.get(n.recid).changes.VA009_RecivedAmt=n.value_new,r.get(n.recid).VA009_RecivedAmt=n.value_new,r.refreshCell(n.recid,"OverUnder"),r.refreshCell(n.recid,"Discount"),r.refreshCell(n.recid,"Writeoff"),r.refreshCell(n.recid,"VA009_RecivedAmt")):n.value_new<r.get(r.getSelection()).ConvertedAmt&&(r.get(r.getSelection()).ConvertedAmt>0?(r.get(n.recid).changes.OverUnder=(r.get(r.getSelection()).ConvertedAmt-n.value_new).toFixed(t),r.get(n.recid).OverUnder=VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.OverUnder),r.get(n.recid).changes.Writeoff=0,r.get(n.recid).Writeoff=0):(r.get(n.recid).changes.Writeoff=0,r.get(n.recid).Writeoff=0,r.get(n.recid).changes.OverUnder=(r.get(r.getSelection()).ConvertedAmt-n.value_new).toFixed(t),r.get(n.recid).OverUnder=VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.OverUnder)),r.get(n.recid).changes.Discount=0,r.get(n.recid).Discount=0,r.refreshCell(n.recid,"OverUnder"),r.refreshCell(n.recid,"Discount"),r.refreshCell(n.recid,"Writeoff")))}n.column==7&&(n.value_new==""&&(n.value_new=0),r.records[n.index].Writeoff=n.value_new,(r.get(r.getSelection()).PaymwentBaseType=="ARR"||r.get(r.getSelection()).PaymwentBaseType=="APP")&&(n.value_new>r.get(r.getSelection()).ConvertedAmt?(r.get(r.getSelection()).ConvertedAmt<0?r.get(n.recid).changes.Discount==undefined&&r.get(n.recid).changes.OverUnder==undefined?(w2ui.CashGrid.get(n.recid).changes.VA009_RecivedAmt=(-1*(-1*r.get(r.getSelection()).ConvertedAmt+(n.value_new+r.get(r.getSelection()).OverUnder+r.get(r.getSelection()).Discount))).toFixed(t),w2ui.CashGrid.get(n.recid).VA009_RecivedAmt=(-1*(-1*r.get(r.getSelection()).ConvertedAmt+(n.value_new+r.get(r.getSelection()).OverUnder+r.get(r.getSelection()).Discount))).toFixed(t)):r.get(n.recid).changes.Discount==undefined?(w2ui.CashGrid.get(n.recid).changes.VA009_RecivedAmt=(-1*(-1*r.get(r.getSelection()).ConvertedAmt+(n.value_new+parseFloat(r.get(n.recid).changes.OverUnder)+r.get(r.getSelection()).Discount))).toFixed(t),w2ui.CashGrid.get(n.recid).VA009_RecivedAmt=(-1*(-1*r.get(r.getSelection()).ConvertedAmt+(n.value_new+parseFloat(r.get(n.recid).changes.OverUnder)+r.get(r.getSelection()).Discount))).toFixed(t)):r.get(n.recid).changes.OverUnder==undefined?(w2ui.CashGrid.get(n.recid).changes.VA009_RecivedAmt=(-1*(-1*r.get(r.getSelection()).ConvertedAmt+(n.value_new+r.get(r.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.Discount)))).toFixed(t),w2ui.CashGrid.get(n.recid).VA009_RecivedAmt=(-1*(-1*r.get(r.getSelection()).ConvertedAmt+(n.value_new+r.get(r.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.Discount)))).toFixed(t)):(r.get(n.recid).changes.VA009_RecivedAmt=(-1*(-1*r.get(r.getSelection()).ConvertedAmt+(n.value_new+parseFloat(r.get(n.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.Discount)))).toFixed(t),r.get(n.recid).VA009_RecivedAmt=(-1*(-1*r.get(r.getSelection()).ConvertedAmt+(n.value_new+parseFloat(r.get(n.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.Discount)))).toFixed(t)):(r.get(n.recid).changes.VA009_RecivedAmt=(n.value_new-r.get(r.getSelection()).ConvertedAmt).toFixed(t),r.get(n.recid).VA009_RecivedAmt=(n.value_new-r.get(r.getSelection()).ConvertedAmt).toFixed(t)),r.refreshCell(n.recid,"VA009_RecivedAmt")):n.value_new<=r.get(r.getSelection()).ConvertedAmt&&(r.get(n.recid).changes.Writeoff||(r.get(n.recid).changes.Writeoff=0),r.get(n.recid).changes.Discount==undefined&&r.get(n.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(r.get(r.getSelection()).OverUnder)>0?(w2ui.CashGrid.get(n.recid).changes.OverUnder=(r.get(r.getSelection()).ConvertedAmt-(n.value_new+r.get(r.getSelection()).VA009_RecivedAmt+r.get(r.getSelection()).Discount)).toFixed(t),w2ui.CashGrid.get(n.recid).OverUnder=(r.get(r.getSelection()).ConvertedAmt-(n.value_new+r.get(r.getSelection()).VA009_RecivedAmt+r.get(r.getSelection()).Discount)).toFixed(t)):(w2ui.CashGrid.get(n.recid).changes.VA009_RecivedAmt=(r.get(r.getSelection()).ConvertedAmt-(n.value_new+r.get(r.getSelection()).OverUnder+r.get(r.getSelection()).Discount)).toFixed(t),w2ui.CashGrid.get(n.recid).VA009_RecivedAmt=(r.get(r.getSelection()).ConvertedAmt-(n.value_new+r.get(r.getSelection()).OverUnder+r.get(r.getSelection()).Discount)).toFixed(t)):r.get(n.recid).changes.Discount==undefined?VIS.Utility.Util.getValueOfDecimal(r.get(r.getSelection()).OverUnder)>0?(w2ui.CashGrid.get(n.recid).changes.OverUnder=(r.get(r.getSelection()).ConvertedAmt-(n.value_new+r.get(r.getSelection()).VA009_RecivedAmt+r.get(r.getSelection()).Discount)).toFixed(t),w2ui.CashGrid.get(n.recid).OverUnder=(r.get(r.getSelection()).ConvertedAmt-(n.value_new+r.get(r.getSelection()).VA009_RecivedAmt+r.get(r.getSelection()).Discount)).toFixed(t)):(w2ui.CashGrid.get(n.recid).changes.VA009_RecivedAmt=(r.get(r.getSelection()).ConvertedAmt-(n.value_new+parseFloat(r.get(n.recid).changes.OverUnder)+r.get(r.getSelection()).Discount)).toFixed(t),w2ui.CashGrid.get(n.recid).VA009_RecivedAmt=(r.get(r.getSelection()).ConvertedAmt-(n.value_new+parseFloat(r.get(n.recid).changes.OverUnder)+r.get(r.getSelection()).Discount)).toFixed(t)):r.get(n.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(r.get(r.getSelection()).OverUnder)>0?(w2ui.CashGrid.get(n.recid).changes.OverUnder=(r.get(r.getSelection()).ConvertedAmt-(n.value_new+r.get(r.getSelection()).VA009_RecivedAmt+r.get(r.getSelection()).Discount)).toFixed(t),w2ui.CashGrid.get(n.recid).OverUnder=(r.get(r.getSelection()).ConvertedAmt-(n.value_new+r.get(r.getSelection()).VA009_RecivedAmt+r.get(r.getSelection()).Discount)).toFixed(t)):(w2ui.CashGrid.get(n.recid).changes.VA009_RecivedAmt=(r.get(r.getSelection()).ConvertedAmt-(n.value_new+r.get(r.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.Discount))).toFixed(t),w2ui.CashGrid.get(n.recid).VA009_RecivedAmt=(r.get(r.getSelection()).ConvertedAmt-(n.value_new+r.get(r.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.Discount))).toFixed(t)):VIS.Utility.Util.getValueOfDecimal(r.get(r.getSelection()).OverUnder)>0?(w2ui.CashGrid.get(n.recid).changes.OverUnder=(r.get(r.getSelection()).ConvertedAmt-(n.value_new+r.get(r.getSelection()).VA009_RecivedAmt+r.get(r.getSelection()).Discount)).toFixed(t),w2ui.CashGrid.get(n.recid).OverUnder=(r.get(r.getSelection()).ConvertedAmt-(n.value_new+r.get(r.getSelection()).VA009_RecivedAmt+r.get(r.getSelection()).Discount)).toFixed(t)):(r.get(n.recid).changes.VA009_RecivedAmt=(r.get(r.getSelection()).ConvertedAmt-(n.value_new+parseFloat(r.get(n.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.Discount))).toFixed(t),r.get(n.recid).VA009_RecivedAmt=(r.get(r.getSelection()).ConvertedAmt-(n.value_new+parseFloat(r.get(n.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.Discount))).toFixed(t)),r.refreshCell(n.recid,"VA009_RecivedAmt"),r.refreshCell(n.recid,"OverUnder"))));n.column==8&&(n.value_new==""&&(n.value_new=0),r.records[n.index].Discount=n.value_new,(r.get(r.getSelection()).PaymwentBaseType=="ARR"||r.get(r.getSelection()).PaymwentBaseType=="APP")&&(n.value_new>r.get(r.getSelection()).ConvertedAmt?(r.get(r.getSelection()).ConvertedAmt<0?r.get(n.recid).changes.Writeoff==undefined&&r.get(n.recid).changes.OverUnder==undefined?(w2ui.CashGrid.get(n.recid).changes.VA009_RecivedAmt=(-1*(-1*VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).ConvertedAmt)+(n.value_new+r.get(r.getSelection()).OverUnder+r.get(r.getSelection()).Writeoff))).toFixed(t),w2ui.CashGrid.get(n.recid).VA009_RecivedAmt=(-1*(-1*VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).ConvertedAmt)+(n.value_new+r.get(r.getSelection()).OverUnder+r.get(r.getSelection()).Writeoff))).toFixed(t)):r.get(n.recid).changes.Writeoff==undefined?(w2ui.CashGrid.get(n.recid).changes.VA009_RecivedAmt=(-1*(-1*VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).ConvertedAmt)+(n.value_new+parseFloat(r.get(n.recid).changes.OverUnder)+r.get(r.getSelection()).Writeoff))).toFixed(t),w2ui.CashGrid.get(n.recid).VA009_RecivedAmt=(-1*(-1*VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).ConvertedAmt)+(n.value_new+parseFloat(r.get(n.recid).changes.OverUnder)+r.get(r.getSelection()).Writeoff))).toFixed(t)):r.get(n.recid).changes.OverUnder==undefined?(w2ui.CashGrid.get(n.recid).changes.VA009_RecivedAmt=(-1*(-1*VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).ConvertedAmt)+(n.value_new+r.get(r.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.Writeoff)))).toFixed(t),w2ui.CashGrid.get(n.recid).VA009_RecivedAmt=(-1*(-1*VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).ConvertedAmt)+(n.value_new+r.get(r.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.Writeoff)))).toFixed(t)):(r.get(n.recid).changes.VA009_RecivedAmt=(-1*(-1*VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).ConvertedAmt)+(n.value_new+parseFloat(r.get(n.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.Writeoff)))).toFixed(t),r.get(n.recid).VA009_RecivedAmt=(-1*(-1*VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).ConvertedAmt)+(n.value_new+parseFloat(r.get(n.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.Writeoff)))).toFixed(t)):(r.get(n.recid).changes.VA009_RecivedAmt=(n.value_new-VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).ConvertedAmt)).toFixed(t),r.get(n.recid).VA009_RecivedAmt=(n.value_new-VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).ConvertedAmt)).toFixed(t)),r.refreshCell(n.recid,"VA009_RecivedAmt")):n.value_new<=r.get(r.getSelection()).ConvertedAmt&&(r.get(n.recid).changes.Writeoff||(r.get(n.recid).changes.Writeoff=0),r.get(n.recid).changes.Writeoff==undefined&&r.get(n.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(r.get(r.getSelection()).OverUnder)>0?(w2ui.CashGrid.get(n.recid).changes.OverUnder=(r.get(r.getSelection()).ConvertedAmt-(n.value_new+r.get(r.getSelection()).VA009_RecivedAmt+r.get(r.getSelection()).Writeoff)).toFixed(t),w2ui.CashGrid.get(n.recid).OverUnder=(r.get(r.getSelection()).ConvertedAmt-(n.value_new+r.get(r.getSelection()).VA009_RecivedAmt+r.get(r.getSelection()).Writeoff)).toFixed(t)):(w2ui.CashGrid.get(n.recid).changes.VA009_RecivedAmt=(VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).ConvertedAmt)-(n.value_new+r.get(r.getSelection()).OverUnder+r.get(r.getSelection()).Writeoff)).toFixed(t),w2ui.CashGrid.get(n.recid).VA009_RecivedAmt=(VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).ConvertedAmt)-(n.value_new+r.get(r.getSelection()).OverUnder+r.get(r.getSelection()).Writeoff)).toFixed(t)):r.get(n.recid).changes.Writeoff==undefined?VIS.Utility.Util.getValueOfDecimal(r.get(r.getSelection()).OverUnder)>0?(w2ui.CashGrid.get(n.recid).changes.OverUnder=(r.get(r.getSelection()).ConvertedAmt-(n.value_new+r.get(r.getSelection()).VA009_RecivedAmt+r.get(r.getSelection()).Writeoff)).toFixed(t),w2ui.CashGrid.get(n.recid).OverUnder=(r.get(r.getSelection()).ConvertedAmt-(n.value_new+r.get(r.getSelection()).VA009_RecivedAmt+r.get(r.getSelection()).Writeoff)).toFixed(t)):(w2ui.CashGrid.get(n.recid).changes.VA009_RecivedAmt=(VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).ConvertedAmt)-(n.value_new+parseFloat(r.get(n.recid).changes.OverUnder)+r.get(r.getSelection()).Writeoff)).toFixed(t),w2ui.CashGrid.get(n.recid).VA009_RecivedAmt=(VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).ConvertedAmt)-(n.value_new+parseFloat(r.get(n.recid).changes.OverUnder)+r.get(r.getSelection()).Writeoff)).toFixed(t)):r.get(n.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(r.get(r.getSelection()).OverUnder)>0?(w2ui.CashGrid.get(n.recid).changes.OverUnder=(r.get(r.getSelection()).ConvertedAmt-(n.value_new+r.get(r.getSelection()).VA009_RecivedAmt+r.get(r.getSelection()).Writeoff)).toFixed(t),w2ui.CashGrid.get(n.recid).OverUnder=(r.get(r.getSelection()).ConvertedAmt-(n.value_new+r.get(r.getSelection()).VA009_RecivedAmt+r.get(r.getSelection()).Writeoff)).toFixed(t)):(w2ui.CashGrid.get(n.recid).changes.VA009_RecivedAmt=(VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).ConvertedAmt)-(n.value_new+r.get(r.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.Writeoff))).toFixed(t),w2ui.CashGrid.get(n.recid).VA009_RecivedAmt=(VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).ConvertedAmt)-(n.value_new+r.get(r.getSelection()).OverUnder+VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.Writeoff))).toFixed(t)):VIS.Utility.Util.getValueOfDecimal(r.get(r.getSelection()).OverUnder)>0?(w2ui.CashGrid.get(n.recid).changes.OverUnder=(r.get(r.getSelection()).ConvertedAmt-(n.value_new+r.get(r.getSelection()).VA009_RecivedAmt+r.get(r.getSelection()).Writeoff)).toFixed(t),w2ui.CashGrid.get(n.recid).OverUnder=(r.get(r.getSelection()).ConvertedAmt-(n.value_new+r.get(r.getSelection()).VA009_RecivedAmt+r.get(r.getSelection()).Writeoff)).toFixed(t)):(r.get(n.recid).changes.VA009_RecivedAmt=(VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).ConvertedAmt)-(n.value_new+parseFloat(r.get(n.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.Writeoff))).toFixed(t),r.get(n.recid).VA009_RecivedAmt=(VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).ConvertedAmt)-(n.value_new+parseFloat(r.get(n.recid).changes.OverUnder)+VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.Writeoff))).toFixed(t)),r.refreshCell(n.recid,"VA009_RecivedAmt"),r.refreshCell(n.recid,"OverUnder"))))}},100)});n.onOkClick=function(){var u=[],n,i;if(r.selectAll(),VIS.Utility.Util.getValueOfInt($Cash_cmbcashbk.val())>0)if(b.val()!=""&&b.val()!=null){if(r.getSelection().length>0)for(n=0;n<r.getSelection().length;n++){if(i={},i.C_BPartner_ID=r.get(r.getSelection()[n]).C_BPartner_ID,i.Description=r.get(r.getSelection()[n]).Description,i.C_Invoice_ID=r.get(r.getSelection()[n]).C_Invoice_ID,i.AD_Org_ID=r.get(r.getSelection()[n]).AD_Org_ID,i.AD_Client_ID=r.get(r.getSelection()[n]).AD_Client_ID,i.C_Currency_ID=r.get(r.getSelection()[n]).C_Currency_ID,i.C_Currency_ID=r.get(r.getSelection()[n]).C_Currency_ID,i.C_InvoicePaySchedule_ID=r.get(r.getSelection()[n]).C_InvoicePaySchedule_ID,r.get(r.getSelection()[n]).VA009_RecivedAmt!=null&&r.get(r.getSelection()[n]).VA009_RecivedAmt>0)i.VA009_RecivedAmt=r.get(r.getSelection()[n]).VA009_RecivedAmt;else return VIS.ADialog.info("VA009_PLRecivedAmt"),r.selectNone(),!1;i.OverUnder=r.get(r.getSelection()[n]).OverUnder;i.Writeoff=r.get(r.getSelection()[n]).Writeoff;i.Discount=r.get(r.getSelection()[n]).Discount;i.ConvertedAmt=r.get(r.getSelection()[n]).ConvertedAmt;i.PaymwentBaseType=r.get(r.getSelection()[n]).PaymwentBaseType;i.CurrencyType=$pop_cmbCurrencyType.val();i.DateAcct=VIS.Utility.Util.getValueOfDate(b.val());i.DateTrx=VIS.Utility.Util.getValueOfDate(ct.val());u.push(i)}e[0].style.visibility="visible";t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GenPaymentsCash",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(u),C_CashBook_ID:parseInt($Cash_cmbcashbk.val()),BeginningBalance:parseFloat($Cash_OpngBal.val())},success:function(n){yt(n)},error:function(n){console.log(n);e[0].style.visibility="hidden";VIS.ADialog.error("VA009_ErrorLoadingPayments")}})}else return VIS.ADialog.info("VA009_PLSelectAcctDate"),r.selectNone(),!1;else return VIS.ADialog.info("VA009_PLSelectCashbook"),r.selectNone(),!1};n.onCancelCLick=function(){w2ui.CashGrid.clear();tt()};n.onClose=function(){w2ui.CashGrid.clear();tt()}},Batch_OpenDialog:function(){function f(){i=null;$opnbatch=null}var i,n,r;$opnbatch=t("<div class='VA009-popform-content' style='min-height:25px !important'>");i="";i+="<div> <div><input type='radio' name='VA009_Sel"+u.windowNo+"'  value='S' checked>&nbsp;&nbsp;"+VIS.Msg.getMsg("VA009_BasedOnSelection")+"<br><br><input type='radio' name='VA009_Sel"+u.windowNo+"'  value='R'>&nbsp;&nbsp;"+VIS.Msg.getMsg("VA009_BasedOnRule")+"<\/div>";$opnbatch.append(i);n=new VIS.ChildDialog;r="";n.setContent($opnbatch);n.setTitle(VIS.Msg.getMsg("VA009_LoadBatchPayment"));n.setWidth("30%");n.setEnableResize(!0);n.setModal(!0);n.show();n.onOkClick=function(){var n,i,t;r=$opnbatch.find("input[name='VA009_Sel"+u.windowNo+"']:checked").val();e[0].style.visibility="visible";r=="S"?o.toString()!=""||l.toString()!=""?et.Batch_Dialog():VIS.ADialog.info("VA009_PlzSelct1Pay"):r=="R"&&(n="SELECT pm.va009_paymentbasetype FROM c_invoicepayschedule cs INNER JOIN va009_paymentmethod pm  ON pm.va009_paymentmethod_id      =cs.va009_paymentmethod_id WHERE cs.c_invoicepayschedule_id IN (",n+=o.length==0?0:o.toString(),n+=" ) AND pm.va009_paymentbasetype  IN ('S','B') GROUP BY pm.va009_paymentbasetype ",i=VIS.secureEngine.encrypt(n),t=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/GetPaymentBaseType",{BatchQry:i},null),t!=null&&t.length>0?VIS.ADialog.info("VA009_CantSelectCashandChque"):vf());e[0].style.visibility="hidden"};n.onCancelCLick=function(){f()};n.onClose=function(){f()}},Batch_Dialog:function(){function tt(){var n=[];n.length==0&&(n.push({field:"recid",caption:VIS.Msg.getMsg("VA009_srno"),sortable:!0,size:"10%"}),n.push({field:"C_Bpartner",caption:VIS.Msg.getMsg("VA009_Vendor"),sortable:!0,size:"10%"}),n.push({field:"C_InvoicePaySchedule_ID",caption:VIS.Msg.getMsg("VA009_Schedule"),sortable:!0,size:"10%"}),n.push({field:"CurrencyCode",caption:VIS.Msg.getMsg("VA009_Currency"),sortable:!0,size:"10%"}),n.push({field:"DueAmt",caption:VIS.Msg.getMsg("VA009_DueAmt"),sortable:!0,size:"10%",render:"float:2"}),n.push({field:"ConvertedAmt",caption:VIS.Msg.getMsg("VA009_ConvertedAmt"),sortable:!0,size:"13%",render:"float:2"}),n.push({field:"CheckNumber",caption:VIS.Msg.getMsg("VA009_ChkNo"),sortable:!0,size:"10%",editable:{type:"text"}}),n.push({field:"CheckDate",caption:VIS.Msg.getMsg("VA009_CheckDate"),sortable:!0,size:"10%",render:"date",style:"text-align: left",editable:{type:"date"}}),n.push({field:"Mandate",caption:VIS.Msg.getMsg("VA009_Mandate"),sortable:!0,size:"10%",editable:{type:"text"}}),n.push({field:"TransactionType",caption:VIS.Msg.getMsg("VA009_TransactionType"),sortable:!0,size:"1%"}));c=null;c=s.w2grid({name:"BatchGrid",recordHeight:25,multiSelect:!0,columns:n});c.hideColumn("recid","CheckNumber","CheckDate","ValidMonths","Mandate","TransactionType")}function it(){$POP_cmbBank=$batch.find("#VA009_POP_cmbBank_"+u.windowNo);$POP_cmbBankAccount=$batch.find("#VA009_POP_cmbBankAccount_"+u.windowNo);$POP_PayMthd=$batch.find("#VA009_POP_cmbPaymthd_"+u.windowNo);s=$batch.find("#VA009_btnPopupGrid");$consolidate=$batch.find("#VA009_Consolidate_"+u.windowNo);$overwritepay=$batch.find("#VA009_OverwritePayMthd_"+u.windowNo);$pop_cmbCurrencyType=$batch.find("#VA009_POP_cmbCurrencyType_"+u.windowNo)}function ft(n){t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetPopUpData",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{InvPayids:o.toString(),bank_id:g,acctno:nt,chkno:VIS.Utility.encodeText(d),OrderPayids:l.toString()},success:function(t){n(t)},error:function(){VIS.ADialog.error("VA009_ErrorLoadingPayments")}})}function et(n){var i,r,t;v=[];i=JSON.parse(n);ut=i;for(r in i)t={},t.recid=i[r].recid,t.C_Bpartner=i[r].C_Bpartner,t.C_Invoice_ID=i[r].C_Invoice_ID,t.C_InvoicePaySchedule_ID=i[r].C_InvoicePaySchedule_ID,t.CurrencyCode=i[r].CurrencyCode,t.DueAmt=i[r].DueAmt,t.ConvertedAmt=i[r].convertedAmt,t.C_BPartner_ID=i[r].C_BPartner_ID,t.C_Currency_ID=i[r].C_Currency_ID,t.AD_Org_ID=i[r].AD_Org_ID,t.AD_Client_ID=i[r].AD_Client_ID,t.CheckDate=(new Date).toString("MM/DD/YYYY"),t.CheckNumber=null,t.ValidMonths=null,t.VA009_PaymentMethod_ID=i[r].VA009_PaymentMethod_ID,t.TransactionType=i[r].TransactionType,v.push(t);w2utils.encodeTags(v);c.add(v)}function ot(){function n(n){if($pop_cmbCurrencyType.append("<option value='0'><\/option>"),n.length>0){for(var t in n)$pop_cmbCurrencyType.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>"),VIS.Utility.encodeText(n[t].IsDefault)=="Y"&&(at=VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID));$pop_cmbCurrencyType.val(at)}}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/loadCurrencyType",null,n)}function r(n){return n?"#FFB6C1":"White"}function h(n){var i,r,t;c.clear();v=[];i=JSON.parse(n);ut=i;for(r in i)t={},t.recid=i[r].recid,t.C_Bpartner=i[r].C_Bpartner,t.C_Invoice_ID=i[r].C_Invoice_ID,t.C_InvoicePaySchedule_ID=i[r].C_InvoicePaySchedule_ID,t.CurrencyCode=i[r].CurrencyCode,t.DueAmt=i[r].DueAmt,t.ConvertedAmt=i[r].convertedAmt,t.C_BPartner_ID=i[r].C_BPartner_ID,t.C_Currency_ID=i[r].C_Currency_ID,t.AD_Org_ID=i[r].AD_Org_ID,t.AD_Client_ID=i[r].AD_Client_ID,t.CheckDate=(new Date).toString("MM/DD/YYYY"),t.CheckNumber=null,t.ValidMonths=null,t.VA009_PaymentMethod_ID=i[r].VA009_PaymentMethod_ID,t.TransactionType=i[r].TransactionType,v.push(t);i[0].ERROR=="ConversionNotFound"&&VIS.ADialog.info("VA009_ConversionNotFound");w2utils.encodeTags(v);c.add(v)}function st(){function n(n){if($POP_PayMthd.append(" <option value = 0><\/option>"),n.length>0)for(var t in n)$POP_PayMthd.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].VA009_PaymentMethod_ID)+">"+VIS.Utility.encodeText(n[t].VA009_Name)+"<\/option>");$POP_PayMthd.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadBatchPaymentMethod",null,n)}function ht(n){n=JSON.parse(n);a.find(".VA009-payment-wrap").remove();f.find(".VA009-right-data-main").remove();f.find(".VA009-accordion").remove();y=1;o=[];l=[];p=[];k=[];w();e[0].style.visibility="hidden";VIS.ADialog.info("",null,n,"")}function b(){i=null;$batch=null;STAT_cmbBank=null;STAT_cmbBankAccount=null;STAT_txtStatementNo=null;STAT_ctrlLoadFile=null;STAT_ctrlLoadFileTxt=null;w2ui.BatchGrid.destroy()}var s,d="",g=0,nt=0,i,n;$batch=t("<div class='VA009-popform-content' style='min-height:395px !important'>");i="";i+="<div class='VA009-popfrm-wrap'> <div class='VA009-popform-data'><label>"+VIS.Msg.getMsg("VA009_Bank")+"<\/label><select id='VA009_POP_cmbBank_"+u.windowNo+"'><\/select><\/div> <div class='VA009-popform-data'><label>"+VIS.Msg.getMsg("VA009_BankAccount")+"<\/label><select id='VA009_POP_cmbBankAccount_"+u.windowNo+"'><\/select><\/div><div class='VA009-popform-data' style='display:none !important'><label style='display:none !important'>"+VIS.Msg.getMsg("VA009_PayMthd")+"<\/label><select style='display:none !important' id='VA009_POP_cmbPaymthd_"+u.windowNo+"'><\/select><\/div><div class='VA009-popform-data' style='display:none !important'><br><input type='checkbox' style='display:none !important' id='VA009_OverwritePayMthd_"+u.windowNo+"'>&nbsp;"+VIS.Msg.getMsg("VA009_OverwritePayMthd")+"<\/div><div class='VA009-popform-data' style='display:none !important'><label style='display:none !important'>"+VIS.Msg.getMsg("VA009_CurrencyType")+"<\/label><select style='display:none !important' id='VA009_POP_cmbCurrencyType_"+u.windowNo+"'><\/select><\/div><div class='VA009-popform-data' style='display:none !important'><br><input style='display:none !important' type='checkbox' id='VA009_Consolidate_"+u.windowNo+"'>&nbsp;"+VIS.Msg.getMsg("VA009_Consolidate")+"<\/div><div class='VA009-table-container' style='margin-top:20px !important; height:300px;' id='VA009_btnPopupGrid'> <\/div><\/div>";$batch.append(i);it();n=new VIS.ChildDialog;n.setContent($batch);n.setTitle(VIS.Msg.getMsg("VA009_LoadBatchPayment"));n.setWidth("60%");n.setEnableResize(!0);n.setModal(!0);n.show();tt();ft(et);dr($POP_cmbBank,rt);$POP_cmbBank.css("background-color",r(!0));$POP_cmbBankAccount.css("background-color",r(!0));st();ot();$POP_cmbBank.on("change",function(){function n(n){if($POP_cmbBankAccount.append("<option value='0'><\/option>"),n!=null&&n.length>0)for(var t in n)$POP_cmbBankAccount.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_BankAccount_ID)+">"+VIS.Utility.encodeText(n[t].AccountNo)+"<\/option>")}$POP_cmbBankAccount.empty();VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadBankAccount",{Bank_ID:$POP_cmbBank.val(),Orgs:[]},n)});$POP_cmbBankAccount.on("change",function(){$POP_cmbBankAccount.val()=="0"?$POP_cmbBankAccount.css("background-color",r(!0)):$POP_cmbBankAccount.css("background-color",r(!1));t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetConvertedAmt",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(ut),BankAccount:$POP_cmbBankAccount.val(),CurrencyType:$pop_cmbCurrencyType.val()},success:function(n){h(n)},error:function(n){console.log(n);VIS.ADialog.error("VA009_ErrorLoadingPayments")}})});$pop_cmbCurrencyType.on("change",function(){t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetConvertedAmt",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(ut),BankAccount:$POP_cmbBankAccount.val(),CurrencyType:$pop_cmbCurrencyType.val()},success:function(n){h(n)},error:function(n){console.log(n);VIS.ADialog.error("VA009_ErrorLoadingPayments")}})});c.on("change",function(n){n.column==7&&(c.records[n.index].CheckNumber=n.value_new);n.column==8&&(c.records[n.index].CheckDate=n.value_new);n.column==9&&(c.records[n.index].ValidMonths=n.value_new)});$POP_PayMthd.on("change",function(){hu=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/GetPaymentRule",{PaymentMethod:$POP_PayMthd.val()},null);hu=="S"?c.showColumn("CheckNumber","CheckDate","ValidMonths","Mandate"):c.hideColumn("recid","CheckNumber","CheckDate","ValidMonths","Mandate")});n.onOkClick=function(){var r=[],i,n,u;if(c.selectAll(),VIS.Utility.Util.getValueOfInt($POP_cmbBank.val())>0)if(VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val())>0){if(c.getSelection().length>0)for(i=0;i<c.getSelection().length;i++){if(n={},n.C_BPartner_ID=c.get(c.getSelection()[i]).C_BPartner_ID,n.C_Invoice_ID=c.get(c.getSelection()[i]).C_Invoice_ID,n.C_InvoicePaySchedule_ID=c.get(c.getSelection()[i]).C_InvoicePaySchedule_ID,n.AD_Org_ID=c.get(c.getSelection()[i]).AD_Org_ID,n.AD_Client_ID=c.get(c.getSelection()[i]).AD_Client_ID,n.C_Currency_ID=c.get(c.getSelection()[i]).C_Currency_ID,n.TransactionType=c.get(c.getSelection()[i]).TransactionType,n.DueAmt=c.get(c.getSelection()[i]).DueAmt,n.C_Bank_ID=$POP_cmbBank.val(),n.C_BankAccount_ID=$POP_cmbBankAccount.val(),c.get(c.getSelection()[i]).ConvertedAmt==0)return!1;if(n.ConvertedAmt=c.get(c.getSelection()[i]).ConvertedAmt,$overwritepay.prop("checked")==!0?(n.VA009_PaymentMethod_ID=$POP_PayMthd.val(),n.isOverwrite="Y"):(n.VA009_PaymentMethod_ID=c.get(c.getSelection()[i]).VA009_PaymentMethod_ID,n.isOverwrite="N"),n.isconsolidate=$consolidate.prop("checked")==!0?"Y":"N",hu=="S")if(u=new Date(c.get(c.getSelection()[i]).CheckDate),n.CheckDate=VIS.Utility.Util.getValueOfDate(c.get(c.getSelection()[i]).CheckDate),c.get(c.getSelection()[i]).CheckNumber!=null)n.CheckNumber=c.get(c.getSelection()[i]).CheckNumber;else return VIS.ADialog.info("VA009_PLCheckNumber"),c.selectNone(),!1;else n.CheckNumber=null,n.CheckDate=null,n.ValidMonths=null;n.CurrencyType=$pop_cmbCurrencyType.val();r.push(n)}e[0].style.visibility="visible";t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GeneratePaymentsBatch",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(r)},success:function(n){ht(n)},error:function(n){console.log(n);e[0].style.visibility="hidden";VIS.ADialog.error("VA009_ErrorLoadingPayments")}})}else return VIS.ADialog.info("VA009_PLSelectBankAccount"),c.selectNone(),!1;else return VIS.ADialog.info("VA009_PLSelectBank"),c.selectNone(),!1};n.onCancelCLick=function(){w2ui.BatchGrid.clear();b()};n.onClose=function(){w2ui.BatchGrid.clear();b()}},Split_Dialog:function(){function nt(){var n=[];n.length==0&&(n.push({field:"recid",caption:VIS.Msg.getMsg("VA009_srno"),sortable:!0,size:"10%"}),n.push({field:"C_Bpartner",caption:VIS.Msg.getMsg("VA009_BPartner"),sortable:!0,size:"10%"}),n.push({field:"DocumentNo",caption:VIS.Msg.getMsg("VA009_Invoice"),sortable:!0,size:"10%"}),n.push({field:"CurrencyCode",caption:VIS.Msg.getMsg("VA009_Currency"),sortable:!0,size:"10%"}),n.push({field:"DueAmt",caption:VIS.Msg.getMsg("VA009_DueAmt"),sortable:!0,size:"10%",render:"float:2"}),n.push({field:"DueDate",caption:VIS.Msg.getMsg("VA009_DueDate"),sortable:!0,size:"10%",render:"date",style:"text-align: left",editable:{type:"date"}}),n.push({field:"TransactionType",caption:VIS.Msg.getMsg("VA009_TransactionType"),sortable:!0,size:"1%"}));s=null;s=h.w2grid({name:"SplitGrid",recordHeight:25,columns:n,method:"GET",multiSelect:!0});s.hideColumn("recid");s.hideColumn("TransactionType")}function tt(){h=$split.find("#VA009_btnPopupGrid");$TxtSplitAmt=$split.find("#VA009_POP_TxtSplitAmt_"+u.windowNo);$BtnSplit=$split.find("#VA009_btnSplitAmt_"+u.windowNo)}function it(n){t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetPopUpData",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{InvPayids:o.toString(),bank_id:d,acctno:g,chkno:VIS.Utility.encodeText(b),OrderPayids:l.toString()},success:function(t){n(t)},error:function(){e[0].style.visibility="hidden";VIS.ADialog.error("VA009_ErrorLoadingPayments")}})}function rt(n){var f,i,r,t,u,o,h;s.clear();v=[];f=0;i=JSON.parse(n);for(r in i)f=f+1,t={},t.recid=f,t.C_Bpartner=i[r].C_Bpartner,t.C_Invoice_ID=i[r].C_Invoice_ID,t.DocumentNo=i[r].DocumentNo,t.C_InvoicePaySchedule_ID=i[r].C_InvoicePaySchedule_ID,t.CurrencyCode=i[r].CurrencyCode,t.DueAmt=i[r].DueAmt,u=new Date(i[r].DueDate),u.setMinutes(-u.getTimezoneOffset()+u.getMinutes()),newValue=u.toISOString(),o=newValue.substring(0,newValue.length-1),h=newValue.indexOf("T"),t.DueDate=o.substring(0,h),t.C_BPartner_ID=i[r].C_BPartner_ID,t.C_Currency_ID=i[r].C_Currency_ID,t.AD_Org_ID=i[r].AD_Org_ID,t.AD_Client_ID=i[r].AD_Client_ID,t.TransactionType=i[r].TransactionType,v.push(t);w2utils.encodeTags(v);s.add(v);e[0].style.visibility="hidden"}function i(){var t,i,u,f,n,e,r,o;_CollaborateData=[];t=parseFloat(s.get(s.getSelection()[0]).DueAmt);i=parseFloat($TxtSplitAmt.val());t<0&&(t=-1*t);i<0&&(i=-1*i);u=t/i;f=Math.ceil(u);f>0&&(n={},e=s.records[s.records.length-1].recid+1,n.recid=e,n.C_BPartner_ID=s.get(s.getSelection()[0]).C_BPartner_ID,n.C_Bpartner=s.get(s.getSelection()[0]).C_Bpartner,n.CurrencyCode=s.get(s.getSelection()[0]).CurrencyCode,n.DocumentNo=s.get(s.getSelection()[0]).DocumentNo,n.C_Invoice_ID=s.get(s.getSelection()[0]).C_Invoice_ID,n.AD_Org_ID=s.get(s.getSelection()[0]).AD_Org_ID,n.AD_Client_ID=s.get(s.getSelection()[0]).AD_Client_ID,n.C_Currency_ID=s.get(s.getSelection()[0]).C_Currency_ID,n.DueAmt=i.toFixed(2),n.C_InvoicePaySchedule_ID=s.get(s.getSelection()[0]).C_InvoicePaySchedule_ID,n.DueDate=null,n.TransactionType=s.get(s.getSelection()[0]).TransactionType,_CollaborateData.push(n),r=i,t-r>0&&(o=t-r,s.get(s.getSelection()[0]).DueAmt=o.toFixed(2)));w2utils.encodeTags(_CollaborateData);s.add(_CollaborateData);$TxtSplitAmt.val("");s.refresh()}function ut(n){n=JSON.parse(n);a.find(".VA009-payment-wrap").remove();f.find(".VA009-right-data-main").remove();f.find(".VA009-accordion").remove();y=1;o=[];l=[];p=[];k=[];w();e[0].style.visibility="hidden";VIS.ADialog.info(n)}function c(){$split=null;r=null;w2ui.SplitGrid.destroy()}var h,b="",d=0,g=0,r,n;e[0].style.visibility="visible";$split=t("<div class='VA009-popform-content' style='min-height:333px !important'>");r="";r+="<div class='VA009-popform-data'><label>"+VIS.Msg.getMsg("VA009_lblSplitAmt")+"<\/label><input type='text' id='VA009_POP_TxtSplitAmt_"+u.windowNo+"' style='width: 60% !important'/>  <a class='btn VA009-blueBtn' id='VA009_btnSplitAmt_"+u.windowNo+"' style='margin-top: 0px !important'>Split Schedule<\/a> <\/div>  <div class='VA009-table-container' id='VA009_btnPopupGrid'>  <\/div> <\/div>";$split.append(r);tt();n=new VIS.ChildDialog;n.setContent($split);n.setTitle(VIS.Msg.getMsg("VA009_LoadSplitPayment"));n.setWidth("60%");n.setEnableResize(!0);n.setModal(!0);n.show();nt();it(rt);s.on("change",function(n){n.column==5&&(s.records[n.index].DueDate=n.value_new)});$TxtSplitAmt.on("keypress",function(n){if(n.keyCode!=13&&(n.which!=46||t(this).val().indexOf(".")!=-1)&&n.which!=8&&n.which!=0&&(n.which<48||n.which>57)&&n.keyCode!=45)return!1;if(n.keyCode==13){if(s.getSelection().length==0)return VIS.ADialog.info("PlsSelectRecord"),!1;if($TxtSplitAmt.val()!="")parseFloat(s.get(s.getSelection()[0]).DueAmt)<parseFloat($TxtSplitAmt.val())?VIS.ADialog.info("Can't Enter Greater Than Due Amt"):parseFloat(s.get(s.getSelection()[0]).DueAmt)>0?parseFloat($TxtSplitAmt.val())<0?VIS.ADialog.info("Can't Enter Negative Amt"):i():parseFloat(s.get(s.getSelection()[0]).DueAmt)<0?parseFloat($TxtSplitAmt.val())>0?VIS.ADialog.info("Can't Enter Positive Amt"):i():i();else return VIS.ADialog.info("VA009_PLEnterSplitAmt"),!1}});$BtnSplit.on("click",function(){if(s.getSelection().length==0)return VIS.ADialog.info("PlsSelectRecord"),!1;var t=parseFloat(s.get(s.getSelection()[0]).DueAmt),n=$TxtSplitAmt.val();if(n!="")n=parseFloat($TxtSplitAmt.val()),t<0&&(t=-1*t),n<0&&(n=-1*n),t<n?VIS.ADialog.info("VA009_CantEnterGreaterAmt"):t>0?n<0?VIS.ADialog.info("VA009_CantEnterNegtveAmt"):n==0?VIS.ADialog.info("VA009_CantEnterZeroAmt"):i():t<0?n>0?VIS.ADialog.info("VA009_CantEnterPositiveAmt"):i():i();else return VIS.ADialog.info("VA009_PLEnterSplitAmt"),!1});n.onOkClick=function(){if(vr=[],_CollaborateData.length>0){s.selectAll();vr=s.records;for(var n=0;n<vr.length;n++)if(s.get(s.getSelection()[n]).DueDate==null)return VIS.ADialog.info("VA009_PlzSelctDueDate"),!1;e[0].style.visibility="visible";t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/CreateSplitPayments",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(vr),SplitAmmount:$TxtSplitAmt.val()},success:function(n){ut(n)},error:function(n){console.log(n);e[0].style.visibility="hidden";VIS.ADialog.error("VA009_ErrorLoadingPayments")}})}else return VIS.ADialog.info("VA009_PlzSplitRecord"),!1};n.onCancelCLick=function(){w2ui.SplitGrid.clear();c()};n.onClose=function(){w2ui.SplitGrid.clear();c()}},XML_Dialog:function(){o.length>0||l.length>0?w2confirm("Do you want to clear the selection and proceed for SEPA XML Generation Process?").yes(function(){o=[];l=[];hi.prop("checked",!1);a.find(":checkbox").prop("checked",!1);uf()}).no(function(){console.log("user clicked NO")}):uf()},ChatWindow:function(){function f(n){n=JSON.parse(n);e[0].style.visibility="hidden";ru=a.find("#VA009-Chatcolor-gray_"+vi);ru.html("");ru.append("<span class=VA009-Chatcolor-gray>"+n+"<\/span>")}var n=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/GetChatID",{RecordID:vi},null);if(n!=null){var r=n.AD_Table_ID,u=n.CM_Chat_ID,i=new VIS.Chat(vi,u,r,"",this.windowNo);i.show();i.onClose=function(){t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetChat",type:"POST",datatype:"json",async:!0,data:{RecordID:vi},success:function(n){f(n)},error:function(n){console.log(n);e[0].style.visibility="hidden";VIS.ADialog.error("VA009_ErrorLoadingPayments")}})}}},B2B_Dialog:function(){function ut(){l.on("click",function(n){var i=t(n.target);n.target.type=="checkbox"&&i.prop("checked")==!0&&(a.prop("checked",!1),y(r,c),p($To_cmbBank,[]))});a.on("click",function(n){var i=t(n.target);n.target.type=="checkbox"&&i.prop("checked")==!0&&(l.prop("checked",!1),p($To_cmbBank,c),y(r,[]))});e.on("change",function(){parseInt(e.val())>0?(c=[],c.push(e.val()),e.css("background-color",n(!1)),l.prop("checked")==!0&&(y(r,c),p($To_cmbBank,[])),a.prop("checked")==!0&&(p($To_cmbBank,c),y(r,[]))):e.css("background-color",n(!0))});r.on("change",function(){parseInt(r.val())>0?r.css("background-color",n(!1)):r.css("background-color",n(!0))});$To_cmbBank.on("change",function(){parseInt($To_cmbBank.val())>0?$To_cmbBank.css("background-color",n(!1)):$To_cmbBank.css("background-color",n(!0))});s.on("change",function(){parseInt(s.val())>0?s.css("background-color",n(!1)):s.css("background-color",n(!0))});i.on("change",function(){parseInt(i.val())>0?i.css("background-color",n(!1)):i.css("background-color",n(!0));t("option:selected",i).attr("paybase")=="S"?(it(),f.removeAttr("disabled"),f.css("background-color","white"),f.css("background-color",n(!0)),o.removeAttr("disabled"),o.css("background-color","white"),o.css("background-color",n(!0))):(f.val(""),f.attr("disabled","disabled"),f.css("background-color",n(!1)),f.css("background-color","#ededed"),o.val(""),o.attr("disabled","disabled"),o.css("background-color",n(!1)),o.css("background-color","#ededed"))});tt.on("click",function(){parseInt(i.val())>0&&t("option:selected",i).attr("paybase")=="S"&&it()})}function n(n){return n?"#FFB6C1":"White"}function ft(){e=$b2b.find("#VA009_POP_cmbOrg_"+u.windowNo);r=$b2b.find("#VA009_POP_cmbFromBank_"+u.windowNo);$To_cmbBank=$b2b.find("#VA009_POP_cmbToBank_"+u.windowNo);l=$b2b.find("#VA009_Payment_"+u.windowNo);a=$b2b.find("#VA009_Receipt_"+u.windowNo);v=$b2b.find("#VA009_cmbCurrencyType_"+u.windowNo);i=$b2b.find("#VA009_cmbPayMthd_"+u.windowNo);s=$b2b.find("#VA009_POP_cmbCurrency_"+u.windowNo);d=$b2b.find("#VA009_Amount"+u.windowNo);g=$b2b.find("#VA009_TransactionDate"+u.windowNo);w=$b2b.find("#VA009_AccountDate"+u.windowNo);f=$b2b.find("#VA009_Chqnotxt_"+u.windowNo);o=$b2b.find("#VA009_CheckDate_"+u.windowNo);$note=$b2b.find("#VA009_Note"+u.windowNo);tt=$b2b.find("#VA009_getCheckNo_"+u.windowNo);e.css("background-color",n(!0));r.css("background-color",n(!0));$To_cmbBank.css("background-color",n(!0));s.css("background-color",n(!0));i.css("background-color",n(!0))}function et(){function n(n){if(e.append(" <option value = 0><\/option>"),n.length>0)for(var t in n)e.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].AD_Org_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>");e.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadOrganization",null,n)}function ot(){function n(n){if(i.append(" <option value = 0><\/option>"),n.length>0)for(var t in n)"LCPB".contains(n[t].VA009_PaymentBaseType)||i.append("<option paybase = "+n[t].VA009_PaymentBaseType+" value="+VIS.Utility.Util.getValueOfInt(n[t].VA009_PaymentMethod_ID)+">"+VIS.Utility.encodeText(n[t].VA009_Name)+" <\/option>");i.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadPaymentMethod",null,n)}function st(){function n(n){if(v.append("<option value='0'><\/option>"),n.length>0){for(var t in n)v.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>"),VIS.Utility.encodeText(n[t].IsDefault)=="Y"&&(at=VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID));v.val(at)}}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/loadCurrencyType",null,n)}function ht(){function n(n){if(s.append("<option value='0'><\/option>"),n.length>0){for(var t in n)s.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_Currency_ID)+">"+VIS.Utility.encodeText(n[t].ISO_Code)+"<\/option>");s.prop("selectedIndex",0)}}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/loadCurrencies",null,n)}function y(n,t){function i(t){if(n.find("option").remove(),n.append("<option value='0'><\/option>"),t!=null&&t.length>0)for(var i in t)n.append("<option value="+VIS.Utility.Util.getValueOfInt(t[i].C_BankAccount_ID)+">"+VIS.Utility.encodeText(t[i].AccountNo)+"<\/option>")}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadBankAccount",{Bank_ID:0,Orgs:t.toString()},i)}function p(n,t){function i(t){if(n.find("option").remove(),n.append("<option value='0'><\/option>"),t!=null&&t.length>0)for(var i in t)n.append("<option value="+VIS.Utility.Util.getValueOfInt(t[i].C_BankAccount_ID)+">"+VIS.Utility.encodeText(t[i].AccountNo)+"<\/option>")}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadBankAccount",{Bank_ID:0,Orgs:t.toString()},i)}function it(){function t(t){f.val();$note.css("visibility","hidden");t!=null&&(f.val(t),f.css("background-color",n(!1)))}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/getCheckNo",{C_BankAccount_ID:parseInt(r.val()),VA009_PaymentMethod_ID:parseInt(i.val())},t)}function rt(){$b2b=null;b=null}var e,r,v,i,s,d,f,o,tt,g,w,l,a,c=[],b,h,k,nt;$b2b=t("<div class='VA009-popform-content vis-forms-container' style='min-height:380px !important'>");b="";b+="<div class='VA009-popfrm-wrap'> <div class='VA009-popform-data'><label>"+VIS.Msg.getMsg("VA009_Org")+"<\/label><select id='VA009_POP_cmbOrg_"+u.windowNo+"'><\/select><\/div> <div class='VA009-popform-data'><label style='visibility: hidden;'>"+VIS.Msg.getMsg("VA009_FromBank")+"<\/label><div><input type='checkbox' id=VA009_Payment_"+u.windowNo+"> <label style=width:auto !important>Payment<\/label><input type='checkbox' id=VA009_Receipt_"+u.windowNo+" style=margin-left:60px !important> <label style=width:auto !important>Receipt<\/label><\/div><\/div> <div class='VA009-popform-data'><label>"+VIS.Msg.getMsg("VA009_FromBank")+"<\/label><select id='VA009_POP_cmbFromBank_"+u.windowNo+"'><\/select><\/div> <div class='VA009-popform-data'><label>"+VIS.Msg.getMsg("VA009_ToBank")+"<\/label><select id='VA009_POP_cmbToBank_"+u.windowNo+"'><\/select><\/div><div class='VA009-popform-data'><label>"+VIS.Msg.getMsg("Amount")+"<\/label><input type='number' id='VA009_Amount"+u.windowNo+"' value=0> <\/div><div class='VA009-popform-data'><label>"+VIS.Msg.getMsg("VA009_PayMethodlbl")+"<\/label><select id='VA009_cmbPayMthd_"+u.windowNo+"'><\/select><\/div><div class='VA009-popform-data VA009-b2b-popup'><label>"+VIS.Msg.getMsg("VA009_ChkNo")+"<\/label><a href='javascript:void(0)' id='VA009_getCheckNo_"+u.windowNo+"'>"+VIS.Msg.getMsg("GetNextCheckNo")+"<\/a><input type='text' style='background-color: #ededed;' id='VA009_Chqnotxt_"+u.windowNo+"' disabled/> <\/div><div class='VA009-popform-data'><label>"+VIS.Msg.getMsg("VA009_CheckDate")+"<\/label><input type='date' id='VA009_CheckDate_"+u.windowNo+"' style='height: 30px;background-color: #ededed;' disabled> <\/div><div class='VA009-popform-data'><label>"+VIS.Msg.getMsg("Currency")+"<\/label><select id='VA009_POP_cmbCurrency_"+u.windowNo+"'><\/select><\/div><div class='VA009-popform-data'><label>"+VIS.Msg.getMsg("VA009_CurrencyType")+"<\/label><select id='VA009_cmbCurrencyType_"+u.windowNo+"'><\/select><\/div><div class='VA009-popform-data'><label>"+VIS.Msg.getMsg("TransactionDate")+"<\/label><input type='date' id='VA009_TransactionDate"+u.windowNo+"' > <\/div><div class='VA009-popform-data'><label>"+VIS.Msg.getMsg("AccountDate")+"<\/label><input type='date' id='VA009_AccountDate"+u.windowNo+"' > <\/div><div style='float:left;'><label style='color:red; visibility: hidden;' id='VA009_Note"+u.windowNo+"'>Please Select Org.<\/label><\/div><\/div>";$b2b.append(b);h=new VIS.ChildDialog;h.setContent($b2b);h.setTitle(VIS.Msg.getMsg("VA009_BankToBankTransfer"));h.setWidth("60%");h.setEnableResize(!0);h.setModal(!0);h.show();ft();k=new Date;nt=k.getFullYear()+"-"+("0"+(k.getMonth()+1)).slice(-2)+"-"+("0"+k.getDate()).slice(-2);g.val(nt);w.val(nt);ut();et();ht();st();ot();y(r,c);p($To_cmbBank,c);h.onOkClick=function(){var n,u,h;if(parseInt(e.val())==0)return $note.text(VIS.Msg.getMsg("VA009_PlsSelectOrg")),$note.css("visibility","visible");if(!a.prop("checked")&&!l.prop("checked"))return $note.text(VIS.Msg.getMsg("VA009_PlsSelectPaymentOrReceipt")),$note.css("visibility","visible");if(parseInt(r.val())==0)return $note.text(VIS.Msg.getMsg("VA009_PlsSelectBankFrom")),$note.css("visibility","visible");if(parseInt($To_cmbBank.val())==0)return $note.text(VIS.Msg.getMsg("VA009_PlsSelectBankTo")),$note.css("visibility","visible");if(parseFloat(d.val())==0)return $note.text(VIS.Msg.getMsg("VA009_PlsEnterAmount")),$note.css("visibility","visible");if(parseInt(i.val())==0)return $note.text(VIS.Msg.getMsg("VA009_PlsSelectPayMethod")),$note.css("visibility","visible");if(t("option:selected",i).attr("paybase")=="S"){if(f.val()=="")return $note.text(VIS.Msg.getMsg("VA009_PLCheckNumber")),$note.css("visibility","visible");if(o.val()==""||o.val()==null)return $note.text(VIS.Msg.getMsg("VA009_PLCheckDate")),$note.css("visibility","visible");if(n=new Date(o.val()),n=new Date(n.setHours(0,0,0,0)),u=new Date(w.val()),u=new Date(u.setHours(0,0,0,0)),n>u)return $note.text(VIS.Msg.getMsg("VIS_CheckDateCantbeGreaterSys")),$note.css("visibility","visible")}return parseInt(s.val())==0?($note.text(VIS.Msg.getMsg("VA009_PlsSelectCurrency")),$note.css("visibility","visible")):($note.css("visibility","hidden"),h={},h={OrgID:parseInt(e.val()),isReceipt:a.prop("checked"),isPayment:l.prop("checked"),fromBank:parseInt(r.val()),toBank:parseInt($To_cmbBank.val()),amount:parseFloat(d.val()),paymentMethod:parseInt(i.val()),currencyID:parseInt(s.val()),currencyType:v.val(),transDate:VIS.Utility.Util.getValueOfDate(g.val()),acctDate:VIS.Utility.Util.getValueOfDate(w.val()),clientID:VIS.Env.getCtx().getAD_Client_ID(),PayBase:t("option:selected",i).attr("paybase"),CheckNo:f.val(),CheckDate:VIS.Utility.Util.getValueOfDate(o.val())},nr="",af(h),!1)};h.onCancelCLick=function(){rt()};h.onClose=function(){rt()}},Pay_ManualDialog:function(){function v(){$POP_cmbBank=$payManual.find("#VA009_POP_cmbBank_"+u.windowNo);$POP_cmbBankAccount=$payManual.find("#VA009_POP_cmbBankAccount_"+u.windowNo);$POP_PayMthd=$payManual.find("#VA009_cmbPayMthd_"+u.windowNo);b=$payManual.find("#VA009_AccountDate_"+u.windowNo);br=$payManual.find("#VA009_cmbCurrencyType_"+u.windowNo);b.css("background-color",h(!0));ct=$payManual.find("#VA009_TransactionDate"+u.windowNo)}function d(){function n(n){if(n.length>1&&$POP_PayMthd.append(" <option value = 0><\/option>"),n.length>0)for(var t in n)"LCPBS".contains(n[t].VA009_PaymentBaseType)||$POP_PayMthd.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].VA009_PaymentMethod_ID)+">"+VIS.Utility.encodeText(n[t].VA009_Name)+"<\/option>");$POP_PayMthd.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadPaymentMethod",null,n)}function g(){function n(n){if(br.append("<option value='0'><\/option>"),n.length>0)for(var t in n)br.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>"),VIS.Utility.encodeText(n[t].IsDefault)=="Y"&&(at=VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID))}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/loadCurrencyType",null,n)}function h(n){return n?"#FFB6C1":"White"}function c(){$payManual=null;i=null}var i,r,s,n;$payManual=t("<div class='VA009-popform-content' style='min-height:180px !important'>");i="";i+="<div class='VA009-popfrm-wrap' style='height:150px !important'><div class='VA009-popform-data'><label>"+VIS.Msg.getMsg("VA009_Bank")+"<\/label><select id='VA009_POP_cmbBank_"+u.windowNo+"'><\/select><\/div><div class='VA009-popform-data'><label>"+VIS.Msg.getMsg("VA009_BankAccount")+"<\/label><select id='VA009_POP_cmbBankAccount_"+u.windowNo+"'><\/select><\/div><div class='VA009-popform-data'><label>"+VIS.Msg.getMsg("VA009_PayMethodlbl")+"<\/label><select id='VA009_cmbPayMthd_"+u.windowNo+"'><\/select><\/div><div class='VA009-popform-data'><label>"+VIS.Msg.getMsg("AccountDate")+"<\/label><input type='date' id='VA009_AccountDate_"+u.windowNo+"' style='height: 30px;border-radius: 0;'> <\/div><div class='VA009-popform-data'><label>"+VIS.Msg.getMsg("VA009_CurrencyType")+"<\/label><select id='VA009_cmbCurrencyType_"+u.windowNo+"'><\/select><\/div><div class='VA009-popform-data'><label>"+VIS.Msg.getMsg("TransactionDate")+"<\/label><input type='date' id='VA009_TransactionDate"+u.windowNo+"' > <\/div><\/div>";$payManual.append(i);v();r=new Date;s=r.getFullYear()+"-"+("0"+(r.getMonth()+1)).slice(-2)+"-"+("0"+r.getDate()).slice(-2);b.val(s);ct.val(s);n=new VIS.ChildDialog;n.setContent($payManual);n.setTitle(VIS.Msg.getMsg("VA009_PayMannual"));n.setWidth("60%");n.setEnableResize(!0);n.setModal(!0);n.show();dr($POP_cmbBank,rt);d();g();$POP_cmbBank.on("change",function(){function n(n){if($POP_cmbBankAccount.append("<option value='0'><\/option>"),n!=null&&n.length>0)for(var t in n)$POP_cmbBankAccount.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_BankAccount_ID)+">"+VIS.Utility.encodeText(n[t].AccountNo)+"<\/option>")}$POP_cmbBankAccount.empty();$POP_cmbBank.val()=="0"?$POP_cmbBank.css("background-color",h(!0)):$POP_cmbBank.css("background-color",h(!1));VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadBankAccount",{Bank_ID:$POP_cmbBank.val(),Orgs:[]},n)});n.onOkClick=function(){if(o.length>0||l.length>0)if(VIS.Utility.Util.getValueOfInt($POP_cmbBank.val())>0)if(VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val())>0)if(VIS.Utility.Util.getValueOfInt($POP_PayMthd.val())>0)if(b.val()!=""&&b.val()!=null)if(1)e[0].style.visibility="visible",t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GeneratePaymentsMannualy",type:"POST",datatype:"json",async:!0,data:{InvoiceSchdIDS:o.toString(),OrderSchdIDS:l.toString(),BankID:VIS.Utility.Util.getValueOfInt($POP_cmbBank.val()),BankAccountID:VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val()),PaymentMethodID:VIS.Utility.Util.getValueOfInt($POP_PayMthd.val()),DateAcct:b.val(),CurrencyType:br.val(),DateTrx:ct.val()},success:function(n){n=JSON.parse(n);a.find(".VA009-payment-wrap").remove();f.find(".VA009-right-data-main").remove();f.find(".VA009-accordion").remove();y=1;o=[];l=[];p=[];k=[];w();e[0].style.visibility="hidden";VIS.ADialog.info("",null,n,"")},error:function(n){console.log(n);e[0].style.visibility="hidden";VIS.ADialog.error("VA009_ErrorLoadingPayments")}});else return VIS.ADialog.info("VA009_PlzSelctapprPM"),!1;else return VIS.ADialog.info("VA009_PLSelectAcctDate"),!1;else return VIS.ADialog.info("VA009_PLSelectPaymentMethod"),!1;else return VIS.ADialog.info("VA009_PLSelectBankAccount"),!1;else return VIS.ADialog.info("VA009_PLSelectBank"),!1;else VIS.ADialog.info("VA009_PlzSelct1Pay")};n.onCancelCLick=function(){c()};n.onClose=function(){c()}}};tr=function(n,t,i){var r=0,u;try{r=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/GetWindowID",{WindowName:t},null);r>0&&(u=new VIS.Query,u.addRestriction(i,VIS.Query.prototype.EQUAL,n),VIS.viewManager.startWindow(r,u))}catch(f){console.log(f)}};ff=function(n,t,i){n=n=="Y"?"IS NOT NULL":"IS NULL";t=="ARI"?bi=" WHERE cs.c_invoice_id "+n+" AND cs.va009_ispaid    = 'N' AND cd.docbasetype IN  ('ARI','ARC' , 'SOO') AND inv.docstatus IN ('CO','CL')"+i:t=="API"&&(bi=" WHERE cs.c_invoice_id "+n+" AND cs.va009_ispaid    = 'N' AND cd.docbasetype IN  ('API','APC' , 'POO') AND inv.docstatus IN ('CO','CL')"+i)};this.getRoot=function(){return h};this.disposeComponent=function(){u=null;h&&h.remove();h=null;d=null;ot=null;ci=null;gr=null;ef=null;nu=null;_iscustomer=null;_isvendor=null;li=null;g=null;ii=null;nt=null;ri=null;tt=null;ui=null;tu=null;$lbdata=null;or=null;a=null;sr=null;fi=null;f=null;y=null;hr=null;yu=null;kt=null;wi=null;$UCR_Tab=null;$UCP_Tab=null;iu=null;pu=null;bi=null;ei=null;rt=null;vt=null;o=null;l=null;dt=null;gt=null;oi=null;ki=null;di=null;yt=null;bu=null;uu=null;fu=null;eu=null;ou=null;v=null;pr=null;n=null};this.setSize=function(){gu.height(t(".VA009-main-container").height());t("#VA009-content-area_"+u.windowNo).height(t("#VA009-main-container_"+u.windowNo).height()-20);t("#VA009_Paymntlst_"+u.windowNo).height(t("#VA009-middle-wrap_"+u.windowNo).height()-t("#VA009-mid-top-wrap_"+u.windowNo).height()-t("#VA009-mid-search_"+u.windowNo).height()-42);ir.height(or.height()-43)};this.lockUI=function(){};this.unlockUI=function(){};this.parentcall=function(){e[0].style.visibility="hidden"};this.initial=function(){}};n.PaymentForm.prototype.init=function(n,t){this.windowNo=n;this.frame=t;this.Initialize();this.frame.getContentGrid().append(this.getRoot());this.setSize()}}(VA009,jQuery);VA009=window.VA009||{},function(n){function i(){VIS.CalloutEngine.call(this,"VA009.VA009_CalloutPayment")}function r(){VIS.CalloutEngine.call(this,"VA009.VA009_CalloutPaymentTerm")}var u=VIS.Logging.Level,t=VIS.Utility.Util;VIS.Utility.inheritPrototype(i,VIS.CalloutEngine);i.prototype.setPMethod=function(n,t,i,r,u){if(this.isCalloutActive()||u==null)return"";this.setCalloutActive(!0);var e=i.getValue("C_InvoicePaySchedule_ID"),o=i.getValue("AD_Client_ID"),s=e.toString()+","+o.toString(),f=VIS.dataContext.getJSONRecord("Pay/GetInvPaymentMethod",s);return f!=null&&(i.setValue("VA009_PaymentMethod_id",f.VA009_PaymentMethod_ID),f.VA009_PaymentBaseType=="D"?i.setValue("TenderType","D"):f.VA009_PaymentBaseType=="K"?i.setValue("TenderType","C"):f.VA009_PaymentBaseType=="S"?i.setValue("TenderType","K"):f.VA009_PaymentBaseType=="T"?i.setValue("TenderType","A"):f.VA009_PaymentBaseType=="L"?i.setValue("TenderType","L"):i.setValue("TenderType","A"),i.setValue("VA009_ExecutionStatus",f.VA009_ExecutionStatus)),this.setCalloutActive(!1),""};i.prototype.setScheduleAmount=function(n,i,r,u,f){var b,a,o;if(f==null||f.toString()=="")return r.setValue("VA009_ExecutionStatus",null),r.setValue("DiscountAmt",VIS.Env.ZERO),r.setValue("PayAmt",VIS.Env.ZERO),r.setValue("WriteOffAmt",VIS.Env.ZERO),r.setValue("IsOverUnderPayment",!1),r.setValue("OverUnderAmt",VIS.Env.ZERO),"";this.setCalloutActive(!0);var k=r.getValue("AD_Client_ID"),d=f.toString()+","+k.toString(),e=VIS.dataContext.getJSONRecord("Pay/GetOrdPaymentMethod",d);e!=null&&(r.setValue("VA009_PaymentMethod_id",e.VA009_PaymentMethod_ID),e.VA009_PaymentBaseType=="D"?r.setValue("TenderType","D"):e.VA009_PaymentBaseType=="K"?r.setValue("TenderType","C"):e.VA009_PaymentBaseType=="S"?r.setValue("TenderType","K"):e.VA009_PaymentBaseType=="T"?r.setValue("TenderType","A"):e.VA009_PaymentBaseType=="L"?r.setValue("TenderType","L"):r.setValue("TenderType","A"),r.setValue("VA009_ExecutionStatus",e.VA009_ExecutionStatus),r.setValue("DiscountAmt",VIS.Env.ZERO),r.setValue("WriteOffAmt",VIS.Env.ZERO),r.setValue("IsOverUnderPayment",!1),r.setValue("OverUnderAmt",VIS.Env.ZERO));var y=0,v=n.getContextAsInt(i,"C_Order_ID"),p=0,e=VIS.dataContext.getJSONRecord("Pay/GetDueAmt",v.toString());e!=null&&(y=e.VA009_OrderPaySchedule_ID,p=e.DueAmt,r.setValue("PayAmt",p));var g="N",w="N",nt=v.toString()+","+r.getValue("DateTrx").toString()+","+y.toString(),e=VIS.dataContext.getJSONRecord("Pay/GetOpenAmt",nt);e!=null&&(r.setValue("C_BPartner_ID",e.C_BPartner_ID),b=e.C_Currency_ID,g=e.IsSOTrx,w=e.IsReturnTrx,r.setValue("C_Currency_ID",b),a=e.orderopen,a==null&&(a=VIS.Env.ZERO),o=e.OrderDiscount,o==null&&(o=VIS.Env.ZERO),o!=0&&r.setValue("PayAmt",a-o),r.setValue("DiscountAmt",o),n.setContext(i,"C_Order_ID",v.toString()));var s=t.getValueOfDecimal(r.getValue("PayAmt")==null?VIS.Env.ZERO:r.getValue("PayAmt")),h=t.getValueOfDecimal(r.getValue("WriteOffAmt")==null?VIS.Env.ZERO:r.getValue("WriteOffAmt")),c=t.getValueOfDecimal(r.getValue("OverUnderAmt")==null?VIS.Env.ZERO:r.getValue("OverUnderAmt")),l=t.getValueOfDecimal(r.getValue("DiscountAmt")==null?VIS.Env.ZERO:r.getValue("DiscountAmt"));return w=="Y"?(s>0&&(s=s*-1,r.setValue("PayAmt",s)),l>0&&(l=l*-1),o>0&&(o=o*-1),h>0&&(h=h*-1,r.setValue("WriteOffAmt",h)),c>0&&(c=c*-1,r.setValue("OverUnderAmt",c))):(s<0&&(s=s*-1,r.setValue("PayAmt",s)),l<0&&(l=l*-1),o<0&&(o=o*-1),h<0&&(h=h*-1,r.setValue("WriteOffAmt",h)),c<0&&(c=c*-1,r.setValue("OverUnderAmt",c))),this.setCalloutActive(!1),""};i.prototype.SetPaySelectionScheduleAmt=function(n,i,r,u,f){if(this.isCalloutActive()||f==null)return"";this.setCalloutActive(!0);var o=r.getValue("AD_Client_ID"),s=r.getValue("C_PaySelection_ID"),h=f.toString()+","+o.toString()+","+s,e=VIS.dataContext.getJSONRecord("Pay/GetScheduleData",h);return e!=null&&(r.setValue("C_Invoice_ID",e.C_Invoice_ID),r.setValue("PayAmt",t.getValueOfDecimal(e.OpenAmt)-t.getValueOfDecimal(e.DISCOUNT1)-t.getValueOfDecimal(e.DISCOUNT2)),r.setValue("OpenAmt",e.OpenAmt),r.setValue("DiscountAmt",t.getValueOfDecimal(e.DISCOUNT1)+t.getValueOfDecimal(e.DISCOUNT2)),r.setValue("WriteOffAmt",VIS.Env.ZERO),r.setValue("IsOverUnderPayment",!1),r.setValue("PaymentRule",e.PAYMENTRULE),r.setValue("VA009_PAYMENTMETHOD_ID",e.VA009_PAYMENTMETHOD_ID),r.setValue("IsSOTrx",e.IsSOTrx),r.setValue("C_InvoicePaySchedule_ID",f)),this.setCalloutActive(!1),""};i.prototype.Amounts=function(n,i,r,u,f,e){var w,g,nt,ut,p,ot;if(this.isCalloutActive())return"";if(w=n.getContextAsInt(i,"C_Order_ID"),g=n.getContextAsInt(i,"VA009_OrderPaySchedule_ID"),w>0&&g>0){if(n.getContextAsInt(i,"C_Payment_ID")==0&&n.getContextAsInt(i,"C_BPartner_ID")==0&&w==0||(nt=r.getValue("C_Currency_ID"),nt==null))return"";this.setCalloutActive(!0);var b=u.getColumnName(),l=VIS.Env.ZERO,o=VIS.Env.ZERO,y=0,tt=0,st="N",rt="N";w!=0&&(ut=w.toString()+","+r.getValue("DateTrx").toString()+","+g.toString(),p=VIS.dataContext.getJSONRecord("Pay/GetOpenAmt",ut),p!=null&&(y=p.C_Currency_ID,l=p.orderopen,st=p.IsSOTrx,rt=p.IsReturnTrx,l==null&&(l=VIS.Env.ZERO),o=p.OrderDiscount,tt=p.C_ConversionType_ID));this.log.fine(" Discount= "+o+", C_Order_ID="+w+", C_Currency_ID="+y);var c=t.getValueOfDecimal(r.getValue("PayAmt")==null?VIS.Env.ZERO:r.getValue("PayAmt")),h=t.getValueOfDecimal(r.getValue("WriteOffAmt")==null?VIS.Env.ZERO:r.getValue("WriteOffAmt")),s=t.getValueOfDecimal(r.getValue("OverUnderAmt")==null?VIS.Env.ZERO:r.getValue("OverUnderAmt")),a=t.getValueOfDecimal(r.getValue("DiscountAmt")==null?VIS.Env.ZERO:r.getValue("DiscountAmt"));rt=="Y"?(c>0&&(c=c*-1,r.setValue("PayAmt",c)),a>0&&(a=a*-1),o>0&&(o=o*-1),h>0&&(h=h*-1,r.setValue("WriteOffAmt",h)),s>0&&(s=s*-1,r.setValue("OverUnderAmt",s))):(c<0&&(c=c*-1,r.setValue("PayAmt",c)),a<0&&(a=a*-1),o<0&&(o=o*-1),h<0&&(h=h*-1,r.setValue("WriteOffAmt",h)),s<0&&(s=s*-1,r.setValue("OverUnderAmt",s)));this.log.fine("Pay="+c+", Discount="+a+", WriteOff="+h+", OverUnderAmt="+s);var k=t.getValueOfInt(nt),ht=k.toString(),d=VIS.dataContext.getJSONRecord("MCurrency/GetCurrency",ht),ft=r.getValue("DateTrx"),it=0,et=t.getValueOfInt(r.getValue("C_ConversionType_ID"));et!=null&&(it=et);var ct=n.getContextAsInt(i,"AD_Client_ID"),lt=n.getContextAsInt(i,"AD_Org_ID"),v=VIS.Env.ONE;if(k>0&&y>0&&k!=y||b=="C_Currency_ID"||b=="C_ConversionType_ID"){if(this.log.fine("InvCurrency="+y+", PayCurrency="+k+", Date="+ft+", Type="+it),ot=y+","+k+","+ft+","+it+","+ct+","+lt,v=VIS.dataContext.getJSONRecord("MConversionRate/GetRate",ot),v==null||v.toString()==0){if(this.setCalloutActive(!1),y==0)return"";if(r.setValue("C_Currency_ID",y),b=="C_ConversionType_ID"){if(tt==0)return"";r.setValue("C_ConversionType_ID",tt)}return"NoCurrencyConversion"}l=(l*v).toFixed(d.StdPrecision);o=(o*v).toFixed(d.StdPrecision);this.log.fine("Rate="+v+", OrderopenAmt="+l+", DiscountAmt="+o)}if(b=="C_Currency_ID"||b=="C_ConversionType_ID")h=(h*v).toFixed(d.StdPrecision),r.setValue("WriteOffAmt",h),s=(s*v).toFixed(d.StdPrecision),r.setValue("OverUnderAmt",s),a=(a*v).toFixed(d.StdPrecision),r.setValue("DiscountAmt",a),c=l-o-h-s,r.setValue("PayAmt",c),c==l-o-h-s&&(r.setValue("DiscountAmt",VIS.Env.ZERO),r.setValue("OverUnderAmt",VIS.Env.ZERO),r.setValue("WriteOffAmt",VIS.Env.ZERO));else if(w==0)VIS.Env.ZERO!=o&&r.setValue("DiscountAmt",VIS.Env.ZERO),VIS.Env.ZERO!=h&&r.setValue("WriteOffAmt",VIS.Env.ZERO),VIS.Env.ZERO!=s&&r.setValue("OverUnderAmt",VIS.Env.ZERO);else if(b=="PayAmt"){if(r.getValue("PayAmt")>l)return r.setValue("PayAmt",l),r.setValue("DiscountAmt",VIS.Env.ZERO),r.setValue("OverUnderAmt",VIS.Env.ZERO),r.setValue("WriteOffAmt",VIS.Env.ZERO),VIS.ADialog.info("VA009_CannottIncreaseAmount"),this.setCalloutActive(!1),"";s=l-c-o-h;r.setValue("OverUnderAmt",s)}else o=a,c=l-o-h-s,r.setValue("PayAmt",c),r.setValue("DiscountAmt",o)}return n.setContext(i,"PayAmt",c),this.setCalloutActive(!1),n=i=r=u=f=e=null,""};i.prototype.Invoice=function(n,i,r,u,f){if(this.isCalloutActive()||f==null)return"";this.setCalloutActive(!0);var e=VIS.dataContext.getJSONRecord("Pay/GetSchedule",t.getValueOfInt(f));return e!=null&&r.setValue("C_InvoicePaySchedule_ID",e.C_InvoicePaySchedule_ID),this.setCalloutActive(!1),""};i.prototype.PaymentBaseType=function(n,t,i,r,u,f){return this.isCalloutActive()?"":(u.toString()=="B"?(i.setValue("VA009_PaymentMode","C"),i.getField("VA009_PaymentMode").setReadOnly(!0),i.setValue("VA009_PaymentType","S"),i.getField("VA009_PaymentType").setReadOnly(!0),i.setValue("VA009_PaymentTrigger","S"),i.getField("VA009_PaymentTrigger").setReadOnly(!0),i.setValue("VA009_PaymentRule","M"),i.getField("VA009_PaymentRule").setReadOnly(!0)):(i.setValue("VA009_PaymentMode","B"),i.getField("VA009_PaymentMode").setReadOnly(!0),i.setValue("VA009_PaymentType",null),i.getField("VA009_PaymentType").setReadOnly(!1),i.setValue("VA009_PaymentTrigger",null),i.getField("VA009_PaymentTrigger").setReadOnly(!1),i.setValue("VA009_PaymentRule",null),i.getField("VA009_PaymentRule").setReadOnly(!1)),this.setCalloutActive(!1),n=t=i=r=u=f=null,"")};i.prototype.PaymentTrigger=function(n,t,i,r,u,f){return this.isCalloutActive()?"":(u!=null&&(u.toString()=="R"?i.setValue("VA009_IsMandate","Y"):i.setValue("VA009_IsMandate","N")),this.setCalloutActive(!1),n=t=i=r=u=f=null,"")};i.prototype.DisplayBPmandate=function(n,t,i,r,u){var e;if(this.isCalloutActive()||u==null)return"";this.setCalloutActive(!0);var o=i.getValue("VA009_PaymentMethod_ID"),s=i.getValue("AD_Client_ID"),h=o.toString()+","+s.toString(),f=VIS.dataContext.getJSONRecord("Pay/GetMandate",h);f!=null&&(e=f.VA009_IsMandate,e=="Y"?i.setValue("VA009_IsBPMandate","Y"):i.setValue("VA009_IsBPMandate","N"));this.setCalloutActive(!1)};i.prototype.DisplayBPmandatePO=function(n,t,i,r,u){var e;if(this.isCalloutActive()||u==null)return"";this.setCalloutActive(!0);var o=i.getValue("VA009_PO_PaymentMethod_ID"),s=i.getValue("AD_Client_ID"),h=o.toString()+","+s.toString(),f=VIS.dataContext.getJSONRecord("Pay/GetMandate",h);f!=null&&(e=f.VA009_IsMandate,e=="Y"?i.setValue("VA009_IsBPMandate","Y"):i.setValue("VA009_IsBPMandate","N"));this.setCalloutActive(!1)};i.prototype.PaymentMethod=function(n,i,r,u,f,e){if(this.isCalloutActive()||f==null||f.toString()=="")return"";var o=VIS.dataContext.getJSONRecord("Pay/GetPaymentRule",t.getValueOfInt(f));return o!=null&&(r.setValue("VA009_PaymentRule",o.VA009_PAYMENTRULE),r.setValue("VA009_PAYMENTTRIGGER",o.VA009_PAYMENTTRIGGER)),this.setCalloutActive(!1),n=i=r=u=f=e=null,""};i.prototype.SetPaymentType=function(n,i,r,u,f,e){var o,h;if(this.isCalloutActive()||f==null||f.toString()=="")return"";if(this.setCalloutActive(!0),o=VIS.dataContext.getJSONRecord("Pay/GetPaymentRule",t.getValueOfInt(f)),h=r.getValue("C_Currency_ID"),o!=null){if(t.getValueOfInt(o.C_Currency_ID)>0&&h!=t.getValueOfInt(o.C_Currency_ID))return r.setValue("VA009_PaymentMethod_ID",null),this.setCalloutActive(!1),VIS.ADialog.info("Desired payment method does not match with price list currency"),"";var c="N",l="N",a=t.getValueOfInt(r.getValue("C_BPartner_ID")),s=VIS.dataContext.getJSONRecord("Pay/GetBPPaymentRule",a);s!=null&&(c=t.getValueOfString(s.ISVENDOR),l=t.getValueOfString(s.IsCustomer));c=="Y"?(r.setValue("PaymentRulePO",s.va009_paymentbasetypePO),l=="N"?r.setValue("PaymentRule",null):r.setValue("PaymentRule",o.VA009_PAYMENTBASETYPE)):(r.setValue("PaymentRule",o.VA009_PAYMENTBASETYPE),r.setValue("PaymentRulePO",null));r.setValue("PaymentMethod",o.VA009_PAYMENTBASETYPE)}else r.setValue("PaymentRule","T"),r.setValue("PaymentMethod","T"),r.setValue("PaymentRulePO","T");return this.setCalloutActive(!1),n=i=r=u=f=e=null,""};i.prototype.SetPaymentTypeInv=function(n,i,r,u,f,e){if(this.isCalloutActive()||f==null||f.toString()=="")return"";this.setCalloutActive(!0);var o=VIS.dataContext.getJSONRecord("Pay/GetPaymentRule",t.getValueOfInt(f)),s=r.getValue("C_Currency_ID"),h=!1;if(h=r.getValue("IsSOTrx"),o!=null){if(t.getValueOfInt(o.C_Currency_ID)>0&&s!=t.getValueOfInt(o.C_Currency_ID))return r.setValue("VA009_PaymentMethod_ID",null),this.setCalloutActive(!1),VIS.ADialog.info("Desired payment method does not match with price list currency"),"";r.setValue("PaymentRule",o.VA009_PAYMENTBASETYPE);r.setValue("PaymentMethod",o.VA009_PAYMENTBASETYPE)}else r.setValue("PaymentRule","T"),r.setValue("PaymentMethod","T"),r.setValue("PaymentRulePO","T");return this.setCalloutActive(!1),n=i=r=u=f=e=null,""};i.prototype.SetPaymentTypeOnVendor=function(n,i,r,u,f,e){var s,h,o;return this.isCalloutActive()||f==null||f.toString()==""?"":(this.setCalloutActive(!0),s=!1,h=!1,s=r.getValue("IsVendor"),h=r.getValue("IsCustomer"),o=VIS.dataContext.getJSONRecord("Pay/GetPaymentRule",t.getValueOfInt(f)),o!=null?(s?(r.setValue("PaymentRulePO",o.VA009_PAYMENTBASETYPE),h||r.setValue("PaymentRule",null)):(r.setValue("PaymentRule",o.VA009_PAYMENTBASETYPE),r.setValue("PaymentRulePO",null)),r.setValue("PaymentMethod",o.VA009_PAYMENTBASETYPE)):(r.setValue("PaymentRule","T"),r.setValue("PaymentMethod","T"),r.setValue("PaymentRulePO","T")),this.setCalloutActive(!1),n=i=r=u=f=e=null,"")};i.prototype.SetBPPaymentRuleOnPayment=function(n,i,r,u,f,e){var s,o,c,h;return this.isCalloutActive()||f==null||f.toString()==""?"":(this.setCalloutActive(!0),s=VIS.dataContext.getJSONRecord("Pay/GetBPPaymentRule",t.getValueOfInt(f)),o="A",s!=null&&(c=t.getValueOfInt(r.getValue("C_DocType_ID")),h=VIS.dataContext.getJSONRecord("Pay/GetPayBaseType",c),t.getValueOfString(s.ISVENDOR)=="N"?h!=null&&(h.DocBaseType=="ARR"&&(r.setValue("va009_paymentmethod_id",s.va009_paymentmethod_id),o=t.getValueOfString(s.va009_paymentbasetype)),h.DocBaseType=="APP"&&(r.setValue("va009_paymentmethod_id",null),o="A")):(h!=null&&(h.DocBaseType=="ARR"&&(r.setValue("va009_paymentmethod_id",null),o="A"),h.DocBaseType=="APP"&&(r.setValue("va009_paymentmethod_id",s.VA009_PO_PaymentMethod_ID),o=t.getValueOfString(s.va009_paymentbasetypePO))),t.getValueOfString(s.IsCustomer)=="Y"&&h!=null&&(h.DocBaseType=="ARR"&&(r.setValue("va009_paymentmethod_id",s.va009_paymentmethod_id),o=t.getValueOfString(s.va009_paymentbasetype)),h.DocBaseType=="APP"&&(r.setValue("va009_paymentmethod_id",s.VA009_PO_PaymentMethod_ID),o=t.getValueOfString(s.va009_paymentbasetypePO)))),o!="B"&&o!="C"&&o!="P"?o=="D"?r.setValue("TenderType","D"):o=="K"?r.setValue("TenderType","C"):o=="S"?r.setValue("TenderType","K"):o=="T"?r.setValue("TenderType","A"):o=="L"?r.setValue("TenderType","L"):r.setValue("TenderType","A"):r.setValue("va009_paymentmethod_id",null)),this.setCalloutActive(!1),n=i=r=u=f=e=null,"")};i.prototype.SetBPPaymentRule=function(n,i,r,u,f,e){if(this.isCalloutActive()||f==null||f.toString()=="")return"";this.setCalloutActive(!0);var o=VIS.dataContext.getJSONRecord("Pay/GetBPPaymentRule",t.getValueOfInt(f));return o!=null&&(t.getValueOfString(o.ISVENDOR)=="N"?r.setValue("va009_paymentmethod_id",o.va009_paymentmethod_id):r.setValue("va009_paymentmethod_id",o.VA009_PO_PaymentMethod_ID),t.getValueOfString(o.va009_paymentbasetype)!="B"&&t.getValueOfString(o.va009_paymentbasetype)!="C"&&t.getValueOfString(o.va009_paymentbasetype)!="P"?t.getValueOfString(o.va009_paymentbasetype=="D")?r.setValue("TenderType","D"):t.getValueOfString(o.va009_paymentbasetype=="K")?r.setValue("TenderType","C"):t.getValueOfString(o.va009_paymentbasetype=="S")?r.setValue("TenderType","K"):t.getValueOfString(o.va009_paymentbasetype=="T")?r.setValue("TenderType","A"):o.va009_paymentbasetype=="L"?r.setValue("TenderType","L"):r.setValue("TenderType","A"):r.setValue("va009_paymentmethod_id",null)),this.setCalloutActive(!1),n=i=r=u=f=e=null,""};i.prototype.SetInvoicePaymentRule=function(n,i,r,u,f,e){if(this.isCalloutActive()||f==null||f.toString()=="")return"";this.setCalloutActive(!0);var o=VIS.dataContext.getJSONRecord("Pay/GetInvoicePaymentRule",t.getValueOfInt(f));return o!=null&&(r.setValue("va009_paymentmethod_id",o.va009_paymentmethod_id),o.va009_paymentbasetype=="D"?r.setValue("TenderType","D"):o.va009_paymentbasetype=="K"?r.setValue("TenderType","C"):o.va009_paymentbasetype=="S"?r.setValue("TenderType","K"):o.va009_paymentbasetype=="T"?r.setValue("TenderType","A"):o.va009_paymentbasetype=="L"?r.setValue("TenderType","L"):r.setValue("TenderType","A")),this.setCalloutActive(!1),n=i=r=u=f=e=null,""};i.prototype.SetTenderType=function(n,i,r,u,f,e){if(this.isCalloutActive()||f==null||f.toString()=="")return"";this.setCalloutActive(!0);var o=VIS.dataContext.getJSONRecord("Pay/GetPaymentRule",t.getValueOfInt(f));return o!=null&&(o.VA009_PAYMENTBASETYPE=="D"?r.setValue("TenderType","D"):o.VA009_PAYMENTBASETYPE=="K"?r.setValue("TenderType","C"):o.VA009_PAYMENTBASETYPE=="S"?r.setValue("TenderType","K"):o.VA009_PAYMENTBASETYPE=="T"?r.setValue("TenderType","A"):o.VA009_PAYMENTBASETYPE=="L"?r.setValue("TenderType","L"):r.setValue("TenderType","A")),this.setCalloutActive(!1),n=i=r=u=f=e=null,""};i.prototype.SetPayAllocateAmt=function(n,i,r,u,f,e){var l,h,o;if(this.isCalloutActive()||f==null||f.toString()=="")return"";if(this.setCalloutActive(!0),l=r.getValue("C_Payment_ID"),h=r.getValue("C_Invoice_ID"),h==null)r.setValue("Amount",VIS.Env.ZERO),r.setValue("InvoiceAmt",VIS.Env.ZERO),r.setValue("DiscountAmt",VIS.Env.ZERO),r.setValue("WriteOffAmt",VIS.Env.ZERO),r.setValue("OverUnderAmt",VIS.Env.ZERO);else if(o=VIS.dataContext.getJSONRecord("Pay/GetPayAllocateAmt",l.toString()+","+h+","+f.toString()),o!=null){var s=t.getValueOfDecimal(o.Dueamt),c=t.getValueOfDecimal(o.discount),a=o.IsReturnTrx;a=="Y"&&(s>0&&(s=s*-1),c>0&&(c=c*-1));r.setValue("Amount",s);r.setValue("InvoiceAmt",s);r.setValue("DiscountAmt",VIS.Env.ZERO);r.setValue("WriteOffAmt",VIS.Env.ZERO);r.setValue("OverUnderAmt",VIS.Env.ZERO)}return this.setCalloutActive(!1),n=i=r=u=f=e=null,""};i.prototype.OrderSchedule=function(n,i,r,u,f){var o,e;return this.isCalloutActive()||f==null?"":(this.setCalloutActive(!0),o=VIS.dataContext.getJSONRecord("Pay/GetDueAmt",t.getValueOfInt(f)),o!=null?r.setValue("VA009_OrderPaySchedule_ID",o.VA009_OrderPaySchedule_ID):(r.setValue("VA009_OrderPaySchedule_ID",null),e=VIS.dataContext.getJSONRecord("Pay/GetPaymentRule",t.getValueOfInt(r.getValue("VA009_PaymentMethod_ID"))),e!=null&&(e.VA009_PAYMENTBASETYPE=="D"?r.setValue("TenderType","D"):e.VA009_PAYMENTBASETYPE=="K"?r.setValue("TenderType","C"):e.VA009_PAYMENTBASETYPE=="S"?r.setValue("TenderType","K"):e.VA009_PAYMENTBASETYPE=="T"?r.setValue("TenderType","A"):e.VA009_PAYMENTBASETYPE=="L"?r.setValue("TenderType","L"):r.setValue("TenderType","A"))),this.setCalloutActive(!1),"")};i.prototype.BankDetails=function(n,i,r,u,f){if(this.isCalloutActive()||f==null)return"";this.setCalloutActive(!0);var e=VIS.dataContext.getJSONRecord("Pay/GetBankDetails",t.getValueOfInt(f));return e!=null&&(r.setValue("C_Location_ID",e.C_Location_ID),r.setValue("RoutingNo",e.RoutingNo)),this.setCalloutActive(!1),""};i.prototype.SetPayBaseType=function(n,i,r,u,f){if(this.isCalloutActive()||f==null)return"";this.setCalloutActive(!0);var e=VIS.dataContext.getJSONRecord("Pay/GetPayBaseType",t.getValueOfInt(f));return e!=null&&r.setValue("VA009_PayBaseType",e.DocBaseType),this.setCalloutActive(!1),""};i.prototype.ComparePayMethod=function(n,i,r,u,f){if(f==null)return"";var e=VIS.dataContext.getJSONRecord("Pay/VerifyPayMethod",t.getValueOfInt(f));return e!=null&&e==0&&r.setValue("VA009_PaymentMethod_ID",null),""};i.prototype.ClearCardFields=function(n,i,r,u,f){if(f==null)return"";var e=t.getValueOfString(r.getValue("TenderType"));return e!="C"&&(r.setValue("CreditCardType",null),r.setValue("CreditCardNumber",null),r.setValue("CreditCardExpMM",1),r.setValue("CreditCardExpYY",3)),""};i.prototype.SetBankCurrency=function(n,i,r,u,f){if(this.isCalloutActive()||f==null)return"";this.setCalloutActive(!0);var e=VIS.dataContext.getJSONRecord("Pay/GetBankCurrency",t.getValueOfInt(f));return e!=null&&r.setValue("C_Currency_ID",e.C_Currency_ID),this.setCalloutActive(!1),""};n.Model=n.Model||{};n.Model.VA009_CalloutPayment=i;VIS.Utility.inheritPrototype(r,VIS.CalloutEngine);r.prototype.SetPayScheduleTabDisabled=function(n,t,i,r,u){return this.isCalloutActive()||u==null||u.toString()==""?"":(this.setCalloutActive(!0),u==!0?i.setValue("VA009_IsPayScheduleTabDisabled",!0):i.setValue("VA009_IsPayScheduleTabDisabled",!1),this.setCalloutActive(!1),"")};n.Model=n.Model||{};n.Model.VA009_CalloutPaymentTerm=r}(VA009,jQuery);VA009=window.VA009||{},function(n,t){n.DownloadXML=function(){function o(){f='<div style="padding: 10px; " class="VA009-tabs-wrap"> <ul class="VA009-right-tabs"> <li class="VA009-active-tab" id = VA009_DownlaodXML_'+u.windowNo+">Generate XML<\/li><\/ul> <\/div>";i.append(f)}function s(){e=i.find("#VA009_DownlaodXML_"+u.windowNo)}function h(){e.on("touchstart click",function(){c(l)})}function c(n){console.log("RecordID "+r);t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetXMLPath",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{FileName:"Hell",RecordID:r},success:function(t){n(t)},error:function(){VIS.ADialog.error("VA009_ErrorLoadingPayments")}})}function l(n){var i=JSON.parse(n),t;i!=""&&(t=document.createElement("a"),typeof t.download=="string"?(t.href=i,t.setAttribute("download","XMLFile"),t.name="abc",document.body.appendChild(t),t.click(),document.body.removeChild(t)):window.open(uri))}this.frame;this.windowNo;var n,u=this,i=t('<div class="VA009-assign-content">'),f,e,r=0;this.setRecordID=function(n){r=n};this.Initialize=function(){o();s();h()};this.getRoot=function(){return i}};n.DownloadXML.prototype.init=function(n,t){this.windowNo=n;this.frame=t;this.Initialize();this.frame.getContentGrid().append(this.getRoot())}}(VA009,jQuery)