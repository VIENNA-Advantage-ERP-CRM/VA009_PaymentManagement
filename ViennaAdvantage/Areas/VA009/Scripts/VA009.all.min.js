/*Version 2.1.6.0*/VA009=window.VA009||{},function(n,t){n.PaymentForm=function(){function ro(){uo();fo();oo();it.loadOrg();it.loadPaymentMethods();it.loadStatus();po();nt=1;fe(wr,br,nt,wu,hr,fu,li,eu,gr.val(),99,gi,cr.val(),lr.val(),ee);se=!0;ru.autocomplete({minLength:0,source:function(n,t){n.term.trim().length!=0&&co(n.term,t,"GetBPName")},select:function(n,i){ci.indexOf(i.item.ids)==-1&&(er.find("li").length>0?(er.append("<ul><li id=VA009_li_"+i.item.ids+'><i title="'+VIS.Msg.getMsg("VA009_Cancel")+'"  class="VA009-cross-btn vis vis-mark" id=VA009_Delimg_'+i.item.ids+"><\/i> <span>"+i.item.value+"<\/span><\/li>"),ci.push(i.item.ids),ti("cb.C_BPartner_ID",ci)):(er.append("<ul><li id=VA009_li_"+i.item.ids+'><i title="'+VIS.Msg.getMsg("VA009_Cancel")+'"  class="VA009-cross-btn vis vis-mark" id=VA009_Delimg_'+i.item.ids+"><\/i> <span>"+i.item.value+"<\/span><\/li>"),ci.push(i.item.ids),ti("cb.C_BPartner_ID",ci)),kr=!0,t(this).val(""),b.find(".VA009-payment-wrap").remove(),l.find(".VA009-right-data-main").remove(),l.find(".VA009-accordion").remove(),nt=1,et(),ot())}})}function et(){noPages=1}function at(){wi=[];pi=[];bi=[];lt=[];ft.text(0);ft.data("ttlamt",parseFloat(0))}function uo(){ii='<div class="VA009-main-container" id="VA009-main-container_'+f.windowNo+'"> <table id="VA009_table_'+f.windowNo+'" style="width: 100%;"><tr><td id="VA009_tdLeft_'+f.windowNo+'" style="width: 200px; position: relative;"> <div class="VA009-left-part vis-leftsidebarouterwrap" id=VA009_leftpart_'+f.windowNo+">";_btnToggle="<div class='VA009-left-title' ><i class='VA009-toggle-btn fa fa-bars' id='VA009_toggleImg_"+f.windowNo+"' ><\/i><\/div>";ii+=_btnToggle;ii+='<div class="VA009-left-part" style="overflow:auto;" id=VA009_leftpartdata_'+f.windowNo+">";ii+='<div class="VA009-left-data"><div class="vis-input-wrap"><div class="vis-control-wrap"> <select id = VA009_Org_'+f.windowNo+"> <\/select> <label>"+VIS.Msg.getMsg("VA009_Org")+'<\/label><\/div><\/div>  <div class="VA009-value-list" id= VA009_OrgdataDiv_'+f.windowNo+"> <\/div> <\/div>";ii+='<div class="VA009-left-data"><div class="vis-input-wrap"><div class="vis-control-wrap">  <input type="text" id = VA009_BPartner_'+f.windowNo+"><label>"+VIS.Msg.getMsg("VA009_BPartner")+'<\/label> <\/div><\/div><div class="VA009-value-list" id= VA009_BPdataDiv_'+f.windowNo+">      <\/div> <\/div>";ii+='<div class="VA009-left-data"><div class="vis-input-wrap"><div class="vis-control-wrap"> <select id = VA009_PayMthd_'+f.windowNo+">   <\/select><label>"+VIS.Msg.getMsg("VA009_PayMthd")+'<\/label> <\/div><\/div>  <div class="VA009-value-list" id= VA009_PayMthddataDiv_'+f.windowNo+">      <\/div> <\/div>";ii+='<div class="VA009-left-data"><div class="vis-input-wrap"><div class="vis-control-wrap">  <select id = VA009_Status_'+f.windowNo+">  <\/select><label>"+VIS.Msg.getMsg("VA009_Status")+'<\/label><\/div><\/div>  <div class="VA009-value-list" id= VA009_StatusdataDiv_'+f.windowNo+">      <\/div> <\/div>";ii+='<div class="VA009-left-data"><div class="vis-input-wrap"><div class="vis-control-wrap">  <select id = VA009_DueDate_'+f.windowNo+'><option value=""><\/option> <option  value=0>'+VIS.Msg.getMsg("VA009_Current")+"<\/option>  <option value=7>"+VIS.Msg.getMsg("VA009_7Days")+"<\/option>  <option value=14 >"+VIS.Msg.getMsg("VA009_14Days")+"<\/option> <option value=30 >"+VIS.Msg.getMsg("VA009_30Days")+"<\/option> <option value=60 >"+VIS.Msg.getMsg("VA009_60Days")+"<\/option> <option value=90>"+VIS.Msg.getMsg("VA009_90Days")+'<\/option>" <\/select><label>'+VIS.Msg.getMsg("VA009_Duedate")+'<\/label><\/div><\/div>  <div class="VA009-value-list" id= VA009_DueDatedataDiv_'+f.windowNo+"> <\/div>  <\/div> ";ii+='<div class="VA009-left-data"><div class="vis-input-wrap"><div class="vis-control-wrap">  <select id = VA009_TransactionType_'+f.windowNo+'><option value=""><\/option> <option  value=0>'+VIS.Msg.getMsg("VA009_Order")+"<\/option>  <option value=1>"+VIS.Msg.getMsg("VA009_Invoice")+"<\/option> <option  value=2>"+VIS.Msg.getMsg("VA009_Journal")+'<\/option>" <\/select><label>'+VIS.Msg.getMsg("VA009_TransactionType")+'<\/label><\/div><\/div>  <div class="VA009-value-list" id= VA009_TransactionTypeDiv_'+f.windowNo+"> <\/div>  <\/div>";ii+='<div class="VA009-left-data"><div class="vis-input-wrap"><div class="vis-control-wrap">  <input type="date" max="9999-12-31" id="VA009_FromDate_'+f.windowNo+'"><label>'+VIS.Msg.getMsg("VA009_FromDate")+"<\/label><\/div><\/div> <\/div>";ii+='<div class="VA009-left-data"><div class="vis-input-wrap"><div class="vis-control-wrap">  <input type="date" max="9999-12-31" id="VA009_ToDate_'+f.windowNo+'"> <label>'+VIS.Msg.getMsg("VA009_ToDate")+"<\/label><\/div><\/div><\/div> <\/div><\/div><\/td>";pt=ii;pt+='<td><div class="VA009-content-area" id="VA009-content-area_'+f.windowNo+'">';pr='<div class="VA009-middle-wrap" id="VA009-middle-wrap_'+f.windowNo+'">';pr+='<div class="VA009-mid-top-wrap" id="VA009-mid-top-wrap_'+f.windowNo+'"> ';pr+='<div class="VA009-tabs-wrap"> <ul class="VA009-tabs"> <li class="VA009-active-tab" id = VA009_CR_Tab_'+f.windowNo+">"+VIS.Msg.getMsg("VA009_CR_Tab")+"<\/li> <li  id = VA009_CP_Tab_"+f.windowNo+">"+VIS.Msg.getMsg("VA009_CP_Tab")+'<\/li><li style="display:none;" id = VA009_XML_Tab_'+f.windowNo+">"+VIS.Msg.getMsg("VA009_GenXML_Tab")+"<\/li><\/ul><\/div>";pr+='<div class="VA009-icons-wrap">';pr+="<span><i class='vis vis-cheque' title='"+VIS.Msg.getMsg("VA009_Check")+"' id='VA009_Chkimg_"+f.windowNo+"' ><\/i><\/span> <span><i class='vis vis-cash-bag' title='"+VIS.Msg.getMsg("VA009_Cash")+"'  id='VA009_Cashimg_"+f.windowNo+"' ><\/i><\/span><span><i class='vis vis-open-file' title='"+VIS.Msg.getMsg("VA009_Batch")+"' id='VA009_Batchimg_"+f.windowNo+"' ><\/i><\/span><span><i class='vis vis-split' title='"+VIS.Msg.getMsg("VA009_Split")+"'  id='VA009_Splitimg_"+f.windowNo+"'><\/i><\/span><span><i class='vis vis-mobile-card' title='"+VIS.Msg.getMsg("VA009_PayMannual")+"'  id='VA009_PayMannualimg_"+f.windowNo+"'><\/i><\/span><span><i class='vis vis-bank-transfer' title='"+VIS.Msg.getMsg("VA009_BankToBankTransfer")+"'  id='VA009_BankToBankimg_"+f.windowNo+"'><\/i><\/span><\/div>";pt+=pr;pt+="<\/div>";pt+='  <div class="VA009-mid-search" id="VA009-mid-search_'+f.windowNo+'">';pt+=' <div class="VA009-midleftsecwrap"><div class="VA009-selectall"><input type="checkbox" id="VA009_SelectAll_'+f.windowNo+'"> <label>'+VIS.Msg.getMsg("VA009_HeaderSelectAll")+"<\/label><\/div>";pt+=' <div class="VA009-selectall VA009-total-textDiv"><label style=" font-weight: bold; text-decoration: underline; ">'+VIS.Msg.getMsg("VA009_TotlAmtBase")+' <\/label><label id="VA009_TotalSelected_'+f.windowNo+'"" style="font-weight: bold;"> 0 <\/label><\/div><\/div>';pt+='<div class="VA009-search-wrap"> <input value="" placeholder="Search..." type="text" id=VA009_SrchTxtbx_'+f.windowNo+'> <a class="VA009-search-icon" id=VA009_SrchBtn_'+f.windowNo+'><span class="vis vis-search"><\/span><\/a> <\/div>';pt+="<\/div>";pt+=' <div class="VA009-payment-list" id = VA009_Paymntlst_'+f.windowNo+">";pt+="<\/div>";pt+="<\/div>";pt+=' <div class="VA009-right-wrap">';pt+='<div class="VA009-rightsectopwrap"><div class="VA009-tabs-wrap"> <ul class="VA009-right-tabs"> <li class="VA009-active-tab" id=VA009_Funds_'+f.windowNo+">"+VIS.Msg.getMsg("VA009_Bank")+"<\/li><li id=VA009_Cashbooks_"+f.windowNo+">"+VIS.Msg.getMsg("VA009_Cashbook")+"<\/li><\/ul> <\/div>";pt+='<div class="VA009-icons-wrap"> <ul class="VA009-right-tabs"> <li class="VA009-active-tab" id = VA009_Refresh_'+f.windowNo+">"+VIS.Msg.getMsg("VA009_Refresh")+"<\/li><\/ul> <\/div><\/div>";pt+=' <div class="VA009-right-content" id = VA009_Banklst_'+f.windowNo+">";pt+="<\/div><\/div><\/td><\/tr><\/table>";w.append(pt)}function fo(){wt=w.find("#VA009_Org_"+f.windowNo);rr=w.find("#VA009_OrgdataDiv_"+f.windowNo);dt=w.find("#VA009_PayMthd_"+f.windowNo);ur=w.find("#VA009_PayMthddataDiv_"+f.windowNo);gt=w.find("#VA009_Status_"+f.windowNo);fr=w.find("#VA009_StatusdataDiv_"+f.windowNo);hf=w.find("#VA009_toggleImg_"+f.windowNo);vu=w.find("#VA009_leftpartdata_"+f.windowNo);yu=w.find("#VA009_leftpart_"+f.windowNo);b=w.find("#VA009_Paymntlst_"+f.windowNo);l=w.find("#VA009_Banklst_"+f.windowNo);si=w.find("#VA009_CR_Tab_"+f.windowNo);or=w.find("#VA009_CP_Tab_"+f.windowNo);bu=w.find("#VA009_XML_Tab_"+f.windowNo);_SelectedOrgDiv=w.find("#VA009_OrgdataDiv_"+f.windowNo);ru=w.find("#VA009_BPartner_"+f.windowNo);er=w.find("#VA009_BPdataDiv_"+f.windowNo);le=w.find("#VA009_Selectedtxt_"+f.windowNo);af=w.find("#VA009_Chkimg_"+f.windowNo);vf=w.find("#VA009_Cashimg_"+f.windowNo);yf=w.find("#VA009_Batchimg_"+f.windowNo);pf=w.find("#VA009_Splitimg_"+f.windowNo);ae=w.find("#VA009_PayMannualimg_"+f.windowNo);ve=w.find("#VA009_BankToBankimg_"+f.windowNo);ye=w.find("#VA009_table_"+f.windowNo);wf=w.find("#VA009_tdLeft_"+f.windowNo);gr=w.find("#VA009_SrchTxtbx_"+f.windowNo);pe=w.find("#VA009_SrchBtn_"+f.windowNo);ui=w.find("#VA009_DueDate_"+f.windowNo);nu=w.find("#VA009_DueDatedataDiv_"+f.windowNo);ri=w.find("#VA009_TransactionType_"+f.windowNo);ou=w.find("#VA009_TransactionTypeDiv_"+f.windowNo);cr=w.find("#VA009_FromDate_"+f.windowNo);lr=w.find("#VA009_ToDate_"+f.windowNo);vu.height(yu.height()-63);st=w.find("#VA009_SelectAll_"+f.windowNo);we=w.find("#VA009_Refresh_"+f.windowNo);cu=w.find("#VA009_Cashbooks_"+f.windowNo);lu=w.find("#VA009_Funds_"+f.windowNo);ft=w.find("#VA009_TotalSelected_"+f.windowNo)}function eo(){var r,i,n,u;for(su=jQuery.grep(lt,function(n){return n.BP.bpid==pu}),r=VIS.Utility.Util.getValueOfDecimal(ft.data("ttlamt")).toFixed(h),i=0;i<su.length;i++)n=su[i].BP.uid,lt=jQuery.grep(lt,function(t){return t.BP.uid!=n}),a=jQuery.grep(a,function(t){return t!=n}),y=jQuery.grep(y,function(t){return t!=n}),SlctdJournalPaymentIds=jQuery.grep(SlctdJournalPaymentIds,function(t){return t!=n}),d=jQuery.grep(d,function(t){return t.ID!=n}),rt=jQuery.grep(rt,function(t){return t.ID!=n}),ut=jQuery.grep(ut,function(t){return t.ID!=n}),h=su[i].BP.precision,u=su[i].BP.baseamt.toFixed(h),r=r-u;ft.data("ttlamt",parseFloat(r,h));ft.text(iu(r,h));su=[];t(".VA009-payment-list").find("div .row").find("input[data-bpid="+pu+"]").prop("checked",!1);kr=!0}function oo(){wt.on("change",function(){wt.val()>0&&(rr.find("li").length>0?hi.indexOf(wt.val())==-1?(rr.find("ul").append("<li id=VA009_li_"+wt.val()+'><i title="'+VIS.Msg.getMsg("VA009_Cancel")+'" class="VA009-cross-btn vis vis-mark" id=VA009_Delimg_'+wt.val()+"><\/i><span>"+VIS.Utility.encodeText(wt.children()[wt[0].selectedIndex].text)+"<\/span><\/li>"),hi.push(wt.val()),ti("cs.AD_Org_ID",hi)):VIS.ADialog.info("VA009_AlrdySlctd"):(rr.append("<ul><li id=VA009_li_"+wt.val()+'><i title="'+VIS.Msg.getMsg("VA009_Cancel")+'" class="VA009-cross-btn vis vis-mark" id=VA009_Delimg_'+wt.val()+"><\/i> <span>"+VIS.Utility.encodeText(wt.children()[wt[0].selectedIndex].text)+"<\/span><\/li>"),hi.push(wt.val()),ti("cs.AD_Org_ID",hi)));wt.prop("selectedIndex",0);b.find(".VA009-payment-wrap").remove();l.find(".VA009-right-data-main").remove();l.find(".VA009-accordion").remove();nt=1;a=[];y=[];d=[];rt=[];SlctdJournalPaymentIds=[];ut=[];et();ot();at()});rr.on("click",function(n){var i,r;n.target.localName=="i"&&(i="#"+n.target.id,t(i).parent().remove(),r=n.target.id.slice(n.target.id.lastIndexOf("_")+1,n.target.id.length),hi=jQuery.grep(hi,function(n){return n!=r}),rr.find("li").length>0?ti("cs.AD_Org_ID",hi):(hr="",rr.find("ul").remove()),b.find(".VA009-payment-wrap").remove(),l.find(".VA009-right-data-main").remove(),l.find(".VA009-accordion").remove(),nt=1,a=[],y=[],d=[],rt=[],SlctdJournalPaymentIds=[],ut=[],et(),ot(),at())});er.on("click",function(n){var i,r;n.target.localName=="i"&&(i="#"+n.target.id,t(i).parent().remove(),pu=n.target.id.slice(n.target.id.lastIndexOf("_")+1,n.target.id.length),ci=jQuery.grep(ci,function(n){return n!=pu}),er.find("li").length>0?ti("cb.C_BPartner_ID",ci):(eu="",er.find("ul").remove()),eo(),r=VIS.Utility.Util.getValueOfDecimal(ft.data("ttlamt")).toFixed(2),r==0&&(ft.text(0),ft.data("ttlamt",parseFloat(0))),b.find(".VA009-payment-wrap").remove(),l.find(".VA009-right-data-main").remove(),l.find(".VA009-accordion").remove(),nt=1,wi=[],pi=[],bi=[],et(),ot())});dt.on("change",function(){ur.find("li").length>0?ki.indexOf(dt.val())==-1?(ur.find("ul").append('<li ><i title="'+VIS.Msg.getMsg("VA009_Cancel")+'" class="VA009-cross-btn vis vis-mark" id=VA009_DelPayimg_'+dt.val()+"> <\/i><span>"+VIS.Utility.encodeText(dt.children()[dt[0].selectedIndex].text)+"<\/span><\/li>"),ki.push(dt.val()),ti("pm.VA009_PaymentMethod_ID",ki)):VIS.ADialog.info("VA009_AlrdySlctd"):(ur.append("<ul id=VA009_PayMthUL_"+dt.val()+' ><li ><i title="'+VIS.Msg.getMsg("VA009_Cancel")+'" class="VA009-cross-btn vis vis-mark" id=VA009_DelPayimg_'+dt.val()+"><\/i> <span>"+VIS.Utility.encodeText(dt.children()[dt[0].selectedIndex].text)+"<\/span><\/li> <\/ul>"),ki.push(dt.val()),ti("pm.VA009_PaymentMethod_ID",ki));dt.prop("selectedIndex",0);b.find(".VA009-payment-wrap").remove();l.find(".VA009-right-data-main").remove();l.find(".VA009-accordion").remove();nt=1;a=[];y=[];d=[];rt=[];SlctdJournalPaymentIds=[];ut=[];et();ot();at()});ur.on("click",function(n){var i,r;n.target.localName=="i"&&(i="#"+n.target.id,t(i).parent().remove(),r=n.target.id.slice(n.target.id.lastIndexOf("_")+1,n.target.id.length),ki=jQuery.grep(ki,function(n){return n!=r}),ur.find("li").length>0?ti("pm.VA009_PaymentMethod_ID",ki):(fu="",ur.find("ul").remove()),b.find(".VA009-payment-wrap").remove(),l.find(".VA009-right-data-main").remove(),l.find(".VA009-accordion").remove(),nt=1,a=[],y=[],d=[],rt=[],SlctdJournalPaymentIds=[],ut=[],et(),ot(),at())});gt.on("change",function(){fr.find("li").length>0?di.indexOf(gt.val())==-1?(fr.find("ul").append('<li ><i title="'+VIS.Msg.getMsg("VA009_Cancel")+'" class="VA009-cross-btn vis vis-mark" id=VA009_DelStaimg_'+gt.val()+"><\/i> <span>"+VIS.Utility.encodeText(gt.children()[gt[0].selectedIndex].text)+"<\/span><\/li>"),di.push(gt.val()),ti("cs.VA009_ExecutionStatus",di)):VIS.ADialog.info("VA009_AlrdySlctd"):(fr.append("<ul id=VA009_StatusUL_"+gt.val()+' ><li ><i title="'+VIS.Msg.getMsg("VA009_Cancel")+'" class="VA009-cross-btn vis vis-mark" id=VA009_DelStaimg_'+gt.val()+"><\/i> <span>"+VIS.Utility.encodeText(gt.children()[gt[0].selectedIndex].text)+"<\/span><\/li> <\/ul>"),di.push(gt.val()),ti("cs.VA009_ExecutionStatus",di));gt.prop("selectedIndex",0);b.find(".VA009-payment-wrap").remove();l.find(".VA009-right-data-main").remove();l.find(".VA009-accordion").remove();nt=1;a=[];y=[];d=[];rt=[];SlctdJournalPaymentIds=[];ut=[];et();ot();at()});fr.on("click",function(n){var i,r;n.target.localName=="i"&&(i="#"+n.target.id,t(i).parent().remove(),r=n.target.id.slice(n.target.id.lastIndexOf("_")+1,n.target.id.length),di.splice(di.indexOf(r),1),fr.find("li").length>0?ti("cs.VA009_ExecutionStatus",di):(li="",fr.find("ul").remove()),b.find(".VA009-payment-wrap").remove(),l.find(".VA009-right-data-main").remove(),l.find(".VA009-accordion").remove(),nt=1,a=[],y=[],d=[],rt=[],SlctdJournalPaymentIds=[],ut=[],et(),ot(),at())});ri.on("change",function(){ou.find("li").length>0?nr.indexOf(ri.val())==-1?(ou.find("ul").append('<li ><i title="'+VIS.Msg.getMsg("VA009_Cancel")+'" class="VA009-cross-btn vis vis-mark" id=VA009_DelStaimg_'+ri.val()+"><\/i> <span>"+VIS.Utility.encodeText(ri.children()[ri[0].selectedIndex].text)+"<\/span><\/li>"),nr.push(ri.val())):VIS.ADialog.info("VA009_AlrdySlctd"):(ou.find("ul").remove(),ou.append("<ul id=VA009_StatusUL_"+ri.val()+' ><li ><i title="'+VIS.Msg.getMsg("VA009_Cancel")+'" class="VA009-cross-btn vis vis-mark" id=VA009_DelStaimg_'+ri.val()+"><\/i> <span>"+VIS.Utility.encodeText(ri.children()[ri[0].selectedIndex].text)+"<\/span><\/li> <\/ul>"),nr.push(ri.val()));ri.prop("selectedIndex",0);b.find(".VA009-payment-wrap").remove();l.find(".VA009-right-data-main").remove();l.find(".VA009-accordion").remove();nt=1;a=[];y=[];d=[];rt=[];SlctdJournalPaymentIds=[];ut=[];et();gi="";for(var n in nr)n!=0&&(gi+=","),gi+=""+nr[n]+"";ot();at()});ou.on("click",function(n){var r,u,i;if(n.target.localName=="i"){r="#"+n.target.id;t(r).parent().remove();u=n.target.id.slice(n.target.id.lastIndexOf("_")+1,n.target.id.length);nr.splice(nr.indexOf(u),1);gi="";for(i in nr)i!=0&&(gi+=","),gi+=""+nr[i]+"";b.find(".VA009-payment-wrap").remove();l.find(".VA009-right-data-main").remove();l.find(".VA009-accordion").remove();nt=1;a=[];y=[];d=[];rt=[];SlctdJournalPaymentIds=[];ut=[];et();ot();at()}});cr.on("blur",function(){if(Date.parse(cr.val())<0){VIS.ADialog.info("VA009_PlzSelectProperDate");return}if(cr.val()==""){cr.val("");return}b.find(".VA009-payment-wrap").remove();l.find(".VA009-right-data-main").remove();l.find(".VA009-accordion").remove();nt=1;a=[];y=[];d=[];rt=[];SlctdJournalPaymentIds=[];ut=[];et();ot();at()});lr.on("blur",function(){if(Date.parse(lr.val())<0){VIS.ADialog.info("VA009_PlzSelectProperDate");return}if(lr.val()==""){lr.val("");return}b.find(".VA009-payment-wrap").remove();l.find(".VA009-right-data-main").remove();l.find(".VA009-accordion").remove();nt=1;a=[];y=[];d=[];rt=[];SlctdJournalPaymentIds=[];ut=[];et();ot();at()});b.on("scroll",so);b.on("click",ef);hf.on("click",function(n){n.stopPropagation();var i=wf.width();i>50&&t(vu).hide();wf.animate({width:i>50?40:200},300,"swing",function(){i<51&&t(vu).show()})});af.on("click",function(){or.hasClass("VA009-active-tab")?a.length>0||y.length>0||SlctdJournalPaymentIds.length>0?(ni=2,it.Cheque_Pay_Dialog()):VIS.ADialog.info("VA009_PlzSelct1Pay"):si.hasClass("VA009-active-tab")?a.length>0||y.length>0||SlctdJournalPaymentIds.length>0?(ni=1,it.Cheque_Rec_Dialog()):VIS.ADialog.info("VA009_PlzSelct1Pay"):VIS.ADialog.info(_iscustomer+"/"+_isvendor)});vf.on("click",function(){a.length>0&&y.length>0?VIS.ADialog.info("VA009_SelectEitherInvoiceOrOrderSchedule"):SlctdJournalPaymentIds.length>0?VIS.ADialog.info("VA009_JournalRecordCantSelected"):a.length>0||y.length>0?(ni=3,it.Cash_Dialog()):VIS.ADialog.info("VA009_PlzSelct1Pay")});yf.on("click",function(){ni=4;it.Batch_OpenDialog()});pf.on("click",function(){SlctdJournalPaymentIds.length>0?VIS.ADialog.info("VA009_JournalRecordCantSplitted"):a.length>0||y.length>0?a.length==1&&y.length==0?it.Split_Dialog():a.length==0&&y.length==1?it.Split_Dialog():VIS.ADialog.info("VA009_PlzSelctOnly1Pay"):VIS.ADialog.info("VA009_PlzSelct1Pay")});ae.on("click",function(){a.length>0||y.length>0||SlctdJournalPaymentIds.length>0?(ni=si.hasClass("VA009-active-tab")?1:2,it.Pay_ManualDialog()):it.Pay_ManualDialogBP()});ve.on("click",function(){a.length>0||y.length>0||SlctdJournalPaymentIds.length>0?VIS.ADialog.info("VA009_PlzNotSelctSch"):it.B2B_Dialog()});ui.on("change",function(){nu.find("li").length>0?ir.indexOf(ui.val())==-1?(nu.find("ul").append('<li ><i title="'+VIS.Msg.getMsg("VA009_Cancel")+'" class="VA009-cross-btn vis vis-mark" id=VA009_DelDueimg_'+ui.val()+"><\/i> <span>"+VIS.Utility.encodeText(ui.children()[ui[0].selectedIndex].text)+"<\/span><\/li>"),ir.push(ui.val()),ti("DueDate",ir)):VIS.ADialog.info("VA009_AlrdySlctd"):(nu.append("<ul id=VA009_PayMthUL_"+ui.val()+' ><li ><i title="'+VIS.Msg.getMsg("VA009_Cancel")+'" class="VA009-cross-btn vis vis-mark" id=VA009_DelDueimg_'+ui.val()+"><\/i> <span>"+VIS.Utility.encodeText(ui.children()[ui[0].selectedIndex].text)+"<\/span><\/li> <\/ul>"),ir.push(ui.val()),ti("DueDate",ir));ui.prop("selectedIndex",0);b.find(".VA009-payment-wrap").remove();l.find(".VA009-right-data-main").remove();l.find(".VA009-accordion").remove();nt=1;a=[];y=[];SlctdJournalPaymentIds=[];d=[];rt=[];ut=[];et();ot();at()});nu.on("click",function(n){var i,r;n.target.localName=="i"&&(i="#"+n.target.id,t(i).parent().remove(),r=n.target.id.slice(n.target.id.lastIndexOf("_")+1,n.target.id.length),ir=jQuery.grep(ir,function(n){return n!=r}),nu.find("li").length>0?ti("DueDate",ir):(du=99,nu.find("ul").remove()),b.find(".VA009-payment-wrap").remove(),l.find(".VA009-right-data-main").remove(),l.find(".VA009-accordion").remove(),nt=1,et(),fe(wr,br,nt,wu,hr,fu,li,eu,gr.val(),du,gi,cr.val(),lr.val(),ee))});gr.on("keypress",function(n){n.keyCode==13&&(b.find(".VA009-payment-wrap").remove(),l.find(".VA009-right-data-main").remove(),l.find(".VA009-accordion").remove(),nt=1,et(),ot(),bi=[],wi=[],pi=[],kr=!0)});pe.on("click",function(){b.find(".VA009-payment-wrap").remove();l.find(".VA009-right-data-main").remove();l.find(".VA009-accordion").remove();nt=1;et();ot();bi=[];wi=[];pi=[];kr=!0});si.on("click",function(){b.find(".VA009-payment-wrap").remove();l.find(".VA009-right-data-main").remove();l.find(".VA009-accordion").remove();br="ARI";wr="Y";nt=1;et();ot();ff(si);ue()});or.on("click",function(){b.find(".VA009-payment-wrap").remove();l.find(".VA009-right-data-main").remove();l.find(".VA009-accordion").remove();nt=1;br="API";wr="Y";nt=1;et();ot();ff(or);ue()});bu.on("click",function(){ff(bu);it.XML_Dialog()});st.on("click",function(n){var f=t(n.target),i,u,r;if(ft.text(0),ft.data("ttlamt",parseFloat(0)),n.target.type=="checkbox")if(f.prop("checked")==!0){for(b.find(":checkbox").not(":disabled").prop("checked",!0),i=[],a=[],y=[],SlctdJournalPaymentIds=[],lt=[],d=[],rt=[],ut=[],u=0;u<wi.length;u++)i.target=t(b.find(".VA009-payment-wrap").find(".VA009-clckd-checkbx[data-uid^="+wi[u]+"]"))[0],!i.target==!1&&(t(i.target).prop("disabled")||ef(i));for(r=0;r<pi.length;r++)i.target=t(b.find(".VA009-payment-wrap").find(".VA009-clckd-checkbx[data-uid^="+pi[r]+"]"))[0],!i.target==!1&&ef(i);for(r=0;r<bi.length;r++)i.target=t(b.find(".VA009-payment-wrap").find(".VA009-clckd-checkbx[data-uid^="+bi[r]+"]"))[0],!i.target==!1&&ef(i)}else a=[],y=[],SlctdJournalPaymentIds=[],lt=[],b.find(":checkbox").prop("checked",!1),st.find(":checkbox").prop("checked",!1),b.find(".VA009-payment-wrap").removeClass("VA009-payment-wrap-selctd"),ft.text(0),ft.data("ttlamt",parseFloat(0))});we.on("click",function(){b.find(".VA009-payment-wrap").remove();l.find(".VA009-right-data-main").remove();l.find(".VA009-accordion").remove();cu.removeClass("VA009-active-tab");lu.addClass("VA009-active-tab");br="ARI";wr="Y";nt=1;et();ot();ff(si);ue()});cu.on("click",function(){cu.removeClass("VA009-active-tab");lu.removeClass("VA009-active-tab");cu.addClass("VA009-active-tab");l.find(".VA009-right-data-main").hide();l.find(".VA009-accordion").hide();sr=w.find("#VA009_cashbkdiv_"+f.windowNo);sr.show()});lu.on("click",function(){cu.removeClass("VA009-active-tab");lu.removeClass("VA009-active-tab");lu.addClass("VA009-active-tab");l.find(".VA009-right-data-main").show();l.find(".VA009-accordion").show();sr=w.find("#VA009_cashbkdiv_"+f.windowNo);sr.hide()})}function ff(n){si.removeClass("VA009-active-tab");or.removeClass("VA009-active-tab");bu.removeClass("VA009-active-tab");n.addClass("VA009-active-tab");st.prop("checked",!1);a=[];y=[];SlctdJournalPaymentIds=[];at()}function ef(n){var i=t(n.target),o,l,e,c,r,u,f;if(i.hasClass("vis vis-edit"))cf=i.data("uid"),o=i.data("invoiceid"),l=i.data("transactiontype"),l=="Invoice"?si.hasClass("VA009-active-tab")?yr(o,"Invoice (Customer)","C_Invoice_ID"):yr(o,"Invoice (Vendor)","C_Invoice_ID"):l=="Order"?si.hasClass("VA009-active-tab")?yr(o,"Sales Order","C_Order_ID"):yr(o,"Purchase Order","C_Order_ID"):l=="GL Journal"&&yr(o,"GL Journal Line","GL_Journal_ID"),cf=0;else if(n.target.type=="checkbox")if(i.prop("checked")==!0){i.parents(".VA009-payment-wrap").addClass("VA009-payment-wrap-selctd");i.data("name")=="Invoice"?(a.push(i.data("uid")),lt.push({BP:i.data()}),d.push({ID:i.data("uid"),PM:i.data()})):i.data("name")=="Order"?(y.push(i.data("uid")),lt.push({BP:i.data()}),rt.push({ID:i.data("uid"),PM:i.data()})):(SlctdJournalPaymentIds.push(i.data("uid")),lt.push({BP:i.data()}),ut.push({ID:i.data("uid"),PM:i.data()}));var v=a.length+y.length+SlctdJournalPaymentIds.length,s=t(b.find(".VA009-payment-wrap")).length,p=t(".VA009-payment-list").find("input[type=checkbox]:checked").length,w=t(".VA009-payment-list").find("input[type=checkbox]:not(:checked)").length;(s==v&&w==0||s==p)&&st.prop("checked",!0);tt=i.data("uid");h=i.data("precision");u=VIS.Utility.Util.getValueOfDecimal(ft.text()).toFixed(h);u=VIS.Utility.Util.getValueOfDecimal(ft.data("ttlamt")).toFixed(h);f=VIS.Utility.Util.getValueOfDecimal(i.data("baseamt")).toFixed(h);(i.data("docbasetype")=="ARC"||i.data("docbasetype")=="APC")&&(f=-1*f);c=VIS.Utility.Util.getValueOfDecimal(u)+VIS.Utility.Util.getValueOfDecimal(f);ft.data("ttlamt",parseFloat(c,h));ft.text(iu(c,h))}else st.prop("checked",!1),i.parents(".VA009-payment-wrap").removeClass("VA009-payment-wrap-selctd"),e=i.data("uid"),a=jQuery.grep(a,function(n){return n!=e}),y=jQuery.grep(y,function(n){return n!=e}),SlctdJournalPaymentIds=jQuery.grep(SlctdJournalPaymentIds,function(n){return n!=e}),d=jQuery.grep(d,function(n){return n.ID!=e}),rt=jQuery.grep(rt,function(n){return n.ID!=e}),ut=jQuery.grep(ut,function(n){return n.ID!=e}),lt=jQuery.grep(lt,function(n){return n.BP.uid!=e}),tt=0,h=i.data("precision"),u=VIS.Utility.Util.getValueOfDecimal(ft.text()).toFixed(h),u=VIS.Utility.Util.getValueOfDecimal(ft.data("ttlamt")).toFixed(h),f=VIS.Utility.Util.getValueOfDecimal(i.data("baseamt")).toFixed(h),(i.data("docbasetype")=="ARC"||i.data("docbasetype")=="APC")&&(f=-1*f),c=VIS.Utility.Util.getValueOfDecimal(u)-VIS.Utility.Util.getValueOfDecimal(f),ft.data("ttlamt",parseFloat(c,h)),ft.text(iu(c,h));else if(i.hasClass("VA009_AddNoteimg"))tt=i.data("uid"),it.ChatWindow();else if(i.hasClass("VA009-info-icon"))infoWinID=i.data("uid"),yr(infoWinID,"Business Partner Info","C_BPartner_ID");else if(i.parents(".VA009-payment-wrap")&&!i.is(".VA009-payment-list"))if(i.parents(".VA009-payment-wrap").find(".VA009-clckd-checkbx").prop("checked")==undefined)if(i.find(".VA009-clckd-checkbx").prop("checked"))i.find(":checkbox").not(":disabled").prop("checked",!1),i.removeClass("VA009-payment-wrap-selctd"),r=i.find(".VA009-clckd-checkbx")[0],tt=VIS.Utility.Util.getValueOfInt(r.dataset.uid),a=jQuery.grep(a,function(n){return n!=tt}),y=jQuery.grep(y,function(n){return n!=tt}),SlctdJournalPaymentIds=jQuery.grep(SlctdJournalPaymentIds,function(n){return n!=tt}),d=jQuery.grep(d,function(n){return n.ID!=tt}),rt=jQuery.grep(rt,function(n){return n.ID!=tt}),ut=jQuery.grep(ut,function(n){return n.ID!=tt}),lt=jQuery.grep(lt,function(n){return n.BP.uid!=tt}),h=VIS.Utility.Util.getValueOfInt(r.dataset.precision),u=VIS.Utility.Util.getValueOfDecimal(ft.data("ttlamt")).toFixed(h),f=VIS.Utility.Util.getValueOfDecimal(r.dataset.baseamt).toFixed(h),(r.dataset.docbasetype=="ARC"||r.dataset.docbasetype=="APC")&&(f=-1*f),u=VIS.Utility.Util.getValueOfDecimal(u)-VIS.Utility.Util.getValueOfDecimal(f),ft.data("ttlamt",parseFloat(u,h)),ft.text(iu(u,h));else{i.find(":checkbox").not(":disabled").prop("checked",!0);i.addClass("VA009-payment-wrap-selctd");r=i.find(".VA009-clckd-checkbx")[0];tt=VIS.Utility.Util.getValueOfInt(r.dataset.uid);r.dataset.name=="Invoice"?(a.push(tt),lt.push({BP:r.dataset}),d.push({ID:tt,PM:r.dataset})):r.dataset.name=="Order"?(y.push(tt),lt.push({BP:r.dataset}),rt.push({ID:tt,PM:r.dataset})):(SlctdJournalPaymentIds.push(tt),lt.push({BP:r.dataset}),ut.push({ID:tt,PM:r.dataset}));var v=a.length+y.length+SlctdJournalPaymentIds.length,s=t(b.find(".VA009-payment-wrap")).length,p=t(".VA009-payment-list").find("input[type=checkbox]:checked").length,w=t(".VA009-payment-list").find("input[type=checkbox]:not(:checked)").length;(s==v&&w==0||s==p)&&st.prop("checked",!0);h=VIS.Utility.Util.getValueOfInt(r.dataset.precision);u=VIS.Utility.Util.getValueOfDecimal(ft.data("ttlamt")).toFixed(h);f=VIS.Utility.Util.getValueOfDecimal(r.dataset.baseamt).toFixed(h);(r.dataset.docbasetype=="ARC"||r.dataset.docbasetype=="APC")&&(f=-1*f);u=VIS.Utility.Util.getValueOfDecimal(u)+VIS.Utility.Util.getValueOfDecimal(f);ft.data("ttlamt",parseFloat(u,h));ft.text(iu(u,h))}else if(i.parents(".VA009-payment-wrap").find(".VA009-clckd-checkbx").prop("checked"))i.parents(".VA009-payment-wrap").find(".VA009-clckd-checkbx").prop("checked",!1),i.parents(".VA009-payment-wrap").removeClass("VA009-payment-wrap-selctd"),r=i.parents(".VA009-payment-wrap").find(".VA009-clckd-checkbx")[0],tt=VIS.Utility.Util.getValueOfInt(r.dataset.uid),a=jQuery.grep(a,function(n){return n!=tt}),y=jQuery.grep(y,function(n){return n!=tt}),SlctdJournalPaymentIds=jQuery.grep(SlctdJournalPaymentIds,function(n){return n!=tt}),d=jQuery.grep(d,function(n){return n.ID!=tt}),rt=jQuery.grep(rt,function(n){return n.ID!=tt}),ut=jQuery.grep(ut,function(n){return n.ID!=tt}),lt=jQuery.grep(lt,function(n){return n.BP.uid!=tt}),h=VIS.Utility.Util.getValueOfInt(r.dataset.precision),u=VIS.Utility.Util.getValueOfDecimal(ft.data("ttlamt")).toFixed(h),f=VIS.Utility.Util.getValueOfDecimal(r.dataset.baseamt).toFixed(h),(r.dataset.docbasetype=="ARC"||r.dataset.docbasetype=="APC")&&(f=-1*f),u=VIS.Utility.Util.getValueOfDecimal(u)-VIS.Utility.Util.getValueOfDecimal(f),ft.data("ttlamt",parseFloat(u,h)),ft.text(iu(u,h));else{if(i.parents(".VA009-payment-wrap").find(".VA009-clckd-checkbx").prop("disabled")==!0)return;i.parents(".VA009-payment-wrap").find(".VA009-clckd-checkbx").prop("checked",!0);i.parents(".VA009-payment-wrap").addClass("VA009-payment-wrap-selctd");r=i.parents(".VA009-payment-wrap").find(".VA009-clckd-checkbx")[0];tt=VIS.Utility.Util.getValueOfInt(r.dataset.uid);r.dataset.name=="Invoice"?(a.push(tt),lt.push({BP:r.dataset}),d.push({ID:tt,PM:r.dataset})):r.dataset.name=="Order"?(y.push(tt),lt.push({BP:r.dataset}),rt.push({ID:tt,PM:r.dataset})):(SlctdJournalPaymentIds.push(tt),lt.push({BP:r.dataset}),ut.push({ID:tt,PM:r.dataset}));var v=a.length+y.length+SlctdJournalPaymentIds.length,s=t(b.find(".VA009-payment-wrap")).length,p=t(".VA009-payment-list").find("input[type=checkbox]:checked").length,w=t(".VA009-payment-list").find("input[type=checkbox]:not(:checked)").length;(s==v&&w==0||s==p)&&st.prop("checked",!0);h=VIS.Utility.Util.getValueOfInt(r.dataset.precision);u=VIS.Utility.Util.getValueOfDecimal(ft.data("ttlamt")).toFixed(h);f=VIS.Utility.Util.getValueOfDecimal(r.dataset.baseamt).toFixed(h);(r.dataset.docbasetype=="ARC"||r.dataset.docbasetype=="APC")&&(f=-1*f);u=VIS.Utility.Util.getValueOfDecimal(u)+VIS.Utility.Util.getValueOfDecimal(f);ft.data("ttlamt",parseFloat(u,h));ft.text(iu(u,h))}}function ti(n,t){if(n.contains("Org"))hr=" AND "+n+" IN ("+t+")";else if(n.contains("PaymentMethod"))fu=" AND "+n+" IN ("+t+")";else if(n.contains("BPartner"))eu=" AND "+n+" IN ("+t+")";else if(n.contains("Status")){if(t!=""){li=" AND "+n+" IN (";for(var i in t)li+="'"+t[i]+"',";li=li.slice(0,-1)+")"}}else n.contains("DueDate")&&(du=Math.max.apply(Math,ir))}function ue(){ci=[];a=[];y=[];SlctdJournalPaymentIds=[];b.find(":checkbox").prop("checked",!1);st.find(":checkbox").prop("checked",!1);d=[];rt=[];ut=[];at()}function iu(n,t){return n&&typeof n=="number"&&(n=parseFloat(n).toLocaleString(undefined,{minimumFractionDigits:t})),n}function ke(n,t){return n.C_BPartner_Location_ID<t.C_BPartner_Location_ID?-1:n.C_BPartner_Location_ID>t.C_BPartner_Location_ID?1:0}function o(n,t){return t=oi(n,t),t=kt.GetFormatAmount(t,"init",k),kt.GetConvertedString(t,k)}function vr(n,t){function i(t){if(t!=null&&t.length>0){n.find("option").remove();n.append("<option value='0'><\/option>");for(var i in t)n.append("<option value="+VIS.Utility.Util.getValueOfInt(t[i].C_Bank_ID)+">"+VIS.Utility.encodeText(t[i].Name)+"<\/option>");n.prop("selectedIndex",0)}}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadBank",{Orgs:t.toString()},i)}function so(){t(this).scrollTop()+t(this).innerHeight()+5>=this.scrollHeight&&nt<noPages&&(nt++,hi.length==0&&(hr=VIS.context.getAD_Org_ID()<=0?"":"AND cs.AD_Org_ID IN ("+VIS.context.getAD_Org_ID()+")"),ot(),kr=!0)}function de(n,i){v[0].style.visibility="visible";t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/prepareDataForPaymentFile",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!0,data:{DocNumber:n,isBatch:i},success:function(t){var r,u;t=JSON.parse(t);for(r in t)t[r]._error!=null?(u=t[r]._error,i?VIS.ADialog.info(u+","+VIS.Msg.getMsg("BatchIsCompleted")+n):VIS.ADialog.info(u+","+VIS.Msg.getMsg("VA009_PaymentCompletedWith")+n)):to("\\PaymentFiles\\"+t[r]._filename,r);v[0].style.visibility="hidden"},error:function(){VIS.ADialog.error("VA009_ErrorLoadingPayments");v[0].style.visibility="hidden"}})}function ge(n){function u(){$xml=null;r=null}var r,i;$xml=t("<div class='VA009-popform-content' style='min-height:333px !important'>");r="";r+="<div class='VA009-popform-data'><label>"+VIS.Msg.getMsg("VA009_GenXML_Tab")+"<\/label><\/div>  <div class='VA009-table-container' id='VA009_btnPopupGrid'>  <\/div> <\/div>";$xml.append(r);i=new VIS.ChildDialog;i.setContent($xml);i.setTitle(VIS.Msg.getMsg("VA009_GenXML_Tab"));i.setWidth("60%");i.setEnableResize(!0);i.setModal(!0);i.show();he=$xml.find("#VA009_btnPopupGrid");n=="B"?vo():n=="M";i.onOkClick=function(){VIS.ADialog.info("VA009_GenXML_Tab")};i.onCancelCLick=function(){u()};i.onClose=function(){u()}}function ho(){var n,t;try{if(n=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/GetBatchProcess",null,null),n!=null){var i=n.AD_Process_ID,r=n.Name,u=n.ClassName,e=n.EntityType;i>0?(t=new VIS.ParameterDialog(f.windowNo,f),t.initDialog(i,r,e,u,!1),t.onCloseMain=function(n){v[0].style.visibility=n?"visible":"hidden"},t.showDialog(),t=null):VIS.ADialog.info("ProcessNotFound",!0,"","")}b.find(".VA009-payment-wrap").remove();l.find(".VA009-right-data-main").remove();l.find(".VA009-accordion").remove();nt=1;a=[];y=[];SlctdJournalPaymentIds=[];d=[];rt=[];ut=[];et();ot();at();v[0].style.visibility="hidden"}catch(o){}}function co(n,i,r){t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/"+r,dataType:"json",data:{searchText:n},success:function(n){var r=JSON.parse(n);datasource=[];i(t.map(r,function(n){return{label:n.Name,value:n.Name,ids:n.C_BPartner_ID}}));t(ru).autocomplete("search","");t(ru).trigger("focus")}})}function fe(n,i,r,u,f,e,o,s,h,c,l,a,y,p){var w=ao();v[0].style.visibility="visible";of=e+o+s+f;no(n,i,of);t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetData",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!0,data:{pageNo:r,pageSize:u,whereQry:uu,OrgWhr:f,SearchText:w,WhrDueDate:c,TransType:l,FromDate:a,ToDate:y},success:function(n){p(n)},error:function(){VIS.ADialog.error("VA009_ErrorLoadingPayments");v[0].style.visibility="hidden"}})}function ee(n){var et=0,ot="",e="",i=JSON.parse(n),r,g,a,tt,y,rt,u,yt,h,d;if(i.paymentdata.length==0&&st.is(":checked")&&st.trigger("click"),i.paymentdata.length>0){nt==1&&i.paymentdata.length>0&&(paymentCount=i.paymentdata[0].paymentCount,noPages=Math.ceil(paymentCount/oe));for(r in i.paymentdata)et=et+1,i.paymentdata[r].TransactionType=="Invoice"?wi.indexOf(i.paymentdata[r].C_InvoicePaySchedule_ID)===-1?wi.push(i.paymentdata[r].C_InvoicePaySchedule_ID):console.log("This item already exists"):i.paymentdata[r].TransactionType=="Order"?pi.indexOf(i.paymentdata[r].C_InvoicePaySchedule_ID)===-1?pi.push(i.paymentdata[r].C_InvoicePaySchedule_ID):console.log("This item already exists"):bi.indexOf(i.paymentdata[r].C_InvoicePaySchedule_ID)===-1?bi.push(i.paymentdata[r].C_InvoicePaySchedule_ID):console.log("This item already exists"),i.paymentdata[r].VA009_plannedduedate!=null?(g=new Date(i.paymentdata[r].VA009_plannedduedate),g=g.toLocaleDateString(),a=g):a=i.paymentdata[r].Systemdate,i.paymentdata[r].VA009_FollowupDate!=null?(tt=new Date(i.paymentdata[r].VA009_FollowupDate),tt=tt.toLocaleDateString(),y=tt):y=i.paymentdata[r].Systemdate,rt="N",i.paymentdata[r].CurrencyCode==i.paymentdata[r].BaseCurrencyCode&&(rt="Y"),ot=i.paymentdata[r].PaymwentBaseType=="S"?"cheque-white.png":i.paymentdata[r].PaymwentBaseType=="B"?"cash-white.png":"batch-white.png",e='<div class="VA009-payment-wrap" data-UID="'+i.paymentdata[r].C_InvoicePaySchedule_ID+'"> <div class="row" data-UID="'+i.paymentdata[r].C_InvoicePaySchedule_ID+'"><div class="col-md-4 col-sm-4 width-sm-35 VA009-padd-right-0"> <input type="checkbox" class="VA009-clckd-checkbx" data-UID="'+i.paymentdata[r].C_InvoicePaySchedule_ID+'" data-BaseAmt="'+i.paymentdata[r].BaseAmt+'" data-NAME="'+i.paymentdata[r].TransactionType+'" data-bpid="'+i.paymentdata[r].C_BPartner_ID+'" data-PaymentRule="'+i.paymentdata[r].PaymentRule+'" data-PaymentType="'+i.paymentdata[r].PaymentType+'" data-precision="'+i.paymentdata[r].precision+'" data-PaymentTriggerBy="'+i.paymentdata[r].PaymentTriggerBy+'" data-PaymwentBaseType="'+i.paymentdata[r].PaymwentBaseType+'" data-DocBaseType="'+i.paymentdata[r].DocBaseType+'" data-CurrencyCode="'+i.paymentdata[r].CurrencyCode+'"  alt="'+VIS.Msg.getMsg("VA009_Select")+'" title="'+VIS.Msg.getMsg("VA009_Select")+'" '+(i.paymentdata[r].IsHoldPayment=="Y"?"disabled":"")+'><div class="VA009-pay-left"><div class="VA009-pay-img-wrap"><span class=\'VA009-pay-img\'><img src=\''+VIS.Application.contextUrl+"Areas/VA009/Images/"+ot+"' alt=''><\/span> <span class='VA009-pay-status'>"+i.paymentdata[r].VA009_ExecutionStatus+'<\/span> <\/div> <div class="VA009-pay-text"><p>'+i.paymentdata[r].C_Bpartner+"<\/p><span>"+i.paymentdata[r].C_BP_Group+"<\/span> <span>"+i.paymentdata[r].DocumentNo+"<\/span> <span>"+i.paymentdata[r].VA009_PaymentMethod+'<\/span> <\/div><\/div><\/div><div class="col-md-3 col-sm-3 width-sm-30 sm-padd VA009-padd-right-0">',y!=""&&a!=""?e+=' <div class="VA009-left-data VA009-pay-mid-sec"><span title="Due Date">'+a+'<\/span> <span class="glyphicon glyphicon-play play-icon"><\/span> <span title="Planned Due Date">'+y+"<\/span> <\/div> ":y==""&&a!=""?e+=' <div class="VA009-left-data VA009-pay-mid-sec"><span title="Due Date">'+a+"<\/span><\/div> ":y!=""&&a==""&&(e+=' <div class="VA009-left-data VA009-pay-mid-sec"><span title="Planned Due Date">'+y+"<\/span><\/div> "),e+=Globalize.format(i.paymentdata[r].VA009_RecivedAmt>0)?' <div class="VA009-left-data VA009-pay-mid-sec"> <span class="VA009-color-gray" title="'+(i.paymentdata[r].TransactionType=="Invoice"?VIS.Msg.getMsg("InvoiceAmount"):VIS.Msg.getMsg("VA009_OrderAmount"))+'">'+i.paymentdata[r].CurrencyCode+" "+parseFloat(i.paymentdata[r].TotalInvAmt).toLocaleString()+' <\/span> <br> <span class="glyphicon glyphicon-ok play-icon"><\/span> <span class="VA009-color-gray" title="'+(br=="ARI"?VIS.Msg.getMsg("VA009_TotRecAmt"):VIS.Msg.getMsg("VA009_TotPaidAmt"))+'">'+i.paymentdata[r].CurrencyCode+" "+parseFloat(i.paymentdata[r].VA009_RecivedAmt).toLocaleString()+" <\/span><\/div> ":' <div class="VA009-left-data VA009-pay-mid-sec"> <span class="VA009-color-gray" title="'+(i.paymentdata[r].TransactionType=="Invoice"?VIS.Msg.getMsg("InvoiceAmount"):VIS.Msg.getMsg("VA009_OrderAmount"))+'">'+i.paymentdata[r].CurrencyCode+" "+parseFloat(i.paymentdata[r].TotalInvAmt).toLocaleString()+" <\/span> <\/div> ",e+=' <div class="VA009-left-data VA009-pay-mid-sec"> <span data-UID="'+i.paymentdata[r].C_InvoicePaySchedule_ID+'" class="VA009_AddNote" style=" cursor: pointer;"><i class="VA009_AddNoteimg fa fa-list-alt" data-UID="'+i.paymentdata[r].C_InvoicePaySchedule_ID+'" title="'+VIS.Msg.getMsg("VA009_AddNote")+'" > <\/i><\/span> <\/div>  <div class="VA009-left-data VA009-pay-mid-sec" id="VA009-LastChat_'+f.windowNo+'"> <span class="VA009-Chatcolor-gray" id=VA009-Chatcolor-gray_'+i.paymentdata[r].C_InvoicePaySchedule_ID+">"+i.paymentdata[r].LastChat+'<\/span> <\/div>  <\/div> <div class="col-md-2 col-sm-2 width-sm-20 sm-padd VA009-padd-right-0"><div class="VA009-transactionType"> <span>'+i.paymentdata[r].TransactionType+(i.paymentdata[r].IsHoldPayment=="Y"?" ("+VIS.Msg.getMsg("VA009_HoldPayment")+")":"")+"<\/span> ",e+=i.paymentdata[r].DocBaseType=="APC"||i.paymentdata[r].DocBaseType=="ARC"?'<br><span style="text-decoration: underline;color: red;font-size: 12px;">Credit Memo<\/span> <\/div><\/div>':" <\/div><\/div>",e+=' <div class="col-md-3 col-sm-3">  <div class="VA009-right-part"><span class="vis vis-edit" data-UID="'+i.paymentdata[r].C_InvoicePaySchedule_ID+'" data-InvoiceID="'+i.paymentdata[r].C_Invoice_ID+'" data-TransactionType ="'+i.paymentdata[r].TransactionType+'" data-IsHoldPayment ="'+i.paymentdata[r].IsHoldPayment+'"  alt="'+VIS.Msg.getMsg("VA009_Edit")+'" title="'+VIS.Msg.getMsg("VA009_Edit")+'"><\/span> <span class="VA009-info-icon vis vis-info" data-UID="'+i.paymentdata[r].C_BPartner_ID+'" alt="'+VIS.Msg.getMsg("VA009_Info")+'" title="'+VIS.Msg.getMsg("VA009_Info")+'"><\/span><div class="VA009-pay-amount" id=VA009_ConvertedAmt_'+f.windowNo+"_"+i.paymentdata[r].C_InvoicePaySchedule_ID+'> <span title="Amount Due">'+i.paymentdata[r].CurrencyCode+" "+parseFloat(i.paymentdata[r].DueAmt).toLocaleString(window.navigator.language,{minimumFractionDigits:i.paymentdata[r].precision})+"<\/span><br> <\/div> <\/div> <\/div><\/div><\/div>",b.append(e),rt=="N"&&(sf=w.find("#VA009_ConvertedAmt_"+f.windowNo+"_"+i.paymentdata[r].C_InvoicePaySchedule_ID),sf.append('<span class="VA009-color-gray" title="Amount Due">'+i.paymentdata[r].BaseCurrencyCode+" "+parseFloat(i.paymentdata[r].convertedAmt).toLocaleString(window.navigator.language,{minimumFractionDigits:i.paymentdata[r].precision})+"<\/span> "));st.is(":checked")&&(st.prop("checked",!1),st.trigger("click"))}if(i.bankdetails.length>0){l.find(".VA009-right-data-main").remove();l.find(".VA009-accordion").remove();var pt=0,ht="",ct,ut=0,ft=0,p=[],o=[],k=[],lt,c,at,s="pull-right VA009-color-green",it="pull-right VA009-color-green",wt="VA009-color-green",vt=t('<div class="VA009-accordion"><\/div>');for(u in i.bankdetails)i.bankdetails[u].CurrentBalance<0&&(s="pull-right VA009-color-red"),i.bankdetails[u].UnreconsiledAmt<0&&(it="pull-right VA009-color-red"),ht==i.bankdetails[u].CurrencyCode1?(at=l.find("#VA009_bankdtl_"+i.bankdetails[u].CurrencyCode1),ct='<span class="pull-head"> '+i.bankdetails[u].BankName+" "+i.bankdetails[u].BankAccountNumber+'<\/span> <p style="margin-bottom: 0;">'+VIS.Msg.getMsg("VA009_Reconciled")+' <span class="'+s+'">'+i.bankdetails[u].CurrencyCode1+" "+parseFloat(i.bankdetails[u].CurrentBalance).toLocaleString()+"<\/span><\/p> <p>"+VIS.Msg.getMsg("VA009_Unreconciled")+' <a class="'+it+'">'+i.bankdetails[u].CurrencyCode1+" "+parseFloat(i.bankdetails[u].UnreconsiledAmt).toLocaleString()+"<\/a><\/p>",at.append(ct),ut=ut+i.bankdetails[u].CurrentBalance,ft=ft+i.bankdetails[u].UnreconsiledAmt):(lt='<div class="panel-group" id="accordion_'+i.bankdetails[u].CurrencyCode1+'" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><div class="panel-heading" role="tab" id="headingOne_'+i.bankdetails[u].CurrencyCode1+'"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#accordion_'+i.bankdetails[u].CurrencyCode1+'" href="#collapseOne_'+i.bankdetails[u].CurrencyCode1+'" aria-expanded="true" aria-controls="collapseOne" class="VA009-Accordion-head" id=VA009_TotalAmtCurr_'+i.bankdetails[u].CurrencyCode1+'><\/a><\/h4><\/div><div id="collapseOne_'+i.bankdetails[u].CurrencyCode1+'" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne" style="height: auto;"><div class="panel-body" id=VA009_bankdtl_'+i.bankdetails[u].CurrencyCode1+'><span class="pull-head"> '+i.bankdetails[u].BankName+" "+i.bankdetails[u].BankAccountNumber+'<\/span><p style="margin-bottom: 0;">'+VIS.Msg.getMsg("VA009_Reconciled")+' <span class="'+s+'">'+i.bankdetails[u].CurrencyCode1+" "+parseFloat(i.bankdetails[u].CurrentBalance).toLocaleString()+"<\/span><\/p> <p>"+VIS.Msg.getMsg("VA009_Unreconciled")+' <a class="'+it+'">'+i.bankdetails[u].CurrencyCode1+" "+parseFloat(i.bankdetails[u].UnreconsiledAmt).toLocaleString()+"<\/a><\/p> <\/div><\/div><\/div> <\/div>",vt.append(lt),l.append(vt),ut+=i.bankdetails[u].CurrentBalance,ft+=i.bankdetails[u].UnreconsiledAmt),o.indexOf(i.bankdetails[u].CurrencyCode1)==-1?(o.push(i.bankdetails[u].CurrencyCode1),c=o.indexOf(i.bankdetails[u].CurrencyCode1),p[c]=0,k[c]=0):c=o.indexOf(i.bankdetails[u].CurrencyCode1),p[c]=parseFloat(p[c])+parseFloat(i.bankdetails[u].CurrentBalance),k[c]=parseFloat(k[c])+parseFloat(i.bankdetails[u].UnreconsiledAmt),pt=i.bankdetails[u].C_Bank_ID,ht=i.bankdetails[u].CurrencyCode1,s="pull-right VA009-color-green",it="pull-right VA009-color-green";for(h in o)yt=l.find("#VA009_TotalAmtCurr_"+o[h]),s=p[h]<0?"VA009-color-red":"VA009-color-green",wt=k[h]<0?"VA009-color-red":"VA009-color-green",yt.append('<div class="VA009-panel-head-total"> <div><span class="VA009-head-currency-name">'+o[h]+'<\/span><span><i class="glyphicon glyphicon-chevron-down pull-right"><\/i><\/span><\/div><p>'+VIS.Msg.getMsg("VA009_Reconciled")+' <span class="'+s+'">'+o[h]+" "+parseFloat(p[h]).toLocaleString()+" <\/span><\/p> <p>"+VIS.Msg.getMsg("VA009_Unreconciled")+' <a class="VA009-color-green">'+o[h]+" "+parseFloat(k[h]).toLocaleString()+"<\/a><\/p><\/div>");l.append("<\/div><\/div>")}else l.find(".VA009-right-data-main").remove(),l.find(".VA009-accordion").remove();if(i.Cbk.length>0){l.append(' <div class="VA009-right-data-main" style="display: none;" id=VA009_cashbkdiv_'+f.windowNo+"> <\/div>");sr=w.find("#VA009_cashbkdiv_"+f.windowNo);sr.append(" <h5>"+VIS.Msg.getMsg("VA009_Cashbook")+"<\/h5> ");for(d in i.Cbk)i.Cbk[d].Csb_Amt<0&&(s="pull-right VA009-color-red"),sr.append('<div class="VA009-right-data">  <p class="VA009-data-top">  <span class="pull-left"> '+i.Cbk[d].CashBookName+'<\/span> <span class="'+s+'">'+i.Cbk[d].CBCurrencyCode+" "+parseFloat(i.Cbk[d].Csb_Amt).toLocaleString()+"<\/span>  <\/p>  <\/div>"),s="pull-right VA009-color-green"}ru.val("");!st.is(":checked");kr&&(kr=!1,lo());v[0].style.visibility="hidden"}function lo(){for(var n=0;n<a.length;n++)t(".VA009-payment-list").find("div .row").find("input[data-uid="+a[n]+"]").prop("checked",!0),t(".VA009-payment-wrap[data-uid="+a[n]+"]").addClass("VA009-payment-wrap-selctd");for(n=0;n<y.length;n++)t(".VA009-payment-list").find("div .row").find("input[data-uid="+y[n]+"]").prop("checked",!0),t(".VA009-payment-wrap[data-uid="+y[n]+"]").addClass("VA009-payment-wrap-selctd");for(n=0;n<SlctdJournalPaymentIds.length;n++)t(".VA009-payment-list").find("div .row").find("input[data-uid="+SlctdJournalPaymentIds[n]+"]").prop("checked",!0),t(".VA009-payment-wrap[data-uid="+SlctdJournalPaymentIds[n]+"]").addClass("VA009-payment-wrap-selctd")}function ao(){var t=be.isDecimalSeparatorDot(window.navigator.language),n=gr.val();return n==""||t||n.contains("=")||n.contains(",")&&(n=n.replace(",",".")),n}function vo(){v[0].style.visibility="visible";t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetPaymentScheduleBatch",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!0,data:{FileName:"Hell",RecordID:1221},success:function(n){n=JSON.parse(n);yo(n)},error:function(){VIS.ADialog.error("VA009_ErrorLoadingPayments");v[0].style.visibility="hidden"}})}function yo(n){var i,r,t;if(v[0].style.visibility="hidden",console.log(n.result),console.log(n),n.result)for(r="",t=0;t<n.result.length;t++)i='<div class="VA009-payment-wrap" data-UID="'+n.result[t].DocumentNo+'"> <div class="row" data-UID="'+n.result[t].DocumentNo+'"><div class="col-md-4 col-sm-4 width-sm-35"> <input type="checkbox" class="VA009-clckd-checkbx" data-UID="'+n.result[t].DocumentNo+'" data-BaseAmt="'+n.paymentdata[t].BaseAmt+'"  data-NAME="'+n.result[t].DocumentNo+'" data-PaymentRule="'+n.result[t].PaymentRule+'" data-PaymentType="'+n.result[t].PaymentType+'" data-PaymentTriggerBy="'+n.result[t].PaymentTriggerBy+'" data-PaymwentBaseType="'+n.result[t].PaymwentBaseType+'" data-DocBaseType="'+n.result[t].DocBaseType+'" data-CurrencyCode="'+n.result[t].CurrencyCode+'"  alt="'+VIS.Msg.getMsg("VA009_Select")+'" title="'+VIS.Msg.getMsg("VA009_Select")+'"><div class="VA009-pay-left"><div class="VA009-pay-img-wrap"><span class=\'VA009-pay-img\'><img src=\''+VIS.Application.contextUrl+"Areas/VA009/Images/"+r+"' alt=''><\/span> <span class='VA009-pay-status'>"+n.result[t].VA009_ExecutionStatus+'<\/span> <\/div> <div class="VA009-pay-text"><p>'+n.result[t].C_Bpartner+"<\/p><span>"+n.result[t].C_BP_Group+"<\/span> <span>"+n.result[t].DocumentNo+"<\/span> <span>"+n.result[t].PaymentMethod+'<\/span> <\/div><\/div><\/div><div class="col-md-3 col-sm-3 width-sm-30 sm-padd VA009-padd-right-0">',n.result[t].VA009_DocumentDate!=""&&(i+=' <div class="VA009-left-data VA009-pay-mid-sec"><span title="Due Date">'+n.result[t].VA009_DocumentDate+"<\/span> <\/div> "),i+=Globalize.format(n.result[t].VA009_RecivedAmt>0)?' <div class="VA009-left-data VA009-pay-mid-sec"> <span class="VA009-color-gray" title="Invoice Amount">'+n.result[t].ISO_CODE+" "+Globalize.format(n.result[t].VA009_ConvertedAmt,"N")+' <\/span> <br> <span class="glyphicon glyphicon-ok play-icon"><\/span> <span class="VA009-color-gray" title="Total Recieved Amount">'+n.result[t].CurrencyCode+" "+Globalize.format(n.result[t].VA009_RecivedAmt,"N")+" <\/span><\/div> ":' <div class="VA009-left-data VA009-pay-mid-sec"> <span class="VA009-color-gray" title="Invoice Amount">'+n.result[t].ISO_CODE+" "+Globalize.format(n.result[t].VA009_ConvertedAmt,"N")+" <\/span> <\/div> ",i+=' <div class="VA009-left-data VA009-pay-mid-sec"> <span data-UID="'+n.result[t].DocumentNo+'" class="VA009_AddNote" style=" cursor: pointer;"><img class="VA009_AddNoteimg" data-UID="'+n.result[t].DocumentNo+'" alt="'+VIS.Msg.getMsg("VA009_AddNote")+'" title="'+VIS.Msg.getMsg("VA009_AddNote")+'" src="'+VIS.Application.contextUrl+'Areas/VA009/Images/add-note.png"> <\/img><\/span> <\/div>  <div class="VA009-left-data VA009-pay-mid-sec" id="VA009-LastChat_'+f.windowNo+'"> <span class="VA009-Chatcolor-gray" id=VA009-Chatcolor-gray_'+n.result[t].DocumentNo+">"+n.result[t].LastChat+'<\/span> <\/div>  <\/div> <div class="col-md-2 col-sm-2 width-sm-20 sm-padd VA009-padd-right-0"><div class="VA009-transactionType"> <span>'+n.result[t].TransactionType+"<\/span> ",i+=n.result[t].DocBaseType=="APC"||n.result[t].DocBaseType=="ARC"?'<br><span style="text-decoration: underline;color: red;font-size: 12px;">Credit Memo<\/span> <\/div><\/div>':" <\/div><\/div>",i+=' <div class="col-md-3 col-sm-3">  <div class="VA009-right-part"><span class="vis vis-edit" data-UID="'+n.result[t].DocumentNo+'" data-InvoiceID="'+n.result[t].C_Invoice_ID+'" data-TransactionType ="'+n.result[t].TransactionType+'" alt="'+VIS.Msg.getMsg("VA009_Edit")+'" title="'+VIS.Msg.getMsg("VA009_Edit")+'"><\/span> <span class="VA009-info-icon vis vis-info" data-UID="'+n.result[t].C_BPartner_ID+'" alt="'+VIS.Msg.getMsg("VA009_Info")+'" title="'+VIS.Msg.getMsg("VA009_Info")+'"><\/span><div class="VA009-pay-amount" id=VA009_ConvertedAmt_'+f.windowNo+"_"+n.result[t].DocumentNo+'> <span title="Amount Due">'+n.result[t].ISO_CODE+" "+Globalize.format(n.result[t].VA009_ConvertedAmt,"N")+"<\/span><br> <\/div> <\/div> <\/div><\/div><\/div>",he.append(i)}function po(){v=t('<div class="vis-busyindicatorouterwrap va012-busy-bank-statement" ><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>');v[0].style.visibility="visible";w.append(v)}function ot(){fe(wr,br,nt,wu,hr,fu,li,eu,gr.val(),du,gi,cr.val(),lr.val(),ee)}function oi(n,t){var u=!1,r,i;if(n==undefined)return t;if(n.value_new=VIS.Utility.Util.getValueOfString(t),n.value_new.contains(".")){for(u=!0,r=[],i=0;i<n.value_new.length;i++)n.value_new[i]==="."&&r.push(i);r.length>1&&(n.value_new=au(n.value_new,"."))}if(n.value_new.contains(","))if(u)n.value_new=au(n.value_new,",");else{for(r=[],i=0;i<n.value_new.length;i++)n.value_new[i]===","&&r.push(i);n.value_new=r.length>1?au(n.value_new,","):n.value_new.replace(",",".")}return n.value_new==""&&(n.value_new="0"),n.value_new}function e(n){var u=!1,t=VIS.Utility.Util.getValueOfString(n),r,i;if(t.contains(".")){for(u=!0,r=[],i=0;i<t.length;i++)t[i]==="."&&r.push(i);r.length>1&&(t=au(t,"."))}if(t.contains(","))if(u)t=au(t,",");else{for(r=[],i=0;i<t.length;i++)t[i]===","&&r.push(i);t=r.length>1?au(t,","):t.replace(",",".")}return t==""&&(t="0"),t}function au(n,t){var i=n.split(t);return n=i.slice(0,-1).join("")+"."+i.slice(-1),n.indexOf(".")==n.length-1&&(n=n.replace(".","")),n}var it,yr,no,to;this.frame;this.windowNo;var f=this,w=t('<div class="VA009-assign-content">'),pt,ii,pr,of="",io,sf;Orgname="";var wr="Y",br="ARI",wt,rr,dt,ur,gt,fr,hf,vu,yu,b,ru,er,l,nt=1,wu=20,oe=20,si,or,bu,cf=0,se=!1,uu="",sr,hi=[],ci=[],a=[];SlctdJournalPaymentIds=[];var pi=[],wi=[],bi=[],ki=[],di=[],hr="",fu="",eu="",li="",gi="",nr=[],ri,ou,cr,lr,y=[],ku=0,tr,kr=!1,pu=null,ct=[],ai=[],dr=null,lt=[],su=[],d=[],ut=[],rt=[],he=null,ce=0,ar="",le,lf,af,vf,yf,pf,ae,ve,ye,wf,g=[],ir=[],hu=[],bf="",du=99,vt=[],n,r,u,c,p,wo=t(window).height(),tt=0,kf=0,v=null,gr,pe,ui,nu,ft=null,vi=null,yi=null,gu=null,fi=null,nf=null,bt=null,st=null,we=null,cu=null,lu=null,s=null,ht=null,yt=null,ei=0,tf="M",be=new VIS.CultureSeparator,kt=VIS.DisplayType.GetNumberFormat(VIS.DisplayType.Amount),k=VIS.Env.isDecimalPoint(),ni=1,df=null,tu=null,rf=null,uf=null,gf=null,ne=null,h=2,te=!1,ie=null,re=[];this.Initialize=function(){ro()};it={LoadTargetDocType:function(n,t){function r(t){if(n.append(" <option value = 0><\/option>"),t!=null&&t.length>0)for(var i in t)n.append("<option value="+VIS.Utility.Util.getValueOfInt(t[i].C_DocType_ID)+">"+VIS.Utility.encodeText(t[i].Name)+"<\/option>");n.prop("selectedIndex",0);n.addClass("vis-ev-col-mandatory")}n.empty();var i=$POP_cmbOrg!=null?$POP_cmbOrg.val():0;VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadTargetType",{ad_org_Id:i,baseType:t},r)},LoadTargetDocTypeB2B:function(n,t,i){function r(t){if(n.append(" <option value = 0><\/option>"),t!=null&&t.length>0)for(var i in t)n.append("<option value="+VIS.Utility.Util.getValueOfInt(t[i].C_DocType_ID)+">"+VIS.Utility.encodeText(t[i].Name)+"<\/option>");n.prop("selectedIndex",0);n.addClass("vis-ev-col-mandatory")}n.empty();i==0?(_org_Id=$OrgCmb!=null?$OrgCmb.val():0,VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadTargetType",{ad_org_Id:_org_Id,baseType:t},r)):VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadBankTargetType",{BankAcct_ID:i,BaseType:t},r)},loadOrg:function(){function n(n){var t;if(wt.append(" <option value = 0><\/option>"),n.length>0)for(t in n)wt.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].AD_Org_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>");wt.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadOrganization",null,n)},loadPaymentMethods:function(){function n(n){if(n!=null){if(dt.append(" <option value = 0><\/option>"),n.length>0)for(var t in n)dt.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].VA009_PaymentMethod_ID)+">"+VIS.Utility.encodeText(n[t].VA009_Name)+"<\/option>");dt.prop("selectedIndex",0)}}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadPaymentMethod",null,n)},loadStatus:function(){function n(n){if(n!=null){if(gt.append(" <option value = 0><\/option>"),n.length>0)for(var t in n)gt.append("<option value="+n[t].Value+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>");gt.prop("selectedIndex",0)}}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadStatus",null,n)},Cheque_Pay_Dialog:function(){function kt(n){n!=""?(v[0].style.visibility="hidden",VIS.ADialog.info("VA009_PleaseSelctonlyCheque")):(vi.show(),vr($POP_cmbBank,VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())),$POP_cmbBank.addClass("vis-ev-col-mandatory"),$POP_cmbBankAccount.addClass("vis-ev-col-mandatory"),s.val()?s.removeClass("vis-ev-col-mandatory"):s.addClass("vis-ev-col-mandatory"),dt(),ii(ri),ui(),pt(),ti(),it.LoadTargetDocType($POP_targetDocType,ni))}function dt(){var i=[];i.length==0&&(i.push({field:"C_Bpartner",caption:VIS.Msg.getMsg("VA009_Vendor"),sortable:!0,size:"12%"}),i.push({field:"C_InvoicePaySchedule_ID",caption:VIS.Msg.getMsg("VA009_Schedule"),sortable:!0,size:"7%"}),i.push({field:"Description",caption:VIS.Msg.getMsg("Description"),sortable:!0,size:"15%",editable:{type:"text"}}),i.push({field:"CurrencyCode",caption:VIS.Msg.getMsg("VA009_Currency"),sortable:!0,size:"8%"}),i.push({field:"DueAmt",caption:VIS.Msg.getMsg("VA009_DueAmt"),sortable:!0,size:"12%",style:"text-align: right",render:function(n){var t=n.DueAmt;return parseFloat(t).toLocaleString(window.navigator.language,{minimumFractionDigits:h,maximumFractionDigits:h})}}),i.push({field:"ConvertedAmt",caption:VIS.Msg.getMsg("VA009_ConvertedAmt"),sortable:!0,size:"12%",style:"text-align: right",render:function(n){var t=n.ConvertedAmt;return parseFloat(t).toLocaleString(window.navigator.language,{minimumFractionDigits:h,maximumFractionDigits:h})}}),i.push({field:"VA009_RecivedAmt",caption:VIS.Msg.getMsg("VA009_PayAmt"),sortable:!0,size:"12%",style:"text-align: right",render:function(n){var t=n.VA009_RecivedAmt;return t=oi(event,t,t),parseFloat(t).toLocaleString(window.navigator.language,{minimumFractionDigits:h,maximumFractionDigits:h})},editable:{type:"number"}}),i.push({field:"OverUnder",caption:VIS.Msg.getMsg("VA009_OverUnder"),sortable:!0,size:"8%",style:"text-align: right",render:function(n){var t=n.OverUnder;return parseFloat(t).toLocaleString(window.navigator.language,{minimumFractionDigits:h,maximumFractionDigits:h})}}),i.push({field:"Writeoff",caption:VIS.Msg.getMsg("VA009_Writeoff"),sortable:!0,size:"8%",style:"text-align: right",render:function(n){var t=n.Writeoff;return t=oi(event,t,t),parseFloat(t).toLocaleString(window.navigator.language,{minimumFractionDigits:h,maximumFractionDigits:h})},editable:{type:"number"}}),i.push({field:"Discount",caption:VIS.Msg.getMsg("VA009_Discount"),sortable:!0,size:"8%",style:"text-align: right",render:function(n){var t=n.Discount;return t=oi(event,t,t),parseFloat(t).toLocaleString(window.navigator.language,{minimumFractionDigits:h,maximumFractionDigits:h})},editable:{type:"number"}}),i.push({field:"CheckNumber",caption:VIS.Msg.getMsg("VA009_ChkNo"),sortable:!0,size:"12%",render:function(n){return n.changes!=undefined&&event.currentTarget.id!=undefined?event.currentTarget.id==$POPtxtCheckNumber.toArray()[0].id?r.records.length==1?(n.changes.CheckNumber=n.CheckNumber,n.CheckNumber):n.changes.CheckNumber==""||n.changes.CheckNumber==0?(n.changes.CheckNumber=n.CheckNumber,n.CheckNumber):n.changes.CheckNumber:n.changes.CheckNumber:n.CheckNumber},editable:{type:"alphanumeric",autoFormat:!0,groupSymbol:" "}}),i.push({field:"CheckDate",caption:VIS.Msg.getMsg("VA009_CheckDate"),sortable:!0,size:"10%",style:"text-align: left",render:function(n){var t;return t=n.changes==undefined||n.changes.CheckDate==""?n.CheckDate:n.changes.CheckDate,new Date(t).toLocaleDateString()},editable:{type:"date"}}),i.push({field:"recid",caption:VIS.Msg.getMsg("VA009_srno"),sortable:!0,size:"1%"}),i.push({field:"TransactionType",caption:VIS.Msg.getMsg("VA009_TransactionType"),sortable:!0,size:"1%"}),i.push({field:"C_BPartner_Location_ID",caption:VIS.Msg.getMsg("C_BPartner_Location_ID"),sortable:!0,size:"1%"}),i.push({field:"C_DocType_ID",caption:VIS.Msg.getMsg("C_DocType_ID"),sortable:!0,size:"1%"}),i.push({field:"DocBaseType",caption:VIS.Msg.getMsg("DocBaseType"),sortable:!0,size:"1%"}));r=null;r=nf.w2grid({name:"CheuePaybleGrid_"+f.windowNo,recordHeight:25,columns:i,multiSelect:!0,onEditField:function(i){i.column==6||i.column==8||i.column==9?(r.get(i.recid).TransactionType=="Order"||r.get(i.recid).TransactionType=="GL Journal")&&(i.isCancelled=!0):$POp_cmbPaySelectn.val()=="P"&&(i.isCancelled=!0);r.records[i.index][r.columns[i.column].field]=oi(i,r.records[i.index][r.columns[i.column].field]);var u=n.GetFormatAmount(r.records[i.index][r.columns[i.column].field],"init",k);r.records[i.index][r.columns[i.column].field]=n.GetConvertedString(u,k);(i.column==8||i.column==9||i.column==6)&&(id=i.recid,t("#grid_CheuePaybleGrid_"+f.windowNo+"_rec_"+id).keydown(function(n){if(k||n.keyCode!=190&&n.keyCode!=110){if(k&&n.keyCode==188)return!1}else return!1;return n.target.value.contains(".")&&(n.which==110||n.which==190||n.which==188)?n.target.value.indexOf(".")>-1&&(n.target.value=n.target.value.replace(".","")):n.target.value.contains(",")&&(n.which==110||n.which==190||n.which==188)&&n.target.value.indexOf(",")>-1&&(n.target.value=n.target.value.replace(",","")),n.keyCode!=8&&n.keyCode!=9&&(n.keyCode<37||n.keyCode>40)&&(n.keyCode<48||n.keyCode>57)&&(n.keyCode<96||n.keyCode>105)&&n.keyCode!=109&&n.keyCode!=189&&n.keyCode!=110&&n.keyCode!=144&&n.keyCode!=188&&n.keyCode!=190?!1:void 0}))},onChange:function(t){window.setTimeout(function(){if(r.getChanges(t.recid)!=undefined){var i=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/GetCurrencyPrecision",{BankAccount_ID:VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val()),CurrencyFrom:"B"},null);if((i==null||i==0)&&(i=2),r.records[t.index].ConvertedAmt=parseFloat(e(r.records[t.index].ConvertedAmt)),r.records[t.index].VA009_RecivedAmt=parseFloat(e(r.records[t.index].VA009_RecivedAmt)),r.records[t.index].OverUnder=parseFloat(e(r.records[t.index].OverUnder)),r.records[t.index].Writeoff=parseFloat(e(r.records[t.index].Writeoff)),r.records[t.index].Discount=parseFloat(e(r.records[t.index].Discount)),t.column==6){if(t.value_new==""?t.value_new=0:(t.value_new=n.GetConvertedNumber(t.value_new,k),t.value_new=t.value_new.toLocaleString(window.navigator.language,{minimumFractionDigits:i,maximumFractionDigits:i}),t.value_new=n.GetConvertedNumber(t.value_new,k),t.value_original=n.GetConvertedNumber(t.value_original,k)),t.value_new>r.records[t.index].ConvertedAmt){VIS.ADialog.error("MoreScheduleAmount");t.value_new=t.value_original;r.get(t.recid).changes.VA009_RecivedAmt=o(t,t.value_new);r.records[t.index].VA009_RecivedAmt=e(r.get(t.recid).changes.VA009_RecivedAmt);r.refreshCell(t.recid,"VA009_RecivedAmt");return}if(r.get(t.recid).changes.VA009_RecivedAmt=o(t,t.value_new.toFixed(i)),r.records[t.index].VA009_RecivedAmt=e(r.get(t.recid).changes.VA009_RecivedAmt),r.records[t.index].PaymwentBaseType=="ARR"||r.records[t.index].PaymwentBaseType=="APP")if(t.value_new<r.records[t.index].ConvertedAmt){if(r.records[t.index].ConvertedAmt<0)if(r.get(t.recid).TransactionType=="Order")r.get(t.recid).changes.Discount=r.records[t.index].ConvertedAmt-t.value_new,r.get(t.recid).Discount=r.get(t.recid).changes.Discount.toFixed(i),r.get(t.recid).changes.Writeoff=0,r.get(t.recid).Writeoff=0,r.get(t.recid).changes.OverUnder=0,r.get(t.recid).OverUnder=0;else{if(t.value_original.toFixed(i)==parseFloat(t.value_new).toFixed(i))return!1;r.get(t.recid).changes.OverUnder=(r.records[t.index].ConvertedAmt-parseFloat(t.value_new)).toFixed(i);r.get(t.recid).changes.OverUnder=o(t,r.get(t.recid).changes.OverUnder);r.records[t.index].OverUnder=e(r.get(t.recid).changes.OverUnder);r.get(t.recid).changes.Writeoff=0;r.get(t.recid).changes.Discount=0}else if(r.get(t.recid).TransactionType=="Order")r.get(t.recid).changes.Discount=(r.records[t.index].ConvertedAmt-t.value_new).toFixed(i),r.records[t.index].Discount=r.get(t.recid).changes.Discount,r.get(t.recid).changes.Writeoff=0,r.get(t.recid).Writeoff=0,r.get(t.recid).changes.OverUnder=0,r.get(t.recid).OverUnder=0;else{if(t.value_original.toFixed(i)==parseFloat(t.value_new).toFixed(i))return!1;r.get(t.recid).changes.OverUnder=(r.records[t.index].ConvertedAmt-parseFloat(t.value_new)).toFixed(i);r.get(t.recid).changes.OverUnder=o(t,r.get(t.recid).changes.OverUnder);r.records[t.index].OverUnder=e(r.get(t.recid).changes.OverUnder);r.get(t.recid).changes.Writeoff=0;r.get(t.recid).Writeoff=0;r.get(t.recid).changes.Discount=0;r.get(t.recid).Discount=0}r.refreshCell(t.recid,"OverUnder");r.refreshCell(t.recid,"Discount");r.refreshCell(t.recid,"Writeoff")}else t.value_new==r.records[t.index].ConvertedAmt?(r.get(t.recid).changes.OverUnder=0,r.get(t.recid).OverUnder=0,r.get(t.recid).changes.Discount=0,r.get(t.recid).changes.Writeoff=0,r.get(t.recid).Discount=0,r.get(t.recid).Writeoff=0,r.get(t.recid).changes.VA009_RecivedAmt=o(t,parseFloat(t.value_new)),r.records[t.index].VA009_RecivedAmt=e(r.get(t.recid).changes.VA009_RecivedAmt),r.refreshCell(t.recid,"OverUnder"),r.refreshCell(t.recid,"Discount"),r.refreshCell(t.recid,"Writeoff"),r.refreshCell(t.recid,"VA009_RecivedAmt")):t.value_new>r.records[t.index].ConvertedAmt&&(r.records[t.index].ConvertedAmt<0?(r.get(t.recid).changes.OverUnder=0,r.get(t.recid).OverUnder=0,r.get(t.recid).changes.Writeoff=(r.records[t.index].ConvertedAmt-t.value_new).toFixed(i),r.get(t.recid).Writeoff=VIS.Utility.Util.getValueOfDecimal(r.get(t.recid).changes.Writeoff)):(r.get(t.recid).changes.OverUnder=r.records[t.index].ConvertedAmt-t.value_new,r.records[t.index].OverUnder=r.get(t.recid).changes.OverUnder,r.get(t.recid).changes.Writeoff=0,r.get(t.recid).Writeoff=0),r.get(t.recid).changes.Discount=0,r.get(t.recid).Discount=0,r.refreshCell(t.recid,"OverUnder"),r.refreshCell(t.recid,"Discount"),r.refreshCell(t.recid,"Writeoff"))}if(t.column==8){if(t.value_new==""?t.value_new=0:(t.value_new=n.GetConvertedNumber(t.value_new,k),t.value_new=t.value_new.toLocaleString(window.navigator.language,{minimumFractionDigits:i,maximumFractionDigits:i}),t.value_new=n.GetConvertedNumber(t.value_new,k),t.value_original=n.GetConvertedNumber(t.value_original,k)),r.get(t.recid).changes.Writeoff=o(t,t.value_new.toFixed(i)),r.records[t.index].Writeoff=e(r.get(t.recid).changes.Writeoff),t.value_new>r.records[t.index].ConvertedAmt){VIS.ADialog.error("MoreScheduleAmount");t.value_new=t.value_original;r.get(t.recid).changes.Writeoff=o(t,t.value_new.toFixed(i));r.records[t.index].Writeoff=e(r.get(t.recid).changes.Writeoff);r.refreshCell(t.recid,"Writeoff");return}(r.records[t.index].PaymwentBaseType=="ARR"||r.records[t.index].PaymwentBaseType=="APP")&&(t.value_new>r.records[t.index].ConvertedAmt?(VIS.Utility.Util.getValueOfDecimal(r.records[t.index].OverUnder)>0?(r.get(t.recid).changes.OverUnder=(r.records[t.index].ConvertedAmt-(t.value_new+r.records[t.index].VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(r.get(t.recid).Discount))).toFixed(i),r.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),r.get(t.recid).changes.OverUnder=r.records[t.index].OverUnder,r.get(t.recid).changes.Writeoff=t.value_original,r.records[t.index].Writeoff=t.value_original):(r.get(t.recid).changes.OverUnder=o(t,r.get(t.recid).changes.OverUnder),r.records[t.index].OverUnder=e(r.get(t.recid).changes.OverUnder))):(r.get(t.recid).changes.VA009_RecivedAmt=(t.value_new-r.records[t.index].ConvertedAmt).toFixed(i),r.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),r.get(t.recid).changes.VA009_RecivedAmt=r.records[t.index].VA009_RecivedAmt,r.get(t.recid).changes.Writeoff=t.value_original,r.records[t.index].Writeoff=t.value_original):(r.get(t.recid).changes.VA009_RecivedAmt=Math.abs(r.get(t.recid).changes.VA009_RecivedAmt),r.records[t.index].VA009_RecivedAmt=r.get(t.recid).changes.VA009_RecivedAmt)),r.refreshCell(t.recid,"VA009_RecivedAmt"),r.refreshCell(t.recid,"OverUnder")):parseFloat(t.value_new)<=r.records[t.index].ConvertedAmt&&(r.get(t.recid).changes.Discount==undefined&&r.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(r.records[t.index].OverUnder)>0?(r.get(t.recid).changes.OverUnder=(r.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+r.records[t.index].VA009_RecivedAmt+r.records[t.index].Discount)).toFixed(i),r.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),r.get(t.recid).changes.OverUnder=o(t,r.records[t.index].OverUnder),r.records[t.index].OverUnder=e(r.get(t.recid).changes.OverUnder),r.get(t.recid).changes.Writeoff=o(t,t.value_original),r.records[t.index].Writeoff=e(r.get(t.recid).changes.Writeoff)):(r.get(t.recid).changes.OverUnder=o(t,Math.abs(r.get(t.recid).changes.OverUnder).toFixed(i)),r.records[t.index].OverUnder=e(r.get(t.recid).changes.OverUnder))):(r.get(t.recid).changes.VA009_RecivedAmt=(r.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+r.records[t.index].OverUnder+r.records[t.index].Discount)).toFixed(i),r.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),r.get(t.recid).changes.VA009_RecivedAmt=o(t,r.records[t.index].VA009_RecivedAmt),r.records[t.index].VA009_RecivedAmt=e(r.get(t.recid).changes.VA009_RecivedAmt),r.get(t.recid).changes.Writeoff=o(t,t.value_original),r.records[t.index].Writeoff=e(r.get(t.recid).changes.Writeoff)):(r.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(r.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),r.records[t.index].VA009_RecivedAmt=e(r.get(t.recid).changes.VA009_RecivedAmt))):r.get(t.recid).changes.Discount==undefined?VIS.Utility.Util.getValueOfDecimal(r.records[t.index].OverUnder)>0?(r.get(t.recid).changes.OverUnder=(r.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+r.records[t.index].VA009_RecivedAmt+r.records[t.index].Discount)).toFixed(i),r.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),r.get(t.recid).changes.OverUnder=o(t,r.records[t.index].OverUnder),r.records[t.index].OverUnder=e(r.get(t.recid).changes.OverUnder),r.get(t.recid).changes.Writeoff=o(t,t.value_original),r.records[t.index].Writeoff=e(r.get(t.recid).changes.Writeoff)):(r.get(t.recid).changes.OverUnder=o(t,Math.abs(r.get(t.recid).changes.OverUnder).toFixed(i)),r.records[t.index].OverUnder=e(r.get(t.recid).changes.OverUnder))):(r.get(t.recid).changes.VA009_RecivedAmt=(r.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+r.records[t.index].OverUnder+r.records[t.index].Discount)).toFixed(i),r.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),r.get(t.recid).changes.VA009_RecivedAmt=o(t,r.records[t.index].VA009_RecivedAmt),r.records[t.index].VA009_RecivedAmt=e(r.get(t.recid).changes.VA009_RecivedAmt),r.get(t.recid).changes.Writeoff=o(t,t.value_original),r.records[t.index].Writeoff=e(r.get(t.recid).changes.Writeoff)):(r.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(r.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),r.records[t.index].VA009_RecivedAmt=e(r.get(t.recid).changes.VA009_RecivedAmt))):r.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(r.records[t.index].OverUnder)>0?(r.get(t.recid).changes.OverUnder=(r.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+r.records[t.index].VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(r.get(t.recid).Discount))).toFixed(i),r.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),r.get(t.recid).changes.OverUnder=o(t,r.records[t.index].OverUnder),r.records[t.index].OverUnder=e(r.get(t.recid).changes.OverUnder),r.get(t.recid).changes.Writeoff=o(t,t.value_original),r.records[t.index].Writeoff=e(r.get(t.recid).changes.Writeoff)):(r.get(t.recid).changes.OverUnder=o(t,Math.abs(r.get(t.recid).changes.OverUnder).toFixed(i)),r.records[t.index].OverUnder=e(r.get(t.recid).changes.OverUnder)),r.refreshCell(t.recid,"OverUnder")):(r.get(t.recid).changes.VA009_RecivedAmt=(r.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+r.records[t.index].OverUnder+r.records[t.index].Discount)).toFixed(i),r.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),r.get(t.recid).changes.VA009_RecivedAmt=o(t,r.records[t.index].VA009_RecivedAmt),r.records[t.index].VA009_RecivedAmt=e(r.get(t.recid).changes.VA009_RecivedAmt),r.get(t.recid).changes.Writeoff=o(t,t.value_original),r.records[t.index].Writeoff=e(r.get(t.recid).changes.Writeoff)):(r.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(r.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),r.records[t.index].VA009_RecivedAmt=e(r.get(t.recid).changes.VA009_RecivedAmt))):r.records[t.index].OverUnder>0?(r.get(t.recid).changes.OverUnder=(r.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+r.records[t.index].VA009_RecivedAmt+r.records[t.index].Discount)).toFixed(i),r.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),r.get(t.recid).changes.OverUnder=o(t,r.records[t.index].OverUnder),r.records[t.index].OverUnder=e(r.get(t.recid).changes.OverUnder),r.get(t.recid).changes.Writeoff=o(t,t.value_original),r.records[t.index].Writeoff=e(r.get(t.recid).changes.Writeoff)):(r.get(t.recid).changes.OverUnder=o(t,Math.abs(r.get(t.recid).changes.OverUnder).toFixed(i)),r.records[t.index].OverUnder=e(r.get(t.recid).changes.OverUnder))):(r.get(t.recid).changes.VA009_RecivedAmt=(r.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+r.records[t.index].OverUnder+r.records[t.index].Discount)).toFixed(i),r.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),r.get(t.recid).changes.VA009_RecivedAmt=o(t,r.records[t.index].VA009_RecivedAmt),r.records[t.index].VA009_RecivedAmt=e(r.get(t.recid).changes.VA009_RecivedAmt),r.get(t.recid).changes.Writeoff=o(t,t.value_original),r.records[t.index].Writeoff=e(r.get(t.recid).changes.Writeoff)):(r.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(r.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),r.records[t.index].VA009_RecivedAmt=e(r.get(t.recid).changes.VA009_RecivedAmt))),r.refreshCell(t.recid,"VA009_RecivedAmt"),r.refreshCell(t.recid,"OverUnder")),t.value_new>r.records[t.index].ConvertedAmt||t.value_new<=r.records[t.index].ConvertedAmt)}if(t.column==9){if(t.value_new==""?t.value_new=0:(t.value_new=n.GetConvertedNumber(t.value_new,k),t.value_new=t.value_new.toLocaleString(window.navigator.language,{minimumFractionDigits:i,maximumFractionDigits:i}),t.value_new=n.GetConvertedNumber(t.value_new,k),t.value_original=n.GetConvertedNumber(t.value_original,k)),r.get(t.recid).changes.Discount=o(t,t.value_new.toFixed(i)),r.records[t.index].Discount=e(r.get(t.recid).changes.Discount),t.value_new>r.records[t.index].ConvertedAmt){VIS.ADialog.error("MoreScheduleAmount");t.value_new=t.value_original;r.get(t.recid).changes.Discount=o(t,t.value_new);r.records[t.index].Discount=e(r.get(t.recid).changes.Discount);r.refreshCell(t.recid,"Discount");return}(r.records[t.index].PaymwentBaseType=="ARR"||r.records[t.index].PaymwentBaseType=="APP")&&(t.value_new>r.records[t.index].ConvertedAmt?(VIS.Utility.Util.getValueOfDecimal(r.get(t.recid).changes.OverUnder)>0?(r.get(t.recid).changes.OverUnder=(r.records[t.index].ConvertedAmt-(t.value_new+r.records[t.index].VA009_RecivedAmt+r.records[t.index].Writeoff)).toFixed(i),r.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),r.get(t.recid).changes.OverUnder=r.records[t.index].OverUnder,r.get(t.recid).changes.Discount=t.value_original,r.records[t.index].Discount=t.value_original):(r.get(t.recid).changes.OverUnder=Math.abs(r.get(t.recid).changes.OverUnder),r.records[t.index].OverUnder=r.get(t.recid).changes.OverUnder)):(r.get(t.recid).changes.VA009_RecivedAmt=(t.value_new-r.records[t.index].ConvertedAmt).toFixed(i),r.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),r.get(t.recid).changes.VA009_RecivedAmt=r.records[t.index].VA009_RecivedAmt,r.get(t.recid).changes.Discount=t.value_original,r.records[t.index].Discount=t.value_original):(r.get(t.recid).changes.VA009_RecivedAmt=Math.abs(r.get(t.recid).changes.VA009_RecivedAmt),r.records[t.index].VA009_RecivedAmt=r.get(t.recid).changes.VA009_RecivedAmt)),r.refreshCell(t.recid,"VA009_RecivedAmt"),r.refreshCell(t.recid,"OverUnder")):parseFloat(t.value_new)<=r.records[t.index].ConvertedAmt&&(r.get(t.recid).changes.Writeoff==undefined&&r.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(r.records[t.index].OverUnder)>0?(r.get(t.recid).changes.OverUnder=(r.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+r.records[t.index].VA009_RecivedAmt+r.records[t.index].Writeoff)).toFixed(i),r.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),r.get(t.recid).changes.OverUnder=o(t,r.records[t.index].OverUnder),r.records[t.index].OverUnder=e(r.get(t.recid).changes.OverUnder),r.get(t.recid).changes.Discount=o(t,t.value_original),r.records[t.index].Discount=e(r.get(t.recid).changes.Discount)):(r.get(t.recid).changes.OverUnder=o(t,Math.abs(r.get(t.recid).changes.OverUnder).toFixed(i)),r.records[t.index].OverUnder=e(r.get(t.recid).changes.OverUnder))):(r.get(t.recid).changes.VA009_RecivedAmt=(r.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+r.records[t.index].OverUnder+r.records[t.index].Writeoff)).toFixed(i),r.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),r.get(t.recid).changes.VA009_RecivedAmt=o(t,r.records[t.index].VA009_RecivedAmt),r.records[t.index].VA009_RecivedAmt=e(r.get(t.recid).changes.VA009_RecivedAmt),r.get(t.recid).changes.Discount=o(t,t.value_original),r.records[t.index].Discount=e(r.get(t.recid).changes.Discount)):(r.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(r.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),r.records[t.index].VA009_RecivedAmt=e(r.get(t.recid).changes.VA009_RecivedAmt))):r.get(t.recid).changes.Writeoff==undefined?VIS.Utility.Util.getValueOfDecimal(r.records[t.index].OverUnder)>0?(r.get(t.recid).changes.OverUnder=(r.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+r.records[t.index].VA009_RecivedAmt+r.records[t.index].Writeoff)).toFixed(i),r.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),r.get(t.recid).changes.OverUnder=o(t,r.records[t.index].OverUnder),r.records[t.index].OverUnder=e(r.get(t.recid).changes.OverUnder),r.get(t.recid).changes.Discount=o(t,t.value_original),r.records[t.index].Discount=e(r.get(t.recid).changes.Discount)):(r.get(t.recid).changes.OverUnder=o(t,Math.abs(r.get(t.recid).changes.OverUnder).toFixed(i)),r.records[t.index].OverUnder=e(r.get(t.recid).changes.OverUnder))):(r.get(t.recid).changes.VA009_RecivedAmt=(r.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+r.records[t.index].OverUnder+r.records[t.index].Writeoff)).toFixed(i),r.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),r.get(t.recid).changes.VA009_RecivedAmt=o(t,r.records[t.index].VA009_RecivedAmt),r.records[t.index].VA009_RecivedAmt=e(r.get(t.recid).changes.VA009_RecivedAmt),r.get(t.recid).changes.Discount=o(t,t.value_original),r.records[t.index].Discount=e(r.get(t.recid).changes.Discount)):(r.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(r.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),r.records[t.index].VA009_RecivedAmt=e(r.get(t.recid).changes.VA009_RecivedAmt))):r.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(r.records[t.index].OverUnder)>0?(r.get(t.recid).changes.OverUnder=(r.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+r.records[t.index].VA009_RecivedAmt+r.records[t.index].Writeoff)).toFixed(i),r.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),r.get(t.recid).changes.OverUnder=o(t,r.records[t.index].OverUnder),r.records[t.index].OverUnder=e(r.get(t.recid).changes.OverUnder),r.get(t.recid).changes.Discount=o(t,t.value_original),r.records[t.index].Discount=e(r.get(t.recid).changes.Discount)):(r.get(t.recid).changes.OverUnder=o(t,Math.abs(r.get(t.recid).changes.OverUnder).toFixed(i)),r.records[t.index].OverUnder=e(r.get(t.recid).changes.OverUnder))):(r.get(t.recid).changes.VA009_RecivedAmt=(r.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+r.records[t.index].OverUnder+r.records[t.index].Writeoff)).toFixed(i),r.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),r.get(t.recid).changes.VA009_RecivedAmt=o(t,r.records[t.index].VA009_RecivedAmt),r.records[t.index].VA009_RecivedAmt=e(r.get(t.recid).changes.VA009_RecivedAmt),r.get(t.recid).changes.Discount=o(t,t.value_original),r.records[t.index].Discount=e(r.get(t.recid).changes.Discount)):(r.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(r.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),r.records[t.index].VA009_RecivedAmt=e(r.get(t.recid).changes.VA009_RecivedAmt))):r.records[t.index].OverUnder>0?(r.get(t.recid).changes.OverUnder=(r.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+r.records[t.index].VA009_RecivedAmt+r.records[t.index].Writeoff)).toFixed(i),r.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),r.get(t.recid).changes.OverUnder=o(t,r.records[t.index].OverUnder),r.records[t.index].OverUnder=e(r.get(t.recid).changes.OverUnder),r.get(t.recid).changes.Discount=o(t,t.value_original),r.records[t.index].Discount=e(r.get(t.recid).changes.Discount)):(r.get(t.recid).changes.OverUnder=o(t,Math.abs(r.get(t.recid).changes.OverUnder).toFixed(i)),r.records[t.index].OverUnder=e(r.get(t.recid).changes.OverUnder))):(r.get(t.recid).changes.VA009_RecivedAmt=(r.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+r.records[t.index].OverUnder+r.records[t.index].Writeoff)).toFixed(i),r.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),r.get(t.recid).changes.VA009_RecivedAmt=o(t,r.records[t.index].VA009_RecivedAmt),r.records[t.index].VA009_RecivedAmt=e(r.get(t.recid).changes.VA009_RecivedAmt),r.get(t.recid).changes.Discount=o(t,t.value_original),r.records[t.index].Discount=e(r.get(t.recid).changes.Discount)):(r.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(r.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),r.records[t.index].VA009_RecivedAmt=e(r.get(t.recid).changes.VA009_RecivedAmt))),r.refreshCell(t.recid,"VA009_RecivedAmt"),r.refreshCell(t.recid,"OverUnder")),parseFloat(t.value_new)>r.records[t.index].ConvertedAmt||parseFloat(t.value_new)<=r.records[t.index].ConvertedAmt)}r.refreshCell(t.recid,"ConvertedAmt");r.refreshCell(t.recid,"VA009_RecivedAmt");r.refreshCell(t.recid,"OverUnder");r.refreshCell(t.recid,"Writeoff");r.refreshCell(t.recid,"Discount")}t.column==10&&(r.records[t.index].CheckNumber=t.value_new,r.records.length==1&&$POPtxtCheckNumber.val(t.value_new));t.column==11&&(r.records[t.index].CheckDate=t.value_new!=""?t.value_new:t.value_previous!=""?t.value_previous:t.value_original);t.column==2&&(r.records[t.index].Description=t.value_new)},100)}});r.hideColumn("recid");r.hideColumn("TransactionType","C_BPartner_Location_ID","C_DocType_ID","DocBaseType")}function gt(){$POP_cmbBank=bt.find("#VA009_POP_cmbBank_"+f.windowNo);$POP_cmbBankAccount=bt.find("#VA009_POP_cmbBankAccount_"+f.windowNo);$POP_txtAccttNo=bt.find("#VA009_AccountBalance"+f.windowNo);$POP_txtChqNo=bt.find("#VA009_Chqnotxt_"+f.windowNo);nf=bt.find("#VA009_btnPopupGrid");$POp_cmbPaySelectn=bt.find("#VA009_POP_cmbPaySelectn_"+f.windowNo);$pop_cmbCurrencyType=bt.find("#VA009_POP_cmbCurrencyType_"+f.windowNo);$POP_PayMthd=bt.find("#VA009_POP_cmbPaymthd_"+f.windowNo);$POP_PayMthd.addClass("vis-ev-col-mandatory");$POPtxtCheckNumber=bt.find("#VA009_POP_textCheckNo_"+f.windowNo);s=bt.find("#VA009_AccountDate_"+f.windowNo);$POP_Consolidate=bt.find("#VA009_chkConsolidate_"+f.windowNo);ht=bt.find("#VA009_TransactionDate"+f.windowNo);$POP_cmbOrg=bt.find("#VA009_POP_cmbOrg_"+f.windowNo);$POP_cmbOrg.addClass("vis-ev-col-mandatory");$POP_targetDocType=bt.find("#VA009_POP_cmbDocType_"+f.windowNo);$POP_targetDocType.addClass("vis-ev-col-mandatory")}function pt(){function n(n){if(n.length>0)for(var t in n)$POP_PayMthd.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].VA009_PaymentMethod_ID)+">"+VIS.Utility.encodeText(n[t].VA009_Name)+"<\/option>");$POP_PayMthd.val(0).prop("selected",!0)}$POP_PayMthd.empty();VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadChequePaymentMethod",{Org_ID:$POP_cmbOrg.val()},n)}function ti(){function n(n){if($POP_cmbOrg.append(" <option value = 0><\/option>"),n.length>0)for(var t in n)$POP_cmbOrg.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].AD_Org_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>");$POP_cmbOrg.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadOrganization",null,n)}function ii(n){t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetPopUpData",type:"POST",datatype:"json",data:{InvPayids:a.toString(),bank_id:lt,acctno:yt,chkno:VIS.Utility.encodeText(_Cheque_no),OrderPayids:y.toString(),JournalPayids:SlctdJournalPaymentIds.toString()},success:function(t){n(t)},error:function(){v[0].style.visibility="hidden";VIS.ADialog.error("VA009_ErrorLoadingPayments")}})}function ri(n){var i,u,t;g=[];i=JSON.parse(n);vt=i;for(u in i)t={},t.recid=i[u].recid,t.C_Bpartner=i[u].C_Bpartner,t.C_BPartner_Location_ID=i[u].C_BPartner_Location_ID,t.C_DocType_ID=i[u].C_DocType_ID,t.C_Invoice_ID=i[u].C_Invoice_ID,t.C_BPartner_ID=i[u].C_BPartner_ID,t.C_InvoicePaySchedule_ID=i[u].C_InvoicePaySchedule_ID,t.CurrencyCode=i[u].CurrencyCode,t.DueAmt=i[u].DueAmt,t.VA009_RecivedAmt=i[u].DueAmt,t.OverUnder="0",t.Writeoff="0",t.Discount="0",t.ConvertedAmt=i[u].DueAmt,t.C_Currency_ID=i[u].C_Currency_ID,t.AD_Org_ID=i[u].AD_Org_ID,t.AD_Client_ID=i[u].AD_Client_ID,t.CheckDate=new Date,t.CheckNumber=null,t.ValidMonths=null,t.VA009_PaymentMode=i[u].VA009_PaymentMode,t.PaymwentBaseType=i[u].PaymwentBaseType,t.TransactionType=i[u].TransactionType,t.DocBaseType=i[u].DocBaseType,g.push(t);w2utils.encodeTags(g);r.add(g);v[0].style.visibility="hidden"}function ui(){function n(n){if($pop_cmbCurrencyType.append("<option value='0'><\/option>"),n.length>0){for(var t in n)$pop_cmbCurrencyType.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>"),VIS.Utility.encodeText(n[t].IsDefault)=="Y"&&(ei=VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID));$pop_cmbCurrencyType.val(ei)}}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/loadCurrencyType",null,n)}function ft(n){var i,u,t;r.clear();g=[];i=JSON.parse(n);vt=i;for(u in i)t={},t.recid=i[u].recid,t.C_Bpartner=i[u].C_Bpartner,t.C_BPartner_Location_ID=i[u].C_BPartner_Location_ID,t.C_DocType_ID=i[u].C_DocType_ID,t.C_Invoice_ID=i[u].C_Invoice_ID,t.C_BPartner_ID=i[u].C_BPartner_ID,t.C_InvoicePaySchedule_ID=i[u].C_InvoicePaySchedule_ID,t.CurrencyCode=i[u].CurrencyCode,t.DueAmt=i[u].DueAmt,t.VA009_RecivedAmt=i[u].convertedAmt,t.OverUnder="0",t.Writeoff="0",t.Discount="0",t.ConvertedAmt=i[u].convertedAmt,t.C_Currency_ID=i[u].C_Currency_ID,t.AD_Org_ID=i[u].AD_Org_ID,t.AD_Client_ID=i[u].AD_Client_ID,t.CheckDate=new Date,t.CheckNumber=null,t.ValidMonths=null,t.VA009_PaymentMode=i[u].VA009_PaymentMode,t.PaymwentBaseType=i[u].PaymwentBaseType,t.TransactionType=i[u].TransactionType,t.DocBaseType=i[u].DocBaseType,g.push(t);i[0].ERROR=="ConversionNotFound"&&VIS.ADialog.info("VA009_ConversionNotFound");w2utils.encodeTags(g);r.add(g)}function fi(n){n=JSON.parse(n);b.find(".VA009-payment-wrap").remove();l.find(".VA009-right-data-main").remove();l.find(".VA009-accordion").remove();nt=1;a=[];y=[];SlctdJournalPaymentIds=[];d=[];rt=[];ut=[];et();st.prop("checked",!1);ot();at();v[0].style.visibility="hidden";VIS.ADialog.info("",null,n,null)}function si(n){if(n=JSON.parse(n),b.find(".VA009-payment-wrap").remove(),l.find(".VA009-right-data-main").remove(),l.find(".VA009-accordion").remove(),nt=1,a=[],y=[],SlctdJournalPaymentIds=[],d=[],rt=[],ut=[],et(),st.prop("checked",!1),ot(),at(),v[0].style.visibility="hidden",n!="")VIS.ADialog.info("",null,n,null);else{var i=new VIS.Apps.AForms.VPayPrint,t=new VIS.CFrame;t.setName(VIS.Msg.getMsg("Check Print"));t.setTitle(VIS.Msg.getMsg("Check Print"));t.hideHeader(!0);t.setContent(i);t.show();i.initialize()}}function wt(){_Cheque=null;$cheque=null;bt=null;STAT_cmbBank=null;STAT_cmbBankAccount=null;STAT_txtStatementNo=null;STAT_ctrlLoadFile=null;STAT_ctrlLoadFileTxt=null;r.destroy()}var lt,yt,u,p,n,w,c,tt;nf;_Cheque_no="";lt=0;yt=0;v[0].style.visibility="visible";n=null;lblAmount=t("<label>");u=new VIS.Controls.VAmountTextBox("VA009_AccountBalance"+f.windowNo+"",!1,!0,!0,50,100,VIS.DisplayType.Amount,VIS.Msg.getMsg("Amount"));lblAmount.append(VIS.Msg.getMsg("VA009_AccountBalance"));u.setValue(0);n=VIS.DisplayType.GetNumberFormat(VIS.DisplayType.Amount);p=t("<div class='VA009-popCheck-data input-group vis-input-wrap'>");w=t("<div class='vis-control-wrap'>");p.append(w);w.append(u.getControl().attr("placeholder"," ").attr("data-placeholder","")).append(lblAmount);bt=t("<div class='VA009-popform-content vis-formouterwrpdiv' style='min-height:450px !important'>");_ChequePayble=t("<div class='VA009-popfrm-wrap' style='height:auto;'>");_chequedata=t("<div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbOrg_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_Org")+"<\/label><\/div><\/div><div class='VA009-popCheck-data input-group vis-input-wrap' > <div class='vis-control-wrap'><select id='VA009_POP_cmbDocType_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_DocType")+"<\/label><\/div><\/div> <div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbBank_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_Bank")+"<\/label><\/div><\/div><div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbBankAccount_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_BankAccount")+"<\/label><\/div><\/div>");_chequedata1=t("<div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbPaySelectn_"+f.windowNo+'\'> <option value="M">'+VIS.Msg.getMsg("VA009_PayManully")+'<\/option> <option value="P">'+VIS.Msg.getMsg("VA009_PayPrint")+"<\/option><\/select><label>"+VIS.Msg.getMsg("VA009_PaymentSelection")+"<\/label><\/div><\/div><div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_AccountDate_"+f.windowNo+"' placeholder=' ' data-placeholder=''><label>"+VIS.Msg.getMsg("AccountDate")+"<\/label><\/div><\/div><div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_TransactionDate"+f.windowNo+"' placeholder=' ' data-placeholder='' ><label>"+VIS.Msg.getMsg("TransactionDate")+"<\/label><\/div><\/div><div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbCurrencyType_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_CurrencyType")+"<\/label><\/div><\/div><div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbPaymthd_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_PayMthd")+"<\/label><\/div><\/div><div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='text' id='VA009_Chqnotxt_"+f.windowNo+"' placeholder=' ' data-placeholder='' disabled > <label>"+VIS.Msg.getMsg("VA009_Chqnolbl")+"<\/label><\/div><\/div><div class='VA009-popCheck-data VA009-popformchkctrlwrap' id='VA009_POP_textCheckNoDiv'><div><input type=\"checkbox\" id=\"VA009_chkConsolidate_"+f.windowNo+'"> <label>'+VIS.Msg.getMsg("VA009_ConsolidateCheck")+"<\/label><\/div><\/div><div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='text' placeholder='"+VIS.Msg.getMsg("VA009_ChkNo")+"' disabled id='VA009_POP_textCheckNo_"+f.windowNo+"'><label>"+VIS.Msg.getMsg("VA009_ChkNo")+"<\/label><\/div><\/div> <div class='VA009-grid-container'><div class='VA009-table-container' id='VA009_btnPopupGrid'><\/div><\/div><\/div>");_ChequePayble.append(_chequedata).append(p).append(_chequedata1);bt.append(_ChequePayble);gt();c=new Date;tt=c.getFullYear()+"-"+("0"+(c.getMonth()+1)).slice(-2)+"-"+("0"+c.getDate()).slice(-2);s.val(tt);ht.val(tt);vi=new VIS.ChildDialog;vi.setContent(bt);vi.setTitle(VIS.Msg.getMsg("VA009_LoadChequePayment"));vi.setWidth("80%");vi.setEnableResize(!0);vi.setModal(!0);(a.toString()!=""||y.toString()!=""||SlctdJournalPaymentIds.toString()!="")&&kt("");u.addVetoableChangeListener(this);$POP_cmbOrg.on("change",function(){VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())==0?$POP_cmbOrg.addClass("vis-ev-col-mandatory"):(vr($POP_cmbBank,VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())),$POP_cmbBank.val(0).prop("selected",!0),$POP_cmbBank.addClass("vis-ev-col-mandatory"),$POP_cmbBankAccount.empty(),$POP_cmbBankAccount.append("<option value='0'><\/option>"),$POP_cmbBankAccount.addClass("vis-ev-col-mandatory"),$POP_cmbOrg.removeClass("vis-ev-col-mandatory"),pt());it.LoadTargetDocType($POP_targetDocType,ni)});$POP_cmbBank.on("change",function(){function n(n){if($POP_cmbBankAccount.append("<option value='0'><\/option>"),n!=null&&n.length>0)for(var t in n)$POP_cmbBankAccount.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_BankAccount_ID)+">"+VIS.Utility.encodeText(n[t].AccountNo)+"<\/option>")}$POP_cmbBankAccount.empty();VIS.Utility.Util.getValueOfInt($POP_cmbBank.val())>0?$POP_cmbBank.removeClass("vis-ev-col-mandatory"):($POP_cmbBank.addClass("vis-ev-col-mandatory"),$POP_cmbBankAccount.addClass("vis-ev-col-mandatory"));u.setValue(0);$POP_txtChqNo.val("");VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadBankAccount",{Bank_ID:$POP_cmbBank.val(),Orgs:$POP_cmbOrg.val()},n)});$POP_cmbBankAccount.on("change",function(){function i(n){$POP_cmbBankAccount.val()=="0"?$POP_cmbBankAccount.addClass("vis-ev-col-mandatory"):$POP_cmbBankAccount.removeClass("vis-ev-col-mandatory");n!=null&&u.setValue(n.CurrentBalance);n==null&&u.setValue()}if(VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val())>0?($POP_cmbBankAccount.removeClass("vis-ev-col-mandatory"),$POP_PayMthd.val(0)):$POP_cmbBankAccount.addClass("vis-ev-col-mandatory"),t("#VA009_POP_cmbPaySelectn_"+f.windowNo)[0].value!=null&&t("#VA009_POP_cmbPaySelectn_"+f.windowNo)[0].value=="P"){var n=VIS.dataContext.getJSONRecord("VA009/Payment/GetProcessId",$POP_cmbBankAccount.val());if(!n)return VIS.ADialog.info("VA009_Plz_Process_IDNotFndBnkActDoc"),$POp_cmbPaySelectn.val("M"),!1}u.setValue(0);$POP_txtChqNo.val("");VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/GetBankAccountData",{BankAccount:$POP_cmbBankAccount.val()},i);t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetConvertedAmt",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(vt),BankAccount:$POP_cmbBankAccount.val(),CurrencyType:$pop_cmbCurrencyType.val(),dateAcct:s.val(),_org_Id:$POP_cmbOrg.val()<=0?0:$POP_cmbOrg.val()},success:function(n){ft(n)},error:function(n){console.log(n);VIS.ADialog.error("VA009_ErrorLoadingPayments")}})});$pop_cmbCurrencyType.on("change",function(){t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetConvertedAmt",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(vt),BankAccount:$POP_cmbBankAccount.val(),CurrencyType:$pop_cmbCurrencyType.val(),dateAcct:s.val(),_org_Id:$POP_cmbOrg.val()<=0?0:$POP_cmbOrg.val()},success:function(n){ft(n)},error:function(n){console.log(n);VIS.ADialog.error("VA009_ErrorLoadingPayments")}})});$POP_Consolidate.on("click",function(n){var i=t(n.target);n.target.type=="checkbox"&&(i.prop("checked")==!0?($POPtxtCheckNumber.removeAttr("disabled"),$POPtxtCheckNumber.css("background-color","white"),$POPtxtCheckNumber.addClass("vis-ev-col-mandatory")):($POPtxtCheckNumber.val(""),$POPtxtCheckNumber.attr("disabled","disabled"),$POPtxtCheckNumber.removeClass("vis-ev-col-mandatory"),$POPtxtCheckNumber.css("background-color","#ededed")))});$POP_PayMthd.on("change",function(){var n,t;if(ct=[],ai=[],dr=null,$POP_Consolidate.prop("checked",!1),$POPtxtCheckNumber.val(""),$POPtxtCheckNumber.attr("disabled","disabled"),VIS.Utility.Util.getValueOfInt($POP_PayMthd.val())>0){if($POP_PayMthd.removeClass("vis-ev-col-mandatory"),VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val())==0)return VIS.ADialog.info("VA009_PLSelectBankAccount",""),!1;if(n=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/GetBankAccountCheckNo",{BankAccount:$POP_cmbBankAccount.val(),PaymentMethod:$POP_PayMthd.val()}),n!=null)for($POP_txtChqNo.val(VIS.Utility.Util.getValueOfInt(n[0].Currentnext)),dr=n[0].Chknoautocontrol,i=0;i<n.length;i++)for(t=VIS.Utility.Util.getValueOfInt(n[i].Endchknumber)-VIS.Utility.Util.getValueOfInt(n[i].Currentnext),j=0;j<=t;j++)ct.push(VIS.Utility.Util.getValueOfInt(n[i].Currentnext)+j);else return $POP_txtChqNo.val("0"),VIS.ADialog.info("VA009_NoCheckNum",""),!1}else $POP_PayMthd.addClass("vis-ev-col-mandatory")});$POPtxtCheckNumber.on("change",function(){for(var n,o,f,i=0;i<r.records.length;i++)r.records[i].CheckNumber="",r.refreshCell(r.records[i].recid,"CheckNumber");if($POPtxtCheckNumber.val()=="")$POPtxtCheckNumber.addClass("vis-ev-col-mandatory");else{$POPtxtCheckNumber.removeClass("vis-ev-col-mandatory");nf=bt.find("#VA009_btnPopupGrid");var t=[],u=null,e=[];if(ai.length>0){for(n=ai.length-1;n>=0;n--)ct.unshift(ai[n]);ai=[]}for(n=0;n<r.records.length;n++){if(u={},t.indexOf(r.records[n].C_BPartner_ID)<0){if(t.push(r.records[n].C_BPartner_ID),u.C_BPartner_ID=r.records[n].C_BPartner_ID,n==0)r.records[n].CheckNumber=VIS.Utility.Util.getValueOfInt($POPtxtCheckNumber.val()),u.checknumber=r.records[n].CheckNumber,dr=="Y"?(ai=ct.slice(0,ct.indexOf(r.records[n].CheckNumber)+1),ct=ct.slice(ct.indexOf(r.records[n].CheckNumber)+1)):ct.push($POPtxtCheckNumber.val());else{if(ct.length==0)return VIS.ADialog.info("VA009_CheckNotAligned"),!1;dr=="Y"?(r.records[n].CheckNumber=VIS.Utility.Util.getValueOfInt(ct[0]),ai.push(r.records[n].CheckNumber),ct=ct.slice(ct.indexOf(r.records[n].CheckNumber)+1)):(r.records[n].CheckNumber=VIS.Utility.Util.getValueOfInt(ct[ct.length-1])+1,ct.push(VIS.Utility.Util.getValueOfInt(ct[ct.length-1])+1));u.checknumber=r.records[n].CheckNumber}e.push(u)}else if(t.indexOf(r.records[n].C_BPartner_ID)>-1){for(o=0,f=0;f<=e.length;f++)if(e[f].C_BPartner_ID===t[t.indexOf(r.records[n].C_BPartner_ID)]){o=f;break}r.records[n].CheckNumber=e[o].checknumber}else console.log("Skip");r.refreshCell(r.records[n].recid,"CheckNumber")}console.log("BPartner IDS =  "+t)}});$POp_cmbPaySelectn.on("change",function(){var n,i,u;if($POp_cmbPaySelectn.val()=="P"){for($POP_Consolidate.prop("cheched",!1),$POP_Consolidate.attr("disabled","disabled"),$POPtxtCheckNumber.val(""),n=0;n<r.records.length;n++){if(r.records[n].TransactionType=="Order"||r.records[n].TransactionType=="GL Journal")return VIS.ADialog.info("VA009_CannotPrintOrder"),$POp_cmbPaySelectn.val("M"),!1;r.records[n].CheckNumber="";r.records[n].CheckDate=new Date;r.refreshCell(r.records[n].recid,"CheckNumber");r.refreshCell(r.records[n].recid,"CheckDate")}if(i=t("#VA009_POP_cmbBankAccount_"+f.windowNo)[0].value>0?t("#VA009_POP_cmbBankAccount_"+f.windowNo)[0].value:0,i){if(u=VIS.dataContext.getJSONRecord("VA009/Payment/GetProcessId",i),!u)return VIS.ADialog.info("VA009_Plz_Process_IDNotFndBnkActDoc"),$POp_cmbPaySelectn.val("M"),!1}else return VIS.ADialog.info("VA009_PLSelectBankAccount"),$POp_cmbPaySelectn.val("M"),!1}else $POP_Consolidate.removeAttr("disabled")});s.on("change",function(){if(s.val()==""?s.addClass("vis-ev-col-mandatory"):s.removeClass("vis-ev-col-mandatory"),VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())<=0)return VIS.ADialog.info("VA009_PlsSelectOrg"),!1;if(VIS.Utility.Util.getValueOfInt($POP_targetDocType.val())<=0)return VIS.ADialog.info("VA009_PlsSelectDocumentType"),!1;if(VIS.Utility.Util.getValueOfInt($POP_cmbBank.val())<=0)return VIS.ADialog.info("VA009_PlsSelectBank"),!1;if(VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val())<=0)return VIS.ADialog.info("VA009_PlsSelectBankAccount"),!1;if(VIS.Utility.Util.getValueOfInt($POP_PayMthd.val())<=0)return VIS.ADialog.info("VA009_PlsSelectPaymentMethod"),!1;if(s.val()=="")return VIS.ADialog.info("VA009_PLSelectAcctDate"),!1;var i=Date.parse(s.val()),n=new Date(parseInt(i));!isNaN(n.getTime())&&n.getTime()<0||t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetConvertedAmt",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(vt),BankAccount:$POP_cmbBankAccount.val(),CurrencyType:$pop_cmbCurrencyType.val(),dateAcct:s.val(),_org_Id:$POP_cmbOrg.val()<=0?0:$POP_cmbOrg.val()},success:function(n){ft(n)},error:function(n){console.log(n);VIS.ADialog.error("VA009_ErrorLoadingPayments")}})});$POP_targetDocType.on("change",function(){VIS.Utility.Util.getValueOfInt($POP_targetDocType.val())==0?$POP_targetDocType.addClass("vis-ev-col-mandatory"):$POP_targetDocType.removeClass("vis-ev-col-mandatory")});vi.onOkClick=function(){var u=[],c,n,i,l,f,o,h;if(r.selectAll(),c=0,r.getSelection().length>0)if(VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())>0)if(VIS.Utility.Util.getValueOfInt($POP_targetDocType.val())>0)if(VIS.Utility.Util.getValueOfInt($POP_cmbBank.val())>0)if(VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val())>0)if(VIS.Utility.Util.getValueOfInt($POP_PayMthd.val())>0)if(s.val()!=""&&s.val()!=null)for(n=0;n<r.getSelection().length;n++){if(i={},l=0,i.C_BPartner_ID=r.get(r.getSelection()[n]).C_BPartner_ID,i.Description=r.get(r.getSelection()[n]).Description,i.C_Invoice_ID=r.get(r.getSelection()[n]).C_Invoice_ID,i.AD_Org_ID=VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val()),i.TargetDocType=VIS.Utility.Util.getValueOfInt($POP_targetDocType.val()),i.AD_Client_ID=r.get(r.getSelection()[n]).AD_Client_ID,i.C_InvoicePaySchedule_ID=r.get(r.getSelection()[n]).C_InvoicePaySchedule_ID,i.C_BankAccount_ID=VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val()),i.C_Currency_ID=r.get(r.getSelection()[n]).C_Currency_ID,i.DueAmt=r.get(r.getSelection()[n]).DueAmt,i.ConvertedAmt=r.get(r.getSelection()[n]).ConvertedAmt,i.PaymwentBaseType=r.get(r.getSelection()[n]).PaymwentBaseType,i.TransactionType=r.get(r.getSelection()[n]).TransactionType,i.C_BPartner_Location_ID=r.get(r.getSelection()[n]).C_BPartner_Location_ID,i.C_DocType_ID=r.get(r.getSelection()[n]).C_DocType_ID,i.DocBaseType=r.get(r.getSelection()[n]).DocBaseType,VIS.Utility.Util.getValueOfDecimal(e(r.get(r.getSelection()[n]).VA009_RecivedAmt))!=0)i.VA009_RecivedAmt=e(r.get(r.getSelection()[n]).VA009_RecivedAmt);else return VIS.ADialog.info("VA009_PLPayAmt"),r.selectNone(),!1;if(i.OverUnder=e(r.get(r.getSelection()[n]).OverUnder),i.Writeoff=e(r.get(r.getSelection()[n]).Writeoff),i.Discount=e(r.get(r.getSelection()[n]).Discount),i.DateTrx=VIS.Utility.Util.getValueOfDate(ht.val()),i.DateAcct=VIS.Utility.Util.getValueOfDate(s.val()),i.From="Pay",$POp_cmbPaySelectn.val()=="M"){if(r.get(r.getSelection()[n]).CheckDate!=""&&r.get(r.getSelection()[n]).CheckDate!=null){if(f=new Date(r.get(r.getSelection()[n]).CheckDate),f=new Date(f.setHours(0,0,0,0)),o=new Date(s.val()),o=new Date(o.setHours(0,0,0,0)),f>o)return VIS.ADialog.info("VIS_CheckDateCantbeGreaterSys"),r.selectNone(),!1;i.CheckDate=VIS.Utility.Util.getValueOfDate(r.get(r.getSelection()[n]).CheckDate)}else return VIS.ADialog.info("VA009_PLCheckDate"),r.selectNone(),!1;if(r.get(r.getSelection()[n]).CheckNumber!=""&&r.get(r.getSelection()[n]).CheckNumber!=null)i.CheckNumber=r.get(r.getSelection()[n]).CheckNumber;else return VIS.ADialog.info("VA009_PLCheckNumber"),r.selectNone(),!1}if(r.get(r.getSelection()[n]).VA009_RecivedAmt==0)return VIS.ADialog.info("VA009_PLRecivedAmt"),r.selectNone(),!1;if(i.CurrencyType=$pop_cmbCurrencyType.val(),i.VA009_PaymentMethod_ID=$POP_PayMthd.val(),n>0&&(h=t.grep(u,function(t){return r.get(r.getSelection()[n]).C_BPartner_ID==t.C_BPartner_ID&&r.get(r.getSelection()[n]).CheckNumber==t.CheckNumber&&r.get(r.getSelection()[n]).TransactionType!=t.TransactionType}),h&&h.length>0&&r.get(r.getSelection()[n]).TransactionType=="Order"))return VIS.ADialog.info("VA009_SameCheckNo"),r.selectNone(),!1;u.push(i)}else return VIS.ADialog.info("VA009_PLSelectAcctDate"),r.selectNone(),!1;else return VIS.ADialog.info("VA009_PLSelectPaymentMethod"),r.selectNone(),!1;else return VIS.ADialog.info("VA009_PLSelectBankAccount"),r.selectNone(),!1;else return VIS.ADialog.info("VA009_PLSelectBank"),r.selectNone(),!1;else return VIS.ADialog.info("VA009_PlsSelectDocumentType"),r.selectNone(),!1;else return VIS.ADialog.info("VA009_PlsSelectOrg"),r.selectNone(),!1;$POp_cmbPaySelectn.val()=="M"?(v[0].style.visibility="visible",t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GeneratePayments",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(u)},success:function(n){fi(n)},error:function(n){console.log(n);v[0].style.visibility="hidden";VIS.ADialog.error("VA009_ErrorLoadingPayments")}})):$POp_cmbPaySelectn.val()=="P"&&(v[0].style.visibility="visible",t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GeneratePaymentsBatchOfRule",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(u)},success:function(n){si(n)},error:function(n){console.log(n);v[0].style.visibility="hidden";VIS.ADialog.error("VA009_ErrorLoadingPayments")}}))};vi.onCancelCLick=function(){r.clear();wt()};vi.onClose=function(){r.clear();wt()};this.vetoablechange=function(n){n.propertyName=="VA009_AccountBalance"+f.windowNo+""&&u.setValue(n.newValue)}},Cheque_Rec_Dialog:function(){function ft(n){n!=""?(v[0].style.visibility="hidden",VIS.ADialog.info("VA009_PleaseSelctonlyCheque")):(yi.show(),bt(),vr($RPOP_cmbBank,VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())),$RPOP_cmbBank.addClass("vis-ev-col-mandatory"),$RPOP_cmbBankAccount.addClass("vis-ev-col-mandatory"),s.val()?s.removeClass("vis-ev-col-mandatory"):s.addClass("vis-ev-col-mandatory"),dt(gt),yt(),pt(),wt(),it.LoadTargetDocType($POP_targetDocType,ni))}function lt(){$RPOP_cmbBank=fi.find("#VA009_POP_cmbBank_"+f.windowNo);$RPOP_cmbBankAccount=fi.find("#VA009_POP_cmbBankAccount_"+f.windowNo);$POP_PayMthd=fi.find("#VA009_POP_cmbPaymthd_"+f.windowNo);gu=fi.find("#VA009_btnPopupRecGrid");$pop_cmbCurrencyType=fi.find("#VA009_POP_cmbCurrencyType_"+f.windowNo);s=fi.find("#VA009_AccountDate_"+f.windowNo);ht=fi.find("#VA009_TransactionDate"+f.windowNo);$POP_cmbOrg=fi.find("#VA009_POP_cmbOrg_"+f.windowNo);$POP_cmbOrg.addClass("vis-ev-col-mandatory");$POP_targetDocType=fi.find("#VA009_POP_cmbDocType_"+f.windowNo);$POP_targetDocType.addClass("vis-ev-col-mandatory")}function yt(){function n(n){if($pop_cmbCurrencyType.append("<option value='0'><\/option>"),n.length>0){for(var t in n)$pop_cmbCurrencyType.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>"),VIS.Utility.encodeText(n[t].IsDefault)=="Y"&&(ei=VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID));$pop_cmbCurrencyType.val(ei)}}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/loadCurrencyType",null,n)}function pt(){function n(n){if(n.length>1&&$POP_PayMthd.append(" <option value = 0><\/option>"),n.length>0)for(var t in n)$POP_PayMthd.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].VA009_PaymentMethod_ID)+">"+VIS.Utility.encodeText(n[t].VA009_Name)+"<\/option>");$POP_PayMthd.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadChequePaymentMethod",{Org_ID:null},n)}function wt(){function n(n){if($POP_cmbOrg.append(" <option value = 0><\/option>"),n.length>0)for(var t in n)$POP_cmbOrg.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].AD_Org_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>");$POP_cmbOrg.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadOrganization",null,n)}function c(t){var r,u,i;n.clear();g=[];r=JSON.parse(t);vt=r;for(u in r)i={},i.recid=r[u].recid,i.C_Bpartner=r[u].C_Bpartner,i.C_BPartner_Location_ID=r[u].C_BPartner_Location_ID,i.C_DocType_ID=r[u].C_DocType_ID,i.C_Invoice_ID=r[u].C_Invoice_ID,i.C_BPartner_ID=r[u].C_BPartner_ID,i.C_InvoicePaySchedule_ID=r[u].C_InvoicePaySchedule_ID,i.CurrencyCode=r[u].CurrencyCode,i.DueAmt=r[u].DueAmt,i.VA009_RecivedAmt=r[u].convertedAmt,i.OverUnder="0",i.Writeoff="0",i.Discount="0",i.ConvertedAmt=r[u].convertedAmt,i.C_Currency_ID=r[u].C_Currency_ID,i.AD_Org_ID=r[u].AD_Org_ID,i.AD_Client_ID=r[u].AD_Client_ID,i.CheckDate=new Date,i.CheckNumber=null,i.ValidMonths=null,i.VA009_PaymentMode=r[u].VA009_PaymentMode,i.PaymwentBaseType=r[u].PaymwentBaseType,i.TransactionType=r[u].TransactionType,i.DocBaseType=r[u].DocBaseType,g.push(i);r[0].ERROR=="ConversionNotFound"&&VIS.ADialog.info("VA009_ConversionNotFound");w2utils.encodeTags(g);n.add(g)}function bt(){g=[];var i=[];i.length==0&&(i.push({field:"C_Bpartner",caption:VIS.Msg.getMsg("VA009_BPartner"),sortable:!0,size:"12%"}),i.push({field:"C_InvoicePaySchedule_ID",caption:VIS.Msg.getMsg("VA009_Schedule"),sortable:!0,size:"8%"}),i.push({field:"Description",caption:VIS.Msg.getMsg("Description"),sortable:!0,size:"15%",editable:{type:"text"}}),i.push({field:"CurrencyCode",caption:VIS.Msg.getMsg("VA009_Currency"),sortable:!0,size:"8%"}),i.push({field:"DueAmt",caption:VIS.Msg.getMsg("VA009_DueAmt"),sortable:!0,size:"12%",style:"text-align: right",render:function(n){var t=n.DueAmt;return parseFloat(t).toLocaleString(window.navigator.language,{minimumFractionDigits:h,maximumFractionDigits:h})}}),i.push({field:"ConvertedAmt",caption:VIS.Msg.getMsg("VA009_ConvertedAmt"),sortable:!0,size:"12%",style:"text-align: right",render:function(n){var t=n.ConvertedAmt;return parseFloat(t).toLocaleString(window.navigator.language,{minimumFractionDigits:h,maximumFractionDigits:h})}}),i.push({field:"VA009_RecivedAmt",caption:VIS.Msg.getMsg("VA009_ReceivedAmt"),sortable:!0,size:"12%",style:"text-align: right",render:function(n){var t=n.VA009_RecivedAmt;return t=oi(event,t,t),parseFloat(t).toLocaleString(window.navigator.language,{minimumFractionDigits:h,maximumFractionDigits:h})},editable:{type:"number"}}),i.push({field:"OverUnder",caption:VIS.Msg.getMsg("VA009_OverUnder"),sortable:!0,size:"8%",style:"text-align: right",render:function(n){var t=n.OverUnder;return parseFloat(t).toLocaleString(window.navigator.language,{minimumFractionDigits:h,maximumFractionDigits:h})}}),i.push({field:"Writeoff",caption:VIS.Msg.getMsg("VA009_Writeoff"),sortable:!0,size:"8%",style:"text-align: right",render:function(n){var t=n.Writeoff;return t=oi(event,t,t),parseFloat(t).toLocaleString(window.navigator.language,{minimumFractionDigits:h,maximumFractionDigits:h})},editable:{type:"number"}}),i.push({field:"Discount",caption:VIS.Msg.getMsg("VA009_Discount"),sortable:!0,size:"8%",style:"text-align: right",render:function(n){var t=n.Discount;return t=oi(event,t,t),parseFloat(t).toLocaleString(window.navigator.language,{minimumFractionDigits:h,maximumFractionDigits:h})},editable:{type:"number"}}),i.push({field:"CheckNumber",caption:VIS.Msg.getMsg("VA009_ChkNo"),sortable:!0,size:"8%",editable:{type:"alphanumeric",autoFormat:!0,groupSymbol:" "}}),i.push({field:"CheckDate",caption:VIS.Msg.getMsg("VA009_CheckDate"),sortable:!0,size:"10%",style:"text-align: left",render:function(n){var t;return t=n.changes==undefined||n.changes.CheckDate==""?n.CheckDate:n.changes.CheckDate,new Date(t).toLocaleDateString()},editable:{type:"date"}}),i.push({field:"recid",caption:VIS.Msg.getMsg("VA009_srno"),sortable:!0,size:"1%"}),i.push({field:"TransactionType",caption:VIS.Msg.getMsg("VA009_TransactionType"),sortable:!0,size:"1%"}),i.push({field:"C_BPartner_Location_ID",caption:VIS.Msg.getMsg("C_BPartner_Location_ID"),sortable:!0,size:"1%"}),i.push({field:"C_DocType_ID",caption:VIS.Msg.getMsg("C_DocType_ID"),sortable:!0,size:"1%"}),i.push({field:"DocBaseType",caption:VIS.Msg.getMsg("DocBaseType"),sortable:!0,size:"1%"}));n=null;n=gu.w2grid({name:"CheueRecevableGrid_"+f.windowNo,recordHeight:25,columns:i,method:"GET",multiSelect:!0,show:{toolbarSave:!0},onEditField:function(i){(i.column==6||i.column==8||i.column==9)&&(n.get(i.recid).TransactionType=="Order"||n.get(i.recid).TransactionType=="GL Journal")&&(i.isCancelled=!0);n.records[i.index][n.columns[i.column].field]=oi(i,n.records[i.index][n.columns[i.column].field]);var r=kt.GetFormatAmount(n.records[i.index][n.columns[i.column].field],"init",k);n.records[i.index][n.columns[i.column].field]=kt.GetConvertedString(r,k);id=i.recid;(i.column==8||i.column==9||i.column==6)&&t("#grid_CheueRecevableGrid_"+f.windowNo+"_rec_"+id).keydown(function(n){if(k||n.keyCode!=190&&n.keyCode!=110){if(k&&n.keyCode==188)return!1}else return!1;return n.target.value.contains(".")&&(n.which==110||n.which==190||n.which==188)?n.target.value.indexOf(".")>-1&&(n.target.value=n.target.value.replace(".","")):n.target.value.contains(",")&&(n.which==110||n.which==190||n.which==188)&&n.target.value.indexOf(",")>-1&&(n.target.value=n.target.value.replace(",","")),n.keyCode!=8&&n.keyCode!=9&&(n.keyCode<37||n.keyCode>40)&&(n.keyCode<48||n.keyCode>57)&&(n.keyCode<96||n.keyCode>105)&&n.keyCode!=109&&n.keyCode!=189&&n.keyCode!=110&&n.keyCode!=144&&n.keyCode!=188&&n.keyCode!=190?!1:void 0})},onChange:function(t){window.setTimeout(function(){if(n.getChanges(t.recid)!=undefined){var i=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/GetCurrencyPrecision",{BankAccount_ID:$RPOP_cmbBankAccount.val(),CurrencyFrom:"B"},null);if((i==null||i==0)&&(i=2),n.records[t.index].ConvertedAmt=parseFloat(e(n.records[t.index].ConvertedAmt)),n.records[t.index].VA009_RecivedAmt=parseFloat(e(n.records[t.index].VA009_RecivedAmt)),n.records[t.index].OverUnder=parseFloat(e(n.records[t.index].OverUnder)),n.records[t.index].Writeoff=parseFloat(e(n.records[t.index].Writeoff)),n.records[t.index].Discount=parseFloat(e(n.records[t.index].Discount)),t.column==6){if(t.value_new==""?t.value_new=0:(t.value_new=kt.GetConvertedNumber(t.value_new,k),t.value_new=t.value_new.toLocaleString(window.navigator.language,{minimumFractionDigits:i,maximumFractionDigits:i}),t.value_new=kt.GetConvertedNumber(t.value_new,k),t.value_original=kt.GetConvertedNumber(t.value_original,k)),t.value_new>n.records[t.index].ConvertedAmt){VIS.ADialog.error("MoreScheduleAmount");t.value_new=t.value_original;n.get(t.recid).changes.VA009_RecivedAmt=o(t,t.value_new);n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt);n.refreshCell(t.recid,"VA009_RecivedAmt");return}if(n.get(t.recid).changes.VA009_RecivedAmt=o(t,t.value_new.toFixed(i)),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt),n.records[t.index].PaymwentBaseType=="ARR"||n.records[t.index].PaymwentBaseType=="APP")if(parseFloat(t.value_new)>n.records[t.index].ConvertedAmt)n.records[t.index].ConvertedAmt>0?(n.get(t.recid).changes.OverUnder=(n.records[t.index].ConvertedAmt-parseFloat(t.value_new)).toFixed(i),n.records[t.index].OverUnder=n.get(t.recid).changes.OverUnder,n.get(t.recid).changes.Writeoff=0):(n.get(t.recid).changes.OverUnder=(n.records[t.index].ConvertedAmt-parseFloat(t.value_new)).toFixed(i),n.records[t.index].OverUnder=n.get(t.recid).changes.OverUnder,n.get(t.recid).changes.Writeoff=0,n.get(t.recid).Writeoff=0),n.get(t.recid).changes.Discount=0,n.refreshCell(t.recid,"OverUnder"),n.refreshCell(t.recid,"Discount"),n.refreshCell(t.recid,"Writeoff");else if(parseFloat(t.value_new)==n.records[t.index].ConvertedAmt)n.get(t.recid).changes.OverUnder=0,n.get(t.recid).OverUnder=0,n.get(t.recid).changes.Discount=0,n.get(t.recid).changes.Writeoff=0,n.get(t.recid).Discount=0,n.get(t.recid).Writeoff=0,n.get(t.recid).changes.VA009_RecivedAmt=o(t,parseFloat(t.value_new)),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt),n.refreshCell(t.recid,"OverUnder"),n.refreshCell(t.recid,"Discount"),n.refreshCell(t.recid,"Writeoff"),n.refreshCell(t.recid,"VA009_RecivedAmt");else if(parseFloat(t.value_new)<n.records[t.index].ConvertedAmt){if(n.records[t.index].ConvertedAmt>0)if(n.get(t.recid).TransactionType=="Order")n.get(t.recid).changes.Discount=(n.records[t.index].ConvertedAmt-parseFloat(t.value_new)).toFixed(i),n.records[t.index].Discount=n.get(t.recid).changes.Discount,n.get(t.recid).changes.Writeoff=0,n.get(t.recid).Writeoff=0,n.get(t.recid).changes.OverUnder=0,n.get(t.recid).OverUnder=0;else{if(t.value_original.toFixed(i)==parseFloat(t.value_new).toFixed(i))return!1;n.get(t.recid).changes.OverUnder=(n.records[t.index].ConvertedAmt-parseFloat(t.value_new)).toFixed(i);n.get(t.recid).changes.OverUnder=o(t,n.get(t.recid).changes.OverUnder);n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder);n.get(t.recid).changes.Writeoff=0;n.get(t.recid).Writeoff=0;n.get(t.recid).changes.Discount=0;n.get(t.recid).Discount=0}else if(n.get(t.recid).TransactionType=="Order")n.get(t.recid).changes.Discount=(n.records[t.index].ConvertedAmt-parseFloat(t.value_new)).toFixed(i),n.records[t.index].Discount=n.get(t.recid).changes.Discount,n.get(t.recid).changes.Writeoff=0,n.get(t.recid).Writeoff=0,n.get(t.recid).changes.OverUnder=0,n.get(t.recid).OverUnder=0;else{if(t.value_original.toFixed(i)==parseFloat(t.value_new).toFixed(i))return!1;n.get(t.recid).changes.OverUnder=(n.records[t.index].ConvertedAmt-parseFloat(t.value_new)).toFixed(i);n.get(t.recid).changes.OverUnder=o(t,n.get(t.recid).changes.OverUnder);n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder);n.get(t.recid).changes.Writeoff=0;n.get(t.recid).Writeoff=0;n.get(t.recid).changes.Discount=0;n.get(t.recid).Discount=0}n.refreshCell(t.recid,"OverUnder");n.refreshCell(t.recid,"Discount");n.refreshCell(t.recid,"Writeoff")}}if(t.column==8){if(t.value_new==""?t.value_new=0:(t.value_new=kt.GetConvertedNumber(t.value_new,k),t.value_new=t.value_new.toLocaleString(window.navigator.language,{minimumFractionDigits:i,maximumFractionDigits:i}),t.value_new=kt.GetConvertedNumber(t.value_new,k),t.value_original=kt.GetConvertedNumber(t.value_original,k)),n.get(t.recid).changes.Writeoff=o(t,t.value_new.toFixed(i)),n.records[t.index].Writeoff=e(n.get(t.recid).changes.Writeoff),t.value_new>n.records[t.index].ConvertedAmt){VIS.ADialog.error("MoreScheduleAmount");t.value_new=t.value_original;n.get(t.recid).changes.Writeoff=o(t,t.value_new);n.records[t.index].Writeoff=e(n.get(t.recid).changes.Writeoff);n.refreshCell(t.recid,"Writeoff");return}n.records[t.index].PaymwentBaseType=="APP"?parseFloat(t.value_new)>n.records[t.index].ConvertedAmt?(n.get(t.recid).changes.VA009_RecivedAmt=((parseFloat(t.value_new)-n.records[t.index].ConvertedAmt)*-1).toFixed(i),n.records[t.index].VA009_RecivedAmt=n.get(t.recid).changes.VA009_RecivedAmt,n.refreshCell(t.recid,"VA009_RecivedAmt")):parseFloat(t.value_new)<n.records[t.index].ConvertedAmt&&(n.get(t.recid).changes.Discount==undefined&&n.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].VA009_RecivedAmt+n.records[t.index].Discount)).toFixed(i),n.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.OverUnder=o(t,n.records[t.index].OverUnder),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder),n.get(t.recid).changes.Writeoff=o(t,t.value_original),n.records[t.index].Writeoff=e(n.get(t.recid).changes.Writeoff)):(n.get(t.recid).changes.OverUnder=o(t,Math.abs(n.get(t.recid).changes.OverUnder).toFixed(i)),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder)),n.refreshCell(t.recid,"Writeoff")):(n.get(t.recid).changes.VA009_RecivedAmt=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].OverUnder+n.records[t.index].Discount)).toFixed(i),n.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.VA009_RecivedAmt=o(t,n.records[t.index].VA009_RecivedAmt),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt),n.get(t.recid).changes.Writeoff=o(t,t.value_original),n.records[t.index].Writeoff=e(n.get(t.recid).changes.Writeoff)):(n.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(n.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt))):n.get(t.recid).changes.Discount==undefined?VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].VA009_RecivedAmt+n.records[t.index].Discount)).toFixed(i),n.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.OverUnder=o(t,n.records[t.index].OverUnder),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder),n.get(t.recid).changes.Writeoff=o(t,t.value_original),n.records[t.index].Writeoff=e(n.get(t.recid).changes.Writeoff)):(n.get(t.recid).changes.OverUnder=o(t,Math.abs(n.get(t.recid).changes.OverUnder).toFixed(i)),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder)),n.refreshCell(t.recid,"Writeoff")):(n.get(t.recid).changes.VA009_RecivedAmt=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].OverUnder+n.records[t.index].Discount)).toFixed(i),n.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.VA009_RecivedAmt=o(t,n.records[t.index].VA009_RecivedAmt),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt),n.get(t.recid).changes.Writeoff=o(t,t.value_original),n.records[t.index].Writeoff=e(n.get(t.recid).changes.Writeoff)):(n.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(n.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt))):n.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].VA009_RecivedAmt+n.records[t.index].Discount)).toFixed(i),n.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.OverUnder=o(t,n.records[t.index].OverUnder),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder),n.get(t.recid).changes.Writeoff=o(t,t.value_original),n.records[t.index].Writeoff=e(n.get(t.recid).changes.Writeoff)):(n.get(t.recid).changes.OverUnder=o(t,Math.abs(n.get(t.recid).changes.OverUnder).toFixed(i)),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder)),n.refreshCell(t.recid,"Writeoff")):(n.get(t.recid).changes.VA009_RecivedAmt=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].OverUnder+n.records[t.index].Discount)).toFixed(i),n.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.VA009_RecivedAmt=o(t,n.records[t.index].VA009_RecivedAmt),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt),n.get(t.recid).changes.Writeoff=o(t,t.value_original),n.records[t.index].Writeoff=e(n.get(t.recid).changes.Writeoff)):(n.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(n.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt))):VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].VA009_RecivedAmt+n.records[t.index].Discount)).toFixed(i),n.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.OverUnder=o(t,n.records[t.index].OverUnder),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder),n.get(t.recid).changes.Writeoff=o(t,t.value_original),n.records[t.index].Writeoff=e(n.get(t.recid).changes.Writeoff)):(n.get(t.recid).changes.OverUnder=o(t,Math.abs(n.get(t.recid).changes.OverUnder).toFixed(i)),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder)),n.refreshCell(t.recid,"Writeoff")):(n.get(t.recid).changes.VA009_RecivedAmt=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].OverUnder+n.records[t.index].Discount)).toFixed(i),n.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.VA009_RecivedAmt=o(t,n.records[t.index].VA009_RecivedAmt),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt),n.get(t.recid).changes.Writeoff=o(t,t.value_original),n.records[t.index].Writeoff=e(n.get(t.recid).changes.Writeoff)):(n.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(n.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt))),n.refreshCell(t.recid,"VA009_RecivedAmt"),n.refreshCell(t.recid,"OverUnder")):n.records[t.index].PaymwentBaseType=="ARR"&&(parseFloat(t.value_new)>n.records[t.index].ConvertedAmt?(n.records[t.index].ConvertedAmt<0||(VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].VA009_RecivedAmt+n.records[t.index].Discount)).toFixed(i),n.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.OverUnder=o(t,n.records[t.index].OverUnder),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder),n.get(t.recid).changes.Writeoff=o(t,t.value_original),n.records[t.index].Writeoff=e(n.get(t.recid).changes.Writeoff)):(n.get(t.recid).changes.OverUnder=o(t,Math.abs(n.get(t.recid).changes.OverUnder).toFixed(i)),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder)),n.refreshCell(t.recid,"OverUnder"),n.refreshCell(t.recid,"Writeoff")):(n.get(t.recid).changes.VA009_RecivedAmt=(parseFloat(t.value_new)-n.records[t.index].ConvertedAmt).toFixed(i),n.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.VA009_RecivedAmt=o(t,n.records[t.index].VA009_RecivedAmt),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt),n.get(t.recid).changes.Writeoff=o(t,t.value_original),n.records[t.index].Writeoff=e(n.get(t.recid).changes.Writeoff)):(n.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(n.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt)))),n.refreshCell(t.recid,"VA009_RecivedAmt"),n.refreshCell(t.recid,"OverUnder")):parseFloat(t.value_new)<=n.records[t.index].ConvertedAmt&&(n.get(t.recid).changes.Discount==undefined&&n.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].VA009_RecivedAmt+n.records[t.index].Discount)).toFixed(i),n.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.OverUnder=o(t,n.records[t.index].OverUnder),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder),n.get(t.recid).changes.Writeoff=o(t,t.value_original),n.records[t.index].Writeoff=e(n.get(t.recid).changes.Writeoff)):(n.get(t.recid).changes.OverUnder=o(t,Math.abs(n.get(t.recid).changes.OverUnder).toFixed(i)),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder)),n.refreshCell(t.recid,"OverUnder"),n.refreshCell(t.recid,"Writeoff")):(n.get(t.recid).changes.VA009_RecivedAmt=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].OverUnder+n.records[t.index].Discount)).toFixed(i),n.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.VA009_RecivedAmt=o(t,n.records[t.index].VA009_RecivedAmt),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt),n.get(t.recid).changes.Writeoff=o(t,t.value_original),n.records[t.index].Writeoff=e(n.get(t.recid).changes.Writeoff)):(n.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(n.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt))):n.get(t.recid).changes.Discount==undefined?VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].VA009_RecivedAmt+n.records[t.index].Discount)).toFixed(i),n.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.OverUnder=o(t,n.records[t.index].OverUnder),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder),n.get(t.recid).changes.Writeoff=o(t,t.value_original),n.records[t.index].Writeoff=e(n.get(t.recid).changes.Writeoff)):(n.get(t.recid).changes.OverUnder=o(t,Math.abs(n.get(t.recid).changes.OverUnder).toFixed(i)),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder)),n.refreshCell(t.recid,"OverUnder"),n.refreshCell(t.recid,"Writeoff")):(n.get(t.recid).changes.VA009_RecivedAmt=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].OverUnder+n.records[t.index].Discount)).toFixed(i),n.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.VA009_RecivedAmt=o(t,n.records[t.index].VA009_RecivedAmt),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt),n.get(t.recid).changes.Writeoff=o(t,t.value_original),n.records[t.index].Writeoff=e(n.get(t.recid).changes.Writeoff)):(n.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(n.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt))):n.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].VA009_RecivedAmt+n.records[t.index].Discount)).toFixed(i),n.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.OverUnder=o(t,n.records[t.index].OverUnder),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder),n.get(t.recid).changes.Writeoff=o(t,t.value_original),n.records[t.index].Writeoff=e(n.get(t.recid).changes.Writeoff)):(n.get(t.recid).changes.OverUnder=o(t,Math.abs(n.get(t.recid).changes.OverUnder).toFixed(i)),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder)),n.refreshCell(t.recid,"OverUnder")):(n.get(t.recid).changes.VA009_RecivedAmt=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].OverUnder+n.records[t.index].Discount)).toFixed(i),n.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.VA009_RecivedAmt=o(t,n.records[t.index].VA009_RecivedAmt),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt),n.get(t.recid).changes.Writeoff=o(t,t.value_original),n.records[t.index].Writeoff=e(n.get(t.recid).changes.Writeoff)):(n.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(n.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt))):VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].VA009_RecivedAmt+n.records[t.index].Discount)).toFixed(i),n.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.OverUnder=o(t,n.records[t.index].OverUnder),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder),n.get(t.recid).changes.Writeoff=o(t,t.value_original),n.records[t.index].Writeoff=e(n.get(t.recid).changes.Writeoff)):(n.get(t.recid).changes.OverUnder=o(t,Math.abs(n.get(t.recid).changes.OverUnder).toFixed(i)),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder)),n.refreshCell(t.recid,"OverUnder")):(n.get(t.recid).changes.VA009_RecivedAmt=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].OverUnder+n.records[t.index].Discount)).toFixed(i),n.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.VA009_RecivedAmt=o(t,n.records[t.index].VA009_RecivedAmt),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt),n.get(t.recid).changes.Writeoff=o(t,t.value_original),n.records[t.index].Writeoff=e(n.get(t.recid).changes.Writeoff)):(n.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(n.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt))),n.refreshCell(t.recid,"VA009_RecivedAmt"),n.refreshCell(t.recid,"OverUnder")))}if(t.column==9){if(t.value_new==""?t.value_new=0:(t.value_new=kt.GetConvertedNumber(t.value_new,k),t.value_new=t.value_new.toLocaleString(window.navigator.language,{minimumFractionDigits:i,maximumFractionDigits:i}),t.value_new=kt.GetConvertedNumber(t.value_new,k),t.value_original=kt.GetConvertedNumber(t.value_original,k)),n.get(t.recid).changes.Discount=o(t,t.value_new.toFixed(i)),n.records[t.index].Discount=e(n.get(t.recid).changes.Discount),t.value_new>n.records[t.index].ConvertedAmt){VIS.ADialog.error("MoreScheduleAmount");t.value_new=t.value_original;n.get(t.recid).changes.Discount=o(t,t.value_new);n.records[t.index].Discount=e(n.get(t.recid).changes.Discount);n.refreshCell(t.recid,"Discount");return}n.records[t.index].PaymwentBaseType=="APP"?parseFloat(t.value_new)>n.records[t.index].ConvertedAmt?(n.get(t.recid).changes.VA009_RecivedAmt=((t.value_new-n.records[t.index].ConvertedAmt)*-1).toFixed(i),n.records[t.index].VA009_RecivedAmt=n.get(t.recid).changes.VA009_RecivedAmt,n.refreshCell(t.recid,"VA009_RecivedAmt")):parseFloat(t.value_new)<n.records[t.index].ConvertedAmt&&(n.get(t.recid).changes.Writeoff==undefined&&n.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.records[t.index].Writeoff))).toFixed(i),n.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.OverUnder=o(t,n.records[t.index].OverUnder),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder),n.get(t.recid).changes.Discount=o(t,t.value_original),n.records[t.index].Discount=e(n.get(t.recid).changes.Discount)):(n.get(t.recid).changes.OverUnder=o(t,Math.abs(n.get(t.recid).changes.OverUnder).toFixed(i)),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder))):(n.get(t.recid).changes.VA009_RecivedAmt=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].OverUnder+n.records[t.index].Writeoff)).toFixed(i),n.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.VA009_RecivedAmt=o(t,n.records[t.index].VA009_RecivedAmt),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt),n.get(t.recid).changes.Discount=o(t,t.value_original),n.records[t.index].Discount=e(n.get(t.recid).changes.Discount)):(n.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(n.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt))):n.get(t.recid).changes.Writeoff==undefined?VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.records[t.index].Writeoff))).toFixed(i),n.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.OverUnder=o(t,n.records[t.index].OverUnder),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder),n.get(t.recid).changes.Discount=o(t,t.value_original),n.records[t.index].Discount=e(n.get(t.recid).changes.Discount)):(n.get(t.recid).changes.OverUnder=o(t,Math.abs(n.get(t.recid).changes.OverUnder).toFixed(i)),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder))):(n.get(t.recid).changes.VA009_RecivedAmt=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].Overunder+n.records[t.index].Writeoff)).toFixed(i),n.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.VA009_RecivedAmt=o(t,n.records[t.index].VA009_RecivedAmt),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt),n.get(t.recid).changes.Discount=o(t,t.value_original),n.records[t.index].Discount=e(n.get(t.recid).changes.Discount)):(n.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(n.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt))):n.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.records[t.index].Writeoff))).toFixed(i),n.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.OverUnder=o(t,n.records[t.index].OverUnder),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder),n.get(t.recid).changes.Discount=o(t,t.value_original),n.records[t.index].Discount=e(n.get(t.recid).changes.Discount)):(n.get(t.recid).changes.OverUnder=o(t,Math.abs(n.get(t.recid).changes.OverUnder).toFixed(i)),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder))):(n.get(t.recid).changes.VA009_RecivedAmt=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].OverUnder+n.records[t.index].Writeoff)).toFixed(i),n.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.VA009_RecivedAmt=o(t,n.records[t.index].VA009_RecivedAmt),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt),n.get(t.recid).changes.Discount=o(t,t.value_original),n.records[t.index].Discount=e(n.get(t.recid).changes.Discount)):(n.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(n.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt))):VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.records[t.index].Writeoff))).toFixed(i),n.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.OverUnder=o(t,n.records[t.index].OverUnder),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder),n.get(t.recid).changes.Discount=o(t,t.value_original),n.records[t.index].Discount=e(n.get(t.recid).changes.Discount)):(n.get(t.recid).changes.OverUnder=o(t,Math.abs(n.get(t.recid).changes.OverUnder).toFixed(i)),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder))):(n.get(t.recid).changes.VA009_RecivedAmt=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].Writeoff+n.records[t.index].Writeoff)).toFixed(i),n.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.VA009_RecivedAmt=o(t,n.records[t.index].VA009_RecivedAmt),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt),n.get(t.recid).changes.Discount=o(t,t.value_original),n.records[t.index].Discount=e(n.get(t.recid).changes.Discount)):(n.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(n.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt))),n.refreshCell(t.recid,"VA009_RecivedAmt"),n.refreshCell(t.recid,"OverUnder")):n.records[t.index].PaymwentBaseType=="ARR"&&(parseFloat(t.value_new)>n.records[t.index].ConvertedAmt?(n.records[t.index].ConvertedAmt<0||(VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.records[t.index].Writeoff))).toFixed(i),n.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.OverUnder=o(t,n.records[t.index].OverUnder),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder),n.get(t.recid).changes.Discount=o(t,t.value_original),n.records[t.index].Discount=e(n.get(t.recid).changes.Discount)):(n.get(t.recid).changes.OverUnder=o(t,Math.abs(n.get(t.recid).changes.OverUnder).toFixed(i)),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder))):(n.get(t.recid).changes.VA009_RecivedAmt=(parseFloat(t.value_new)-n.records[t.index].ConvertedAmt).toFixed(i),n.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.VA009_RecivedAmt=o(t,n.records[t.index].VA009_RecivedAmt),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt),n.get(t.recid).changes.Discount=o(t,t.value_original),n.records[t.index].Discount=e(n.get(t.recid).changes.Discount)):(n.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(n.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt)))),n.refreshCell(t.recid,"VA009_RecivedAmt"),n.refreshCell(t.recid,"OverUnder")):parseFloat(t.value_new)<=n.records[t.index].ConvertedAmt&&(n.get(t.recid).changes.Writeoff==undefined&&n.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.records[t.index].Writeoff))).toFixed(i),n.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.OverUnder=o(t,n.records[t.index].OverUnder),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder),n.get(t.recid).changes.Discount=o(t,t.value_original),n.records[t.index].Discount=e(n.get(t.recid).changes.Discount)):(n.get(t.recid).changes.OverUnder=o(t,Math.abs(n.get(t.recid).changes.OverUnder).toFixed(i)),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder)),n.refreshCell(t.recid,"OverUnder")):(n.get(t.recid).changes.VA009_RecivedAmt=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].OverUnder+n.records[t.index].Writeoff)).toFixed(i),n.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.VA009_RecivedAmt=o(t,n.records[t.index].VA009_RecivedAmt),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt),n.get(t.recid).changes.Discount=o(t,t.value_original),n.records[t.index].Discount=e(n.get(t.recid).changes.Discount)):(n.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(n.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt))):n.get(t.recid).changes.Writeoff==undefined?VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.records[t.index].Writeoff))).toFixed(i),n.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.OverUnder=o(t,n.records[t.index].OverUnder),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder),n.get(t.recid).changes.Discount=o(t,t.value_original),n.records[t.index].Discount=e(n.get(t.recid).changes.Discount)):(n.get(t.recid).changes.OverUnder=o(t,Math.abs(n.get(t.recid).changes.OverUnder).toFixed(i)),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder)),n.refreshCell(t.recid,"OverUnder")):(n.get(t.recid).changes.VA009_RecivedAmt=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].OverUnder+n.records[t.index].Writeoff)).toFixed(i),n.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.VA009_RecivedAmt=o(t,n.records[t.index].VA009_RecivedAmt),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt),n.get(t.recid).changes.Discount=o(t,t.value_original),n.records[t.index].Discount=e(n.get(t.recid).changes.Discount)):(n.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(n.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt))):n.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.records[t.index].Writeoff))).toFixed(i),n.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.OverUnder=o(t,n.records[t.index].OverUnder),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder),n.get(t.recid).changes.Discount=o(t,t.value_original),n.records[t.index].Discount=e(n.get(t.recid).changes.Discount)):(n.get(t.recid).changes.OverUnder=o(t,Math.abs(n.get(t.recid).changes.OverUnder).toFixed(i)),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder))):(n.get(t.recid).changes.VA009_RecivedAmt=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].OverUnder+n.records[t.index].Writeoff)).toFixed(i),n.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.VA009_RecivedAmt=o(t,n.records[t.index].VA009_RecivedAmt),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt),n.get(t.recid).changes.Discount=o(t,t.value_original),n.records[t.index].Discount=e(n.get(t.recid).changes.Discount)):(n.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(n.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt))):VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder)>0?(n.get(t.recid).changes.OverUnder=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].VA009_RecivedAmt+VIS.Utility.Util.getValueOfDecimal(n.records[t.index].Writeoff))).toFixed(i),n.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.OverUnder=o(t,n.records[t.index].OverUnder),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder),n.get(t.recid).changes.Discount=o(t,t.value_original),n.records[t.index].Discount=e(n.get(t.recid).changes.Discount)):(n.get(t.recid).changes.OverUnder=o(t,Math.abs(n.get(t.recid).changes.OverUnder).toFixed(i)),n.records[t.index].OverUnder=e(n.get(t.recid).changes.OverUnder))):(n.get(t.recid).changes.VA009_RecivedAmt=(n.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+n.records[t.index].OverUnder+n.records[t.index].Writeoff)).toFixed(i),n.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),n.get(t.recid).changes.VA009_RecivedAmt=o(t,n.records[t.index].VA009_RecivedAmt),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt),n.get(t.recid).changes.Discount=o(t,t.value_original),n.records[t.index].Discount=e(n.get(t.recid).changes.Discount)):(n.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(n.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),n.records[t.index].VA009_RecivedAmt=e(n.get(t.recid).changes.VA009_RecivedAmt))),n.refreshCell(t.recid,"VA009_RecivedAmt"),n.refreshCell(t.recid,"OverUnder")))}n.refreshCell(t.recid,"OverUnder");n.refreshCell(t.recid,"Discount");n.refreshCell(t.recid,"Writeoff");n.refreshCell(t.recid,"ConvertedAmt");n.refreshCell(t.recid,"VA009_RecivedAmt")}t.column==10&&(n.records[t.index].CheckNumber=t.value_new);t.column==11&&(n.records[t.index].CheckDate=t.value_new!=""?t.value_new:t.value_previous!=""?t.value_previous:t.value_original);t.column==2&&(n.records[t.index].Description=t.value_new)},100)}});n.hideColumn("recid");n.hideColumn("TransactionType");n.hideColumn("C_BPartner_Location_ID","C_DocType_ID")}function dt(n){t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetPopUpData",type:"POST",datatype:"json",data:{InvPayids:a.toString(),bank_id:p,acctno:w,chkno:VIS.Utility.encodeText(_Cheque_no),OrderPayids:y.toString(),JournalPayids:SlctdJournalPaymentIds.toString()},success:function(t){n(t)},error:function(){v[0].style.visibility="hidden";VIS.ADialog.error("VA009_ErrorLoadingPayments")}})}function gt(t){var r,u,i;g=[];r=JSON.parse(t);vt=r;for(u in r)i={},i.recid=r[u].recid,i.C_Bpartner=r[u].C_Bpartner,i.C_BPartner_Location_ID=r[u].C_BPartner_Location_ID,i.C_DocType_ID=r[u].C_DocType_ID,i.C_Invoice_ID=r[u].C_Invoice_ID,i.C_BPartner_ID=r[u].C_BPartner_ID,i.C_InvoicePaySchedule_ID=r[u].C_InvoicePaySchedule_ID,i.CurrencyCode=r[u].CurrencyCode,i.DueAmt=r[u].DueAmt,i.VA009_RecivedAmt=r[u].DueAmt,i.OverUnder="0",i.Writeoff="0",i.Discount="0",i.ConvertedAmt=r[u].DueAmt,i.C_Currency_ID=r[u].C_Currency_ID,i.AD_Org_ID=r[u].AD_Org_ID,i.AD_Client_ID=r[u].AD_Client_ID,i.CheckDate=new Date,i.CheckNumber=null,i.ValidMonths=null,i.VA009_PaymentMode=r[u].VA009_PaymentMode,i.TransactionType=r[u].TransactionType,i.PaymwentBaseType=r[u].PaymwentBaseType,i.DocBaseType=r[u].DocBaseType,g.push(i);w2utils.encodeTags(g);n.add(g);v[0].style.visibility="hidden"}function ti(n){n=JSON.parse(n);b.find(".VA009-payment-wrap").remove();l.find(".VA009-right-data-main").remove();l.find(".VA009-accordion").remove();nt=1;a=[];y=[];SlctdJournalPaymentIds=[];d=[];rt=[];ut=[];et();st.prop("checked",!1);ot();at();v[0].style.visibility="hidden";VIS.ADialog.info("",null,n,null)}function tt(){i=null;fi=null;STAT_cmbBank=null;STAT_cmbBankAccount=null;STAT_txtStatementNo=null;STAT_ctrlLoadFile=null;STAT_ctrlLoadFileTxt=null;n.destroy()}var p,w,i,r,u;gu;_Cheque_no="";p=0;w=0;v[0].style.visibility="visible";fi=t("<div class='VA009-popform-content vis-formouterwrpdiv' style='min-height:385px !important'>");i="";i+="<div class='VA009-popfrm-wrap' style='height:auto;'><div class='VA009-popCheck-data input-group vis-input-wrap' > <div class='vis-control-wrap'><select id='VA009_POP_cmbOrg_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_Org")+"<\/label><\/div><\/div> <div class='VA009-popCheck-data input-group vis-input-wrap' > <div class='vis-control-wrap'><select id='VA009_POP_cmbDocType_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_DocType")+"<\/label><\/div><\/div> <div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbPaymthd_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_PayMthd")+"<\/label><\/div><\/div><div class='VA009-popCheck-data input-group vis-input-wrap' > <div class='vis-control-wrap'><select id='VA009_POP_cmbBank_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_Bank")+"<\/label><\/div><\/div> <div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbBankAccount_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_BankAccount")+"<\/label><\/div><\/div><div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbCurrencyType_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_CurrencyType")+"<\/label><\/div><\/div><div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_AccountDate_"+f.windowNo+"'><label>"+VIS.Msg.getMsg("AccountDate")+"<\/label> <\/div><\/div><div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_TransactionDate"+f.windowNo+"' ><label>"+VIS.Msg.getMsg("TransactionDate")+"<\/label><\/div><\/div><div class='VA009-grid-container'><div class='VA009-table-container' id='VA009_btnPopupRecGrid'><\/div><\/div>";fi.append(i);lt();r=new Date;u=r.getFullYear()+"-"+("0"+(r.getMonth()+1)).slice(-2)+"-"+("0"+r.getDate()).slice(-2);s.val(u);ht.val(u);yi=new VIS.ChildDialog;yi.setContent(fi);yi.setTitle(VIS.Msg.getMsg("VA009_LoadChequePaymentRec"));yi.setWidth("80%");yi.setEnableResize(!0);yi.setModal(!0);(a.toString()!=""||y.toString()!=""||SlctdJournalPaymentIds.toString()!="")&&ft("");$POP_cmbOrg.on("change",function(){VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())==0?$POP_cmbOrg.addClass("vis-ev-col-mandatory"):(vr($RPOP_cmbBank,VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())),$RPOP_cmbBank.val(0).prop("selected",!0),$RPOP_cmbBank.addClass("vis-ev-col-mandatory"),$RPOP_cmbBankAccount.empty(),$RPOP_cmbBankAccount.append("<option value='0'><\/option>"),$RPOP_cmbBankAccount.addClass("vis-ev-col-mandatory"),$POP_cmbOrg.removeClass("vis-ev-col-mandatory"));it.LoadTargetDocType($POP_targetDocType,ni)});$RPOP_cmbBank.on("change",function(){function n(n){if($RPOP_cmbBankAccount.append("<option value='0'><\/option>"),n!=null&&n.length>0)for(var t in n)$RPOP_cmbBankAccount.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_BankAccount_ID)+">"+VIS.Utility.encodeText(n[t].AccountNo)+"<\/option>")}$RPOP_cmbBankAccount.empty();ct=[];ai=[];dr=null;VIS.Utility.Util.getValueOfInt($RPOP_cmbBank.val())==0?($RPOP_cmbBank.addClass("vis-ev-col-mandatory"),$RPOP_cmbBankAccount.addClass("vis-ev-col-mandatory")):$RPOP_cmbBank.removeClass("vis-ev-col-mandatory");VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadBankAccount",{Bank_ID:$RPOP_cmbBank.val(),Orgs:$POP_cmbOrg.val()},n)});$RPOP_cmbBankAccount.on("change",function(){ai=[];ct=[];dr=null;VIS.Utility.Util.getValueOfInt($RPOP_cmbBankAccount.val())==0?$RPOP_cmbBankAccount.addClass("vis-ev-col-mandatory"):$RPOP_cmbBankAccount.removeClass("vis-ev-col-mandatory");t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetConvertedAmt",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(vt),BankAccount:$RPOP_cmbBankAccount.val(),CurrencyType:$pop_cmbCurrencyType.val(),dateAcct:s.val(),_org_Id:$POP_cmbOrg.val()<=0?0:$POP_cmbOrg.val()},success:function(n){c(n)},error:function(n){console.log(n);VIS.ADialog.error("VA009_ErrorLoadingPayments")}})});$pop_cmbCurrencyType.on("change",function(){t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetConvertedAmt",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(vt),BankAccount:$RPOP_cmbBankAccount.val(),CurrencyType:$pop_cmbCurrencyType.val(),dateAcct:s.val(),_org_Id:$POP_cmbOrg.val()<=0?0:$POP_cmbOrg.val()},success:function(n){c(n)},error:function(n){console.log(n);VIS.ADialog.error("VA009_ErrorLoadingPayments")}})});s.on("change",function(){if(s.val()==""?s.addClass("vis-ev-col-mandatory"):s.removeClass("vis-ev-col-mandatory"),VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())<=0)return VIS.ADialog.info("VA009_PlsSelectOrg"),!1;if(VIS.Utility.Util.getValueOfInt($POP_targetDocType.val())<=0)return VIS.ADialog.info("VA009_PlsSelectDocumentType"),!1;if(VIS.Utility.Util.getValueOfInt($RPOP_cmbBank.val())<=0)return VIS.ADialog.info("VA009_PLSelectBank"),!1;if(VIS.Utility.Util.getValueOfInt($RPOP_cmbBankAccount.val())<=0)return VIS.ADialog.info("VA009_PLSelectBankAccount"),!1;if(VIS.Utility.Util.getValueOfInt($POP_PayMthd.val())<=0)return VIS.ADialog.info("VA009_PLSelectPaymentMethod"),!1;if(s.val()=="")return VIS.ADialog.info("VA009_PLSelectAcctDate"),!1;var i=Date.parse(s.val()),n=new Date(parseInt(i));!isNaN(n.getTime())&&n.getTime()<0||t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetConvertedAmt",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(vt),BankAccount:$RPOP_cmbBankAccount.val(),CurrencyType:$pop_cmbCurrencyType.val(),dateAcct:s.val(),_org_Id:$POP_cmbOrg.val()<=0?0:$POP_cmbOrg.val()},success:function(n){c(n)},error:function(n){console.log(n);VIS.ADialog.error("VA009_ErrorLoadingPayments")}})});$POP_targetDocType.on("change",function(){VIS.Utility.Util.getValueOfInt($POP_targetDocType.val())==0?$POP_targetDocType.addClass("vis-ev-col-mandatory"):$POP_targetDocType.removeClass("vis-ev-col-mandatory")});yi.onOkClick=function(){var o=[],r,i,h,u,f;if(n.sort(["C_BPartner_ID","CheckNumber"],"asc"),n.selectAll(),n.getSelection().length>0)if(VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())>0)if(VIS.Utility.Util.getValueOfInt($POP_targetDocType.val())>0)if(VIS.Utility.Util.getValueOfInt($RPOP_cmbBank.val())>0)if(VIS.Utility.Util.getValueOfInt($RPOP_cmbBankAccount.val())>0)if(VIS.Utility.Util.getValueOfInt($POP_PayMthd.val())>0)if(s.val()!=""&&s.val()!=null)for(r=0;r<n.getSelection().length;r++){if(i={},h=0,i.C_BPartner_ID=n.get(n.getSelection()[r]).C_BPartner_ID,i.Description=n.get(n.getSelection()[r]).Description,i.C_Invoice_ID=n.get(n.getSelection()[r]).C_Invoice_ID,i.AD_Org_ID=VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val()),i.TargetDocType=VIS.Utility.Util.getValueOfInt($POP_targetDocType.val()),i.AD_Client_ID=n.get(n.getSelection()[r]).AD_Client_ID,i.C_Currency_ID=n.get(n.getSelection()[r]).C_Currency_ID,i.C_InvoicePaySchedule_ID=n.get(n.getSelection()[r]).C_InvoicePaySchedule_ID,i.TransactionType=n.get(n.getSelection()[r]).TransactionType,i.C_BPartner_Location_ID=n.get(n.getSelection()[r]).C_BPartner_Location_ID,i.C_DocType_ID=n.get(n.getSelection()[r]).C_DocType_ID,i.DocBaseType=n.get(n.getSelection()[r]).DocBaseType,n.get(n.getSelection()[r]).CheckDate!=""){if(u=new Date(n.get(n.getSelection()[r]).CheckDate),u=new Date(u.setHours(0,0,0,0)),f=new Date(s.val()),f=new Date(f.setHours(0,0,0,0)),u>f)return VIS.ADialog.info("VIS_CheckDateCantbeGreaterSys"),n.selectNone(),!1;i.CheckDate=n.get(n.getSelection()[r]).CheckDate}else return VIS.ADialog.info("VA009_PLCheckDate"),n.selectNone(),!1;if(i.DateTrx=VIS.Utility.Util.getValueOfDate(ht.val()),i.DateAcct=VIS.Utility.Util.getValueOfDate(s.val()),i.C_BankAccount_ID=VIS.Utility.Util.getValueOfInt($RPOP_cmbBankAccount.val()),i.C_Bank_ID=VIS.Utility.Util.getValueOfInt($RPOP_cmbBank.val()),i.DueAmt=n.get(n.getSelection()[r]).DueAmt,i.ConvertedAmt=n.get(n.getSelection()[r]).ConvertedAmt,i.PaymwentBaseType=n.get(n.getSelection()[r]).PaymwentBaseType,i.OverUnder=e(n.get(n.getSelection()[r]).OverUnder),i.Discount=e(n.get(n.getSelection()[r]).Discount),i.Writeoff=e(n.get(n.getSelection()[r]).Writeoff),i.From="Rec",n.get(n.getSelection()[r]).CheckNumber!=null&&n.get(n.getSelection()[r]).CheckNumber!="")i.CheckNumber=n.get(n.getSelection()[r]).CheckNumber;else return VIS.ADialog.info("VA009_PLCheckNumber"),n.selectNone(),!1;if(VIS.Utility.Util.getValueOfDecimal(e(n.get(n.getSelection()[r]).VA009_RecivedAmt))!=0)i.VA009_RecivedAmt=e(n.get(n.getSelection()[r]).VA009_RecivedAmt);else return VIS.ADialog.info("VA009_PLRecivedAmt"),n.selectNone(),!1;i.CurrencyType=$pop_cmbCurrencyType.val();i.VA009_PaymentMethod_ID=$POP_PayMthd.val();o.push(i)}else return VIS.ADialog.info("VA009_PLSelectAcctDate"),n.selectNone(),!1;else return VIS.ADialog.info("VA009_PLSelectPaymentMethod"),n.selectNone(),!1;else return VIS.ADialog.info("VA009_PLSelectBankAccount"),n.selectNone(),!1;else return VIS.ADialog.info("VA009_PLSelectBank"),n.selectNone(),!1;else return VIS.ADialog.info("VA009_PlsSelectDocumentType"),n.selectNone(),!1;else return VIS.ADialog.info("VA009_PlsSelectOrg"),n.selectNone(),!1;v[0].style.visibility="visible";t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GeneratePayments",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(o)},success:function(n){ti(n)},error:function(n){console.log(n);v[0].style.visibility="hidden";VIS.ADialog.error("VA009_ErrorLoadingPayments")}})};yi.onCancelCLick=function(){n.clear();tt()};yi.onClose=function(){n.clear();tt()}},Cash_Dialog:function(){function bt(){function n(n){if($pop_cmbCurrencyType.append("<option value='0'><\/option>"),n.length>0){for(var t in n)$pop_cmbCurrencyType.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>"),VIS.Utility.encodeText(n[t].IsDefault)=="Y"&&(ei=VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID));$pop_cmbCurrencyType.val(ei)}}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/loadCurrencyType",null,n)}function kt(){function n(n){if($POP_cmbOrg.append(" <option value = 0><\/option>"),n.length>0)for(var t in n)$POP_cmbOrg.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].AD_Org_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>");$POP_cmbOrg.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadOrganization",null,n)}function dt(){var r=!1,i;(y.length>0||SlctdJournalPaymentIds.length>0)&&a.length==0&&(r=!0);i=[];i.length==0&&(i.push({field:"C_Bpartner",caption:VIS.Msg.getMsg("VA009_BPartner"),sortable:!0,size:"15%"}),i.push({field:"Description",caption:VIS.Msg.getMsg("Description"),sortable:!0,size:"15%",editable:{type:"text"}}),i.push({field:"CurrencyCode",caption:VIS.Msg.getMsg("VA009_Currency"),sortable:!0,size:"8%"}),i.push({field:"DueAmt",caption:VIS.Msg.getMsg("VA009_DueAmt"),sortable:!0,size:"12%",style:"text-align: right",render:function(n){var t=n.DueAmt;return parseFloat(t).toLocaleString(window.navigator.language,{minimumFractionDigits:h,maximumFractionDigits:h})}}),i.push({field:"ConvertedAmt",caption:VIS.Msg.getMsg("VA009_ConvertedAmt"),sortable:!0,size:"13%",style:"text-align: right",render:function(n){var t=n.ConvertedAmt;return parseFloat(t).toLocaleString(window.navigator.language,{minimumFractionDigits:h,maximumFractionDigits:h})}}),i.push({field:"VA009_RecivedAmt",caption:VIS.Msg.getMsg("VA009_ReceivedAmt"),sortable:!0,size:"12%",style:"text-align: right",hidden:r,render:function(n){var t=n.VA009_RecivedAmt;return t=oi(event,t,t),parseFloat(t).toLocaleString(window.navigator.language,{minimumFractionDigits:h,maximumFractionDigits:h})},editable:{type:"number"}}),i.push({field:"OverUnder",caption:VIS.Msg.getMsg("VA009_OverUnder"),sortable:!0,size:"9%",style:"text-align: right",hidden:r,render:function(n){var t=n.OverUnder;return parseFloat(t).toLocaleString(window.navigator.language,{minimumFractionDigits:h,maximumFractionDigits:h})}}),i.push({field:"Writeoff",caption:VIS.Msg.getMsg("VA009_Writeoff"),sortable:!0,size:"9%",style:"text-align: right",hidden:r,render:function(n){var t=n.Writeoff;return t=oi(event,t,t),parseFloat(t).toLocaleString(window.navigator.language,{minimumFractionDigits:h,maximumFractionDigits:h})},editable:{type:"number"}}),i.push({field:"Discount",caption:VIS.Msg.getMsg("VA009_Discount"),sortable:!0,size:"9%",style:"text-align: right",hidden:r,render:function(n){var t=n.Discount;return t=oi(event,t,t),parseFloat(t).toLocaleString(window.navigator.language,{minimumFractionDigits:h,maximumFractionDigits:h})},editable:{type:"number"}}),i.push({field:"recid",caption:VIS.Msg.getMsg("VA009_srno"),sortable:!0,size:"1%"}),i.push({field:"C_BPartner_Location_ID",caption:VIS.Msg.getMsg("C_BPartner_Location_ID"),sortable:!0,size:"1%"}),i.push({field:"C_DocType_ID",caption:VIS.Msg.getMsg("C_DocType_ID"),sortable:!0,size:"1%"}),i.push({field:"DocBaseType",caption:VIS.Msg.getMsg("DocBaseType"),sortable:!0,size:"1%"}));u=null;u=ft.w2grid({name:"CashGrid",recordHeight:25,columns:i,method:"GET",multiSelect:!0,onEditField:function(i){(i.column==6||i.column==8||i.column==9)&&(u.get(i.recid).TransactionType=="Order"||u.get(i.recid).TransactionType=="GL Journal")&&(i.isCancelled=!0);u.records[i.index][u.columns[i.column].field]=oi(i,u.records[i.index][u.columns[i.column].field]);var r=n.GetFormatAmount(u.records[i.index][u.columns[i.column].field],"init",k);u.records[i.index][u.columns[i.column].field]=n.GetConvertedString(r,k);id=i.recid;(i.column==8||i.column==7||i.column==5)&&t("#grid_CashGrid_rec_"+id).keydown(function(n){if(k||n.keyCode!=190&&n.keyCode!=110){if(k&&n.keyCode==188)return!1}else return!1;return n.target.value.contains(".")&&(n.which==110||n.which==190||n.which==188)?n.target.value.indexOf(".")>-1&&(n.target.value=n.target.value.replace(".","")):n.target.value.contains(",")&&(n.which==110||n.which==190||n.which==188)&&n.target.value.indexOf(",")>-1&&(n.target.value=n.target.value.replace(",","")),n.keyCode!=8&&n.keyCode!=9&&(n.keyCode<37||n.keyCode>40)&&(n.keyCode<48||n.keyCode>57)&&(n.keyCode<96||n.keyCode>105)&&n.keyCode!=109&&n.keyCode!=189&&n.keyCode!=110&&n.keyCode!=144&&n.keyCode!=188&&n.keyCode!=190?!1:void 0})}});u.hideColumn("recid","C_BPartner_Location_ID","C_DocType_ID","DocBaseType")}function gt(){function t(n){if($Cash_cmbcashbk.empty(),$Cash_cmbcashbk.addClass("vis-ev-col-mandatory"),$Cash_cmbcashbk.append("<option value='0'><\/option>"),n!=null&&n.length>0)for(var t in n)$Cash_cmbcashbk.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_CashBook_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>");$Cash_cmbcashbk.prop("selectedIndex",0)}var n=$POP_cmbOrg.val();n!=null&&n!=""&&VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadCashBook",{Orgs:n},t)}function ti(){$Cash_cmbcashbk=$cash.find("#VA009_POP_Txtcashbk_"+f.windowNo);ft=$cash.find("#VA009_btnPopupGrid");$pop_cmbCurrencyType=$cash.find("#VA009_POP_cmbCurrencyType_"+f.windowNo);s=$cash.find("#VA009_AccountDate_"+f.windowNo);ht=$cash.find("#VA009_TransactionDate"+f.windowNo);$POP_cmbOrg=$cash.find("#VA009_POP_cmbOrg_"+f.windowNo);$POP_cmbOrg.addClass("vis-ev-col-mandatory");$POP_targetDocType=$cash.find("#VA009_POP_cmbDocType_"+f.windowNo);$POP_targetDocType.addClass("vis-ev-col-mandatory")}function ii(n){t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetPopUpData",type:"POST",datatype:"json",data:{InvPayids:a.toString(),bank_id:pt,acctno:wt,chkno:VIS.Utility.encodeText(yt),OrderPayids:y.toString()},success:function(t){n(t)},error:function(){v[0].style.visibility="hidden";VIS.ADialog.error("VA009_ErrorLoadingPayments")}})}function p(n){var t,r,i;u.clear();g=[];t=JSON.parse(n);vt=t;for(r in t)i={},i.recid=t[r].recid,i.C_Bpartner=t[r].C_Bpartner,i.C_BPartner_Location_ID=t[r].C_BPartner_Location_ID,i.C_DocType_ID=t[r].C_DocType_ID,i.C_Invoice_ID=t[r].C_Invoice_ID,i.C_InvoicePaySchedule_ID=t[r].C_InvoicePaySchedule_ID,i.CurrencyCode=t[r].CurrencyCode,i.DueAmt=t[r].DueAmt,i.C_BPartner_ID=t[r].C_BPartner_ID,i.C_Currency_ID=t[r].C_Currency_ID,i.AD_Org_ID=t[r].AD_Org_ID,i.AD_Client_ID=t[r].AD_Client_ID,i.VA009_PaymentMode=t[r].VA009_PaymentMode,i.ConvertedAmt=t[r].convertedAmt,i.PaymwentBaseType=t[r].PaymwentBaseType,i.OverUnder="0",i.Writeoff="0",i.Discount="0",i.VA009_RecivedAmt=t[r].convertedAmt,i.TransactionType=t[r].TransactionType,i.DocBaseType=t[r].DocBaseType,g.push(i);t[0].ERROR=="ConversionNotFound"?VIS.ADialog.info("VA009_ConversionNotFound"):t[0].ERROR=="VA009_DocTypeNotFound"&&VIS.ADialog.info("VA009_DocTypeNotFound");w2utils.encodeTags(g);u.add(g);v[0].style.visibility="hidden"}function ri(n){n=JSON.parse(n);b.find(".VA009-payment-wrap").remove();l.find(".VA009-right-data-main").remove();l.find(".VA009-accordion").remove();nt=1;a=[];y=[];SlctdJournalPaymentIds=[];d=[];rt=[];ut=[];et();st.prop("checked",!1);ot();at();v[0].style.visibility="hidden";VIS.ADialog.info("",null,n,null)}function lt(){_Cash=null;$cash=null;STAT_cmbBank=null;STAT_cmbBankAccount=null;STAT_txtStatementNo=null;STAT_ctrlLoadFile=null;STAT_ctrlLoadFileTxt=null;w2ui.CashGrid.destroy()}var ft,yt="",pt=0,wt=0,r=0,w,n,c,tt,i,ct;v[0].style.visibility="visible";n=null;lblAmount=t("<label>");r=new VIS.Controls.VAmountTextBox("VA009_POP_Txtopngbal_"+f.windowNo+"",!1,!0,!0,50,100,VIS.DisplayType.Amount,VIS.Msg.getMsg("Amount"));lblAmount.append(VIS.Msg.getMsg("VA009_lblopngbal"));r.setValue(0);n=VIS.DisplayType.GetNumberFormat(VIS.DisplayType.Amount);w=t("<div class='VA009-popform-data input-group vis-input-wrap'>");divAmountCtrlWrap=t("<div class='vis-control-wrap'>");w.append(divAmountCtrlWrap);divAmountCtrlWrap.append(r.getControl().attr("placeholder"," ").attr("data-placeholder","")).append(lblAmount);$cash=t("<div class='VA009-popform-content vis-formouterwrpdiv' style='min-height:385px !important'>");_Cash=t("<div class='VA009-popfrm-wrap' style='height:auto;'>");cashData=t("<div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbOrg_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_Org")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap' > <div class='vis-control-wrap'><select id='VA009_POP_cmbDocType_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_DocType")+"<\/label><\/div><\/div> <div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_Txtcashbk_"+f.windowNo+"'> <\/select><label>"+VIS.Msg.getMsg("VA009_lblcashbook")+"<\/label><\/div><\/div> ");cashDataa=t("<div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbCurrencyType_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_CurrencyType")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_AccountDate_"+f.windowNo+"' placeholder=' ' data-placeholder=''> <label>"+VIS.Msg.getMsg("AccountDate")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_TransactionDate"+f.windowNo+"' placeholder=' ' data-placeholder='' ><label>"+VIS.Msg.getMsg("TransactionDate")+"<\/label><\/div> <\/div><div class='VA009-table-container' id='VA009_btnPopupGrid'>  <\/div><\/div>");_Cash.append(cashData).append(w).append(cashDataa);$cash.append(_Cash);ti();c=new Date;tt=c.getFullYear()+"-"+("0"+(c.getMonth()+1)).slice(-2)+"-"+("0"+c.getDate()).slice(-2);s.val(tt);ht.val(tt);i=new VIS.ChildDialog;i.setContent($cash);si.hasClass("VA009-active-tab")?i.setTitle(VIS.Msg.getMsg("VA009_LoadCashReceipts")):i.setTitle(VIS.Msg.getMsg("VA009_LoadCashPayment"));i.setWidth("60%");i.setEnableResize(!0);i.setModal(!0);(a.toString()!=""||y.toString()!=""||SlctdJournalPaymentIds.toString()!="")&&(ct=null,ct==null?(i.show(),dt(),ii(p),bt(),kt(),it.LoadTargetDocType($POP_targetDocType,ni)):(v[0].style.visibility="hidden",VIS.ADialog.info("VA009_PleaseSelctonlyCash")));r.addVetoableChangeListener(this);$Cash_cmbcashbk.on("change",function(){function i(i){i!=null&&(r.setValue(i.CompletedBalance),n=i.C_Currency_ID,kf=n);window.setTimeout(function(){t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetCashJournalConvertedAmt",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(vt),CurrencyCashBook:n,CurrencyType:$pop_cmbCurrencyType.val(),dateAcct:s.val(),_org_Id:$POP_cmbOrg.val()<=0?0:$POP_cmbOrg.val()},success:function(n){p(n)},error:function(n){console.log(n);VIS.ADialog.error("VA009_ErrorLoadingPayments")}})},200)}r.setValue(0);VIS.Utility.Util.getValueOfInt($Cash_cmbcashbk.val())==0?$Cash_cmbcashbk.addClass("vis-ev-col-mandatory"):$Cash_cmbcashbk.removeClass("vis-ev-col-mandatory");VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/GetCashBookData",{CashBook:$Cash_cmbcashbk.val()},i);var n=0});$pop_cmbCurrencyType.on("change",function(){t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetCashJournalConvertedAmt",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(vt),CurrencyCashBook:kf,CurrencyType:$pop_cmbCurrencyType.val(),dateAcct:s.val(),_org_Id:$POP_cmbOrg.val()<=0?0:$POP_cmbOrg.val()},success:function(n){p(n)},error:function(n){console.log(n);VIS.ADialog.error("VA009_ErrorLoadingPayments")}})});s.on("change",function(){if(s.val()?s.removeClass("vis-ev-col-mandatory"):s.addClass("vis-ev-col-mandatory"),s.val()=="")return VIS.ADialog.info("VA009_PLSelectAcctDate"),!1;var i=Date.parse(s.val()),n=new Date(parseInt(i));!isNaN(n.getTime())&&n.getTime()<0||t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetCashJournalConvertedAmt",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(vt),CurrencyCashBook:kf,CurrencyType:$pop_cmbCurrencyType.val(),dateAcct:s.val(),_org_Id:$POP_cmbOrg.val()<=0?0:$POP_cmbOrg.val()},success:function(n){p(n)},error:function(n){console.log(n);VIS.ADialog.error("VA009_ErrorLoadingPayments")}})});$POP_cmbOrg.on("change",function(){VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())==0?($POP_cmbOrg.addClass("vis-ev-col-mandatory"),$Cash_cmbcashbk.empty()):($POP_cmbOrg.removeClass("vis-ev-col-mandatory"),gt());it.LoadTargetDocType($POP_targetDocType,ni)});$POP_targetDocType.on("change",function(){VIS.Utility.Util.getValueOfInt($POP_targetDocType.val())==0?$POP_targetDocType.addClass("vis-ev-col-mandatory"):$POP_targetDocType.removeClass("vis-ev-col-mandatory")});u.on("change",function(t){window.setTimeout(function(){if(w2ui.CashGrid.getChanges(t.recid)!=undefined){var i=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/GetCurrencyPrecision",{BankAccount_ID:$Cash_cmbcashbk.val(),CurrencyFrom:"C"},null);if((i==null||i==0)&&(i=2),t.column==1&&(u.records[t.index].Description=t.value_new),u.records[t.index].ConvertedAmt=parseFloat(e(u.records[t.index].ConvertedAmt)),u.records[t.index].VA009_RecivedAmt=parseFloat(e(u.records[t.index].VA009_RecivedAmt)),u.records[t.index].OverUnder=parseFloat(e(u.records[t.index].OverUnder)),u.records[t.index].Writeoff=parseFloat(e(u.records[t.index].Writeoff)),u.records[t.index].Discount=parseFloat(e(u.records[t.index].Discount)),t.column==5){if(t.value_new==""?t.value_new=0:(t.value_new=n.GetConvertedNumber(t.value_new,k),t.value_new=t.value_new.toLocaleString(window.navigator.language,{minimumFractionDigits:i,maximumFractionDigits:i}),t.value_new=n.GetConvertedNumber(t.value_new,k),t.value_original=n.GetConvertedNumber(t.value_original,k)),t.value_new>u.records[t.index].ConvertedAmt){VIS.ADialog.error("MoreScheduleAmount");t.value_new=t.value_original;u.get(t.recid).changes.VA009_RecivedAmt=o(t,t.value_new);u.records[t.index].VA009_RecivedAmt=e(u.get(t.recid).changes.VA009_RecivedAmt);u.refreshCell(t.recid,"VA009_RecivedAmt");return}if(u.get(t.recid).changes.VA009_RecivedAmt=o(t,t.value_new.toFixed(i)),u.records[t.index].VA009_RecivedAmt=e(u.get(t.recid).changes.VA009_RecivedAmt),u.refreshCell(t.recid,"VA009_RecivedAmt"),u.records[t.index].PaymwentBaseType=="ARR"||u.records[t.index].PaymwentBaseType=="APP")if(t.value_new>u.records[t.index].ConvertedAmt){if(u.records[t.index].ConvertedAmt>0){if(t.value_original.toFixed(i)==t.value_new.toFixed(i))return!1;u.get(t.recid).changes.OverUnder=(u.records[t.index].ConvertedAmt-t.value_new).toFixed(i);u.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),u.get(t.recid).changes.OverUnder=u.records[t.index].OverUnder):u.records[t.index].OverUnder=u.get(t.recid).changes.OverUnder;u.get(t.recid).changes.Writeoff=0}else{if(t.value_original.toFixed(i)==parseFloat(t.value_new).toFixed(i))return!1;u.get(t.recid).changes.OverUnder=(u.records[t.index].ConvertedAmt-t.value_new).toFixed(i);u.get(t.recid).changes.OverUnder=o(t,u.get(t.recid).changes.OverUnder);u.records[t.index].OverUnder=e(u.get(t.recid).changes.OverUnder);u.get(t.recid).changes.Writeoff=0;u.get(t.recid).Writeoff=0}u.get(t.recid).changes.Discount=0;u.refreshCell(t.recid,"OverUnder");u.refreshCell(t.recid,"Discount");u.refreshCell(t.recid,"Writeoff")}else if(t.value_new==u.records[t.index].ConvertedAmt)u.get(t.recid).changes.OverUnder=0,u.get(t.recid).OverUnder=0,u.get(t.recid).changes.Discount=0,u.get(t.recid).changes.Writeoff=0,u.get(t.recid).Discount=0,u.get(t.recid).Writeoff=0,u.get(t.recid).changes.VA009_RecivedAmt=o(t,parseFloat(t.value_new)),u.records[t.index].VA009_RecivedAmt=e(u.get(t.recid).changes.VA009_RecivedAmt),u.refreshCell(t.recid,"OverUnder"),u.refreshCell(t.recid,"Discount"),u.refreshCell(t.recid,"Writeoff"),u.refreshCell(t.recid,"VA009_RecivedAmt");else if(t.value_new<u.records[t.index].ConvertedAmt){if(u.records[t.index].ConvertedAmt>0){if(t.value_original.toFixed(i)==parseFloat(t.value_new).toFixed(i))return!1;u.get(t.recid).changes.OverUnder=(u.records[t.index].ConvertedAmt-t.value_new).toFixed(i);u.get(t.recid).changes.OverUnder=o(t,u.get(t.recid).changes.OverUnder);u.records[t.index].OverUnder=e(u.get(t.recid).changes.OverUnder);u.get(t.recid).changes.Writeoff=0;u.get(t.recid).Writeoff=0}else u.get(t.recid).changes.Writeoff=0,u.get(t.recid).Writeoff=0,u.get(t.recid).changes.OverUnder=(u.records[t.index].ConvertedAmt-t.value_new).toFixed(i),u.get(t.recid).changes.OverUnder=o(t,u.get(t.recid).changes.OverUnder),u.records[t.index].OverUnder=e(u.get(t.recid).changes.OverUnder);u.get(t.recid).changes.Discount=0;u.get(t.recid).Discount=0;u.refreshCell(t.recid,"OverUnder");u.refreshCell(t.recid,"Discount");u.refreshCell(t.recid,"Writeoff")}}if(t.column==7){if(t.value_new==""?t.value_new=0:(t.value_new=n.GetConvertedNumber(t.value_new,k),t.value_new=t.value_new.toLocaleString(window.navigator.language,{minimumFractionDigits:i,maximumFractionDigits:i}),t.value_new=n.GetConvertedNumber(t.value_new,k),t.value_original=n.GetConvertedNumber(t.value_original,k)),t.value_new>u.records[t.index].ConvertedAmt){VIS.ADialog.error("MoreScheduleAmount");t.value_new=t.value_original;u.get(t.recid).changes.Writeoff=o(t,t.value_new);u.records[t.index].Writeoff=e(u.get(t.recid).changes.Writeoff);u.refreshCell(t.recid,"Writeoff");return}u.get(t.recid).changes.Writeoff=o(t,t.value_new.toFixed(i));u.records[t.index].Writeoff=e(u.get(t.recid).changes.Writeoff);(u.records[t.index].PaymwentBaseType=="ARR"||u.records[t.index].PaymwentBaseType=="APP")&&(t.value_new>u.records[t.index].ConvertedAmt?(u.records[t.index].ConvertedAmt<0?u.get(t.recid).changes.Discount==undefined&&u.get(t.recid).changes.OverUnder==undefined?(w2ui.CashGrid.get(t.recid).changes.VA009_RecivedAmt=(-1*(-1*u.records[t.index].ConvertedAmt+(t.value_new+u.records[t.index].OverUnder+u.records[t.index].Discount))).toFixed(i),u.records[t.index].VA009_RecivedAmt=u.get(t.recid).changes.VA009_RecivedAmt):u.get(t.recid).changes.Discount==undefined?(w2ui.CashGrid.get(t.recid).changes.VA009_RecivedAmt=(-1*(-1*u.records[t.index].ConvertedAmt+(t.value_new+parseFloat(u.get(t.recid).OverUnder)+u.records[t.index].Discount))).toFixed(i),u.records[t.index].VA009_RecivedAmt=u.get(t.recid).changes.VA009_RecivedAmt):u.get(t.recid).changes.OverUnder==undefined?(w2ui.CashGrid.get(t.recid).changes.VA009_RecivedAmt=(-1*(-1*u.records[t.index].ConvertedAmt+(t.value_new+u.records[t.index].OverUnder+VIS.Utility.Util.getValueOfDecimal(u.get(t.recid).Discount)))).toFixed(i),u.records[t.index].VA009_RecivedAmt=u.get(t.recid).changes.VA009_RecivedAmt):(u.get(t.recid).changes.VA009_RecivedAmt=(-1*(-1*u.records[t.index].ConvertedAmt+(t.value_new+parseFloat(u.get(t.recid).OverUnder)+VIS.Utility.Util.getValueOfDecimal(u.get(t.recid).Discount)))).toFixed(i),u.records[t.index].VA009_RecivedAmt=u.get(t.recid).changes.VA009_RecivedAmt):(u.get(t.recid).changes.VA009_RecivedAmt=(t.value_new-u.records[t.index].ConvertedAmt).toFixed(i),u.records[t.index].VA009_RecivedAmt=u.get(t.recid).changes.VA009_RecivedAmt),u.refreshCell(t.recid,"VA009_RecivedAmt")):parseFloat(t.value_new)<=u.records[t.index].ConvertedAmt&&(u.get(t.recid).changes.Discount==undefined&&u.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(u.records[t.index].OverUnder)>0?(w2ui.CashGrid.get(t.recid).changes.OverUnder=(u.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+u.records[t.index].VA009_RecivedAmt+u.records[t.index].Discount)).toFixed(i),u.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),u.get(t.recid).changes.OverUnder=o(t,u.records[t.index].OverUnder),u.records[t.index].OverUnder=e(u.get(t.recid).changes.OverUnder),u.get(t.recid).changes.Writeoff=o(t,t.value_original),u.records[t.index].Writeoff=e(u.get(t.recid).changes.Writeoff)):(u.get(t.recid).changes.OverUnder=o(t,Math.abs(u.get(t.recid).changes.OverUnder).toFixed(i)),u.records[t.index].OverUnder=e(u.get(t.recid).changes.OverUnder))):(w2ui.CashGrid.get(t.recid).changes.VA009_RecivedAmt=(u.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+u.records[t.index].OverUnder+u.records[t.index].Discount)).toFixed(i),u.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),u.get(t.recid).changes.VA009_RecivedAmt=o(t,u.records[t.index].VA009_RecivedAmt),u.records[t.index].VA009_RecivedAmt=e(u.get(t.recid).changes.VA009_RecivedAmt),u.get(t.recid).changes.Writeoff=o(t,t.value_original),u.records[t.index].Writeoff=e(u.get(t.recid).changes.Writeoff)):(u.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(u.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),u.records[t.index].VA009_RecivedAmt=e(u.get(t.recid).changes.VA009_RecivedAmt))):u.get(t.recid).changes.Discount==undefined?VIS.Utility.Util.getValueOfDecimal(u.records[t.index].OverUnder)>0?(w2ui.CashGrid.get(t.recid).changes.OverUnder=(u.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+u.records[t.index].VA009_RecivedAmt+u.records[t.index].Discount)).toFixed(i),u.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),u.get(t.recid).changes.OverUnder=o(t,u.records[t.index].OverUnder),u.records[t.index].OverUnder=e(u.get(t.recid).changes.OverUnder),u.get(t.recid).changes.Writeoff=o(t,t.value_original),u.records[t.index].Writeoff=e(u.get(t.recid).changes.Writeoff)):(u.get(t.recid).changes.OverUnder=o(t,Math.abs(u.get(t.recid).changes.OverUnder).toFixed(i)),u.records[t.index].OverUnder=e(u.get(t.recid).changes.OverUnder))):(w2ui.CashGrid.get(t.recid).changes.VA009_RecivedAmt=(u.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+u.records[t.index].OverUnder+u.records[t.index].Discount)).toFixed(i),u.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),u.get(t.recid).changes.VA009_RecivedAmt=o(t,u.records[t.index].VA009_RecivedAmt),u.records[t.index].VA009_RecivedAmt=e(u.get(t.recid).changes.VA009_RecivedAmt),u.get(t.recid).changes.Writeoff=o(t,t.value_original),u.records[t.index].Writeoff=e(u.get(t.recid).changes.Writeoff)):(u.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(u.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),u.records[t.index].VA009_RecivedAmt=e(u.get(t.recid).changes.VA009_RecivedAmt))):u.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(u.records[t.index].OverUnder)>0?(w2ui.CashGrid.get(t.recid).changes.OverUnder=(u.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+u.records[t.index].VA009_RecivedAmt+u.records[t.index].Discount)).toFixed(i),u.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),u.get(t.recid).changes.OverUnder=o(t,u.records[t.index].OverUnder),u.records[t.index].OverUnder=e(u.get(t.recid).changes.OverUnder),u.get(t.recid).changes.Writeoff=o(t,t.value_original),u.records[t.index].Writeoff=e(u.get(t.recid).changes.Writeoff)):(u.get(t.recid).changes.OverUnder=o(t,Math.abs(u.get(t.recid).changes.OverUnder).toFixed(i)),u.records[t.index].OverUnder=e(u.get(t.recid).changes.OverUnder))):(w2ui.CashGrid.get(t.recid).changes.VA009_RecivedAmt=(u.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+u.records[t.index].OverUnder+u.records[t.index].Discount)).toFixed(i),u.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),u.get(t.recid).changes.VA009_RecivedAmt=o(t,u.records[t.index].VA009_RecivedAmt),u.records[t.index].VA009_RecivedAmt=e(u.get(t.recid).changes.VA009_RecivedAmt),u.get(t.recid).changes.Writeoff=o(t,t.value_original),u.records[t.index].Writeoff=e(u.get(t.recid).changes.Writeoff)):(u.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(u.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),u.records[t.index].VA009_RecivedAmt=e(u.get(t.recid).changes.VA009_RecivedAmt))):VIS.Utility.Util.getValueOfDecimal(u.records[t.index].OverUnder)>0?(w2ui.CashGrid.get(t.recid).changes.OverUnder=(u.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+u.records[t.index].VA009_RecivedAmt+u.records[t.index].Discount)).toFixed(i),u.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),u.get(t.recid).changes.OverUnder=o(t,u.records[t.index].OverUnder),u.records[t.index].OverUnder=e(u.get(t.recid).changes.OverUnder),u.get(t.recid).changes.Writeoff=o(t,t.value_original),u.records[t.index].Writeoff=e(u.get(t.recid).changes.Writeoff)):(u.get(t.recid).changes.OverUnder=o(t,Math.abs(u.get(t.recid).changes.OverUnder).toFixed(i)),u.records[t.index].OverUnder=e(u.get(t.recid).changes.OverUnder))):(u.get(t.recid).changes.VA009_RecivedAmt=(u.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+u.records[t.index].OverUnder+u.records[t.index].Discount)).toFixed(i),u.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),u.get(t.recid).changes.VA009_RecivedAmt=o(t,u.records[t.index].VA009_RecivedAmt),u.records[t.index].VA009_RecivedAmt=e(u.get(t.recid).changes.VA009_RecivedAmt),u.get(t.recid).changes.Writeoff=o(t,t.value_original),u.records[t.index].Writeoff=e(u.get(t.recid).changes.Writeoff)):(u.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(u.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),u.records[t.index].VA009_RecivedAmt=e(u.get(t.recid).changes.VA009_RecivedAmt))),u.refreshCell(t.recid,"VA009_RecivedAmt"),u.refreshCell(t.recid,"OverUnder")))}if(t.column==8){if(t.value_new==""?t.value_new=0:(t.value_new=n.GetConvertedNumber(t.value_new,k),t.value_new=t.value_new.toLocaleString(window.navigator.language,{minimumFractionDigits:i,maximumFractionDigits:i}),t.value_new=n.GetConvertedNumber(t.value_new,k),t.value_original=n.GetConvertedNumber(t.value_original,k)),u.get(t.recid).changes.Discount=o(t,t.value_new.toFixed(i)),u.records[t.index].Discount=e(u.get(t.recid).changes.Discount),t.value_new>u.records[t.index].ConvertedAmt){VIS.ADialog.error("MoreScheduleAmount");t.value_new=t.value_original;u.get(t.recid).changes.Discount=o(t,t.value_new);u.records[t.index].Discount=e(u.get(t.recid).changes.Discount);u.refreshCell(t.recid,"Discount");return}(u.records[t.index].PaymwentBaseType=="ARR"||u.records[t.index].PaymwentBaseType=="APP")&&(t.value_new>u.records[t.index].ConvertedAmt?(u.records[t.index].ConvertedAmt<0?u.get(t.recid).changes.Writeoff==undefined&&u.get(t.recid).changes.OverUnder==undefined?(w2ui.CashGrid.get(t.recid).changes.VA009_RecivedAmt=(-1*(-1*VIS.Utility.Util.getValueOfDecimal(u.get(t.recid).ConvertedAmt)+(t.value_new+u.records[t.index].OverUnder+u.records[t.index].Writeoff))).toFixed(i),u.records[t.index].VA009_RecivedAmt=u.get(t.recid).changes.VA009_RecivedAmt):u.get(t.recid).changes.Writeoff==undefined?(w2ui.CashGrid.get(t.recid).changes.VA009_RecivedAmt=(-1*(-1*VIS.Utility.Util.getValueOfDecimal(u.get(t.recid).ConvertedAmt)+(t.value_new+parseFloat(u.get(t.recid).OverUnder)+u.records[t.index].Writeoff))).toFixed(i),u.records[t.index].VA009_RecivedAmt=u.get(t.recid).changes.VA009_RecivedAmt):u.get(t.recid).changes.OverUnder==undefined?(w2ui.CashGrid.get(t.recid).changes.VA009_RecivedAmt=(-1*(-1*VIS.Utility.Util.getValueOfDecimal(u.get(t.recid).ConvertedAmt)+(t.value_new+u.records[t.index].OverUnder+VIS.Utility.Util.getValueOfDecimal(u.get(t.recid).Writeoff)))).toFixed(i),u.records[t.index].VA009_RecivedAmt=u.get(t.recid).changes.VA009_RecivedAmt):(u.get(t.recid).changes.VA009_RecivedAmt=(-1*(-1*VIS.Utility.Util.getValueOfDecimal(u.get(t.recid).ConvertedAmt)+(t.value_new+parseFloat(u.get(t.recid).OverUnder)+VIS.Utility.Util.getValueOfDecimal(u.get(t.recid).Writeoff)))).toFixed(i),u.records[t.index].VA009_RecivedAmt=u.get(t.recid).changes.VA009_RecivedAmt):(u.get(t.recid).changes.VA009_RecivedAmt=(t.value_new-VIS.Utility.Util.getValueOfDecimal(u.get(t.recid).ConvertedAmt)).toFixed(i),u.records[t.index].VA009_RecivedAmt=u.get(t.recid).changes.VA009_RecivedAmt),u.refreshCell(t.recid,"VA009_RecivedAmt")):parseFloat(t.value_new)<=u.records[t.index].ConvertedAmt&&(u.get(t.recid).changes.Writeoff==undefined&&u.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(u.records[t.index].OverUnder)>0?(w2ui.CashGrid.get(t.recid).changes.OverUnder=(u.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+u.records[t.index].VA009_RecivedAmt+u.records[t.index].Writeoff)).toFixed(i),u.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),u.get(t.recid).changes.OverUnder=o(t,u.records[t.index].OverUnder),u.records[t.index].OverUnder=e(u.get(t.recid).changes.OverUnder),u.get(t.recid).changes.Discount=o(t,t.value_original),u.records[t.index].Discount=e(u.get(t.recid).changes.Discount)):(u.get(t.recid).changes.OverUnder=o(t,Math.abs(u.get(t.recid).changes.OverUnder).toFixed(i)),u.records[t.index].OverUnder=e(u.get(t.recid).changes.OverUnder))):(w2ui.CashGrid.get(t.recid).changes.VA009_RecivedAmt=(VIS.Utility.Util.getValueOfDecimal(u.get(t.recid).ConvertedAmt)-(parseFloat(t.value_new)+u.records[t.index].OverUnder+u.records[t.index].Writeoff)).toFixed(i),u.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),u.get(t.recid).changes.VA009_RecivedAmt=o(t,u.records[t.index].VA009_RecivedAmt),u.records[t.index].VA009_RecivedAmt=e(u.get(t.recid).changes.VA009_RecivedAmt),u.get(t.recid).changes.Discount=o(t,t.value_original),u.records[t.index].Discount=e(u.get(t.recid).changes.Discount)):(u.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(u.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),u.records[t.index].VA009_RecivedAmt=e(u.get(t.recid).changes.VA009_RecivedAmt))):u.get(t.recid).changes.Writeoff==undefined?VIS.Utility.Util.getValueOfDecimal(u.records[t.index].OverUnder)>0?(w2ui.CashGrid.get(t.recid).changes.OverUnder=(u.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+u.records[t.index].VA009_RecivedAmt+u.records[t.index].Writeoff)).toFixed(i),u.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),u.get(t.recid).changes.OverUnder=o(t,u.records[t.index].OverUnder),u.records[t.index].OverUnder=e(u.get(t.recid).changes.OverUnder),u.get(t.recid).changes.Discount=o(t,t.value_original),u.records[t.index].Discount=e(u.get(t.recid).changes.Discount)):(u.get(t.recid).changes.OverUnder=o(t,Math.abs(u.get(t.recid).changes.OverUnder).toFixed(i)),u.records[t.index].OverUnder=e(u.get(t.recid).changes.OverUnder))):(w2ui.CashGrid.get(t.recid).changes.VA009_RecivedAmt=(VIS.Utility.Util.getValueOfDecimal(u.get(t.recid).ConvertedAmt)-(parseFloat(t.value_new)+u.records[t.index].OverUnder+u.records[t.index].Writeoff)).toFixed(i),u.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),u.get(t.recid).changes.VA009_RecivedAmt=o(t,u.records[t.index].VA009_RecivedAmt),u.records[t.index].VA009_RecivedAmt=e(u.get(t.recid).changes.VA009_RecivedAmt),u.get(t.recid).changes.Discount=o(t,t.value_original),u.records[t.index].Discount=e(u.get(t.recid).changes.Discount)):(u.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(u.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),u.records[t.index].VA009_RecivedAmt=e(u.get(t.recid).changes.VA009_RecivedAmt))):u.get(t.recid).changes.OverUnder==undefined?VIS.Utility.Util.getValueOfDecimal(u.records[t.index].OverUnder)>0?(w2ui.CashGrid.get(t.recid).changes.OverUnder=(u.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+u.records[t.index].VA009_RecivedAmt+u.records[t.index].Writeoff)).toFixed(i),u.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),u.get(t.recid).changes.OverUnder=o(t,u.records[t.index].OverUnder),u.records[t.index].OverUnder=e(u.get(t.recid).changes.OverUnder),u.get(t.recid).changes.Discount=o(t,t.value_original),u.records[t.index].Discount=e(u.get(t.recid).changes.Discount)):(u.get(t.recid).changes.OverUnder=o(t,Math.abs(u.get(t.recid).changes.OverUnder).toFixed(i)),u.records[t.index].OverUnder=e(u.get(t.recid).changes.OverUnder))):(w2ui.CashGrid.get(t.recid).changes.VA009_RecivedAmt=(VIS.Utility.Util.getValueOfDecimal(u.get(t.recid).ConvertedAmt)-(parseFloat(t.value_new)+u.records[t.index].OverUnder+u.records[t.index].Writeoff)).toFixed(i),u.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),u.get(t.recid).changes.VA009_RecivedAmt=o(t,u.records[t.index].VA009_RecivedAmt),u.records[t.index].VA009_RecivedAmt=e(u.get(t.recid).changes.VA009_RecivedAmt),u.get(t.recid).changes.Discount=o(t,t.value_original),u.records[t.index].Discount=e(u.get(t.recid).changes.Discount)):(u.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(u.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),u.records[t.index].VA009_RecivedAmt=e(u.get(t.recid).changes.VA009_RecivedAmt))):VIS.Utility.Util.getValueOfDecimal(u.records[t.index].OverUnder)>0?(w2ui.CashGrid.get(t.recid).changes.OverUnder=(u.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+u.records[t.index].VA009_RecivedAmt+u.records[t.index].Writeoff)).toFixed(i),u.get(t.recid).changes.OverUnder<0?(VIS.ADialog.error("MoreScheduleAmount"),u.get(t.recid).changes.OverUnder=o(t,u.records[t.index].OverUnder),u.records[t.index].OverUnder=e(u.get(t.recid).changes.OverUnder),u.get(t.recid).changes.Discount=o(t,t.value_original),u.records[t.index].Discount=e(u.get(t.recid).changes.Discount)):(u.get(t.recid).changes.OverUnder=o(t,Math.abs(u.get(t.recid).changes.OverUnder).toFixed(i)),u.records[t.index].OverUnder=e(u.get(t.recid).changes.OverUnder))):(u.get(t.recid).changes.VA009_RecivedAmt=(u.records[t.index].ConvertedAmt-(parseFloat(t.value_new)+u.records[t.index].OverUnder+u.records[t.index].Writeoff)).toFixed(i),u.get(t.recid).changes.VA009_RecivedAmt<0?(VIS.ADialog.error("MoreScheduleAmount"),u.get(t.recid).changes.VA009_RecivedAmt=o(t,u.records[t.index].VA009_RecivedAmt),u.records[t.index].VA009_RecivedAmt=e(u.get(t.recid).changes.VA009_RecivedAmt),u.get(t.recid).changes.Discount=o(t,t.value_original),u.records[t.index].Discount=e(u.get(t.recid).changes.Discount)):(u.get(t.recid).changes.VA009_RecivedAmt=o(t,Math.abs(u.get(t.recid).changes.VA009_RecivedAmt).toFixed(i)),u.records[t.index].VA009_RecivedAmt=e(u.get(t.recid).changes.VA009_RecivedAmt))),u.refreshCell(t.recid,"VA009_RecivedAmt"),u.refreshCell(t.recid,"OverUnder")))}u.refreshCell(t.recid,"ConvertedAmt");u.refreshCell(t.recid,"VA009_RecivedAmt");u.refreshCell(t.recid,"OverUnder");u.refreshCell(t.recid,"Writeoff");u.refreshCell(t.recid,"Discount")}},100)});i.onOkClick=function(){var f=[],i,n;if(u.selectAll(),VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())>0)if(VIS.Utility.Util.getValueOfInt($POP_targetDocType.val())>0)if(VIS.Utility.Util.getValueOfInt($Cash_cmbcashbk.val())>0)if(s.val()!=""&&s.val()!=null)if(ht.val()!=""&&ht.val()!=null){if(u.getSelection().length>0)for(i=0;i<u.getSelection().length;i++){if(n={},n.C_BPartner_ID=u.get(u.getSelection()[i]).C_BPartner_ID,n.Description=u.get(u.getSelection()[i]).Description,n.C_Invoice_ID=u.get(u.getSelection()[i]).C_Invoice_ID,n.AD_Org_ID=VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val()),n.AD_Client_ID=u.get(u.getSelection()[i]).AD_Client_ID,n.C_Currency_ID=u.get(u.getSelection()[i]).C_Currency_ID,n.C_Currency_ID=u.get(u.getSelection()[i]).C_Currency_ID,n.C_InvoicePaySchedule_ID=u.get(u.getSelection()[i]).C_InvoicePaySchedule_ID,n.C_BPartner_Location_ID=u.get(u.getSelection()[i]).C_BPartner_Location_ID,n.C_DocType_ID=u.get(u.getSelection()[i]).C_DocType_ID,n.DocBaseType=u.get(u.getSelection()[i]).DocBaseType,u.get(u.getSelection()[i]).VA009_RecivedAmt!=null&&VIS.Utility.Util.getValueOfDecimal(e(u.get(u.getSelection()[i]).VA009_RecivedAmt))>0)n.VA009_RecivedAmt=e(u.get(u.getSelection()[i]).VA009_RecivedAmt);else return VIS.ADialog.info("VA009_PLRecivedAmt"),u.selectNone(),!1;n.OverUnder=e(u.get(u.getSelection()[i]).OverUnder);n.Writeoff=e(u.get(u.getSelection()[i]).Writeoff);n.Discount=e(u.get(u.getSelection()[i]).Discount);n.ConvertedAmt=u.get(u.getSelection()[i]).ConvertedAmt;n.PaymwentBaseType=u.get(u.getSelection()[i]).PaymwentBaseType;n.CurrencyType=$pop_cmbCurrencyType.val();n.DateAcct=VIS.Utility.Util.getValueOfDate(s.val());n.DateTrx=VIS.Utility.Util.getValueOfDate(ht.val());n.TargetDocType=VIS.Utility.Util.getValueOfInt($POP_targetDocType.val());n.TransactionType=u.get(u.getSelection()[i]).TransactionType;f.push(n)}v[0].style.visibility="visible";t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GenPaymentsCash",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(f),C_CashBook_ID:parseInt($Cash_cmbcashbk.val()),BeginningBalance:r.getValue()},success:function(n){ri(n)},error:function(n){console.log(n);v[0].style.visibility="hidden";VIS.ADialog.error("VA009_ErrorLoadingPayments")}})}else return VIS.ADialog.info("VA009_PLSelectConversionDate"),u.selectNone(),!1;else return VIS.ADialog.info("VA009_PLSelectAcctDate"),u.selectNone(),!1;else return VIS.ADialog.info("VA009_PLSelectCashbook"),u.selectNone(),!1;else return VIS.ADialog.info("VA009_PlsSelectDocumentType"),u.selectNone(),!1;else return VIS.ADialog.info("VA009_PlsSelectOrg"),u.selectNone(),!1};i.onCancelCLick=function(){w2ui.CashGrid.clear();lt()};i.onClose=function(){w2ui.CashGrid.clear();lt()};this.vetoablechange=function(n){console.log(n.propertyName);n.propertyName=="VA009_POP_Txtopngbal_"+f.windowNo+""&&r.setValue(n.newValue)}},Batch_OpenDialog:function(){function u(){i=null;$opnbatch=null}var i,n,r;$opnbatch=t("<div class='VA009-popform-content' style='min-height:25px !important'>");i="";i+="<div> <div class='VA009-popfrmradiowrp'><input type='radio' name='VA009_Sel"+f.windowNo+"'  value='S' checked><label>"+VIS.Msg.getMsg("VA009_BasedOnSelection")+"<\/label><\/div><div class='VA009-popfrmradiowrp'><input type='radio' name='VA009_Sel"+f.windowNo+"'  value='R'><label>"+VIS.Msg.getMsg("VA009_BasedOnRule")+"<\/label><\/div>";$opnbatch.append(i);n=new VIS.ChildDialog;r="";n.setContent($opnbatch);n.setTitle(VIS.Msg.getMsg("VA009_LoadBatchPayment"));n.setWidth("30%");n.setEnableResize(!0);n.setModal(!0);n.show();n.onOkClick=function(){r=$opnbatch.find("input[name='VA009_Sel"+f.windowNo+"']:checked").val();v[0].style.visibility="visible";r=="S"?a.toString()!=""||y.toString()!=""||SlctdJournalPaymentIds.toString()!=""?it.Batch_Dialog():VIS.ADialog.info("VA009_PlzSelct1Pay"):r=="R"&&ho();v[0].style.visibility="hidden"};n.onCancelCLick=function(){u()};n.onClose=function(){u()}},Batch_Dialog:function(){function yt(){var n=[];n.length==0&&(n.push({field:"recid",caption:VIS.Msg.getMsg("VA009_srno"),sortable:!0,size:"10%"}),n.push({field:"C_Bpartner",caption:VIS.Msg.getMsg("VA009_BPartner"),sortable:!0,size:"10%"}),n.push({field:"C_InvoicePaySchedule_ID",caption:VIS.Msg.getMsg("VA009_Schedule"),sortable:!0,size:"10%",render:function(n){var t=w,r=n.C_InvoicePaySchedule_ID,i;return t&&(i=t.getDisplay(r)),i}}),n.push({field:"CurrencyCode",caption:VIS.Msg.getMsg("VA009_Currency"),sortable:!0,size:"10%"}),n.push({field:"DueAmt",caption:VIS.Msg.getMsg("VA009_DueAmt"),sortable:!0,size:"10%",style:"text-align: right",render:function(n){var t=n.DueAmt;return parseFloat(t).toLocaleString(window.navigator.language,{minimumFractionDigits:h})}}),n.push({field:"ConvertedAmt",caption:VIS.Msg.getMsg("VA009_ConvertedAmt"),sortable:!0,size:"13%",style:"text-align: right",render:function(n){var t=n.ConvertedAmt;return parseFloat(t).toLocaleString(window.navigator.language,{minimumFractionDigits:h})}}),n.push({field:"CheckNumber",caption:VIS.Msg.getMsg("VA009_ChkNo"),sortable:!0,size:"10%",editable:{type:"alphanumeric",autoFormat:!0,groupSymbol:" "}}),n.push({field:"CheckDate",caption:VIS.Msg.getMsg("VA009_CheckDate"),sortable:!0,size:"10%",render:function(n){var t;return t=n.changes==undefined||n.changes.CheckDate==""?n.CheckDate:n.changes.CheckDate,new Date(t).toLocaleDateString()},style:"text-align: left",editable:{type:"date"}}),n.push({field:"Mandate",caption:VIS.Msg.getMsg("VA009_Mandate"),sortable:!0,size:"10%",editable:{type:"text"}}),n.push({field:"TransactionType",caption:VIS.Msg.getMsg("VA009_TransactionType"),sortable:!0,size:"1%"}),n.push({field:"ConversionTypeId",caption:VIS.Msg.getMsg("VA009_ConversionType"),hidden:!0,sortable:!0,size:"0%"}),n.push({field:"DiscountAmount",caption:VIS.Msg.getMsg("DiscountAmount"),hidden:!0,sortable:!0,size:"0%"}),n.push({field:"ConvertedDiscountAmount",caption:VIS.Msg.getMsg("ConvertedDiscountAmount"),hidden:!0,sortable:!0,size:"0%"}),n.push({field:"DiscountDate",caption:VIS.Msg.getMsg("DiscountDate"),hidden:!0,sortable:!0,size:"0%"}),n.push({field:"C_BPartner_Location_ID",caption:VIS.Msg.getMsg("C_BPartner_Location_ID"),hidden:!0,sortable:!0,size:"0%"}),n.push({field:"C_DocType_ID",caption:VIS.Msg.getMsg("C_DocType_ID"),hidden:!0,sortable:!0,size:"0%"}),n.push({field:"DocBaseType",caption:VIS.Msg.getMsg("DocBaseType"),hidden:!0,sortable:!0,size:"0%"}),n.push({field:"PaymwentBaseType",caption:VIS.Msg.getMsg("PaymwentBaseType"),hidden:!0,sortable:!0,size:"0%"}));c=null;c=k.w2grid({name:"BatchGrid",recordHeight:25,multiSelect:!0,columns:n});c.hideColumn("recid","CheckNumber","CheckDate","ValidMonths","Mandate","TransactionType","ConversionTypeId","DiscountAmount","ConvertedDiscountAmount","DiscountDate")}function pt(){$POP_cmbBank=$batch.find("#VA009_POP_cmbBank_"+f.windowNo);$POP_cmbBankAccount=$batch.find("#VA009_POP_cmbBankAccount_"+f.windowNo);$POP_cmbCurrency=$batch.find("#VA009_POP_cmbCurrency_"+f.windowNo);$POP_PayMthd=$batch.find("#VA009_POP_cmbPaymthd_"+f.windowNo);k=$batch.find("#VA009_btnPopupGrid");$consolidate=$batch.find("#VA009_Consolidate_"+f.windowNo);$overwritepay=$batch.find("#VA009_OverwritePayMthd_"+f.windowNo);$pop_cmbCurrencyType=$batch.find("#VA009_POP_cmbCurrencyType_"+f.windowNo);$POP_cmbOrg=$batch.find("#VA009_POP_cmbOrg_"+f.windowNo);$POP_cmbOrg.addClass("vis-ev-col-mandatory");$successNoteofbatch=tu.find("#VA009_Note_"+f.windowNo);$POP_BtnChkDetails=$batch.find("#VA009_btnCheckDetails_"+f.windowNo);or.hasClass("VA009-active-tab")&&t("option:selected",$POP_PayMthd).attr("PaymentBaseType")=="S"?$POP_BtnChkDetails.show():$POP_BtnChkDetails.hide();$POP_targetDocType=$batch.find("#VA009_POP_TargetType_"+f.windowNo);$POP_targetDocType.addClass("vis-ev-col-mandatory");$consolidate.prop("checked",!0);$overwritepay.prop("checked",!0);s=$batch.find("#VA009_AccountDate_"+f.windowNo)}function wt(n){t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetPopUpData",type:"POST",datatype:"json",data:{InvPayids:a.toString(),bank_id:ct,acctno:lt,chkno:VIS.Utility.encodeText(ht),OrderPayids:y.toString(),JournalPayids:SlctdJournalPaymentIds.toString()},success:function(t){n(t)},error:function(){VIS.ADialog.error("VA009_ErrorLoadingPayments")}})}function bt(n){var t,f,i;g=[];t=JSON.parse(n);r=0;u=0;vt=t;for(f in t)i={},t[f].DocBaseType=="API"?u+=t[f].convertedAmt:t[f].DocBaseType=="APC"&&(r+=t[f].convertedAmt),i.recid=t[f].recid,i.C_Bpartner=t[f].C_Bpartner,i.C_BPartner_Location_ID=t[f].C_BPartner_Location_ID,i.C_DocType_ID=t[f].C_DocType_ID,i.C_Invoice_ID=t[f].C_Invoice_ID,i.C_InvoicePaySchedule_ID=t[f].C_InvoicePaySchedule_ID,i.CurrencyCode=t[f].CurrencyCode,i.DueAmt=t[f].DueAmt,i.ConvertedAmt=t[f].convertedAmt,i.C_BPartner_ID=t[f].C_BPartner_ID,i.C_Currency_ID=t[f].C_Currency_ID,i.AD_Org_ID=t[f].AD_Org_ID,i.AD_Client_ID=t[f].AD_Client_ID,i.CheckDate=new Date,i.PrintCheckDate=Globalize.format(new Date,"yyyy-MM-dd"),i.CheckNumber=null,i.ValidMonths=null,i.VA009_PaymentMethod_ID=t[f].VA009_PaymentMethod_ID,i.TransactionType=t[f].TransactionType,i.PaymwentBaseType=t[f].PaymwentBaseType,i.ConversionTypeId=t[f].ConversionTypeId,i.DiscountAmount=t[f].DiscountAmount,i.ConvertedDiscountAmount=t[f].ConvertedDiscountAmount,i.DiscountDate=t[f].DiscountDate,i.TotalAPC=t[f].TotalAPC,i.TotalAPI=t[f].TotalAPI,i.DocBaseType=t[f].DocBaseType,i.IsAPCGreater=t[f].IsAPCGreater,i.IsAPCExists=t[f].IsAPCExists,i.PrintConvertedAmt=t[f].convertedAmt,g.push(i);w2utils.encodeTags(g);c.add(g)}function kt(){function n(n){if($pop_cmbCurrencyType.append("<option value='0'><\/option>"),n.length>0){for(var t in n)$pop_cmbCurrencyType.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>"),VIS.Utility.encodeText(n[t].IsDefault)=="Y"&&(ei=VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID));$pop_cmbCurrencyType.val(ei)}}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/loadCurrencyType",null,n)}function dt(){function n(n){if($POP_cmbOrg.append(" <option value = 0><\/option>"),n.length>0)for(var t in n)$POP_cmbOrg.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].AD_Org_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>");$POP_cmbOrg.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadOrganization",null,n)}function gt(){function n(n){if($POP_cmbCurrency.append("<option value='0'><\/option>"),n.length>0){for(var t in n)$POP_cmbCurrency.append("<option precision="+VIS.Utility.Util.getValueOfInt(n[t].Precision)+" value="+VIS.Utility.Util.getValueOfInt(n[t].C_Currency_ID)+">"+VIS.Utility.encodeText(n[t].ISO_Code)+"<\/option>");$POP_cmbCurrency.prop("selectedIndex",0)}}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/loadCurrencies",null,n)}function p(n){var t,f,i;c.clear();g=[];r=0;u=0;t=JSON.parse(n);vt=t;for(f in t)i={},t[f].DocBaseType=="API"?u+=t[f].convertedAmt:t[f].DocBaseType=="APC"&&(r+=t[f].convertedAmt),i.recid=t[f].recid,i.C_Bpartner=t[f].C_Bpartner,i.C_BPartner_Location_ID=t[f].C_BPartner_Location_ID,i.C_DocType_ID=t[f].C_DocType_ID,i.C_Invoice_ID=t[f].C_Invoice_ID,i.C_InvoicePaySchedule_ID=t[f].C_InvoicePaySchedule_ID,i.CurrencyCode=t[f].CurrencyCode,i.DueAmt=t[f].DueAmt,i.ConvertedAmt=t[f].convertedAmt,i.C_BPartner_ID=t[f].C_BPartner_ID,i.C_Currency_ID=t[f].C_Currency_ID,i.AD_Org_ID=t[f].AD_Org_ID,i.AD_Client_ID=t[f].AD_Client_ID,i.CheckDate=new Date,i.PrintCheckDate=Globalize.format(new Date,"yyyy-MM-dd"),i.CheckNumber=null,i.ValidMonths=null,i.VA009_PaymentMethod_ID=t[f].VA009_PaymentMethod_ID,i.TransactionType=t[f].TransactionType,i.PaymwentBaseType=t[f].PaymwentBaseType,i.ConversionTypeId=t[f].ConversionTypeId,i.DiscountAmount=t[f].DiscountAmount,i.ConvertedDiscountAmount=t[f].ConvertedDiscountAmount,i.DiscountDate=t[f].DiscountDate,i.TotalAPC=t[f].TotalAPC,i.TotalAPI=t[f].TotalAPI,i.DocBaseType=t[f].DocBaseType,i.IsAPCGreater=t[f].IsAPCGreater,i.IsAPCExists=t[f].IsAPCExists,i.PrintConvertedAmt=t[f].convertedAmt,g.push(i);t[0].ERROR=="ConversionNotFound"&&VIS.ADialog.info("VA009_ConversionNotFound");w2utils.encodeTags(g);c.add(g)}function ti(){function n(n){if($POP_PayMthd.append(" <option value = 0><\/option>"),n.length>0)for(var t in n)$POP_PayMthd.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].VA009_PaymentMethod_ID)+" PaymentBaseType="+n[t].VA009_PaymentBaseType+">"+VIS.Utility.encodeText(n[t].VA009_Name)+"<\/option>");$POP_PayMthd.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadBatchPaymentMethod",null,n)}function ii(n){n=JSON.parse(n);n=n.split(",");DocNumber="";ku=parseInt(n[1]);b.find(".VA009-payment-wrap").remove();l.find(".VA009-right-data-main").remove();l.find(".VA009-accordion").remove();nt=1;a=[];y=[];SlctdJournalPaymentIds=[];d=[];rt=[];ut=[];et();st.prop("checked",!1);ot();at();v[0].style.visibility="hidden";DocNumber!=""?w2confirm(VIS.Msg.getMsg("VA009_GenPaymentFile")).yes(function(){st.prop("checked",!1);b.find(":checkbox").prop("checked",!1);de(DocNumber,!0)}).no(function(){v[0].style.visibility="hidden";VIS.ADialog.info("",null,n[0],"")}):n!=null&&(tr=new VIS.ChildDialog,$successNoteofbatch.text(n[0]),$successNoteofbatch.css("visibility","visible"),tr.setContent(tu),tr.setTitle(VIS.Msg.getMsg("VA009_LoadBatchPayment")),tr.setWidth("36%"),tr.show(),tr.hidebuttons())}function ft(){e=null;$batch=null;STAT_cmbBank=null;STAT_cmbBankAccount=null;STAT_txtStatementNo=null;STAT_ctrlLoadFile=null;STAT_ctrlLoadFileTxt=null;w2ui.BatchGrid.destroy()}var w=null,k,ht="",n=2,ct=0,lt=0,r=0,u=0,e,i,o,tt;$batch=t("<div class='VA009-popform-content vis-formouterwrpdiv' style='min-height:395px !important'>");e="";e+="<div class='VA009-popfrm-wrap' style='height:auto;'><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbOrg_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_Org")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_TargetType_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_DocType")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbBank_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_Bank")+"<\/label><\/div><\/div> <div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbBankAccount_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_BankAccount")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbCurrency_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_Currency")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbCurrencyType_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_CurrencyType")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbPaymthd_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_PayMthd")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_AccountDate_"+f.windowNo+"' placeholder=' ' data-placeholder=''> <label>"+VIS.Msg.getMsg("AccountDate")+"<\/label><\/div><\/div><div class='VA009-popform-data'><div class='VA009-popFormInn'><label class='vis-ec-col-lblchkbox'><input type='checkbox' disabled id='VA009_OverwritePayMthd_"+f.windowNo+"'>&nbsp;"+VIS.Msg.getMsg("VA009_OverwritePayMthd")+"<\/label><label class='vis-ec-col-lblchkbox'><input type='checkbox' id='VA009_Consolidate_"+f.windowNo+"'>&nbsp;"+VIS.Msg.getMsg("VA009_Consolidate")+"<\/label> <\/div><\/div><div class='VA009-popform-data'><div class='VA009-popFormInn'> <a class='btn VA009-blueBtn VA009-batchCheckDetail' id='VA009_btnCheckDetails_"+f.windowNo+"'> "+VIS.Msg.getMsg("VA009_CheckDetails")+"<\/a > <\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap' style='display:none !important'><div class='vis-control-wrap'><select style='display:none !important' id='VA009_POP_cmbCurrencyType_"+f.windowNo+"'><\/select><label style='display:none !important'>"+VIS.Msg.getMsg("VA009_CurrencyType")+"<\/label><\/div><\/div><div class='VA009-table-container' style='height:300px;' id='VA009_btnPopupGrid'> <\/div><\/div>";tu=t("<div><label class='VA009-FontStyle mb-3' id='VA009_Note_"+f.windowNo+"'><\/label><\/div>");$resltbtns=t("<div class='VA009-ButtonDivStyle'><div class='d-flex align-items-center justify-content-end'><button class='ui-button mr-3' id='VA009_ViewBatch_"+f.windowNo+"'>"+VIS.Msg.getMsg("VA009_ViewBatch")+"<\/button><button class= 'ui-button' id ='VA009_Cancel_"+f.windowNo+"'>"+VIS.Msg.getMsg("Cancel")+"<\/button ><\/div ><\/div>");$batch.append(e);i=new VIS.ChildDialog;i.setContent($batch);i.setTitle(VIS.Msg.getMsg("VA009_LoadBatchPayment"));i.setWidth("60%");i.setEnableResize(!0);i.setModal(!0);i.show();pt();yt();tu.append($resltbtns);gf=tu.find("#VA009_ViewBatch_"+f.windowNo);ne=tu.find("#VA009_Cancel_"+f.windowNo);wt(bt);dt();it.LoadTargetDocType($POP_targetDocType,ni);vr($POP_cmbBank,VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val()));o=new Date;tt=o.getFullYear()+"-"+("0"+(o.getMonth()+1)).slice(-2)+"-"+("0"+o.getDate()).slice(-2);s.val(tt);$POP_cmbBank.addClass("vis-ev-col-mandatory");$POP_cmbBankAccount.addClass("vis-ev-col-mandatory");$POP_PayMthd.addClass("vis-ev-col-mandatory");ti();$POP_cmbCurrency.addClass("vis-ev-col-mandatory");gt();kt();w=VIS.MLookupFactory.get(VIS.Env.getCtx(),f.windowNo,0,VIS.DisplayType.TableDir,"C_InvoicePaySchedule_ID",0,!1,"C_InvoicePaySchedule.IsActive='Y' ");$POP_cmbOrg.on("change",function(){VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())==0?$POP_cmbOrg.addClass("vis-ev-col-mandatory"):(vr($POP_cmbBank,VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())),$POP_cmbBank.val(0).prop("selected",!0),$POP_cmbBank.addClass("vis-ev-col-mandatory"),$POP_cmbBankAccount.empty(),$POP_cmbBankAccount.append("<option value='0'><\/option>"),$POP_cmbBankAccount.addClass("vis-ev-col-mandatory"),$POP_cmbOrg.removeClass("vis-ev-col-mandatory"));it.LoadTargetDocType($POP_targetDocType,ni)});$POP_targetDocType.on("change",function(){VIS.Utility.Util.getValueOfInt($POP_targetDocType.val())==0?$POP_targetDocType.addClass("vis-ev-col-mandatory"):$POP_targetDocType.removeClass("vis-ev-col-mandatory")});$POP_cmbBank.on("change",function(){function n(n){if($POP_cmbBankAccount.append("<option value='0'><\/option>"),n!=null&&n.length>0)for(var t in n)$POP_cmbBankAccount.append("<option precision="+VIS.Utility.Util.getValueOfInt(n[t].Precision)+" value="+VIS.Utility.Util.getValueOfInt(n[t].C_BankAccount_ID)+">"+VIS.Utility.encodeText(n[t].AccountNo)+"<\/option>")}VIS.Utility.Util.getValueOfInt($POP_cmbBank.val())>0?$POP_cmbBank.removeClass("vis-ev-col-mandatory"):$POP_cmbBank.addClass("vis-ev-col-mandatory");$POP_cmbBankAccount.empty();$POP_cmbBankAccount.addClass("vis-ev-col-mandatory");VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadBankAccount",{Bank_ID:$POP_cmbBank.val(),Orgs:$POP_cmbOrg.val()},n)});$POP_cmbBankAccount.on("change",function(){VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val())==0?$POP_cmbBankAccount.addClass("vis-ev-col-mandatory"):$POP_cmbBankAccount.removeClass("vis-ev-col-mandatory");n=t("#VA009_POP_cmbBankAccount_"+f.windowNo).find(":selected").attr("precision");(n==null||n==0)&&(n=2);t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetConvertedAmt",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(vt),BankAccount:$POP_cmbBankAccount.val(),CurrencyType:$pop_cmbCurrencyType.val(),dateAcct:s!=null?s.val():null,_org_Id:$POP_cmbOrg.val()<=0?0:$POP_cmbOrg.val()},success:function(n){p(n)},error:function(n){console.log(n);VIS.ADialog.error("VA009_ErrorLoadingPayments")}});var i=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/GetBankAccountCurrency",{BankAccount_ID:$POP_cmbBankAccount.val()});i>0&&($POP_cmbCurrency.val(i),$POP_cmbCurrency.removeClass("vis-ev-col-mandatory"))});$pop_cmbCurrencyType.on("change",function(){t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetConvertedAmtBatch",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(vt),BankAccount:$POP_cmbBankAccount.val(),CurrencyType:$pop_cmbCurrencyType.val(),ToCurrency:$POP_cmbCurrency.val(),dateAcct:s!=null?s.val():null,_org_Id:$POP_cmbOrg.val()<=0?0:$POP_cmbOrg.val()},success:function(n){p(n)},error:function(n){console.log(n);VIS.ADialog.error("VA009_ErrorLoadingPayments")}})});$POP_BtnChkDetails.on("click",function(){if(parseInt($POP_cmbBankAccount.val())>0)if(parseInt($POP_PayMthd.val())>0){t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetCheckDetails",type:"POST",datatype:"json",async:!0,data:{C_BankAccount_ID:parseInt($POP_cmbBankAccount.val()),VA009_PaymentMethod_ID:parseInt($POP_PayMthd.val())},success:function(t){n(t)},error:function(n){console.log(n);VIS.ADialog.error("VA009_ErrorLoadingPayments")}});function n(n){n!=null&&(console.log(n),it.ChequeDetails_Dialog(n,$consolidate.prop("checked")))}}else return VIS.ADialog.info("VA009_PlsSelectPayMethod"),c.selectNone(),!1;else return VIS.ADialog.info("VA009_PLSelectBankAccount"),c.selectNone(),!1});$POP_cmbCurrency.on("change",function(){VIS.Utility.Util.getValueOfInt($POP_cmbCurrency.val())==0?$POP_cmbCurrency.addClass("vis-ev-col-mandatory"):$POP_cmbCurrency.removeClass("vis-ev-col-mandatory");n=t("#VA009_POP_cmbCurrency_"+f.windowNo).find(":selected").attr("precision");(n==null||n==0)&&(n=2);t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetConvertedAmtBatch",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(vt),BankAccount:$POP_cmbBankAccount.val(),CurrencyType:$pop_cmbCurrencyType.val(),ToCurrency:$POP_cmbCurrency.val(),dateAcct:s!=null?s.val():null,_org_Id:$POP_cmbOrg.val()<=0?0:$POP_cmbOrg.val()},success:function(n){p(n)},error:function(n){console.log(n);VIS.ADialog.error("VA009_ErrorLoadingPayments")}})});s.on("change",function(){if(s.val()?s.removeClass("vis-ev-col-mandatory"):s.addClass("vis-ev-col-mandatory"),VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())<=0)return VIS.ADialog.info("VA009_PlsSelectOrg"),!1;if(VIS.Utility.Util.getValueOfInt($POP_targetDocType.val())<=0)return VIS.ADialog.info("VA009_PlsSelectDocType"),!1;if(VIS.Utility.Util.getValueOfInt($POP_cmbBank.val())<=0)return VIS.ADialog.info("VA009_PlsSelectBank"),!1;if(VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val())<=0)return VIS.ADialog.info("VA009_PlsSelectBankAccount"),!1;if(VIS.Utility.Util.getValueOfInt($POP_PayMthd.val())<=0)return VIS.ADialog.info("VA009_PlsSelectPaymentMethod"),!1;if(s.val()=="")return VIS.ADialog.info("VA009_PLSelectAcctDate"),!1;var i=Date.parse(s.val()),n=new Date(parseInt(i));!isNaN(n.getTime())&&n.getTime()<0||t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetConvertedAmtBatch",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(vt),BankAccount:$POP_cmbBankAccount.val(),CurrencyType:$pop_cmbCurrencyType.val(),ToCurrency:$POP_cmbCurrency.val(),dateAcct:s!=null?s.val():null,_org_Id:$POP_cmbOrg.val()<=0?0:$POP_cmbOrg.val()},success:function(n){p(n)},error:function(n){console.log(n);VIS.ADialog.error("VA009_ErrorLoadingPayments")}})});c.on("change",function(n){n.column==7&&(c.records[n.index].CheckNumber=n.value_new);n.column==8&&(c.records[n.index].CheckDate=n.value_new!=""?n.value_new:n.value_previous!=""?n.value_previous:n.value_original);n.column==9&&(c.records[n.index].ValidMonths=n.value_new)});$POP_PayMthd.on("change",function(){VIS.Utility.Util.getValueOfInt($POP_PayMthd.val())>0?$POP_PayMthd.removeClass("vis-ev-col-mandatory"):$POP_PayMthd.addClass("vis-ev-col-mandatory");or.hasClass("VA009-active-tab")&&t("option:selected",$POP_PayMthd).attr("PaymentBaseType")=="S"?$POP_BtnChkDetails.show():$POP_BtnChkDetails.hide();bf=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/GetPaymentRule",{PaymentMethod:$POP_PayMthd.val()},null);bf=="S"?c.showColumn("CheckNumber","CheckDate","ValidMonths","Mandate"):c.hideColumn("recid","CheckNumber","CheckDate","ValidMonths","Mandate")});i.onOkClick=function(){var e=[],f,i,o;if(c.selectAll(),VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())>0)if(VIS.Utility.Util.getValueOfInt($POP_targetDocType.val())>0)if(VIS.Utility.Util.getValueOfInt($POP_cmbBank.val())>0)if(VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val())>0)if(VIS.Utility.Util.getValueOfInt($POP_PayMthd.val())>0){if(t("option:selected",$POP_PayMthd).attr("PaymentBaseType")=="S"&&u-r<0)return VIS.ADialog.info("VA009_NotAllowed"),v[0].style.visibility="hidden",c.selectNone(),!1;if(s.val()!=""&&s.val()!=null){if(c.getSelection().length>0){for(f=0;f<c.getSelection().length;f++){if(i={},i.C_BPartner_ID=c.get(c.getSelection()[f]).C_BPartner_ID,i.C_BPartner_Location_ID=c.get(c.getSelection()[f]).C_BPartner_Location_ID,i.C_Invoice_ID=c.get(c.getSelection()[f]).C_Invoice_ID,i.C_InvoicePaySchedule_ID=c.get(c.getSelection()[f]).C_InvoicePaySchedule_ID,i.AD_Org_ID=VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val()),i.TargetDocType=VIS.Utility.Util.getValueOfInt($POP_targetDocType.val()),i.AD_Client_ID=c.get(c.getSelection()[f]).AD_Client_ID,i.C_Currency_ID=c.get(c.getSelection()[f]).C_Currency_ID,i.TransactionType=c.get(c.getSelection()[f]).TransactionType,i.DueAmt=c.get(c.getSelection()[f]).DueAmt.toFixed(n),i.C_Bank_ID=$POP_cmbBank.val(),i.C_BankAccount_ID=$POP_cmbBankAccount.val(),i.ConversionTypeId=c.get(c.getSelection()[f]).ConversionTypeId,i.DiscountAmount=c.get(c.getSelection()[f]).DiscountAmount.toFixed(n),i.ConvertedDiscountAmount=c.get(c.getSelection()[f]).ConvertedDiscountAmount.toFixed(n),i.DiscountDate=c.get(c.getSelection()[f]).DiscountDate!=null?VIS.Utility.Util.getValueOfDate(c.get(c.getSelection()[f]).DiscountDate):null,i.C_DocType_ID=c.get(c.getSelection()[f]).C_DocType_ID,i.DocBaseType=c.get(c.getSelection()[f]).DocBaseType,i.PaymwentBaseType=c.get(c.getSelection()[f]).PaymwentBaseType,i.TotalAPI=VIS.Utility.Util.getValueOfDecimal(c.get(c.getSelection()[f]).TotalAPI),i.TotalAPC=VIS.Utility.Util.getValueOfDecimal(c.get(c.getSelection()[f]).TotalAPC),i.DueAmt!=0&&c.get(c.getSelection()[f]).ConvertedAmt==0)return VIS.ADialog.info("VA009_ConversionNotFound"),!1;if(i.ConvertedAmt=c.get(c.getSelection()[f]).ConvertedAmt.toFixed(n),$overwritepay.prop("checked")==!0?(i.VA009_PaymentMethod_ID=$POP_PayMthd.val(),i.isOverwrite="Y"):(i.VA009_PaymentMethod_ID=c.get(c.getSelection()[f]).VA009_PaymentMethod_ID,i.isOverwrite="N"),i.isconsolidate=$consolidate.prop("checked")==!0?"Y":"N",bf=="S")if(o=new Date(c.get(c.getSelection()[f]).CheckDate),i.CheckDate=VIS.Utility.Util.getValueOfDate(c.get(c.getSelection()[f]).CheckDate),c.get(c.getSelection()[f]).CheckNumber!=null)i.CheckNumber=c.get(c.getSelection()[f]).CheckNumber;else return VIS.ADialog.info("VA009_PLCheckNumber"),c.selectNone(),!1;else i.CheckNumber=null,i.CheckDate=null,i.ValidMonths=null;i.CurrencyType=$pop_cmbCurrencyType.val();i.HeaderCurrency=$POP_cmbCurrency.val();i.DateAcct=VIS.Utility.Util.getValueOfDate(s.val());e.push(i)}e.sort(ke)}v[0].style.visibility="visible";t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GeneratePaymentsBatch",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(e)},success:function(n){ii(n)},error:function(n){console.log(n);v[0].style.visibility="hidden";VIS.ADialog.error("VA009_ErrorLoadingPayments")}})}else return VIS.ADialog.info("VA009_PLSelectAcctDate"),c.selectNone(),!1}else return VIS.ADialog.info("VA009_PlsSelectPayMethod"),c.selectNone(),!1;else return VIS.ADialog.info("VA009_PLSelectBankAccount"),c.selectNone(),!1;else return VIS.ADialog.info("VA009_PLSelectBank"),c.selectNone(),!1;else return VIS.ADialog.info("VA009_PLSelectTargetDocType"),c.selectNone(),!1;else return VIS.ADialog.info("VA009_PlsSelectOrg"),c.selectNone(),!1};gf.on("click",function(){ku>0&&yr(ku,"VA009_PaymentBatch","VA009_Batch_ID");tr.close()});ne.on("click",function(){tr.close()});i.onCancelCLick=function(){w2ui.BatchGrid.clear();ft()};i.onClose=function(){w2ui.BatchGrid.clear();ft()}},Split_Dialog:function(){function w(){var n=[];n.length==0&&(n.push({field:"recid",caption:VIS.Msg.getMsg("VA009_srno"),sortable:!0,size:"10%"}),n.push({field:"C_Bpartner",caption:VIS.Msg.getMsg("VA009_BPartner"),sortable:!0,size:"10%"}),n.push({field:"DocumentNo",caption:VIS.Msg.getMsg("VA009_Invoice/Order"),sortable:!0,size:"10%"}),n.push({field:"CurrencyCode",caption:VIS.Msg.getMsg("VA009_Currency"),sortable:!0,size:"10%"}),n.push({field:"DueAmt",caption:VIS.Msg.getMsg("VA009_DueAmt"),sortable:!0,size:"10%",style:"text-align: right",render:function(n){var t=n.DueAmt;return parseFloat(t).toLocaleString(window.navigator.language,{minimumFractionDigits:h})}}),n.push({field:"DueDate",caption:VIS.Msg.getMsg("VA009_DueDate"),sortable:!0,size:"10%",render:function(n,t){var i;return n.changes==undefined||n.changes.DueDate==""?i=n.DueDate:new Date(n.changes.DueDate)>=new Date(p.records[t].DateAcct)?i=n.changes.DueDate:(i=n.DueDate,n.changes.DueDate=n.DueDate),new Date(i).toLocaleDateString()},style:"text-align: left",editable:{type:"date"}}),n.push({field:"TransactionType",caption:VIS.Msg.getMsg("VA009_TransactionType"),sortable:!0,size:"1%"}));p=null;p=u.w2grid({name:"SplitGrid",recordHeight:25,columns:n,method:"GET",multiSelect:!0});p.hideColumn("recid");p.hideColumn("TransactionType")}function tt(){u=$split.find("#VA009_btnPopupGrid");$TxtSplitAmt=$split.find("#VA009_POP_TxtSplitAmt_"+f.windowNo);$BtnSplit=$split.find("#VA009_btnSplitAmt_"+f.windowNo)}function it(n){t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetPopUpData",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{InvPayids:a.toString(),bank_id:s,acctno:c,chkno:VIS.Utility.encodeText(o),OrderPayids:y.toString()},success:function(t){n(t)},error:function(){v[0].style.visibility="hidden";VIS.ADialog.error("VA009_ErrorLoadingPayments")}})}function ft(n){var f,i,r,t,u,e,o;p.clear();g=[];f=0;i=JSON.parse(n);for(r in i)f=f+1,t={},t.recid=f,t.C_Bpartner=i[r].C_Bpartner,t.C_Invoice_ID=i[r].C_Invoice_ID,t.DocumentNo=i[r].DocumentNo,t.C_InvoicePaySchedule_ID=i[r].C_InvoicePaySchedule_ID,t.CurrencyCode=i[r].CurrencyCode,t.DueAmt=i[r].DueAmt,u=new Date(i[r].DueDate),u.setMinutes(-u.getTimezoneOffset()+u.getMinutes()),newValue=u.toISOString(),e=newValue.substring(0,newValue.length-1),o=newValue.indexOf("T"),t.DueDate=e.substring(0,o),t.C_BPartner_ID=i[r].C_BPartner_ID,t.C_Currency_ID=i[r].C_Currency_ID,t.AD_Org_ID=i[r].AD_Org_ID,t.AD_Client_ID=i[r].AD_Client_ID,t.TransactionType=i[r].TransactionType,t.DateAcct=i[r].DateAcct,g.push(t);w2utils.encodeTags(g);p.add(g);v[0].style.visibility="hidden"}function i(){var i,t,u,f,n,e,r,o;_CollaborateData=[];i=p.get(p.getSelection()[0]).DueAmt;t=kt.GetConvertedNumber($TxtSplitAmt.val(),k);t=t.toLocaleString(window.navigator.language,{minimumFractionDigits:h});t=kt.GetConvertedNumber(t,k);i<0&&(i=-1*i);t<0&&(t=-1*t);u=i/t;f=Math.ceil(u);f>0&&(n={},e=p.records[p.records.length-1].recid+1,n.recid=e,n.C_BPartner_ID=p.get(p.getSelection()[0]).C_BPartner_ID,n.C_Bpartner=p.get(p.getSelection()[0]).C_Bpartner,n.CurrencyCode=p.get(p.getSelection()[0]).CurrencyCode,n.DocumentNo=p.get(p.getSelection()[0]).DocumentNo,n.C_Invoice_ID=p.get(p.getSelection()[0]).C_Invoice_ID,n.AD_Org_ID=p.get(p.getSelection()[0]).AD_Org_ID,n.AD_Client_ID=p.get(p.getSelection()[0]).AD_Client_ID,n.C_Currency_ID=p.get(p.getSelection()[0]).C_Currency_ID,n.DueAmt=t.toFixed(h),n.C_InvoicePaySchedule_ID=p.get(p.getSelection()[0]).C_InvoicePaySchedule_ID,n.DueDate=p.get(p.getSelection()[0]).DueDate,n.DateAcct=p.get(p.getSelection()[0]).DateAcct,n.TransactionType=p.get(p.getSelection()[0]).TransactionType,_CollaborateData.push(n),r=t,i-r>0&&(o=i-r,p.get(p.getSelection()[0]).DueAmt=o.toFixed(h)));w2utils.encodeTags(_CollaborateData);p.add(_CollaborateData);$TxtSplitAmt.val("");p.refresh()}function ht(n){n=JSON.parse(n);b.find(".VA009-payment-wrap").remove();l.find(".VA009-right-data-main").remove();l.find(".VA009-accordion").remove();nt=1;a=[];y=[];SlctdJournalPaymentIds=[];d=[];rt=[];ut=[];et();st.prop("checked",!1);ot();at();v[0].style.visibility="hidden";VIS.ADialog.info(n)}function e(){$split=null;r=null;w2ui.SplitGrid.destroy()}var u,o="",s=0,c=0,r,n;v[0].style.visibility="visible";$split=t("<div class='VA009-popform-content vis-formouterwrpdiv' style='min-height:333px !important'>");r="";r+="<div class='VA009-popform-data input-group vis-input-wrap' style='height:auto;'><div class='vis-control-wrap'><input type='text' step='any' id='VA009_POP_TxtSplitAmt_"+f.windowNo+"'  placeholder=' ' data-placeholder=''><label>"+VIS.Msg.getMsg("VA009_lblSplitAmt")+"<\/label><\/div>  <a tabindex='' class='btn VA009-blueBtn' id='VA009_btnSplitAmt_"+f.windowNo+"' style='margin-top: 0px !important; margin-left: 5px;'>Split Schedule<\/a> <\/div>  <div class='VA009-table-container' id='VA009_btnPopupGrid'>  <\/div> <\/div>";$split.append(r);tt();n=new VIS.ChildDialog;n.setContent($split);n.setTitle(VIS.Msg.getMsg("VA009_LoadSplitPayment"));n.setWidth("60%");n.setEnableResize(!0);n.setModal(!0);n.show();w();it(ft);p.on("change",function(n){n.column==5&&n.value_new!=""&&(new Date(n.value_new)>=new Date(p.records[n.index].DateAcct)?p.records[n.index].DueDate=n.value_new:(p.records[n.index].DueDate=n.value_previous==""?n.value_original:n.value_previous,n.value_previous=n.value_previous==""?n.value_original:n.value_previous,window.setTimeout(function(){VIS.ADialog.info("VA009_PlsSelctDueDateGreaterThanTrxDate")},5)))});$TxtSplitAmt.on("keypress",function(n){var r=be.isDecimalSeparatorDot(window.navigator.language);if(n.keyCode!=13&&(n.which!=46||t(this).val().indexOf(".")!=-1)&&n.which!=8&&n.which!=0&&(n.which<48||n.which>57)&&n.keyCode==45&&n.keyCode!=44||!r&&n.keyCode==46||r&&n.keyCode==44)return!1;if(n.target.value.contains(".")&&(n.which==46||n.which==44)&&n.target.value.indexOf(".")>-1&&(n.target.value=n.target.value.replace(".","")),n.target.value.contains(",")&&(n.which==46||n.which==44)&&n.target.value.indexOf(",")>-1&&(n.target.value=n.target.value.replace(",","")),n.keyCode==13){if(p.getSelection().length==0)return VIS.ADialog.info("PlsSelectRecord"),!1;if($TxtSplitAmt.val()!="")parseFloat(p.get(p.getSelection()[0]).DueAmt)<parseFloat($TxtSplitAmt.val())?VIS.ADialog.info("Can't Enter Greater Than Due Amt"):parseFloat(p.get(p.getSelection()[0]).DueAmt)>0?parseFloat($TxtSplitAmt.val())<0?VIS.ADialog.info("Can't Enter Negative Amt"):i():parseFloat(p.get(p.getSelection()[0]).DueAmt)<0?parseFloat($TxtSplitAmt.val())>0?VIS.ADialog.info("Can't Enter Positive Amt"):i():i();else return VIS.ADialog.info("VA009_PLEnterSplitAmt"),!1}});$BtnSplit.on("click",function(){if(p.getSelection().length==0)return VIS.ADialog.info("PlsSelectRecord"),!1;var t=p.get(p.getSelection()[0]).DueAmt,n=kt.GetConvertedNumber($TxtSplitAmt.val(),k);if(n=n.toLocaleString(window.navigator.language,{minimumFractionDigits:h}),n=kt.GetConvertedNumber(n,k),n!="")n=n,t<0&&(t=-1*t),n<0&&(n=-1*n),t<=n?VIS.ADialog.info("VA009_CantEnterGreaterAmt"):t>0?n<0?VIS.ADialog.info("VA009_CantEnterNegtveAmt"):n==0?VIS.ADialog.info("VA009_CantEnterZeroAmt"):i():t<0?n>0?VIS.ADialog.info("VA009_CantEnterPositiveAmt"):i():i();else return VIS.ADialog.info("VA009_PLEnterSplitAmt"),!1});n.onOkClick=function(){if(hu=[],hu=p.records,p.getSelection().length>0||hu.length>1){if(p.selectAll(),hu.length==1)return VIS.ADialog.info("VA009_SplitRecordFirst"),!1;for(var n=0;n<hu.length;n++)if(p.get(p.getSelection()[n]).DueDate==null)return VIS.ADialog.info("VA009_PlzSelctDueDate"),!1;v[0].style.visibility="visible";t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/CreateSplitPayments",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(hu),SplitAmmount:$TxtSplitAmt.val()},success:function(n){ht(n)},error:function(n){console.log(n);v[0].style.visibility="hidden";VIS.ADialog.error("VA009_ErrorLoadingPayments")}})}else return VIS.ADialog.info("VA009_PlzSplitRecord"),!1};n.onCancelCLick=function(){w2ui.SplitGrid.clear();e()};n.onClose=function(){w2ui.SplitGrid.clear();e()}},XML_Dialog:function(){a.length>0||y.length>0?(tf="B",w2confirm("Do you want to clear the selection and proceed for SEPA XML Generation Process?").yes(function(){a=[];y=[];st.prop("checked",!1);b.find(":checkbox").prop("checked",!1);ge(tf)}).no(function(){console.log("user clicked NO")})):ge(tf)},ChatWindow:function(){function f(n){n=JSON.parse(n);v[0].style.visibility="hidden";lf=b.find("#VA009-Chatcolor-gray_"+tt);lf.html("");lf.append("<span class=VA009-Chatcolor-gray>"+n+"<\/span>")}var n=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/GetChatID",{RecordID:tt},null);if(n!=null){var r=n.AD_Table_ID,u=n.CM_Chat_ID,i=new VIS.Chat(tt,u,r,"",this.windowNo);i.show();i.onClose=function(){t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetChat",type:"POST",datatype:"json",async:!0,data:{RecordID:tt},success:function(n){f(n)},error:function(n){console.log(n);v[0].style.visibility="hidden";VIS.ADialog.error("VA009_ErrorLoadingPayments")}})}}},B2B_Dialog:function(){function ct(){a.on("click",function(n){var i=t(n.target);n.target.type=="checkbox"&&(i.prop("checked")==!0&&(b.prop("checked",!1),nt(u,y),tt($To_cmbBank,[])),r.val(""),l="")});b.on("click",function(n){var i=t(n.target);n.target.type=="checkbox"&&(i.prop("checked")==!0&&(a.prop("checked",!1),tt($To_cmbBank,y),nt(u,[])),r.val(""),l="")});$OrgCmb.on("change",function(){parseInt($OrgCmb.val())>0?(y=[],y.push($OrgCmb.val()),$OrgCmb.removeClass("vis-ev-col-mandatory"),a.prop("checked")==!0&&(nt(u,y),tt($To_cmbBank,[])),b.prop("checked")==!0&&(tt($To_cmbBank,y),nt(u,[]))):$OrgCmb.addClass("vis-ev-col-mandatory");it.LoadTargetDocTypeB2B($POP_ARTargetDocType,1,0);it.LoadTargetDocTypeB2B($POP_APTargetDocType,2,0);r.val("");l=""});u.on("change",function(){parseInt(u.val())>0?(u.removeClass("vis-ev-col-mandatory"),it.LoadTargetDocTypeB2B($POP_APTargetDocType,2,u.val())):(u.addClass("vis-ev-col-mandatory"),it.LoadTargetDocTypeB2B($POP_APTargetDocType,2,0));d=t("#VA009_POP_cmbFromBank_"+f.windowNo).find(":selected").attr("precision");(d==null||d==0)&&(d=2);ot()});$To_cmbBank.on("change",function(){parseInt($To_cmbBank.val())>0?($To_cmbBank.removeClass("vis-ev-col-mandatory"),it.LoadTargetDocTypeB2B($POP_ARTargetDocType,1,$To_cmbBank.val())):($To_cmbBank.addClass("vis-ev-col-mandatory"),it.LoadTargetDocTypeB2B($POP_ARTargetDocType,1,0))});h.on("change",function(){parseInt(h.val())>0?h.removeClass("vis-ev-col-mandatory"):h.addClass("vis-ev-col-mandatory")});s.getControl().on("change",function(){parseInt(s.getValue())>0?s.getControl().removeClass("vis-ev-col-mandatory"):s.getControl().addClass("vis-ev-col-mandatory")});i.on("change",function(){parseInt(i.val())>0?i.removeClass("vis-ev-col-mandatory"):i.addClass("vis-ev-col-mandatory");t("option:selected",i).attr("paybase")=="S"?(r.removeAttr("disabled"),r.css("background-color","white"),r.addClass("vis-ev-col-mandatory"),c.removeAttr("disabled"),c.css("background-color","white"),c.addClass("vis-ev-col-mandatory")):(r.val(""),r.attr("disabled","disabled"),r.removeClass("vis-ev-col-mandatory"),r.css("background-color","#ededed"),c.val(""),c.attr("disabled","disabled"),c.removeClass("vis-ev-col-mandatory"),c.css("background-color","#ededed"),l="");ot()});st.on("click",function(){parseInt(i.val())>0&&t("option:selected",i).attr("paybase")=="S"&&ot()});$POP_APTargetDocType.on("change",function(){VIS.Utility.Util.getValueOfInt($POP_APTargetDocType.val())==0?$POP_APTargetDocType.addClass("vis-ev-col-mandatory"):$POP_APTargetDocType.removeClass("vis-ev-col-mandatory")});$POP_ARTargetDocType.on("change",function(){VIS.Utility.Util.getValueOfInt($POP_ARTargetDocType.val())==0?$POP_ARTargetDocType.addClass("vis-ev-col-mandatory"):$POP_ARTargetDocType.removeClass("vis-ev-col-mandatory")})}function yt(n){$OrgCmb=$b2b.find("#VA009_POP_cmbOrg_"+f.windowNo);u=$b2b.find("#VA009_POP_cmbFromBank_"+f.windowNo);$To_cmbBank=$b2b.find("#VA009_POP_cmbToBank_"+f.windowNo);a=$b2b.find("#VA009_Payment_"+f.windowNo);b=$b2b.find("#VA009_Receipt_"+f.windowNo);p=$b2b.find("#VA009_cmbCurrencyType_"+f.windowNo);i=$b2b.find("#VA009_cmbPayMthd_"+f.windowNo);h=$b2b.find("#VA009_POP_cmbCurrency_"+f.windowNo);at=$b2b.find("#VA009_Amount"+f.windowNo);rt=$b2b.find("#VA009_TransactionDate"+f.windowNo);k=$b2b.find("#VA009_AccountDate"+f.windowNo);r=$b2b.find("#VA009_Chqnotxt_"+f.windowNo);c=$b2b.find("#VA009_CheckDate_"+f.windowNo);st=$b2b.find("#VA009_getCheckNo_"+f.windowNo);ht=n.dialog("widget").find(".ui-dialog-buttonpane");$successNote=df.find("#VA009_Note"+f.windowNo);$OrgCmb.addClass("vis-ev-col-mandatory");u.addClass("vis-ev-col-mandatory");$To_cmbBank.addClass("vis-ev-col-mandatory");s.getControl().addClass("vis-ev-col-mandatory");h.addClass("vis-ev-col-mandatory");i.addClass("vis-ev-col-mandatory");$POP_APTargetDocType=$b2b.find("#VA009_POP_cmbAPDocType_"+f.windowNo);$POP_APTargetDocType.addClass("vis-ev-col-mandatory");$POP_ARTargetDocType=$b2b.find("#VA009_POP_cmbARDocType_"+f.windowNo);$POP_ARTargetDocType.addClass("vis-ev-col-mandatory")}function pt(){function n(n){if($OrgCmb.append(" <option value = 0><\/option>"),n.length>0)for(var t in n)$OrgCmb.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].AD_Org_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>");$OrgCmb.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadOrganization",null,n)}function wt(){function n(n){if(i.append(" <option value = 0><\/option>"),n.length>0)for(var t in n)"LCPB".contains(n[t].VA009_PaymentBaseType)||i.append("<option paybase = "+n[t].VA009_PaymentBaseType+" value="+VIS.Utility.Util.getValueOfInt(n[t].VA009_PaymentMethod_ID)+">"+VIS.Utility.encodeText(n[t].VA009_Name)+" <\/option>");i.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadPaymentMethod",null,n)}function bt(){function n(n){if(p.append("<option value='0'><\/option>"),n.length>0){for(var t in n)p.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>"),VIS.Utility.encodeText(n[t].IsDefault)=="Y"&&(ei=VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID));p.val(ei)}}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/loadCurrencyType",null,n)}function kt(){function n(n){if(h.append("<option value='0'><\/option>"),n.length>0){for(var t in n)h.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_Currency_ID)+">"+VIS.Utility.encodeText(n[t].ISO_Code)+"<\/option>");h.prop("selectedIndex",0)}}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/loadCurrencies",null,n)}function nt(n,t){function i(t){if(n.find("option").remove(),n.append("<option value='0'><\/option>"),n.addClass("vis-ev-col-mandatory"),t!=null&&t.length>0)for(var i in t)n.append("<option precision="+VIS.Utility.Util.getValueOfInt(t[i].Precision)+" value="+VIS.Utility.Util.getValueOfInt(t[i].C_BankAccount_ID)+">"+VIS.Utility.encodeText(t[i].AccountNo)+"<\/option>")}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadBankAccount",{Bank_ID:0,Orgs:t.toString()},i)}function tt(n,t){function i(t){if(n.find("option").remove(),n.append("<option value='0'><\/option>"),n.addClass("vis-ev-col-mandatory"),t!=null&&t.length>0)for(var i in t)n.append("<option value="+VIS.Utility.Util.getValueOfInt(t[i].C_BankAccount_ID)+">"+VIS.Utility.encodeText(t[i].AccountNo)+"<\/option>")}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadBankAccount",{Bank_ID:0,Orgs:t.toString()},i)}function ot(){if(VIS.Utility.Util.getValueOfInt(u.val())>0&&VIS.Utility.Util.getValueOfInt(i.val())>0&&t("option:selected",i).attr("paybase")=="S"){VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/getCheckNo",{C_BankAccount_ID:parseInt(u.val()),VA009_PaymentMethod_ID:parseInt(i.val())},n);function n(n){r.val();$note.css("visibility","hidden");n!=null&&(r.val(n),r.removeClass("vis-ev-col-mandatory"),l=n)}}else r.val(""),l=""}function lt(){$b2b=null;_b2b=null}function dt(i){v[0].style.visibility="visible";t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GeneratePaymentsBtoB",type:"POST",datatype:"json",contentType:"application/json",data:JSON.stringify({recordData:JSON.stringify(i)}),success:function(t){ar=JSON.parse(t);ar.success!=null?($successNote.text(ar.success),$successNote.css("visibility","visible"),n.setContent(df),n.setWidth("32%"),n.show(),n.hidebuttons(),uf.css({visibility:"visible",display:"block"}),rf.css({visibility:"visible",display:"block"}),$note.css("display","none"),gt()):ar.error!=null?($note.text(ar.error),$note.css("visibility","visible"),v[0].style.visibility="hidden"):VIS.ADialog.info("VA009_SavedSuccessfully");v[0].style.visibility="hidden"},error:function(n){ar=n;$note.text(ar);$note.css("visibility","visible");v[0].style.visibility="hidden"}})}function gt(){uf.on("click",function(){ct();$OrgCmb.val(0);b.prop("checked",!1);a.prop("checked",!1);u.val(0);$To_cmbBank.val(0);s.setValue(0);i.val(0);h.val(0);p.val(ei);rt.val(g);k.val(g);r.val(0);c.val("");$POP_APTargetDocType.val("");$POP_ARTargetDocType.val("");n.setContent($b2b);n.setWidth("60%");n.setEnableResize(!0);n.setModal(!0);n.show();$note.css("display","block");uf.css({visibility:"hidden",display:"none"});rf.css({visibility:"hidden",display:"none"});w.dialog("widget").find(".ui-dialog-buttonpane").css("padding","");w.dialog("widget").find(".ui-dialog-buttonpane").css("margin-top","")});rf.on("click",function(){n.close()})}var u,p,i,h,at,s,r,c,st,ht,rt,k,a,b,d=2,y=[],ft,vt=null,et,n,ut,g,l;lblAmount=t("<label>");s=new VIS.Controls.VAmountTextBox("VA009_Amount"+f.windowNo+"",!1,!1,!0,50,100,VIS.DisplayType.Amount,VIS.Msg.getMsg("Amount"));lblAmount.append(VIS.Msg.getMsg("Amount"));s.setValue(0);vt=VIS.DisplayType.GetNumberFormat(VIS.DisplayType.Amount);ft=t("<div class='VA009-popform-data input-group vis-input-wrap'>");et=t("<div class='vis-control-wrap'>");ft.append(et);et.append(s.getControl().attr("placeholder"," ").attr("data-placeholder","")).append(lblAmount);$b2b=t("<div class='VA009-popform-content vis-forms-container vis-formouterwrpdiv' style='min-height:350px !important'>");_b2b=t("<div class='VA009-popfrm-wrap' style='height:auto;'>");_b2bdata=t("<div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbOrg_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_Org")+"<\/label><\/div><\/div><div class='VA009-popform-data VA009-popformchkctrlwrap'><div> <label class='vis-ec-col-lblchkbox'><input type='checkbox' id=VA009_Payment_"+f.windowNo+">Payment<\/label><\/div><div> <label class='vis-ec-col-lblchkbox'><input type='checkbox' id=VA009_Receipt_"+f.windowNo+">Receipt<\/label><\/div><\/div> <div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbFromBank_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_FromBank")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbToBank_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_ToBank")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap' > <div class='vis-control-wrap'><select id='VA009_POP_cmbAPDocType_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_APDocType")+"<\/label><\/div><\/div> <div class='VA009-popform-data input-group vis-input-wrap' > <div class='vis-control-wrap'><select id='VA009_POP_cmbARDocType_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_ARDocType")+"<\/label><\/div><\/div> ");_b2bdata1=t("<div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_cmbPayMthd_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_PayMethodlbl")+"<\/label><\/div><\/div><div class='VA009-popform-data VA009-b2b-popup input-group vis-input-wrap'><div class='vis-control-wrap'><input type='text' placeholder=' ' data-placeholder='' class='vis-ev-col-readonly' id='VA009_Chqnotxt_"+f.windowNo+"' disabled/><label>"+VIS.Msg.getMsg("VA009_ChkNo")+"<\/label><\/div><a href='javascript:void(0)' id='VA009_getCheckNo_"+f.windowNo+"' style=margin-left:4px;>"+VIS.Msg.getMsg("GetNextCheckNo")+"<\/a><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_CheckDate_"+f.windowNo+"' placeholder=' ' data-placeholder='' class='vis-ev-col-readonly' disabled><label>"+VIS.Msg.getMsg("VA009_CheckDate")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbCurrency_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("Currency")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_cmbCurrencyType_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_CurrencyType")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_TransactionDate"+f.windowNo+"' placeholder=' ' data-placeholder=''><label>"+VIS.Msg.getMsg("TransactionDate")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_AccountDate"+f.windowNo+"' placeholder=' ' data-placeholder=''><label>"+VIS.Msg.getMsg("AccountDate")+"<\/label><\/div><\/div><\/div>");$Note=t("<div class='VA009-popform-data' align='left'  margin-top:10Px;'><label style='color:red; visibility: hidden;' id='VA009_Note"+f.windowNo+"'>Please Select Org.<\/label><\/div>");_b2b.append(_b2bdata).append(ft).append(_b2bdata1);$b2b.append(_b2b);df=t("<div style='min-height:75px !important'><label style='color:red; visibility: hidden;' id='VA009_Note"+f.windowNo+"'>Please Select Org.<\/label><\/div>");$resltbtns=t("<button class='ui-button' id='VA009_CreateNew_"+f.windowNo+"'style = 'float: right; margin-right: 12px; margin-bottom:12px; visibility:hidden;display:none;'>"+VIS.Msg.getMsg("CreateNew")+"<\/button><button class= 'ui-button' id = 'VA009_Close_"+f.windowNo+"'style = 'float: right; margin-right: 12px;margin-bottom:12px; visibility:hidden;display:none;'>"+VIS.Msg.getMsg("close")+"<\/button>");n=new VIS.ChildDialog;w=n.getRoot();n.setContent($b2b);n.setTitle(VIS.Msg.getMsg("VA009_BankToBankTransfer"));n.setWidth("60%");n.setEnableResize(!0);n.setModal(!0);n.show();yt(w);ht.append($Note).append($resltbtns);uf=w.dialog("widget").find("#VA009_CreateNew_"+f.windowNo);rf=w.dialog("widget").find("#VA009_Close_"+f.windowNo);$note=w.dialog("widget").find("#VA009_Note"+f.windowNo);ut=new Date;g=ut.getFullYear()+"-"+("0"+(ut.getMonth()+1)).slice(-2)+"-"+("0"+ut.getDate()).slice(-2);rt.val(g);k.val(g);ct();pt();kt();bt();wt();nt(u,y);tt($To_cmbBank,y);it.LoadTargetDocTypeB2B($POP_ARTargetDocType,1,0);it.LoadTargetDocTypeB2B($POP_APTargetDocType,2,0);s.addVetoableChangeListener(this);n.onOkClick=function(){var n,f,o,v,e;if(parseInt($OrgCmb.val())==0)return $note.text(VIS.Msg.getMsg("VA009_PlsSelectOrg")),$note.css("visibility","visible");if(!b.prop("checked")&&!a.prop("checked"))return $note.text(VIS.Msg.getMsg("VA009_PlsSelectPaymentOrReceipt")),$note.css("visibility","visible");if(parseInt(u.val())==0)return $note.text(VIS.Msg.getMsg("VA009_PlsSelectBankFrom")),$note.css("visibility","visible");if(parseInt($To_cmbBank.val())==0)return $note.text(VIS.Msg.getMsg("VA009_PlsSelectBankTo")),$note.css("visibility","visible");if(parseInt($POP_APTargetDocType.val())==0)return $note.text(VIS.Msg.getMsg("VA009_PlsSelectAPDocType")),$note.css("visibility","visible");if(parseInt($POP_ARTargetDocType.val())==0)return $note.text(VIS.Msg.getMsg("VA009_PlsSelectARDocType")),$note.css("visibility","visible");if(parseInt(u.val())==parseInt($To_cmbBank.val()))return $note.text(VIS.Msg.getMsg("VA009_Banknotbesame")),$note.css("visibility","visible");if(parseFloat(s.getValue())==0)return $note.text(VIS.Msg.getMsg("VA009_PlsEnterAmount")),$note.css("visibility","visible");if(parseInt(i.val())==0)return $note.text(VIS.Msg.getMsg("VA009_PlsSelectPayMethod")),$note.css("visibility","visible");if(t("option:selected",i).attr("paybase")=="S"){if(r.val()=="")return $note.text(VIS.Msg.getMsg("VA009_PLCheckNumber")),$note.css("visibility","visible");if(c.val()==""||c.val()==null)return $note.text(VIS.Msg.getMsg("VA009_PLCheckDate")),$note.css("visibility","visible");if(n=new Date(c.val()),n=new Date(n.setHours(0,0,0,0)),f=new Date(k.val()),f=new Date(f.setHours(0,0,0,0)),n>f)return $note.text(VIS.Msg.getMsg("VIS_CheckDateCantbeGreaterSys")),$note.css("visibility","visible")}return parseInt(h.val())==0?($note.text(VIS.Msg.getMsg("VA009_PlsSelectCurrency")),$note.css("visibility","visible")):(o=u.val()+","+h.val()+","+k.val().toString()+","+p.val()+","+VIS.Env.getCtx().getAD_Client_ID()+","+$OrgCmb.val(),v=VIS.dataContext.getJSONRecord("VA009/Payment/CheckConversionRate",o),v<=0)?($note.text(VIS.Msg.getMsg("VA009_ConversionRateNotFound")),$note.css("visibility","visible")):($note.css("visibility","hidden"),isOverrideAutoCheck=!1,a.prop("checked")&&r.val()!=l&&l!=""&&(isOverrideAutoCheck=!0),e={},console.log(parseFloat(s.getValue())),e={OrgID:parseInt($OrgCmb.val()),isReceipt:b.prop("checked"),isPayment:a.prop("checked"),fromBank:parseInt(u.val()),toBank:parseInt($To_cmbBank.val()),amount:parseFloat(s.getValue()),paymentMethod:parseInt(i.val()),currencyID:parseInt(h.val()),currencyType:p.val(),transDate:VIS.Utility.Util.getValueOfDate(rt.val()),acctDate:VIS.Utility.Util.getValueOfDate(k.val()),clientID:VIS.Env.getCtx().getAD_Client_ID(),PayBase:t("option:selected",i).attr("paybase"),CheckNo:r.val(),CheckDate:VIS.Utility.Util.getValueOfDate(c.val()),APDocumentTypeId:VIS.Utility.Util.getValueOfInt($POP_APTargetDocType.val()),ARDocumentTypeId:VIS.Utility.Util.getValueOfInt($POP_ARTargetDocType.val()),IsOverrideAutoCheck:isOverrideAutoCheck},ar="",dt(e),!1)};n.onCancelCLick=function(){lt()};n.onClose=function(){lt()};this.vetoablechange=function(n){console.log(n.propertyName);n.propertyName=="VA009_Amount"+f.windowNo+""&&s.setValue(n.newValue)};r.on("keydown keyup",function(n){var t=String.fromCharCode(n.which)||n.key;if(!/[0-9\.\,]/.test(t)&&n.which!=8&&n.which!=46&&(n.which<65||n.which>90)&&(n.which<37||n.which>40)&&n.which!=39&&n.which!=37&&(n.which<96||n.which>105))return!1;n.shiftKey&&n.preventDefault()});l="";this.vetoablechange=function(n){if(n.propertyName=="VA009_Amount"+f.windowNo+""){var t=o(n,n.newValue.toFixed(d));t=e(t);e(s.oldValue)==t&&s.setValue(null);s.setValue(parseFloat(t))}}},Pay_ManualDialog:function(){function h(){$POP_cmbBank=$payManual.find("#VA009_POP_cmbBank_"+f.windowNo);$POP_cmbBankAccount=$payManual.find("#VA009_POP_cmbBankAccount_"+f.windowNo);$POP_PayMthd=$payManual.find("#VA009_cmbPayMthd_"+f.windowNo);s=$payManual.find("#VA009_AccountDate_"+f.windowNo);yt=$payManual.find("#VA009_cmbCurrencyType_"+f.windowNo);ht=$payManual.find("#VA009_TransactionDate"+f.windowNo);$POP_cmbOrg=$payManual.find("#VA009_POP_cmbOrg_"+f.windowNo);$POP_cmbOrg.addClass("vis-ev-col-mandatory");$POP_PayMthd.addClass("vis-ev-col-mandatory");yt.addClass("vis-ev-col-mandatory");$POP_cmbBank.addClass("vis-ev-col-mandatory");$POP_cmbBankAccount.addClass("vis-ev-col-mandatory");$POP_targetDocType=$payManual.find("#VA009_POP_cmbDocType_"+f.windowNo);$POP_targetDocType.addClass("vis-ev-col-mandatory")}function c(){function n(n){if($POP_cmbOrg.append(" <option value = 0><\/option>"),n.length>0)for(var t in n)$POP_cmbOrg.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].AD_Org_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>");$POP_cmbOrg.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadOrganization",null,n)}function p(){function n(n){if(n.length>1&&$POP_PayMthd.append(" <option value = 0><\/option>"),n.length>0)for(var t in n)"LCPBS".contains(n[t].VA009_PaymentBaseType)||$POP_PayMthd.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].VA009_PaymentMethod_ID)+">"+VIS.Utility.encodeText(n[t].VA009_Name)+"<\/option>");$POP_PayMthd.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadPaymentMethod",null,n)}function w(){function n(n){if(yt.append("<option value='0'><\/option>"),n.length>0)for(var t in n)yt.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>"),VIS.Utility.encodeText(n[t].IsDefault)=="Y"&&(ei=VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID))}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/loadCurrencyType",null,n)}function o(){$payManual=null;i=null}var i,r,e,n;$payManual=t("<div class='VA009-popform-content vis-formouterwrpdiv' style='min-height:210px !important'>");i="";i+="<div class='VA009-popfrm-wrap' style='height:auto !important'><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbOrg_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_Org")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbDocType_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_DocType")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbBank_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_Bank")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbBankAccount_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_BankAccount")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_cmbPayMthd_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_PayMethodlbl")+"<\/label><\/div ><\/div > <div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_AccountDate_"+f.windowNo+"' placeholder=' ' data-placeholder=''><label>"+VIS.Msg.getMsg("AccountDate")+"<\/label> <\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_cmbCurrencyType_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_CurrencyType")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_TransactionDate"+f.windowNo+"'  placeholder=' ' data-placeholder=''><label>"+VIS.Msg.getMsg("TransactionDate")+"<\/label> <\/div><\/div><\/div>";$payManual.append(i);h();r=new Date;e=r.getFullYear()+"-"+("0"+(r.getMonth()+1)).slice(-2)+"-"+("0"+r.getDate()).slice(-2);s.val(e);ht.val(e);n=new VIS.ChildDialog;n.setContent($payManual);n.setTitle(VIS.Msg.getMsg("VA009_PayMannual"));n.setWidth("65%");n.setEnableResize(!0);n.setModal(!0);n.show();c();vr($POP_cmbBank,VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val()));p();w();it.LoadTargetDocType($POP_targetDocType,ni);$POP_cmbOrg.on("change",function(){VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())==0?$POP_cmbOrg.addClass("vis-ev-col-mandatory"):(vr($POP_cmbBank,VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())),$POP_cmbBank.val(0).prop("selected",!0),$POP_cmbBank.addClass("vis-ev-col-mandatory"),$POP_cmbBankAccount.empty(),$POP_cmbBankAccount.append("<option value='0'><\/option>"),$POP_cmbBankAccount.addClass("vis-ev-col-mandatory"),$POP_cmbOrg.removeClass("vis-ev-col-mandatory"));it.LoadTargetDocType($POP_targetDocType,ni)});$POP_cmbBank.on("change",function(){function n(n){if($POP_cmbBankAccount.append("<option value='0'><\/option>"),n!=null&&n.length>0)for(var t in n)$POP_cmbBankAccount.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_BankAccount_ID)+">"+VIS.Utility.encodeText(n[t].AccountNo)+"<\/option>")}$POP_cmbBankAccount.empty();$POP_cmbBankAccount.addClass("vis-ev-col-mandatory");VIS.Utility.Util.getValueOfInt($POP_cmbBank.val())==0?$POP_cmbBank.addClass("vis-ev-col-mandatory"):$POP_cmbBank.removeClass("vis-ev-col-mandatory");VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadBankAccount",{Bank_ID:$POP_cmbBank.val(),Orgs:$POP_cmbOrg.val()},n)});yt.on("change",function(){VIS.Utility.Util.getValueOfInt(yt.val())==0?yt.addClass("vis-ev-col-mandatory"):yt.removeClass("vis-ev-col-mandatory")});$POP_PayMthd.on("change",function(){VIS.Utility.Util.getValueOfInt($POP_PayMthd.val())==0?$POP_PayMthd.addClass("vis-ev-col-mandatory"):$POP_PayMthd.removeClass("vis-ev-col-mandatory")});s.on("change",function(){s.val()==""?s.addClass("vis-ev-col-mandatory"):s.removeClass("vis-ev-col-mandatory")});$POP_cmbBankAccount.on("change",function(){VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val())==0?$POP_cmbBankAccount.addClass("vis-ev-col-mandatory"):$POP_cmbBankAccount.removeClass("vis-ev-col-mandatory")});$POP_targetDocType.on("change",function(){VIS.Utility.Util.getValueOfInt($POP_targetDocType.val())==0?$POP_targetDocType.addClass("vis-ev-col-mandatory"):$POP_targetDocType.removeClass("vis-ev-col-mandatory")});n.onOkClick=function(){if(a.length>0||y.length>0||SlctdJournalPaymentIds.length>0)if(VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())>0)if(VIS.Utility.Util.getValueOfInt($POP_targetDocType.val())>0)if(VIS.Utility.Util.getValueOfInt($POP_cmbBank.val())>0)if(VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val())>0)if(VIS.Utility.Util.getValueOfInt($POP_PayMthd.val())>0)if(s.val()!=""&&s.val()!=null)if(yt.val()>0)if(1)v[0].style.visibility="visible",t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GeneratePaymentsMannualy",type:"POST",datatype:"json",async:!0,data:{InvoiceSchdIDS:a.toString(),OrderSchdIDS:y.toString(),BankID:VIS.Utility.Util.getValueOfInt($POP_cmbBank.val()),BankAccountID:VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val()),PaymentMethodID:VIS.Utility.Util.getValueOfInt($POP_PayMthd.val()),DateAcct:s.val(),CurrencyType:yt.val(),DateTrx:ht.val(),AD_Org_ID:VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val()),docTypeID:VIS.Utility.Util.getValueOfInt($POP_targetDocType.val()),JournalSchdIDS:SlctdJournalPaymentIds.toString()},success:function(n){n=JSON.parse(n);b.find(".VA009-payment-wrap").remove();l.find(".VA009-right-data-main").remove();l.find(".VA009-accordion").remove();nt=1;a=[];y=[];d=[];rt=[];SlctdJournalPaymentIds=[];et();st.prop("checked",!1);ot();at();v[0].style.visibility="hidden";VIS.ADialog.info("",null,n,"")},error:function(n){console.log(n);v[0].style.visibility="hidden";VIS.ADialog.error("VA009_ErrorLoadingPayments")}});else return VIS.ADialog.info("VA009_PlzSelctapprPM"),!1;else return VIS.ADialog.info("VA009_SelectConversionType"),!1;else return VIS.ADialog.info("VA009_PLSelectAcctDate"),!1;else return VIS.ADialog.info("VA009_PLSelectPaymentMethod"),!1;else return VIS.ADialog.info("VA009_PLSelectBankAccount"),!1;else return VIS.ADialog.info("VA009_PLSelectBank"),!1;else return VIS.ADialog.info("VA009_PlsSelectDocumentType"),u.selectNone(),!1;else return VIS.ADialog.info("VA009_PlsSelectOrg"),!1;else VIS.ADialog.info("VA009_PlzSelct1Pay")};n.onCancelCLick=function(){o()};n.onClose=function(){o()}},Pay_ManualDialogBP:function(){function w(){var i,r,u,e;$POP_cmbOrg=$payManual.find("#VA009_POP_cmbOrg_"+f.windowNo);$POP_cmbDocType=$payManual.find("#VA009_POP_cmbDocType_"+f.windowNo);ht=$payManual.find("#VA009_TransactionDate_"+f.windowNo);s=$payManual.find("#VA009_AccountDate_"+f.windowNo);$POP_cmbBank=$payManual.find("#VA009_POP_cmbBank_"+f.windowNo);$POP_cmbBankAccount=$payManual.find("#VA009_POP_cmbBankAccount_"+f.windowNo);$POP_cmbBP=$payManual.find("#VA009_POP_cmbBP_"+f.windowNo);$POP_lookCharge=$payManual.find("#VA009_Charge_"+f.windowNo);_BusinessPartnerLookUp=VIS.MLookupFactory.getMLookUp(VIS.Env.getCtx(),f.windowNo,3499,VIS.DisplayType.Search);$BpartnerControl=new VIS.Controls.VTextBoxButton("C_BPartner_ID",!0,!1,!0,VIS.DisplayType.Search,_BusinessPartnerLookUp);i=t('<div class="vis-control-wrap">');r=t('<div class="input-group-append">');$POP_cmbBP.append(i);$POP_cmbBP.append(r);i.append($BpartnerControl.getControl().attr("placeholder"," ").attr("data-placeholder","").attr("data-hasbtn"," ")).append("<label>"+VIS.Msg.getMsg("VA009_BPartner")+"<\/label>");r.append($BpartnerControl.getBtn(0));$BpartnerControl.getControl().addClass("vis-ev-col-mandatory");_ChargeLookUp=VIS.MLookupFactory.getMLookUp(VIS.Env.getCtx(),f.windowNo,3787,VIS.DisplayType.Search);$ChargeControl=new VIS.Controls.VTextBoxButton("C_Charge_ID",!0,!1,!0,VIS.DisplayType.Search,_ChargeLookUp);u=t('<div class="vis-control-wrap">');e=t('<div class="input-group-append">');$POP_lookCharge.append(u);$POP_lookCharge.append(e);u.append($ChargeControl.getControl().attr("placeholder"," ").attr("data-placeholder","").attr("data-hasbtn"," ")).append("<label>"+VIS.Msg.getMsg("Charge")+"<\/label>");e.append($ChargeControl.getBtn(0));$POP_cmbLocation=$payManual.find("#VA009_POP_cmbLocation_"+f.windowNo);$POP_Currency=$payManual.find("#VA009_POP_cmbCurrency_"+f.windowNo);yt=$payManual.find("#VA009_cmbCurrencyType_"+f.windowNo);$POP_PayMthd=$payManual.find("#VA009_cmbPayMthd_"+f.windowNo);$POP_ChkNo=$payManual.find("#VA009_txtCheck_"+f.windowNo);$POP_ChkDate=$payManual.find("#VA009_chkDate_"+f.windowNo);$DivChkNo=$payManual.find("#VA009_DivCheck_"+f.windowNo);$DivChkDate=$payManual.find("#VA009_DivCheckDate_"+f.windowNo);s.addClass("vis-ev-col-mandatory");ht.addClass("vis-ev-col-mandatory");$POP_cmbOrg.addClass("vis-ev-col-mandatory");$POP_cmbDocType.addClass("vis-ev-col-mandatory");$POP_cmbBank.addClass("vis-ev-col-mandatory");$POP_cmbBankAccount.addClass("vis-ev-col-mandatory");$POP_Currency.addClass("vis-ev-col-mandatory");$POP_PayMthd.addClass("vis-ev-col-mandatory");n.getControl().addClass("vis-ev-col-mandatory");yt.addClass("vis-ev-col-mandatory");$POP_cmbLocation.addClass("vis-ev-col-mandatory")}function k(){$POP_cmbBank.on("change",function(){function n(n){if($POP_cmbBankAccount.empty(),$POP_cmbBankAccount.append("<option value='0'><\/option>"),n!=null&&n.length>0)for(var t in n)$POP_cmbBankAccount.append("<option precision="+VIS.Utility.Util.getValueOfInt(n[t].Precision)+" value="+VIS.Utility.Util.getValueOfInt(n[t].C_BankAccount_ID)+">"+VIS.Utility.encodeText(n[t].AccountNo)+"<\/option>")}$POP_cmbBankAccount.empty();VIS.Utility.Util.getValueOfInt($POP_cmbBank.val())==0?$POP_cmbBank.addClass("vis-ev-col-mandatory"):$POP_cmbBank.removeClass("vis-ev-col-mandatory");VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadBankAccount",{Bank_ID:$POP_cmbBank.val(),Orgs:$POP_cmbOrg.val()},n)});$POP_cmbBankAccount.on("change",function(){VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val())==0?$POP_cmbBankAccount.addClass("vis-ev-col-mandatory"):$POP_cmbBankAccount.removeClass("vis-ev-col-mandatory");r=t("#VA009_POP_cmbBankAccount_"+f.windowNo).find(":selected").attr("precision");(r==null||r==0)&&(r=2);c()});$POP_cmbDocType.on("change",function(){VIS.Utility.Util.getValueOfInt($POP_cmbDocType.val())==0?$POP_cmbDocType.addClass("vis-ev-col-mandatory"):$POP_cmbDocType.removeClass("vis-ev-col-mandatory");c()});ht.on("change",function(){ht.val()==""?ht.addClass("vis-ev-col-mandatory"):(ht.removeClass("vis-ev-col-mandatory"),s.val(ht.val()),s.removeClass("vis-ev-col-mandatory"))});s.on("change",function(){s.val()==""?s.addClass("vis-ev-col-mandatory"):s.removeClass("vis-ev-col-mandatory")});$POP_cmbOrg.on("change",function(){$POP_cmbBank.empty();$POP_cmbDocType.empty();$POP_cmbBankAccount.empty();$POP_cmbLocation.empty();$POP_cmbDocType.addClass("vis-ev-col-mandatory");$POP_cmbBank.addClass("vis-ev-col-mandatory");$POP_cmbBankAccount.addClass("vis-ev-col-mandatory");$POP_PayMthd.empty();$POP_cmbOrg.val()=="0"?$POP_cmbOrg.addClass("vis-ev-col-mandatory"):$POP_cmbOrg.removeClass("vis-ev-col-mandatory");ct();lt($POP_cmbBank);pt();vt();ft()});$BpartnerControl.fireValueChanged=function(){$BpartnerControl.oldValue=null;$BpartnerControl.value!=null&&$BpartnerControl.getControl().removeClass("vis-ev-col-mandatory");it()};$POP_cmbLocation.on("change",function(){$POP_cmbLocation.val()=="0"?$POP_cmbLocation.addClass("vis-ev-col-mandatory"):$POP_cmbLocation.removeClass("vis-ev-col-mandatory")});$POP_Currency.on("change",function(){$POP_Currency.val()=="0"?$POP_Currency.addClass("vis-ev-col-mandatory"):$POP_Currency.removeClass("vis-ev-col-mandatory")});yt.on("change",function(){yt.val()=="0"?yt.addClass("vis-ev-col-mandatory"):yt.removeClass("vis-ev-col-mandatory")});$POP_ChkDate.on("blur",function(){if($POP_ChkDate.val()>s.val())return $POP_ChkDate.val(""),VIS.ADialog.info("VIS_CheckDateCantbeGreaterSys"),!1});$POP_PayMthd.on("change",function(){$POP_PayMthd.val()=="0"?$POP_PayMthd.addClass("vis-ev-col-mandatory"):$POP_PayMthd.removeClass("vis-ev-col-mandatory");t("option:selected",$POP_PayMthd).attr("paybase")=="S"?($DivChkDate.show(),$DivChkNo.show()):($DivChkDate.hide(),$DivChkNo.hide());c()});n.getControl().on("change",function(){parseFloat(n.getValue())>0?n.getControl().removeClass("vis-ev-col-mandatory"):n.getControl().addClass("vis-ev-col-mandatory")})}function c(){if(VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val())>0&&VIS.Utility.Util.getValueOfInt($POP_PayMthd.val())>0&&t("option:selected",$POP_PayMthd).attr("paybase")=="S"&&t("option:selected",$POP_cmbDocType).attr("docbasetype")=="APP"){VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/getCheckNo",{C_BankAccount_ID:parseInt($POP_cmbBankAccount.val()),VA009_PaymentMethod_ID:parseInt($POP_PayMthd.val())},n);function n(n){$POP_ChkNo.val("");n!=""?($POP_ChkNo.val(n),u=n):VIS.ADialog.info("VA009_CheckNotFound")}}else $POP_ChkNo.val(""),u=""}function g(){tt()}function tt(){function n(n){if($POP_cmbOrg.empty(),$POP_cmbOrg.append(" <option value = 0><\/option>"),n.length>0)for(var t in n)$POP_cmbOrg.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].AD_Org_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>");$POP_cmbOrg.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadOrganization",null,n)}function it(){function n(n){if($POP_cmbLocation.empty(),$POP_cmbLocation.append(" <option value = 0><\/option>"),n.length>0)for(var t in n)$POP_cmbLocation.append("<option value="+VIS.Utility.Util.getValueOfString(n[t].C_Location_ID)+">"+VIS.Utility.Util.getValueOfString(n[t].Name)+"<\/option>");$POP_cmbLocation.prop("value",ce)}ce=VIS.Env.getCtx().getWindowTabContext(f.windowNo,VIS.EnvConstants.TAB_INFO,"C_BPARTNER_LOCATION_ID");VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/GetLocation",{BP:$BpartnerControl.value},n)}function ft(){function n(n){if($POP_PayMthd.empty(),$POP_PayMthd.append(" <option value = 0><\/option>"),n.length>0)for(var t in n)"LCPB".contains(n[t].VA009_PaymentBaseType)||$POP_PayMthd.append("<option paybase = "+n[t].VA009_PaymentBaseType+" value="+VIS.Utility.Util.getValueOfInt(n[t].VA009_PaymentMethod_ID)+">"+VIS.Utility.encodeText(n[t].VA009_Name)+" <\/option>");$POP_PayMthd.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadPaymentMethod",null,n)}function ct(){function n(n){if($POP_cmbDocType.empty(),$POP_cmbDocType.append(" <option value = 0><\/option>"),n.length>0)for(var t in n)$POP_cmbDocType.append("<option docbasetype="+VIS.Utility.Util.getValueOfString(n[t].DocBaseType)+" value="+VIS.Utility.Util.getValueOfInt(n[t].C_DocType_ID)+">"+VIS.Utility.Util.getValueOfString(n[t].Name)+"<\/option>");$POP_cmbDocType.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/GetDocumentType",{orgs:$POP_cmbOrg.val()},n)}function lt(n){function t(t){if(t.length>0){n.find("option").remove();n.append("<option value='0'><\/option>");for(var i in t)n.append("<option value="+VIS.Utility.Util.getValueOfInt(t[i].C_Bank_ID)+">"+VIS.Utility.encodeText(t[i].Name)+"<\/option>");n.prop("selectedIndex",0)}}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadBank",{Orgs:$POP_cmbOrg.val()},t)}function vt(){function n(n){if($POP_Currency.empty(),$POP_Currency.append(" <option value = 0><\/option>"),n.length>0)for(var t in n)$POP_Currency.append("<option value="+VIS.Utility.Util.getValueOfString(n[t].C_Currency_ID)+">"+VIS.Utility.Util.getValueOfString(n[t].ISO_Code)+"<\/option>");$POP_Currency.prop("selectedIndex",0)}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/LoadCurrencies",null,n)}function pt(){function n(n){if(yt.empty(),yt.append("<option value='0'><\/option>"),n.length>0)for(var t in n)yt.append("<option value="+VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID)+">"+VIS.Utility.encodeText(n[t].Name)+"<\/option>"),VIS.Utility.encodeText(n[t].IsDefault)=="Y"&&(ei=VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID))}VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/loadCurrencyType",null,n)}function p(){$payManual=null;_payManual=null}function wt(){return VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())>0?VIS.Utility.Util.getValueOfInt($POP_cmbDocType.val())>0?VIS.Utility.Util.getValueOfInt($POP_cmbBank.val())>0?VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val())>0?ht.val()!=""&&ht.val()!=null?s.val()!=""&&s.val()!=null?VIS.Utility.Util.getValueOfInt($BpartnerControl.value)>0?VIS.Utility.Util.getValueOfInt($POP_cmbLocation.val())>0?VIS.Utility.Util.getValueOfInt($POP_Currency.val())>0?VIS.Utility.Util.getValueOfInt(yt.val())>0?VIS.Utility.Util.getValueOfInt($POP_PayMthd.val())>0?VIS.Utility.Util.getValueOfDecimal(n.getValue())>0?t("option:selected",$POP_PayMthd).attr("paybase")=="S"?$POP_ChkNo.val()!=""&&$POP_ChkDate.val()!=""?!0:(VIS.ADialog.info("VA009_PLCheckNumber&Date"),!1):!0:(VIS.ADialog.info("VA009_PlsEnterAmount"),!1):(VIS.ADialog.info("VA009_PlsSelectPayMethod"),!1):(VIS.ADialog.info("VA009_PlsSelectCurrencyType"),!1):(VIS.ADialog.info("VA009_PlsSelectCurrency"),!1):(VIS.ADialog.info("SelectBPLocation"),!1):(VIS.ADialog.info("SelectBusinessPartnerFirst"),!1):(VIS.ADialog.info("VA009_PllsSelTAcctdate"),!1):(VIS.ADialog.info("PllsSelTdate"),!1):(VIS.ADialog.info("VA009_PLSelectBankAccount"),!1):(VIS.ADialog.info("VA009_PLSelectBank"),!1):(VIS.ADialog.info("VA009_PlsSelectDocumentType"),!1):(VIS.ADialog.info("VA009_PlsSelectOrg"),!1)}function bt(){var r=[],i="",f=!1;t("option:selected",$POP_cmbDocType).attr("docbasetype")=="APP"&&$POP_ChkNo.val()!=u&&u!=""&&(f=!0);r.push({Org:$POP_cmbOrg.val(),DocType:$POP_cmbDocType.val(),BankID:$POP_cmbBank.val(),BankAccountID:$POP_cmbBankAccount.val(),DateTrx:ht.val(),DateAcct:s.val(),BPID:$BpartnerControl.value,BPLocation:$POP_cmbLocation.val(),CurrencyID:$POP_Currency.val(),CurrencyType:yt.val(),PaymentMethod:$POP_PayMthd.val(),PaymentAmount:n.getValue(),CheckNo:$POP_ChkNo.val(),CheckDate:$POP_ChkDate.val(),charge:VIS.Utility.Util.getValueOfInt($ChargeControl.value),IsOverrideAutoCheck:f});v[0].style.visibility="visible";t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GeneratePayMannual",type:"POST",datatype:"json",async:!0,data:{PaymentData:JSON.stringify(r)},success:function(n){n=JSON.parse(n);i="";b.find(".VA009-payment-wrap").remove();l.find(".VA009-right-data-main").remove();l.find(".VA009-accordion").remove();nt=1;a=[];y=[];SlctdJournalPaymentIds=[];d=[];rt=[];ut=[];et();ot();at();v[0].style.visibility="hidden";tf="M";i!=""?w2confirm(VIS.Msg.getMsg("VA009_GenPaymentFile")).yes(function(){a=[];y=[];SlctdJournalPaymentIds=[];st.prop("checked",!1);b.find(":checkbox").prop("checked",!1);de(i,!1)}).no(function(){v[0].style.visibility="hidden";VIS.ADialog.info("",null,n,"");console.log("user clicked NO")}):VIS.ADialog.info("",null,n,"")},error:function(n){console.log(n);v[0].style.visibility="hidden";VIS.ADialog.error("VA009_ErrorLoadingPayments")}})}var n,r=2,h,i,u;lblAmount=t("<label>");n=new VIS.Controls.VAmountTextBox("VA009_cmbAmt_"+f.windowNo+"",!1,!1,!0,50,100,VIS.DisplayType.Amount,VIS.Msg.getMsg("Amount"));lblAmount.append(VIS.Msg.getMsg("Amount"));n.setValue(0);kt=VIS.DisplayType.GetNumberFormat(VIS.DisplayType.Amount);divAmount=t("<div class='VA009-popform-data input-group vis-input-wrap'>");h=t("<div class='vis-control-wrap'>");divAmount.append(h);h.append(n.getControl().attr("placeholder"," ").attr("data-placeholder","")).append(lblAmount);$payManual=t("<div class='VA009-popform-content vis-formouterwrpdiv' style='min-height:435px'>");_payManual=t("<div class='VA009-popfrm-wrap' style='height:auto !important'>");_addOrg=t("<div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbOrg_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_Org")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbDocType_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_DocType")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbBank_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_Bank")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbBankAccount_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_BankAccount")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_TransactionDate_"+f.windowNo+"' placeholder=' ' data-placeholder=''> <label>"+VIS.Msg.getMsg("TransactionDate")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_AccountDate_"+f.windowNo+"' placeholder=' ' data-placeholder=''><label>"+VIS.Msg.getMsg("AccountDate")+"<\/label><\/div> <\/div><div class='VA009-popform-data input-group vis-input-wrap' id='VA009_POP_cmbBP_"+f.windowNo+"'><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbLocation_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("BPLocation")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbCurrency_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_Currency")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_cmbCurrencyType_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_CurrencyType")+"<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap' id='VA009_Charge_"+f.windowNo+"'><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_cmbPayMthd_"+f.windowNo+"'><\/select><label>"+VIS.Msg.getMsg("VA009_PayMethodlbl")+"<\/label><\/div><\/div>");_addAmt="<div class='VA009-popform-data input-group vis-input-wrap' id= VA009_DivCheck_"+f.windowNo+"><div class='vis-control-wrap'><input type='text' id='VA009_txtCheck_"+f.windowNo+"' placeholder=' ' data-placeholder=''><label>"+VIS.Msg.getMsg("VA009_ChequeNo")+"<\/label><\/div> <\/div><div class='VA009-popform-data input-group vis-input-wrap' id= VA009_DivCheckDate_"+f.windowNo+"><div class='vis-control-wrap'><input type='Date' max='9999-12-31' id='VA009_chkDate_"+f.windowNo+"' placeholder=' ' data-placeholder=''><label>"+VIS.Msg.getMsg("VA009_CheckDate")+"<\/label><\/div> <\/div><\/div><\/div>";_payManual.append(_addOrg).append(divAmount).append(_addAmt);$payManual.append(_payManual);w();i=new VIS.ChildDialog;i.setContent($payManual);i.setTitle(VIS.Msg.getMsg("VA009_PayMannual"));i.setWidth("65%");i.setEnableResize(!0);i.setModal(!0);i.show();k();g();n.addVetoableChangeListener(this);$POP_ChkNo.on("keydown keyup",function(n){var t=String.fromCharCode(n.which)||n.key;if(!/[0-9\.\,]/.test(t)&&n.which!=8&&n.which!=46&&(n.which<65||n.which>90)&&(n.which<37||n.which>40)&&n.which!=39&&n.which!=37&&(n.which<96||n.which>105))return!1;n.shiftKey&&n.preventDefault()});u="";n.addVetoableChangeListener(this);i.onOkClick=function(){if(wt())bt();else return!1};i.onCancelCLick=function(){p()};i.onClose=function(){p()};this.vetoablechange=function(t){if(t.propertyName=="VA009_cmbAmt_"+f.windowNo+""){var i=o(t,t.newValue.toFixed(r));i=e(i);e(n.oldValue)==i&&n.setValue(null);n.setValue(parseFloat(i))}}},ChequeDetails_Dialog:function(n,r){function e(){w2ui["VA009_ChkDetailsGrid_"+f.windowNo].clear();o=null;$opnChkDtls=null;w2ui["VA009_ChkDetailsGrid_"+f.windowNo].destroy()}function y(){var n=[];n.length==0&&(n.push({field:"recid",caption:VIS.Msg.getMsg("VA009_srno"),sortable:!0,size:"10%"}),n.push({field:"C_Bpartner",caption:VIS.Msg.getMsg("VA009_BPartner"),sortable:!0,size:"10%"}),n.push({field:"C_BPartner_Location_ID",caption:VIS.Msg.getMsg("VA009_PayLocation"),sortable:!0,size:"15%",render:function(n){var t=s,r=n.C_BPartner_Location_ID,i;return t&&(i=t.getDisplay(r)),i}}),n.push({field:"C_InvoicePaySchedule_ID",caption:VIS.Msg.getMsg("VA009_Schedule"),hidden:!0,sortable:!0,size:"0%"}),n.push({field:"CurrencyCode",caption:VIS.Msg.getMsg("VA009_Currency"),hidden:!0,sortable:!0,size:"10%"}),n.push({field:"DueAmt",caption:VIS.Msg.getMsg("VA009_DueAmt"),hidden:!0,sortable:!0,size:"10%",style:"text-align: right"}),n.push({field:"ConvertedAmt",caption:VIS.Msg.getMsg("Amount"),sortable:!0,size:"13%",style:"text-align: right",render:function(n){var t=n.ConvertedAmt;return parseFloat(t).toLocaleString(window.navigator.language,{minimumFractionDigits:h})}}),n.push({field:"CheckNumber",caption:VIS.Msg.getMsg("VA009_ChkNo"),sortable:!0,size:"10%"}),n.push({field:"CheckDate",caption:VIS.Msg.getMsg("VA009_CheckDate"),sortable:!0,size:"12%",render:function(n){var t;return t=n.changes==undefined||n.changes.CheckDate==""?n.CheckDate:n.changes.CheckDate,new Date(t).toLocaleDateString()},style:"text-align: left"}),n.push({field:"Mandate",caption:VIS.Msg.getMsg("VA009_Mandate"),hidden:!0,sortable:!0,size:"10%"}),n.push({field:"TransactionType",caption:VIS.Msg.getMsg("VA009_TransactionType"),sortable:!0,size:"1%"}),n.push({field:"ConversionTypeId",caption:VIS.Msg.getMsg("VA009_ConversionType"),hidden:!0,sortable:!0,size:"0%"}),n.push({field:"DiscountAmount",caption:VIS.Msg.getMsg("DiscountAmount"),hidden:!0,sortable:!0,size:"0%"}),n.push({field:"ConvertedDiscountAmount",caption:VIS.Msg.getMsg("ConvertedDiscountAmount"),hidden:!0,sortable:!0,size:"0%"}),n.push({field:"DiscountDate",caption:VIS.Msg.getMsg("DiscountDate"),hidden:!0,sortable:!0,size:"0%"}));ChequeDetailsGrd=null;ChequeDetailsGrd=l.w2grid({name:"VA009_ChkDetailsGrid_"+f.windowNo,recordHeight:25,multiSelect:!0,columns:n});ChequeDetailsGrd.hideColumn("recid","CurrencyCode","C_InvoicePaySchedule_ID","DueAmt","ValidMonths","Mandate","TransactionType","ConversionTypeId","DiscountAmount","ConvertedDiscountAmount","DiscountDate")}function p(n,t,r,f){var o;if(r.sort(ke),r.length>0){var s=0,h=[],c=0,a=0,v="N",l;if(n!=null&&n.length>0?(s=parseInt(n[0].currentnext),a=parseInt(n[0].va009_batchlinedetailcount),v=n[0].chknoautocontrol,n[0].ASSIGNEDCHKNUM=s,n[0].TOTALLINESCOUNT=0,l=n):(e(),u.close(),VIS.ADialog.info("VA009_ChequesNotAvail")),v=="Y"){for(i=0;i<r.length;i++){if(r[i].IsAPCGreater)return e(),u.close(),VIS.ADialog.info("VA009_APCreditIsGreater"),!1;if(!f&&r[i].IsAPCExists)return e(),u.close(),VIS.ADialog.info("VA009_APCreditExists"),!1;if(l=b(n,s),l!=null&&(s=l.ASSIGNEDCHKNUM),i==0?(r[i].CheckNumber=s,r[i].TotalLinesCount=1,r[i].MergeIds=VIS.Utility.Util.getValueOfString(r[i].recid),s=s+1,n[0].TOTALLINESCOUNT=1,h.push(r[i])):(o=h.filter(function(n){if(f&&(n.DocBaseType=="API"||n.DocBaseType=="APC")&&(r[i].DocBaseType=="API"||r[i].DocBaseType=="APC"))return n.C_BPartner_ID==r[i].C_BPartner_ID&&n.C_BPartner_Location_ID==r[i].C_BPartner_Location_ID&&n.TotalLinesCount<a}),o.length==0?(r[i].CheckNumber=s,s=s+1,r[i].TotalLinesCount=1,r[i].MergeIds=VIS.Utility.Util.getValueOfString(r[i].recid),n[0].TOTALLINESCOUNT=1,h.push(r[i])):(o[0].DocBaseType==r[i].DocBaseType?c=parseFloat(o[0].ConvertedAmt)+parseFloat(r[i].ConvertedAmt):r[i].DocBaseType=="API"?parseFloat(r[i].ConvertedAmt)>parseFloat(o[0].ConvertedAmt)&&(c=parseFloat(r[i].ConvertedAmt)-parseFloat(o[0].ConvertedAmt)):r[i].DocBaseType=="APC"?parseFloat(r[i].ConvertedAmt)<parseFloat(o[0].ConvertedAmt)&&(c=parseFloat(o[0].ConvertedAmt)-parseFloat(r[i].ConvertedAmt)):r[i].DocBaseType=="POO"&&(c=parseFloat(o[0].ConvertedAmt)+parseFloat(r[i].ConvertedAmt)),r[i].CheckNumber=o[0].CheckNumber,r[i].ConvertedAmt=c,o[0].MergeIds+=","+VIS.Utility.Util.getValueOfString(r[i].recid),o[0].ConvertedAmt=c,o[0].TotalLinesCount=parseInt(o[0].TotalLinesCount)+1,n[0].TOTALLINESCOUNT=o[0].TotalLinesCount)),l!=null)for(j=0;j<n.length;j++)parseInt(n[j].c_bankaccountdoc_id)==parseInt(l.c_bankaccountdoc_id)&&(n[j].ASSIGNEDCHKNUM=s)}console.log(h);w(h,r);re=r;w2utils.encodeTags(h);t.add(h)}else e(),u.close(),VIS.ADialog.info("VA009_PlzCngStngOfAutoCntrl")}te&&VIS.ADialog.info("VA009_ChequesNotAvail")}function w(n,t){var r=[],i;if(n.length>0)for(i=0;i<n.length;i++)r=n[i].MergeIds.split(","),r.length>0&&r.forEach(function(r){upd_obj=t.findIndex(n=>parseInt(n.recid)==parseInt(r));upd_obj!=-1&&(t[upd_obj].ConvertedAmt=parseFloat(n[i].ConvertedAmt))})}function b(n,t){var i=[],r=!1;for(C_Num=0;C_Num<n.length;C_Num++)if(n[C_Num].hasOwnProperty("ASSIGNEDCHKNUM")){if(parseInt(n[C_Num].ASSIGNEDCHKNUM)<=parseInt(n[C_Num].endchknumber)){i=n[C_Num];r=!1;break}}else{n[C_Num].ASSIGNEDCHKNUM=parseInt(n[C_Num].currentnext);n[C_Num].TOTALLINESCOUNT=0;i=n[C_Num];r=!0;break}return r||i==null||(i.ASSIGNEDCHKNUM=parseInt(t)),(i==null||i!=null&&i.length==0)&&(i.ASSIGNEDCHKNUM="",te=!0),i}var l,u;$opnChkDtls=t("<div class='VA009-popform-content' style='min-height:25px !important'>");var o="",s=null,a=t("<button class= 'ui-button' id = 'VA009_PrintCheque"+f.windowNo+"'>"+VIS.Msg.getMsg("VA009_PrintCheque")+"<\/button>");o+="<div class='VA009-table-container' style='height:300px;' id='VA009_ChkDetailsGrid_"+f.windowNo+"'> <\/div>'";$opnChkDtls.append(o).append(a);l=$opnChkDtls.find("#VA009_ChkDetailsGrid_"+f.windowNo);ie=$opnChkDtls.find("#VA009_PrintCheque"+f.windowNo);te=!1;u=new VIS.ChildDialog;u.setContent($opnChkDtls);u.setTitle(VIS.Msg.getMsg("VA009_CheckDetails"));u.setWidth("50%");u.setEnableResize(!0);u.setModal(!0);u.show();u.hidebuttons();y();s=VIS.MLookupFactory.get(VIS.Env.getCtx(),f.windowNo,0,VIS.DisplayType.TableDir,"C_BPartner_Location_ID",0,!1,"C_BPartner_Location.IsActive='Y' ");p(JSON.parse(n),ChequeDetailsGrd,JSON.parse(JSON.stringify(c.records)),r);u.onOkClick=function(){e()};u.onCancelCLick=function(){e()};u.onClose=function(){e()};ie.on("click",function(){v[0].style.visibility="visible";t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/SavePrintCheckDetails",type:"POST",datatype:"json",async:!0,data:{ChequeData:JSON.stringify(re),BankId:$POP_cmbBank.val(),BankAccId:$POP_cmbBankAccount.val(),IsConsolidate:$consolidate.is(":checked")?"Y":"N"},success:function(n){var t,i;n!=null&&(n=JSON.parse(n),t=n.split(";"),t&&t.length>2&&(i=new VIS.APrint(t[0],t[1],t[2],f.windowNo,null),i.startPdf()));v[0].style.visibility="hidden"},error:function(n){console.log(n);v[0].style.visibility="hidden";VIS.ADialog.error("VA009_ErrorLoadingPayments")}})})}};yr=function(n,t,i){var r=0,u;try{r=VIS.dataContext.getJSONData(VIS.Application.contextUrl+"VA009/Payment/GetWindowID",{WindowName:t},null);r>0&&(u=new VIS.Query,u.addRestriction(i,VIS.Query.prototype.EQUAL,n),VIS.viewManager.startWindow(r,u))}catch(f){console.log(f)}};no=function(n,t,i){n=n=="Y"?"IS NOT NULL":"IS NULL";t=="ARI"?uu=" WHERE cs.c_invoice_id "+n+" AND cs.va009_ispaid    = 'N' AND cd.docbasetype IN  ('ARI','ARC' , 'SOO') AND inv.docstatus IN ('CO','CL')"+i:t=="API"&&(uu=" WHERE cs.c_invoice_id "+n+" AND cs.va009_ispaid    = 'N' AND cd.docbasetype IN  ('API','APC' , 'POO') AND inv.docstatus IN ('CO','CL')"+i)};to=function(n,i){var r=t("<iframe>",{id:"idown_"+i,src:n}).hide().appendTo("body")};this.getRoot=function(){return w};this.disposeComponent=function(){f=null;w&&w.remove();w=null;pt=null;ii=null;pr=null;of=null;io=null;sf=null;_iscustomer=null;_isvendor=null;wr=null;wt=null;rr=null;dt=null;ur=null;gt=null;fr=null;hf=null;$lbdata=null;yu=null;b=null;ru=null;er=null;l=null;nt=null;wu=null;oe=null;si=null;or=null;$UCR_Tab=null;$UCP_Tab=null;cf=null;se=null;uu=null;sr=null;hi=null;ci=null;a=null;y=null;SlctdJournalPaymentIds=null;wi=null;pi=null;bi=null;ki=null;di=null;pu=null;d=[];rt=[];ut=[];lt=null;hr=null;fu=null;eu=null;li=null;le=null;af=null;vf=null;yf=null;pf=null;h=null;ku=null;tr=null;gf=null;ne=null;tu=null;g=null;dr=null;gu=null;n=null;gr=null;ie=null;re=null;ct=[];ai=[]};this.setSize=function(){var n=t("#VA009-main-container_"+f.windowNo).height(),i=t("#VA009-middle-wrap_"+f.windowNo).height(),r=0;n==0&&(n=window.innerHeight-107,i=n-85,r=n-90);ye.height(n);r<=yu.height()&&(r=yu.height(),i=n);t("#VA009-content-area_"+f.windowNo).height(n-20);t("#VA009_Paymntlst_"+f.windowNo).height(i-t("#VA009-mid-top-wrap_"+f.windowNo).height()-t("#VA009-mid-search_"+f.windowNo).height()-42);vu.height(n-54)};this.lockUI=function(){};this.unlockUI=function(){};this.parentcall=function(){v[0].style.visibility="hidden"};this.initial=function(){}};n.PaymentForm.prototype.init=function(n,t){this.windowNo=n;this.frame=t;this.Initialize();this.frame.getContentGrid().append(this.getRoot());this.setSize()};n.PaymentForm.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null}}(VA009,jQuery);VA009=window.VA009||{},function(n){function i(){VIS.CalloutEngine.call(this,"VA009.VA009_CalloutPayment")}function r(){VIS.CalloutEngine.call(this,"VA009.VA009_CalloutPaymentTerm")}function u(){VIS.CalloutEngine.call(this,"VA009.VA009_CalloutCashJournal")}var f=VIS.Logging.Level,t=VIS.Utility.Util;VIS.Utility.inheritPrototype(i,VIS.CalloutEngine);i.prototype.setPMethod=function(n,t,i,r,u){if(this.isCalloutActive()||u==null)return"";this.setCalloutActive(!0);var e=i.getValue("C_InvoicePaySchedule_ID"),o=i.getValue("AD_Client_ID"),s=e.toString()+","+o.toString(),f=VIS.dataContext.getJSONRecord("Pay/GetInvPaymentMethod",s);return f!=null&&(i.setValue("VA009_PaymentMethod_id",f.VA009_PaymentMethod_ID),f.VA009_PaymentBaseType=="D"?i.setValue("TenderType","D"):f.VA009_PaymentBaseType=="K"?i.setValue("TenderType","C"):f.VA009_PaymentBaseType=="S"?i.setValue("TenderType","K"):f.VA009_PaymentBaseType=="T"?i.setValue("TenderType","A"):f.VA009_PaymentBaseType=="L"?i.setValue("TenderType","L"):i.setValue("TenderType","A"),i.setValue("VA009_ExecutionStatus",f.VA009_ExecutionStatus)),this.setCalloutActive(!1),""};i.prototype.setPayAmt=function(n,i,r,u,f){var c,e,h,s,o;if(this.isCalloutActive()||f==null||f.toString()=="")return"";try{var l=n.getContext(i,"DateAcct"),a=n.getContextAsInt(i,"C_Currency_ID"),v=r.getValue("AD_Client_ID"),y=r.getValue("AD_Org_ID"),p=n.getContextAsInt(i,"C_ConversionType_ID"),w=n.getContextAsInt(i,"C_DocType_ID");if(this.setCalloutActive(!0),c=f.toString()+","+w+","+a+","+l+","+v+","+y+","+p,e=VIS.dataContext.getJSONRecord("Pay/GetjournalDetail",c),e!=null){if(h=t.getValueOfString(e.docbaseType),s=t.getValueOfString(e.AccountType),"APP"==h&&s!="L"||"ARR"==h&&s!="A")return VIS.ADialog.info("VIS_SlctedAccountType"),this.setCalloutActive(!1),"";o=0;o=t.getValueOfDecimal(e.AmtSourceCr)==0?t.getValueOfDecimal(e.AmtSourceDr):t.getValueOfDecimal(e.AmtSourceCr);(s=="L"&&o==t.getValueOfDecimal(e.AmtSourceDr)||s=="A"&&o==t.getValueOfDecimal(e.AmtSourceCr))&&(o=-1*o);r.getField("C_BankAccount_ID")!=null?(r.setValue("PayAmt",o),r.setValue("PaymentAmount",o)):r.getField("C_BankAccount_ID")==null&&r.setValue("Amount",o)}}catch(b){return this.setCalloutActive(!1),b}return this.setCalloutActive(!1),""};i.prototype.setScheduleAmount=function(n,i,r,u,f){var p=VIS.dataContext.getJSONRecord("Pay/GetIsAdvanceOrder",n.getContextAsInt(i,"C_Order_ID")),e,k,v,o;if(p!=null&&!p)return"";if(f==null||f.toString()=="")return r.setValue("VA009_ExecutionStatus",null),r.setValue("DiscountAmt",VIS.Env.ZERO),r.setValue("PayAmt",VIS.Env.ZERO),r.setValue("WriteOffAmt",VIS.Env.ZERO),r.setValue("IsOverUnderPayment",!1),r.setValue("OverUnderAmt",VIS.Env.ZERO),e=VIS.dataContext.getJSONRecord("Pay/GetDueAmt",n.getContextAsInt(i,"C_Order_ID")),e!=null&&(l=e.DueAmt,r.setValue("PayAmt",l),r.setValue("PaymentAmount",l)),"";this.setCalloutActive(!0);var d=r.getValue("AD_Client_ID"),g=f.toString()+","+d.toString(),e=VIS.dataContext.getJSONRecord("Pay/GetOrdPaymentMethod",g);e!=null&&(r.setValue("VA009_PaymentMethod_id",e.VA009_PaymentMethod_ID),e.VA009_PaymentBaseType=="D"?r.setValue("TenderType","D"):e.VA009_PaymentBaseType=="K"?r.setValue("TenderType","C"):e.VA009_PaymentBaseType=="S"?r.setValue("TenderType","K"):e.VA009_PaymentBaseType=="T"?r.setValue("TenderType","A"):e.VA009_PaymentBaseType=="L"?r.setValue("TenderType","L"):r.setValue("TenderType","A"),r.setValue("VA009_ExecutionStatus",e.VA009_ExecutionStatus),r.setValue("DiscountAmt",VIS.Env.ZERO),r.setValue("WriteOffAmt",VIS.Env.ZERO),r.setValue("IsOverUnderPayment",!1),r.setValue("OverUnderAmt",VIS.Env.ZERO));var w=0,y=n.getContextAsInt(i,"C_Order_ID"),l=0,e=VIS.dataContext.getJSONRecord("Pay/GetDueAmt",y.toString());e!=null&&(w=e.VA009_OrderPaySchedule_ID,l=e.DueAmt,r.setValue("PayAmt",l),r.setValue("PaymentAmount",l));var nt="N",b="N",tt=y.toString()+","+r.getValue("DateTrx").toString()+","+w.toString(),e=VIS.dataContext.getJSONRecord("Pay/GetOpenAmt",tt);e!=null&&(r.setValue("C_BPartner_ID",e.C_BPartner_ID),k=e.C_Currency_ID,nt=e.IsSOTrx,b=e.IsReturnTrx,r.setValue("C_Currency_ID",k),v=e.orderopen,v==null&&(v=VIS.Env.ZERO),o=e.OrderDiscount,o==null&&(o=VIS.Env.ZERO),o!=0&&(r.setValue("PayAmt",v-o),r.setValue("PaymentAmount",v-o)),r.setValue("DiscountAmt",o),n.setContext(i,"C_Order_ID",y.toString()));var s=t.getValueOfDecimal(r.getValue("PayAmt")==null?VIS.Env.ZERO:r.getValue("PayAmt")),h=t.getValueOfDecimal(r.getValue("WriteOffAmt")==null?VIS.Env.ZERO:r.getValue("WriteOffAmt")),c=t.getValueOfDecimal(r.getValue("OverUnderAmt")==null?VIS.Env.ZERO:r.getValue("OverUnderAmt")),a=t.getValueOfDecimal(r.getValue("DiscountAmt")==null?VIS.Env.ZERO:r.getValue("DiscountAmt"));return b=="Y"?(s>0&&(s=s*-1,r.setValue("PayAmt",s),r.setValue("PaymentAmount",s)),a>0&&(a=a*-1),o>0&&(o=o*-1),h>0&&(h=h*-1,r.setValue("WriteOffAmt",h)),c>0&&(c=c*-1,r.setValue("OverUnderAmt",c))):(s<0&&(s=s*-1,r.setValue("PayAmt",s),r.setValue("PaymentAmount",s)),a<0&&(a=a*-1),o<0&&(o=o*-1),h<0&&(h=h*-1,r.setValue("WriteOffAmt",h)),c<0&&(c=c*-1,r.setValue("OverUnderAmt",c))),this.setCalloutActive(!1),""};i.prototype.SetPaySelectionScheduleAmt=function(n,i,r,u,f){if(this.isCalloutActive()||f==null)return"";this.setCalloutActive(!0);var o=r.getValue("AD_Client_ID"),s=r.getValue("C_PaySelection_ID"),h=f.toString()+","+o.toString()+","+s,e=VIS.dataContext.getJSONRecord("Pay/GetScheduleData",h);return e!=null&&(r.setValue("C_Invoice_ID",e.C_Invoice_ID),r.setValue("PayAmt",t.getValueOfDecimal(e.OpenAmt)-t.getValueOfDecimal(e.DISCOUNT1)-t.getValueOfDecimal(e.DISCOUNT2)),r.setValue("OpenAmt",e.OpenAmt),r.setValue("DiscountAmt",t.getValueOfDecimal(e.DISCOUNT1)+t.getValueOfDecimal(e.DISCOUNT2)),r.setValue("WriteOffAmt",VIS.Env.ZERO),r.setValue("IsOverUnderPayment",!1),r.setValue("PaymentRule",e.PAYMENTRULE),r.setValue("VA009_PAYMENTMETHOD_ID",e.VA009_PAYMENTMETHOD_ID),r.setValue("IsSOTrx",e.IsSOTrx),r.setValue("C_InvoicePaySchedule_ID",f)),this.setCalloutActive(!1),""};i.prototype.Amounts=function(n,i,r,u,f,e){var k,g,nt,ut,y,ot;if(this.isCalloutActive())return"";var l=2,p=u.getColumnName(),y=VIS.dataContext.getJSONRecord("MCurrency/GetCurrency",t.getValueOfDecimal(r.getValue("C_Currency_ID")));if(y!=null&&(l=t.getValueOfInt(y.StdPrecision)),k=n.getContextAsInt(i,"C_Order_ID"),g=n.getContextAsInt(i,"VA009_OrderPaySchedule_ID"),k>0||g>0){if(n.getContextAsInt(i,"C_Payment_ID")==0&&n.getContextAsInt(i,"C_BPartner_ID")==0&&k==0||(nt=r.getValue("C_Currency_ID"),nt==null))return"";this.setCalloutActive(!0);var a=VIS.Env.ZERO,s=VIS.Env.ZERO,b=0,tt=0,st="N",rt="N";k!=0&&(ut=k.toString()+","+r.getValue("DateTrx").toString()+","+g.toString(),y=VIS.dataContext.getJSONRecord("Pay/GetOpenAmt",ut),y!=null&&(b=y.C_Currency_ID,a=y.orderopen,st=y.IsSOTrx,rt=y.IsReturnTrx,a==null&&(a=VIS.Env.ZERO),s=y.OrderDiscount,tt=y.C_ConversionType_ID));this.log.fine(" Discount= "+s+", C_Order_ID="+k+", C_Currency_ID="+b);p=="PaymentAmount"&&r.setValue("PayAmt",r.getValue("PaymentAmount"));var o=t.getValueOfDecimal(r.getValue("PayAmt")==null?VIS.Env.ZERO:r.getValue("PayAmt")),c=t.getValueOfDecimal(r.getValue("WriteOffAmt")==null?VIS.Env.ZERO:r.getValue("WriteOffAmt")),h=t.getValueOfDecimal(r.getValue("OverUnderAmt")==null?VIS.Env.ZERO:r.getValue("OverUnderAmt")),v=t.getValueOfDecimal(r.getValue("DiscountAmt")==null?VIS.Env.ZERO:r.getValue("DiscountAmt"));rt=="Y"?(o>0&&(o=o*-1,r.setValue("PayAmt",o),r.setValue("PaymentAmount",o)),v>0&&(v=v*-1),s>0&&(s=s*-1),c>0&&(c=c*-1,r.setValue("WriteOffAmt",c)),h>0&&(h=h*-1,r.setValue("OverUnderAmt",h))):(o<0&&(o=o*-1,r.setValue("PayAmt",o),r.setValue("PaymentAmount",o)),v<0&&(v=v*-1),s<0&&(s=s*-1),c<0&&(c=c*-1,r.setValue("WriteOffAmt",c)),h<0&&(h=h*-1,r.setValue("OverUnderAmt",h)));this.log.fine("Pay="+o+", Discount="+v+", WriteOff="+c+", OverUnderAmt="+h);var d=t.getValueOfInt(nt),ft=r.getValue("DateTrx"),it=0,et=t.getValueOfInt(r.getValue("C_ConversionType_ID"));et!=null&&(it=et);var ht=n.getContextAsInt(i,"AD_Client_ID"),ct=n.getContextAsInt(i,"AD_Org_ID"),w=VIS.Env.ONE;if(d>0&&b>0&&d!=b||p=="C_Currency_ID"||p=="C_ConversionType_ID"){if(this.log.fine("InvCurrency="+b+", PayCurrency="+d+", Date="+ft+", Type="+it),ot=b+","+d+","+ft+","+it+","+ht+","+ct,w=VIS.dataContext.getJSONRecord("MConversionRate/GetRate",ot),w==null||w.toString()==0){if(this.setCalloutActive(!1),b==0)return"";if(r.setValue("C_Currency_ID",b),p=="C_ConversionType_ID"){if(tt==0)return"";r.setValue("C_ConversionType_ID",tt)}return"NoCurrencyConversion"}a=a*w;s=s*w;this.log.fine("Rate="+w+", OrderopenAmt="+a+", DiscountAmt="+s)}if(p=="C_Currency_ID"||p=="C_ConversionType_ID")c=c*w,r.setValue("WriteOffAmt",c.toFixed(l)),h=h*w,r.setValue("OverUnderAmt",h.toFixed(l)),v=(v*w).toFixed(l),r.setValue("DiscountAmt",v),o=a-s-c-h,r.setValue("PayAmt",o.toFixed(l)),r.setValue("PaymentAmount",o.toFixed(l)),o==a-s-c-h&&(r.setValue("DiscountAmt",VIS.Env.ZERO),r.setValue("OverUnderAmt",VIS.Env.ZERO),r.setValue("WriteOffAmt",VIS.Env.ZERO));else if(k==0)VIS.Env.ZERO!=s&&r.setValue("DiscountAmt",VIS.Env.ZERO),VIS.Env.ZERO!=c&&r.setValue("WriteOffAmt",VIS.Env.ZERO),VIS.Env.ZERO!=h&&r.setValue("OverUnderAmt",VIS.Env.ZERO);else if(p=="PayAmt"||p=="PaymentAmount"){if(r.getValue("PayAmt")>a)return r.setValue("PayAmt",a.toFixed(l)),r.setValue("PaymentAmount",a.toFixed(l)),r.setValue("DiscountAmt",VIS.Env.ZERO),r.setValue("OverUnderAmt",VIS.Env.ZERO),r.setValue("WriteOffAmt",VIS.Env.ZERO),VIS.ADialog.info("VA009_CannottIncreaseAmount"),this.setCalloutActive(!1),"";h=a-o-s-c;r.setValue("OverUnderAmt",h.toFixed(l));r.setValue("PayAmt",o.toFixed(l));r.setValue("PaymentAmount",o.toFixed(l))}else s=v,o=a-s-c-h,r.setValue("PayAmt",o.toFixed(l)),r.setValue("PaymentAmount",o.toFixed(l)),r.setValue("DiscountAmt",s.toFixed(l))}else(t.getValueOfInt(r.getValue("C_Invoice_ID"))==0||t.getValueOfInt(r.getValue("GL_JournalLine_ID"))==0||t.getValueOfInt(r.getValue("C_Order_ID"))==0)&&p=="PaymentAmount"&&(this.setCalloutActive(!0),r.setValue("PayAmt",r.getValue("PaymentAmount").toFixed(l)),r.setValue("PaymentAmount",r.getValue("PayAmt")));return n.setContext(i,"PayAmt",o),this.setCalloutActive(!1),n=i=r=u=f=e=null,""};i.prototype.Invoice=function(n,i,r,u,f){if(this.isCalloutActive()||f==null)return"";this.setCalloutActive(!0);var e=VIS.dataContext.getJSONRecord("Pay/GetSchedule",t.getValueOfInt(f));return e!=null&&r.setValue("C_InvoicePaySchedule_ID",e.C_InvoicePaySchedule_ID),this.setCalloutActive(!1),""};i.prototype.PaymentBaseType=function(n,t,i,r,u,f){return this.isCalloutActive()?"":(u.toString()=="B"?(i.setValue("VA009_PaymentMode","C"),i.getField("VA009_PaymentMode").setReadOnly(!0),i.setValue("VA009_PaymentType","S"),i.getField("VA009_PaymentType").setReadOnly(!0),i.setValue("VA009_PaymentTrigger","S"),i.getField("VA009_PaymentTrigger").setReadOnly(!0),i.setValue("VA009_PaymentRule","M"),i.getField("VA009_PaymentRule").setReadOnly(!0)):(i.setValue("VA009_PaymentMode","B"),i.getField("VA009_PaymentMode").setReadOnly(!0),i.setValue("VA009_PaymentType",null),i.getField("VA009_PaymentType").setReadOnly(!1),i.setValue("VA009_PaymentTrigger",null),i.getField("VA009_PaymentTrigger").setReadOnly(!1),i.setValue("VA009_PaymentRule",null),i.getField("VA009_PaymentRule").setReadOnly(!1)),this.setCalloutActive(!1),n=t=i=r=u=f=null,"")};i.prototype.PaymentTrigger=function(n,t,i,r,u,f){return this.isCalloutActive()?"":(u!=null&&(u.toString()=="R"?i.setValue("VA009_IsMandate","Y"):i.setValue("VA009_IsMandate","N")),this.setCalloutActive(!1),n=t=i=r=u=f=null,"")};i.prototype.DisplayBPmandate=function(n,t,i,r,u){var e;if(this.isCalloutActive()||u==null)return"";this.setCalloutActive(!0);var o=i.getValue("VA009_PaymentMethod_ID"),s=i.getValue("AD_Client_ID"),h=o.toString()+","+s.toString(),f=VIS.dataContext.getJSONRecord("Pay/GetMandate",h);f!=null&&(e=f.VA009_IsMandate,e=="Y"?i.setValue("VA009_IsBPMandate","Y"):i.setValue("VA009_IsBPMandate","N"));this.setCalloutActive(!1)};i.prototype.DisplayBPmandatePO=function(n,t,i,r,u){var e;if(this.isCalloutActive()||u==null)return"";this.setCalloutActive(!0);var o=i.getValue("VA009_PO_PaymentMethod_ID"),s=i.getValue("AD_Client_ID"),h=o.toString()+","+s.toString(),f=VIS.dataContext.getJSONRecord("Pay/GetMandate",h);f!=null&&(e=f.VA009_IsMandate,e=="Y"?i.setValue("VA009_IsBPMandate","Y"):i.setValue("VA009_IsBPMandate","N"));this.setCalloutActive(!1)};i.prototype.PaymentMethod=function(n,i,r,u,f,e){if(this.isCalloutActive()||f==null||f.toString()=="")return"";var o=VIS.dataContext.getJSONRecord("Pay/GetPaymentRule",t.getValueOfInt(f));return o!=null&&(r.setValue("VA009_PaymentRule",o.VA009_PAYMENTRULE),r.setValue("VA009_PAYMENTTRIGGER",o.VA009_PAYMENTTRIGGER)),this.setCalloutActive(!1),n=i=r=u=f=e=null,""};i.prototype.SetPaymentType=function(n,i,r,u,f,e){var o,h;if(this.isCalloutActive()||f==null||f.toString()=="")return"";if(this.setCalloutActive(!0),o=VIS.dataContext.getJSONRecord("Pay/GetPaymentRule",t.getValueOfInt(f)),h=r.getValue("C_Currency_ID"),o!=null){if(t.getValueOfInt(o.C_Currency_ID)>0&&h!=t.getValueOfInt(o.C_Currency_ID))return r.setValue("VA009_PaymentMethod_ID",null),this.setCalloutActive(!1),VIS.ADialog.info("Desired payment method does not match with price list currency"),"";var c="N",l="N",a=t.getValueOfInt(r.getValue("C_BPartner_ID")),s=VIS.dataContext.getJSONRecord("Pay/GetBPPaymentRule",a);s!=null&&(c=t.getValueOfString(s.ISVENDOR),l=t.getValueOfString(s.IsCustomer));c=="Y"?(r.setValue("PaymentRulePO",s.va009_paymentbasetypePO),l=="N"?r.setValue("PaymentRule",null):r.setValue("PaymentRule",o.VA009_PAYMENTBASETYPE)):(r.setValue("PaymentRule",o.VA009_PAYMENTBASETYPE),r.setValue("PaymentRulePO",null));r.setValue("PaymentMethod",o.VA009_PAYMENTBASETYPE)}else r.setValue("PaymentRule","T"),r.setValue("PaymentMethod","T"),r.setValue("PaymentRulePO","T");return this.setCalloutActive(!1),n=i=r=u=f=e=null,""};i.prototype.SetPaymentTypeInv=function(n,i,r,u,f,e){if(this.isCalloutActive()||f==null||f.toString()=="")return"";this.setCalloutActive(!0);var o=VIS.dataContext.getJSONRecord("Pay/GetPaymentRule",t.getValueOfInt(f)),s=r.getValue("C_Currency_ID"),h=!1;if(h=r.getValue("IsSOTrx"),o!=null){if(t.getValueOfInt(o.C_Currency_ID)>0&&s!=t.getValueOfInt(o.C_Currency_ID))return r.setValue("VA009_PaymentMethod_ID",null),this.setCalloutActive(!1),VIS.ADialog.info("Desired payment method does not match with price list currency"),"";r.setValue("PaymentRule",o.VA009_PAYMENTBASETYPE);r.setValue("PaymentMethod",o.VA009_PAYMENTBASETYPE)}else r.setValue("PaymentRule","T"),r.setValue("PaymentMethod","T"),r.setValue("PaymentRulePO","T");return this.setCalloutActive(!1),n=i=r=u=f=e=null,""};i.prototype.SetPaymentTypeOnVendor=function(n,i,r,u,f,e){var s,h,o;return this.isCalloutActive()||f==null||f.toString()==""?"":(this.setCalloutActive(!0),s=!1,h=!1,s=r.getValue("IsVendor"),h=r.getValue("IsCustomer"),o=VIS.dataContext.getJSONRecord("Pay/GetPaymentRule",t.getValueOfInt(f)),o!=null?(s?(r.setValue("PaymentRulePO",o.VA009_PAYMENTBASETYPE),h||r.setValue("PaymentRule",null)):(r.setValue("PaymentRule",o.VA009_PAYMENTBASETYPE),r.setValue("PaymentRulePO",null)),r.setValue("PaymentMethod",o.VA009_PAYMENTBASETYPE)):(r.setValue("PaymentRule","T"),r.setValue("PaymentMethod","T"),r.setValue("PaymentRulePO","T")),this.setCalloutActive(!1),n=i=r=u=f=e=null,"")};i.prototype.SetBPPaymentRuleOnPayment=function(n,i,r,u,f,e){var s,o,c,h;return this.isCalloutActive()||f==null||f.toString()==""?"":(this.setCalloutActive(!0),s=VIS.dataContext.getJSONRecord("Pay/GetBPPaymentRule",t.getValueOfInt(f)),o="A",s!=null&&(c=t.getValueOfInt(r.getValue("C_DocType_ID")),h=VIS.dataContext.getJSONRecord("Pay/GetPayBaseType",c),t.getValueOfString(s.ISVENDOR)=="N"?h!=null&&(h.DocBaseType=="ARR"&&(r.setValue("va009_paymentmethod_id",s.va009_paymentmethod_id),o=t.getValueOfString(s.va009_paymentbasetype)),h.DocBaseType=="APP"&&(r.setValue("va009_paymentmethod_id",null),o="A")):(h!=null&&(h.DocBaseType=="ARR"&&(r.setValue("va009_paymentmethod_id",null),o="A"),h.DocBaseType=="APP"&&(r.setValue("va009_paymentmethod_id",s.VA009_PO_PaymentMethod_ID),o=t.getValueOfString(s.va009_paymentbasetypePO))),t.getValueOfString(s.IsCustomer)=="Y"&&h!=null&&(h.DocBaseType=="ARR"&&(r.setValue("va009_paymentmethod_id",s.va009_paymentmethod_id),o=t.getValueOfString(s.va009_paymentbasetype)),h.DocBaseType=="APP"&&(r.setValue("va009_paymentmethod_id",s.VA009_PO_PaymentMethod_ID),o=t.getValueOfString(s.va009_paymentbasetypePO)))),o!="B"&&o!="C"&&o!="P"?o=="D"?r.setValue("TenderType","D"):o=="K"?r.setValue("TenderType","C"):o=="S"?r.setValue("TenderType","K"):o=="T"?r.setValue("TenderType","A"):o=="L"?r.setValue("TenderType","L"):r.setValue("TenderType","A"):r.setValue("va009_paymentmethod_id",null)),this.setCalloutActive(!1),n=i=r=u=f=e=null,"")};i.prototype.SetBPPaymentRule=function(n,i,r,u,f,e){if(this.isCalloutActive()||f==null||f.toString()=="")return"";this.setCalloutActive(!0);var o=VIS.dataContext.getJSONRecord("Pay/GetBPPaymentRule",t.getValueOfInt(f));return o!=null&&(t.getValueOfString(o.ISVENDOR)=="N"?r.setValue("va009_paymentmethod_id",o.va009_paymentmethod_id):r.setValue("va009_paymentmethod_id",o.VA009_PO_PaymentMethod_ID),t.getValueOfString(o.va009_paymentbasetype)!="B"&&t.getValueOfString(o.va009_paymentbasetype)!="C"&&t.getValueOfString(o.va009_paymentbasetype)!="P"?t.getValueOfString(o.va009_paymentbasetype=="D")?r.setValue("TenderType","D"):t.getValueOfString(o.va009_paymentbasetype=="K")?r.setValue("TenderType","C"):t.getValueOfString(o.va009_paymentbasetype=="S")?r.setValue("TenderType","K"):t.getValueOfString(o.va009_paymentbasetype=="T")?r.setValue("TenderType","A"):o.va009_paymentbasetype=="L"?r.setValue("TenderType","L"):r.setValue("TenderType","A"):r.setValue("va009_paymentmethod_id",null)),this.setCalloutActive(!1),n=i=r=u=f=e=null,""};i.prototype.SetInvoicePaymentRule=function(n,i,r,u,f,e){if(this.isCalloutActive()||f==null||f.toString()=="")return"";this.setCalloutActive(!0);var o=VIS.dataContext.getJSONRecord("Pay/GetInvoicePaymentRule",t.getValueOfInt(f));return o!=null&&(r.setValue("va009_paymentmethod_id",o.va009_paymentmethod_id),o.va009_paymentbasetype=="D"?r.setValue("TenderType","D"):o.va009_paymentbasetype=="K"?r.setValue("TenderType","C"):o.va009_paymentbasetype=="S"?r.setValue("TenderType","K"):o.va009_paymentbasetype=="T"?r.setValue("TenderType","A"):o.va009_paymentbasetype=="L"?r.setValue("TenderType","L"):r.setValue("TenderType","A")),this.setCalloutActive(!1),n=i=r=u=f=e=null,""};i.prototype.SetTenderType=function(n,i,r,u,f,e){var o,l;if(this.isCalloutActive()||f==null||f.toString()=="")return"";this.setCalloutActive(!0);o=VIS.dataContext.getJSONRecord("Pay/GetPaymentRule",t.getValueOfInt(f));o!=null&&(o.VA009_PAYMENTBASETYPE=="D"?r.setValue("TenderType","D"):o.VA009_PAYMENTBASETYPE=="K"?r.setValue("TenderType","C"):o.VA009_PAYMENTBASETYPE=="S"?r.setValue("TenderType","K"):o.VA009_PAYMENTBASETYPE=="T"?r.setValue("TenderType","A"):o.VA009_PAYMENTBASETYPE=="L"?r.setValue("TenderType","L"):r.setValue("TenderType","A"));t.getValueOfString(r.getValue("TenderType"))!="K"&&(r.setValue("CheckNo",""),r.setValue("CheckDate",""));var s=t.getValueOfInt(r.getValue("C_BankAccount_ID")),h=t.getValueOfInt(r.getValue("VA009_PaymentMethod_ID")),a=t.getValueOfString(r.getValue("CheckNo")),c=!1;return s>0&&h>0&&a!=""&&t.getValueOfString(r.getValue("TenderType"))=="K"&&(l=s.toString()+","+h.toString(),c=t.getValueOfBoolean(VIS.dataContext.getJSONRecord("VIS/MPayment/GetAutoCheckControl",l.toString()))),r.setValue("IsOverrideAutoCheck",c),this.setCalloutActive(!1),n=i=r=u=f=e=null,""};i.prototype.SetPayAllocateAmt=function(n,i,r,u,f,e){var l,h,o;if(this.isCalloutActive()||f==null||f.toString()=="")return"";if(this.setCalloutActive(!0),l=r.getValue("C_Payment_ID"),h=r.getValue("C_Invoice_ID"),h==null)r.setValue("Amount",VIS.Env.ZERO),r.setValue("InvoiceAmt",VIS.Env.ZERO),r.setValue("DiscountAmt",VIS.Env.ZERO),r.setValue("WriteOffAmt",VIS.Env.ZERO),r.setValue("OverUnderAmt",VIS.Env.ZERO);else if(o=VIS.dataContext.getJSONRecord("Pay/GetPayAllocateAmt",l.toString()+","+h+","+f.toString()),o!=null){var s=t.getValueOfDecimal(o.Dueamt),c=t.getValueOfDecimal(o.discount),a=o.IsReturnTrx;a=="Y"&&(s>0&&(s=s*-1),c>0&&(c=c*-1));r.setValue("Amount",s);r.setValue("InvoiceAmt",s);r.setValue("DiscountAmt",VIS.Env.ZERO);r.setValue("WriteOffAmt",VIS.Env.ZERO);r.setValue("OverUnderAmt",VIS.Env.ZERO)}return this.setCalloutActive(!1),n=i=r=u=f=e=null,""};i.prototype.OrderSchedule=function(n,i,r,u,f){var o,e;return this.isCalloutActive()||f==null?"":(this.setCalloutActive(!0),o=VIS.dataContext.getJSONRecord("Pay/GetDueAmt",t.getValueOfInt(f)),o!=null?r.setValue("VA009_OrderPaySchedule_ID",o.VA009_OrderPaySchedule_ID):(r.setValue("VA009_OrderPaySchedule_ID",null),e=VIS.dataContext.getJSONRecord("Pay/GetPaymentRule",t.getValueOfInt(r.getValue("VA009_PaymentMethod_ID"))),e!=null&&(e.VA009_PAYMENTBASETYPE=="D"?r.setValue("TenderType","D"):e.VA009_PAYMENTBASETYPE=="K"?r.setValue("TenderType","C"):e.VA009_PAYMENTBASETYPE=="S"?r.setValue("TenderType","K"):e.VA009_PAYMENTBASETYPE=="T"?r.setValue("TenderType","A"):e.VA009_PAYMENTBASETYPE=="L"?r.setValue("TenderType","L"):r.setValue("TenderType","A"))),this.setCalloutActive(!1),"")};i.prototype.BankDetails=function(n,i,r,u,f){if(this.isCalloutActive()||f==null)return"";this.setCalloutActive(!0);var e=VIS.dataContext.getJSONRecord("Pay/GetBankDetails",t.getValueOfInt(f));return e!=null&&(r.setValue("C_Location_ID",e.C_Location_ID),r.setValue("RoutingNo",e.RoutingNo)),this.setCalloutActive(!1),""};i.prototype.SetPayBaseType=function(n,i,r,u,f){if(this.isCalloutActive()||f==null)return"";this.setCalloutActive(!0);var e=VIS.dataContext.getJSONRecord("Pay/GetPayBaseType",t.getValueOfInt(f));return e!=null&&r.setValue("VA009_PayBaseType",e.DocBaseType),this.setCalloutActive(!1),""};i.prototype.ComparePayMethod=function(n,i,r,u,f){if(f==null)return"";var e=VIS.dataContext.getJSONRecord("Pay/VerifyPayMethod",t.getValueOfInt(f));return e!=null&&e==0&&r.setValue("VA009_PaymentMethod_ID",null),""};i.prototype.ClearCardFields=function(n,i,r,u,f){if(f==null)return"";var e=t.getValueOfString(r.getValue("TenderType"));return e!="C"&&(r.setValue("CreditCardType",null),r.setValue("CreditCardNumber",null),r.setValue("CreditCardExpMM",1),r.setValue("CreditCardExpYY",3)),""};i.prototype.SetBankCurrency=function(n,i,r,u,f){if(this.isCalloutActive()||f==null)return"";this.setCalloutActive(!0);var e=VIS.dataContext.getJSONRecord("Pay/GetBankCurrency",t.getValueOfInt(f));return e!=null&&r.setValue("C_Currency_ID",e.C_Currency_ID),this.setCalloutActive(!1),""};i.prototype.SetAccountName=function(n,i,r,u,f){if(this.isCalloutActive()||f==null)return"";this.setCalloutActive(!0);var e=VIS.dataContext.getJSONRecord("Pay/getaccountName",t.getValueOfInt(f));return e!=null&&(r.setValue("a_name",e.a_name),r.setValue("RoutingNo",e.RoutingNo),r.setValue("AccountNo",e.AccountNo)),this.setCalloutActive(!1),""};i.prototype.SetDateAcct=function(n,t,i,r,u){return this.isCalloutActive()||u==null?"":(this.setCalloutActive(!0),i.setValue("DateAcct",u),this.setCalloutActive(!1),"")};n.Model=n.Model||{};n.Model.VA009_CalloutPayment=i;VIS.Utility.inheritPrototype(r,VIS.CalloutEngine);r.prototype.SetPayScheduleTabDisabled=function(n,t,i,r,u){return this.isCalloutActive()||u==null||u.toString()==""?"":(this.setCalloutActive(!0),u==!0?(i.setValue("VA009_IsPayScheduleTabDisabled",!0),i.setValue("NetDay",""),i.setValue("WeekOffset","0")):i.setValue("VA009_IsPayScheduleTabDisabled",!1),this.setCalloutActive(!1),"")};r.prototype.SetPayScheduleTabDisabledForWeekDay=function(n,i,r,u,f){return this.isCalloutActive()||f==null||f.toString()==""?(r.setValue("VA009_IsPayScheduleTabDisabled",!1),""):(this.setCalloutActive(!0),t.getValueOfInt(f)>0?r.setValue("VA009_IsPayScheduleTabDisabled",!0):r.setValue("VA009_IsPayScheduleTabDisabled",!1),this.setCalloutActive(!1),"")};n.Model=n.Model||{};n.Model.VA009_CalloutPaymentTerm=r;VIS.Utility.inheritPrototype(u,VIS.CalloutEngine);u.prototype.GetOrderPaySchedule=function(n,i,r,u,e,o){var a,v;if(this.isCalloutActive())return"";if(e==null||e.toString()=="")return u.getColumnName()=="C_Order_ID"&&(this.setCalloutActive(!0),r.setValue("C_BPartner_ID",null),r.setValue("C_BPartner_Location_ID",null),r.setValue("VA009_OrderPaySchedule_ID",null),r.setValue("ConvertedAmt",VIS.Env.ZERO),r.setValue("Amount",VIS.Env.ZERO),r.setValue("DiscountAmt",VIS.Env.ZERO),r.setValue("WriteOffAmt",VIS.Env.ZERO),r.setValue("OverUnderAmt",VIS.Env.ZERO),this.setCalloutActive(!1)),"";this.setCalloutActive(!0);var h=t.getValueOfInt(e),c=0,l=0,s=null;try{s=VIS.dataContext.getJSONRecord("VA009/CashJournal/GetOrderPaySchedDetail",h.toString());s!=null&&(l=t.getValueOfInt(s.VA009_OrderPaySchedule_ID),r.setValue("VA009_OrderPaySchedule_ID",l),r.setValue("C_BPartner_ID",t.getValueOfInt(s.C_BPartner_ID)),r.setValue("C_Currency_ID",t.getValueOfInt(s.C_Currency_ID)),r.setValue("C_ConversionType_ID",t.getValueOfInt(s.C_ConversionType_ID)),r.setValue("C_BPartner_Location_ID",t.getValueOfInt(s.C_BPartner_Location_ID)),c=t.getValueOfDecimal(s.DueAmount),n.setContext(i,"VA009_IsSOTrx",s.IsSOTrx),a="Y"==s.IsSOTrx,a||(c=c*-1),v=t.getValueOfString(s.DocBaseType),v=="SOO"?r.setValue("VSS_PAYMENTTYPE","R"):r.setValue("VSS_PAYMENTTYPE","P"),r.setValue("Amount",c),r.setValue("DiscountAmt",VIS.Env.ZERO),r.setValue("WriteOffAmt",VIS.Env.ZERO))}catch(y){return s!=null&&(s=null),this.log.log(f.SEVERE,"VA009_CalloutCashJournal.GetOrderPaySchedule -"+h,y.message),this.setCalloutActive(!1),y.toString()}return h==null||h==0?(r.setValue("C_Currency_ID",null),this.setCalloutActive(!1),""):(this.setCalloutActive(!1),n=i=r=u=e=o=null,"")};u.prototype.SetAmount=function(n,i,r,u,f){var e,o;return this.isCalloutActive()?"":f==null||f.toString()==""?"":(this.setCalloutActive(!0),t.getValueOfInt(r.getValue("VA009_OrderPaySchedule_ID"))>0?(e=t.getValueOfDecimal(VIS.dataContext.getJSONRecord("VA009/CashJournal/GetPaySheduleAmt",r.getValue("VA009_OrderPaySchedule_ID").toString())),n.setContext(i,"InvTotalAmt",e.toString()),o="Y"==n.getContext(i,"VA009_IsSOTrx"),o||(e=e*-1),r.setValue("Amount",e),this.setCalloutActive(!1),""):(this.setCalloutActive(!1),""))};n.Model=n.Model||{};n.Model.VA009_CalloutCashJournal=u}(VA009,jQuery);VA009=window.VA009||{},function(n,t){n.DownloadXML=function(){function o(){f='<div style="padding: 10px; " class="VA009-tabs-wrap"> <ul class="VA009-right-tabs"> <li class="VA009-active-tab" id = VA009_DownlaodXML_'+u.windowNo+">Generate XML<\/li><\/ul> <\/div>";i.append(f)}function s(){e=i.find("#VA009_DownlaodXML_"+u.windowNo)}function h(){e.on("touchstart click",function(){c(l)})}function c(n){console.log("RecordID "+r);t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/GetXMLPath",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{FileName:"Hell",RecordID:r},success:function(t){n(t)},error:function(){VIS.ADialog.error("VA009_ErrorLoadingPayments")}})}function l(n){var i=JSON.parse(n),t;i!=""&&(t=document.createElement("a"),typeof t.download=="string"?(t.href=i,t.setAttribute("download","XMLFile"),t.name="abc",document.body.appendChild(t),t.click(),document.body.removeChild(t)):window.open(uri))}this.frame;this.windowNo;var n,u=this,i=t('<div class="VA009-assign-content">'),f,e,r=0;this.setRecordID=function(n){r=n};this.Initialize=function(){o();s();h()};this.getRoot=function(){return i}};n.DownloadXML.prototype.init=function(n,t){this.windowNo=n;this.frame=t;this.Initialize();this.frame.getContentGrid().append(this.getRoot())}}(VA009,jQuery);VA009=window.VA009||{},function(n,t){n.DownloadDATFile=function(){function c(){u='<div style="padding: 10px; " class="VA009-tabs-wrap"> <ul class="VA009-right-tabs"> <li class="VA009-active-tab" id = VA009_DownlaodXML_'+n.windowNo+">"+VIS.Msg.getMsg("VA009_GenPayFile")+"<\/li><\/ul> <\/div>";r.append(u)}function l(){f=r.find("#VA009_DownlaodXML_"+n.windowNo)}function a(){f.on("touchstart click",function(){y(e)})}function v(i,r){t.ajax({url:VIS.Application.contextUrl+"VA009/Payment/prepareDataForPaymentFile",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!0,data:{DocNumber:i,isBatch:r,AD_Org_ID:VIS.context.getWindowContext(n.windowNo,"AD_Org_ID")},success:function(n){var t,f,u;n=JSON.parse(n);for(t in n)n[t]._error!=null?(f=n[t]._error,r?VIS.ADialog.info(f+","+VIS.Msg.getMsg("BatchIsCompleted")+i):VIS.ADialog.info(f)):(u=n[t]._filename.split("."),u[u.length-1]=="txt"||u[u.length-1]=="TXT"?h("\\PaymentFiles\\"+n[t]._filename,n[t]._filename,t):s("\\PaymentFiles\\"+n[t]._filename,t))},error:function(){VIS.ADialog.error("VA009_ErrorLoadingPayments")}})}function y(r){i=VIS.context.getContext(n.windowNo,"WindowName")=="Payment"?!1:!0;t.ajax({url:VIS.Application.contextUrl+"VA009/DownloadPaymentFIle/GetDocuentNumber",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!0,data:{RecordID:r,isBatch:i,AD_Org_ID:VIS.context.getWindowContext(n.windowNo,"AD_Org_ID")},success:function(n){o=n;v(o,i)},error:function(){VIS.ADialog.error("VA009_ErrorLoadingPayments")}})}var s,h;this.frame;this.windowNo;var n=this,r=t('<div class="VA009-assign-content">'),u,f,e=0,o="",i=!1;this.setRecordID=function(n){e=n};this.Initialize=function(){c();l();a()};s=function(n,i){var r=t("<iframe>",{id:"idown_"+i,src:n}).hide().appendTo("body")};h=function(n,t){var i=document.createElement("a");i.href=n;i.setAttribute("download",t);document.body.appendChild(i);i.click();document.body.removeChild(i)};this.getRoot=function(){return r}};n.DownloadDATFile.prototype.init=function(n,t){this.windowNo=n;this.frame=t;this.Initialize();this.frame.getContentGrid().append(this.getRoot())}}(VA009,jQuery)