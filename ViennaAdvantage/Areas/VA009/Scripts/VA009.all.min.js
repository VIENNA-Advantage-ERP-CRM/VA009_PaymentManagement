/*Version 1.1.4.0*/VA009 = window.VA009 || {}, function (n, t) { n.PaymentForm = function () { function ie() { re(); ue(); fe(); k.loadOrg(); k.loadPaymentMethods(); k.loadStatus(); ae(); b = 1; ef(rr, ur, b, dr, bi, or, ui, sr, ci.val(), 99, ki, di.val(), gi.val(), of); cf = !0; kr.autocomplete({ minLength: 0, source: function (n, t) { n.term.trim().length != 0 && se(n.term, t, "GetBPName") }, select: function (n, i) { ri.indexOf(i.item.ids) == -1 && (yi.find("li").length > 0 ? (yi.append("<ul><li id=VA009_li_" + i.item.ids + '><i title="' + VIS.Msg.getMsg("VA009_Cancel") + '"  class="VA009-cross-btn vis vis-mark" id=VA009_Delimg_' + i.item.ids + "><\/i> <span>" + i.item.value + "<\/span><\/li>"), ri.push(i.item.ids), yt("cb.C_BPartner_ID", ri)) : (yi.append("<ul><li id=VA009_li_" + i.item.ids + '><i title="' + VIS.Msg.getMsg("VA009_Cancel") + '"  class="VA009-cross-btn vis vis-mark" id=VA009_Delimg_' + i.item.ids + "><\/i> <span>" + i.item.value + "<\/span><\/li>"), ri.push(i.item.ids), yt("cb.C_BPartner_ID", ri)), t(this).val(""), y.find(".VA009-payment-wrap").remove(), o.find(".VA009-right-data-main").remove(), o.find(".VA009-accordion").remove(), b = 1, g(), nt()) } }) } function g() { noPages = 1 } function re() { pt = '<div class="VA009-main-container" id="VA009-main-container_' + f.windowNo + '"> <table id="VA009_table_' + f.windowNo + '" style="width: 100%;"><tr><td id="VA009_tdLeft_' + f.windowNo + '" style="width: 200px; position: relative;"> <div class="VA009-left-part vis-leftsidebarouterwrap" id=VA009_leftpart_' + f.windowNo + ">"; _btnToggle = "<div class='VA009-left-title' ><i class='VA009-toggle-btn fa fa-bars' id='VA009_toggleImg_" + f.windowNo + "' ><\/i><\/div>"; pt += _btnToggle; pt += '<div class="VA009-left-part" style="overflow:auto;" id=VA009_leftpartdata_' + f.windowNo + ">"; pt += '<div class="VA009-left-data"><div class="vis-input-wrap"><div class="vis-control-wrap"> <select id = VA009_Org_' + f.windowNo + "> <\/select> <label>" + VIS.Msg.getMsg("VA009_Org") + '<\/label><\/div><\/div>  <div class="VA009-value-list" id= VA009_OrgdataDiv_' + f.windowNo + "> <\/div> <\/div>"; pt += '<div class="VA009-left-data"><div class="vis-input-wrap"><div class="vis-control-wrap">  <input type="text" id = VA009_BPartner_' + f.windowNo + "><label>" + VIS.Msg.getMsg("VA009_BPartner") + '<\/label> <\/div><\/div><div class="VA009-value-list" id= VA009_BPdataDiv_' + f.windowNo + ">      <\/div> <\/div>"; pt += '<div class="VA009-left-data"><div class="vis-input-wrap"><div class="vis-control-wrap"> <select id = VA009_PayMthd_' + f.windowNo + ">   <\/select><label>" + VIS.Msg.getMsg("VA009_PayMthd") + '<\/label> <\/div><\/div>  <div class="VA009-value-list" id= VA009_PayMthddataDiv_' + f.windowNo + ">      <\/div> <\/div>"; pt += '<div class="VA009-left-data"><div class="vis-input-wrap"><div class="vis-control-wrap">  <select id = VA009_Status_' + f.windowNo + ">  <\/select><label>" + VIS.Msg.getMsg("VA009_Status") + '<\/label><\/div><\/div>  <div class="VA009-value-list" id= VA009_StatusdataDiv_' + f.windowNo + ">      <\/div> <\/div>"; pt += '<div class="VA009-left-data"><div class="vis-input-wrap"><div class="vis-control-wrap">  <select id = VA009_DueDate_' + f.windowNo + '><option value=""><\/option> <option  value=0>' + VIS.Msg.getMsg("VA009_Current") + "<\/option>  <option value=7>" + VIS.Msg.getMsg("VA009_7Days") + "<\/option>  <option value=14 >" + VIS.Msg.getMsg("VA009_14Days") + "<\/option> <option value=30 >" + VIS.Msg.getMsg("VA009_30Days") + "<\/option> <option value=60 >" + VIS.Msg.getMsg("VA009_60Days") + "<\/option> <option value=90>" + VIS.Msg.getMsg("VA009_90Days") + '<\/option>" <\/select><label>' + VIS.Msg.getMsg("VA009_Duedate") + '<\/label><\/div><\/div>  <div class="VA009-value-list" id= VA009_DueDatedataDiv_' + f.windowNo + "> <\/div>  <\/div> "; pt += '<div class="VA009-left-data"><div class="vis-input-wrap"><div class="vis-control-wrap">  <select id = VA009_TransactionType_' + f.windowNo + '><option value=""><\/option> <option  value=0>' + VIS.Msg.getMsg("VA009_Order") + "<\/option>  <option value=1>" + VIS.Msg.getMsg("VA009_Invoice") + '<\/option>" <\/select><label>' + VIS.Msg.getMsg("VA009_TransactionType") + '<\/label><\/div><\/div>  <div class="VA009-value-list" id= VA009_TransactionTypeDiv_' + f.windowNo + "> <\/div>  <\/div>"; pt += '<div class="VA009-left-data"><div class="vis-input-wrap"><div class="vis-control-wrap">  <input type="date" max="9999-12-31" id="VA009_FromDate_' + f.windowNo + '"><label>' + VIS.Msg.getMsg("VA009_FromDate") + "<\/label><\/div><\/div> <\/div>"; pt += '<div class="VA009-left-data"><div class="vis-input-wrap"><div class="vis-control-wrap">  <input type="date" max="9999-12-31" id="VA009_ToDate_' + f.windowNo + '"> <label>' + VIS.Msg.getMsg("VA009_ToDate") + "<\/label><\/div><\/div><\/div> <\/div><\/div><\/td>"; et = pt; et += '<td><div class="VA009-content-area" id="VA009-content-area_' + f.windowNo + '">'; ir = '<div class="VA009-middle-wrap" id="VA009-middle-wrap_' + f.windowNo + '">'; ir += '<div class="VA009-mid-top-wrap" id="VA009-mid-top-wrap_' + f.windowNo + '"> '; ir += '<div class="VA009-tabs-wrap"> <ul class="VA009-tabs"> <li class="VA009-active-tab" id = VA009_CR_Tab_' + f.windowNo + ">" + VIS.Msg.getMsg("VA009_CR_Tab") + "<\/li> <li  id = VA009_CP_Tab_" + f.windowNo + ">" + VIS.Msg.getMsg("VA009_CP_Tab") + '<\/li><li style="display:none;" id = VA009_XML_Tab_' + f.windowNo + ">" + VIS.Msg.getMsg("VA009_GenXML_Tab") + "<\/li><\/ul><\/div>"; ir += '<div class="VA009-icons-wrap">'; ir += "<span><i class='vis vis-cheque' title='" + VIS.Msg.getMsg("VA009_Check") + "' id='VA009_Chkimg_" + f.windowNo + "' ><\/i><\/span> <span><i class='vis vis-cash-bag' title='" + VIS.Msg.getMsg("VA009_Cash") + "'  id='VA009_Cashimg_" + f.windowNo + "' ><\/i><\/span><span><i class='vis vis-open-file' title='" + VIS.Msg.getMsg("VA009_Batch") + "' id='VA009_Batchimg_" + f.windowNo + "' ><\/i><\/span><span><i class='vis vis-split' title='" + VIS.Msg.getMsg("VA009_Split") + "'  id='VA009_Splitimg_" + f.windowNo + "'><\/i><\/span><span><i class='vis vis-mobile-card' title='" + VIS.Msg.getMsg("VA009_PayMannual") + "'  id='VA009_PayMannualimg_" + f.windowNo + "'><\/i><\/span><span><i class='vis vis-bank-transfer' title='" + VIS.Msg.getMsg("VA009_BankToBankTransfer") + "'  id='VA009_BankToBankimg_" + f.windowNo + "'><\/i><\/span><\/div>"; et += ir; et += "<\/div>"; et += '  <div class="VA009-mid-search" id="VA009-mid-search_' + f.windowNo + '">'; et += ' <div class="VA009-midleftsecwrap"><div class="VA009-selectall"><input type="checkbox" id="VA009_SelectAll_' + f.windowNo + '"> <label>' + VIS.Msg.getMsg("VA009_HeaderSelectAll") + "<\/label><\/div>"; et += ' <div class="VA009-selectall VA009-total-textDiv"><label style=" font-weight: bold; text-decoration: underline; ">' + VIS.Msg.getMsg("VA009_TotlAmtBase") + ' <\/label><label id="VA009_TotalSelected_' + f.windowNo + '"" style="font-weight: bold;"> 0 <\/label><\/div><\/div>'; et += '<div class="VA009-search-wrap"> <input value="" placeholder="Search..." type="text" id=VA009_SrchTxtbx_' + f.windowNo + '> <a class="VA009-search-icon" id=VA009_SrchBtn_' + f.windowNo + '><span class="vis vis-search"><\/span><\/a> <\/div>'; et += "<\/div>"; et += ' <div class="VA009-payment-list" id = VA009_Paymntlst_' + f.windowNo + ">"; et += "<\/div>"; et += "<\/div>"; et += ' <div class="VA009-right-wrap">'; et += '<div class="VA009-rightsectopwrap"><div class="VA009-tabs-wrap"> <ul class="VA009-right-tabs"> <li class="VA009-active-tab" id=VA009_Funds_' + f.windowNo + ">" + VIS.Msg.getMsg("VA009_Bank") + "<\/li><li id=VA009_Cashbooks_" + f.windowNo + ">" + VIS.Msg.getMsg("VA009_Cashbook") + "<\/li><\/ul> <\/div>"; et += '<div class="VA009-icons-wrap"> <ul class="VA009-right-tabs"> <li class="VA009-active-tab" id = VA009_Refresh_' + f.windowNo + ">" + VIS.Msg.getMsg("VA009_Refresh") + "<\/li><\/ul> <\/div><\/div>"; et += ' <div class="VA009-right-content" id = VA009_Banklst_' + f.windowNo + ">"; et += "<\/div><\/div><\/td><\/tr><\/table>"; v.append(et) } function ue() { ot = v.find("#VA009_Org_" + f.windowNo); li = v.find("#VA009_OrgdataDiv_" + f.windowNo); ht = v.find("#VA009_PayMthd_" + f.windowNo); ai = v.find("#VA009_PayMthddataDiv_" + f.windowNo); ct = v.find("#VA009_Status_" + f.windowNo); vi = v.find("#VA009_StatusdataDiv_" + f.windowNo); au = v.find("#VA009_toggleImg_" + f.windowNo); pr = v.find("#VA009_leftpartdata_" + f.windowNo); wr = v.find("#VA009_leftpart_" + f.windowNo); y = v.find("#VA009_Paymntlst_" + f.windowNo); o = v.find("#VA009_Banklst_" + f.windowNo); ni = v.find("#VA009_CR_Tab_" + f.windowNo); pi = v.find("#VA009_CP_Tab_" + f.windowNo); gr = v.find("#VA009_XML_Tab_" + f.windowNo); _SelectedOrgDiv = v.find("#VA009_OrgdataDiv_" + f.windowNo); kr = v.find("#VA009_BPartner_" + f.windowNo); yi = v.find("#VA009_BPdataDiv_" + f.windowNo); af = v.find("#VA009_Selectedtxt_" + f.windowNo); pu = v.find("#VA009_Chkimg_" + f.windowNo); wu = v.find("#VA009_Cashimg_" + f.windowNo); bu = v.find("#VA009_Batchimg_" + f.windowNo); ku = v.find("#VA009_Splitimg_" + f.windowNo); vf = v.find("#VA009_PayMannualimg_" + f.windowNo); yf = v.find("#VA009_BankToBankimg_" + f.windowNo); pf = v.find("#VA009_table_" + f.windowNo); du = v.find("#VA009_tdLeft_" + f.windowNo); ci = v.find("#VA009_SrchTxtbx_" + f.windowNo); wf = v.find("#VA009_SrchBtn_" + f.windowNo); bt = v.find("#VA009_DueDate_" + f.windowNo); fr = v.find("#VA009_DueDatedataDiv_" + f.windowNo); wt = v.find("#VA009_TransactionType_" + f.windowNo); hr = v.find("#VA009_TransactionTypeDiv_" + f.windowNo); di = v.find("#VA009_FromDate_" + f.windowNo); gi = v.find("#VA009_ToDate_" + f.windowNo); pr.height(wr.height() - 63); it = v.find("#VA009_SelectAll_" + f.windowNo); bf = v.find("#VA009_Refresh_" + f.windowNo); lr = v.find("#VA009_Cashbooks_" + f.windowNo); ar = v.find("#VA009_Funds_" + f.windowNo); tt = v.find("#VA009_TotalSelected_" + f.windowNo) } function fe() { ot.on("change", function () { ot.val() > 0 && (li.find("li").length > 0 ? ti.indexOf(ot.val()) == -1 ? (li.find("ul").append("<li id=VA009_li_" + ot.val() + '><i title="' + VIS.Msg.getMsg("VA009_Cancel") + '" class="VA009-cross-btn vis vis-mark" id=VA009_Delimg_' + ot.val() + "><\/i><span>" + VIS.Utility.encodeText(ot.children()[ot[0].selectedIndex].text) + "<\/span><\/li>"), ti.push(ot.val()), yt("cs.AD_Org_ID", ti)) : VIS.ADialog.info("VA009_AlrdySlctd") : (li.append("<ul><li id=VA009_li_" + ot.val() + '><i title="' + VIS.Msg.getMsg("VA009_Cancel") + '" class="VA009-cross-btn vis vis-mark" id=VA009_Delimg_' + ot.val() + "><\/i> <span>" + VIS.Utility.encodeText(ot.children()[ot[0].selectedIndex].text) + "<\/span><\/li>"), ti.push(ot.val()), yt("cs.AD_Org_ID", ti))); ot.prop("selectedIndex", 0); y.find(".VA009-payment-wrap").remove(); o.find(".VA009-right-data-main").remove(); o.find(".VA009-accordion").remove(); b = 1; s = []; l = []; p = []; d = []; g(); nt() }); li.on("click", function (n) { var i, r; n.target.localName == "i" && (i = "#" + n.target.id, t(i).parent().remove(), r = n.target.id.slice(n.target.id.lastIndexOf("_") + 1, n.target.id.length), ti = jQuery.grep(ti, function (n) { return n != r }), li.find("li").length > 0 ? yt("cs.AD_Org_ID", ti) : (bi = "", li.find("ul").remove()), y.find(".VA009-payment-wrap").remove(), o.find(".VA009-right-data-main").remove(), o.find(".VA009-accordion").remove(), b = 1, s = [], l = [], p = [], d = [], g(), nt()) }); yi.on("click", function (n) { var i, r; n.target.localName == "i" && (i = "#" + n.target.id, t(i).parent().remove(), r = n.target.id.slice(n.target.id.lastIndexOf("_") + 1, n.target.id.length), ri = jQuery.grep(ri, function (n) { return n != r }), yi.find("li").length > 0 ? yt("cb.C_BPartner_ID", ri) : (sr = "", yi.find("ul").remove()), y.find(".VA009-payment-wrap").remove(), o.find(".VA009-right-data-main").remove(), o.find(".VA009-accordion").remove(), b = 1, s = [], l = [], p = [], d = [], g(), nt()) }); ht.on("change", function () { ai.find("li").length > 0 ? ei.indexOf(ht.val()) == -1 ? (ai.find("ul").append('<li ><i title="' + VIS.Msg.getMsg("VA009_Cancel") + '" class="VA009-cross-btn vis vis-mark" id=VA009_DelPayimg_' + ht.val() + "> <\/i><span>" + VIS.Utility.encodeText(ht.children()[ht[0].selectedIndex].text) + "<\/span><\/li>"), ei.push(ht.val()), yt("pm.VA009_PaymentMethod_ID", ei)) : VIS.ADialog.info("VA009_AlrdySlctd") : (ai.append("<ul id=VA009_PayMthUL_" + ht.val() + ' ><li ><i title="' + VIS.Msg.getMsg("VA009_Cancel") + '" class="VA009-cross-btn vis vis-mark" id=VA009_DelPayimg_' + ht.val() + "><\/i> <span>" + VIS.Utility.encodeText(ht.children()[ht[0].selectedIndex].text) + "<\/span><\/li> <\/ul>"), ei.push(ht.val()), yt("pm.VA009_PaymentMethod_ID", ei)); ht.prop("selectedIndex", 0); y.find(".VA009-payment-wrap").remove(); o.find(".VA009-right-data-main").remove(); o.find(".VA009-accordion").remove(); b = 1; s = []; l = []; p = []; d = []; g(); nt() }); ai.on("click", function (n) { var i, r; n.target.localName == "i" && (i = "#" + n.target.id, t(i).parent().remove(), r = n.target.id.slice(n.target.id.lastIndexOf("_") + 1, n.target.id.length), ei = jQuery.grep(ei, function (n) { return n != r }), ai.find("li").length > 0 ? yt("pm.VA009_PaymentMethod_ID", ei) : (or = "", ai.find("ul").remove()), y.find(".VA009-payment-wrap").remove(), o.find(".VA009-right-data-main").remove(), o.find(".VA009-accordion").remove(), b = 1, s = [], l = [], p = [], d = [], g(), nt()) }); ct.on("change", function () { vi.find("li").length > 0 ? oi.indexOf(ct.val()) == -1 ? (vi.find("ul").append('<li ><i title="' + VIS.Msg.getMsg("VA009_Cancel") + '" class="VA009-cross-btn vis vis-mark" id=VA009_DelStaimg_' + ct.val() + "><\/i> <span>" + VIS.Utility.encodeText(ct.children()[ct[0].selectedIndex].text) + "<\/span><\/li>"), oi.push(ct.val()), yt("cs.VA009_ExecutionStatus", oi)) : VIS.ADialog.info("VA009_AlrdySlctd") : (vi.append("<ul id=VA009_StatusUL_" + ct.val() + ' ><li ><i title="' + VIS.Msg.getMsg("VA009_Cancel") + '" class="VA009-cross-btn vis vis-mark" id=VA009_DelStaimg_' + ct.val() + "><\/i> <span>" + VIS.Utility.encodeText(ct.children()[ct[0].selectedIndex].text) + "<\/span><\/li> <\/ul>"), oi.push(ct.val()), yt("cs.VA009_ExecutionStatus", oi)); ct.prop("selectedIndex", 0); y.find(".VA009-payment-wrap").remove(); o.find(".VA009-right-data-main").remove(); o.find(".VA009-accordion").remove(); b = 1; s = []; l = []; p = []; d = []; g(); nt() }); vi.on("click", function (n) { var i, r; n.target.localName == "i" && (i = "#" + n.target.id, t(i).parent().remove(), r = n.target.id.slice(n.target.id.lastIndexOf("_") + 1, n.target.id.length), oi.splice(oi.indexOf(r), 1), vi.find("li").length > 0 ? yt("cs.VA009_ExecutionStatus", oi) : (ui = "", vi.find("ul").remove()), y.find(".VA009-payment-wrap").remove(), o.find(".VA009-right-data-main").remove(), o.find(".VA009-accordion").remove(), b = 1, s = [], l = [], p = [], d = [], g(), nt()) }); wt.on("change", function () { hr.find("li").length > 0 ? si.indexOf(wt.val()) == -1 ? (hr.find("ul").append('<li ><i title="' + VIS.Msg.getMsg("VA009_Cancel") + '" class="VA009-cross-btn vis vis-mark" id=VA009_DelStaimg_' + wt.val() + "><\/i> <span>" + VIS.Utility.encodeText(wt.children()[wt[0].selectedIndex].text) + "<\/span><\/li>"), si.push(wt.val())) : VIS.ADialog.info("VA009_AlrdySlctd") : (hr.find("ul").remove(), hr.append("<ul id=VA009_StatusUL_" + wt.val() + ' ><li ><i title="' + VIS.Msg.getMsg("VA009_Cancel") + '" class="VA009-cross-btn vis vis-mark" id=VA009_DelStaimg_' + wt.val() + "><\/i> <span>" + VIS.Utility.encodeText(wt.children()[wt[0].selectedIndex].text) + "<\/span><\/li> <\/ul>"), si.push(wt.val())); wt.prop("selectedIndex", 0); y.find(".VA009-payment-wrap").remove(); o.find(".VA009-right-data-main").remove(); o.find(".VA009-accordion").remove(); b = 1; s = []; l = []; p = []; d = []; g(); for (var n in si) n != 0 && (ki += ","), ki += "" + si[n] + ""; nt() }); hr.on("click", function (n) { var r, u, i; if (n.target.localName == "i") { r = "#" + n.target.id; t(r).parent().remove(); u = n.target.id.slice(n.target.id.lastIndexOf("_") + 1, n.target.id.length); si.splice(si.indexOf(u), 1); ki = ""; for (i in si) i != 0 && (ki += ","), ki += "" + si[i] + ""; y.find(".VA009-payment-wrap").remove(); o.find(".VA009-right-data-main").remove(); o.find(".VA009-accordion").remove(); b = 1; s = []; l = []; p = []; d = []; g(); nt() } }); di.on("blur", function () { if (Date.parse(di.val()) < 0) { VIS.ADialog.info("VA009_PlzSelectProperDate"); return } if (di.val() == "") { di.val(""); return } y.find(".VA009-payment-wrap").remove(); o.find(".VA009-right-data-main").remove(); o.find(".VA009-accordion").remove(); b = 1; s = []; l = []; p = []; d = []; g(); nt() }); gi.on("blur", function () { if (Date.parse(gi.val()) < 0) { VIS.ADialog.info("VA009_PlzSelectProperDate"); return } if (gi.val() == "") { gi.val(""); return } y.find(".VA009-payment-wrap").remove(); o.find(".VA009-right-data-main").remove(); o.find(".VA009-accordion").remove(); b = 1; s = []; l = []; p = []; d = []; g(); nt() }); y.on("scroll", ee); y.on("click", uf); au.on("click", function (n) { n.stopPropagation(); var i = du.width(); i > 50 && t(pr).hide(); du.animate({ width: i > 50 ? 40 : 200 }, 300, "swing", function () { i < 51 && t(pr).show() }) }); pu.on("click", function () { pi.hasClass("VA009-active-tab") ? s.length > 0 || l.length > 0 ? (at = 2, k.Cheque_Pay_Dialog()) : VIS.ADialog.info("VA009_PlzSelct1Pay") : ni.hasClass("VA009-active-tab") ? s.length > 0 || l.length > 0 ? (at = 1, k.Cheque_Rec_Dialog()) : VIS.ADialog.info("VA009_PlzSelct1Pay") : VIS.ADialog.info(_iscustomer + "/" + _isvendor) }); wu.on("click", function () { s.length > 0 && l.length > 0 ? VIS.ADialog.info("VA009_SelectEitherInvoiceOrOrderSchedule") : s.length > 0 || l.length > 0 ? (at = 3, k.Cash_Dialog()) : VIS.ADialog.info("VA009_PlzSelct1Pay") }); bu.on("click", function () { at = 4; k.Batch_OpenDialog() }); ku.on("click", function () { s.length > 0 || l.length > 0 ? s.length == 1 && l.length == 0 ? k.Split_Dialog() : s.length == 0 && l.length == 1 ? k.Split_Dialog() : VIS.ADialog.info("VA009_PlzSelctOnly1Pay") : VIS.ADialog.info("VA009_PlzSelct1Pay") }); vf.on("click", function () { s.length > 0 || l.length > 0 ? (at = ni.hasClass("VA009-active-tab") ? 1 : 2, k.Pay_ManualDialog()) : k.Pay_ManualDialogBP() }); yf.on("click", function () { s.length > 0 ? VIS.ADialog.info("VA009_PlzNotSelctSch") : k.B2B_Dialog() }); bt.on("change", function () { fr.find("li").length > 0 ? hi.indexOf(bt.val()) == -1 ? (fr.find("ul").append('<li ><i title="' + VIS.Msg.getMsg("VA009_Cancel") + '" class="VA009-cross-btn vis vis-mark" id=VA009_DelDueimg_' + bt.val() + "><\/i> <span>" + VIS.Utility.encodeText(bt.children()[bt[0].selectedIndex].text) + "<\/span><\/li>"), hi.push(bt.val()), yt("DueDate", hi)) : VIS.ADialog.info("VA009_AlrdySlctd") : (fr.append("<ul id=VA009_PayMthUL_" + bt.val() + ' ><li ><i title="' + VIS.Msg.getMsg("VA009_Cancel") + '" class="VA009-cross-btn vis vis-mark" id=VA009_DelDueimg_' + bt.val() + "><\/i> <span>" + VIS.Utility.encodeText(bt.children()[bt[0].selectedIndex].text) + "<\/span><\/li> <\/ul>"), hi.push(bt.val()), yt("DueDate", hi)); bt.prop("selectedIndex", 0); y.find(".VA009-payment-wrap").remove(); o.find(".VA009-right-data-main").remove(); o.find(".VA009-accordion").remove(); b = 1; s = []; l = []; p = []; d = []; g(); nt() }); fr.on("click", function (n) { var i, r; n.target.localName == "i" && (i = "#" + n.target.id, t(i).parent().remove(), r = n.target.id.slice(n.target.id.lastIndexOf("_") + 1, n.target.id.length), hi = jQuery.grep(hi, function (n) { return n != r }), fr.find("li").length > 0 ? yt("DueDate", hi) : (iu = 99, fr.find("ul").remove()), y.find(".VA009-payment-wrap").remove(), o.find(".VA009-right-data-main").remove(), o.find(".VA009-accordion").remove(), b = 1, g(), ef(rr, ur, b, dr, bi, or, ui, sr, ci.val(), iu, ki, di.val(), gi.val(), of)) }); ci.on("keypress", function (n) { n.keyCode == 13 && (y.find(".VA009-payment-wrap").remove(), o.find(".VA009-right-data-main").remove(), o.find(".VA009-accordion").remove(), b = 1, g(), nt(), ci.val("")) }); wf.on("click", function () { y.find(".VA009-payment-wrap").remove(); o.find(".VA009-right-data-main").remove(); o.find(".VA009-accordion").remove(); b = 1; g(); nt(); ci.val("") }); ni.on("click", function () { y.find(".VA009-payment-wrap").remove(); o.find(".VA009-right-data-main").remove(); o.find(".VA009-accordion").remove(); ur = "ARI"; rr = "Y"; b = 1; g(); nt(); su(ni); ff() }); pi.on("click", function () { y.find(".VA009-payment-wrap").remove(); o.find(".VA009-right-data-main").remove(); o.find(".VA009-accordion").remove(); b = 1; ur = "API"; rr = "Y"; b = 1; g(); nt(); su(pi); ff() }); gr.on("click", function () { su(gr); k.XML_Dialog() }); it.on("click", function (n) { var f = t(n.target), i, r, u; if (tt.text(0), tt.data("ttlamt", parseFloat(0)), n.target.type == "checkbox") if (f.prop("checked") == !0) { for (y.find(":checkbox").not(":disabled").prop("checked", !0), i = [], s = [], l = [], p = [], d = [], r = 0; r < tu.length; r++)i.target = t(y.find(".VA009-payment-wrap").find(".VA009-clckd-checkbx[data-uid^=" + tu[r] + "]"))[0], !i.target == !1 && (t(i.target).prop("disabled") || uf(i)); for (u = 0; u < nu.length; u++)i.target = t(y.find(".VA009-payment-wrap").find(".VA009-clckd-checkbx[data-uid^=" + nu[u] + "]"))[0], !i.target == !1 && uf(i) } else s = [], l = [], y.find(":checkbox").prop("checked", !1), it.find(":checkbox").prop("checked", !1), y.find(".VA009-payment-wrap").removeClass("VA009-payment-wrap-selctd"), tt.text(0), tt.data("ttlamt", parseFloat(0)) }); bf.on("click", function () { y.find(".VA009-payment-wrap").remove(); o.find(".VA009-right-data-main").remove(); o.find(".VA009-accordion").remove(); lr.removeClass("VA009-active-tab"); ar.addClass("VA009-active-tab"); ur = "ARI"; rr = "Y"; b = 1; g(); nt(); su(ni); ff() }); lr.on("click", function () { lr.removeClass("VA009-active-tab"); ar.removeClass("VA009-active-tab"); lr.addClass("VA009-active-tab"); o.find(".VA009-right-data-main").hide(); o.find(".VA009-accordion").hide(); wi = v.find("#VA009_cashbkdiv_" + f.windowNo); wi.show() }); ar.on("click", function () { lr.removeClass("VA009-active-tab"); ar.removeClass("VA009-active-tab"); ar.addClass("VA009-active-tab"); o.find(".VA009-right-data-main").show(); o.find(".VA009-accordion").show(); wi = v.find("#VA009_cashbkdiv_" + f.windowNo); wi.hide() }) } function su(n) { ni.removeClass("VA009-active-tab"); pi.removeClass("VA009-active-tab"); gr.removeClass("VA009-active-tab"); n.addClass("VA009-active-tab"); it.prop("checked", !1); s = []; l = []; tt.text(0); tt.data("ttlamt", parseFloat(0)) } function uf(n) { var i = t(n.target), c, v, a, o, h, u, f, e, r; if (i.hasClass("vis vis-edit")) vu = i.data("uid"), c = i.data("invoiceid"), v = i.data("transactiontype"), v == "Invoice" ? ni.hasClass("VA009-active-tab") ? yr(c, "Invoice (Customer)", "C_Invoice_ID") : yr(c, "Invoice (Vendor)", "C_Invoice_ID") : v == "Order" && (ni.hasClass("VA009-active-tab") ? yr(c, "Sales Order", "C_Order_ID") : yr(c, "Purchase Order", "C_Order_ID")), vu = 0; else if (n.target.type == "checkbox") i.prop("checked") == !0 ? (i.parents(".VA009-payment-wrap").addClass("VA009-payment-wrap-selctd"), i.data("name") == "Invoice" ? (s.push(i.data("uid")), p.push({ ID: i.data("uid"), PM: i.data() })) : (l.push(i.data("uid")), d.push({ ID: i.data("uid"), PM: i.data() })), f = s.length + l.length, e = t(y.find(".VA009-payment-wrap")).length, e == f && it.prop("checked", !0), lt = i.data("uid"), o = VIS.Utility.Util.getValueOfDecimal(tt.text()).toFixed(2), o = VIS.Utility.Util.getValueOfDecimal(tt.data("ttlamt")).toFixed(2), r = VIS.Utility.Util.getValueOfDecimal(i.data("baseamt")).toFixed(2), (i.data("docbasetype") == "ARC" || i.data("docbasetype") == "APC") && (r = -1 * r), h = VIS.Utility.Util.getValueOfDecimal(o) + VIS.Utility.Util.getValueOfDecimal(r), tt.data("ttlamt", parseFloat(h, 2)), tt.text(hu(h, 2))) : (it.prop("checked", !1), i.parents(".VA009-payment-wrap").removeClass("VA009-payment-wrap-selctd"), a = i.data("uid"), s = jQuery.grep(s, function (n) { return n != a }), l = jQuery.grep(l, function (n) { return n != a }), p = jQuery.grep(p, function (n) { return n.ID != a }), d = jQuery.grep(d, function (n) { return n.ID != a }), lt = 0, o = VIS.Utility.Util.getValueOfDecimal(tt.text()).toFixed(2), o = VIS.Utility.Util.getValueOfDecimal(tt.data("ttlamt")).toFixed(2), r = VIS.Utility.Util.getValueOfDecimal(i.data("baseamt")).toFixed(2), (i.data("docbasetype") == "ARC" || i.data("docbasetype") == "APC") && (r = -1 * r), h = VIS.Utility.Util.getValueOfDecimal(o) - VIS.Utility.Util.getValueOfDecimal(r), tt.data("ttlamt", parseFloat(h, 2)), tt.text(hu(h, 2))); else if (i.hasClass("VA009_AddNoteimg")) lt = i.data("uid"), k.ChatWindow(); else if (i.hasClass("VA009-info-icon")) infoWinID = i.data("uid"), yr(infoWinID, "Business Partner Info", "C_BPartner_ID"); else if (i.parents(".VA009-payment-wrap") && !i.is(".VA009-payment-list")) if (i.parents(".VA009-payment-wrap").find(".VA009-clckd-checkbx").prop("checked") == undefined) i.find(".VA009-clckd-checkbx").prop("checked") ? (y.find(":checkbox").not(":disabled").prop("checked", !1), y.find(".VA009-payment-wrap").removeClass("VA009-payment-wrap-selctd"), it.prop("checked", !1), s = [], l = [], p = [], d = [], tt.text(0), tt.data("ttlamt", parseFloat(0))) : (y.find(":checkbox").not(":disabled").prop("checked", !1), y.find(".VA009-payment-wrap").removeClass("VA009-payment-wrap-selctd"), i.find(".VA009-clckd-checkbx").prop("checked", !0), i.addClass("VA009-payment-wrap-selctd"), u = i.find(".VA009-clckd-checkbx")[0], lt = VIS.Utility.Util.getValueOfInt(u.dataset.uid), s = [], l = [], p = [], d = [], u.dataset.name == "Invoice" ? (s.push(lt), p.push({ ID: lt, PM: u.dataset })) : (l.push(lt), d.push({ ID: lt, PM: u.dataset })), f = s.length + l.length, e = t(y.find(".VA009-payment-wrap")).length, e == f && it.prop("checked", !0), r = VIS.Utility.Util.getValueOfDecimal(u.dataset.baseamt), (u.dataset.docbasetype == "ARC" || u.dataset.docbasetype == "APC") && (r = -1 * r), tt.data("ttlamt", parseFloat(r, 2)), tt.text(hu(r, 2))); else if (i.parents(".VA009-payment-wrap").find(".VA009-clckd-checkbx").prop("checked")) y.find(":checkbox").not(":disabled").prop("checked", !1), y.find(".VA009-payment-wrap").removeClass("VA009-payment-wrap-selctd"), it.prop("checked", !1), s = [], l = [], p = [], d = [], tt.text(0), tt.data("ttlamt", parseFloat(0)); else { if (y.find(":checkbox").not(":disabled").prop("checked", !1), y.find(".VA009-payment-wrap").removeClass("VA009-payment-wrap-selctd"), i.parents(".VA009-payment-wrap").find(".VA009-clckd-checkbx").prop("disabled") == !0) return; i.parents(".VA009-payment-wrap").find(".VA009-clckd-checkbx").prop("checked", !0); i.parents(".VA009-payment-wrap").addClass("VA009-payment-wrap-selctd"); u = i.parents(".VA009-payment-wrap").find(".VA009-clckd-checkbx")[0]; lt = VIS.Utility.Util.getValueOfInt(u.dataset.uid); s = []; l = []; p = []; d = []; u.dataset.name == "Invoice" ? (s.push(lt), p.push({ ID: lt, PM: u.dataset })) : (l.push(lt), d.push({ ID: lt, PM: u.dataset })); f = s.length + l.length; e = t(y.find(".VA009-payment-wrap")).length; e == f && it.prop("checked", !0); r = VIS.Utility.Util.getValueOfDecimal(u.dataset.baseamt); (u.dataset.docbasetype == "ARC" || u.dataset.docbasetype == "APC") && (r = -1 * r); tt.data("ttlamt", parseFloat(r, 2)); tt.text(hu(r, 2)) } } function yt(n, t) { if (n.contains("Org")) bi = " AND " + n + " IN (" + t + ")"; else if (n.contains("PaymentMethod")) or = " AND " + n + " IN (" + t + ")"; else if (n.contains("BPartner")) sr = " AND " + n + " IN (" + t + ")"; else if (n.contains("Status")) { if (t != "") { ui = " AND " + n + " IN ("; for (var i in t) ui += "'" + t[i] + "',"; ui = ui.slice(0, -1) + ")" } } else n.contains("DueDate") && (iu = Math.max.apply(Math, hi)) } function ff() { ri = []; s = []; l = []; y.find(":checkbox").prop("checked", !1); it.find(":checkbox").prop("checked", !1); p = []; d = []; tt.text(0); tt.data("ttlamt", parseFloat(0)) } function hu(n, t) { return n && typeof n == "number" && (n = parseFloat(n).toLocaleString(undefined, { minimumFractionDigits: t })), n } function tr(n, t) { function i(t) { if (t.length > 0) { n.find("option").remove(); n.append("<option value='0'><\/option>"); for (var i in t) n.append("<option value=" + VIS.Utility.Util.getValueOfInt(t[i].C_Bank_ID) + ">" + VIS.Utility.encodeText(t[i].Name) + "<\/option>"); n.prop("selectedIndex", 0) } } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadBank", { Orgs: t.toString() }, i) } function ee() { t(this).scrollTop() + t(this).innerHeight() + 5 >= this.scrollHeight && b < noPages && (b++, ti.length == 1 && (bi = ti.indexOf(VIS.context.getAD_Org_ID()) == -1 ? "" : "AND cs.AD_Org_ID IN (" + VIS.context.getAD_Org_ID() + ")"), nt()) } function kf(n, i) { h[0].style.visibility = "visible"; t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/prepareDataForPaymentFile", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: { DocNumber: n, isBatch: i }, success: function (t) { var r, u; t = JSON.parse(t); for (r in t) t[r]._error != null ? (u = t[r]._error, i ? VIS.ADialog.info(u + "," + VIS.Msg.getMsg("BatchIsCompleted") + n) : VIS.ADialog.info(u + "," + VIS.Msg.getMsg("VA009_PaymentCompletedWith") + n)) : ne("\\PaymentFiles\\" + t[r]._filename, r); h[0].style.visibility = "hidden" }, error: function () { VIS.ADialog.error("VA009_ErrorLoadingPayments"); h[0].style.visibility = "hidden" } }) } function df(n) { function u() { $xml = null; r = null } var r, i; $xml = t("<div class='VA009-popform-content' style='min-height:333px !important'>"); r = ""; r += "<div class='VA009-popform-data'><label>" + VIS.Msg.getMsg("VA009_GenXML_Tab") + "<\/label><\/div>  <div class='VA009-table-container' id='VA009_btnPopupGrid'>  <\/div> <\/div>"; $xml.append(r); i = new VIS.ChildDialog; i.setContent($xml); i.setTitle(VIS.Msg.getMsg("VA009_GenXML_Tab")); i.setWidth("60%"); i.setEnableResize(!0); i.setModal(!0); i.show(); lf = $xml.find("#VA009_btnPopupGrid"); n == "B" ? ce() : n == "M"; i.onOkClick = function () { VIS.ADialog.info("VA009_GenXML_Tab") }; i.onCancelCLick = function () { u() }; i.onClose = function () { u() } } function oe() { var n, t; try { if (n = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/GetBatchProcess", null, null), n != null) { var i = n.AD_Process_ID, r = n.Name, u = n.ClassName, e = n.EntityType; i > 0 ? (t = new VIS.ParameterDialog(f.windowNo, f), t.initDialog(i, r, e, u, !1), t.onCloseMain = function (n) { h[0].style.visibility = n ? "visible" : "hidden" }, t.showDialog(), t = null) : VIS.ADialog.info("ProcessNotFound", !0, "", "") } y.find(".VA009-payment-wrap").remove(); o.find(".VA009-right-data-main").remove(); o.find(".VA009-accordion").remove(); b = 1; s = []; l = []; p = []; d = []; g(); nt(); h[0].style.visibility = "hidden" } catch (c) { } } function se(n, i, r) { t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/" + r, dataType: "json", data: { searchText: n }, success: function (n) { var r = JSON.parse(n); datasource = []; i(t.map(r, function (n) { return { label: n.Name, value: n.Name, ids: n.C_BPartner_ID } })); t(self.div).autocomplete("search", ""); t(self.div).trigger("focus") } }) } function ef(n, i, r, u, f, e, o, s, c, l, a, v, y, p) { var w = he(); h[0].style.visibility = "visible"; cu = f + e + o + s; gf(n, i, cu); t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GetData", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: { pageNo: r, pageSize: u, whereQry: er, OrgWhr: f, SearchText: w, WhrDueDate: l, TransType: a, FromDate: v, ToDate: y }, success: function (n) { p(n) }, error: function () { VIS.ADialog.error("VA009_ErrorLoadingPayments"); h[0].style.visibility = "hidden" } }) } function of(n) { var st = 0, ht = "", e = "", i = JSON.parse(n), r, nt, a, rt, p, ft, u, pt, l, g; if (i.paymentdata.length == 0 && it.is(":checked") && it.trigger("click"), i.paymentdata.length > 0) { b == 1 && i.paymentdata.length > 0 && (paymentCount = i.paymentdata[0].paymentCount, noPages = Math.ceil(paymentCount / hf)); for (r in i.paymentdata) st = st + 1, i.paymentdata[r].TransactionType == "Invoice" ? tu.indexOf(i.paymentdata[r].C_InvoicePaySchedule_ID) === -1 ? tu.push(i.paymentdata[r].C_InvoicePaySchedule_ID) : console.log("This item already exists") : nu.indexOf(i.paymentdata[r].C_InvoicePaySchedule_ID) === -1 ? nu.push(i.paymentdata[r].C_InvoicePaySchedule_ID) : console.log("This item already exists"), i.paymentdata[r].VA009_plannedduedate != null ? (nt = new Date(i.paymentdata[r].VA009_plannedduedate), nt = nt.toLocaleDateString(), a = nt) : a = i.paymentdata[r].Systemdate, i.paymentdata[r].VA009_FollowupDate != null ? (rt = new Date(i.paymentdata[r].VA009_FollowupDate), rt = rt.toLocaleDateString(), p = rt) : p = i.paymentdata[r].Systemdate, ft = "N", i.paymentdata[r].CurrencyCode == i.paymentdata[r].BaseCurrencyCode && (ft = "Y"), ht = i.paymentdata[r].PaymwentBaseType == "S" ? "cheque-white.png" : i.paymentdata[r].PaymwentBaseType == "B" ? "cash-white.png" : "batch-white.png", e = '<div class="VA009-payment-wrap" data-UID="' + i.paymentdata[r].C_InvoicePaySchedule_ID + '"> <div class="row" data-UID="' + i.paymentdata[r].C_InvoicePaySchedule_ID + '"><div class="col-md-4 col-sm-4 width-sm-35 VA009-padd-right-0"> <input type="checkbox" class="VA009-clckd-checkbx" data-UID="' + i.paymentdata[r].C_InvoicePaySchedule_ID + '" data-BaseAmt="' + i.paymentdata[r].BaseAmt + '" data-NAME="' + i.paymentdata[r].TransactionType + '" data-PaymentRule="' + i.paymentdata[r].PaymentRule + '" data-PaymentType="' + i.paymentdata[r].PaymentType + '" data-PaymentTriggerBy="' + i.paymentdata[r].PaymentTriggerBy + '" data-PaymwentBaseType="' + i.paymentdata[r].PaymwentBaseType + '" data-DocBaseType="' + i.paymentdata[r].DocBaseType + '" data-CurrencyCode="' + i.paymentdata[r].CurrencyCode + '"  alt="' + VIS.Msg.getMsg("VA009_Select") + '" title="' + VIS.Msg.getMsg("VA009_Select") + '" ' + (i.paymentdata[r].IsHoldPayment == "Y" ? "disabled" : "") + '><div class="VA009-pay-left"><div class="VA009-pay-img-wrap"><span class=\'VA009-pay-img\'><img src=\'' + VIS.Application.contextUrl + "Areas/VA009/Images/" + ht + "' alt=''><\/span> <span class='VA009-pay-status'>" + i.paymentdata[r].VA009_ExecutionStatus + '<\/span> <\/div> <div class="VA009-pay-text"><p>' + i.paymentdata[r].C_Bpartner + "<\/p><span>" + i.paymentdata[r].C_BP_Group + "<\/span> <span>" + i.paymentdata[r].DocumentNo + "<\/span> <span>" + i.paymentdata[r].VA009_PaymentMethod + '<\/span> <\/div><\/div><\/div><div class="col-md-3 col-sm-3 width-sm-30 sm-padd VA009-padd-right-0">', p != "" && a != "" ? e += ' <div class="VA009-left-data VA009-pay-mid-sec"><span title="Due Date">' + a + '<\/span> <span class="glyphicon glyphicon-play play-icon"><\/span> <span title="Planned Due Date">' + p + "<\/span> <\/div> " : p == "" && a != "" ? e += ' <div class="VA009-left-data VA009-pay-mid-sec"><span title="Due Date">' + a + "<\/span><\/div> " : p != "" && a == "" && (e += ' <div class="VA009-left-data VA009-pay-mid-sec"><span title="Planned Due Date">' + p + "<\/span><\/div> "), e += Globalize.format(i.paymentdata[r].VA009_RecivedAmt > 0) ? ' <div class="VA009-left-data VA009-pay-mid-sec"> <span class="VA009-color-gray" title="' + (i.paymentdata[r].TransactionType == "Invoice" ? VIS.Msg.getMsg("InvoiceAmount") : VIS.Msg.getMsg("VA009_OrderAmount")) + '">' + i.paymentdata[r].CurrencyCode + " " + parseFloat(i.paymentdata[r].TotalInvAmt).toLocaleString() + ' <\/span> <br> <span class="glyphicon glyphicon-ok play-icon"><\/span> <span class="VA009-color-gray" title="' + (ur == "ARI" ? VIS.Msg.getMsg("VA009_TotRecAmt") : VIS.Msg.getMsg("VA009_TotPaidAmt")) + '">' + i.paymentdata[r].CurrencyCode + " " + parseFloat(i.paymentdata[r].VA009_RecivedAmt).toLocaleString() + " <\/span><\/div> " : ' <div class="VA009-left-data VA009-pay-mid-sec"> <span class="VA009-color-gray" title="' + (i.paymentdata[r].TransactionType == "Invoice" ? VIS.Msg.getMsg("InvoiceAmount") : VIS.Msg.getMsg("VA009_OrderAmount")) + '">' + i.paymentdata[r].CurrencyCode + " " + parseFloat(i.paymentdata[r].TotalInvAmt).toLocaleString() + " <\/span> <\/div> ", e += ' <div class="VA009-left-data VA009-pay-mid-sec"> <span data-UID="' + i.paymentdata[r].C_InvoicePaySchedule_ID + '" class="VA009_AddNote" style=" cursor: pointer;"><i class="VA009_AddNoteimg fa fa-list-alt" data-UID="' + i.paymentdata[r].C_InvoicePaySchedule_ID + '" title="' + VIS.Msg.getMsg("VA009_AddNote") + '" > <\/i><\/span> <\/div>  <div class="VA009-left-data VA009-pay-mid-sec" id="VA009-LastChat_' + f.windowNo + '"> <span class="VA009-Chatcolor-gray" id=VA009-Chatcolor-gray_' + i.paymentdata[r].C_InvoicePaySchedule_ID + ">" + i.paymentdata[r].LastChat + '<\/span> <\/div>  <\/div> <div class="col-md-2 col-sm-2 width-sm-20 sm-padd VA009-padd-right-0"><div class="VA009-transactionType"> <span>' + i.paymentdata[r].TransactionType + (i.paymentdata[r].IsHoldPayment == "Y" ? " (" + VIS.Msg.getMsg("VA009_HoldPayment") + ")" : "") + "<\/span> ", e += i.paymentdata[r].DocBaseType == "APC" || i.paymentdata[r].DocBaseType == "ARC" ? '<br><span style="text-decoration: underline;color: red;font-size: 12px;">Credit Memo<\/span> <\/div><\/div>' : " <\/div><\/div>", e += ' <div class="col-md-3 col-sm-3">  <div class="VA009-right-part"><span class="vis vis-edit" data-UID="' + i.paymentdata[r].C_InvoicePaySchedule_ID + '" data-InvoiceID="' + i.paymentdata[r].C_Invoice_ID + '" data-TransactionType ="' + i.paymentdata[r].TransactionType + '" data-IsHoldPayment ="' + i.paymentdata[r].IsHoldPayment + '"  alt="' + VIS.Msg.getMsg("VA009_Edit") + '" title="' + VIS.Msg.getMsg("VA009_Edit") + '"><\/span> <span class="VA009-info-icon vis vis-info" data-UID="' + i.paymentdata[r].C_BPartner_ID + '" alt="' + VIS.Msg.getMsg("VA009_Info") + '" title="' + VIS.Msg.getMsg("VA009_Info") + '"><\/span><div class="VA009-pay-amount" id=VA009_ConvertedAmt_' + f.windowNo + "_" + i.paymentdata[r].C_InvoicePaySchedule_ID + '> <span title="Amount Due">' + i.paymentdata[r].CurrencyCode + " " + parseFloat(i.paymentdata[r].DueAmt).toLocaleString() + "<\/span><br> <\/div> <\/div> <\/div><\/div><\/div>", y.append(e), ft == "N" && (lu = v.find("#VA009_ConvertedAmt_" + f.windowNo + "_" + i.paymentdata[r].C_InvoicePaySchedule_ID), lu.append('<span class="VA009-color-gray" title="Amount Due">' + i.paymentdata[r].BaseCurrencyCode + " " + parseFloat(i.paymentdata[r].convertedAmt).toLocaleString() + "<\/span> ")); it.is(":checked") && (it.prop("checked", !1), it.trigger("click")) } if (i.bankdetails.length > 0) { o.find(".VA009-right-data-main").remove(); o.find(".VA009-accordion").remove(); var wt = 0, ct = "", lt, et = 0, ot = 0, k = [], s = [], d = [], at, w, vt, c = "pull-right VA009-color-green", ut = "pull-right VA009-color-green", bt = "VA009-color-green", yt = t('<div class="VA009-accordion"><\/div>'); for (u in i.bankdetails) i.bankdetails[u].CurrentBalance < 0 && (c = "pull-right VA009-color-red"), i.bankdetails[u].UnreconsiledAmt < 0 && (ut = "pull-right VA009-color-red"), ct == i.bankdetails[u].CurrencyCode1 ? (vt = o.find("#VA009_bankdtl_" + i.bankdetails[u].CurrencyCode1), lt = '<span class="pull-head"> ' + i.bankdetails[u].BankName + " " + i.bankdetails[u].BankAccountNumber + '<\/span> <p style="margin-bottom: 0;">' + VIS.Msg.getMsg("VA009_Reconciled") + ' <span class="' + c + '">' + i.bankdetails[u].CurrencyCode1 + " " + parseFloat(i.bankdetails[u].CurrentBalance).toLocaleString() + "<\/span><\/p> <p>" + VIS.Msg.getMsg("VA009_Unreconciled") + ' <a class="' + ut + '">' + i.bankdetails[u].CurrencyCode1 + " " + parseFloat(i.bankdetails[u].UnreconsiledAmt).toLocaleString() + "<\/a><\/p>", vt.append(lt), et = et + i.bankdetails[u].CurrentBalance, ot = ot + i.bankdetails[u].UnreconsiledAmt) : (at = '<div class="panel-group" id="accordion_' + i.bankdetails[u].CurrencyCode1 + '" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><div class="panel-heading" role="tab" id="headingOne_' + i.bankdetails[u].CurrencyCode1 + '"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#accordion_' + i.bankdetails[u].CurrencyCode1 + '" href="#collapseOne_' + i.bankdetails[u].CurrencyCode1 + '" aria-expanded="true" aria-controls="collapseOne" class="VA009-Accordion-head" id=VA009_TotalAmtCurr_' + i.bankdetails[u].CurrencyCode1 + '><\/a><\/h4><\/div><div id="collapseOne_' + i.bankdetails[u].CurrencyCode1 + '" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne" style="height: auto;"><div class="panel-body" id=VA009_bankdtl_' + i.bankdetails[u].CurrencyCode1 + '><span class="pull-head"> ' + i.bankdetails[u].BankName + " " + i.bankdetails[u].BankAccountNumber + '<\/span><p style="margin-bottom: 0;">' + VIS.Msg.getMsg("VA009_Reconciled") + ' <span class="' + c + '">' + i.bankdetails[u].CurrencyCode1 + " " + parseFloat(i.bankdetails[u].CurrentBalance).toLocaleString() + "<\/span><\/p> <p>" + VIS.Msg.getMsg("VA009_Unreconciled") + ' <a class="' + ut + '">' + i.bankdetails[u].CurrencyCode1 + " " + parseFloat(i.bankdetails[u].UnreconsiledAmt).toLocaleString() + "<\/a><\/p> <\/div><\/div><\/div> <\/div>", yt.append(at), o.append(yt), et += i.bankdetails[u].CurrentBalance, ot += i.bankdetails[u].UnreconsiledAmt), s.indexOf(i.bankdetails[u].CurrencyCode1) == -1 ? (s.push(i.bankdetails[u].CurrencyCode1), w = s.indexOf(i.bankdetails[u].CurrencyCode1), k[w] = 0, d[w] = 0) : w = s.indexOf(i.bankdetails[u].CurrencyCode1), k[w] = parseFloat(k[w]) + parseFloat(i.bankdetails[u].CurrentBalance), d[w] = parseFloat(d[w]) + parseFloat(i.bankdetails[u].UnreconsiledAmt), wt = i.bankdetails[u].C_Bank_ID, ct = i.bankdetails[u].CurrencyCode1, c = "pull-right VA009-color-green", ut = "pull-right VA009-color-green"; for (l in s) pt = o.find("#VA009_TotalAmtCurr_" + s[l]), c = k[l] < 0 ? "VA009-color-red" : "VA009-color-green", bt = d[l] < 0 ? "VA009-color-red" : "VA009-color-green", pt.append('<div class="VA009-panel-head-total"> <div><span class="VA009-head-currency-name">' + s[l] + '<\/span><span><i class="glyphicon glyphicon-chevron-down pull-right"><\/i><\/span><\/div><p>' + VIS.Msg.getMsg("VA009_Reconciled") + ' <span class="' + c + '">' + s[l] + " " + parseFloat(k[l]).toLocaleString() + " <\/span><\/p> <p>" + VIS.Msg.getMsg("VA009_Unreconciled") + ' <a class="VA009-color-green">' + s[l] + " " + parseFloat(d[l]).toLocaleString() + "<\/a><\/p><\/div>"); o.append("<\/div><\/div>") } else o.find(".VA009-right-data-main").remove(), o.find(".VA009-accordion").remove(); if (i.Cbk.length > 0) { o.append(' <div class="VA009-right-data-main" style="display: none;" id=VA009_cashbkdiv_' + f.windowNo + "> <\/div>"); wi = v.find("#VA009_cashbkdiv_" + f.windowNo); wi.append(" <h5>" + VIS.Msg.getMsg("VA009_Cashbook") + "<\/h5> "); for (g in i.Cbk) i.Cbk[g].Csb_Amt < 0 && (c = "pull-right VA009-color-red"), wi.append('<div class="VA009-right-data">  <p class="VA009-data-top">  <span class="pull-left"> ' + i.Cbk[g].CashBookName + '<\/span> <span class="' + c + '">' + i.Cbk[g].CBCurrencyCode + " " + parseFloat(i.Cbk[g].Csb_Amt).toLocaleString() + "<\/span>  <\/p>  <\/div>"), c = "pull-right VA009-color-green" } kr.val(""); it.is(":checked") || (tt.text(0), tt.data("ttlamt", parseFloat(0))); h[0].style.visibility = "hidden" } function he() { var t = br.isDecimalSeparatorDot(window.navigator.language), n = ci.val(); return n == "" || t || n.contains("=") || n.contains(",") && (n = n.replace(",", ".")), n } function ce() { h[0].style.visibility = "visible"; t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GetPaymentScheduleBatch", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: { FileName: "Hell", RecordID: 1221 }, success: function (n) { n = JSON.parse(n); le(n) }, error: function () { VIS.ADialog.error("VA009_ErrorLoadingPayments"); h[0].style.visibility = "hidden" } }) } function le(n) { var i, r, t; if (h[0].style.visibility = "hidden", console.log(n.result), console.log(n), n.result) for (r = "", t = 0; t < n.result.length; t++)i = '<div class="VA009-payment-wrap" data-UID="' + n.result[t].DocumentNo + '"> <div class="row" data-UID="' + n.result[t].DocumentNo + '"><div class="col-md-4 col-sm-4 width-sm-35"> <input type="checkbox" class="VA009-clckd-checkbx" data-UID="' + n.result[t].DocumentNo + '" data-BaseAmt="' + n.paymentdata[t].BaseAmt + '"  data-NAME="' + n.result[t].DocumentNo + '" data-PaymentRule="' + n.result[t].PaymentRule + '" data-PaymentType="' + n.result[t].PaymentType + '" data-PaymentTriggerBy="' + n.result[t].PaymentTriggerBy + '" data-PaymwentBaseType="' + n.result[t].PaymwentBaseType + '" data-DocBaseType="' + n.result[t].DocBaseType + '" data-CurrencyCode="' + n.result[t].CurrencyCode + '"  alt="' + VIS.Msg.getMsg("VA009_Select") + '" title="' + VIS.Msg.getMsg("VA009_Select") + '"><div class="VA009-pay-left"><div class="VA009-pay-img-wrap"><span class=\'VA009-pay-img\'><img src=\'' + VIS.Application.contextUrl + "Areas/VA009/Images/" + r + "' alt=''><\/span> <span class='VA009-pay-status'>" + n.result[t].VA009_ExecutionStatus + '<\/span> <\/div> <div class="VA009-pay-text"><p>' + n.result[t].C_Bpartner + "<\/p><span>" + n.result[t].C_BP_Group + "<\/span> <span>" + n.result[t].DocumentNo + "<\/span> <span>" + n.result[t].PaymentMethod + '<\/span> <\/div><\/div><\/div><div class="col-md-3 col-sm-3 width-sm-30 sm-padd VA009-padd-right-0">', n.result[t].VA009_DocumentDate != "" && (i += ' <div class="VA009-left-data VA009-pay-mid-sec"><span title="Due Date">' + n.result[t].VA009_DocumentDate + "<\/span> <\/div> "), i += Globalize.format(n.result[t].VA009_RecivedAmt > 0) ? ' <div class="VA009-left-data VA009-pay-mid-sec"> <span class="VA009-color-gray" title="Invoice Amount">' + n.result[t].ISO_CODE + " " + Globalize.format(n.result[t].VA009_ConvertedAmt, "N") + ' <\/span> <br> <span class="glyphicon glyphicon-ok play-icon"><\/span> <span class="VA009-color-gray" title="Total Recieved Amount">' + n.result[t].CurrencyCode + " " + Globalize.format(n.result[t].VA009_RecivedAmt, "N") + " <\/span><\/div> " : ' <div class="VA009-left-data VA009-pay-mid-sec"> <span class="VA009-color-gray" title="Invoice Amount">' + n.result[t].ISO_CODE + " " + Globalize.format(n.result[t].VA009_ConvertedAmt, "N") + " <\/span> <\/div> ", i += ' <div class="VA009-left-data VA009-pay-mid-sec"> <span data-UID="' + n.result[t].DocumentNo + '" class="VA009_AddNote" style=" cursor: pointer;"><img class="VA009_AddNoteimg" data-UID="' + n.result[t].DocumentNo + '" alt="' + VIS.Msg.getMsg("VA009_AddNote") + '" title="' + VIS.Msg.getMsg("VA009_AddNote") + '" src="' + VIS.Application.contextUrl + 'Areas/VA009/Images/add-note.png"> <\/img><\/span> <\/div>  <div class="VA009-left-data VA009-pay-mid-sec" id="VA009-LastChat_' + f.windowNo + '"> <span class="VA009-Chatcolor-gray" id=VA009-Chatcolor-gray_' + n.result[t].DocumentNo + ">" + n.result[t].LastChat + '<\/span> <\/div>  <\/div> <div class="col-md-2 col-sm-2 width-sm-20 sm-padd VA009-padd-right-0"><div class="VA009-transactionType"> <span>' + n.result[t].TransactionType + "<\/span> ", i += n.result[t].DocBaseType == "APC" || n.result[t].DocBaseType == "ARC" ? '<br><span style="text-decoration: underline;color: red;font-size: 12px;">Credit Memo<\/span> <\/div><\/div>' : " <\/div><\/div>", i += ' <div class="col-md-3 col-sm-3">  <div class="VA009-right-part"><span class="vis vis-edit" data-UID="' + n.result[t].DocumentNo + '" data-InvoiceID="' + n.result[t].C_Invoice_ID + '" data-TransactionType ="' + n.result[t].TransactionType + '" alt="' + VIS.Msg.getMsg("VA009_Edit") + '" title="' + VIS.Msg.getMsg("VA009_Edit") + '"><\/span> <span class="VA009-info-icon vis vis-info" data-UID="' + n.result[t].C_BPartner_ID + '" alt="' + VIS.Msg.getMsg("VA009_Info") + '" title="' + VIS.Msg.getMsg("VA009_Info") + '"><\/span><div class="VA009-pay-amount" id=VA009_ConvertedAmt_' + f.windowNo + "_" + n.result[t].DocumentNo + '> <span title="Amount Due">' + n.result[t].ISO_CODE + " " + Globalize.format(n.result[t].VA009_ConvertedAmt, "N") + "<\/span><br> <\/div> <\/div> <\/div><\/div><\/div>", lf.append(i) } function ae() { h = t('<div class="vis-busyindicatorouterwrap va012-busy-bank-statement" ><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); h[0].style.visibility = "visible"; v.append(h) } function nt() { ef(rr, ur, b, dr, bi, or, ui, sr, ci.val(), iu, ki, di.val(), gi.val(), of) } function gt(n, t) { var u = !1, r, i; if (n == undefined) return t; if (n.value_new = VIS.Utility.Util.getValueOfString(t), n.value_new.contains(".")) { for (u = !0, r = [], i = 0; i < n.value_new.length; i++)n.value_new[i] === "." && r.push(i); r.length > 1 && (n.value_new = sf(n.value_new, ".")) } if (n.value_new.contains(",")) if (u) n.value_new = sf(n.value_new, ","); else { for (r = [], i = 0; i < n.value_new.length; i++)n.value_new[i] === "," && r.push(i); n.value_new = r.length > 1 ? sf(n.value_new, ",") : n.value_new.replace(",", ".") } return n.value_new == "" && (n.value_new = "0"), n.value_new } function sf(n, t) { var i = n.split(t); return n = i.slice(0, -1).join("") + "." + i.slice(-1), n.indexOf(".") == n.length - 1 && (n = n.replace(".", "")), n } var k, yr, gf, ne; this.frame; this.windowNo; var f = this, v = t('<div class="VA009-assign-content">'), et, pt, ir, cu = "", te, lu; Orgname = ""; var rr = "Y", ur = "ARI", ot, li, ht, ai, ct, vi, au, pr, wr, y, kr, yi, o, b = 1, dr = 20, hf = 20, ni, pi, gr, vu = 0, cf = !1, er = "", wi, ti = [], ri = [], s = [], nu = [], tu = [], ei = [], oi = [], bi = "", or = "", sr = "", ui = "", ki = "", si = [], wt, hr, di, gi, l = [], p = [], d = [], lf = null, nr = "", af, yu, pu, wu, bu, ku, vf, yf, pf, du, w = [], hi = [], cr = [], gu = "", iu = 99, ut = [], n, r, u, c, a, ve = t(window).height(), lt = 0, nf = 0, h = null, ci, wf, bt, fr, tt = null, ii = null, fi = null, ru = null, kt = null, uu = null, st = null, it = null, bf = null, lr = null, ar = null, e = null, rt = null, ft = null, dt = 0, fu = "M", br = new VIS.CultureSeparator, vr = VIS.DisplayType.GetNumberFormat(VIS.DisplayType.Amount), vt = VIS.Env.isDecimalPoint(), at = 1, tf = null, eu = null, ou = null, rf = !1; this.Initialize = function () { ie() }; k = { LoadTargetDocType: function (n, t) { function r(t) { if (n.append(" <option value = 0><\/option>"), t != null && t.length > 0) for (var i in t) n.append("<option value=" + VIS.Utility.Util.getValueOfInt(t[i].C_DocType_ID) + ">" + VIS.Utility.encodeText(t[i].Name) + "<\/option>"); n.prop("selectedIndex", 0); n.addClass("vis-ev-col-mandatory") } n.empty(); var i = $POP_cmbOrg != null ? $POP_cmbOrg.val() : 0; VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadTargetType", { ad_org_Id: i, baseType: t }, r) }, LoadTargetDocTypeB2B: function (n, t, i) { function r(t) { if (n.append(" <option value = 0><\/option>"), t != null && t.length > 0) for (var i in t) n.append("<option value=" + VIS.Utility.Util.getValueOfInt(t[i].C_DocType_ID) + ">" + VIS.Utility.encodeText(t[i].Name) + "<\/option>"); n.prop("selectedIndex", 0); n.addClass("vis-ev-col-mandatory") } n.empty(); i == 0 ? (_org_Id = $OrgCmb != null ? $OrgCmb.val() : 0, VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadTargetType", { ad_org_Id: _org_Id, baseType: t }, r)) : VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadBankTargetType", { BankAcct_ID: i, BaseType: t }, r) }, loadOrg: function () { function n(n) { var t; if (ot.append(" <option value = 0><\/option>"), n.length > 0) for (t in n) ot.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].AD_Org_ID) + ">" + VIS.Utility.encodeText(n[t].Name) + "<\/option>"); ot.prop("selectedIndex", 0) } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadOrganization", null, n) }, loadPaymentMethods: function () { function n(n) { if (n != null) { if (ht.append(" <option value = 0><\/option>"), n.length > 0) for (var t in n) ht.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].VA009_PaymentMethod_ID) + ">" + VIS.Utility.encodeText(n[t].VA009_Name) + "<\/option>"); ht.prop("selectedIndex", 0) } } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadPaymentMethod", null, n) }, loadStatus: function () { function n(n) { if (n != null) { if (ct.append(" <option value = 0><\/option>"), n.length > 0) for (var t in n) ct.append("<option value=" + n[t].Value + ">" + VIS.Utility.encodeText(n[t].Name) + "<\/option>"); ct.prop("selectedIndex", 0) } } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadStatus", null, n) }, Cheque_Pay_Dialog: function () { function ct(n) { n != "" ? (h[0].style.visibility = "hidden", VIS.ADialog.info("VA009_PleaseSelctonlyCheque")) : (ii.show(), tr($POP_cmbBank, VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())), $POP_cmbBank.addClass("vis-ev-col-mandatory"), $POP_cmbBankAccount.addClass("vis-ev-col-mandatory"), e.val() ? e.removeClass("vis-ev-col-mandatory") : e.addClass("vis-ev-col-mandatory"), lt(), wt(bt), kt(), ot(), pt(), k.LoadTargetDocType($POP_targetDocType, at)) } function lt() { var n = []; n.length == 0 && (n.push({ field: "C_Bpartner", caption: VIS.Msg.getMsg("VA009_Vendor"), sortable: !0, size: "12%" }), n.push({ field: "C_InvoicePaySchedule_ID", caption: VIS.Msg.getMsg("VA009_Schedule"), sortable: !0, size: "7%" }), n.push({ field: "Description", caption: VIS.Msg.getMsg("Description"), sortable: !0, size: "15%", editable: { type: "text" } }), n.push({ field: "CurrencyCode", caption: VIS.Msg.getMsg("VA009_Currency"), sortable: !0, size: "8%" }), n.push({ field: "DueAmt", caption: VIS.Msg.getMsg("VA009_DueAmt"), sortable: !0, size: "12%", style: "text-align: right", render: function (n) { var t = n.DueAmt; return parseFloat(t).toLocaleString() } }), n.push({ field: "ConvertedAmt", caption: VIS.Msg.getMsg("VA009_ConvertedAmt"), sortable: !0, size: "12%", style: "text-align: right", render: function (n) { var t = n.ConvertedAmt; return parseFloat(t).toLocaleString() } }), n.push({ field: "VA009_RecivedAmt", caption: VIS.Msg.getMsg("VA009_PayAmt"), sortable: !0, size: "12%", style: "text-align: right", render: function (n) { var t = n.VA009_RecivedAmt; return t = gt(event, t, t), parseFloat(t).toLocaleString() }, editable: { type: "number" } }), n.push({ field: "OverUnder", caption: VIS.Msg.getMsg("VA009_OverUnder"), sortable: !0, size: "8%", style: "text-align: right", render: function (n) { var t = n.OverUnder; return parseFloat(t).toLocaleString() } }), n.push({ field: "Writeoff", caption: VIS.Msg.getMsg("VA009_Writeoff"), sortable: !0, size: "8%", style: "text-align: right", render: function (n) { var t = n.Writeoff; return t = gt(event, t, t), parseFloat(t).toLocaleString() }, editable: { type: "number" } }), n.push({ field: "Discount", caption: VIS.Msg.getMsg("VA009_Discount"), sortable: !0, size: "8%", style: "text-align: right", render: function (n) { var t = n.Discount; return t = gt(event, t, t), parseFloat(t).toLocaleString() }, editable: { type: "number" } }), n.push({ field: "CheckNumber", caption: VIS.Msg.getMsg("VA009_ChkNo"), sortable: !0, size: "12%", render: function (n) { return n.changes != undefined && event.currentTarget.id != undefined ? event.currentTarget.id == $POPtxtCheckNumber.toArray()[0].id ? r.records.length == 1 ? (n.changes.CheckNumber = n.CheckNumber, n.CheckNumber) : n.changes.CheckNumber == "" || n.changes.CheckNumber == 0 ? (n.changes.CheckNumber = n.CheckNumber, n.CheckNumber) : n.changes.CheckNumber : n.changes.CheckNumber : n.CheckNumber }, editable: { type: "alphanumeric", autoFormat: !0, groupSymbol: " " } }), n.push({ field: "CheckDate", caption: VIS.Msg.getMsg("VA009_CheckDate"), sortable: !0, size: "10%", style: "text-align: left", render: function (n) { var t; return t = n.changes == undefined || n.changes.CheckDate == "" ? n.CheckDate : n.changes.CheckDate, new Date(t).toLocaleDateString() }, editable: { type: "date" } }), n.push({ field: "recid", caption: VIS.Msg.getMsg("VA009_srno"), sortable: !0, size: "1%" }), n.push({ field: "TransactionType", caption: VIS.Msg.getMsg("VA009_TransactionType"), sortable: !0, size: "1%" })); r = null; r = uu.w2grid({ name: "CheuePaybleGrid_" + f.windowNo, recordHeight: 25, columns: n, multiSelect: !0, onEditField: function (n) { n.column == 6 || n.column == 8 || n.column == 9 ? r.get(n.recid).TransactionType == "Order" && (n.isCancelled = !0) : $POp_cmbPaySelectn.val() == "P" && (n.isCancelled = !0); n.onComplete = function (n) { if (id = n.recid, n.column == 6 || n.column == 8 || n.column == 9) { r.records[n.index][r.columns[n.column].field] = gt(n, r.records[n.index][r.columns[n.column].field]); var u = i.GetFormatAmount(r.records[n.index][r.columns[n.column].field], "init", vt); r.records[n.index][r.columns[n.column].field] = i.GetConvertedString(u, vt); t("#grid_CheuePaybleGrid_" + f.windowNo + "_edit_" + id + "_" + n.column).keydown(function (n) { var t = br.isDecimalSeparatorDot(window.navigator.language); if (t || n.keyCode != 190 && n.keyCode != 110) { if (t && n.keyCode == 188) return !1 } else return !1; return n.target.value.contains(".") && (n.which == 110 || n.which == 190 || n.which == 188) && (this.value = this.value.replace(".", "")), n.target.value.contains(",") && (n.which == 110 || n.which == 190 || n.which == 188) && (this.value = this.value.replace(",", "")), n.keyCode != 8 && n.keyCode != 9 && (n.keyCode < 37 || n.keyCode > 40) && (n.keyCode < 48 || n.keyCode > 57) && (n.keyCode < 96 || n.keyCode > 105) && n.keyCode != 109 && n.keyCode != 189 && n.keyCode != 110 && n.keyCode != 144 && n.keyCode != 188 && n.keyCode != 190 ? !1 : void 0 }) } } }, onChange: function (n) { window.setTimeout(function () { if (r.getChanges(n.recid) != undefined) { var t = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/GetCurrencyPrecision", { BankAccount_ID: VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val()), CurrencyFrom: "B" }, null); if ((t == null || t == 0) && (t = 2), r.records[n.index].ConvertedAmt = parseFloat(r.records[n.index].ConvertedAmt), r.records[n.index].VA009_RecivedAmt = parseFloat(r.records[n.index].VA009_RecivedAmt), r.records[n.index].OverUnder = parseFloat(r.records[n.index].OverUnder), r.records[n.index].Writeoff = parseFloat(r.records[n.index].Writeoff), r.records[n.index].Discount = parseFloat(r.records[n.index].Discount), n.column == 6) { if (n.value_new = n.value_new == "" ? 0 : i.GetConvertedNumber(n.value_new, vt), n.value_new > r.records[n.index].ConvertedAmt) { VIS.ADialog.error("MoreScheduleAmount"); n.value_new = n.value_original; r.get(n.recid).changes.VA009_RecivedAmt = n.value_new; r.get(n.recid).VA009_RecivedAmt = n.value_new; r.refreshCell(n.recid, "VA009_RecivedAmt"); return } r.records[n.index].VA009_RecivedAmt = n.value_new.toFixed(t); r.refreshCell(n.recid, "VA009_RecivedAmt"); (r.records[n.index].PaymwentBaseType == "ARR" || r.records[n.index].PaymwentBaseType == "APP") && (n.value_new < r.records[n.index].ConvertedAmt ? (r.records[n.index].ConvertedAmt < 0 ? r.get(n.recid).TransactionType == "Order" ? (r.get(n.recid).changes.Discount = r.records[n.index].ConvertedAmt - n.value_new, r.get(n.recid).Discount = r.get(n.recid).changes.Discount.toFixed(t), r.get(n.recid).changes.Writeoff = 0, r.get(n.recid).Writeoff = 0, r.get(n.recid).changes.OverUnder = 0, r.get(n.recid).OverUnder = 0) : (r.get(n.recid).changes.OverUnder = r.records[n.index].ConvertedAmt - n.value_new, r.get(n.recid).OverUnder = r.get(n.recid).changes.OverUnder.toFixed(t), r.get(n.recid).changes.Writeoff = 0, r.get(n.recid).changes.Discount = 0) : r.get(n.recid).TransactionType == "Order" ? (r.get(n.recid).changes.Discount = (r.records[n.index].ConvertedAmt - n.value_new).toFixed(t), r.records[n.index].Discount = r.get(n.recid).changes.Discount, r.get(n.recid).changes.Writeoff = 0, r.get(n.recid).Writeoff = 0, r.get(n.recid).changes.OverUnder = 0, r.get(n.recid).OverUnder = 0) : (r.get(n.recid).changes.OverUnder = (r.records[n.index].ConvertedAmt - n.value_new).toFixed(t), r.records[n.index].OverUnder = r.get(n.recid).changes.OverUnder, r.get(n.recid).changes.Writeoff = 0, r.get(n.recid).Writeoff = 0, r.get(n.recid).changes.Discount = 0), r.refreshCell(n.recid, "OverUnder"), r.refreshCell(n.recid, "Discount"), r.refreshCell(n.recid, "Writeoff")) : n.value_new == r.records[n.index].ConvertedAmt ? (r.get(n.recid).changes.OverUnder = 0, r.get(n.recid).OverUnder = 0, r.get(n.recid).changes.Discount = 0, r.get(n.recid).changes.Writeoff = 0, r.get(n.recid).Discount = 0, r.get(n.recid).Writeoff = 0, r.get(n.recid).changes.VA009_RecivedAmt = n.value_new, r.get(n.recid).VA009_RecivedAmt = n.value_new, r.refreshCell(n.recid, "OverUnder"), r.refreshCell(n.recid, "Discount"), r.refreshCell(n.recid, "Writeoff"), r.refreshCell(n.recid, "VA009_RecivedAmt")) : n.value_new > r.records[n.index].ConvertedAmt && (r.records[n.index].ConvertedAmt < 0 ? (r.get(n.recid).changes.OverUnder = 0, r.get(n.recid).OverUnder = 0, r.get(n.recid).changes.Writeoff = (r.records[n.index].ConvertedAmt - n.value_new).toFixed(t), r.get(n.recid).Writeoff = VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.Writeoff)) : (r.get(n.recid).changes.OverUnder = r.records[n.index].ConvertedAmt - n.value_new, r.records[n.index].OverUnder = r.get(n.recid).changes.OverUnder, r.get(n.recid).changes.Writeoff = 0, r.get(n.recid).Writeoff = 0), r.get(n.recid).changes.Discount = 0, r.get(n.recid).Discount = 0, r.refreshCell(n.recid, "OverUnder"), r.refreshCell(n.recid, "Discount"), r.refreshCell(n.recid, "Writeoff"))) } n.column == 8 && (n.value_new = n.value_new == "" ? 0 : i.GetConvertedNumber(n.value_new, vt), r.records[n.index].Writeoff = n.value_new.toFixed(t), (r.records[n.index].PaymwentBaseType == "ARR" || r.records[n.index].PaymwentBaseType == "APP") && (n.value_new > r.records[n.index].ConvertedAmt ? (VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.OverUnder) > 0 ? (r.get(n.recid).changes.OverUnder = (r.records[n.index].ConvertedAmt - (n.value_new + r.records[n.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).Discount))).toFixed(t), r.records[n.index].OverUnder = r.get(n.recid).changes.OverUnder) : (r.get(n.recid).changes.VA009_RecivedAmt = (n.value_new - r.records[n.index].ConvertedAmt).toFixed(t), r.records[n.index].VA009_RecivedAmt = r.get(n.recid).changes.VA009_RecivedAmt), r.refreshCell(n.recid, "VA009_RecivedAmt"), r.refreshCell(n.recid, "OverUnder")) : n.value_new <= r.records[n.index].ConvertedAmt && (r.get(n.recid).changes.Discount == undefined && r.get(n.recid).changes.OverUnder == undefined ? VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.OverUnder) > 0 ? (r.get(n.recid).changes.OverUnder = (r.records[n.index].ConvertedAmt - (n.value_new + r.records[n.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).Discount))).toFixed(t), r.records[n.index].OverUnder = r.get(n.recid).changes.OverUnder) : (r.get(n.recid).changes.VA009_RecivedAmt = (r.records[n.index].ConvertedAmt - (n.value_new + r.records[n.index].OverUnder + r.records[n.index].Discount)).toFixed(t), r.records[n.index].VA009_RecivedAmt = r.get(n.recid).changes.VA009_RecivedAmt) : r.get(n.recid).changes.Discount == undefined ? VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.OverUnder) > 0 ? (r.get(n.recid).changes.OverUnder = (r.records[n.index].ConvertedAmt - (n.value_new + r.records[n.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).Discount))).toFixed(t), r.records[n.index].OverUnder = r.get(n.recid).changes.OverUnder) : (r.get(n.recid).changes.VA009_RecivedAmt = (r.records[n.index].ConvertedAmt - (n.value_new + VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).OverUnder) + r.records[n.index].Discount)).toFixed(t), r.records[n.index].VA009_RecivedAmt = r.get(n.recid).changes.VA009_RecivedAmt) : r.get(n.recid).changes.OverUnder == undefined ? VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.OverUnder) > 0 ? (r.get(n.recid).changes.OverUnder = (r.records[n.index].ConvertedAmt - (n.value_new + r.records[n.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).Discount))).toFixed(t), r.records[n.index].OverUnder = r.get(n.recid).changes.OverUnder) : (r.get(n.recid).changes.VA009_RecivedAmt = (r.records[n.index].ConvertedAmt - (n.value_new + r.records[n.index].OverUnder + VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).Discount))).toFixed(t), r.records[n.index].VA009_RecivedAmt = r.get(n.recid).changes.VA009_RecivedAmt) : VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.OverUnder) > 0 ? (r.get(n.recid).changes.OverUnder = (r.records[n.index].ConvertedAmt - (n.value_new + r.records[n.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).Discount))).toFixed(t), r.records[n.index].OverUnder = r.get(n.recid).changes.OverUnder) : (r.get(n.recid).changes.VA009_RecivedAmt = (r.records[n.index].ConvertedAmt - (n.value_new + VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).OverUnder) + VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).Discount))).toFixed(t), r.records[n.index].VA009_RecivedAmt = r.get(n.recid).changes.VA009_RecivedAmt), r.refreshCell(n.recid, "VA009_RecivedAmt"), r.refreshCell(n.recid, "OverUnder")), n.value_new > r.records[n.index].ConvertedAmt || n.value_new <= r.records[n.index].ConvertedAmt)); n.column == 9 && (n.value_new = n.value_new == "" ? 0 : i.GetConvertedNumber(n.value_new, vt), r.records[n.index].Discount = n.value_new.toFixed(t), (r.records[n.index].PaymwentBaseType == "ARR" || r.records[n.index].PaymwentBaseType == "APP") && (n.value_new > r.records[n.index].ConvertedAmt ? (VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.OverUnder) > 0 ? (r.get(n.recid).changes.OverUnder = (r.records[n.index].ConvertedAmt - (n.value_new + r.records[n.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).Writeoff))).toFixed(t), r.records[n.index].OverUnder = r.get(n.recid).changes.OverUnder) : (r.get(n.recid).changes.VA009_RecivedAmt = (n.value_new - r.records[n.index].ConvertedAmt).toFixed(t), r.records[n.index].VA009_RecivedAmt = r.get(n.recid).changes.VA009_RecivedAmt), r.refreshCell(n.recid, "VA009_RecivedAmt"), r.refreshCell(n.recid, "OverUnder")) : n.value_new <= r.records[n.index].ConvertedAmt && (r.get(n.recid).changes.Writeoff == undefined && r.get(n.recid).changes.OverUnder == undefined ? VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.OverUnder) > 0 ? (r.get(n.recid).changes.OverUnder = (r.records[n.index].ConvertedAmt - (n.value_new + r.records[n.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).Writeoff))).toFixed(t), r.records[n.index].OverUnder = r.get(n.recid).changes.OverUnder) : (r.get(n.recid).changes.VA009_RecivedAmt = (r.records[n.index].ConvertedAmt - (n.value_new + r.records[n.index].OverUnder + r.records[n.index].Writeoff)).toFixed(t), r.records[n.index].VA009_RecivedAmt = r.get(n.recid).changes.VA009_RecivedAmt) : r.get(n.recid).changes.Writeoff == undefined ? VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.OverUnder) > 0 ? (r.get(n.recid).changes.OverUnder = (r.records[n.index].ConvertedAmt - (n.value_new + r.records[n.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).Writeoff))).toFixed(t), r.records[n.index].OverUnder = r.get(n.recid).changes.OverUnder) : (r.get(n.recid).changes.VA009_RecivedAmt = (r.records[n.index].ConvertedAmt - (n.value_new + VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).OverUnder) + r.records[n.index].Writeoff)).toFixed(t), r.records[n.index].VA009_RecivedAmt = r.get(n.recid).changes.VA009_RecivedAmt) : r.get(n.recid).changes.OverUnder == undefined ? VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.OverUnder) > 0 ? (r.get(n.recid).changes.OverUnder = (r.records[n.index].ConvertedAmt - (n.value_new + r.records[n.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).Writeoff))).toFixed(t), r.records[n.index].OverUnder = r.get(n.recid).changes.OverUnder) : (r.get(n.recid).changes.VA009_RecivedAmt = (r.records[n.index].ConvertedAmt - (n.value_new + r.records[n.index].OverUnder + VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).Writeoff))).toFixed(t), r.records[n.index].VA009_RecivedAmt = r.get(n.recid).changes.VA009_RecivedAmt) : VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).changes.OverUnder) > 0 ? (r.get(n.recid).changes.OverUnder = (r.records[n.index].ConvertedAmt - (n.value_new + r.records[n.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).Writeoff))).toFixed(t), r.records[n.index].OverUnder = r.get(n.recid).changes.OverUnder) : (r.get(n.recid).changes.VA009_RecivedAmt = (r.records[n.index].ConvertedAmt - (n.value_new + VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).OverUnder) + VIS.Utility.Util.getValueOfDecimal(r.get(n.recid).Writeoff))).toFixed(t), r.records[n.index].VA009_RecivedAmt = r.get(n.recid).changes.VA009_RecivedAmt), r.refreshCell(n.recid, "VA009_RecivedAmt"), r.refreshCell(n.recid, "OverUnder")), n.value_new > r.records[n.index].ConvertedAmt || n.value_new <= r.records[n.index].ConvertedAmt)); r.refreshCell(n.recid, "ConvertedAmt"); r.refreshCell(n.recid, "VA009_RecivedAmt"); r.refreshCell(n.recid, "OverUnder"); r.refreshCell(n.recid, "Writeoff"); r.refreshCell(n.recid, "Discount") } n.column == 10 && (r.records[n.index].CheckNumber = n.value_new, r.records.length == 1 && $POPtxtCheckNumber.val(n.value_new)); n.column == 11 && (r.records[n.index].CheckDate = n.value_new != "" ? n.value_new : n.value_previous != "" ? n.value_previous : n.value_original); n.column == 2 && (r.records[n.index].Description = n.value_new) }, 100) } }); r.hideColumn("recid"); r.hideColumn("TransactionType") } function yt() { $POP_cmbBank = st.find("#VA009_POP_cmbBank_" + f.windowNo); $POP_cmbBankAccount = st.find("#VA009_POP_cmbBankAccount_" + f.windowNo); $POP_txtAccttNo = st.find("#VA009_AccountBalance" + f.windowNo); $POP_txtChqNo = st.find("#VA009_Chqnotxt_" + f.windowNo); uu = st.find("#VA009_btnPopupGrid"); $POp_cmbPaySelectn = st.find("#VA009_POP_cmbPaySelectn_" + f.windowNo); $pop_cmbCurrencyType = st.find("#VA009_POP_cmbCurrencyType_" + f.windowNo); $POP_PayMthd = st.find("#VA009_POP_cmbPaymthd_" + f.windowNo); $POP_PayMthd.addClass("vis-ev-col-mandatory"); $POPtxtCheckNumber = st.find("#VA009_POP_textCheckNo_" + f.windowNo); e = st.find("#VA009_AccountDate_" + f.windowNo); $POP_Consolidate = st.find("#VA009_chkConsolidate_" + f.windowNo); rt = st.find("#VA009_TransactionDate" + f.windowNo); $POP_cmbOrg = st.find("#VA009_POP_cmbOrg_" + f.windowNo); $POP_cmbOrg.addClass("vis-ev-col-mandatory"); $POP_targetDocType = st.find("#VA009_POP_cmbDocType_" + f.windowNo); $POP_targetDocType.addClass("vis-ev-col-mandatory") } function ot() { function n(n) { if (n.length > 0) for (var t in n) $POP_PayMthd.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].VA009_PaymentMethod_ID) + ">" + VIS.Utility.encodeText(n[t].VA009_Name) + "<\/option>"); $POP_PayMthd.val(0).prop("selected", !0) } $POP_PayMthd.empty(); VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadChequePaymentMethod", { Org_ID: $POP_cmbOrg.val() }, n) } function pt() { function n(n) { if ($POP_cmbOrg.append(" <option value = 0><\/option>"), n.length > 0) for (var t in n) $POP_cmbOrg.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].AD_Org_ID) + ">" + VIS.Utility.encodeText(n[t].Name) + "<\/option>"); $POP_cmbOrg.prop("selectedIndex", 0) } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadOrganization", null, n) } function wt(n) { t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GetPopUpData", type: "POST", datatype: "json", data: { InvPayids: s.toString(), bank_id: ft, acctno: et, chkno: VIS.Utility.encodeText(_Cheque_no), OrderPayids: l.toString() }, success: function (t) { n(t) }, error: function () { h[0].style.visibility = "hidden"; VIS.ADialog.error("VA009_ErrorLoadingPayments") } }) } function bt(n) { var i, u, t; w = []; i = JSON.parse(n); ut = i; for (u in i) t = {}, t.recid = i[u].recid, t.C_Bpartner = i[u].C_Bpartner, t.C_Invoice_ID = i[u].C_Invoice_ID, t.C_BPartner_ID = i[u].C_BPartner_ID, t.C_InvoicePaySchedule_ID = i[u].C_InvoicePaySchedule_ID, t.CurrencyCode = i[u].CurrencyCode, t.DueAmt = i[u].DueAmt, t.VA009_RecivedAmt = i[u].DueAmt, t.OverUnder = "0", t.Writeoff = "0", t.Discount = "0", t.ConvertedAmt = i[u].DueAmt, t.C_Currency_ID = i[u].C_Currency_ID, t.AD_Org_ID = i[u].AD_Org_ID, t.AD_Client_ID = i[u].AD_Client_ID, t.CheckDate = new Date, t.CheckNumber = null, t.ValidMonths = null, t.VA009_PaymentMode = i[u].VA009_PaymentMode, t.PaymwentBaseType = i[u].PaymwentBaseType, t.TransactionType = i[u].TransactionType, t.DocBaseType = i[u].DocBaseType, w.push(t); w2utils.encodeTags(w); r.add(w); h[0].style.visibility = "hidden" } function kt() { function n(n) { if ($pop_cmbCurrencyType.append("<option value='0'><\/option>"), n.length > 0) { for (var t in n) $pop_cmbCurrencyType.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID) + ">" + VIS.Utility.encodeText(n[t].Name) + "<\/option>"), VIS.Utility.encodeText(n[t].IsDefault) == "Y" && (dt = VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID)); $pop_cmbCurrencyType.val(dt) } } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/loadCurrencyType", null, n) } function tt(n) { var i, u, t; r.clear(); w = []; i = JSON.parse(n); ut = i; for (u in i) t = {}, t.recid = i[u].recid, t.C_Bpartner = i[u].C_Bpartner, t.C_Invoice_ID = i[u].C_Invoice_ID, t.C_BPartner_ID = i[u].C_BPartner_ID, t.C_InvoicePaySchedule_ID = i[u].C_InvoicePaySchedule_ID, t.CurrencyCode = i[u].CurrencyCode, t.DueAmt = i[u].DueAmt, t.VA009_RecivedAmt = i[u].convertedAmt, t.OverUnder = "0", t.Writeoff = "0", t.Discount = "0", t.ConvertedAmt = i[u].convertedAmt, t.C_Currency_ID = i[u].C_Currency_ID, t.AD_Org_ID = i[u].AD_Org_ID, t.AD_Client_ID = i[u].AD_Client_ID, t.CheckDate = new Date, t.CheckNumber = null, t.ValidMonths = null, t.VA009_PaymentMode = i[u].VA009_PaymentMode, t.PaymwentBaseType = i[u].PaymwentBaseType, t.TransactionType = i[u].TransactionType, t.DocBaseType = i[u].DocBaseType, w.push(t); i[0].ERROR == "ConversionNotFound" && VIS.ADialog.info("VA009_ConversionNotFound"); w2utils.encodeTags(w); r.add(w) } function ni(n) { n = JSON.parse(n); y.find(".VA009-payment-wrap").remove(); o.find(".VA009-right-data-main").remove(); o.find(".VA009-accordion").remove(); b = 1; s = []; l = []; p = []; d = []; g(); it.prop("checked", !1); nt(); h[0].style.visibility = "hidden"; VIS.ADialog.info("", null, n, null) } function ti(n) { if (n = JSON.parse(n), y.find(".VA009-payment-wrap").remove(), o.find(".VA009-right-data-main").remove(), o.find(".VA009-accordion").remove(), b = 1, s = [], l = [], p = [], d = [], g(), it.prop("checked", !1), nt(), h[0].style.visibility = "hidden", n != "") VIS.ADialog.info("", null, n, null); else { var i = new VIS.Apps.AForms.VPayPrint, t = new VIS.CFrame; t.setName(VIS.Msg.getMsg("Check Print")); t.setTitle(VIS.Msg.getMsg("Check Print")); t.hideHeader(!0); t.setContent(i); t.show(); i.initialize() } } function ht() { _Cheque = null; $cheque = null; st = null; STAT_cmbBank = null; STAT_cmbBankAccount = null; STAT_txtStatementNo = null; STAT_ctrlLoadFile = null; STAT_ctrlLoadFileTxt = null; r.destroy() } var ft, et, n, c, i, a, u, v; uu; _Cheque_no = ""; ft = 0; et = 0; h[0].style.visibility = "visible"; i = null; lblAmount = t("<label>"); n = new VIS.Controls.VAmountTextBox("VA009_AccountBalance" + f.windowNo + "", !1, !0, !0, 50, 100, VIS.DisplayType.Amount, VIS.Msg.getMsg("Amount")); lblAmount.append(VIS.Msg.getMsg("VA009_AccountBalance")); n.setValue(0); i = VIS.DisplayType.GetNumberFormat(VIS.DisplayType.Amount); c = t("<div class='VA009-popCheck-data input-group vis-input-wrap'>"); a = t("<div class='vis-control-wrap'>"); c.append(a); a.append(n.getControl().attr("placeholder", " ").attr("data-placeholder", "")).append(lblAmount); st = t("<div class='VA009-popform-content vis-formouterwrpdiv' style='min-height:450px !important'>"); _ChequePayble = t("<div class='VA009-popfrm-wrap'>"); _chequedata = t("<div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbOrg_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_Org") + "<\/label><\/div><\/div><div class='VA009-popCheck-data input-group vis-input-wrap' > <div class='vis-control-wrap'><select id='VA009_POP_cmbDocType_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_DocType") + "<\/label><\/div><\/div> <div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbBank_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_Bank") + "<\/label><\/div><\/div><div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbBankAccount_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_BankAccount") + "<\/label><\/div><\/div>"); _chequedata1 = t("<div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbPaySelectn_" + f.windowNo + '\'> <option value="M">' + VIS.Msg.getMsg("VA009_PayManully") + '<\/option> <option value="P">' + VIS.Msg.getMsg("VA009_PayPrint") + "<\/option><\/select><label>" + VIS.Msg.getMsg("VA009_PaymentSelection") + "<\/label><\/div><\/div><div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_AccountDate_" + f.windowNo + "' placeholder=' ' data-placeholder=''><label>" + VIS.Msg.getMsg("AccountDate") + "<\/label><\/div><\/div><div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_TransactionDate" + f.windowNo + "' placeholder=' ' data-placeholder='' ><label>" + VIS.Msg.getMsg("TransactionDate") + "<\/label><\/div><\/div><div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbCurrencyType_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_CurrencyType") + "<\/label><\/div><\/div><div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbPaymthd_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_PayMthd") + "<\/label><\/div><\/div><div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='text' id='VA009_Chqnotxt_" + f.windowNo + "' placeholder=' ' data-placeholder='' disabled > <label>" + VIS.Msg.getMsg("VA009_Chqnolbl") + "<\/label><\/div><\/div><div class='VA009-popCheck-data VA009-popformchkctrlwrap' id='VA009_POP_textCheckNoDiv'><div><input type=\"checkbox\" id=\"VA009_chkConsolidate_" + f.windowNo + '"> <label>' + VIS.Msg.getMsg("VA009_ConsolidateCheck") + "<\/label><\/div><\/div><div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='text' placeholder='" + VIS.Msg.getMsg("VA009_ChkNo") + "' disabled id='VA009_POP_textCheckNo_" + f.windowNo + "'><label>" + VIS.Msg.getMsg("VA009_ChkNo") + "<\/label><\/div><\/div> <div class='VA009-grid-container'><div class='VA009-table-container' id='VA009_btnPopupGrid'><\/div><\/div><\/div>"); _ChequePayble.append(_chequedata).append(c).append(_chequedata1); st.append(_ChequePayble); yt(); u = new Date; v = u.getFullYear() + "-" + ("0" + (u.getMonth() + 1)).slice(-2) + "-" + ("0" + u.getDate()).slice(-2); e.val(v); rt.val(v); ii = new VIS.ChildDialog; ii.setContent(st); ii.setTitle(VIS.Msg.getMsg("VA009_LoadChequePayment")); ii.setWidth("80%"); ii.setHeight(window.innerHeight - 75); ii.setEnableResize(!0); ii.setModal(!0); (s.toString() != "" || l.toString() != "") && ct(""); n.addVetoableChangeListener(this); $POP_cmbOrg.on("change", function () { VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val()) == 0 ? $POP_cmbOrg.addClass("vis-ev-col-mandatory") : (tr($POP_cmbBank, VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())), $POP_cmbBank.val(0).prop("selected", !0), $POP_cmbBank.addClass("vis-ev-col-mandatory"), $POP_cmbBankAccount.empty(), $POP_cmbBankAccount.append("<option value='0'><\/option>"), $POP_cmbBankAccount.addClass("vis-ev-col-mandatory"), $POP_cmbOrg.removeClass("vis-ev-col-mandatory"), ot()); k.LoadTargetDocType($POP_targetDocType, at) }); $POP_cmbBank.on("change", function () { function t(n) { if ($POP_cmbBankAccount.append("<option value='0'><\/option>"), n != null && n.length > 0) for (var t in n) $POP_cmbBankAccount.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].C_BankAccount_ID) + ">" + VIS.Utility.encodeText(n[t].AccountNo) + "<\/option>") } $POP_cmbBankAccount.empty(); VIS.Utility.Util.getValueOfInt($POP_cmbBank.val()) > 0 ? $POP_cmbBank.removeClass("vis-ev-col-mandatory") : ($POP_cmbBank.addClass("vis-ev-col-mandatory"), $POP_cmbBankAccount.addClass("vis-ev-col-mandatory")); n.setValue(0); $POP_txtChqNo.val(""); VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadBankAccount", { Bank_ID: $POP_cmbBank.val(), Orgs: $POP_cmbOrg.val() }, t) }); $POP_cmbBankAccount.on("change", function () { function r(t) { $POP_cmbBankAccount.val() == "0" ? $POP_cmbBankAccount.addClass("vis-ev-col-mandatory") : $POP_cmbBankAccount.removeClass("vis-ev-col-mandatory"); t != null && n.setValue(t.CurrentBalance); t == null && n.setValue() } if (VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val()) > 0 ? ($POP_cmbBankAccount.removeClass("vis-ev-col-mandatory"), $POP_PayMthd.val(0)) : $POP_cmbBankAccount.addClass("vis-ev-col-mandatory"), t("#VA009_POP_cmbPaySelectn_" + f.windowNo)[0].value != null && t("#VA009_POP_cmbPaySelectn_" + f.windowNo)[0].value == "P") { var i = VIS.dataContext.getJSONRecord("VA009/Payment/GetProcessId", $POP_cmbBankAccount.val()); if (!i) return VIS.ADialog.info("VA009_Plz_Process_IDNotFndBnkActDoc"), $POp_cmbPaySelectn.val("M"), !1 } n.setValue(0); $POP_txtChqNo.val(""); VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/GetBankAccountData", { BankAccount: $POP_cmbBankAccount.val() }, r); t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GetConvertedAmt", type: "POST", datatype: "json", async: !0, data: { PaymentData: JSON.stringify(ut), BankAccount: $POP_cmbBankAccount.val(), CurrencyType: $pop_cmbCurrencyType.val(), dateAcct: e.val(), _org_Id: $POP_cmbOrg.val() <= 0 ? 0 : $POP_cmbOrg.val() }, success: function (n) { tt(n) }, error: function (n) { console.log(n); VIS.ADialog.error("VA009_ErrorLoadingPayments") } }) }); $pop_cmbCurrencyType.on("change", function () { t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GetConvertedAmt", type: "POST", datatype: "json", async: !0, data: { PaymentData: JSON.stringify(ut), BankAccount: $POP_cmbBankAccount.val(), CurrencyType: $pop_cmbCurrencyType.val(), dateAcct: e.val(), _org_Id: $POP_cmbOrg.val() <= 0 ? 0 : $POP_cmbOrg.val() }, success: function (n) { tt(n) }, error: function (n) { console.log(n); VIS.ADialog.error("VA009_ErrorLoadingPayments") } }) }); $POP_Consolidate.on("click", function (n) { var i = t(n.target); n.target.type == "checkbox" && (i.prop("checked") == !0 ? ($POPtxtCheckNumber.removeAttr("disabled"), $POPtxtCheckNumber.css("background-color", "white"), $POPtxtCheckNumber.addClass("vis-ev-col-mandatory")) : ($POPtxtCheckNumber.val(""), $POPtxtCheckNumber.attr("disabled", "disabled"), $POPtxtCheckNumber.removeClass("vis-ev-col-mandatory"), $POPtxtCheckNumber.css("background-color", "#ededed"))) }); $POP_PayMthd.on("change", function () { if (VIS.Utility.Util.getValueOfInt($POP_PayMthd.val()) > 0) { if ($POP_PayMthd.removeClass("vis-ev-col-mandatory"), VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val()) == 0) return VIS.ADialog.info("VA009_PLSelectBankAccount", ""), !1; var n = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/GetBankAccountCheckNo", { BankAccount: $POP_cmbBankAccount.val(), PaymentMethod: $POP_PayMthd.val() }); if (n != null || n != 0) $POP_txtChqNo.val(n); else return $POP_txtChqNo.val("0"), VIS.ADialog.info("VA009_NoCheckNum", ""), !1 } else $POP_PayMthd.addClass("vis-ev-col-mandatory") }); $POPtxtCheckNumber.on("change", function () { var i, t, n; if ($POPtxtCheckNumber.val() == "") $POPtxtCheckNumber.addClass("vis-ev-col-mandatory"); else { for ($POPtxtCheckNumber.removeClass("vis-ev-col-mandatory"), uu = st.find("#VA009_btnPopupGrid"), i = [], t = [], n = 0; n < r.records.length; n++)i.indexOf(r.records[n].C_BPartner_ID) < 0 ? (i.push(r.records[n].C_BPartner_ID), n == 0 ? (r.records[n].CheckNumber = $POPtxtCheckNumber.val(), t.push($POPtxtCheckNumber.val())) : (r.records[n].CheckNumber = VIS.Utility.Util.getValueOfInt(t[t.length - 1]) + 1, t.push(VIS.Utility.Util.getValueOfInt(t[t.length - 1]) + 1))) : i.indexOf(r.records[n].C_BPartner_ID) > -1 ? r.records[n].CheckNumber = t[i.indexOf(r.records[n].C_BPartner_ID)] : console.log("Skip"), r.refreshCell(r.records[n].recid, "CheckNumber"); console.log("BPartner IDS =  " + i) } }); $POp_cmbPaySelectn.on("change", function () { var n, i, u; if ($POp_cmbPaySelectn.val() == "P") { for ($POP_Consolidate.prop("cheched", !1), $POP_Consolidate.attr("disabled", "disabled"), $POPtxtCheckNumber.val(""), n = 0; n < r.records.length; n++) { if (r.records[n].TransactionType == "Order") return VIS.ADialog.info("VA009_CannotPrintOrder"), $POp_cmbPaySelectn.val("M"), !1; r.records[n].CheckNumber = ""; r.records[n].CheckDate = new Date; r.refreshCell(r.records[n].recid, "CheckNumber"); r.refreshCell(r.records[n].recid, "CheckDate") } if (i = t("#VA009_POP_cmbBankAccount_" + f.windowNo)[0].value > 0 ? t("#VA009_POP_cmbBankAccount_" + f.windowNo)[0].value : 0, i) { if (u = VIS.dataContext.getJSONRecord("VA009/Payment/GetProcessId", i), !u) return VIS.ADialog.info("VA009_Plz_Process_IDNotFndBnkActDoc"), $POp_cmbPaySelectn.val("M"), !1 } else return VIS.ADialog.info("VA009_PLSelectBankAccount"), $POp_cmbPaySelectn.val("M"), !1 } else $POP_Consolidate.removeAttr("disabled") }); e.on("change", function () { e.val() == "" ? e.addClass("vis-ev-col-mandatory") : e.removeClass("vis-ev-col-mandatory"); t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GetConvertedAmt", type: "POST", datatype: "json", async: !0, data: { PaymentData: JSON.stringify(ut), BankAccount: $POP_cmbBankAccount.val(), CurrencyType: $pop_cmbCurrencyType.val(), dateAcct: e.val(), _org_Id: $POP_cmbOrg.val() <= 0 ? 0 : $POP_cmbOrg.val() }, success: function (n) { tt(n) }, error: function (n) { console.log(n); VIS.ADialog.error("VA009_ErrorLoadingPayments") } }) }); $POP_targetDocType.on("change", function () { VIS.Utility.Util.getValueOfInt($POP_targetDocType.val()) == 0 ? $POP_targetDocType.addClass("vis-ev-col-mandatory") : $POP_targetDocType.removeClass("vis-ev-col-mandatory") }); ii.onOkClick = function () { var u = [], c, n, i, l, f, o, s; if (r.selectAll(), c = 0, r.getSelection().length > 0) if (VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val()) > 0) if (VIS.Utility.Util.getValueOfInt($POP_targetDocType.val()) > 0) if (VIS.Utility.Util.getValueOfInt($POP_cmbBank.val()) > 0) if (VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val()) > 0) if (VIS.Utility.Util.getValueOfInt($POP_PayMthd.val()) > 0) if (e.val() != "" && e.val() != null) for (n = 0; n < r.getSelection().length; n++) { if (i = {}, l = 0, i.C_BPartner_ID = r.get(r.getSelection()[n]).C_BPartner_ID, i.Description = r.get(r.getSelection()[n]).Description, i.C_Invoice_ID = r.get(r.getSelection()[n]).C_Invoice_ID, i.AD_Org_ID = VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val()), i.TargetDocType = VIS.Utility.Util.getValueOfInt($POP_targetDocType.val()), i.AD_Client_ID = r.get(r.getSelection()[n]).AD_Client_ID, i.C_InvoicePaySchedule_ID = r.get(r.getSelection()[n]).C_InvoicePaySchedule_ID, i.C_BankAccount_ID = VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val()), i.C_Currency_ID = r.get(r.getSelection()[n]).C_Currency_ID, i.DueAmt = r.get(r.getSelection()[n]).DueAmt, i.ConvertedAmt = r.get(r.getSelection()[n]).ConvertedAmt, i.PaymwentBaseType = r.get(r.getSelection()[n]).PaymwentBaseType, i.TransactionType = r.get(r.getSelection()[n]).TransactionType, VIS.Utility.Util.getValueOfInt(r.get(r.getSelection()[n]).VA009_RecivedAmt) != 0) i.VA009_RecivedAmt = r.get(r.getSelection()[n]).VA009_RecivedAmt; else return VIS.ADialog.info("VA009_PLPayAmt"), r.selectNone(), !1; if (i.OverUnder = r.get(r.getSelection()[n]).OverUnder, i.Writeoff = r.get(r.getSelection()[n]).Writeoff, i.Discount = r.get(r.getSelection()[n]).Discount, i.DateTrx = VIS.Utility.Util.getValueOfDate(rt.val()), i.DateAcct = VIS.Utility.Util.getValueOfDate(e.val()), i.From = "Pay", $POp_cmbPaySelectn.val() == "M") { if (r.get(r.getSelection()[n]).CheckDate != "" && r.get(r.getSelection()[n]).CheckDate != null) { if (f = new Date(r.get(r.getSelection()[n]).CheckDate), f = new Date(f.setHours(0, 0, 0, 0)), o = new Date(e.val()), o = new Date(o.setHours(0, 0, 0, 0)), f > o) return VIS.ADialog.info("VIS_CheckDateCantbeGreaterSys"), r.selectNone(), !1; i.CheckDate = VIS.Utility.Util.getValueOfDate(r.get(r.getSelection()[n]).CheckDate) } else return VIS.ADialog.info("VA009_PLCheckDate"), r.selectNone(), !1; if (r.get(r.getSelection()[n]).CheckNumber != "" && r.get(r.getSelection()[n]).CheckNumber != null) i.CheckNumber = r.get(r.getSelection()[n]).CheckNumber; else return VIS.ADialog.info("VA009_PLCheckNumber"), r.selectNone(), !1 } if (r.get(r.getSelection()[n]).VA009_RecivedAmt == 0) return VIS.ADialog.info("VA009_PLRecivedAmt"), r.selectNone(), !1; if (i.CurrencyType = $pop_cmbCurrencyType.val(), i.VA009_PaymentMethod_ID = $POP_PayMthd.val(), n > 0 && (s = t.grep(u, function (t) { return r.get(r.getSelection()[n]).C_BPartner_ID == t.C_BPartner_ID && r.get(r.getSelection()[n]).CheckNumber == t.CheckNumber && r.get(r.getSelection()[n]).TransactionType != t.TransactionType }), s && s.length > 0)) return VIS.ADialog.info("VA009_SameCheckNo"), r.selectNone(), !1; u.push(i) } else return VIS.ADialog.info("VA009_PLSelectAcctDate"), r.selectNone(), !1; else return VIS.ADialog.info("VA009_PLSelectPaymentMethod"), r.selectNone(), !1; else return VIS.ADialog.info("VA009_PLSelectBankAccount"), r.selectNone(), !1; else return VIS.ADialog.info("VA009_PLSelectBank"), r.selectNone(), !1; else return VIS.ADialog.info("VA009_PlsSelectDocumentType"), r.selectNone(), !1; else return VIS.ADialog.info("VA009_PlsSelectOrg"), r.selectNone(), !1; $POp_cmbPaySelectn.val() == "M" ? (h[0].style.visibility = "visible", t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GeneratePayments", type: "POST", datatype: "json", async: !0, data: { PaymentData: JSON.stringify(u) }, success: function (n) { ni(n) }, error: function (n) { console.log(n); h[0].style.visibility = "hidden"; VIS.ADialog.error("VA009_ErrorLoadingPayments") } })) : $POp_cmbPaySelectn.val() == "P" && (h[0].style.visibility = "visible", t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GeneratePaymentsBatchOfRule", type: "POST", datatype: "json", async: !0, data: { PaymentData: JSON.stringify(u) }, success: function (n) { ti(n) }, error: function (n) { console.log(n); h[0].style.visibility = "hidden"; VIS.ADialog.error("VA009_ErrorLoadingPayments") } })) }; ii.onCancelCLick = function () { r.clear(); ht() }; ii.onClose = function () { r.clear(); ht() }; this.vetoablechange = function (t) { t.propertyName == "VA009_AccountBalance" + f.windowNo + "" && n.setValue(t.newValue) } }, Cheque_Rec_Dialog: function () { function ft(n) { n != "" ? (h[0].style.visibility = "hidden", VIS.ADialog.info("VA009_PleaseSelctonlyCheque")) : (fi.show(), ct(), tr($RPOP_cmbBank, VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())), $RPOP_cmbBank.addClass("vis-ev-col-mandatory"), $RPOP_cmbBankAccount.addClass("vis-ev-col-mandatory"), e.val() ? e.removeClass("vis-ev-col-mandatory") : e.addClass("vis-ev-col-mandatory"), lt(yt), ot(), st(), ht(), k.LoadTargetDocType($POP_targetDocType, at)) } function et() { $RPOP_cmbBank = kt.find("#VA009_POP_cmbBank_" + f.windowNo); $RPOP_cmbBankAccount = kt.find("#VA009_POP_cmbBankAccount_" + f.windowNo); $POP_PayMthd = kt.find("#VA009_POP_cmbPaymthd_" + f.windowNo); ru = kt.find("#VA009_btnPopupRecGrid"); $pop_cmbCurrencyType = kt.find("#VA009_POP_cmbCurrencyType_" + f.windowNo); e = kt.find("#VA009_AccountDate_" + f.windowNo); rt = kt.find("#VA009_TransactionDate" + f.windowNo); $POP_cmbOrg = kt.find("#VA009_POP_cmbOrg_" + f.windowNo); $POP_cmbOrg.addClass("vis-ev-col-mandatory"); $POP_targetDocType = kt.find("#VA009_POP_cmbDocType_" + f.windowNo); $POP_targetDocType.addClass("vis-ev-col-mandatory") } function ot() { function n(n) { if ($pop_cmbCurrencyType.append("<option value='0'><\/option>"), n.length > 0) { for (var t in n) $pop_cmbCurrencyType.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID) + ">" + VIS.Utility.encodeText(n[t].Name) + "<\/option>"), VIS.Utility.encodeText(n[t].IsDefault) == "Y" && (dt = VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID)); $pop_cmbCurrencyType.val(dt) } } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/loadCurrencyType", null, n) } function st() { function n(n) { if (n.length > 1 && $POP_PayMthd.append(" <option value = 0><\/option>"), n.length > 0) for (var t in n) $POP_PayMthd.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].VA009_PaymentMethod_ID) + ">" + VIS.Utility.encodeText(n[t].VA009_Name) + "<\/option>"); $POP_PayMthd.prop("selectedIndex", 0) } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadChequePaymentMethod", { Org_ID: null }, n) } function ht() { function n(n) { if ($POP_cmbOrg.append(" <option value = 0><\/option>"), n.length > 0) for (var t in n) $POP_cmbOrg.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].AD_Org_ID) + ">" + VIS.Utility.encodeText(n[t].Name) + "<\/option>"); $POP_cmbOrg.prop("selectedIndex", 0) } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadOrganization", null, n) } function c(t) { var r, u, i; n.clear(); w = []; r = JSON.parse(t); ut = r; for (u in r) i = {}, i.recid = r[u].recid, i.C_Bpartner = r[u].C_Bpartner, i.C_Invoice_ID = r[u].C_Invoice_ID, i.C_BPartner_ID = r[u].C_BPartner_ID, i.C_InvoicePaySchedule_ID = r[u].C_InvoicePaySchedule_ID, i.CurrencyCode = r[u].CurrencyCode, i.DueAmt = r[u].DueAmt, i.VA009_RecivedAmt = r[u].convertedAmt, i.OverUnder = "0", i.Writeoff = "0", i.Discount = "0", i.ConvertedAmt = r[u].convertedAmt, i.C_Currency_ID = r[u].C_Currency_ID, i.AD_Org_ID = r[u].AD_Org_ID, i.AD_Client_ID = r[u].AD_Client_ID, i.CheckDate = new Date, i.CheckNumber = null, i.ValidMonths = null, i.VA009_PaymentMode = r[u].VA009_PaymentMode, i.PaymwentBaseType = r[u].PaymwentBaseType, i.TransactionType = r[u].TransactionType, i.DocBaseType = r[u].DocBaseType, w.push(i); r[0].ERROR == "ConversionNotFound" && VIS.ADialog.info("VA009_ConversionNotFound"); w2utils.encodeTags(w); n.add(w) } function ct() { w = []; var i = []; i.length == 0 && (i.push({ field: "C_Bpartner", caption: VIS.Msg.getMsg("VA009_BPartner"), sortable: !0, size: "12%" }), i.push({ field: "C_InvoicePaySchedule_ID", caption: VIS.Msg.getMsg("VA009_Schedule"), sortable: !0, size: "8%" }), i.push({ field: "Description", caption: VIS.Msg.getMsg("Description"), sortable: !0, size: "15%", editable: { type: "text" } }), i.push({ field: "CurrencyCode", caption: VIS.Msg.getMsg("VA009_Currency"), sortable: !0, size: "8%" }), i.push({ field: "DueAmt", caption: VIS.Msg.getMsg("VA009_DueAmt"), sortable: !0, size: "12%", style: "text-align: right", render: function (n) { var t = n.DueAmt; return parseFloat(t).toLocaleString() } }), i.push({ field: "ConvertedAmt", caption: VIS.Msg.getMsg("VA009_ConvertedAmt"), sortable: !0, size: "12%", style: "text-align: right", render: function (n) { var t = n.ConvertedAmt; return parseFloat(t).toLocaleString() } }), i.push({ field: "VA009_RecivedAmt", caption: VIS.Msg.getMsg("VA009_ReceivedAmt"), sortable: !0, size: "12%", style: "text-align: right", render: function (n) { var t = n.VA009_RecivedAmt; return t = gt(event, t, t), parseFloat(t).toLocaleString() }, editable: { type: "number" } }), i.push({ field: "OverUnder", caption: VIS.Msg.getMsg("VA009_OverUnder"), sortable: !0, size: "8%", style: "text-align: right", render: function (n) { var t = n.OverUnder; return parseFloat(t).toLocaleString() } }), i.push({ field: "Writeoff", caption: VIS.Msg.getMsg("VA009_Writeoff"), sortable: !0, size: "8%", style: "text-align: right", render: function (n) { var t = n.Writeoff; return t = gt(event, t, t), parseFloat(t).toLocaleString() }, editable: { type: "number" } }), i.push({ field: "Discount", caption: VIS.Msg.getMsg("VA009_Discount"), sortable: !0, size: "8%", style: "text-align: right", render: function (n) { var t = n.Discount; return t = gt(event, t, t), parseFloat(t).toLocaleString() }, editable: { type: "number" } }), i.push({ field: "CheckNumber", caption: VIS.Msg.getMsg("VA009_ChkNo"), sortable: !0, size: "8%", editable: { type: "alphanumeric", autoFormat: !0, groupSymbol: " " } }), i.push({ field: "CheckDate", caption: VIS.Msg.getMsg("VA009_CheckDate"), sortable: !0, size: "10%", style: "text-align: left", render: function (n) { var t; return t = n.changes == undefined || n.changes.CheckDate == "" ? n.CheckDate : n.changes.CheckDate, new Date(t).toLocaleDateString() }, editable: { type: "date" } }), i.push({ field: "recid", caption: VIS.Msg.getMsg("VA009_srno"), sortable: !0, size: "1%" }), i.push({ field: "TransactionType", caption: VIS.Msg.getMsg("VA009_TransactionType"), sortable: !0, size: "1%" })); n = null; n = ru.w2grid({ name: "CheueRecevableGrid_" + f.windowNo, recordHeight: 25, columns: i, method: "GET", multiSelect: !0, show: { toolbarSave: !0 }, onEditField: function (i) { (i.column == 6 || i.column == 8 || i.column == 9) && n.get(i.recid).TransactionType == "Order" && (i.isCancelled = !0); i.onComplete = function (i) { if (id = i.recid, i.column == 8 || i.column == 9 || i.column == 6) { n.records[i.index][n.columns[i.column].field] = gt(i, n.records[i.index][n.columns[i.column].field]); var r = vr.GetFormatAmount(n.records[i.index][n.columns[i.column].field], "init", vt); n.records[i.index][n.columns[i.column].field] = vr.GetConvertedString(r, vt); t("#grid_CheueRecevableGrid_" + f.windowNo + "_edit_" + id + "_" + i.column).keydown(function (n) { var t = br.isDecimalSeparatorDot(window.navigator.language); if (t || n.keyCode != 190 && n.keyCode != 110) { if (t && n.keyCode == 188) return !1 } else return !1; return n.target.value.contains(".") && (n.which == 110 || n.which == 190 || n.which == 188) && (this.value = this.value.replace(".", "")), n.target.value.contains(",") && (n.which == 110 || n.which == 190 || n.which == 188) && (this.value = this.value.replace(",", "")), n.keyCode != 8 && n.keyCode != 9 && (n.keyCode < 37 || n.keyCode > 40) && (n.keyCode < 48 || n.keyCode > 57) && (n.keyCode < 96 || n.keyCode > 105) && n.keyCode != 109 && n.keyCode != 189 && n.keyCode != 110 && n.keyCode != 144 && n.keyCode != 188 && n.keyCode != 190 ? !1 : void 0 }) } } }, onChange: function (t) { window.setTimeout(function () { if (n.getChanges(t.recid) != undefined) { var i = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/GetCurrencyPrecision", { BankAccount_ID: $RPOP_cmbBankAccount.val(), CurrencyFrom: "B" }, null); if ((i == null || i == 0) && (i = 2), n.records[t.index].ConvertedAmt = parseFloat(n.records[t.index].ConvertedAmt), n.records[t.index].VA009_RecivedAmt = parseFloat(n.records[t.index].VA009_RecivedAmt), n.records[t.index].OverUnder = parseFloat(n.records[t.index].OverUnder), n.records[t.index].Writeoff = parseFloat(n.records[t.index].Writeoff), n.records[t.index].Discount = parseFloat(n.records[t.index].Discount), t.column == 6) { if (t.value_new = t.value_new == "" ? 0 : vr.GetConvertedNumber(t.value_new, vt), t.value_new > n.records[t.index].ConvertedAmt) { VIS.ADialog.error("MoreScheduleAmount"); t.value_new = t.value_original; n.get(t.recid).changes.VA009_RecivedAmt = t.value_new; n.records[t.index].VA009_RecivedAmt = n.get(t.recid).changes.VA009_RecivedAmt; n.refreshCell(t.recid, "VA009_RecivedAmt"); return } n.records[t.index].VA009_RecivedAmt = t.value_new.toFixed(i); n.refreshCell(t.recid, "VA009_RecivedAmt"); (n.records[t.index].PaymwentBaseType == "ARR" || n.records[t.index].PaymwentBaseType == "APP") && (t.value_new > n.records[t.index].ConvertedAmt ? (n.records[t.index].ConvertedAmt > 0 ? (n.get(t.recid).changes.OverUnder = (n.records[t.index].ConvertedAmt - t.value_new).toFixed(i), n.records[t.index].OverUnder = n.get(t.recid).changes.OverUnder, n.get(t.recid).changes.Writeoff = 0) : (n.get(t.recid).changes.OverUnder = (n.records[t.index].ConvertedAmt - t.value_new).toFixed(i), n.records[t.index].OverUnder = n.get(t.recid).changes.OverUnder, n.get(t.recid).changes.Writeoff = 0, n.get(t.recid).Writeoff = 0), n.get(t.recid).changes.Discount = 0, n.refreshCell(t.recid, "OverUnder"), n.refreshCell(t.recid, "Discount"), n.refreshCell(t.recid, "Writeoff")) : t.value_new == n.records[t.index].ConvertedAmt ? (n.get(t.recid).changes.OverUnder = 0, n.get(t.recid).OverUnder = 0, n.get(t.recid).changes.Discount = 0, n.get(t.recid).changes.Writeoff = 0, n.get(t.recid).Discount = 0, n.get(t.recid).Writeoff = 0, n.get(t.recid).changes.VA009_RecivedAmt = t.value_new, n.records[t.index].VA009_RecivedAmt = n.get(t.recid).changes.VA009_RecivedAmt, n.refreshCell(t.recid, "OverUnder"), n.refreshCell(t.recid, "Discount"), n.refreshCell(t.recid, "Writeoff"), n.refreshCell(t.recid, "VA009_RecivedAmt")) : t.value_new < n.records[t.index].ConvertedAmt && (n.records[t.index].ConvertedAmt > 0 ? n.get(t.recid).TransactionType == "Order" ? (n.get(t.recid).changes.Discount = (n.records[t.index].ConvertedAmt - t.value_new).toFixed(i), n.records[t.index].Discount = n.get(t.recid).changes.Discount, n.get(t.recid).changes.Writeoff = 0, n.get(t.recid).Writeoff = 0, n.get(t.recid).changes.OverUnder = 0, n.get(t.recid).OverUnder = 0) : (n.get(t.recid).changes.OverUnder = (n.records[t.index].ConvertedAmt - t.value_new).toFixed(i), n.records[t.index].OverUnder = n.get(t.recid).changes.OverUnder, n.get(t.recid).changes.Writeoff = 0, n.get(t.recid).Writeoff = 0, n.get(t.recid).changes.Discount = 0, n.get(t.recid).Discount = 0) : n.get(t.recid).TransactionType == "Order" ? (n.get(t.recid).changes.Discount = (n.records[t.index].ConvertedAmt - t.value_new).toFixed(i), n.records[t.index].Discount = n.get(t.recid).changes.Discount, n.get(t.recid).changes.Writeoff = 0, n.get(t.recid).Writeoff = 0, n.get(t.recid).changes.OverUnder = 0, n.get(t.recid).OverUnder = 0) : (n.get(t.recid).changes.OverUnder = (n.records[t.index].ConvertedAmt - t.value_new).toFixed(i), n.records[t.index].OverUnder = n.get(t.recid).changes.OverUnder, n.get(t.recid).changes.Writeoff = 0, n.get(t.recid).Writeoff = 0, n.get(t.recid).changes.Discount = 0, n.get(t.recid).Discount = 0), n.refreshCell(t.recid, "OverUnder"), n.refreshCell(t.recid, "Discount"), n.refreshCell(t.recid, "Writeoff"))) } t.column == 8 && (t.value_new = t.value_new == "" ? 0 : vr.GetConvertedNumber(t.value_new, vt), n.records[t.index].Writeoff = t.value_new.toFixed(i), n.records[t.index].PaymwentBaseType == "APP" ? t.value_new > n.records[t.index].ConvertedAmt ? (n.get(t.recid).changes.VA009_RecivedAmt = ((t.value_new - n.records[t.index].ConvertedAmt) * -1).toFixed(i), n.records[t.index].VA009_RecivedAmt = n.get(t.recid).changes.VA009_RecivedAmt, n.refreshCell(t.recid, "VA009_RecivedAmt")) : t.value_new < n.records[t.index].ConvertedAmt && (n.get(t.recid).changes.Discount == undefined && n.get(t.recid).changes.OverUnder == undefined ? VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder) > 0 ? (n.get(t.recid).changes.OverUnder = (n.records[t.index].ConvertedAmt - (t.value_new + n.records[t.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).Discount))).toFixed(i), n.records[t.index].OverUnder = n.get(t.recid).changes.OverUnder) : (n.get(t.recid).changes.VA009_RecivedAmt = (n.records[t.index].ConvertedAmt - (t.value_new + n.records[t.index].OverUnder + n.records[t.index].Discount)).toFixed(i), n.records[t.index].VA009_RecivedAmt = n.get(t.recid).changes.VA009_RecivedAmt) : n.get(t.recid).changes.Discount == undefined ? VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder) > 0 ? (n.get(t.recid).changes.OverUnder = (n.records[t.index].ConvertedAmt - (t.value_new + n.records[t.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).Discount))).toFixed(i), n.records[t.index].OverUnder = n.get(t.recid).changes.OverUnder) : (n.get(t.recid).changes.VA009_RecivedAmt = (n.records[t.index].ConvertedAmt - (t.value_new + VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).OverUnder) + n.records[t.index].Discount)).toFixed(i), n.records[t.index].VA009_RecivedAmt = n.get(t.recid).changes.VA009_RecivedAmt) : n.get(t.recid).changes.OverUnder == undefined ? VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder) > 0 ? (n.get(t.recid).changes.OverUnder = (n.records[t.index].ConvertedAmt - (t.value_new + n.records[t.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).Discount))).toFixed(i), n.records[t.index].OverUnder = n.get(t.recid).changes.OverUnder) : (n.get(t.recid).changes.VA009_RecivedAmt = (n.records[t.index].ConvertedAmt - (t.value_new + n.records[t.index].OverUnder + VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).Discount))).toFixed(i), n.records[t.index].VA009_RecivedAmt = n.get(t.recid).changes.VA009_RecivedAmt) : VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder) > 0 ? (n.get(t.recid).changes.OverUnder = (n.records[t.index].ConvertedAmt - (t.value_new + n.records[t.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).Discount))).toFixed(i), n.records[t.index].OverUnder = n.get(t.recid).changes.OverUnder) : (n.get(t.recid).changes.VA009_RecivedAmt = (n.records[t.index].ConvertedAmt - (t.value_new + VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).OverUnder) + VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).Discount))).toFixed(i), n.records[t.index].VA009_RecivedAmt = n.get(t.recid).changes.VA009_RecivedAmt), n.refreshCell(t.recid, "VA009_RecivedAmt"), n.refreshCell(t.recid, "OverUnder")) : n.records[t.index].PaymwentBaseType == "ARR" && (t.value_new > n.records[t.index].ConvertedAmt ? (n.records[t.index].ConvertedAmt < 0 || (VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder) > 0 ? (n.get(t.recid).changes.OverUnder = (n.records[t.index].ConvertedAmt - (t.value_new + n.records[t.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).Discount))).toFixed(i), n.records[t.index].OverUnder = n.get(t.recid).changes.OverUnder) : (n.get(t.recid).changes.VA009_RecivedAmt = (t.value_new - n.records[t.index].ConvertedAmt).toFixed(i), n.records[t.index].VA009_RecivedAmt = n.get(t.recid).changes.VA009_RecivedAmt)), n.refreshCell(t.recid, "VA009_RecivedAmt"), n.refreshCell(t.recid, "OverUnder")) : t.value_new <= n.records[t.index].ConvertedAmt && (n.get(t.recid).changes.Discount == undefined && n.get(t.recid).changes.OverUnder == undefined ? VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder) > 0 ? (n.get(t.recid).changes.OverUnder = (n.records[t.index].ConvertedAmt - (t.value_new + n.records[t.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).Discount))).toFixed(i), n.records[t.index].OverUnder = n.get(t.recid).changes.OverUnder) : (n.get(t.recid).changes.VA009_RecivedAmt = (n.records[t.index].ConvertedAmt - (t.value_new + n.records[t.index].OverUnder + n.records[t.index].Discount)).toFixed(i), n.records[t.index].VA009_RecivedAmt = n.get(t.recid).changes.VA009_RecivedAmt) : n.get(t.recid).changes.Discount == undefined ? VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder) > 0 ? (n.get(t.recid).changes.OverUnder = (n.records[t.index].ConvertedAmt - (t.value_new + n.records[t.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).Discount))).toFixed(i), n.records[t.index].OverUnder = n.get(t.recid).changes.OverUnder) : (n.get(t.recid).changes.VA009_RecivedAmt = (n.records[t.index].ConvertedAmt - (t.value_new + VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).OverUnder) + n.records[t.index].Discount)).toFixed(i), n.records[t.index].VA009_RecivedAmt = n.get(t.recid).changes.VA009_RecivedAmt) : n.get(t.recid).changes.OverUnder == undefined ? VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder) > 0 ? (n.get(t.recid).changes.OverUnder = (n.records[t.index].ConvertedAmt - (t.value_new + n.records[t.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).Discount))).toFixed(i), n.records[t.index].OverUnder = n.get(t.recid).changes.OverUnder) : (n.get(t.recid).changes.VA009_RecivedAmt = (n.records[t.index].ConvertedAmt - (t.value_new + n.records[t.index].OverUnder + VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).Discount))).toFixed(i), n.records[t.index].VA009_RecivedAmt = n.get(t.recid).changes.VA009_RecivedAmt) : VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder) > 0 ? (n.get(t.recid).changes.OverUnder = (n.records[t.index].ConvertedAmt - (t.value_new + n.records[t.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).Discount))).toFixed(i), n.records[t.index].OverUnder = n.get(t.recid).changes.OverUnder) : (n.get(t.recid).changes.VA009_RecivedAmt = (n.records[t.index].ConvertedAmt - (t.value_new + VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).OverUnder) + VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).Discount))).toFixed(i), n.records[t.index].VA009_RecivedAmt = n.get(t.recid).changes.VA009_RecivedAmt), n.refreshCell(t.recid, "VA009_RecivedAmt"), n.refreshCell(t.recid, "OverUnder")))); t.column == 9 && (t.value_new = t.value_new == "" ? 0 : vr.GetConvertedNumber(t.value_new, vt), n.records[t.index].Discount = t.value_new.toFixed(i), n.records[t.index].PaymwentBaseType == "APP" ? t.value_new > n.records[t.index].ConvertedAmt ? (n.get(t.recid).changes.VA009_RecivedAmt = ((t.value_new - n.records[t.index].ConvertedAmt) * -1).toFixed(i), n.records[t.index].VA009_RecivedAmt = n.get(t.recid).changes.VA009_RecivedAmt, n.refreshCell(t.recid, "VA009_RecivedAmt")) : t.value_new < n.records[t.index].ConvertedAmt && (n.get(t.recid).changes.Writeoff == undefined && n.get(t.recid).changes.OverUnder == undefined ? VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder) > 0 ? (n.get(t.recid).changes.OverUnder = (n.records[t.index].ConvertedAmt - (t.value_new + n.records[t.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(n.records[t.index].Writeoff))).toFixed(i), n.records[t.index].OverUnder = n.get(t.recid).changes.OverUnder) : (n.get(t.recid).changes.VA009_RecivedAmt = (n.records[t.index].ConvertedAmt - (t.value_new + n.records[t.index].OverUnder + n.records[t.index].Writeoff)).toFixed(i), n.records[t.index].VA009_RecivedAmt = n.get(t.recid).changes.VA009_RecivedAmt) : n.get(t.recid).changes.Writeoff == undefined ? VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder) > 0 ? (n.get(t.recid).changes.OverUnder = (n.records[t.index].ConvertedAmt - (t.value_new + n.records[t.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(n.records[t.index].Writeoff))).toFixed(i), n.records[t.index].OverUnder = n.get(t.recid).changes.OverUnder) : (n.get(t.recid).changes.VA009_RecivedAmt = (n.records[t.index].ConvertedAmt - (t.value_new + VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder) + n.records[t.index].Writeoff)).toFixed(i), n.records[t.index].VA009_RecivedAmt = n.get(t.recid).changes.VA009_RecivedAmt) : n.get(t.recid).changes.OverUnder == undefined ? VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder) > 0 ? (n.get(t.recid).changes.OverUnder = (n.records[t.index].ConvertedAmt - (t.value_new + n.records[t.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(n.records[t.index].Writeoff))).toFixed(i), n.records[t.index].OverUnder = n.get(t.recid).changes.OverUnder) : (n.get(t.recid).changes.VA009_RecivedAmt = (n.records[t.index].ConvertedAmt - (t.value_new + n.records[t.index].OverUnder + VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Writeoff))).toFixed(i), n.records[t.index].VA009_RecivedAmt = n.get(t.recid).changes.VA009_RecivedAmt) : VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder) > 0 ? (n.get(t.recid).changes.OverUnder = (n.records[t.index].ConvertedAmt - (t.value_new + n.records[t.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(n.records[t.index].Writeoff))).toFixed(i), n.records[t.index].OverUnder = n.get(t.recid).changes.OverUnder) : (n.get(t.recid).changes.VA009_RecivedAmt = (n.records[t.index].ConvertedAmt - (t.value_new + VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder) + VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Writeoff))).toFixed(i), n.records[t.index].VA009_RecivedAmt = n.get(t.recid).changes.VA009_RecivedAmt), n.refreshCell(t.recid, "VA009_RecivedAmt"), n.refreshCell(t.recid, "OverUnder")) : n.records[t.index].PaymwentBaseType == "ARR" && (t.value_new > n.records[t.index].ConvertedAmt ? (n.records[t.index].ConvertedAmt < 0 || (VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder) > 0 ? (n.get(t.recid).changes.OverUnder = (n.records[t.index].ConvertedAmt - (t.value_new + n.records[t.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(n.records[t.index].Writeoff))).toFixed(i), n.records[t.index].OverUnder = n.get(t.recid).changes.OverUnder) : (n.get(t.recid).changes.VA009_RecivedAmt = (t.value_new - n.records[t.index].ConvertedAmt).toFixed(i), n.records[t.index].VA009_RecivedAmt = n.get(t.recid).changes.VA009_RecivedAmt)), n.refreshCell(t.recid, "VA009_RecivedAmt"), n.refreshCell(t.recid, "OverUnder")) : t.value_new <= n.records[t.index].ConvertedAmt && (n.get(t.recid).changes.Writeoff == undefined && n.get(t.recid).changes.OverUnder == undefined ? VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder) > 0 ? (n.get(t.recid).changes.OverUnder = (n.records[t.index].ConvertedAmt - (t.value_new + n.records[t.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(n.records[t.index].Writeoff))).toFixed(i), n.records[t.index].OverUnder = n.get(t.recid).changes.OverUnder) : (n.get(t.recid).changes.VA009_RecivedAmt = (n.records[t.index].ConvertedAmt - (t.value_new + n.records[t.index].OverUnder + n.records[t.index].Writeoff)).toFixed(i), n.records[t.index].VA009_RecivedAmt = n.get(t.recid).changes.VA009_RecivedAmt) : n.get(t.recid).changes.Writeoff == undefined ? VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder) > 0 ? (n.get(t.recid).changes.OverUnder = (n.records[t.index].ConvertedAmt - (t.value_new + n.records[t.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(n.records[t.index].Writeoff))).toFixed(i), n.records[t.index].OverUnder = n.get(t.recid).changes.OverUnder) : (n.get(t.recid).changes.VA009_RecivedAmt = (n.records[t.index].ConvertedAmt - (t.value_new + VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder) + n.records[t.index].Writeoff)).toFixed(i), n.records[t.index].VA009_RecivedAmt = n.get(t.recid).changes.VA009_RecivedAmt) : n.get(t.recid).changes.OverUnder == undefined ? VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder) > 0 ? (n.get(t.recid).changes.OverUnder = (n.records[t.index].ConvertedAmt - (t.value_new + n.records[t.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(n.records[t.index].Writeoff))).toFixed(i), n.records[t.index].OverUnder = n.get(t.recid).changes.OverUnder) : (n.get(t.recid).changes.VA009_RecivedAmt = (n.records[t.index].ConvertedAmt - (t.value_new + n.records[t.index].OverUnder + VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Writeoff))).toFixed(i), n.records[t.index].VA009_RecivedAmt = n.get(t.recid).changes.VA009_RecivedAmt) : VIS.Utility.Util.getValueOfDecimal(n.records[t.index].OverUnder) > 0 ? (n.get(t.recid).changes.OverUnder = (n.records[t.index].ConvertedAmt - (t.value_new + n.records[t.index].VA009_RecivedAmt + VIS.Utility.Util.getValueOfDecimal(n.records[t.index].Writeoff))).toFixed(i), n.records[t.index].OverUnder = n.get(t.recid).changes.OverUnder) : (n.get(t.recid).changes.VA009_RecivedAmt = (n.records[t.index].ConvertedAmt - (t.value_new + VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.OverUnder) + VIS.Utility.Util.getValueOfDecimal(n.get(t.recid).changes.Writeoff))).toFixed(i), n.records[t.index].VA009_RecivedAmt = n.get(t.recid).changes.VA009_RecivedAmt), n.refreshCell(t.recid, "VA009_RecivedAmt"), n.refreshCell(t.recid, "OverUnder")))); n.refreshCell(t.recid, "OverUnder"); n.refreshCell(t.recid, "Discount"); n.refreshCell(t.recid, "Writeoff"); n.refreshCell(t.recid, "ConvertedAmt"); n.refreshCell(t.recid, "VA009_RecivedAmt") } t.column == 10 && (n.records[t.index].CheckNumber = t.value_new); t.column == 11 && (n.records[t.index].CheckDate = t.value_new != "" ? t.value_new : t.value_previous != "" ? t.value_previous : t.value_original); t.column == 2 && (n.records[t.index].Description = t.value_new) }, 100) } }); n.hideColumn("recid"); n.hideColumn("TransactionType") } function lt(n) { t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GetPopUpData", type: "POST", datatype: "json", data: { InvPayids: s.toString(), bank_id: a, acctno: v, chkno: VIS.Utility.encodeText(_Cheque_no), OrderPayids: l.toString() }, success: function (t) { n(t) }, error: function () { h[0].style.visibility = "hidden"; VIS.ADialog.error("VA009_ErrorLoadingPayments") } }) } function yt(t) { var r, u, i; w = []; r = JSON.parse(t); ut = r; for (u in r) i = {}, i.recid = r[u].recid, i.C_Bpartner = r[u].C_Bpartner, i.C_Invoice_ID = r[u].C_Invoice_ID, i.C_BPartner_ID = r[u].C_BPartner_ID, i.C_InvoicePaySchedule_ID = r[u].C_InvoicePaySchedule_ID, i.CurrencyCode = r[u].CurrencyCode, i.DueAmt = r[u].DueAmt, i.VA009_RecivedAmt = r[u].DueAmt, i.OverUnder = "0", i.Writeoff = "0", i.Discount = "0", i.ConvertedAmt = r[u].DueAmt, i.C_Currency_ID = r[u].C_Currency_ID, i.AD_Org_ID = r[u].AD_Org_ID, i.AD_Client_ID = r[u].AD_Client_ID, i.CheckDate = new Date, i.CheckNumber = null, i.ValidMonths = null, i.VA009_PaymentMode = r[u].VA009_PaymentMode, i.TransactionType = r[u].TransactionType, i.PaymwentBaseType = r[u].PaymwentBaseType, w.push(i); w2utils.encodeTags(w); n.add(w); h[0].style.visibility = "hidden" } function pt(n) { n = JSON.parse(n); y.find(".VA009-payment-wrap").remove(); o.find(".VA009-right-data-main").remove(); o.find(".VA009-accordion").remove(); b = 1; s = []; l = []; p = []; d = []; g(); it.prop("checked", !1); nt(); h[0].style.visibility = "hidden"; VIS.ADialog.info("", null, n, null) } function tt() { i = null; kt = null; STAT_cmbBank = null; STAT_cmbBankAccount = null; STAT_txtStatementNo = null; STAT_ctrlLoadFile = null; STAT_ctrlLoadFileTxt = null; n.destroy() } var a, v, i, r, u; ru; _Cheque_no = ""; a = 0; v = 0; h[0].style.visibility = "visible"; kt = t("<div class='VA009-popform-content vis-formouterwrpdiv' style='min-height:385px !important'>"); i = ""; i += "<div class='VA009-popfrm-wrap' style='height:auto;'><div class='VA009-popCheck-data input-group vis-input-wrap' > <div class='vis-control-wrap'><select id='VA009_POP_cmbOrg_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_Org") + "<\/label><\/div><\/div> <div class='VA009-popCheck-data input-group vis-input-wrap' > <div class='vis-control-wrap'><select id='VA009_POP_cmbDocType_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_DocType") + "<\/label><\/div><\/div> <div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbPaymthd_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_PayMthd") + "<\/label><\/div><\/div><div class='VA009-popCheck-data input-group vis-input-wrap' > <div class='vis-control-wrap'><select id='VA009_POP_cmbBank_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_Bank") + "<\/label><\/div><\/div> <div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbBankAccount_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_BankAccount") + "<\/label><\/div><\/div><div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbCurrencyType_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_CurrencyType") + "<\/label><\/div><\/div><div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_AccountDate_" + f.windowNo + "'><label>" + VIS.Msg.getMsg("AccountDate") + "<\/label> <\/div><\/div><div class='VA009-popCheck-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_TransactionDate" + f.windowNo + "' ><label>" + VIS.Msg.getMsg("TransactionDate") + "<\/label><\/div><\/div><div class='VA009-grid-container'><div class='VA009-table-container' id='VA009_btnPopupRecGrid'><\/div><\/div>"; kt.append(i); et(); r = new Date; u = r.getFullYear() + "-" + ("0" + (r.getMonth() + 1)).slice(-2) + "-" + ("0" + r.getDate()).slice(-2); e.val(u); rt.val(u); fi = new VIS.ChildDialog; fi.setContent(kt); fi.setTitle(VIS.Msg.getMsg("VA009_LoadChequePaymentRec")); fi.setWidth("80%"); fi.setEnableResize(!0); fi.setModal(!0); (s.toString() != "" || l.toString() != "") && ft(""); $POP_cmbOrg.on("change", function () { VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val()) == 0 ? $POP_cmbOrg.addClass("vis-ev-col-mandatory") : (tr($RPOP_cmbBank, VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())), $RPOP_cmbBank.val(0).prop("selected", !0), $RPOP_cmbBank.addClass("vis-ev-col-mandatory"), $RPOP_cmbBankAccount.empty(), $RPOP_cmbBankAccount.append("<option value='0'><\/option>"), $RPOP_cmbBankAccount.addClass("vis-ev-col-mandatory"), $POP_cmbOrg.removeClass("vis-ev-col-mandatory")); k.LoadTargetDocType($POP_targetDocType, at) }); $RPOP_cmbBank.on("change", function () { function n(n) { if ($RPOP_cmbBankAccount.append("<option value='0'><\/option>"), n != null && n.length > 0) for (var t in n) $RPOP_cmbBankAccount.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].C_BankAccount_ID) + ">" + VIS.Utility.encodeText(n[t].AccountNo) + "<\/option>") } $RPOP_cmbBankAccount.empty(); VIS.Utility.Util.getValueOfInt($RPOP_cmbBank.val()) == 0 ? ($RPOP_cmbBank.addClass("vis-ev-col-mandatory"), $RPOP_cmbBankAccount.addClass("vis-ev-col-mandatory")) : $RPOP_cmbBank.removeClass("vis-ev-col-mandatory"); VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadBankAccount", { Bank_ID: $RPOP_cmbBank.val(), Orgs: $POP_cmbOrg.val() }, n) }); $RPOP_cmbBankAccount.on("change", function () { VIS.Utility.Util.getValueOfInt($RPOP_cmbBankAccount.val()) == 0 ? $RPOP_cmbBankAccount.addClass("vis-ev-col-mandatory") : $RPOP_cmbBankAccount.removeClass("vis-ev-col-mandatory"); t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GetConvertedAmt", type: "POST", datatype: "json", async: !0, data: { PaymentData: JSON.stringify(ut), BankAccount: $RPOP_cmbBankAccount.val(), CurrencyType: $pop_cmbCurrencyType.val(), dateAcct: e.val(), _org_Id: $POP_cmbOrg.val() <= 0 ? 0 : $POP_cmbOrg.val() }, success: function (n) { c(n) }, error: function (n) { console.log(n); VIS.ADialog.error("VA009_ErrorLoadingPayments") } }) }); $pop_cmbCurrencyType.on("change", function () { t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GetConvertedAmt", type: "POST", datatype: "json", async: !0, data: { PaymentData: JSON.stringify(ut), BankAccount: $RPOP_cmbBankAccount.val(), CurrencyType: $pop_cmbCurrencyType.val(), dateAcct: e.val(), _org_Id: $POP_cmbOrg.val() <= 0 ? 0 : $POP_cmbOrg.val() }, success: function (n) { c(n) }, error: function (n) { console.log(n); VIS.ADialog.error("VA009_ErrorLoadingPayments") } }) }); e.on("change", function () { e.val() == "" ? e.addClass("vis-ev-col-mandatory") : e.removeClass("vis-ev-col-mandatory"); t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GetConvertedAmt", type: "GET", datatype: "json", async: !0, data: { PaymentData: JSON.stringify(ut), BankAccount: $RPOP_cmbBankAccount.val(), CurrencyType: $pop_cmbCurrencyType.val(), dateAcct: e.val(), _org_Id: $POP_cmbOrg.val() <= 0 ? 0 : $POP_cmbOrg.val() }, success: function (n) { c(n) }, error: function (n) { console.log(n); VIS.ADialog.error("VA009_ErrorLoadingPayments") } }) }); $POP_targetDocType.on("change", function () { VIS.Utility.Util.getValueOfInt($POP_targetDocType.val()) == 0 ? $POP_targetDocType.addClass("vis-ev-col-mandatory") : $POP_targetDocType.removeClass("vis-ev-col-mandatory") }); fi.onOkClick = function () { var o = [], r, i, s, u, f; if (n.sort(["C_BPartner_ID", "CheckNumber"], "asc"), n.selectAll(), n.getSelection().length > 0) if (VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val()) > 0) if (VIS.Utility.Util.getValueOfInt($POP_targetDocType.val()) > 0) if (VIS.Utility.Util.getValueOfInt($RPOP_cmbBank.val()) > 0) if (VIS.Utility.Util.getValueOfInt($RPOP_cmbBankAccount.val()) > 0) if (VIS.Utility.Util.getValueOfInt($POP_PayMthd.val()) > 0) if (e.val() != "" && e.val() != null) for (r = 0; r < n.getSelection().length; r++) { if (i = {}, s = 0, i.C_BPartner_ID = n.get(n.getSelection()[r]).C_BPartner_ID, i.Description = n.get(n.getSelection()[r]).Description, i.C_Invoice_ID = n.get(n.getSelection()[r]).C_Invoice_ID, i.AD_Org_ID = VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val()), i.TargetDocType = VIS.Utility.Util.getValueOfInt($POP_targetDocType.val()), i.AD_Client_ID = n.get(n.getSelection()[r]).AD_Client_ID, i.C_Currency_ID = n.get(n.getSelection()[r]).C_Currency_ID, i.C_InvoicePaySchedule_ID = n.get(n.getSelection()[r]).C_InvoicePaySchedule_ID, i.TransactionType = n.get(n.getSelection()[r]).TransactionType, n.get(n.getSelection()[r]).CheckDate != "") { if (u = new Date(n.get(n.getSelection()[r]).CheckDate), u = new Date(u.setHours(0, 0, 0, 0)), f = new Date(e.val()), f = new Date(f.setHours(0, 0, 0, 0)), u > f) return VIS.ADialog.info("VIS_CheckDateCantbeGreaterSys"), n.selectNone(), !1; i.CheckDate = n.get(n.getSelection()[r]).CheckDate } else return VIS.ADialog.info("VA009_PLCheckDate"), n.selectNone(), !1; if (i.DateTrx = VIS.Utility.Util.getValueOfDate(rt.val()), i.DateAcct = VIS.Utility.Util.getValueOfDate(e.val()), i.C_BankAccount_ID = VIS.Utility.Util.getValueOfInt($RPOP_cmbBankAccount.val()), i.C_Bank_ID = VIS.Utility.Util.getValueOfInt($RPOP_cmbBank.val()), i.DueAmt = n.get(n.getSelection()[r]).DueAmt, i.ConvertedAmt = n.get(n.getSelection()[r]).ConvertedAmt, i.PaymwentBaseType = n.get(n.getSelection()[r]).PaymwentBaseType, i.OverUnder = n.get(n.getSelection()[r]).OverUnder, i.Discount = n.get(n.getSelection()[r]).Discount, i.Writeoff = n.get(n.getSelection()[r]).Writeoff, i.From = "Rec", n.get(n.getSelection()[r]).CheckNumber != null && n.get(n.getSelection()[r]).CheckNumber != "") i.CheckNumber = n.get(n.getSelection()[r]).CheckNumber; else return VIS.ADialog.info("VA009_PLCheckNumber"), n.selectNone(), !1; if (VIS.Utility.Util.getValueOfInt(n.get(n.getSelection()[r]).VA009_RecivedAmt) != 0) i.VA009_RecivedAmt = n.get(n.getSelection()[r]).VA009_RecivedAmt; else return VIS.ADialog.info("VA009_PLRecivedAmt"), n.selectNone(), !1; i.CurrencyType = $pop_cmbCurrencyType.val(); i.VA009_PaymentMethod_ID = $POP_PayMthd.val(); o.push(i) } else return VIS.ADialog.info("VA009_PLSelectAcctDate"), n.selectNone(), !1; else return VIS.ADialog.info("VA009_PLSelectPaymentMethod"), n.selectNone(), !1; else return VIS.ADialog.info("VA009_PLSelectBankAccount"), n.selectNone(), !1; else return VIS.ADialog.info("VA009_PLSelectBank"), n.selectNone(), !1; else return VIS.ADialog.info("VA009_PlsSelectDocumentType"), n.selectNone(), !1; else return VIS.ADialog.info("VA009_PlsSelectOrg"), n.selectNone(), !1; h[0].style.visibility = "visible"; t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GeneratePayments", type: "POST", datatype: "json", async: !0, data: { PaymentData: JSON.stringify(o) }, success: function (n) { pt(n) }, error: function (n) { console.log(n); h[0].style.visibility = "hidden"; VIS.ADialog.error("VA009_ErrorLoadingPayments") } }) }; fi.onCancelCLick = function () { n.clear(); tt() }; fi.onClose = function () { n.clear(); tt() } }, Cash_Dialog: function () { function lt() { function n(n) { if ($pop_cmbCurrencyType.append("<option value='0'><\/option>"), n.length > 0) { for (var t in n) $pop_cmbCurrencyType.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID) + ">" + VIS.Utility.encodeText(n[t].Name) + "<\/option>"), VIS.Utility.encodeText(n[t].IsDefault) == "Y" && (dt = VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID)); $pop_cmbCurrencyType.val(dt) } } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/loadCurrencyType", null, n) } function yt() { function n(n) { if ($POP_cmbOrg.append(" <option value = 0><\/option>"), n.length > 0) for (var t in n) $POP_cmbOrg.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].AD_Org_ID) + ">" + VIS.Utility.encodeText(n[t].Name) + "<\/option>"); $POP_cmbOrg.prop("selectedIndex", 0) } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadOrganization", null, n) } function pt() { var i = !1, n; l.length > 0 && s.length == 0 && (i = !0); n = []; n.length == 0 && (n.push({ field: "C_Bpartner", caption: VIS.Msg.getMsg("VA009_BPartner"), sortable: !0, size: "15%" }), n.push({ field: "Description", caption: VIS.Msg.getMsg("Description"), sortable: !0, size: "15%", editable: { type: "text" } }), n.push({ field: "CurrencyCode", caption: VIS.Msg.getMsg("VA009_Currency"), sortable: !0, size: "8%" }), n.push({ field: "DueAmt", caption: VIS.Msg.getMsg("VA009_DueAmt"), sortable: !0, size: "12%", style: "text-align: right", render: function (n) { var t = n.DueAmt; return parseFloat(t).toLocaleString() } }), n.push({ field: "ConvertedAmt", caption: VIS.Msg.getMsg("VA009_ConvertedAmt"), sortable: !0, size: "13%", style: "text-align: right", render: function (n) { var t = n.ConvertedAmt; return parseFloat(t).toLocaleString() } }), n.push({ field: "VA009_RecivedAmt", caption: VIS.Msg.getMsg("VA009_ReceivedAmt"), sortable: !0, size: "12%", style: "text-align: right", hidden: i, render: function (n) { var t = n.VA009_RecivedAmt; return t = gt(event, t, t), parseFloat(t).toLocaleString() }, editable: { type: "number" } }), n.push({ field: "OverUnder", caption: VIS.Msg.getMsg("VA009_OverUnder"), sortable: !0, size: "9%", style: "text-align: right", hidden: i, render: function (n) { var t = n.OverUnder; return parseFloat(t).toLocaleString() } }), n.push({ field: "Writeoff", caption: VIS.Msg.getMsg("VA009_Writeoff"), sortable: !0, size: "9%", style: "text-align: right", hidden: i, render: function (n) { var t = n.Writeoff; return t = gt(event, t, t), parseFloat(t).toLocaleString() }, editable: { type: "number" } }), n.push({ field: "Discount", caption: VIS.Msg.getMsg("VA009_Discount"), sortable: !0, size: "9%", style: "text-align: right", hidden: i, render: function (n) { var t = n.Discount; return t = gt(event, t, t), parseFloat(t).toLocaleString() }, editable: { type: "number" } }), n.push({ field: "recid", caption: VIS.Msg.getMsg("VA009_srno"), sortable: !0, size: "1%" })); u = null; u = ft.w2grid({ name: "CashGrid", recordHeight: 25, columns: n, method: "GET", multiSelect: !0, onEditField: function (n) { (n.column == 6 || n.column == 8 || n.column == 9) && u.get(n.recid).TransactionType == "Order" && (n.isCancelled = !0); n.onComplete = function (n) { if (id = n.recid, n.column == 8 || n.column == 7 || n.column == 5) { u.records[n.index][u.columns[n.column].field] = gt(n, u.records[n.index][u.columns[n.column].field]); var i = r.GetFormatAmount(u.records[n.index][u.columns[n.column].field], "init", vt); u.records[n.index][u.columns[n.column].field] = r.GetConvertedString(i, vt); t("#grid_CashGrid_edit_" + id + "_" + n.column).keydown(function (n) { var t = br.isDecimalSeparatorDot(window.navigator.language); if (t || n.keyCode != 190 && n.keyCode != 110) { if (t && n.keyCode == 188) return !1 } else return !1; return n.target.value.contains(".") && (n.which == 110 || n.which == 190 || n.which == 188) && (this.value = this.value.replace(".", "")), n.target.value.contains(",") && (n.which == 110 || n.which == 190 || n.which == 188) && (this.value = this.value.replace(",", "")), n.keyCode != 8 && n.keyCode != 9 && (n.keyCode < 37 || n.keyCode > 40) && (n.keyCode < 48 || n.keyCode > 57) && (n.keyCode < 96 || n.keyCode > 105) && n.keyCode != 109 && n.keyCode != 189 && n.keyCode != 110 && n.keyCode != 144 && n.keyCode != 188 && n.keyCode != 190 ? !1 : void 0 }) } } } }); u.hideColumn("recid") } function wt() { function t(n) { if ($Cash_cmbcashbk.empty(), $Cash_cmbcashbk.addClass("vis-ev-col-mandatory"), $Cash_cmbcashbk.append("<option value='0'><\/option>"), n != null && n.length > 0) for (var t in n) $Cash_cmbcashbk.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].C_CashBook_ID) + ">" + VIS.Utility.encodeText(n[t].Name) + "<\/option>"); $Cash_cmbcashbk.prop("selectedIndex", 0) } var n = $POP_cmbOrg.val(); n != null && n != "" && VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadCashBook", { Orgs: n }, t) } function bt() { $Cash_cmbcashbk = $cash.find("#VA009_POP_Txtcashbk_" + f.windowNo); ft = $cash.find("#VA009_btnPopupGrid"); $pop_cmbCurrencyType = $cash.find("#VA009_POP_cmbCurrencyType_" + f.windowNo); e = $cash.find("#VA009_AccountDate_" + f.windowNo); rt = $cash.find("#VA009_TransactionDate" + f.windowNo); $POP_cmbOrg = $cash.find("#VA009_POP_cmbOrg_" + f.windowNo); $POP_cmbOrg.addClass("vis-ev-col-mandatory"); $POP_targetDocType = $cash.find("#VA009_POP_cmbDocType_" + f.windowNo); $POP_targetDocType.addClass("vis-ev-col-mandatory") } function kt(n) { t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GetPopUpData", type: "POST", datatype: "json", data: { InvPayids: s.toString(), bank_id: ht, acctno: ct, chkno: VIS.Utility.encodeText(st), OrderPayids: l.toString() }, success: function (t) { n(t) }, error: function () { h[0].style.visibility = "hidden"; VIS.ADialog.error("VA009_ErrorLoadingPayments") } }) } function a(n) { var t, r, i; u.clear(); w = []; t = JSON.parse(n); ut = t; for (r in t) i = {}, i.recid = t[r].recid, i.C_Bpartner = t[r].C_Bpartner, i.C_Invoice_ID = t[r].C_Invoice_ID, i.C_InvoicePaySchedule_ID = t[r].C_InvoicePaySchedule_ID, i.CurrencyCode = t[r].CurrencyCode, i.DueAmt = t[r].DueAmt, i.C_BPartner_ID = t[r].C_BPartner_ID, i.C_Currency_ID = t[r].C_Currency_ID, i.AD_Org_ID = t[r].AD_Org_ID, i.AD_Client_ID = t[r].AD_Client_ID, i.VA009_PaymentMode = t[r].VA009_PaymentMode, i.ConvertedAmt = t[r].convertedAmt, i.PaymwentBaseType = t[r].PaymwentBaseType, i.OverUnder = "0", i.Writeoff = "0", i.Discount = "0", i.VA009_RecivedAmt = t[r].convertedAmt, i.TransactionType = t[r].TransactionType, w.push(i); t[0].ERROR == "ConversionNotFound" ? VIS.ADialog.info("VA009_ConversionNotFound") : t[0].ERROR == "VA009_DocTypeNotFound" && VIS.ADialog.info("VA009_DocTypeNotFound"); w2utils.encodeTags(w); u.add(w); h[0].style.visibility = "hidden" } function ti(n) { n = JSON.parse(n); y.find(".VA009-payment-wrap").remove(); o.find(".VA009-right-data-main").remove(); o.find(".VA009-accordion").remove(); b = 1; s = []; l = []; p = []; d = []; g(); it.prop("checked", !1); nt(); h[0].style.visibility = "hidden"; VIS.ADialog.error("", null, n, null) } function ot() { _Cash = null; $cash = null; STAT_cmbBank = null; STAT_cmbBankAccount = null; STAT_txtStatementNo = null; STAT_ctrlLoadFile = null; STAT_ctrlLoadFileTxt = null; w2ui.CashGrid.destroy() } var ft, st = "", ht = 0, ct = 0, i = 0, v, r, c, tt, n, et; h[0].style.visibility = "visible"; r = null; lblAmount = t("<label>"); i = new VIS.Controls.VAmountTextBox("VA009_POP_Txtopngbal_" + f.windowNo + "", !1, !0, !0, 50, 100, VIS.DisplayType.Amount, VIS.Msg.getMsg("Amount")); lblAmount.append(VIS.Msg.getMsg("VA009_lblopngbal")); i.setValue(0); r = VIS.DisplayType.GetNumberFormat(VIS.DisplayType.Amount); v = t("<div class='VA009-popform-data input-group vis-input-wrap'>"); divAmountCtrlWrap = t("<div class='vis-control-wrap'>"); v.append(divAmountCtrlWrap); divAmountCtrlWrap.append(i.getControl().attr("placeholder", " ").attr("data-placeholder", "")).append(lblAmount); $cash = t("<div class='VA009-popform-content vis-formouterwrpdiv' style='min-height:385px !important'>"); _Cash = t("<div class='VA009-popfrm-wrap'>"); cashData = t("<div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbOrg_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_Org") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap' > <div class='vis-control-wrap'><select id='VA009_POP_cmbDocType_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_DocType") + "<\/label><\/div><\/div> <div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_Txtcashbk_" + f.windowNo + "'> <\/select><label>" + VIS.Msg.getMsg("VA009_lblcashbook") + "<\/label><\/div><\/div> "); cashDataa = t("<div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbCurrencyType_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_CurrencyType") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_AccountDate_" + f.windowNo + "' placeholder=' ' data-placeholder=''> <label>" + VIS.Msg.getMsg("AccountDate") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_TransactionDate" + f.windowNo + "' placeholder=' ' data-placeholder='' ><label>" + VIS.Msg.getMsg("TransactionDate") + "<\/label><\/div> <\/div><div class='VA009-table-container' id='VA009_btnPopupGrid'>  <\/div><\/div>"); _Cash.append(cashData).append(v).append(cashDataa); $cash.append(_Cash); bt(); c = new Date; tt = c.getFullYear() + "-" + ("0" + (c.getMonth() + 1)).slice(-2) + "-" + ("0" + c.getDate()).slice(-2); e.val(tt); rt.val(tt); n = new VIS.ChildDialog; n.setContent($cash); ni.hasClass("VA009-active-tab") ? n.setTitle(VIS.Msg.getMsg("VA009_LoadCashReceipts")) : n.setTitle(VIS.Msg.getMsg("VA009_LoadCashPayment")); n.setWidth("60%"); n.setHeight(window.innerHeight - 120); n.setEnableResize(!0); n.setModal(!0); (s.toString() != "" || l.toString() != "") && (et = null, et == null ? (n.show(), pt(), kt(a), lt(), yt(), k.LoadTargetDocType($POP_targetDocType, at)) : (h[0].style.visibility = "hidden", VIS.ADialog.info("VA009_PleaseSelctonlyCash"))); i.addVetoableChangeListener(this); $Cash_cmbcashbk.on("change", function () { function r(r) { r != null && (i.setValue(r.CompletedBalance), n = r.C_Currency_ID, nf = n); window.setTimeout(function () { t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GetCashJournalConvertedAmt", type: "POST", datatype: "json", async: !0, data: { PaymentData: JSON.stringify(ut), CurrencyCashBook: n, CurrencyType: $pop_cmbCurrencyType.val(), dateAcct: e.val(), _org_Id: $POP_cmbOrg.val() <= 0 ? 0 : $POP_cmbOrg.val() }, success: function (n) { a(n) }, error: function (n) { console.log(n); VIS.ADialog.error("VA009_ErrorLoadingPayments") } }) }, 200) } i.setValue(0); VIS.Utility.Util.getValueOfInt($Cash_cmbcashbk.val()) == 0 ? $Cash_cmbcashbk.addClass("vis-ev-col-mandatory") : $Cash_cmbcashbk.removeClass("vis-ev-col-mandatory"); VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/GetCashBookData", { CashBook: $Cash_cmbcashbk.val() }, r); var n = 0 }); $pop_cmbCurrencyType.on("change", function () { t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GetCashJournalConvertedAmt", type: "POST", datatype: "json", async: !0, data: { PaymentData: JSON.stringify(ut), CurrencyCashBook: nf, CurrencyType: $pop_cmbCurrencyType.val(), dateAcct: e.val(), _org_Id: $POP_cmbOrg.val() <= 0 ? 0 : $POP_cmbOrg.val() }, success: function (n) { a(n) }, error: function (n) { console.log(n); VIS.ADialog.error("VA009_ErrorLoadingPayments") } }) }); e.on("change", function () { e.val() ? e.removeClass("vis-ev-col-mandatory") : e.addClass("vis-ev-col-mandatory"); t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GetCashJournalConvertedAmt", type: "POST", datatype: "json", async: !0, data: { PaymentData: JSON.stringify(ut), CurrencyCashBook: nf, CurrencyType: $pop_cmbCurrencyType.val(), dateAcct: e.val(), _org_Id: $POP_cmbOrg.val() <= 0 ? 0 : $POP_cmbOrg.val() }, success: function (n) { a(n) }, error: function (n) { console.log(n); VIS.ADialog.error("VA009_ErrorLoadingPayments") } }) }); $POP_cmbOrg.on("change", function () { VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val()) == 0 ? ($POP_cmbOrg.addClass("vis-ev-col-mandatory"), $Cash_cmbcashbk.empty()) : ($POP_cmbOrg.removeClass("vis-ev-col-mandatory"), wt()); k.LoadTargetDocType($POP_targetDocType, at) }); $POP_targetDocType.on("change", function () { VIS.Utility.Util.getValueOfInt($POP_targetDocType.val()) == 0 ? $POP_targetDocType.addClass("vis-ev-col-mandatory") : $POP_targetDocType.removeClass("vis-ev-col-mandatory") }); u.on("change", function (n) { window.setTimeout(function () { if (w2ui.CashGrid.getChanges(n.recid) != undefined) { var t = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/GetCurrencyPrecision", { BankAccount_ID: $Cash_cmbcashbk.val(), CurrencyFrom: "C" }, null); if ((t == null || t == 0) && (t = 2), n.column == 1 && (u.records[n.index].Description = n.value_new), u.records[n.index].ConvertedAmt = parseFloat(u.records[n.index].ConvertedAmt), u.records[n.index].VA009_RecivedAmt = parseFloat(u.records[n.index].VA009_RecivedAmt), u.records[n.index].OverUnder = parseFloat(u.records[n.index].OverUnder), u.records[n.index].Writeoff = parseFloat(u.records[n.index].Writeoff), u.records[n.index].Discount = parseFloat(u.records[n.index].Discount), n.column == 5) { if (n.value_new = n.value_new == "" ? 0 : r.GetConvertedNumber(n.value_new, vt), n.value_new > u.records[n.index].ConvertedAmt) { VIS.ADialog.error("MoreScheduleAmount"); n.value_new = n.value_original; u.get(n.recid).changes.VA009_RecivedAmt = n.value_new; u.records[n.index].VA009_RecivedAmt = u.get(n.recid).changes.VA009_RecivedAmt; u.refreshCell(n.recid, "VA009_RecivedAmt"); return } u.records[n.index].VA009_RecivedAmt = n.value_new.toFixed(t); u.refreshCell(n.recid, "VA009_RecivedAmt"); (u.records[n.index].PaymwentBaseType == "ARR" || u.records[n.index].PaymwentBaseType == "APP") && (n.value_new > u.records[n.index].ConvertedAmt ? (u.records[n.index].ConvertedAmt > 0 ? (u.get(n.recid).changes.OverUnder = (u.records[n.index].ConvertedAmt - n.value_new).toFixed(t), u.records[n.index].OverUnder = VIS.Utility.Util.getValueOfDecimal(u.get(n.recid).changes.OverUnder), u.get(n.recid).changes.Writeoff = 0) : (u.get(n.recid).changes.OverUnder = (u.records[n.index].ConvertedAmt - n.value_new).toFixed(t), u.records[n.index].OverUnder = VIS.Utility.Util.getValueOfDecimal(u.get(n.recid).changes.OverUnder), u.get(n.recid).changes.Writeoff = 0, u.get(n.recid).Writeoff = 0), u.get(n.recid).changes.Discount = 0, u.refreshCell(n.recid, "OverUnder"), u.refreshCell(n.recid, "Discount"), u.refreshCell(n.recid, "Writeoff")) : n.value_new == u.records[n.index].ConvertedAmt ? (u.get(n.recid).changes.OverUnder = 0, u.get(n.recid).OverUnder = 0, u.get(n.recid).changes.Discount = 0, u.get(n.recid).changes.Writeoff = 0, u.get(n.recid).Discount = 0, u.get(n.recid).Writeoff = 0, u.get(n.recid).changes.VA009_RecivedAmt = n.value_new, u.records[n.index].VA009_RecivedAmt = n.value_new, u.refreshCell(n.recid, "OverUnder"), u.refreshCell(n.recid, "Discount"), u.refreshCell(n.recid, "Writeoff"), u.refreshCell(n.recid, "VA009_RecivedAmt")) : n.value_new < u.records[n.index].ConvertedAmt && (u.records[n.index].ConvertedAmt > 0 ? (u.get(n.recid).changes.OverUnder = (u.records[n.index].ConvertedAmt - n.value_new).toFixed(t), u.records[n.index].OverUnder = VIS.Utility.Util.getValueOfDecimal(u.get(n.recid).changes.OverUnder), u.get(n.recid).changes.Writeoff = 0, u.get(n.recid).Writeoff = 0) : (u.get(n.recid).changes.Writeoff = 0, u.get(n.recid).Writeoff = 0, u.get(n.recid).changes.OverUnder = (u.records[n.index].ConvertedAmt - n.value_new).toFixed(t), u.records[n.index].OverUnder = VIS.Utility.Util.getValueOfDecimal(u.get(n.recid).changes.OverUnder)), u.get(n.recid).changes.Discount = 0, u.get(n.recid).Discount = 0, u.refreshCell(n.recid, "OverUnder"), u.refreshCell(n.recid, "Discount"), u.refreshCell(n.recid, "Writeoff"))) } n.column == 7 && (n.value_new = n.value_new == "" ? 0 : r.GetConvertedNumber(n.value_new, vt), u.records[n.index].Writeoff = n.value_new.toFixed(t), (u.records[n.index].PaymwentBaseType == "ARR" || u.records[n.index].PaymwentBaseType == "APP") && (n.value_new > u.records[n.index].ConvertedAmt ? (u.records[n.index].ConvertedAmt < 0 ? u.get(n.recid).changes.Discount == undefined && u.get(n.recid).changes.OverUnder == undefined ? (w2ui.CashGrid.get(n.recid).changes.VA009_RecivedAmt = (-1 * (-1 * u.records[n.index].ConvertedAmt + (n.value_new + u.records[n.index].OverUnder + u.records[n.index].Discount))).toFixed(t), u.records[n.index].VA009_RecivedAmt = u.get(n.recid).changes.VA009_RecivedAmt) : u.get(n.recid).changes.Discount == undefined ? (w2ui.CashGrid.get(n.recid).changes.VA009_RecivedAmt = (-1 * (-1 * u.records[n.index].ConvertedAmt + (n.value_new + parseFloat(u.get(n.recid).OverUnder) + u.records[n.index].Discount))).toFixed(t), u.records[n.index].VA009_RecivedAmt = u.get(n.recid).changes.VA009_RecivedAmt) : u.get(n.recid).changes.OverUnder == undefined ? (w2ui.CashGrid.get(n.recid).changes.VA009_RecivedAmt = (-1 * (-1 * u.records[n.index].ConvertedAmt + (n.value_new + u.records[n.index].OverUnder + VIS.Utility.Util.getValueOfDecimal(u.get(n.recid).Discount)))).toFixed(t), u.records[n.index].VA009_RecivedAmt = u.get(n.recid).changes.VA009_RecivedAmt) : (u.get(n.recid).changes.VA009_RecivedAmt = (-1 * (-1 * u.records[n.index].ConvertedAmt + (n.value_new + parseFloat(u.get(n.recid).OverUnder) + VIS.Utility.Util.getValueOfDecimal(u.get(n.recid).Discount)))).toFixed(t), u.records[n.index].VA009_RecivedAmt = u.get(n.recid).changes.VA009_RecivedAmt) : (u.get(n.recid).changes.VA009_RecivedAmt = (n.value_new - u.records[n.index].ConvertedAmt).toFixed(t), u.records[n.index].VA009_RecivedAmt = u.get(n.recid).changes.VA009_RecivedAmt), u.refreshCell(n.recid, "VA009_RecivedAmt")) : n.value_new <= u.records[n.index].ConvertedAmt && (u.get(n.recid).changes.Writeoff || (u.get(n.recid).changes.Writeoff = 0), u.get(n.recid).changes.Discount == undefined && u.get(n.recid).changes.OverUnder == undefined ? VIS.Utility.Util.getValueOfDecimal(u.records[n.index].OverUnder) > 0 ? (w2ui.CashGrid.get(n.recid).changes.OverUnder = (u.records[n.index].ConvertedAmt - (n.value_new + u.records[n.index].VA009_RecivedAmt + u.records[n.index].Discount)).toFixed(t), u.records[n.index].OverUnder = u.get(n.recid).changes.OverUnder) : (w2ui.CashGrid.get(n.recid).changes.VA009_RecivedAmt = (u.records[n.index].ConvertedAmt - (n.value_new + u.records[n.index].OverUnder + u.records[n.index].Discount)).toFixed(t), u.records[n.index].VA009_RecivedAmt = u.get(n.recid).changes.VA009_RecivedAmt) : u.get(n.recid).changes.Discount == undefined ? VIS.Utility.Util.getValueOfDecimal(u.records[n.index].OverUnder) > 0 ? (w2ui.CashGrid.get(n.recid).changes.OverUnder = (u.records[n.index].ConvertedAmt - (n.value_new + u.records[n.index].VA009_RecivedAmt + u.records[n.index].Discount)).toFixed(t), u.records[n.index].OverUnder = u.get(n.recid).changes.OverUnder) : (w2ui.CashGrid.get(n.recid).changes.VA009_RecivedAmt = (u.records[n.index].ConvertedAmt - (n.value_new + parseFloat(u.get(n.recid).OverUnder) + u.records[n.index].Discount)).toFixed(t), u.records[n.index].VA009_RecivedAmt = u.get(n.recid).changes.VA009_RecivedAmt) : u.get(n.recid).changes.OverUnder == undefined ? VIS.Utility.Util.getValueOfDecimal(u.records[n.index].OverUnder) > 0 ? (w2ui.CashGrid.get(n.recid).changes.OverUnder = (u.records[n.index].ConvertedAmt - (n.value_new + u.records[n.index].VA009_RecivedAmt + u.records[n.index].Discount)).toFixed(t), u.records[n.index].OverUnder = u.get(n.recid).changes.OverUnder) : (w2ui.CashGrid.get(n.recid).changes.VA009_RecivedAmt = (u.records[n.index].ConvertedAmt - (n.value_new + u.records[n.index].OverUnder + VIS.Utility.Util.getValueOfDecimal(u.get(n.recid).Discount))).toFixed(t), u.records[n.index].VA009_RecivedAmt = u.get(n.recid).changes.VA009_RecivedAmt) : VIS.Utility.Util.getValueOfDecimal(u.records[n.index].OverUnder) > 0 ? (w2ui.CashGrid.get(n.recid).changes.OverUnder = (u.records[n.index].ConvertedAmt - (n.value_new + u.records[n.index].VA009_RecivedAmt + u.records[n.index].Discount)).toFixed(t), u.records[n.index].OverUnder = u.get(n.recid).changes.OverUnder) : (u.get(n.recid).changes.VA009_RecivedAmt = (u.records[n.index].ConvertedAmt - (n.value_new + parseFloat(u.get(n.recid).OverUnder) + VIS.Utility.Util.getValueOfDecimal(u.get(n.recid).Discount))).toFixed(t), u.records[n.index].VA009_RecivedAmt = u.get(n.recid).changes.VA009_RecivedAmt), u.refreshCell(n.recid, "VA009_RecivedAmt"), u.refreshCell(n.recid, "OverUnder")))); n.column == 8 && (n.value_new = n.value_new == "" ? 0 : r.GetConvertedNumber(n.value_new, vt), u.records[n.index].Discount = n.value_new.toFixed(t), (u.records[n.index].PaymwentBaseType == "ARR" || u.records[n.index].PaymwentBaseType == "APP") && (n.value_new > u.records[n.index].ConvertedAmt ? (u.records[n.index].ConvertedAmt < 0 ? u.get(n.recid).changes.Writeoff == undefined && u.get(n.recid).changes.OverUnder == undefined ? (w2ui.CashGrid.get(n.recid).changes.VA009_RecivedAmt = (-1 * (-1 * VIS.Utility.Util.getValueOfDecimal(u.get(n.recid).ConvertedAmt) + (n.value_new + u.records[n.index].OverUnder + u.records[n.index].Writeoff))).toFixed(t), u.records[n.index].VA009_RecivedAmt = u.get(n.recid).changes.VA009_RecivedAmt) : u.get(n.recid).changes.Writeoff == undefined ? (w2ui.CashGrid.get(n.recid).changes.VA009_RecivedAmt = (-1 * (-1 * VIS.Utility.Util.getValueOfDecimal(u.get(n.recid).ConvertedAmt) + (n.value_new + parseFloat(u.get(n.recid).OverUnder) + u.records[n.index].Writeoff))).toFixed(t), u.records[n.index].VA009_RecivedAmt = u.get(n.recid).changes.VA009_RecivedAmt) : u.get(n.recid).changes.OverUnder == undefined ? (w2ui.CashGrid.get(n.recid).changes.VA009_RecivedAmt = (-1 * (-1 * VIS.Utility.Util.getValueOfDecimal(u.get(n.recid).ConvertedAmt) + (n.value_new + u.records[n.index].OverUnder + VIS.Utility.Util.getValueOfDecimal(u.get(n.recid).Writeoff)))).toFixed(t), u.records[n.index].VA009_RecivedAmt = u.get(n.recid).changes.VA009_RecivedAmt) : (u.get(n.recid).changes.VA009_RecivedAmt = (-1 * (-1 * VIS.Utility.Util.getValueOfDecimal(u.get(n.recid).ConvertedAmt) + (n.value_new + parseFloat(u.get(n.recid).OverUnder) + VIS.Utility.Util.getValueOfDecimal(u.get(n.recid).Writeoff)))).toFixed(t), u.records[n.index].VA009_RecivedAmt = u.get(n.recid).changes.VA009_RecivedAmt) : (u.get(n.recid).changes.VA009_RecivedAmt = (n.value_new - VIS.Utility.Util.getValueOfDecimal(u.get(n.recid).ConvertedAmt)).toFixed(t), u.records[n.index].VA009_RecivedAmt = u.get(n.recid).changes.VA009_RecivedAmt), u.refreshCell(n.recid, "VA009_RecivedAmt")) : n.value_new <= u.records[n.index].ConvertedAmt && (u.get(n.recid).changes.Writeoff || (u.get(n.recid).changes.Writeoff = 0), u.get(n.recid).changes.Writeoff == undefined && u.get(n.recid).changes.OverUnder == undefined ? VIS.Utility.Util.getValueOfDecimal(u.records[n.index].OverUnder) > 0 ? (w2ui.CashGrid.get(n.recid).changes.OverUnder = (u.records[n.index].ConvertedAmt - (n.value_new + u.records[n.index].VA009_RecivedAmt + u.records[n.index].Writeoff)).toFixed(t), u.records[n.index].OverUnder = u.get(n.recid).changes.OverUnder) : (w2ui.CashGrid.get(n.recid).changes.VA009_RecivedAmt = (VIS.Utility.Util.getValueOfDecimal(u.get(n.recid).ConvertedAmt) - (n.value_new + u.records[n.index].OverUnder + u.records[n.index].Writeoff)).toFixed(t), u.records[n.index].VA009_RecivedAmt = u.get(n.recid).changes.VA009_RecivedAmt) : u.get(n.recid).changes.Writeoff == undefined ? VIS.Utility.Util.getValueOfDecimal(u.records[n.index].OverUnder) > 0 ? (w2ui.CashGrid.get(n.recid).changes.OverUnder = (u.records[n.index].ConvertedAmt - (n.value_new + u.records[n.index].VA009_RecivedAmt + u.records[n.index].Writeoff)).toFixed(t), u.records[n.index].OverUnder = u.get(n.recid).changes.OverUnder) : (w2ui.CashGrid.get(n.recid).changes.VA009_RecivedAmt = (VIS.Utility.Util.getValueOfDecimal(u.get(n.recid).ConvertedAmt) - (n.value_new + parseFloat(u.get(n.recid).OverUnder) + u.records[n.index].Writeoff)).toFixed(t), u.records[n.index].VA009_RecivedAmt = u.get(n.recid).changes.VA009_RecivedAmt) : u.get(n.recid).changes.OverUnder == undefined ? VIS.Utility.Util.getValueOfDecimal(u.records[n.index].OverUnder) > 0 ? (w2ui.CashGrid.get(n.recid).changes.OverUnder = (u.records[n.index].ConvertedAmt - (n.value_new + u.records[n.index].VA009_RecivedAmt + u.records[n.index].Writeoff)).toFixed(t), u.records[n.index].OverUnder = u.get(n.recid).changes.OverUnder) : (w2ui.CashGrid.get(n.recid).changes.VA009_RecivedAmt = (VIS.Utility.Util.getValueOfDecimal(u.get(n.recid).ConvertedAmt) - (n.value_new + u.records[n.index].OverUnder + VIS.Utility.Util.getValueOfDecimal(u.get(n.recid).Writeoff))).toFixed(t), u.records[n.index].VA009_RecivedAmt = u.get(n.recid).changes.VA009_RecivedAmt) : VIS.Utility.Util.getValueOfDecimal(u.records[n.index].OverUnder) > 0 ? (w2ui.CashGrid.get(n.recid).changes.OverUnder = (u.records[n.index].ConvertedAmt - (n.value_new + u.records[n.index].VA009_RecivedAmt + u.records[n.index].Writeoff)).toFixed(t), u.records[n.index].OverUnder = u.get(n.recid).changes.OverUnder) : (u.get(n.recid).changes.VA009_RecivedAmt = (VIS.Utility.Util.getValueOfDecimal(u.get(n.recid).ConvertedAmt) - (n.value_new + parseFloat(u.get(n.recid).OverUnder) + VIS.Utility.Util.getValueOfDecimal(u.get(n.recid).Writeoff))).toFixed(t), u.records[n.index].VA009_RecivedAmt = u.get(n.recid).changes.VA009_RecivedAmt), u.refreshCell(n.recid, "VA009_RecivedAmt"), u.refreshCell(n.recid, "OverUnder")))); u.refreshCell(n.recid, "ConvertedAmt"); u.refreshCell(n.recid, "VA009_RecivedAmt"); u.refreshCell(n.recid, "OverUnder"); u.refreshCell(n.recid, "Writeoff"); u.refreshCell(n.recid, "Discount") } }, 100) }); n.onOkClick = function () { var f = [], r, n; if (u.selectAll(), VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val()) > 0) if (VIS.Utility.Util.getValueOfInt($POP_targetDocType.val()) > 0) if (VIS.Utility.Util.getValueOfInt($Cash_cmbcashbk.val()) > 0) if (e.val() != "" && e.val() != null) if (rt.val() != "" && rt.val() != null) { if (u.getSelection().length > 0) for (r = 0; r < u.getSelection().length; r++) { if (n = {}, n.C_BPartner_ID = u.get(u.getSelection()[r]).C_BPartner_ID, n.Description = u.get(u.getSelection()[r]).Description, n.C_Invoice_ID = u.get(u.getSelection()[r]).C_Invoice_ID, n.AD_Org_ID = VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val()), n.AD_Client_ID = u.get(u.getSelection()[r]).AD_Client_ID, n.C_Currency_ID = u.get(u.getSelection()[r]).C_Currency_ID, n.C_Currency_ID = u.get(u.getSelection()[r]).C_Currency_ID, n.C_InvoicePaySchedule_ID = u.get(u.getSelection()[r]).C_InvoicePaySchedule_ID, u.get(u.getSelection()[r]).VA009_RecivedAmt != null && u.get(u.getSelection()[r]).VA009_RecivedAmt > 0) n.VA009_RecivedAmt = u.get(u.getSelection()[r]).VA009_RecivedAmt; else return VIS.ADialog.info("VA009_PLRecivedAmt"), u.selectNone(), !1; n.OverUnder = u.get(u.getSelection()[r]).OverUnder; n.Writeoff = u.get(u.getSelection()[r]).Writeoff; n.Discount = u.get(u.getSelection()[r]).Discount; n.ConvertedAmt = u.get(u.getSelection()[r]).ConvertedAmt; n.PaymwentBaseType = u.get(u.getSelection()[r]).PaymwentBaseType; n.CurrencyType = $pop_cmbCurrencyType.val(); n.DateAcct = VIS.Utility.Util.getValueOfDate(e.val()); n.DateTrx = VIS.Utility.Util.getValueOfDate(rt.val()); n.TargetDocType = VIS.Utility.Util.getValueOfInt($POP_targetDocType.val()); n.TransactionType = u.get(u.getSelection()[r]).TransactionType; f.push(n) } h[0].style.visibility = "visible"; t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GenPaymentsCash", type: "POST", datatype: "json", async: !0, data: { PaymentData: JSON.stringify(f), C_CashBook_ID: parseInt($Cash_cmbcashbk.val()), BeginningBalance: i.getValue() }, success: function (n) { ti(n) }, error: function (n) { console.log(n); h[0].style.visibility = "hidden"; VIS.ADialog.error("VA009_ErrorLoadingPayments") } }) } else return VIS.ADialog.info("VA009_PLSelectConversionDate"), u.selectNone(), !1; else return VIS.ADialog.info("VA009_PLSelectAcctDate"), u.selectNone(), !1; else return VIS.ADialog.info("VA009_PLSelectCashbook"), u.selectNone(), !1; else return VIS.ADialog.info("VA009_PlsSelectDocumentType"), u.selectNone(), !1; else return VIS.ADialog.info("VA009_PlsSelectOrg"), u.selectNone(), !1 }; n.onCancelCLick = function () { w2ui.CashGrid.clear(); ot() }; n.onClose = function () { w2ui.CashGrid.clear(); ot() }; this.vetoablechange = function (n) { console.log(n.propertyName); n.propertyName == "VA009_POP_Txtopngbal_" + f.windowNo + "" && i.setValue(n.newValue) } }, Batch_OpenDialog: function () { function u() { i = null; $opnbatch = null } var i, n, r; $opnbatch = t("<div class='VA009-popform-content' style='min-height:25px !important'>"); i = ""; i += "<div> <div class='VA009-popfrmradiowrp'><input type='radio' name='VA009_Sel" + f.windowNo + "'  value='S' checked><label>" + VIS.Msg.getMsg("VA009_BasedOnSelection") + "<\/label><\/div><div class='VA009-popfrmradiowrp'><input type='radio' name='VA009_Sel" + f.windowNo + "'  value='R'><label>" + VIS.Msg.getMsg("VA009_BasedOnRule") + "<\/label><\/div>"; $opnbatch.append(i); n = new VIS.ChildDialog; r = ""; n.setContent($opnbatch); n.setTitle(VIS.Msg.getMsg("VA009_LoadBatchPayment")); n.setWidth("30%"); n.setEnableResize(!0); n.setModal(!0); n.show(); n.onOkClick = function () { var n, t, i; r = $opnbatch.find("input[name='VA009_Sel" + f.windowNo + "']:checked").val(); h[0].style.visibility = "visible"; r == "S" ? s.toString() != "" || l.toString() != "" ? k.Batch_Dialog() : VIS.ADialog.info("VA009_PlzSelct1Pay") : r == "R" && (n = "SELECT pm.va009_paymentbasetype FROM c_invoicepayschedule cs INNER JOIN va009_paymentmethod pm  ON pm.va009_paymentmethod_id      =cs.va009_paymentmethod_id WHERE cs.c_invoicepayschedule_id IN (", n += s.length == 0 ? 0 : s.toString(), n += " ) AND pm.va009_paymentbasetype  IN ('S','B') GROUP BY pm.va009_paymentbasetype ", t = VIS.secureEngine.encrypt(n), i = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/GetPaymentBaseType", { BatchQry: t }, null), oe()); h[0].style.visibility = "hidden" }; n.onCancelCLick = function () { u() }; n.onClose = function () { u() } }, Batch_Dialog: function () { function ct() { var n = []; n.length == 0 && (n.push({ field: "recid", caption: VIS.Msg.getMsg("VA009_srno"), sortable: !0, size: "10%" }), n.push({ field: "C_Bpartner", caption: VIS.Msg.getMsg("VA009_Vendor"), sortable: !0, size: "10%" }), n.push({ field: "C_InvoicePaySchedule_ID", caption: VIS.Msg.getMsg("VA009_Schedule"), sortable: !0, size: "10%", render: function (n) { var t = tt, r = n.C_InvoicePaySchedule_ID, i; return t && (i = t.getDisplay(r)), i } }), n.push({ field: "CurrencyCode", caption: VIS.Msg.getMsg("VA009_Currency"), sortable: !0, size: "10%" }), n.push({ field: "DueAmt", caption: VIS.Msg.getMsg("VA009_DueAmt"), sortable: !0, size: "10%", style: "text-align: right", render: function (n) { var t = n.DueAmt; return parseFloat(t).toLocaleString() } }), n.push({ field: "ConvertedAmt", caption: VIS.Msg.getMsg("VA009_ConvertedAmt"), sortable: !0, size: "13%", style: "text-align: right", render: function (n) { var t = n.ConvertedAmt; return parseFloat(t).toLocaleString() } }), n.push({ field: "CheckNumber", caption: VIS.Msg.getMsg("VA009_ChkNo"), sortable: !0, size: "10%", editable: { type: "alphanumeric", autoFormat: !0, groupSymbol: " " } }), n.push({ field: "CheckDate", caption: VIS.Msg.getMsg("VA009_CheckDate"), sortable: !0, size: "10%", render: function (n) { var t; return t = n.changes == undefined || n.changes.CheckDate == "" ? n.CheckDate : n.changes.CheckDate, new Date(t).toLocaleDateString() }, style: "text-align: left", editable: { type: "date" } }), n.push({ field: "Mandate", caption: VIS.Msg.getMsg("VA009_Mandate"), sortable: !0, size: "10%", editable: { type: "text" } }), n.push({ field: "TransactionType", caption: VIS.Msg.getMsg("VA009_TransactionType"), sortable: !0, size: "1%" }), n.push({ field: "ConversionTypeId", caption: VIS.Msg.getMsg("VA009_ConversionType"), hidden: !0, sortable: !0, size: "0%" }), n.push({ field: "DiscountAmount", caption: VIS.Msg.getMsg("DiscountAmount"), hidden: !0, sortable: !0, size: "0%" }), n.push({ field: "ConvertedDiscountAmount", caption: VIS.Msg.getMsg("ConvertedDiscountAmount"), hidden: !0, sortable: !0, size: "0%" }), n.push({ field: "DiscountDate", caption: VIS.Msg.getMsg("DiscountDate"), hidden: !0, sortable: !0, size: "0%" }), n.push({ field: "C_BPartner_Location_ID", caption: VIS.Msg.getMsg("C_BPartner_Location_ID"), hidden: !0, sortable: !0, size: "0%" })); c = null; c = rt.w2grid({ name: "BatchGrid", recordHeight: 25, multiSelect: !0, columns: n }); c.hideColumn("recid", "CheckNumber", "CheckDate", "ValidMonths", "Mandate", "TransactionType", "ConversionTypeId", "DiscountAmount", "ConvertedDiscountAmount", "DiscountDate") } function lt() { $POP_cmbBank = $batch.find("#VA009_POP_cmbBank_" + f.windowNo); $POP_cmbBankAccount = $batch.find("#VA009_POP_cmbBankAccount_" + f.windowNo); $POP_cmbCurrency = $batch.find("#VA009_POP_cmbCurrency_" + f.windowNo); $POP_PayMthd = $batch.find("#VA009_POP_cmbPaymthd_" + f.windowNo); rt = $batch.find("#VA009_btnPopupGrid"); $consolidate = $batch.find("#VA009_Consolidate_" + f.windowNo); $overwritepay = $batch.find("#VA009_OverwritePayMthd_" + f.windowNo); $pop_cmbCurrencyType = $batch.find("#VA009_POP_cmbCurrencyType_" + f.windowNo); $POP_cmbOrg = $batch.find("#VA009_POP_cmbOrg_" + f.windowNo); $POP_cmbOrg.addClass("vis-ev-col-mandatory"); $POP_BtnChkDetails = $batch.find("#VA009_btnCheckDetails_" + f.windowNo); pi.hasClass("VA009-active-tab") && t("option:selected", $POP_PayMthd).attr("PaymentBaseType") == "S" ? $POP_BtnChkDetails.show() : $POP_BtnChkDetails.hide(); $POP_targetDocType = $batch.find("#VA009_POP_TargetType_" + f.windowNo); $POP_targetDocType.addClass("vis-ev-col-mandatory"); $consolidate.prop("checked", !0); $overwritepay.prop("checked", !0); e = $batch.find("#VA009_AccountDate_" + f.windowNo) } function vt(n) { t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GetPopUpData", type: "POST", datatype: "json", data: { InvPayids: s.toString(), bank_id: st, acctno: ht, chkno: VIS.Utility.encodeText(ot), OrderPayids: l.toString() }, success: function (t) { n(t) }, error: function () { VIS.ADialog.error("VA009_ErrorLoadingPayments") } }) } function yt(n) { var t, u, f; w = []; t = JSON.parse(n); i = 0; r = 0; ut = t; for (u in t) f = {}, t[u].DocBaseType == "API" ? r += t[u].convertedAmt : t[u].DocBaseType == "APC" && (i += t[u].convertedAmt), f.recid = t[u].recid, f.C_Bpartner = t[u].C_Bpartner, f.C_BPartner_Location_ID = t[u].C_BPartner_Location_ID, f.C_Invoice_ID = t[u].C_Invoice_ID, f.C_InvoicePaySchedule_ID = t[u].C_InvoicePaySchedule_ID, f.CurrencyCode = t[u].CurrencyCode, f.DueAmt = t[u].DueAmt, f.ConvertedAmt = t[u].convertedAmt, f.C_BPartner_ID = t[u].C_BPartner_ID, f.C_Currency_ID = t[u].C_Currency_ID, f.AD_Org_ID = t[u].AD_Org_ID, f.AD_Client_ID = t[u].AD_Client_ID, f.CheckDate = new Date, f.CheckNumber = null, f.ValidMonths = null, f.VA009_PaymentMethod_ID = t[u].VA009_PaymentMethod_ID, f.TransactionType = t[u].TransactionType, f.ConversionTypeId = t[u].ConversionTypeId, f.DiscountAmount = t[u].DiscountAmount, f.ConvertedDiscountAmount = t[u].ConvertedDiscountAmount, f.DiscountDate = t[u].DiscountDate, w.push(f); w2utils.encodeTags(w); c.add(w) } function pt() { function n(n) { if ($pop_cmbCurrencyType.append("<option value='0'><\/option>"), n.length > 0) { for (var t in n) $pop_cmbCurrencyType.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID) + ">" + VIS.Utility.encodeText(n[t].Name) + "<\/option>"), VIS.Utility.encodeText(n[t].IsDefault) == "Y" && (dt = VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID)); $pop_cmbCurrencyType.val(dt) } } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/loadCurrencyType", null, n) } function wt() { function n(n) { if ($POP_cmbOrg.append(" <option value = 0><\/option>"), n.length > 0) for (var t in n) $POP_cmbOrg.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].AD_Org_ID) + ">" + VIS.Utility.encodeText(n[t].Name) + "<\/option>"); $POP_cmbOrg.prop("selectedIndex", 0) } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadOrganization", null, n) } function bt() { function n(n) { if ($POP_cmbCurrency.append("<option value='0'><\/option>"), n.length > 0) { for (var t in n) $POP_cmbCurrency.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].C_Currency_ID) + ">" + VIS.Utility.encodeText(n[t].ISO_Code) + "<\/option>"); $POP_cmbCurrency.prop("selectedIndex", 0) } } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/loadCurrencies", null, n) } function v(n) { var t, u, f; c.clear(); w = []; i = 0; r = 0; t = JSON.parse(n); ut = t; for (u in t) f = {}, t[u].DocBaseType == "API" ? r += t[u].convertedAmt : t[u].DocBaseType == "APC" && (i += t[u].convertedAmt), f.recid = t[u].recid, f.C_Bpartner = t[u].C_Bpartner, f.C_BPartner_Location_ID = t[u].C_BPartner_Location_ID, f.C_Invoice_ID = t[u].C_Invoice_ID, f.C_InvoicePaySchedule_ID = t[u].C_InvoicePaySchedule_ID, f.CurrencyCode = t[u].CurrencyCode, f.DueAmt = t[u].DueAmt, f.ConvertedAmt = t[u].convertedAmt, f.C_BPartner_ID = t[u].C_BPartner_ID, f.C_Currency_ID = t[u].C_Currency_ID, f.AD_Org_ID = t[u].AD_Org_ID, f.AD_Client_ID = t[u].AD_Client_ID, f.CheckDate = new Date, f.CheckNumber = null, f.ValidMonths = null, f.VA009_PaymentMethod_ID = t[u].VA009_PaymentMethod_ID, f.TransactionType = t[u].TransactionType, f.ConversionTypeId = t[u].ConversionTypeId, f.DiscountAmount = t[u].DiscountAmount, f.ConvertedDiscountAmount = t[u].ConvertedDiscountAmount, f.DiscountDate = t[u].DiscountDate, w.push(f); t[0].ERROR == "ConversionNotFound" && VIS.ADialog.info("VA009_ConversionNotFound"); w2utils.encodeTags(w); c.add(w) } function kt() { function n(n) { if ($POP_PayMthd.append(" <option value = 0><\/option>"), n.length > 0) for (var t in n) $POP_PayMthd.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].VA009_PaymentMethod_ID) + " PaymentBaseType=" + n[t].VA009_PaymentBaseType + ">" + VIS.Utility.encodeText(n[t].VA009_Name) + "<\/option>"); $POP_PayMthd.prop("selectedIndex", 0) } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadBatchPaymentMethod", null, n) } function gt(n) { n = JSON.parse(n); DocNumber = ""; y.find(".VA009-payment-wrap").remove(); o.find(".VA009-right-data-main").remove(); o.find(".VA009-accordion").remove(); b = 1; s = []; l = []; p = []; d = []; g(); it.prop("checked", !1); nt(); h[0].style.visibility = "hidden"; DocNumber != "" ? w2confirm(VIS.Msg.getMsg("VA009_GenPaymentFile")).yes(function () { it.prop("checked", !1); y.find(":checkbox").prop("checked", !1); kf(DocNumber, !0) }).no(function () { h[0].style.visibility = "hidden"; VIS.ADialog.info("", null, n, "") }) : VIS.ADialog.info("", null, n, "") } function et() { u = null; $batch = null; STAT_cmbBank = null; STAT_cmbBankAccount = null; STAT_txtStatementNo = null; STAT_ctrlLoadFile = null; STAT_ctrlLoadFileTxt = null; w2ui.BatchGrid.destroy() } var tt = null, rt, ot = "", st = 0, ht = 0, i = 0, r = 0, u, n, a, ft; $batch = t("<div class='VA009-popform-content vis-formouterwrpdiv' style='min-height:395px !important'>"); u = ""; u += "<div class='VA009-popfrm-wrap'><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbOrg_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_Org") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_TargetType_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_DocType") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbBank_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_Bank") + "<\/label><\/div><\/div> <div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbBankAccount_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_BankAccount") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbCurrency_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_Currency") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbCurrencyType_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_CurrencyType") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbPaymthd_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_PayMthd") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_AccountDate_" + f.windowNo + "' placeholder=' ' data-placeholder=''> <label>" + VIS.Msg.getMsg("AccountDate") + "<\/label><\/div><\/div><div class='VA009-popform-data'><div class='VA009-popFormInn'><label class='vis-ec-col-lblchkbox'><input type='checkbox' disabled id='VA009_OverwritePayMthd_" + f.windowNo + "'>&nbsp;" + VIS.Msg.getMsg("VA009_OverwritePayMthd") + "<\/label><label class='vis-ec-col-lblchkbox'><input type='checkbox' id='VA009_Consolidate_" + f.windowNo + "'>&nbsp;" + VIS.Msg.getMsg("VA009_Consolidate") + "<\/label> <\/div><\/div><div class='VA009-popform-data'><div class='VA009-popFormInn'> <a class='btn VA009-blueBtn VA009-batchCheckDetail' id='VA009_btnCheckDetails_" + f.windowNo + "'> " + VIS.Msg.getMsg("VA009_CheckDetails") + "<\/a > <\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap' style='display:none !important'><div class='vis-control-wrap'><select style='display:none !important' id='VA009_POP_cmbCurrencyType_" + f.windowNo + "'><\/select><label style='display:none !important'>" + VIS.Msg.getMsg("VA009_CurrencyType") + "<\/label><\/div><\/div><div class='VA009-table-container' style='height:300px;' id='VA009_btnPopupGrid'> <\/div><\/div>"; $batch.append(u); lt(); n = new VIS.ChildDialog; n.setContent($batch); n.setTitle(VIS.Msg.getMsg("VA009_LoadBatchPayment")); n.setWidth("60%"); n.setHeight(window.innerHeight - 80); n.setEnableResize(!0); n.setModal(!0); $POP_BtnChkDetails.hide(); n.show(); ct(); vt(yt); wt(); k.LoadTargetDocType($POP_targetDocType, at); tr($POP_cmbBank, VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())); a = new Date; ft = a.getFullYear() + "-" + ("0" + (a.getMonth() + 1)).slice(-2) + "-" + ("0" + a.getDate()).slice(-2); e.val(ft); $POP_cmbBank.addClass("vis-ev-col-mandatory"); $POP_cmbBankAccount.addClass("vis-ev-col-mandatory"); $POP_PayMthd.addClass("vis-ev-col-mandatory"); kt(); $POP_cmbCurrency.addClass("vis-ev-col-mandatory"); bt(); pt(); tt = VIS.MLookupFactory.get(VIS.Env.getCtx(), f.windowNo, 0, VIS.DisplayType.TableDir, "C_InvoicePaySchedule_ID", 0, !1, "C_InvoicePaySchedule.IsActive='Y' "); $POP_cmbOrg.on("change", function () { VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val()) == 0 ? $POP_cmbOrg.addClass("vis-ev-col-mandatory") : (tr($POP_cmbBank, VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())), $POP_cmbBank.val(0).prop("selected", !0), $POP_cmbBank.addClass("vis-ev-col-mandatory"), $POP_cmbBankAccount.empty(), $POP_cmbBankAccount.append("<option value='0'><\/option>"), $POP_cmbBankAccount.addClass("vis-ev-col-mandatory"), $POP_cmbOrg.removeClass("vis-ev-col-mandatory")); k.LoadTargetDocType($POP_targetDocType, at) }); $POP_targetDocType.on("change", function () { VIS.Utility.Util.getValueOfInt($POP_targetDocType.val()) == 0 ? $POP_targetDocType.addClass("vis-ev-col-mandatory") : $POP_targetDocType.removeClass("vis-ev-col-mandatory") }); $POP_cmbBank.on("change", function () { function n(n) { if ($POP_cmbBankAccount.append("<option value='0'><\/option>"), n != null && n.length > 0) for (var t in n) $POP_cmbBankAccount.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].C_BankAccount_ID) + ">" + VIS.Utility.encodeText(n[t].AccountNo) + "<\/option>") } VIS.Utility.Util.getValueOfInt($POP_cmbBank.val()) > 0 ? $POP_cmbBank.removeClass("vis-ev-col-mandatory") : $POP_cmbBank.addClass("vis-ev-col-mandatory"); $POP_cmbBankAccount.empty(); $POP_cmbBankAccount.addClass("vis-ev-col-mandatory"); VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadBankAccount", { Bank_ID: $POP_cmbBank.val(), Orgs: $POP_cmbOrg.val() }, n) }); $POP_cmbBankAccount.on("change", function () { VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val()) == 0 ? $POP_cmbBankAccount.addClass("vis-ev-col-mandatory") : $POP_cmbBankAccount.removeClass("vis-ev-col-mandatory"); t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GetConvertedAmt", type: "POST", datatype: "json", async: !0, data: { PaymentData: JSON.stringify(ut), BankAccount: $POP_cmbBankAccount.val(), CurrencyType: $pop_cmbCurrencyType.val(), dateAcct: e != null ? e.val() : null, _org_Id: $POP_cmbOrg.val() <= 0 ? 0 : $POP_cmbOrg.val() }, success: function (n) { v(n) }, error: function (n) { console.log(n); VIS.ADialog.error("VA009_ErrorLoadingPayments") } }); var n = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/GetBankAccountCurrency", { BankAccount_ID: $POP_cmbBankAccount.val() }); n > 0 && ($POP_cmbCurrency.val(n), $POP_cmbCurrency.removeClass("vis-ev-col-mandatory")) }); $pop_cmbCurrencyType.on("change", function () { t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GetConvertedAmtBatch", type: "POST", datatype: "json", async: !0, data: { PaymentData: JSON.stringify(ut), BankAccount: $POP_cmbBankAccount.val(), CurrencyType: $pop_cmbCurrencyType.val(), ToCurrency: $POP_cmbCurrency.val(), dateAcct: e != null ? e.val() : null, _org_Id: $POP_cmbOrg.val() <= 0 ? 0 : $POP_cmbOrg.val() }, success: function (n) { v(n) }, error: function (n) { console.log(n); VIS.ADialog.error("VA009_ErrorLoadingPayments") } }) }); $POP_BtnChkDetails.on("click", function () { if (parseInt($POP_cmbBankAccount.val()) > 0) if (parseInt($POP_PayMthd.val()) > 0) { t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GetCheckDetails", type: "POST", datatype: "json", async: !0, data: { C_BankAccount_ID: parseInt($POP_cmbBankAccount.val()), VA009_PaymentMethod_ID: parseInt($POP_PayMthd.val()) }, success: function (t) { n(t) }, error: function (n) { console.log(n); VIS.ADialog.error("VA009_ErrorLoadingPayments") } }); function n(n) { n != null && (console.log(n), k.ChequeDetails_Dialog(n, $consolidate.prop("checked"))) } } else return VIS.ADialog.info("VA009_PlsSelectPayMethod"), c.selectNone(), !1; else return VIS.ADialog.info("VA009_PLSelectBankAccount"), c.selectNone(), !1 }); $POP_cmbCurrency.on("change", function () { VIS.Utility.Util.getValueOfInt($POP_cmbCurrency.val()) == 0 ? $POP_cmbCurrency.addClass("vis-ev-col-mandatory") : $POP_cmbCurrency.removeClass("vis-ev-col-mandatory"); t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GetConvertedAmtBatch", type: "POST", datatype: "json", async: !0, data: { PaymentData: JSON.stringify(ut), BankAccount: $POP_cmbBankAccount.val(), CurrencyType: $pop_cmbCurrencyType.val(), ToCurrency: $POP_cmbCurrency.val(), dateAcct: e != null ? e.val() : null, _org_Id: $POP_cmbOrg.val() <= 0 ? 0 : $POP_cmbOrg.val() }, success: function (n) { v(n) }, error: function (n) { console.log(n); VIS.ADialog.error("VA009_ErrorLoadingPayments") } }) }); e.on("change", function () { e.val() ? e.removeClass("vis-ev-col-mandatory") : e.addClass("vis-ev-col-mandatory"); t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GetConvertedAmtBatch", type: "POST", datatype: "json", async: !0, data: { PaymentData: JSON.stringify(ut), BankAccount: $POP_cmbBankAccount.val(), CurrencyType: $pop_cmbCurrencyType.val(), ToCurrency: $POP_cmbCurrency.val(), dateAcct: e != null ? e.val() : null, _org_Id: $POP_cmbOrg.val() <= 0 ? 0 : $POP_cmbOrg.val() }, success: function (n) { v(n) }, error: function (n) { console.log(n); VIS.ADialog.error("VA009_ErrorLoadingPayments") } }) }); c.on("change", function (n) { n.column == 7 && (c.records[n.index].CheckNumber = n.value_new); n.column == 8 && (c.records[n.index].CheckDate = n.value_new != "" ? n.value_new : n.value_previous != "" ? n.value_previous : n.value_original); n.column == 9 && (c.records[n.index].ValidMonths = n.value_new) }); $POP_PayMthd.on("change", function () { VIS.Utility.Util.getValueOfInt($POP_PayMthd.val()) > 0 ? $POP_PayMthd.removeClass("vis-ev-col-mandatory") : $POP_PayMthd.addClass("vis-ev-col-mandatory"); pi.hasClass("VA009-active-tab") && t("option:selected", $POP_PayMthd).attr("PaymentBaseType") == "S" ? $POP_BtnChkDetails.show() : $POP_BtnChkDetails.hide(); gu = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/GetPaymentRule", { PaymentMethod: $POP_PayMthd.val() }, null); gu == "S" ? c.showColumn("CheckNumber", "CheckDate", "ValidMonths", "Mandate") : c.hideColumn("recid", "CheckNumber", "CheckDate", "ValidMonths", "Mandate") }); n.onOkClick = function () { var f = [], u, n, o; if (c.selectAll(), VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val()) > 0) if (VIS.Utility.Util.getValueOfInt($POP_targetDocType.val()) > 0) if (VIS.Utility.Util.getValueOfInt($POP_cmbBank.val()) > 0) if (VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val()) > 0) if (VIS.Utility.Util.getValueOfInt($POP_PayMthd.val()) > 0) { if (t("option:selected", $POP_PayMthd).attr("PaymentBaseType") == "S" && r - i < 0) return VIS.ADialog.info("VA009_NotAllowed"), h[0].style.visibility = "hidden", c.selectNone(), !1; if (e.val() != "" && e.val() != null) { if (c.getSelection().length > 0) for (u = 0; u < c.getSelection().length; u++) { if (n = {}, n.C_BPartner_ID = c.get(c.getSelection()[u]).C_BPartner_ID, n.C_BPartner_Location_ID = c.get(c.getSelection()[u]).C_BPartner_Location_ID, n.C_Invoice_ID = c.get(c.getSelection()[u]).C_Invoice_ID, n.C_InvoicePaySchedule_ID = c.get(c.getSelection()[u]).C_InvoicePaySchedule_ID, n.AD_Org_ID = VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val()), n.TargetDocType = VIS.Utility.Util.getValueOfInt($POP_targetDocType.val()), n.AD_Client_ID = c.get(c.getSelection()[u]).AD_Client_ID, n.C_Currency_ID = c.get(c.getSelection()[u]).C_Currency_ID, n.TransactionType = c.get(c.getSelection()[u]).TransactionType, n.DueAmt = c.get(c.getSelection()[u]).DueAmt, n.C_Bank_ID = $POP_cmbBank.val(), n.C_BankAccount_ID = $POP_cmbBankAccount.val(), n.ConversionTypeId = c.get(c.getSelection()[u]).ConversionTypeId, n.DiscountAmount = c.get(c.getSelection()[u]).DiscountAmount, n.ConvertedDiscountAmount = c.get(c.getSelection()[u]).ConvertedDiscountAmount, n.DiscountDate = VIS.Utility.Util.getValueOfDate(c.get(c.getSelection()[u]).DiscountDate), n.DueAmt != 0 && c.get(c.getSelection()[u]).ConvertedAmt == 0) return VIS.ADialog.info("VA009_ConversionNotFound"), !1; if (n.ConvertedAmt = c.get(c.getSelection()[u]).ConvertedAmt, $overwritepay.prop("checked") == !0 ? (n.VA009_PaymentMethod_ID = $POP_PayMthd.val(), n.isOverwrite = "Y") : (n.VA009_PaymentMethod_ID = c.get(c.getSelection()[u]).VA009_PaymentMethod_ID, n.isOverwrite = "N"), n.isconsolidate = $consolidate.prop("checked") == !0 ? "Y" : "N", gu == "S") if (o = new Date(c.get(c.getSelection()[u]).CheckDate), n.CheckDate = VIS.Utility.Util.getValueOfDate(c.get(c.getSelection()[u]).CheckDate), c.get(c.getSelection()[u]).CheckNumber != null) n.CheckNumber = c.get(c.getSelection()[u]).CheckNumber; else return VIS.ADialog.info("VA009_PLCheckNumber"), c.selectNone(), !1; else n.CheckNumber = null, n.CheckDate = null, n.ValidMonths = null; n.CurrencyType = $pop_cmbCurrencyType.val(); n.HeaderCurrency = $POP_cmbCurrency.val(); n.DateAcct = VIS.Utility.Util.getValueOfDate(e.val()); f.push(n) } h[0].style.visibility = "visible"; t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GeneratePaymentsBatch", type: "POST", datatype: "json", async: !0, data: { PaymentData: JSON.stringify(f) }, success: function (n) { gt(n) }, error: function (n) { console.log(n); h[0].style.visibility = "hidden"; VIS.ADialog.error("VA009_ErrorLoadingPayments") } }) } else return VIS.ADialog.info("VA009_PLSelectAcctDate"), c.selectNone(), !1 } else return VIS.ADialog.info("VA009_PlsSelectPayMethod"), c.selectNone(), !1; else return VIS.ADialog.info("VA009_PLSelectBankAccount"), c.selectNone(), !1; else return VIS.ADialog.info("VA009_PLSelectBank"), c.selectNone(), !1; else return VIS.ADialog.info("VA009_PLSelectTargetDocType"), c.selectNone(), !1; else return VIS.ADialog.info("VA009_PlsSelectOrg"), c.selectNone(), !1 }; n.onCancelCLick = function () { w2ui.BatchGrid.clear(); et() }; n.onClose = function () { w2ui.BatchGrid.clear(); et() } }, Split_Dialog: function () { function tt() { var n = []; n.length == 0 && (n.push({ field: "recid", caption: VIS.Msg.getMsg("VA009_srno"), sortable: !0, size: "10%" }), n.push({ field: "C_Bpartner", caption: VIS.Msg.getMsg("VA009_BPartner"), sortable: !0, size: "10%" }), n.push({ field: "DocumentNo", caption: VIS.Msg.getMsg("VA009_Invoice/Order"), sortable: !0, size: "10%" }), n.push({ field: "CurrencyCode", caption: VIS.Msg.getMsg("VA009_Currency"), sortable: !0, size: "10%" }), n.push({ field: "DueAmt", caption: VIS.Msg.getMsg("VA009_DueAmt"), sortable: !0, size: "10%", style: "text-align: right", render: function (n) { var t = n.DueAmt; return parseFloat(t).toLocaleString() } }), n.push({ field: "DueDate", caption: VIS.Msg.getMsg("VA009_DueDate"), sortable: !0, size: "10%", render: function (n, t) { var i; return n.changes == undefined || n.changes.DueDate == "" ? i = n.DueDate : new Date(n.changes.DueDate) >= new Date(a.records[t].DateAcct) ? i = n.changes.DueDate : (i = n.DueDate, n.changes.DueDate = n.DueDate), new Date(i).toLocaleDateString() }, style: "text-align: left", editable: { type: "date" } }), n.push({ field: "TransactionType", caption: VIS.Msg.getMsg("VA009_TransactionType"), sortable: !0, size: "1%" })); a = null; a = u.w2grid({ name: "SplitGrid", recordHeight: 25, columns: n, method: "GET", multiSelect: !0 }); a.hideColumn("recid"); a.hideColumn("TransactionType") } function rt() { u = $split.find("#VA009_btnPopupGrid"); $TxtSplitAmt = $split.find("#VA009_POP_TxtSplitAmt_" + f.windowNo); $BtnSplit = $split.find("#VA009_btnSplitAmt_" + f.windowNo) } function ut(n) { t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GetPopUpData", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", data: { InvPayids: s.toString(), bank_id: v, acctno: k, chkno: VIS.Utility.encodeText(c), OrderPayids: l.toString() }, success: function (t) { n(t) }, error: function () { h[0].style.visibility = "hidden"; VIS.ADialog.error("VA009_ErrorLoadingPayments") } }) } function ft(n) { var f, i, r, t, u, e, o; a.clear(); w = []; f = 0; i = JSON.parse(n); for (r in i) f = f + 1, t = {}, t.recid = f, t.C_Bpartner = i[r].C_Bpartner, t.C_Invoice_ID = i[r].C_Invoice_ID, t.DocumentNo = i[r].DocumentNo, t.C_InvoicePaySchedule_ID = i[r].C_InvoicePaySchedule_ID, t.CurrencyCode = i[r].CurrencyCode, t.DueAmt = i[r].DueAmt, u = new Date(i[r].DueDate), u.setMinutes(-u.getTimezoneOffset() + u.getMinutes()), newValue = u.toISOString(), e = newValue.substring(0, newValue.length - 1), o = newValue.indexOf("T"), t.DueDate = e.substring(0, o), t.C_BPartner_ID = i[r].C_BPartner_ID, t.C_Currency_ID = i[r].C_Currency_ID, t.AD_Org_ID = i[r].AD_Org_ID, t.AD_Client_ID = i[r].AD_Client_ID, t.TransactionType = i[r].TransactionType, t.DateAcct = i[r].DateAcct, w.push(t); w2utils.encodeTags(w); a.add(w); h[0].style.visibility = "hidden" } function i() { var i, t, u, f, n, e, r, o; _CollaborateData = []; i = parseFloat(a.get(a.getSelection()[0]).DueAmt); t = gt(event, $TxtSplitAmt.val(), $TxtSplitAmt.val()); t = parseFloat(t); i < 0 && (i = -1 * i); t < 0 && (t = -1 * t); u = i / t; f = Math.ceil(u); f > 0 && (n = {}, e = a.records[a.records.length - 1].recid + 1, n.recid = e, n.C_BPartner_ID = a.get(a.getSelection()[0]).C_BPartner_ID, n.C_Bpartner = a.get(a.getSelection()[0]).C_Bpartner, n.CurrencyCode = a.get(a.getSelection()[0]).CurrencyCode, n.DocumentNo = a.get(a.getSelection()[0]).DocumentNo, n.C_Invoice_ID = a.get(a.getSelection()[0]).C_Invoice_ID, n.AD_Org_ID = a.get(a.getSelection()[0]).AD_Org_ID, n.AD_Client_ID = a.get(a.getSelection()[0]).AD_Client_ID, n.C_Currency_ID = a.get(a.getSelection()[0]).C_Currency_ID, n.DueAmt = t.toFixed(2), n.C_InvoicePaySchedule_ID = a.get(a.getSelection()[0]).C_InvoicePaySchedule_ID, n.DueDate = a.get(a.getSelection()[0]).DueDate, n.DateAcct = a.get(a.getSelection()[0]).DateAcct, n.TransactionType = a.get(a.getSelection()[0]).TransactionType, _CollaborateData.push(n), r = t, i - r > 0 && (o = i - r, a.get(a.getSelection()[0]).DueAmt = o.toFixed(2))); w2utils.encodeTags(_CollaborateData); a.add(_CollaborateData); $TxtSplitAmt.val(""); a.refresh() } function et(n) { n = JSON.parse(n); y.find(".VA009-payment-wrap").remove(); o.find(".VA009-right-data-main").remove(); o.find(".VA009-accordion").remove(); b = 1; s = []; l = []; p = []; d = []; g(); it.prop("checked", !1); nt(); h[0].style.visibility = "hidden"; VIS.ADialog.info(n) } function e() { $split = null; r = null; w2ui.SplitGrid.destroy() } var u, c = "", v = 0, k = 0, r, n; h[0].style.visibility = "visible"; $split = t("<div class='VA009-popform-content vis-formouterwrpdiv' style='min-height:333px !important'>"); r = ""; r += "<div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='text' step='any' id='VA009_POP_TxtSplitAmt_" + f.windowNo + "'  placeholder=' ' data-placeholder=''><label>" + VIS.Msg.getMsg("VA009_lblSplitAmt") + "<\/label><\/div>  <a tabindex='' class='btn VA009-blueBtn' id='VA009_btnSplitAmt_" + f.windowNo + "' style='margin-top: 0px !important; margin-left: 5px;'>Split Schedule<\/a> <\/div>  <div class='VA009-table-container' id='VA009_btnPopupGrid'>  <\/div> <\/div>"; $split.append(r); rt(); n = new VIS.ChildDialog; n.setContent($split); n.setTitle(VIS.Msg.getMsg("VA009_LoadSplitPayment")); n.setWidth("60%"); n.setEnableResize(!0); n.setModal(!0); n.show(); tt(); ut(ft); a.on("change", function (n) { n.column == 5 && n.value_new != "" && (new Date(n.value_new) >= new Date(a.records[n.index].DateAcct) ? a.records[n.index].DueDate = n.value_new : (a.records[n.index].DueDate = n.value_previous == "" ? n.value_original : n.value_previous, n.value_previous = n.value_previous == "" ? n.value_original : n.value_previous, window.setTimeout(function () { VIS.ADialog.info("VA009_PlsSelctDueDateGreaterThanTrxDate") }, 5))) }); $TxtSplitAmt.on("keypress", function (n) { var r = br.isDecimalSeparatorDot(window.navigator.language); if (n.keyCode != 13 && (n.which != 46 || t(this).val().indexOf(".") != -1) && n.which != 8 && n.which != 0 && (n.which < 48 || n.which > 57) && n.keyCode == 45 && n.keyCode != 44 || !r && n.keyCode == 46 || r && n.keyCode == 44) return !1; if (n.target.value.contains(".") && (n.which == 46 || n.which == 44) && n.target.value.indexOf(".") > -1 && (n.target.value = n.target.value.replace(".", "")), n.target.value.contains(",") && (n.which == 46 || n.which == 44) && n.target.value.indexOf(",") > -1 && (n.target.value = n.target.value.replace(",", "")), n.keyCode == 13) { if (a.getSelection().length == 0) return VIS.ADialog.info("PlsSelectRecord"), !1; if ($TxtSplitAmt.val() != "") parseFloat(a.get(a.getSelection()[0]).DueAmt) < parseFloat($TxtSplitAmt.val()) ? VIS.ADialog.info("Can't Enter Greater Than Due Amt") : parseFloat(a.get(a.getSelection()[0]).DueAmt) > 0 ? parseFloat($TxtSplitAmt.val()) < 0 ? VIS.ADialog.info("Can't Enter Negative Amt") : i() : parseFloat(a.get(a.getSelection()[0]).DueAmt) < 0 ? parseFloat($TxtSplitAmt.val()) > 0 ? VIS.ADialog.info("Can't Enter Positive Amt") : i() : i(); else return VIS.ADialog.info("VA009_PLEnterSplitAmt"), !1 } }); $BtnSplit.on("click", function () { if (a.getSelection().length == 0) return VIS.ADialog.info("PlsSelectRecord"), !1; var t = parseFloat(a.get(a.getSelection()[0]).DueAmt), n = $TxtSplitAmt.val(); if (n != "") n = parseFloat($TxtSplitAmt.val()), t < 0 && (t = -1 * t), n < 0 && (n = -1 * n), t <= n ? VIS.ADialog.info("VA009_CantEnterGreaterAmt") : t > 0 ? n < 0 ? VIS.ADialog.info("VA009_CantEnterNegtveAmt") : n == 0 ? VIS.ADialog.info("VA009_CantEnterZeroAmt") : i() : t < 0 ? n > 0 ? VIS.ADialog.info("VA009_CantEnterPositiveAmt") : i() : i(); else return VIS.ADialog.info("VA009_PLEnterSplitAmt"), !1 }); n.onOkClick = function () { if (cr = [], cr = a.records, a.getSelection().length > 0 || cr.length > 1) { if (a.selectAll(), cr.length == 1) return VIS.ADialog.info("VA009_SplitRecordFirst"), !1; for (var n = 0; n < cr.length; n++)if (a.get(a.getSelection()[n]).DueDate == null) return VIS.ADialog.info("VA009_PlzSelctDueDate"), !1; h[0].style.visibility = "visible"; t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/CreateSplitPayments", type: "POST", datatype: "json", async: !0, data: { PaymentData: JSON.stringify(cr), SplitAmmount: $TxtSplitAmt.val() }, success: function (n) { et(n) }, error: function (n) { console.log(n); h[0].style.visibility = "hidden"; VIS.ADialog.error("VA009_ErrorLoadingPayments") } }) } else return VIS.ADialog.info("VA009_PlzSplitRecord"), !1 }; n.onCancelCLick = function () { w2ui.SplitGrid.clear(); e() }; n.onClose = function () { w2ui.SplitGrid.clear(); e() } }, XML_Dialog: function () { s.length > 0 || l.length > 0 ? (fu = "B", w2confirm("Do you want to clear the selection and proceed for SEPA XML Generation Process?").yes(function () { s = []; l = []; it.prop("checked", !1); y.find(":checkbox").prop("checked", !1); df(fu) }).no(function () { console.log("user clicked NO") })) : df(fu) }, ChatWindow: function () { function f(n) { n = JSON.parse(n); h[0].style.visibility = "hidden"; yu = y.find("#VA009-Chatcolor-gray_" + lt); yu.html(""); yu.append("<span class=VA009-Chatcolor-gray>" + n + "<\/span>") } var n = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/GetChatID", { RecordID: lt }, null); if (n != null) { var r = n.AD_Table_ID, u = n.CM_Chat_ID, i = new VIS.Chat(lt, u, r, "", this.windowNo); i.show(); i.onClose = function () { t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GetChat", type: "POST", datatype: "json", async: !0, data: { RecordID: lt }, success: function (n) { f(n) }, error: function (n) { console.log(n); h[0].style.visibility = "hidden"; VIS.ADialog.error("VA009_ErrorLoadingPayments") } }) } } }, B2B_Dialog: function () { function ot() { l.on("click", function (n) { var i = t(n.target); n.target.type == "checkbox" && (i.prop("checked") == !0 && (p.prop("checked", !1), d(u, a), g($To_cmbBank, [])), r.val(""), c = "") }); p.on("click", function (n) { var i = t(n.target); n.target.type == "checkbox" && (i.prop("checked") == !0 && (l.prop("checked", !1), g($To_cmbBank, a), d(u, [])), r.val(""), c = "") }); $OrgCmb.on("change", function () { parseInt($OrgCmb.val()) > 0 ? (a = [], a.push($OrgCmb.val()), $OrgCmb.removeClass("vis-ev-col-mandatory"), l.prop("checked") == !0 && (d(u, a), g($To_cmbBank, [])), p.prop("checked") == !0 && (g($To_cmbBank, a), d(u, []))) : $OrgCmb.addClass("vis-ev-col-mandatory"); k.LoadTargetDocTypeB2B($POP_ARTargetDocType, 1, 0); k.LoadTargetDocTypeB2B($POP_APTargetDocType, 2, 0); r.val(""); c = "" }); u.on("change", function () { parseInt(u.val()) > 0 ? (u.removeClass("vis-ev-col-mandatory"), k.LoadTargetDocTypeB2B($POP_APTargetDocType, 2, u.val())) : (u.addClass("vis-ev-col-mandatory"), k.LoadTargetDocTypeB2B($POP_APTargetDocType, 2, 0)); ut() }); $To_cmbBank.on("change", function () { parseInt($To_cmbBank.val()) > 0 ? ($To_cmbBank.removeClass("vis-ev-col-mandatory"), k.LoadTargetDocTypeB2B($POP_ARTargetDocType, 1, $To_cmbBank.val())) : ($To_cmbBank.addClass("vis-ev-col-mandatory"), k.LoadTargetDocTypeB2B($POP_ARTargetDocType, 1, 0)) }); o.on("change", function () { parseInt(o.val()) > 0 ? o.removeClass("vis-ev-col-mandatory") : o.addClass("vis-ev-col-mandatory") }); e.getControl().on("change", function () { parseInt(e.getValue()) > 0 ? e.getControl().removeClass("vis-ev-col-mandatory") : e.getControl().addClass("vis-ev-col-mandatory") }); i.on("change", function () { parseInt(i.val()) > 0 ? i.removeClass("vis-ev-col-mandatory") : i.addClass("vis-ev-col-mandatory"); t("option:selected", i).attr("paybase") == "S" ? (r.removeAttr("disabled"), r.css("background-color", "white"), r.addClass("vis-ev-col-mandatory"), s.removeAttr("disabled"), s.css("background-color", "white"), s.addClass("vis-ev-col-mandatory")) : (r.val(""), r.attr("disabled", "disabled"), r.removeClass("vis-ev-col-mandatory"), r.css("background-color", "#ededed"), s.val(""), s.attr("disabled", "disabled"), s.removeClass("vis-ev-col-mandatory"), s.css("background-color", "#ededed"), c = ""); ut() }); ft.on("click", function () { parseInt(i.val()) > 0 && t("option:selected", i).attr("paybase") == "S" && ut() }); $POP_APTargetDocType.on("change", function () { VIS.Utility.Util.getValueOfInt($POP_APTargetDocType.val()) == 0 ? $POP_APTargetDocType.addClass("vis-ev-col-mandatory") : $POP_APTargetDocType.removeClass("vis-ev-col-mandatory") }); $POP_ARTargetDocType.on("change", function () { VIS.Utility.Util.getValueOfInt($POP_ARTargetDocType.val()) == 0 ? $POP_ARTargetDocType.addClass("vis-ev-col-mandatory") : $POP_ARTargetDocType.removeClass("vis-ev-col-mandatory") }) } function lt(n) { $OrgCmb = $b2b.find("#VA009_POP_cmbOrg_" + f.windowNo); u = $b2b.find("#VA009_POP_cmbFromBank_" + f.windowNo); $To_cmbBank = $b2b.find("#VA009_POP_cmbToBank_" + f.windowNo); l = $b2b.find("#VA009_Payment_" + f.windowNo); p = $b2b.find("#VA009_Receipt_" + f.windowNo); y = $b2b.find("#VA009_cmbCurrencyType_" + f.windowNo); i = $b2b.find("#VA009_cmbPayMthd_" + f.windowNo); o = $b2b.find("#VA009_POP_cmbCurrency_" + f.windowNo); ht = $b2b.find("#VA009_Amount" + f.windowNo); nt = $b2b.find("#VA009_TransactionDate" + f.windowNo); w = $b2b.find("#VA009_AccountDate" + f.windowNo); r = $b2b.find("#VA009_Chqnotxt_" + f.windowNo); s = $b2b.find("#VA009_CheckDate_" + f.windowNo); ft = $b2b.find("#VA009_getCheckNo_" + f.windowNo); et = n.dialog("widget").find(".ui-dialog-buttonpane"); $successNote = tf.find("#VA009_Note" + f.windowNo); $OrgCmb.addClass("vis-ev-col-mandatory"); u.addClass("vis-ev-col-mandatory"); $To_cmbBank.addClass("vis-ev-col-mandatory"); e.getControl().addClass("vis-ev-col-mandatory"); o.addClass("vis-ev-col-mandatory"); i.addClass("vis-ev-col-mandatory"); $POP_APTargetDocType = $b2b.find("#VA009_POP_cmbAPDocType_" + f.windowNo); $POP_APTargetDocType.addClass("vis-ev-col-mandatory"); $POP_ARTargetDocType = $b2b.find("#VA009_POP_cmbARDocType_" + f.windowNo); $POP_ARTargetDocType.addClass("vis-ev-col-mandatory") } function at() { function n(n) { if ($OrgCmb.append(" <option value = 0><\/option>"), n.length > 0) for (var t in n) $OrgCmb.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].AD_Org_ID) + ">" + VIS.Utility.encodeText(n[t].Name) + "<\/option>"); $OrgCmb.prop("selectedIndex", 0) } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadOrganization", null, n) } function vt() { function n(n) { if (i.append(" <option value = 0><\/option>"), n.length > 0) for (var t in n) "LCPB".contains(n[t].VA009_PaymentBaseType) || i.append("<option paybase = " + n[t].VA009_PaymentBaseType + " value=" + VIS.Utility.Util.getValueOfInt(n[t].VA009_PaymentMethod_ID) + ">" + VIS.Utility.encodeText(n[t].VA009_Name) + " <\/option>"); i.prop("selectedIndex", 0) } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadPaymentMethod", null, n) } function yt() { function n(n) { if (y.append("<option value='0'><\/option>"), n.length > 0) { for (var t in n) y.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID) + ">" + VIS.Utility.encodeText(n[t].Name) + "<\/option>"), VIS.Utility.encodeText(n[t].IsDefault) == "Y" && (dt = VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID)); y.val(dt) } } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/loadCurrencyType", null, n) } function pt() { function n(n) { if (o.append("<option value='0'><\/option>"), n.length > 0) { for (var t in n) o.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].C_Currency_ID) + ">" + VIS.Utility.encodeText(n[t].ISO_Code) + "<\/option>"); o.prop("selectedIndex", 0) } } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/loadCurrencies", null, n) } function d(n, t) { function i(t) { if (n.find("option").remove(), n.append("<option value='0'><\/option>"), n.addClass("vis-ev-col-mandatory"), t != null && t.length > 0) for (var i in t) n.append("<option value=" + VIS.Utility.Util.getValueOfInt(t[i].C_BankAccount_ID) + ">" + VIS.Utility.encodeText(t[i].AccountNo) + "<\/option>") } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadBankAccount", { Bank_ID: 0, Orgs: t.toString() }, i) } function g(n, t) { function i(t) { if (n.find("option").remove(), n.append("<option value='0'><\/option>"), n.addClass("vis-ev-col-mandatory"), t != null && t.length > 0) for (var i in t) n.append("<option value=" + VIS.Utility.Util.getValueOfInt(t[i].C_BankAccount_ID) + ">" + VIS.Utility.encodeText(t[i].AccountNo) + "<\/option>") } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadBankAccount", { Bank_ID: 0, Orgs: t.toString() }, i) } function ut() { if (VIS.Utility.Util.getValueOfInt(u.val()) > 0 && VIS.Utility.Util.getValueOfInt(i.val()) > 0 && t("option:selected", i).attr("paybase") == "S") { VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/getCheckNo", { C_BankAccount_ID: parseInt(u.val()), VA009_PaymentMethod_ID: parseInt(i.val()) }, n); function n(n) { r.val(); $note.css("visibility", "hidden"); n != null && (r.val(n), r.removeClass("vis-ev-col-mandatory"), c = n) } } else r.val(""), c = "" } function st() { $b2b = null; _b2b = null } function wt(i) { h[0].style.visibility = "visible"; t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GeneratePaymentsBtoB", type: "POST", datatype: "json", contentType: "application/json", data: JSON.stringify({ recordData: JSON.stringify(i) }), success: function (t) { nr = JSON.parse(t); nr.success != null ? ($successNote.text(nr.success), $successNote.css("visibility", "visible"), n.setContent(tf), n.setHeight(window.innerHeight - 385), n.setWidth("47%"), n.show(), n.hidebuttons(), ou.css({ visibility: "visible", display: "block" }), eu.css({ visibility: "visible", display: "block" }), $note.css("display", "none"), bt()) : nr.error != null ? ($note.text(nr.error), $note.css("visibility", "visible"), h[0].style.visibility = "hidden") : VIS.ADialog.info("VA009_SavedSuccessfully"); h[0].style.visibility = "hidden" }, error: function (n) { nr = n; $note.text(nr); $note.css("visibility", "visible"); h[0].style.visibility = "hidden" } }) } function bt() { ou.on("click", function () { ot(); $OrgCmb.val(0); p.prop("checked", !1); l.prop("checked", !1); u.val(0); $To_cmbBank.val(0); e.setValue(0); i.val(0); o.val(0); y.val(dt); nt.val(b); w.val(b); r.val(0); s.val(""); $POP_APTargetDocType.val(""); $POP_ARTargetDocType.val(""); n.setContent($b2b); n.setHeight(window.innerHeight - 180); n.setWidth("60%"); n.setEnableResize(!0); n.setModal(!0); n.show(); $note.css("display", "block"); ou.css({ visibility: "hidden", display: "none" }); eu.css({ visibility: "hidden", display: "none" }); v.dialog("widget").find(".ui-dialog-buttonpane").css("padding", ""); v.dialog("widget").find(".ui-dialog-buttonpane").css("margin-top", "") }); eu.on("click", function () { n.close() }) } var u, y, i, o, ht, e, r, s, ft, et, nt, w, l, p, a = [], it, ct = null, rt, n, tt, b, c; lblAmount = t("<label>"); e = new VIS.Controls.VAmountTextBox("VA009_Amount" + f.windowNo + "", !1, !1, !0, 50, 100, VIS.DisplayType.Amount, VIS.Msg.getMsg("Amount")); lblAmount.append(VIS.Msg.getMsg("Amount")); e.setValue(0); ct = VIS.DisplayType.GetNumberFormat(VIS.DisplayType.Amount); it = t("<div class='VA009-popform-data input-group vis-input-wrap'>"); rt = t("<div class='vis-control-wrap'>"); it.append(rt); rt.append(e.getControl().attr("placeholder", " ").attr("data-placeholder", "")).append(lblAmount); $b2b = t("<div class='VA009-popform-content vis-forms-container vis-formouterwrpdiv' style='min-height:350px !important'>"); _b2b = t("<div class='VA009-popfrm-wrap'>"); _b2bdata = t("<div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbOrg_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_Org") + "<\/label><\/div><\/div><div class='VA009-popform-data VA009-popformchkctrlwrap'><div> <label class='vis-ec-col-lblchkbox'><input type='checkbox' id=VA009_Payment_" + f.windowNo + ">Payment<\/label><\/div><div> <label class='vis-ec-col-lblchkbox'><input type='checkbox' id=VA009_Receipt_" + f.windowNo + ">Receipt<\/label><\/div><\/div> <div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbFromBank_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_FromBank") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbToBank_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_ToBank") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap' > <div class='vis-control-wrap'><select id='VA009_POP_cmbAPDocType_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_APDocType") + "<\/label><\/div><\/div> <div class='VA009-popform-data input-group vis-input-wrap' > <div class='vis-control-wrap'><select id='VA009_POP_cmbARDocType_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_ARDocType") + "<\/label><\/div><\/div> "); _b2bdata1 = t("<div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_cmbPayMthd_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_PayMethodlbl") + "<\/label><\/div><\/div><div class='VA009-popform-data VA009-b2b-popup input-group vis-input-wrap'><div class='vis-control-wrap'><input type='text' placeholder=' ' data-placeholder='' class='vis-ev-col-readonly' id='VA009_Chqnotxt_" + f.windowNo + "' disabled/><label>" + VIS.Msg.getMsg("VA009_ChkNo") + "<\/label><\/div><a href='javascript:void(0)' id='VA009_getCheckNo_" + f.windowNo + "' style=margin-left:4px;>" + VIS.Msg.getMsg("GetNextCheckNo") + "<\/a><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_CheckDate_" + f.windowNo + "' placeholder=' ' data-placeholder='' class='vis-ev-col-readonly' disabled><label>" + VIS.Msg.getMsg("VA009_CheckDate") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbCurrency_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("Currency") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_cmbCurrencyType_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_CurrencyType") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_TransactionDate" + f.windowNo + "' placeholder=' ' data-placeholder=''><label>" + VIS.Msg.getMsg("TransactionDate") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_AccountDate" + f.windowNo + "' placeholder=' ' data-placeholder=''><label>" + VIS.Msg.getMsg("AccountDate") + "<\/label><\/div><\/div><\/div>"); $Note = t("<div class='VA009-popform-data' align='left'  margin-top:10Px;'><label style='color:red; visibility: hidden;' id='VA009_Note" + f.windowNo + "'>Please Select Org.<\/label><\/div>"); _b2b.append(_b2bdata).append(it).append(_b2bdata1); $b2b.append(_b2b); tf = t("<div><label style='color:red; visibility: hidden;' id='VA009_Note" + f.windowNo + "'>Please Select Org.<\/label><\/div>"); $resltbtns = t("<button class='ui-button' id='VA009_CreateNew_" + f.windowNo + "'style = 'float: right; margin-right: 12px; margin-bottom:12px; visibility:hidden;display:none;'>" + VIS.Msg.getMsg("CreateNew") + "<\/button><button class= 'ui-button' id = 'VA009_Close_" + f.windowNo + "'style = 'float: right; margin-right: 12px;margin-bottom:12px; visibility:hidden;display:none;'>" + VIS.Msg.getMsg("close") + "<\/button>"); n = new VIS.ChildDialog; v = n.getRoot(); n.setContent($b2b); n.setTitle(VIS.Msg.getMsg("VA009_BankToBankTransfer")); n.setHeight(window.innerHeight - 220); n.setWidth("60%"); n.setEnableResize(!0); n.setModal(!0); n.show(); lt(v); et.append($Note).append($resltbtns); ou = v.dialog("widget").find("#VA009_CreateNew_" + f.windowNo); eu = v.dialog("widget").find("#VA009_Close_" + f.windowNo); $note = v.dialog("widget").find("#VA009_Note" + f.windowNo); tt = new Date; b = tt.getFullYear() + "-" + ("0" + (tt.getMonth() + 1)).slice(-2) + "-" + ("0" + tt.getDate()).slice(-2); nt.val(b); w.val(b); ot(); at(); pt(); yt(); vt(); d(u, a); g($To_cmbBank, a); k.LoadTargetDocTypeB2B($POP_ARTargetDocType, 1, 0); k.LoadTargetDocTypeB2B($POP_APTargetDocType, 2, 0); e.addVetoableChangeListener(this); n.onOkClick = function () { var n, f, a, v, h; if (parseInt($OrgCmb.val()) == 0) return $note.text(VIS.Msg.getMsg("VA009_PlsSelectOrg")), $note.css("visibility", "visible"); if (!p.prop("checked") && !l.prop("checked")) return $note.text(VIS.Msg.getMsg("VA009_PlsSelectPaymentOrReceipt")), $note.css("visibility", "visible"); if (parseInt(u.val()) == 0) return $note.text(VIS.Msg.getMsg("VA009_PlsSelectBankFrom")), $note.css("visibility", "visible"); if (parseInt($To_cmbBank.val()) == 0) return $note.text(VIS.Msg.getMsg("VA009_PlsSelectBankTo")), $note.css("visibility", "visible"); if (parseInt($POP_APTargetDocType.val()) == 0) return $note.text(VIS.Msg.getMsg("VA009_PlsSelectAPDocType")), $note.css("visibility", "visible"); if (parseInt($POP_ARTargetDocType.val()) == 0) return $note.text(VIS.Msg.getMsg("VA009_PlsSelectARDocType")), $note.css("visibility", "visible"); if (parseInt(u.val()) == parseInt($To_cmbBank.val())) return $note.text(VIS.Msg.getMsg("VA009_Banknotbesame")), $note.css("visibility", "visible"); if (parseFloat(e.getValue()) == 0) return $note.text(VIS.Msg.getMsg("VA009_PlsEnterAmount")), $note.css("visibility", "visible"); if (parseInt(i.val()) == 0) return $note.text(VIS.Msg.getMsg("VA009_PlsSelectPayMethod")), $note.css("visibility", "visible"); if (t("option:selected", i).attr("paybase") == "S") { if (r.val() == "") return $note.text(VIS.Msg.getMsg("VA009_PLCheckNumber")), $note.css("visibility", "visible"); if (s.val() == "" || s.val() == null) return $note.text(VIS.Msg.getMsg("VA009_PLCheckDate")), $note.css("visibility", "visible"); if (n = new Date(s.val()), n = new Date(n.setHours(0, 0, 0, 0)), f = new Date(w.val()), f = new Date(f.setHours(0, 0, 0, 0)), n > f) return $note.text(VIS.Msg.getMsg("VIS_CheckDateCantbeGreaterSys")), $note.css("visibility", "visible") } return parseInt(o.val()) == 0 ? ($note.text(VIS.Msg.getMsg("VA009_PlsSelectCurrency")), $note.css("visibility", "visible")) : (a = u.val() + "," + o.val() + "," + w.val().toString() + "," + y.val() + "," + VIS.Env.getCtx().getAD_Client_ID() + "," + $OrgCmb.val(), v = VIS.dataContext.getJSONRecord("VA009/Payment/CheckConversionRate", a), v <= 0) ? ($note.text(VIS.Msg.getMsg("VA009_ConversionRateNotFound")), $note.css("visibility", "visible")) : ($note.css("visibility", "hidden"), isOverrideAutoCheck = !1, l.prop("checked") && r.val() != c && c != "" && (isOverrideAutoCheck = !0), h = {}, console.log(parseFloat(e.getValue())), h = { OrgID: parseInt($OrgCmb.val()), isReceipt: p.prop("checked"), isPayment: l.prop("checked"), fromBank: parseInt(u.val()), toBank: parseInt($To_cmbBank.val()), amount: parseFloat(e.getValue()), paymentMethod: parseInt(i.val()), currencyID: parseInt(o.val()), currencyType: y.val(), transDate: VIS.Utility.Util.getValueOfDate(nt.val()), acctDate: VIS.Utility.Util.getValueOfDate(w.val()), clientID: VIS.Env.getCtx().getAD_Client_ID(), PayBase: t("option:selected", i).attr("paybase"), CheckNo: r.val(), CheckDate: VIS.Utility.Util.getValueOfDate(s.val()), APDocumentTypeId: VIS.Utility.Util.getValueOfInt($POP_APTargetDocType.val()), ARDocumentTypeId: VIS.Utility.Util.getValueOfInt($POP_ARTargetDocType.val()), IsOverrideAutoCheck: isOverrideAutoCheck }, nr = "", wt(h), !1) }; n.onCancelCLick = function () { st() }; n.onClose = function () { st() }; this.vetoablechange = function (n) { console.log(n.propertyName); n.propertyName == "VA009_Amount" + f.windowNo + "" && e.setValue(n.newValue) }; r.on("keydown keyup", function (n) { var t = String.fromCharCode(n.which) || n.key; if (!/[0-9\.\,]/.test(t) && n.which != 8 && n.which != 46 && (n.which < 65 || n.which > 90) && (n.which < 37 || n.which > 40) && n.which != 39 && n.which != 37 && (n.which < 96 || n.which > 105)) return !1; n.shiftKey && n.preventDefault() }); c = ""; this.vetoablechange = function (n) { n.propertyName == "VA009_Amount" + f.windowNo + "" && e.setValue(n.newValue) } }, Pay_ManualDialog: function () { function v() { $POP_cmbBank = $payManual.find("#VA009_POP_cmbBank_" + f.windowNo); $POP_cmbBankAccount = $payManual.find("#VA009_POP_cmbBankAccount_" + f.windowNo); $POP_PayMthd = $payManual.find("#VA009_cmbPayMthd_" + f.windowNo); e = $payManual.find("#VA009_AccountDate_" + f.windowNo); ft = $payManual.find("#VA009_cmbCurrencyType_" + f.windowNo); rt = $payManual.find("#VA009_TransactionDate" + f.windowNo); $POP_cmbOrg = $payManual.find("#VA009_POP_cmbOrg_" + f.windowNo); $POP_cmbOrg.addClass("vis-ev-col-mandatory"); $POP_PayMthd.addClass("vis-ev-col-mandatory"); ft.addClass("vis-ev-col-mandatory"); $POP_cmbBank.addClass("vis-ev-col-mandatory"); $POP_cmbBankAccount.addClass("vis-ev-col-mandatory"); $POP_targetDocType = $payManual.find("#VA009_POP_cmbDocType_" + f.windowNo); $POP_targetDocType.addClass("vis-ev-col-mandatory") } function w() { function n(n) { if ($POP_cmbOrg.append(" <option value = 0><\/option>"), n.length > 0) for (var t in n) $POP_cmbOrg.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].AD_Org_ID) + ">" + VIS.Utility.encodeText(n[t].Name) + "<\/option>"); $POP_cmbOrg.prop("selectedIndex", 0) } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadOrganization", null, n) } function tt() { function n(n) { if (n.length > 1 && $POP_PayMthd.append(" <option value = 0><\/option>"), n.length > 0) for (var t in n) "LCPBS".contains(n[t].VA009_PaymentBaseType) || $POP_PayMthd.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].VA009_PaymentMethod_ID) + ">" + VIS.Utility.encodeText(n[t].VA009_Name) + "<\/option>"); $POP_PayMthd.prop("selectedIndex", 0) } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadPaymentMethod", null, n) } function ut() { function n(n) { if (ft.append("<option value='0'><\/option>"), n.length > 0) for (var t in n) ft.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID) + ">" + VIS.Utility.encodeText(n[t].Name) + "<\/option>"), VIS.Utility.encodeText(n[t].IsDefault) == "Y" && (dt = VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID)) } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/loadCurrencyType", null, n) } function a() { $payManual = null; i = null } var i, r, c, n; $payManual = t("<div class='VA009-popform-content vis-formouterwrpdiv' style='min-height:210px !important'>"); i = ""; i += "<div class='VA009-popfrm-wrap' style='height:auto !important'><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbOrg_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_Org") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbDocType_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_DocType") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbBank_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_Bank") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbBankAccount_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_BankAccount") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_cmbPayMthd_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_PayMethodlbl") + "<\/label><\/div ><\/div > <div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_AccountDate_" + f.windowNo + "' placeholder=' ' data-placeholder=''><label>" + VIS.Msg.getMsg("AccountDate") + "<\/label> <\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_cmbCurrencyType_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_CurrencyType") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_TransactionDate" + f.windowNo + "'  placeholder=' ' data-placeholder=''><label>" + VIS.Msg.getMsg("TransactionDate") + "<\/label> <\/div><\/div><\/div>"; $payManual.append(i); v(); r = new Date; c = r.getFullYear() + "-" + ("0" + (r.getMonth() + 1)).slice(-2) + "-" + ("0" + r.getDate()).slice(-2); e.val(c); rt.val(c); n = new VIS.ChildDialog; n.setContent($payManual); n.setTitle(VIS.Msg.getMsg("VA009_PayMannual")); n.setWidth("65%"); n.setEnableResize(!0); n.setModal(!0); n.show(); w(); tr($POP_cmbBank, VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())); tt(); ut(); k.LoadTargetDocType($POP_targetDocType, at); $POP_cmbOrg.on("change", function () { VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val()) == 0 ? $POP_cmbOrg.addClass("vis-ev-col-mandatory") : (tr($POP_cmbBank, VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val())), $POP_cmbBank.val(0).prop("selected", !0), $POP_cmbBank.addClass("vis-ev-col-mandatory"), $POP_cmbBankAccount.empty(), $POP_cmbBankAccount.append("<option value='0'><\/option>"), $POP_cmbBankAccount.addClass("vis-ev-col-mandatory"), $POP_cmbOrg.removeClass("vis-ev-col-mandatory")); k.LoadTargetDocType($POP_targetDocType, at) }); $POP_cmbBank.on("change", function () { function n(n) { if ($POP_cmbBankAccount.append("<option value='0'><\/option>"), n != null && n.length > 0) for (var t in n) $POP_cmbBankAccount.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].C_BankAccount_ID) + ">" + VIS.Utility.encodeText(n[t].AccountNo) + "<\/option>") } $POP_cmbBankAccount.empty(); $POP_cmbBankAccount.addClass("vis-ev-col-mandatory"); VIS.Utility.Util.getValueOfInt($POP_cmbBank.val()) == 0 ? $POP_cmbBank.addClass("vis-ev-col-mandatory") : $POP_cmbBank.removeClass("vis-ev-col-mandatory"); VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadBankAccount", { Bank_ID: $POP_cmbBank.val(), Orgs: $POP_cmbOrg.val() }, n) }); ft.on("change", function () { VIS.Utility.Util.getValueOfInt(ft.val()) == 0 ? ft.addClass("vis-ev-col-mandatory") : ft.removeClass("vis-ev-col-mandatory") }); $POP_PayMthd.on("change", function () { VIS.Utility.Util.getValueOfInt($POP_PayMthd.val()) == 0 ? $POP_PayMthd.addClass("vis-ev-col-mandatory") : $POP_PayMthd.removeClass("vis-ev-col-mandatory") }); e.on("change", function () { e.val() == "" ? e.addClass("vis-ev-col-mandatory") : e.removeClass("vis-ev-col-mandatory") }); $POP_cmbBankAccount.on("change", function () { VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val()) == 0 ? $POP_cmbBankAccount.addClass("vis-ev-col-mandatory") : $POP_cmbBankAccount.removeClass("vis-ev-col-mandatory") }); $POP_targetDocType.on("change", function () { VIS.Utility.Util.getValueOfInt($POP_targetDocType.val()) == 0 ? $POP_targetDocType.addClass("vis-ev-col-mandatory") : $POP_targetDocType.removeClass("vis-ev-col-mandatory") }); n.onOkClick = function () { if (s.length > 0 || l.length > 0) if (VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val()) > 0) if (VIS.Utility.Util.getValueOfInt($POP_targetDocType.val()) > 0) if (VIS.Utility.Util.getValueOfInt($POP_cmbBank.val()) > 0) if (VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val()) > 0) if (VIS.Utility.Util.getValueOfInt($POP_PayMthd.val()) > 0) if (e.val() != "" && e.val() != null) if (ft.val() > 0) if (1) h[0].style.visibility = "visible", t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GeneratePaymentsMannualy", type: "POST", datatype: "json", async: !0, data: { InvoiceSchdIDS: s.toString(), OrderSchdIDS: l.toString(), BankID: VIS.Utility.Util.getValueOfInt($POP_cmbBank.val()), BankAccountID: VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val()), PaymentMethodID: VIS.Utility.Util.getValueOfInt($POP_PayMthd.val()), DateAcct: e.val(), CurrencyType: ft.val(), DateTrx: rt.val(), AD_Org_ID: VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val()), docTypeID: VIS.Utility.Util.getValueOfInt($POP_targetDocType.val()) }, success: function (n) { n = JSON.parse(n); y.find(".VA009-payment-wrap").remove(); o.find(".VA009-right-data-main").remove(); o.find(".VA009-accordion").remove(); b = 1; s = []; l = []; p = []; d = []; g(); it.prop("checked", !1); nt(); h[0].style.visibility = "hidden"; VIS.ADialog.info("", null, n, "") }, error: function (n) { console.log(n); h[0].style.visibility = "hidden"; VIS.ADialog.error("VA009_ErrorLoadingPayments") } }); else return VIS.ADialog.info("VA009_PlzSelctapprPM"), !1; else return VIS.ADialog.info("VA009_SelectConversionType"), !1; else return VIS.ADialog.info("VA009_PLSelectAcctDate"), !1; else return VIS.ADialog.info("VA009_PLSelectPaymentMethod"), !1; else return VIS.ADialog.info("VA009_PLSelectBankAccount"), !1; else return VIS.ADialog.info("VA009_PLSelectBank"), !1; else return VIS.ADialog.info("VA009_PlsSelectDocumentType"), u.selectNone(), !1; else return VIS.ADialog.info("VA009_PlsSelectOrg"), !1; else VIS.ADialog.info("VA009_PlzSelct1Pay") }; n.onCancelCLick = function () { a() }; n.onClose = function () { a() } }, Pay_ManualDialogBP: function () { function v() { var i, r, u, o; $POP_cmbOrg = $payManual.find("#VA009_POP_cmbOrg_" + f.windowNo); $POP_cmbDocType = $payManual.find("#VA009_POP_cmbDocType_" + f.windowNo); rt = $payManual.find("#VA009_TransactionDate_" + f.windowNo); e = $payManual.find("#VA009_AccountDate_" + f.windowNo); $POP_cmbBank = $payManual.find("#VA009_POP_cmbBank_" + f.windowNo); $POP_cmbBankAccount = $payManual.find("#VA009_POP_cmbBankAccount_" + f.windowNo); $POP_cmbBP = $payManual.find("#VA009_POP_cmbBP_" + f.windowNo); $POP_lookCharge = $payManual.find("#VA009_Charge_" + f.windowNo); _BusinessPartnerLookUp = VIS.MLookupFactory.getMLookUp(VIS.Env.getCtx(), f.windowNo, 3499, VIS.DisplayType.Search); $BpartnerControl = new VIS.Controls.VTextBoxButton("C_BPartner_ID", !0, !1, !0, VIS.DisplayType.Search, _BusinessPartnerLookUp); i = t('<div class="vis-control-wrap">'); r = t('<div class="input-group-append">'); $POP_cmbBP.append(i); $POP_cmbBP.append(r); i.append($BpartnerControl.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " ")).append("<label>" + VIS.Msg.getMsg("VA009_BPartner") + "<\/label>"); r.append($BpartnerControl.getBtn(0)); $BpartnerControl.getControl().addClass("vis-ev-col-mandatory"); _ChargeLookUp = VIS.MLookupFactory.getMLookUp(VIS.Env.getCtx(), f.windowNo, 3787, VIS.DisplayType.Search); $ChargeControl = new VIS.Controls.VTextBoxButton("C_Charge_ID", !0, !1, !0, VIS.DisplayType.Search, _ChargeLookUp); u = t('<div class="vis-control-wrap">'); o = t('<div class="input-group-append">'); $POP_lookCharge.append(u); $POP_lookCharge.append(o); u.append($ChargeControl.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " ")).append("<label>" + VIS.Msg.getMsg("Charge") + "<\/label>"); o.append($ChargeControl.getBtn(0)); $POP_cmbLocation = $payManual.find("#VA009_POP_cmbLocation_" + f.windowNo); $POP_Currency = $payManual.find("#VA009_POP_cmbCurrency_" + f.windowNo); ft = $payManual.find("#VA009_cmbCurrencyType_" + f.windowNo); $POP_PayMthd = $payManual.find("#VA009_cmbPayMthd_" + f.windowNo); $POP_ChkNo = $payManual.find("#VA009_txtCheck_" + f.windowNo); $POP_ChkDate = $payManual.find("#VA009_chkDate_" + f.windowNo); $DivChkNo = $payManual.find("#VA009_DivCheck_" + f.windowNo); $DivChkDate = $payManual.find("#VA009_DivCheckDate_" + f.windowNo); e.addClass("vis-ev-col-mandatory"); rt.addClass("vis-ev-col-mandatory"); $POP_cmbOrg.addClass("vis-ev-col-mandatory"); $POP_cmbDocType.addClass("vis-ev-col-mandatory"); $POP_cmbBank.addClass("vis-ev-col-mandatory"); $POP_cmbBankAccount.addClass("vis-ev-col-mandatory"); $POP_Currency.addClass("vis-ev-col-mandatory"); $POP_PayMthd.addClass("vis-ev-col-mandatory"); n.getControl().addClass("vis-ev-col-mandatory"); ft.addClass("vis-ev-col-mandatory"); $POP_cmbLocation.addClass("vis-ev-col-mandatory") } function w() { $POP_cmbBank.on("change", function () { function n(n) { if ($POP_cmbBankAccount.empty(), $POP_cmbBankAccount.append("<option value='0'><\/option>"), n != null && n.length > 0) for (var t in n) $POP_cmbBankAccount.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].C_BankAccount_ID) + ">" + VIS.Utility.encodeText(n[t].AccountNo) + "<\/option>") } $POP_cmbBankAccount.empty(); VIS.Utility.Util.getValueOfInt($POP_cmbBank.val()) == 0 ? $POP_cmbBank.addClass("vis-ev-col-mandatory") : $POP_cmbBank.removeClass("vis-ev-col-mandatory"); VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadBankAccount", { Bank_ID: $POP_cmbBank.val(), Orgs: $POP_cmbOrg.val() }, n) }); $POP_cmbBankAccount.on("change", function () { VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val()) == 0 ? $POP_cmbBankAccount.addClass("vis-ev-col-mandatory") : $POP_cmbBankAccount.removeClass("vis-ev-col-mandatory"); c() }); $POP_cmbDocType.on("change", function () { VIS.Utility.Util.getValueOfInt($POP_cmbDocType.val()) == 0 ? $POP_cmbDocType.addClass("vis-ev-col-mandatory") : $POP_cmbDocType.removeClass("vis-ev-col-mandatory"); c() }); rt.on("change", function () { rt.val() == "" ? rt.addClass("vis-ev-col-mandatory") : rt.removeClass("vis-ev-col-mandatory") }); e.on("change", function () { e.val() == "" ? e.addClass("vis-ev-col-mandatory") : e.removeClass("vis-ev-col-mandatory") }); $POP_cmbOrg.on("change", function () { $POP_cmbBank.empty(); $POP_cmbDocType.empty(); $POP_cmbBankAccount.empty(); $POP_cmbLocation.empty(); $POP_cmbDocType.addClass("vis-ev-col-mandatory"); $POP_cmbBank.addClass("vis-ev-col-mandatory"); $POP_cmbBankAccount.addClass("vis-ev-col-mandatory"); $POP_PayMthd.empty(); $POP_cmbOrg.val() == "0" ? $POP_cmbOrg.addClass("vis-ev-col-mandatory") : $POP_cmbOrg.removeClass("vis-ev-col-mandatory"); ot(); st($POP_cmbBank); ct(); ht(); et() }); $BpartnerControl.fireValueChanged = function () { $BpartnerControl.value != null && $BpartnerControl.getControl().removeClass("vis-ev-col-mandatory"); ut() }; $POP_cmbLocation.on("change", function () { $POP_cmbLocation.val() == "0" ? $POP_cmbLocation.addClass("vis-ev-col-mandatory") : $POP_cmbLocation.removeClass("vis-ev-col-mandatory") }); $POP_Currency.on("change", function () { $POP_Currency.val() == "0" ? $POP_Currency.addClass("vis-ev-col-mandatory") : $POP_Currency.removeClass("vis-ev-col-mandatory") }); ft.on("change", function () { ft.val() == "0" ? ft.addClass("vis-ev-col-mandatory") : ft.removeClass("vis-ev-col-mandatory") }); $POP_PayMthd.on("change", function () { $POP_PayMthd.val() == "0" ? $POP_PayMthd.addClass("vis-ev-col-mandatory") : $POP_PayMthd.removeClass("vis-ev-col-mandatory"); t("option:selected", $POP_PayMthd).attr("paybase") == "S" ? ($DivChkDate.show(), $DivChkNo.show()) : ($DivChkDate.hide(), $DivChkNo.hide()); c() }); n.getControl().on("change", function () { parseFloat(n.getValue()) > 0 ? n.getControl().removeClass("vis-ev-col-mandatory") : n.getControl().addClass("vis-ev-col-mandatory") }) } function c() { if (VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val()) > 0 && VIS.Utility.Util.getValueOfInt($POP_PayMthd.val()) > 0 && t("option:selected", $POP_PayMthd).attr("paybase") == "S" && t("option:selected", $POP_cmbDocType).attr("docbasetype") == "APP") { VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/getCheckNo", { C_BankAccount_ID: parseInt($POP_cmbBankAccount.val()), VA009_PaymentMethod_ID: parseInt($POP_PayMthd.val()) }, n); function n(n) { $POP_ChkNo.val(""); n != null && ($POP_ChkNo.val(n), r = n) } } else $POP_ChkNo.val(""), r = "" } function k() { tt() } function tt() { function n(n) { if ($POP_cmbOrg.empty(), $POP_cmbOrg.append(" <option value = 0><\/option>"), n.length > 0) for (var t in n) $POP_cmbOrg.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].AD_Org_ID) + ">" + VIS.Utility.encodeText(n[t].Name) + "<\/option>"); $POP_cmbOrg.prop("selectedIndex", 0) } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadOrganization", null, n) } function ut() { function n(n) { if ($POP_cmbLocation.empty(), $POP_cmbLocation.append(" <option value = 0><\/option>"), n.length > 0) for (var t in n) $POP_cmbLocation.append("<option value=" + VIS.Utility.Util.getValueOfString(n[t].C_Location_ID) + ">" + VIS.Utility.Util.getValueOfString(n[t].Name) + "<\/option>"); $POP_cmbLocation.prop("selectedIndex", 0) } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/GetLocation", { BP: $BpartnerControl.value }, n) } function et() { function n(n) { if ($POP_PayMthd.empty(), $POP_PayMthd.append(" <option value = 0><\/option>"), n.length > 0) for (var t in n) "LCPB".contains(n[t].VA009_PaymentBaseType) || $POP_PayMthd.append("<option paybase = " + n[t].VA009_PaymentBaseType + " value=" + VIS.Utility.Util.getValueOfInt(n[t].VA009_PaymentMethod_ID) + ">" + VIS.Utility.encodeText(n[t].VA009_Name) + " <\/option>"); $POP_PayMthd.prop("selectedIndex", 0) } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadPaymentMethod", null, n) } function ot() { function n(n) { if ($POP_cmbDocType.empty(), $POP_cmbDocType.append(" <option value = 0><\/option>"), n.length > 0) for (var t in n) $POP_cmbDocType.append("<option docbasetype=" + VIS.Utility.Util.getValueOfString(n[t].DocBaseType) + " value=" + VIS.Utility.Util.getValueOfInt(n[t].C_DocType_ID) + ">" + VIS.Utility.Util.getValueOfString(n[t].Name) + "<\/option>"); $POP_cmbDocType.prop("selectedIndex", 0) } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/GetDocumentType", { orgs: $POP_cmbOrg.val() }, n) } function st(n) { function t(t) { if (t.length > 0) { n.find("option").remove(); n.append("<option value='0'><\/option>"); for (var i in t) n.append("<option value=" + VIS.Utility.Util.getValueOfInt(t[i].C_Bank_ID) + ">" + VIS.Utility.encodeText(t[i].Name) + "<\/option>"); n.prop("selectedIndex", 0) } } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadBank", { Orgs: $POP_cmbOrg.val() }, t) } function ht() { function n(n) { if ($POP_Currency.empty(), $POP_Currency.append(" <option value = 0><\/option>"), n.length > 0) for (var t in n) $POP_Currency.append("<option value=" + VIS.Utility.Util.getValueOfString(n[t].C_Currency_ID) + ">" + VIS.Utility.Util.getValueOfString(n[t].ISO_Code) + "<\/option>"); $POP_Currency.prop("selectedIndex", 0) } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/LoadCurrencies", null, n) } function ct() { function n(n) { if (ft.empty(), ft.append("<option value='0'><\/option>"), n.length > 0) for (var t in n) ft.append("<option value=" + VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID) + ">" + VIS.Utility.encodeText(n[t].Name) + "<\/option>"), VIS.Utility.encodeText(n[t].IsDefault) == "Y" && (dt = VIS.Utility.Util.getValueOfInt(n[t].C_ConversionType_ID)) } VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/loadCurrencyType", null, n) } function a() { $payManual = null; _payManual = null } function lt() { return VIS.Utility.Util.getValueOfInt($POP_cmbOrg.val()) > 0 ? VIS.Utility.Util.getValueOfInt($POP_cmbDocType.val()) > 0 ? VIS.Utility.Util.getValueOfInt($POP_cmbBank.val()) > 0 ? VIS.Utility.Util.getValueOfInt($POP_cmbBankAccount.val()) > 0 ? rt.val() != "" && rt.val() != null ? e.val() != "" && e.val() != null ? VIS.Utility.Util.getValueOfInt($BpartnerControl.value) > 0 ? VIS.Utility.Util.getValueOfInt($POP_cmbLocation.val()) > 0 ? VIS.Utility.Util.getValueOfInt($POP_Currency.val()) > 0 ? VIS.Utility.Util.getValueOfInt(ft.val()) > 0 ? VIS.Utility.Util.getValueOfInt($POP_PayMthd.val()) > 0 ? VIS.Utility.Util.getValueOfDecimal(n.getValue()) > 0 ? t("option:selected", $POP_PayMthd).attr("paybase") == "S" ? $POP_ChkNo.val() != "" && $POP_ChkDate.val() != "" ? !0 : (VIS.ADialog.info("VA009_PLCheckNumber&Date"), !1) : !0 : (VIS.ADialog.info("VA009_PlsEnterAmount"), !1) : (VIS.ADialog.info("VA009_PlsSelectPayMethod"), !1) : (VIS.ADialog.info("VA009_PlsSelectCurrencyType"), !1) : (VIS.ADialog.info("VA009_PlsSelectCurrency"), !1) : (VIS.ADialog.info("SelectBPLocation"), !1) : (VIS.ADialog.info("SelectBusinessPartnerFirst"), !1) : (VIS.ADialog.info("VA009_PllsSelTAcctdate"), !1) : (VIS.ADialog.info("PllsSelTdate"), !1) : (VIS.ADialog.info("VA009_PLSelectBankAccount"), !1) : (VIS.ADialog.info("VA009_PLSelectBank"), !1) : (VIS.ADialog.info("VA009_PlsSelectDocumentType"), !1) : (VIS.ADialog.info("VA009_PlsSelectOrg"), !1) } function at() { var u = [], i = "", f = !1; t("option:selected", $POP_cmbDocType).attr("docbasetype") == "APP" && $POP_ChkNo.val() != r && r != "" && (f = !0); u.push({ Org: $POP_cmbOrg.val(), DocType: $POP_cmbDocType.val(), BankID: $POP_cmbBank.val(), BankAccountID: $POP_cmbBankAccount.val(), DateTrx: rt.val(), DateAcct: e.val(), BPID: $BpartnerControl.value, BPLocation: $POP_cmbLocation.val(), CurrencyID: $POP_Currency.val(), CurrencyType: ft.val(), PaymentMethod: $POP_PayMthd.val(), PaymentAmount: n.getValue(), CheckNo: $POP_ChkNo.val(), CheckDate: $POP_ChkDate.val(), charge: VIS.Utility.Util.getValueOfInt($ChargeControl.value), IsOverrideAutoCheck: f }); h[0].style.visibility = "visible"; t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GeneratePayMannual", type: "POST", datatype: "json", async: !0, data: { PaymentData: JSON.stringify(u) }, success: function (n) { n = JSON.parse(n); i = ""; y.find(".VA009-payment-wrap").remove(); o.find(".VA009-right-data-main").remove(); o.find(".VA009-accordion").remove(); b = 1; s = []; l = []; p = []; d = []; g(); nt(); h[0].style.visibility = "hidden"; fu = "M"; i != "" ? w2confirm(VIS.Msg.getMsg("VA009_GenPaymentFile")).yes(function () { s = []; l = []; it.prop("checked", !1); y.find(":checkbox").prop("checked", !1); kf(i, !1) }).no(function () { h[0].style.visibility = "hidden"; VIS.ADialog.info("", null, n, ""); console.log("user clicked NO") }) : VIS.ADialog.info("", null, n, "") }, error: function (n) { console.log(n); h[0].style.visibility = "hidden"; VIS.ADialog.error("VA009_ErrorLoadingPayments") } }) } var n, u, i, r; lblAmount = t("<label>"); n = new VIS.Controls.VAmountTextBox("VA009_cmbAmt_" + f.windowNo + "", !1, !1, !0, 50, 100, VIS.DisplayType.Amount, VIS.Msg.getMsg("Amount")); lblAmount.append(VIS.Msg.getMsg("Amount")); n.setValue(0); vr = VIS.DisplayType.GetNumberFormat(VIS.DisplayType.Amount); divAmount = t("<div class='VA009-popform-data input-group vis-input-wrap'>"); u = t("<div class='vis-control-wrap'>"); divAmount.append(u); u.append(n.getControl().attr("placeholder", " ").attr("data-placeholder", "")).append(lblAmount); $payManual = t("<div class='VA009-popform-content vis-formouterwrpdiv' style='min-height:435px'>"); _payManual = t("<div class='VA009-popfrm-wrap' style='height:auto !important'>"); _addOrg = t("<div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbOrg_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_Org") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbDocType_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_DocType") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbBank_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_Bank") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbBankAccount_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_BankAccount") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_TransactionDate_" + f.windowNo + "' placeholder=' ' data-placeholder=''> <label>" + VIS.Msg.getMsg("TransactionDate") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><input type='date' max='9999-12-31' id='VA009_AccountDate_" + f.windowNo + "' placeholder=' ' data-placeholder=''><label>" + VIS.Msg.getMsg("AccountDate") + "<\/label><\/div> <\/div><div class='VA009-popform-data input-group vis-input-wrap' id='VA009_POP_cmbBP_" + f.windowNo + "'><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbLocation_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("BPLocation") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_POP_cmbCurrency_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_Currency") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_cmbCurrencyType_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_CurrencyType") + "<\/label><\/div><\/div><div class='VA009-popform-data input-group vis-input-wrap' id='VA009_Charge_" + f.windowNo + "'><\/div><div class='VA009-popform-data input-group vis-input-wrap'><div class='vis-control-wrap'><select id='VA009_cmbPayMthd_" + f.windowNo + "'><\/select><label>" + VIS.Msg.getMsg("VA009_PayMethodlbl") + "<\/label><\/div><\/div>"); _addAmt = "<div class='VA009-popform-data input-group vis-input-wrap' id= VA009_DivCheck_" + f.windowNo + "><div class='vis-control-wrap'><input type='text' id='VA009_txtCheck_" + f.windowNo + "' placeholder=' ' data-placeholder=''><label>" + VIS.Msg.getMsg("VA009_ChequeNo") + "<\/label><\/div> <\/div><div class='VA009-popform-data input-group vis-input-wrap' id= VA009_DivCheckDate_" + f.windowNo + "><div class='vis-control-wrap'><input type='Date' max='9999-12-31' id='VA009_chkDate_" + f.windowNo + "' placeholder=' ' data-placeholder=''><label>" + VIS.Msg.getMsg("VA009_CheckDate") + "<\/label><\/div> <\/div><\/div><\/div>"; _payManual.append(_addOrg).append(divAmount).append(_addAmt); $payManual.append(_payManual); v(); i = new VIS.ChildDialog; i.setContent($payManual); i.setTitle(VIS.Msg.getMsg("VA009_PayMannual")); i.setHeight(window.innerHeight - 120); i.setWidth("70%"); i.setEnableResize(!0); i.setModal(!0); i.show(); w(); k(); n.addVetoableChangeListener(this); $POP_ChkNo.on("keydown keyup", function (n) { var t = String.fromCharCode(n.which) || n.key; if (!/[0-9\.\,]/.test(t) && n.which != 8 && n.which != 46 && (n.which < 65 || n.which > 90) && (n.which < 37 || n.which > 40) && n.which != 39 && n.which != 37 && (n.which < 96 || n.which > 105)) return !1; n.shiftKey && n.preventDefault() }); r = ""; n.addVetoableChangeListener(this); i.onOkClick = function () { if (lt()) at(); else return !1 }; i.onCancelCLick = function () { a() }; i.onClose = function () { a() }; this.vetoablechange = function (t) { t.propertyName == "VA009_cmbAmt_" + f.windowNo + "" && n.setValue(t.newValue) } }, ChequeDetails_Dialog: function (n, r) { function e() { w2ui["VA009_ChkDetailsGrid_" + f.windowNo].clear(); o = null; $opnChkDtls = null; w2ui["VA009_ChkDetailsGrid_" + f.windowNo].destroy() } function l() { var n = []; n.length == 0 && (n.push({ field: "recid", caption: VIS.Msg.getMsg("VA009_srno"), sortable: !0, size: "10%" }), n.push({ field: "C_Bpartner", caption: VIS.Msg.getMsg("VA009_Vendor"), sortable: !0, size: "10%" }), n.push({ field: "C_BPartner_Location_ID", caption: VIS.Msg.getMsg("VA009_PayLocation"), sortable: !0, size: "15%", render: function (n) { var t = s, r = n.C_BPartner_Location_ID, i; return t && (i = t.getDisplay(r)), i } }), n.push({ field: "C_InvoicePaySchedule_ID", caption: VIS.Msg.getMsg("VA009_Schedule"), hidden: !0, sortable: !0, size: "0%" }), n.push({ field: "CurrencyCode", caption: VIS.Msg.getMsg("VA009_Currency"), hidden: !0, sortable: !0, size: "10%" }), n.push({ field: "DueAmt", caption: VIS.Msg.getMsg("VA009_DueAmt"), hidden: !0, sortable: !0, size: "10%", style: "text-align: right" }), n.push({ field: "ConvertedAmt", caption: VIS.Msg.getMsg("Amount"), sortable: !0, size: "13%", style: "text-align: right", render: function (n) { var t = n.ConvertedAmt; return parseFloat(t).toLocaleString() } }), n.push({ field: "CheckNumber", caption: VIS.Msg.getMsg("VA009_ChkNo"), sortable: !0, size: "10%" }), n.push({ field: "CheckDate", caption: VIS.Msg.getMsg("VA009_CheckDate"), sortable: !0, size: "12%", render: function (n) { var t; return t = n.changes == undefined || n.changes.CheckDate == "" ? n.CheckDate : n.changes.CheckDate, new Date(t).toLocaleDateString() }, style: "text-align: left" }), n.push({ field: "Mandate", caption: VIS.Msg.getMsg("VA009_Mandate"), hidden: !0, sortable: !0, size: "10%" }), n.push({ field: "TransactionType", caption: VIS.Msg.getMsg("VA009_TransactionType"), sortable: !0, size: "1%" }), n.push({ field: "ConversionTypeId", caption: VIS.Msg.getMsg("VA009_ConversionType"), hidden: !0, sortable: !0, size: "0%" }), n.push({ field: "DiscountAmount", caption: VIS.Msg.getMsg("DiscountAmount"), hidden: !0, sortable: !0, size: "0%" }), n.push({ field: "ConvertedDiscountAmount", caption: VIS.Msg.getMsg("ConvertedDiscountAmount"), hidden: !0, sortable: !0, size: "0%" }), n.push({ field: "DiscountDate", caption: VIS.Msg.getMsg("DiscountDate"), hidden: !0, sortable: !0, size: "0%" })); ChequeDetailsGrd = null; ChequeDetailsGrd = h.w2grid({ name: "VA009_ChkDetailsGrid_" + f.windowNo, recordHeight: 25, multiSelect: !0, columns: n }); ChequeDetailsGrd.hideColumn("recid", "CurrencyCode", "C_InvoicePaySchedule_ID", "DueAmt", "ValidMonths", "Mandate", "TransactionType", "ConversionTypeId", "DiscountAmount", "ConvertedDiscountAmount", "DiscountDate") } function a(n, t, r, f) { var s; if (r.length > 0) { var o = 0, c = [], l = 0, a = 0, y = "N", h; if (n != null && n.length > 0 ? (o = parseInt(n[0].CURRENTNEXT), a = parseInt(n[0].VA009_BATCHLINEDETAILCOUNT), y = n[0].CHKNOAUTOCONTROL, n[0].ASSIGNEDCHKNUM = o, n[0].TOTALLINESCOUNT = 0, h = n) : (e(), u.close(), VIS.ADialog.info("VA009_ChequesNotAvail")), y == "Y") { for (i = 0; i < r.length; i++)if (h = v(n, o), h != null && (o = h.ASSIGNEDCHKNUM), i == 0 ? (r[i].CheckNumber = o, r[i].TotalLinesCount = 1, o = o + 1, n[0].TOTALLINESCOUNT = 1, c.push(r[i])) : (s = c.filter(function (n) { if (f) return n.C_BPartner_ID == r[i].C_BPartner_ID && n.C_BPartner_Location_ID == r[i].C_BPartner_Location_ID && n.TotalLinesCount < a }), s.length == 0 ? (r[i].CheckNumber = o, o = o + 1, r[i].TotalLinesCount = 1, n[0].TOTALLINESCOUNT = 1, c.push(r[i])) : (l = parseFloat(s[0].DueAmt) + parseFloat(r[i].DueAmt), s[0].DueAmt = l, l = parseFloat(s[0].ConvertedAmt) + parseFloat(r[i].ConvertedAmt), s[0].ConvertedAmt = l, s[0].TotalLinesCount = parseInt(s[0].TotalLinesCount) + 1, n[0].TOTALLINESCOUNT = s[0].TotalLinesCount)), h != null) for (j = 0; j < n.length; j++)parseInt(n[j].C_BANKACCOUNTDOC_ID) == parseInt(h.C_BANKACCOUNTDOC_ID) && (n[j].ASSIGNEDCHKNUM = o); w2utils.encodeTags(c); t.add(c) } else e(), u.close(), VIS.ADialog.info("VA009_PlzCngStngOfAutoCntrl") } rf && VIS.ADialog.info("VA009_ChequesNotAvail") } function v(n, t) { var i = [], r = !1; for (C_Num = 0; C_Num < n.length; C_Num++)if (n[C_Num].hasOwnProperty("ASSIGNEDCHKNUM")) { if (parseInt(n[C_Num].ASSIGNEDCHKNUM) <= parseInt(n[C_Num].ENDCHKNUMBER)) { i = n[C_Num]; r = !1; break } } else { n[C_Num].ASSIGNEDCHKNUM = parseInt(n[C_Num].CURRENTNEXT); n[C_Num].TOTALLINESCOUNT = 0; i = n[C_Num]; r = !0; break } return r || i == null || (i.ASSIGNEDCHKNUM = parseInt(t)), (i == null || i != null && i.length == 0) && (i.ASSIGNEDCHKNUM = "", rf = !0), i } var o, s, h, u; $opnChkDtls = t("<div class='VA009-popform-content' style='min-height:25px !important'>"); o = ""; s = null; o += "<div class='VA009-table-container' style='height:300px;' id='VA009_ChkDetailsGrid_" + f.windowNo + "'> <\/div>'"; $opnChkDtls.append(o); h = $opnChkDtls.find("#VA009_ChkDetailsGrid_" + f.windowNo); rf = !1; u = new VIS.ChildDialog; u.setContent($opnChkDtls); u.setTitle(VIS.Msg.getMsg("VA009_CheckDetails")); u.setWidth("50%"); u.setEnableResize(!0); u.setModal(!0); u.show(); u.hidebuttons(); l(); s = VIS.MLookupFactory.get(VIS.Env.getCtx(), f.windowNo, 0, VIS.DisplayType.TableDir, "C_BPartner_Location_ID", 0, !1, "C_BPartner_Location.IsActive='Y' "); a(JSON.parse(n), ChequeDetailsGrd, JSON.parse(JSON.stringify(c.records)), r); u.onOkClick = function () { e() }; u.onCancelCLick = function () { e() }; u.onClose = function () { e() } } }; yr = function (n, t, i) { var r = 0, u; try { r = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VA009/Payment/GetWindowID", { WindowName: t }, null); r > 0 && (u = new VIS.Query, u.addRestriction(i, VIS.Query.prototype.EQUAL, n), VIS.viewManager.startWindow(r, u)) } catch (f) { console.log(f) } }; gf = function (n, t, i) { n = n == "Y" ? "IS NOT NULL" : "IS NULL"; t == "ARI" ? er = " WHERE cs.c_invoice_id " + n + " AND cs.va009_ispaid    = 'N' AND cd.docbasetype IN  ('ARI','ARC' , 'SOO') AND inv.docstatus IN ('CO','CL')" + i : t == "API" && (er = " WHERE cs.c_invoice_id " + n + " AND cs.va009_ispaid    = 'N' AND cd.docbasetype IN  ('API','APC' , 'POO') AND inv.docstatus IN ('CO','CL')" + i) }; ne = function (n, i) { var r = t("<iframe>", { id: "idown_" + i, src: n }).hide().appendTo("body") }; this.getRoot = function () { return v }; this.disposeComponent = function () { f = null; v && v.remove(); v = null; et = null; pt = null; ir = null; cu = null; te = null; lu = null; _iscustomer = null; _isvendor = null; rr = null; ot = null; li = null; ht = null; ai = null; ct = null; vi = null; au = null; $lbdata = null; wr = null; y = null; kr = null; yi = null; o = null; b = null; dr = null; hf = null; ni = null; pi = null; $UCR_Tab = null; $UCP_Tab = null; vu = null; cf = null; er = null; wi = null; ti = null; ri = null; s = null; l = null; ei = null; oi = null; bi = null; or = null; sr = null; ui = null; af = null; pu = null; wu = null; bu = null; ku = null; w = null; ru = null; n = null; ci = null }; this.setSize = function () { var n = t("#VA009-main-container_" + f.windowNo).height(), i = t("#VA009-middle-wrap_" + f.windowNo).height(), r = 0; n == 0 && (n = window.innerHeight - 107, i = n - 85, r = n - 90); pf.height(n); r <= wr.height() && (r = wr.height(), i = n); t("#VA009-content-area_" + f.windowNo).height(n - 20); t("#VA009_Paymntlst_" + f.windowNo).height(i - t("#VA009-mid-top-wrap_" + f.windowNo).height() - t("#VA009-mid-search_" + f.windowNo).height() - 42); pr.height(n - 54) }; this.lockUI = function () { }; this.unlockUI = function () { }; this.parentcall = function () { h[0].style.visibility = "hidden" }; this.initial = function () { } }; n.PaymentForm.prototype.init = function (n, t) { this.windowNo = n; this.frame = t; this.Initialize(); this.frame.getContentGrid().append(this.getRoot()); this.setSize() }; n.PaymentForm.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null } }(VA009, jQuery); VA009 = window.VA009 || {}, function (n) { function i() { VIS.CalloutEngine.call(this, "VA009.VA009_CalloutPayment") } function r() { VIS.CalloutEngine.call(this, "VA009.VA009_CalloutPaymentTerm") } function u() { VIS.CalloutEngine.call(this, "VA009.VA009_CalloutCashJournal") } var f = VIS.Logging.Level, t = VIS.Utility.Util; VIS.Utility.inheritPrototype(i, VIS.CalloutEngine); i.prototype.setPMethod = function (n, t, i, r, u) { if (this.isCalloutActive() || u == null) return ""; this.setCalloutActive(!0); var e = i.getValue("C_InvoicePaySchedule_ID"), o = i.getValue("AD_Client_ID"), s = e.toString() + "," + o.toString(), f = VIS.dataContext.getJSONRecord("Pay/GetInvPaymentMethod", s); return f != null && (i.setValue("VA009_PaymentMethod_id", f.VA009_PaymentMethod_ID), f.VA009_PaymentBaseType == "D" ? i.setValue("TenderType", "D") : f.VA009_PaymentBaseType == "K" ? i.setValue("TenderType", "C") : f.VA009_PaymentBaseType == "S" ? i.setValue("TenderType", "K") : f.VA009_PaymentBaseType == "T" ? i.setValue("TenderType", "A") : f.VA009_PaymentBaseType == "L" ? i.setValue("TenderType", "L") : i.setValue("TenderType", "A"), i.setValue("VA009_ExecutionStatus", f.VA009_ExecutionStatus)), this.setCalloutActive(!1), "" }; i.prototype.setScheduleAmount = function (n, i, r, u, f) { var p = VIS.dataContext.getJSONRecord("Pay/GetIsAdvanceOrder", n.getContextAsInt(i, "C_Order_ID")), e, k, v, o; if (p != null && !p) return ""; if (f == null || f.toString() == "") return r.setValue("VA009_ExecutionStatus", null), r.setValue("DiscountAmt", VIS.Env.ZERO), r.setValue("PayAmt", VIS.Env.ZERO), r.setValue("WriteOffAmt", VIS.Env.ZERO), r.setValue("IsOverUnderPayment", !1), r.setValue("OverUnderAmt", VIS.Env.ZERO), e = VIS.dataContext.getJSONRecord("Pay/GetDueAmt", n.getContextAsInt(i, "C_Order_ID")), e != null && (l = e.DueAmt, r.setValue("PayAmt", l), r.setValue("PaymentAmount", l)), ""; this.setCalloutActive(!0); var d = r.getValue("AD_Client_ID"), g = f.toString() + "," + d.toString(), e = VIS.dataContext.getJSONRecord("Pay/GetOrdPaymentMethod", g); e != null && (r.setValue("VA009_PaymentMethod_id", e.VA009_PaymentMethod_ID), e.VA009_PaymentBaseType == "D" ? r.setValue("TenderType", "D") : e.VA009_PaymentBaseType == "K" ? r.setValue("TenderType", "C") : e.VA009_PaymentBaseType == "S" ? r.setValue("TenderType", "K") : e.VA009_PaymentBaseType == "T" ? r.setValue("TenderType", "A") : e.VA009_PaymentBaseType == "L" ? r.setValue("TenderType", "L") : r.setValue("TenderType", "A"), r.setValue("VA009_ExecutionStatus", e.VA009_ExecutionStatus), r.setValue("DiscountAmt", VIS.Env.ZERO), r.setValue("WriteOffAmt", VIS.Env.ZERO), r.setValue("IsOverUnderPayment", !1), r.setValue("OverUnderAmt", VIS.Env.ZERO)); var w = 0, y = n.getContextAsInt(i, "C_Order_ID"), l = 0, e = VIS.dataContext.getJSONRecord("Pay/GetDueAmt", y.toString()); e != null && (w = e.VA009_OrderPaySchedule_ID, l = e.DueAmt, r.setValue("PayAmt", l), r.setValue("PaymentAmount", l)); var nt = "N", b = "N", tt = y.toString() + "," + r.getValue("DateTrx").toString() + "," + w.toString(), e = VIS.dataContext.getJSONRecord("Pay/GetOpenAmt", tt); e != null && (r.setValue("C_BPartner_ID", e.C_BPartner_ID), k = e.C_Currency_ID, nt = e.IsSOTrx, b = e.IsReturnTrx, r.setValue("C_Currency_ID", k), v = e.orderopen, v == null && (v = VIS.Env.ZERO), o = e.OrderDiscount, o == null && (o = VIS.Env.ZERO), o != 0 && (r.setValue("PayAmt", v - o), r.setValue("PaymentAmount", v - o)), r.setValue("DiscountAmt", o), n.setContext(i, "C_Order_ID", y.toString())); var s = t.getValueOfDecimal(r.getValue("PayAmt") == null ? VIS.Env.ZERO : r.getValue("PayAmt")), h = t.getValueOfDecimal(r.getValue("WriteOffAmt") == null ? VIS.Env.ZERO : r.getValue("WriteOffAmt")), c = t.getValueOfDecimal(r.getValue("OverUnderAmt") == null ? VIS.Env.ZERO : r.getValue("OverUnderAmt")), a = t.getValueOfDecimal(r.getValue("DiscountAmt") == null ? VIS.Env.ZERO : r.getValue("DiscountAmt")); return b == "Y" ? (s > 0 && (s = s * -1, r.setValue("PayAmt", s), r.setValue("PaymentAmount", s)), a > 0 && (a = a * -1), o > 0 && (o = o * -1), h > 0 && (h = h * -1, r.setValue("WriteOffAmt", h)), c > 0 && (c = c * -1, r.setValue("OverUnderAmt", c))) : (s < 0 && (s = s * -1, r.setValue("PayAmt", s), r.setValue("PaymentAmount", s)), a < 0 && (a = a * -1), o < 0 && (o = o * -1), h < 0 && (h = h * -1, r.setValue("WriteOffAmt", h)), c < 0 && (c = c * -1, r.setValue("OverUnderAmt", c))), this.setCalloutActive(!1), "" }; i.prototype.SetPaySelectionScheduleAmt = function (n, i, r, u, f) { if (this.isCalloutActive() || f == null) return ""; this.setCalloutActive(!0); var o = r.getValue("AD_Client_ID"), s = r.getValue("C_PaySelection_ID"), h = f.toString() + "," + o.toString() + "," + s, e = VIS.dataContext.getJSONRecord("Pay/GetScheduleData", h); return e != null && (r.setValue("C_Invoice_ID", e.C_Invoice_ID), r.setValue("PayAmt", t.getValueOfDecimal(e.OpenAmt) - t.getValueOfDecimal(e.DISCOUNT1) - t.getValueOfDecimal(e.DISCOUNT2)), r.setValue("OpenAmt", e.OpenAmt), r.setValue("DiscountAmt", t.getValueOfDecimal(e.DISCOUNT1) + t.getValueOfDecimal(e.DISCOUNT2)), r.setValue("WriteOffAmt", VIS.Env.ZERO), r.setValue("IsOverUnderPayment", !1), r.setValue("PaymentRule", e.PAYMENTRULE), r.setValue("VA009_PAYMENTMETHOD_ID", e.VA009_PAYMENTMETHOD_ID), r.setValue("IsSOTrx", e.IsSOTrx), r.setValue("C_InvoicePaySchedule_ID", f)), this.setCalloutActive(!1), "" }; i.prototype.Amounts = function (n, i, r, u, f, e) { var b, g, nt, ut, w, ot; if (this.isCalloutActive()) return ""; if (b = n.getContextAsInt(i, "C_Order_ID"), g = n.getContextAsInt(i, "VA009_OrderPaySchedule_ID"), b > 0 || g > 0) { if (n.getContextAsInt(i, "C_Payment_ID") == 0 && n.getContextAsInt(i, "C_BPartner_ID") == 0 && b == 0 || (nt = r.getValue("C_Currency_ID"), nt == null)) return ""; this.setCalloutActive(!0); var y = u.getColumnName(), l = VIS.Env.ZERO, s = VIS.Env.ZERO, p = 0, tt = 0, st = "N", rt = "N"; b != 0 && (ut = b.toString() + "," + r.getValue("DateTrx").toString() + "," + g.toString(), w = VIS.dataContext.getJSONRecord("Pay/GetOpenAmt", ut), w != null && (p = w.C_Currency_ID, l = w.orderopen, st = w.IsSOTrx, rt = w.IsReturnTrx, l == null && (l = VIS.Env.ZERO), s = w.OrderDiscount, tt = w.C_ConversionType_ID)); this.log.fine(" Discount= " + s + ", C_Order_ID=" + b + ", C_Currency_ID=" + p); y == "PaymentAmount" && r.setValue("PayAmt", r.getValue("PaymentAmount")); var o = t.getValueOfDecimal(r.getValue("PayAmt") == null ? VIS.Env.ZERO : r.getValue("PayAmt")), c = t.getValueOfDecimal(r.getValue("WriteOffAmt") == null ? VIS.Env.ZERO : r.getValue("WriteOffAmt")), h = t.getValueOfDecimal(r.getValue("OverUnderAmt") == null ? VIS.Env.ZERO : r.getValue("OverUnderAmt")), a = t.getValueOfDecimal(r.getValue("DiscountAmt") == null ? VIS.Env.ZERO : r.getValue("DiscountAmt")); rt == "Y" ? (o > 0 && (o = o * -1, r.setValue("PayAmt", o), r.setValue("PaymentAmount", o)), a > 0 && (a = a * -1), s > 0 && (s = s * -1), c > 0 && (c = c * -1, r.setValue("WriteOffAmt", c)), h > 0 && (h = h * -1, r.setValue("OverUnderAmt", h))) : (o < 0 && (o = o * -1, r.setValue("PayAmt", o), r.setValue("PaymentAmount", o)), a < 0 && (a = a * -1), s < 0 && (s = s * -1), c < 0 && (c = c * -1, r.setValue("WriteOffAmt", c)), h < 0 && (h = h * -1, r.setValue("OverUnderAmt", h))); this.log.fine("Pay=" + o + ", Discount=" + a + ", WriteOff=" + c + ", OverUnderAmt=" + h); var k = t.getValueOfInt(nt), ht = k.toString(), d = VIS.dataContext.getJSONRecord("MCurrency/GetCurrency", ht), ft = r.getValue("DateTrx"), it = 0, et = t.getValueOfInt(r.getValue("C_ConversionType_ID")); et != null && (it = et); var ct = n.getContextAsInt(i, "AD_Client_ID"), lt = n.getContextAsInt(i, "AD_Org_ID"), v = VIS.Env.ONE; if (k > 0 && p > 0 && k != p || y == "C_Currency_ID" || y == "C_ConversionType_ID") { if (this.log.fine("InvCurrency=" + p + ", PayCurrency=" + k + ", Date=" + ft + ", Type=" + it), ot = p + "," + k + "," + ft + "," + it + "," + ct + "," + lt, v = VIS.dataContext.getJSONRecord("MConversionRate/GetRate", ot), v == null || v.toString() == 0) { if (this.setCalloutActive(!1), p == 0) return ""; if (r.setValue("C_Currency_ID", p), y == "C_ConversionType_ID") { if (tt == 0) return ""; r.setValue("C_ConversionType_ID", tt) } return "NoCurrencyConversion" } l = (l * v).toFixed(d.StdPrecision); s = (s * v).toFixed(d.StdPrecision); this.log.fine("Rate=" + v + ", OrderopenAmt=" + l + ", DiscountAmt=" + s) } if (y == "C_Currency_ID" || y == "C_ConversionType_ID") c = (c * v).toFixed(d.StdPrecision), r.setValue("WriteOffAmt", c), h = (h * v).toFixed(d.StdPrecision), r.setValue("OverUnderAmt", h), a = (a * v).toFixed(d.StdPrecision), r.setValue("DiscountAmt", a), o = l - s - c - h, r.setValue("PayAmt", o), r.setValue("PaymentAmount", o), o == l - s - c - h && (r.setValue("DiscountAmt", VIS.Env.ZERO), r.setValue("OverUnderAmt", VIS.Env.ZERO), r.setValue("WriteOffAmt", VIS.Env.ZERO)); else if (b == 0) VIS.Env.ZERO != s && r.setValue("DiscountAmt", VIS.Env.ZERO), VIS.Env.ZERO != c && r.setValue("WriteOffAmt", VIS.Env.ZERO), VIS.Env.ZERO != h && r.setValue("OverUnderAmt", VIS.Env.ZERO); else if (y == "PayAmt" || y == "PaymentAmount") { if (r.getValue("PayAmt") > l) return r.setValue("PayAmt", l), r.setValue("PaymentAmount", l), r.setValue("DiscountAmt", VIS.Env.ZERO), r.setValue("OverUnderAmt", VIS.Env.ZERO), r.setValue("WriteOffAmt", VIS.Env.ZERO), VIS.ADialog.info("VA009_CannottIncreaseAmount"), this.setCalloutActive(!1), ""; h = l - o - s - c; r.setValue("OverUnderAmt", h) } else s = a, o = l - s - c - h, r.setValue("PayAmt", o), r.setValue("PaymentAmount", o), r.setValue("DiscountAmt", s) } return n.setContext(i, "PayAmt", o), this.setCalloutActive(!1), n = i = r = u = f = e = null, "" }; i.prototype.Invoice = function (n, i, r, u, f) { if (this.isCalloutActive() || f == null) return ""; this.setCalloutActive(!0); var e = VIS.dataContext.getJSONRecord("Pay/GetSchedule", t.getValueOfInt(f)); return e != null && r.setValue("C_InvoicePaySchedule_ID", e.C_InvoicePaySchedule_ID), this.setCalloutActive(!1), "" }; i.prototype.PaymentBaseType = function (n, t, i, r, u, f) { return this.isCalloutActive() ? "" : (u.toString() == "B" ? (i.setValue("VA009_PaymentMode", "C"), i.getField("VA009_PaymentMode").setReadOnly(!0), i.setValue("VA009_PaymentType", "S"), i.getField("VA009_PaymentType").setReadOnly(!0), i.setValue("VA009_PaymentTrigger", "S"), i.getField("VA009_PaymentTrigger").setReadOnly(!0), i.setValue("VA009_PaymentRule", "M"), i.getField("VA009_PaymentRule").setReadOnly(!0)) : (i.setValue("VA009_PaymentMode", "B"), i.getField("VA009_PaymentMode").setReadOnly(!0), i.setValue("VA009_PaymentType", null), i.getField("VA009_PaymentType").setReadOnly(!1), i.setValue("VA009_PaymentTrigger", null), i.getField("VA009_PaymentTrigger").setReadOnly(!1), i.setValue("VA009_PaymentRule", null), i.getField("VA009_PaymentRule").setReadOnly(!1)), this.setCalloutActive(!1), n = t = i = r = u = f = null, "") }; i.prototype.PaymentTrigger = function (n, t, i, r, u, f) { return this.isCalloutActive() ? "" : (u != null && (u.toString() == "R" ? i.setValue("VA009_IsMandate", "Y") : i.setValue("VA009_IsMandate", "N")), this.setCalloutActive(!1), n = t = i = r = u = f = null, "") }; i.prototype.DisplayBPmandate = function (n, t, i, r, u) { var e; if (this.isCalloutActive() || u == null) return ""; this.setCalloutActive(!0); var o = i.getValue("VA009_PaymentMethod_ID"), s = i.getValue("AD_Client_ID"), h = o.toString() + "," + s.toString(), f = VIS.dataContext.getJSONRecord("Pay/GetMandate", h); f != null && (e = f.VA009_IsMandate, e == "Y" ? i.setValue("VA009_IsBPMandate", "Y") : i.setValue("VA009_IsBPMandate", "N")); this.setCalloutActive(!1) }; i.prototype.DisplayBPmandatePO = function (n, t, i, r, u) { var e; if (this.isCalloutActive() || u == null) return ""; this.setCalloutActive(!0); var o = i.getValue("VA009_PO_PaymentMethod_ID"), s = i.getValue("AD_Client_ID"), h = o.toString() + "," + s.toString(), f = VIS.dataContext.getJSONRecord("Pay/GetMandate", h); f != null && (e = f.VA009_IsMandate, e == "Y" ? i.setValue("VA009_IsBPMandate", "Y") : i.setValue("VA009_IsBPMandate", "N")); this.setCalloutActive(!1) }; i.prototype.PaymentMethod = function (n, i, r, u, f, e) { if (this.isCalloutActive() || f == null || f.toString() == "") return ""; var o = VIS.dataContext.getJSONRecord("Pay/GetPaymentRule", t.getValueOfInt(f)); return o != null && (r.setValue("VA009_PaymentRule", o.VA009_PAYMENTRULE), r.setValue("VA009_PAYMENTTRIGGER", o.VA009_PAYMENTTRIGGER)), this.setCalloutActive(!1), n = i = r = u = f = e = null, "" }; i.prototype.SetPaymentType = function (n, i, r, u, f, e) { var o, h; if (this.isCalloutActive() || f == null || f.toString() == "") return ""; if (this.setCalloutActive(!0), o = VIS.dataContext.getJSONRecord("Pay/GetPaymentRule", t.getValueOfInt(f)), h = r.getValue("C_Currency_ID"), o != null) { if (t.getValueOfInt(o.C_Currency_ID) > 0 && h != t.getValueOfInt(o.C_Currency_ID)) return r.setValue("VA009_PaymentMethod_ID", null), this.setCalloutActive(!1), VIS.ADialog.info("Desired payment method does not match with price list currency"), ""; var c = "N", l = "N", a = t.getValueOfInt(r.getValue("C_BPartner_ID")), s = VIS.dataContext.getJSONRecord("Pay/GetBPPaymentRule", a); s != null && (c = t.getValueOfString(s.ISVENDOR), l = t.getValueOfString(s.IsCustomer)); c == "Y" ? (r.setValue("PaymentRulePO", s.va009_paymentbasetypePO), l == "N" ? r.setValue("PaymentRule", null) : r.setValue("PaymentRule", o.VA009_PAYMENTBASETYPE)) : (r.setValue("PaymentRule", o.VA009_PAYMENTBASETYPE), r.setValue("PaymentRulePO", null)); r.setValue("PaymentMethod", o.VA009_PAYMENTBASETYPE) } else r.setValue("PaymentRule", "T"), r.setValue("PaymentMethod", "T"), r.setValue("PaymentRulePO", "T"); return this.setCalloutActive(!1), n = i = r = u = f = e = null, "" }; i.prototype.SetPaymentTypeInv = function (n, i, r, u, f, e) { if (this.isCalloutActive() || f == null || f.toString() == "") return ""; this.setCalloutActive(!0); var o = VIS.dataContext.getJSONRecord("Pay/GetPaymentRule", t.getValueOfInt(f)), s = r.getValue("C_Currency_ID"), h = !1; if (h = r.getValue("IsSOTrx"), o != null) { if (t.getValueOfInt(o.C_Currency_ID) > 0 && s != t.getValueOfInt(o.C_Currency_ID)) return r.setValue("VA009_PaymentMethod_ID", null), this.setCalloutActive(!1), VIS.ADialog.info("Desired payment method does not match with price list currency"), ""; r.setValue("PaymentRule", o.VA009_PAYMENTBASETYPE); r.setValue("PaymentMethod", o.VA009_PAYMENTBASETYPE) } else r.setValue("PaymentRule", "T"), r.setValue("PaymentMethod", "T"), r.setValue("PaymentRulePO", "T"); return this.setCalloutActive(!1), n = i = r = u = f = e = null, "" }; i.prototype.SetPaymentTypeOnVendor = function (n, i, r, u, f, e) { var s, h, o; return this.isCalloutActive() || f == null || f.toString() == "" ? "" : (this.setCalloutActive(!0), s = !1, h = !1, s = r.getValue("IsVendor"), h = r.getValue("IsCustomer"), o = VIS.dataContext.getJSONRecord("Pay/GetPaymentRule", t.getValueOfInt(f)), o != null ? (s ? (r.setValue("PaymentRulePO", o.VA009_PAYMENTBASETYPE), h || r.setValue("PaymentRule", null)) : (r.setValue("PaymentRule", o.VA009_PAYMENTBASETYPE), r.setValue("PaymentRulePO", null)), r.setValue("PaymentMethod", o.VA009_PAYMENTBASETYPE)) : (r.setValue("PaymentRule", "T"), r.setValue("PaymentMethod", "T"), r.setValue("PaymentRulePO", "T")), this.setCalloutActive(!1), n = i = r = u = f = e = null, "") }; i.prototype.SetBPPaymentRuleOnPayment = function (n, i, r, u, f, e) { var s, o, c, h; return this.isCalloutActive() || f == null || f.toString() == "" ? "" : (this.setCalloutActive(!0), s = VIS.dataContext.getJSONRecord("Pay/GetBPPaymentRule", t.getValueOfInt(f)), o = "A", s != null && (c = t.getValueOfInt(r.getValue("C_DocType_ID")), h = VIS.dataContext.getJSONRecord("Pay/GetPayBaseType", c), t.getValueOfString(s.ISVENDOR) == "N" ? h != null && (h.DocBaseType == "ARR" && (r.setValue("va009_paymentmethod_id", s.va009_paymentmethod_id), o = t.getValueOfString(s.va009_paymentbasetype)), h.DocBaseType == "APP" && (r.setValue("va009_paymentmethod_id", null), o = "A")) : (h != null && (h.DocBaseType == "ARR" && (r.setValue("va009_paymentmethod_id", null), o = "A"), h.DocBaseType == "APP" && (r.setValue("va009_paymentmethod_id", s.VA009_PO_PaymentMethod_ID), o = t.getValueOfString(s.va009_paymentbasetypePO))), t.getValueOfString(s.IsCustomer) == "Y" && h != null && (h.DocBaseType == "ARR" && (r.setValue("va009_paymentmethod_id", s.va009_paymentmethod_id), o = t.getValueOfString(s.va009_paymentbasetype)), h.DocBaseType == "APP" && (r.setValue("va009_paymentmethod_id", s.VA009_PO_PaymentMethod_ID), o = t.getValueOfString(s.va009_paymentbasetypePO)))), o != "B" && o != "C" && o != "P" ? o == "D" ? r.setValue("TenderType", "D") : o == "K" ? r.setValue("TenderType", "C") : o == "S" ? r.setValue("TenderType", "K") : o == "T" ? r.setValue("TenderType", "A") : o == "L" ? r.setValue("TenderType", "L") : r.setValue("TenderType", "A") : r.setValue("va009_paymentmethod_id", null)), this.setCalloutActive(!1), n = i = r = u = f = e = null, "") }; i.prototype.SetBPPaymentRule = function (n, i, r, u, f, e) { if (this.isCalloutActive() || f == null || f.toString() == "") return ""; this.setCalloutActive(!0); var o = VIS.dataContext.getJSONRecord("Pay/GetBPPaymentRule", t.getValueOfInt(f)); return o != null && (t.getValueOfString(o.ISVENDOR) == "N" ? r.setValue("va009_paymentmethod_id", o.va009_paymentmethod_id) : r.setValue("va009_paymentmethod_id", o.VA009_PO_PaymentMethod_ID), t.getValueOfString(o.va009_paymentbasetype) != "B" && t.getValueOfString(o.va009_paymentbasetype) != "C" && t.getValueOfString(o.va009_paymentbasetype) != "P" ? t.getValueOfString(o.va009_paymentbasetype == "D") ? r.setValue("TenderType", "D") : t.getValueOfString(o.va009_paymentbasetype == "K") ? r.setValue("TenderType", "C") : t.getValueOfString(o.va009_paymentbasetype == "S") ? r.setValue("TenderType", "K") : t.getValueOfString(o.va009_paymentbasetype == "T") ? r.setValue("TenderType", "A") : o.va009_paymentbasetype == "L" ? r.setValue("TenderType", "L") : r.setValue("TenderType", "A") : r.setValue("va009_paymentmethod_id", null)), this.setCalloutActive(!1), n = i = r = u = f = e = null, "" }; i.prototype.SetInvoicePaymentRule = function (n, i, r, u, f, e) { if (this.isCalloutActive() || f == null || f.toString() == "") return ""; this.setCalloutActive(!0); var o = VIS.dataContext.getJSONRecord("Pay/GetInvoicePaymentRule", t.getValueOfInt(f)); return o != null && (r.setValue("va009_paymentmethod_id", o.va009_paymentmethod_id), o.va009_paymentbasetype == "D" ? r.setValue("TenderType", "D") : o.va009_paymentbasetype == "K" ? r.setValue("TenderType", "C") : o.va009_paymentbasetype == "S" ? r.setValue("TenderType", "K") : o.va009_paymentbasetype == "T" ? r.setValue("TenderType", "A") : o.va009_paymentbasetype == "L" ? r.setValue("TenderType", "L") : r.setValue("TenderType", "A")), this.setCalloutActive(!1), n = i = r = u = f = e = null, "" }; i.prototype.SetTenderType = function (n, i, r, u, f, e) { var o, l; if (this.isCalloutActive() || f == null || f.toString() == "") return ""; this.setCalloutActive(!0); o = VIS.dataContext.getJSONRecord("Pay/GetPaymentRule", t.getValueOfInt(f)); o != null && (o.VA009_PAYMENTBASETYPE == "D" ? r.setValue("TenderType", "D") : o.VA009_PAYMENTBASETYPE == "K" ? r.setValue("TenderType", "C") : o.VA009_PAYMENTBASETYPE == "S" ? r.setValue("TenderType", "K") : o.VA009_PAYMENTBASETYPE == "T" ? r.setValue("TenderType", "A") : o.VA009_PAYMENTBASETYPE == "L" ? r.setValue("TenderType", "L") : r.setValue("TenderType", "A")); t.getValueOfString(r.getValue("TenderType")) != "K" && (r.setValue("CheckNo", ""), r.setValue("CheckDate", "")); var s = t.getValueOfInt(r.getValue("C_BankAccount_ID")), h = t.getValueOfInt(r.getValue("VA009_PaymentMethod_ID")), a = t.getValueOfString(r.getValue("CheckNo")), c = !1; return s > 0 && h > 0 && a != "" && t.getValueOfString(r.getValue("TenderType")) == "K" && (l = s.toString() + "," + h.toString(), c = t.getValueOfBoolean(VIS.dataContext.getJSONRecord("VIS/MPayment/GetAutoCheckControl", l.toString()))), r.setValue("IsOverrideAutoCheck", c), this.setCalloutActive(!1), n = i = r = u = f = e = null, "" }; i.prototype.SetPayAllocateAmt = function (n, i, r, u, f, e) { var l, h, o; if (this.isCalloutActive() || f == null || f.toString() == "") return ""; if (this.setCalloutActive(!0), l = r.getValue("C_Payment_ID"), h = r.getValue("C_Invoice_ID"), h == null) r.setValue("Amount", VIS.Env.ZERO), r.setValue("InvoiceAmt", VIS.Env.ZERO), r.setValue("DiscountAmt", VIS.Env.ZERO), r.setValue("WriteOffAmt", VIS.Env.ZERO), r.setValue("OverUnderAmt", VIS.Env.ZERO); else if (o = VIS.dataContext.getJSONRecord("Pay/GetPayAllocateAmt", l.toString() + "," + h + "," + f.toString()), o != null) { var s = t.getValueOfDecimal(o.Dueamt), c = t.getValueOfDecimal(o.discount), a = o.IsReturnTrx; a == "Y" && (s > 0 && (s = s * -1), c > 0 && (c = c * -1)); r.setValue("Amount", s); r.setValue("InvoiceAmt", s); r.setValue("DiscountAmt", VIS.Env.ZERO); r.setValue("WriteOffAmt", VIS.Env.ZERO); r.setValue("OverUnderAmt", VIS.Env.ZERO) } return this.setCalloutActive(!1), n = i = r = u = f = e = null, "" }; i.prototype.OrderSchedule = function (n, i, r, u, f) { var o, e; return this.isCalloutActive() || f == null ? "" : (this.setCalloutActive(!0), o = VIS.dataContext.getJSONRecord("Pay/GetDueAmt", t.getValueOfInt(f)), o != null ? r.setValue("VA009_OrderPaySchedule_ID", o.VA009_OrderPaySchedule_ID) : (r.setValue("VA009_OrderPaySchedule_ID", null), e = VIS.dataContext.getJSONRecord("Pay/GetPaymentRule", t.getValueOfInt(r.getValue("VA009_PaymentMethod_ID"))), e != null && (e.VA009_PAYMENTBASETYPE == "D" ? r.setValue("TenderType", "D") : e.VA009_PAYMENTBASETYPE == "K" ? r.setValue("TenderType", "C") : e.VA009_PAYMENTBASETYPE == "S" ? r.setValue("TenderType", "K") : e.VA009_PAYMENTBASETYPE == "T" ? r.setValue("TenderType", "A") : e.VA009_PAYMENTBASETYPE == "L" ? r.setValue("TenderType", "L") : r.setValue("TenderType", "A"))), this.setCalloutActive(!1), "") }; i.prototype.BankDetails = function (n, i, r, u, f) { if (this.isCalloutActive() || f == null) return ""; this.setCalloutActive(!0); var e = VIS.dataContext.getJSONRecord("Pay/GetBankDetails", t.getValueOfInt(f)); return e != null && (r.setValue("C_Location_ID", e.C_Location_ID), r.setValue("RoutingNo", e.RoutingNo)), this.setCalloutActive(!1), "" }; i.prototype.SetPayBaseType = function (n, i, r, u, f) { if (this.isCalloutActive() || f == null) return ""; this.setCalloutActive(!0); var e = VIS.dataContext.getJSONRecord("Pay/GetPayBaseType", t.getValueOfInt(f)); return e != null && r.setValue("VA009_PayBaseType", e.DocBaseType), this.setCalloutActive(!1), "" }; i.prototype.ComparePayMethod = function (n, i, r, u, f) { if (f == null) return ""; var e = VIS.dataContext.getJSONRecord("Pay/VerifyPayMethod", t.getValueOfInt(f)); return e != null && e == 0 && r.setValue("VA009_PaymentMethod_ID", null), "" }; i.prototype.ClearCardFields = function (n, i, r, u, f) { if (f == null) return ""; var e = t.getValueOfString(r.getValue("TenderType")); return e != "C" && (r.setValue("CreditCardType", null), r.setValue("CreditCardNumber", null), r.setValue("CreditCardExpMM", 1), r.setValue("CreditCardExpYY", 3)), "" }; i.prototype.SetBankCurrency = function (n, i, r, u, f) { if (this.isCalloutActive() || f == null) return ""; this.setCalloutActive(!0); var e = VIS.dataContext.getJSONRecord("Pay/GetBankCurrency", t.getValueOfInt(f)); return e != null && r.setValue("C_Currency_ID", e.C_Currency_ID), this.setCalloutActive(!1), "" }; i.prototype.SetAccountName = function (n, i, r, u, f) { if (this.isCalloutActive() || f == null) return ""; this.setCalloutActive(!0); var e = VIS.dataContext.getJSONRecord("Pay/getaccountName", t.getValueOfInt(f)); return e != null && (r.setValue("a_name", e.a_name), r.setValue("RoutingNo", e.RoutingNo), r.setValue("AccountNo", e.AccountNo)), this.setCalloutActive(!1), "" }; i.prototype.SetDateAcct = function (n, t, i, r, u) { return this.isCalloutActive() || u == null ? "" : (this.setCalloutActive(!0), i.setValue("DateAcct", u), this.setCalloutActive(!1), "") }; n.Model = n.Model || {}; n.Model.VA009_CalloutPayment = i; VIS.Utility.inheritPrototype(r, VIS.CalloutEngine); r.prototype.SetPayScheduleTabDisabled = function (n, t, i, r, u) { return this.isCalloutActive() || u == null || u.toString() == "" ? "" : (this.setCalloutActive(!0), u == !0 ? (i.setValue("VA009_IsPayScheduleTabDisabled", !0), i.setValue("NetDay", ""), i.setValue("WeekOffset", "0")) : i.setValue("VA009_IsPayScheduleTabDisabled", !1), this.setCalloutActive(!1), "") }; r.prototype.SetPayScheduleTabDisabledForWeekDay = function (n, i, r, u, f) { return this.isCalloutActive() || f == null || f.toString() == "" ? (r.setValue("VA009_IsPayScheduleTabDisabled", !1), "") : (this.setCalloutActive(!0), t.getValueOfInt(f) > 0 ? r.setValue("VA009_IsPayScheduleTabDisabled", !0) : r.setValue("VA009_IsPayScheduleTabDisabled", !1), this.setCalloutActive(!1), "") }; n.Model = n.Model || {}; n.Model.VA009_CalloutPaymentTerm = r; VIS.Utility.inheritPrototype(u, VIS.CalloutEngine); u.prototype.GetOrderPaySchedule = function (n, i, r, u, e, o) { var a, v; if (this.isCalloutActive()) return ""; if (e == null || e.toString() == "") return u.getColumnName() == "C_Order_ID" && (this.setCalloutActive(!0), r.setValue("C_BPartner_ID", null), r.setValue("C_BPartner_Location_ID", null), r.setValue("VA009_OrderPaySchedule_ID", null), r.setValue("ConvertedAmt", VIS.Env.ZERO), r.setValue("Amount", VIS.Env.ZERO), r.setValue("DiscountAmt", VIS.Env.ZERO), r.setValue("WriteOffAmt", VIS.Env.ZERO), r.setValue("OverUnderAmt", VIS.Env.ZERO), this.setCalloutActive(!1)), ""; this.setCalloutActive(!0); var h = t.getValueOfInt(e), c = 0, l = 0, s = null; try { s = VIS.dataContext.getJSONRecord("VA009/CashJournal/GetOrderPaySchedDetail", h.toString()); s != null && (l = t.getValueOfInt(s.VA009_OrderPaySchedule_ID), r.setValue("VA009_OrderPaySchedule_ID", l), r.setValue("C_BPartner_ID", t.getValueOfInt(s.C_BPartner_ID)), r.setValue("C_Currency_ID", t.getValueOfInt(s.C_Currency_ID)), r.setValue("C_ConversionType_ID", t.getValueOfInt(s.C_ConversionType_ID)), r.setValue("C_BPartner_Location_ID", t.getValueOfInt(s.C_BPartner_Location_ID)), c = t.getValueOfDecimal(s.DueAmount), n.setContext(i, "VA009_IsSOTrx", s.IsSOTrx), a = "Y" == s.IsSOTrx, a || (c = c * -1), v = t.getValueOfString(s.DocBaseType), v == "SOO" ? r.setValue("VSS_PAYMENTTYPE", "R") : r.setValue("VSS_PAYMENTTYPE", "P"), r.setValue("Amount", c), r.setValue("DiscountAmt", VIS.Env.ZERO), r.setValue("WriteOffAmt", VIS.Env.ZERO)) } catch (y) { return s != null && (s = null), this.log.log(f.SEVERE, "VA009_CalloutCashJournal.GetOrderPaySchedule -" + h, y.message), this.setCalloutActive(!1), y.toString() } return h == null || h == 0 ? (r.setValue("C_Currency_ID", null), this.setCalloutActive(!1), "") : (this.setCalloutActive(!1), n = i = r = u = e = o = null, "") }; u.prototype.SetAmount = function (n, i, r, u, f) { var e, o; return this.isCalloutActive() ? "" : f == null || f.toString() == "" ? "" : (this.setCalloutActive(!0), t.getValueOfInt(r.getValue("VA009_OrderPaySchedule_ID")) > 0 ? (e = t.getValueOfDecimal(VIS.dataContext.getJSONRecord("VA009/CashJournal/GetPaySheduleAmt", r.getValue("VA009_OrderPaySchedule_ID").toString())), n.setContext(i, "InvTotalAmt", e.toString()), o = "Y" == n.getContext(i, "VA009_IsSOTrx"), o || (e = e * -1), r.setValue("Amount", e), this.setCalloutActive(!1), "") : (this.setCalloutActive(!1), "")) }; n.Model = n.Model || {}; n.Model.VA009_CalloutCashJournal = u }(VA009, jQuery); VA009 = window.VA009 || {}, function (n, t) { n.DownloadXML = function () { function o() { f = '<div style="padding: 10px; " class="VA009-tabs-wrap"> <ul class="VA009-right-tabs"> <li class="VA009-active-tab" id = VA009_DownlaodXML_' + u.windowNo + ">Generate XML<\/li><\/ul> <\/div>"; i.append(f) } function s() { e = i.find("#VA009_DownlaodXML_" + u.windowNo) } function h() { e.on("touchstart click", function () { c(l) }) } function c(n) { console.log("RecordID " + r); t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/GetXMLPath", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", data: { FileName: "Hell", RecordID: r }, success: function (t) { n(t) }, error: function () { VIS.ADialog.error("VA009_ErrorLoadingPayments") } }) } function l(n) { var i = JSON.parse(n), t; i != "" && (t = document.createElement("a"), typeof t.download == "string" ? (t.href = i, t.setAttribute("download", "XMLFile"), t.name = "abc", document.body.appendChild(t), t.click(), document.body.removeChild(t)) : window.open(uri)) } this.frame; this.windowNo; var n, u = this, i = t('<div class="VA009-assign-content">'), f, e, r = 0; this.setRecordID = function (n) { r = n }; this.Initialize = function () { o(); s(); h() }; this.getRoot = function () { return i } }; n.DownloadXML.prototype.init = function (n, t) { this.windowNo = n; this.frame = t; this.Initialize(); this.frame.getContentGrid().append(this.getRoot()) } }(VA009, jQuery); VA009 = window.VA009 || {}, function (n, t) { n.DownloadDATFile = function () { function c() { u = '<div style="padding: 10px; " class="VA009-tabs-wrap"> <ul class="VA009-right-tabs"> <li class="VA009-active-tab" id = VA009_DownlaodXML_' + n.windowNo + ">" + VIS.Msg.getMsg("VA009_GenPayFile") + "<\/li><\/ul> <\/div>"; r.append(u) } function l() { f = r.find("#VA009_DownlaodXML_" + n.windowNo) } function a() { f.on("touchstart click", function () { y(e) }) } function v(i, r) { t.ajax({ url: VIS.Application.contextUrl + "VA009/Payment/prepareDataForPaymentFile", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: { DocNumber: i, isBatch: r, AD_Org_ID: VIS.context.getWindowContext(n.windowNo, "AD_Org_ID") }, success: function (n) { var t, f, u; n = JSON.parse(n); for (t in n) n[t]._error != null ? (f = n[t]._error, r ? VIS.ADialog.info(f + "," + VIS.Msg.getMsg("BatchIsCompleted") + i) : VIS.ADialog.info(f + "," + VIS.Msg.getMsg("VA009_PaymentCompletedWith") + i)) : (u = n[t]._filename.split("."), u[u.length - 1] == "txt" || u[u.length - 1] == "TXT" ? h("\\PaymentFiles\\" + n[t]._filename, n[t]._filename, t) : s("\\PaymentFiles\\" + n[t]._filename, t)) }, error: function () { VIS.ADialog.error("VA009_ErrorLoadingPayments") } }) } function y(r) { i = VIS.context.getContext(n.windowNo, "WindowName") == "Payment" ? !1 : !0; t.ajax({ url: VIS.Application.contextUrl + "VA009/DownloadPaymentFIle/GetDocuentNumber", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: { RecordID: r, isBatch: i, AD_Org_ID: VIS.context.getWindowContext(n.windowNo, "AD_Org_ID") }, success: function (n) { o = n; v(o, i) }, error: function () { VIS.ADialog.error("VA009_ErrorLoadingPayments") } }) } var s, h; this.frame; this.windowNo; var n = this, r = t('<div class="VA009-assign-content">'), u, f, e = 0, o = "", i = !1; this.setRecordID = function (n) { e = n }; this.Initialize = function () { c(); l(); a() }; s = function (n, i) { var r = t("<iframe>", { id: "idown_" + i, src: n }).hide().appendTo("body") }; h = function (n, t) { var i = document.createElement("a"); i.href = n; i.setAttribute("download", t); document.body.appendChild(i); i.click(); document.body.removeChild(i) }; this.getRoot = function () { return r } }; n.DownloadDATFile.prototype.init = function (n, t) { this.windowNo = n; this.frame = t; this.Initialize(); this.frame.getContentGrid().append(this.getRoot()) } }(VA009, jQuery)