var Market = window.Market || {}; (function (n, t) { function r() { this.isFeatured = !1; this.isPaid = !1; this.isFree = !1; this.isMy = !1; this.isPlanned = !1; this.isPrivate = !1; this.isRegisterd = !1; this.isKeyExpired = !1; this.moduleEdition = ""; this.tokenKey = ""; this.isProfessinalEdition = !1 } function u(i) { function e() { var t = n.Application.contextFullUrl; return (t || (t = n.Application.contextUrl), t && t.toLower().indexOf("softwareonthecloud.com") > -1) ? (r = !0, f = t, !0) : !1 } var r = !1, f = "", u = i; this.getModules = function (i, e, o, s, h, c) { var a = { SqlString: i, PageIndex: e, PageSize: o, ModType: s, IsCloudMarket: r, HostURL: f, TokenKey: h, IsKeyExpired: !0, IsProfessionalEdition: c }, l = null; return t.ajax({ url: n.Application.contextUrl + "Market/Module/GetMarketModules", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: JSON.stringify(a) }).done(function (n) { l = n; u.getMarketModulesCompleted && u.getMarketModulesCompleted(l) }), l }; this.getIsSystemAdmin = function () { var t = n.Env.getCtx().getAD_User_ID(), i = n.Env.getCtx().getAD_Role_ID(); return (t == 0 || t == 100) && i == 0 ? !0 : !1 }; this.getIsCloudMarket = function () { return r }; e(); this.dispose = function () { u = null; this.getModules = null; this.dispose = null; this.getIsSystemAdmin = null; this.getIsCloudMarket = null } } function i() { function g() { h = f.find(".market-app-menu-a"); c = f.find(".market-close-img"); o = f.find(".market-main-app-list"); l = f.find(".market-right-content"); s = f.find(".vis-apanel-busy"); e = f.find(".market-search-input"); p = f.find(".market-sear"); y = f.find(".market-left-sidebar"); a = f.find(".market-module-template"); v = a.html(); w = Handlebars.compile(v); a = f.find(".market-module-tmp-right"); v = a.html(); b = Handlebars.compile(v); k = f.find(".market-cb"); it(); tt(); i.prop.setIsFeatured(!0); i.getModules() } function nt() { } function tt() { Handlebars.registerHelper("Rate", function (n) { n || (n = 1); var t = n / 2, i = Math.floor(t).toString(); return t.toString().indexOf(".") > 0 && (i += "+"), i }); Handlebars.registerHelper("market_star", function (n) { n || (n = 1); var t = n / 2, i = ""; return t < 1 ? i = "half-star" : t >= 1 && t < 2 ? i = t == 1 ? "one-star" : "one-half-stars" : t >= 2 && t < 3 ? i = t == 2 ? "two-stars" : "two-half-stars" : t >= 3 && t < 4 ? i = t == 3 ? "three-stars" : "three-half-stars" : t >= 4 && t < 5 ? i = t == 4 ? "four-stars" : "four-half-stars" : t >= 5 && (i = "full-stars"), i }) } function it() { h.on("click", function () { var r = t(this), n; r.addClass("market-a-active"); r.parent().siblings().children().removeClass("market-a-active"); n = r.data("action"); n == "All" ? i.prop.setIsFeatured(!0) : n == "Paid" ? i.prop.setIsPaid(!0) : n == "Free" ? i.prop.setIsFree(!0) : n == "Planned" ? i.prop.setIsPlanned(!0) : n == "My" ? i.prop.setIsMy(!0) : n == "Private" && i.prop.setIsPrivate(!0); i.setSearchText(""); i.currentIndex = 0; i.getModules(); i.bindData() }); c.on("click", function () { i.dispose() }); o.on("click", function (n) { for (var e = t(n.target), r = e, u, f; r[0].nodeName != "LI";) r = t(r.parent()); u = r.index(); o.find("LI").removeClass("market-selected-module"); r.addClass("market-selected-module"); f = i.mList[u]; i.bindData(f); nt() }); if (!n.Application.isMobile) e.on("keyup", function (n) { n.keyCode === 13 && (i.performSearch(e.val()), e.focus()) }); p.on("click", function () { i.performSearch(e.val()); e.focus() }); y.on("scroll", function () { t(this).scrollTop() + t(this).innerHeight() >= this.scrollHeight && (i.currentIndex += 1, i.getModules(), i.isTabScroll = !0) }); l.on("click", function (r) { var u = t(r.target), f; u.hasClass("market-button-Install-detail") && i.installModule(i.selectedItem); u.hasClass("market-video-pic") && (f = u.data("id"), f && n.Env.startBrowser("https://www.youtube.com/watch?v=" + f)) }) } function rt() { h.off("click"); c.off("click") } var h, c, o, y, l, e, p, a, v, w, b, k, i = this; this.currentIndex = 0; this.Page_Size = 10; this.searchText = ""; this.isBusy = !1; this.totalCount = 0; this.selectedItem = null; var f = t("<div>"), s = t("<div class='vis-apanel-busy'>"), d = t("<div class='market-body'>").append(s); f.append(d); this.model = new u(this); this.prop = new r; this.mList = []; d.load(n.Application.contextUrl + "Market/Module/Index", function () { g() }); this.bindList = function (n, t) { t || (o.empty(), this.bindData(this.mList.length > 0 ? this.mList[0] : null)); o.append(w(n)); t || o.find("LI").first().addClass("market-selected-module") }; this.bindData = function (n) { this.selectedItem = n; l.empty(); n && l.append(b(n)) }; this.showVendorPrivateMod = function () { return k.prop("checked") }; this.getRoot = function () { return f }; this.setBusyPanel = function (n) { s.hide(); n && s.show() }; this.disposeList = function () { }; this.setSearchText = function (n) { n || (n = ""); this.searchText = n; e.val(n) }; this.disposeComponent = function () { i = null; rt(); h = null; c = null; f.remove(); f = null; this.mList.length = 0; this.mList = null; this.selectedItem = null; s = null } } Market.ImpModule = {}; r.prototype.setIsFree = function () { this.setAllFalse(); this.isFree = !0 }; r.prototype.getIsFree = function () { return this.isFree }; r.prototype.setIsPlanned = function () { this.setAllFalse(); this.isPlanned = !0 }; r.prototype.getIsPlanned = function () { return this.isPlanned }; r.prototype.setIsMy = function () { this.setAllFalse(); this.isMy = !0 }; r.prototype.getIsMy = function () { return this.isMy }; r.prototype.setIsFeatured = function () { this.setAllFalse(); this.isFeatured = !0 }; r.prototype.getIsFeatured = function () { return this.isFeatured }; r.prototype.setIsPaid = function () { this.setAllFalse(); this.isPaid = !0 }; r.prototype.getIsPaid = function () { return this.isPaid }; r.prototype.setIsPaid = function () { this.setAllFalse(); this.isPaid = !0 }; r.prototype.getIsPaid = function () { return this.isPaid }; r.prototype.setIsPrivate = function () { this.setAllFalse(); this.isPrivate = !0 }; r.prototype.getIsPrivate = function () { return this.isPrivate }; r.prototype.setAllFalse = function () { this.isPlanned = !1; this.isMy = !1; this.isFeatured = !1; this.isFree = !1; this.isPaid = !1; this.isPrivate = !1 }; i.prototype.getModules = function () { var n = !1; this.searchText && this.searchText.length > 0 && (n = !0); this.prop.getIsFeatured() ? this.getFeaturedModule(n) : this.prop.getIsPaid() ? this.getPaidModule(n) : this.prop.getIsFree() ? this.getFreeModule(n) : this.prop.getIsMy() ? this.getMyModule(n) : this.prop.getIsPlanned() ? this.getPlannedModule(n) : this.prop.getIsPrivate() && this.getPrivateModule(n) }; i.prototype.getFeaturedModule = function (n) { this.setIsBusy(!0); this.disposeList(); var t = ""; n ? t += " AND UPPER(m.Name) LIKE '%" + this.searchText.toUpper() + "%' " : this.setSearchText(""); this.model.getModules(t, this.currentIndex * this.Page_Size, this.Page_Size, "FTR") }; i.prototype.getFreeModule = function (n) { this.setIsBusy(!0); this.disposeList(); var t = ""; n ? t += " AND UPPER(m.Name) LIKE '%" + this.searchText.toUpper() + "%' " : this.setSearchText(""); this.model.getModules(t, this.currentIndex * this.Page_Size, this.Page_Size, "FREE") }; i.prototype.getPaidModule = function (n) { this.setIsBusy(!0); this.disposeList(); var t = ""; n ? t += " AND UPPER(m.Name) LIKE '%" + this.searchText.toUpper() + "%' " : this.setSearchText(""); this.model.getModules(t, this.currentIndex * this.Page_Size, this.Page_Size, "PAID") }; i.prototype.getMyModule = function (n) { this.setIsBusy(!0); this.disposeList(); var t = ""; n ? t += " AND UPPER(m.Name) LIKE '%" + this.searchText.toUpper() + "%' " : this.setSearchText(""); this.model.getModules(t, this.currentIndex * this.Page_Size, this.Page_Size, "MY") }; i.prototype.getPlannedModule = function (n) { this.setIsBusy(!0); this.disposeList(); var t = ""; n ? t += " AND UPPER(m.Name) LIKE '%" + this.searchText.toUpper() + "%' " : this.setSearchText(""); this.model.getModules(t, this.currentIndex * this.Page_Size, this.Page_Size, "PLAN") }; i.prototype.getPrivateModule = function (n) { var i, t, r; if (this.setIsBusy(!0), this.disposeList(), i = "", n ? i += " AND UPPER(m.Name) LIKE '%" + this.searchText.toUpper() + "%' " : this.setSearchText(""), this.bindList(null), this.bindData(null), t = this.showVendorPrivateMod(), t && (!Market.PrivateKey || Market.PrivateKey.length < 10)) { r = new Market.PrivateKeyDialog(this, n); r.show(); r = null; this.setIsBusy(!1); return } if (!t && !this.getIsTokenKeyValidated()) { this.setIsBusy(!1); return } this.model.getModules(i, this.currentIndex * this.Page_Size, this.Page_Size, "SPL", Market.PrivateKey, t) }; i.prototype.getIsPaidEdition = function (n) { return !n || n.length < 1 ? !1 : n.toUpper() == "PP" || n.toUpper() == "CP" ? !0 : !1 }; i.prototype.setIsBusy = function (n) { this.isBusy = n; this.setBusyPanel(n) }; i.prototype.performSearch = function (n) { this.searchText = n; this.currentIndex = 0; this.getModules() }; i.prototype.getMarketModulesCompleted = function (n) { var t, i, u, f, r; if (n.error && n.error.length > 0 && n.error != "null") { alert(JSON.parse(n.error).Message); this.setIsBusy(!1); return } try { for (t = JSON.parse(n.result), i = this.prop, i.isRegisterd = t.IsRegistered, i.isProfessinalEdition = t.IsProfessionalEdition, i.isKeyExpired = t.IsKeyExpired, i.tokenKey = t.TokenKey, u = null, f = "", r = 0; r < t.lstModuleInfo.length; r++) u = t.lstModuleInfo[r], r == 0 && (this.defaultItem = u, this.totalCount = u.TotalCount); this.isTabScroll ? this.mList.push.apply(this.mList, t.lstModuleInfo) : this.mList = t.lstModuleInfo; this.bindList(t.lstModuleInfo, this.isTabScroll); this.isTabScroll = !1; t = null } catch (n) { } this.setIsBusy(!1) }; i.prototype.installModule = function (t) { var i, r; if (this.setIsBusy(!0), !this.model.getIsSystemAdmin()) { this.setIsBusy(!1); n.ADialog.warn("NotAuthorized", !0, n.Msg.getMsg("LoginAsAdministrator"), ""); return } if (t.ModuleDependency != null && t.ModuleDependency.length > 0 && this.getAllParentModule(t)) { this.setIsBusy(!1); return } if (this.prop.isRegisterd) if (this.prop.isKeyExpired) this.openRegisterKeyDialog(Market.KeyHeader.Expired, t, Market.KeyStatus.Renew); else if (this.hasModuleInstalledAccess(t.ModuleEdition)) { if (this.prop.getIsPaid() && !t.IsPaymentDone || this.prop.getIsFeatured() && this.getIsPaidEdition(t.ModuleEdition) && !t.IsPaymentDone) { (!t.PaymentUrl || t.PaymentUrl.length < 1) && (t.PaymentUrl = "http://viennaadvantage.com"); i = t.PaymentUrl; t.PaymentUrl.indexOf("?id=") < 0 && (i += "?id=" + t.AD_Module_ID); i += "&key=" + this.prop.tokenKey + "&flag=" + (this.model.getIsCloudMarket() ? "Y" : "N").toString(); n.Env.startBrowser(i); t.IsEnabled = !1; this.setIsBusy(!1); return } if (this.getIsPaidEdition(t.ModuleEdition)) { if ((!t.PaymentUrl || t.PaymentUrl.length < 1) && (t.PaymentUrl = "http://viennaadvantage.com"), i = t.PaymentUrl, t.PaymentUrl.indexOf("?id=") < 0 && (i += "?id=" + t.AD_Module_ID), i += "&key=" + this.prop.tokenKey, !t.IsPaymentDone) { n.Env.startBrowser(i); this.setIsBusy(!1); return } if (t.IsMSubsExpired) { n.ADialog.ask("SubscriptionExpired", !0, n.Msg.getMsg("IsResubscribeModule")) && n.Env.startBrowser(i); this.setIsBusy(!1); return } } r = new Market.ModuleDialog(t); r.tokenKey = this.prop.tokenKey; r.isCloudMarket = this.model.isCloudMarket; r.show() } else this.openRegisterKeyDialog(Market.KeyHeader.Professional, t, Market.KeyStatus.Upgrade); else this.openRegisterKeyDialog(this.hasModuleInstalledAccess(t.ModuleEdition) ? Market.KeyHeader.Community : Market.KeyHeader.Professional, t, Market.KeyStatus.NotRegisterd); this.setIsBusy(!1) }; i.prototype.getAllParentModule = function (n) { for (var i = [], u, r, t = 0; t < n.ModuleDependency.length; t++) u = n.DependentModInstalled[t], u || i.push(n.ModuleDependency[t]); return i.length > 0 ? (r = new Market.DependencyDialog(i, n.Name + " " + n.VersionNo, this), r.show(), r = null, !0) : !1 }; i.prototype.hasModuleInstalledAccess = function (n) { return n ? this.prop.isProfessinalEdition ? !0 : n.toUpper() == "PF" || n.toUpper() == "PP" ? !1 : !0 : !0 }; i.prototype.getIsTokenKeyValidated = function () { if (this.prop.isRegisterd) if (this.prop.isKeyExpired) this.openRegisterKeyDialog(Market.KeyHeader.Expired, null, Market.KeyStatus.Renew, !0); else return !0; else this.openRegisterKeyDialog(this.hasModuleInstalledAccess() ? Market.KeyHeader.Community : Market.KeyHeader.Professional, null, Market.KeyStatus.NotRegisterd, !0); return !1 }; i.prototype.openRegisterKeyDialog = function (n, t, i, r) { var u = new Market.KeyDialog(n, this.model.getIsCloudMarket()), f = this; u.onClose = function () { f.setIsBusy(!1); u.getIsValid() && (f.prop.isRegisterd = u.isValid, f.prop.isProfessinalEdition = u.isProfessinalEdition, f.prop.tokenKey = u.tokenKey, f.prop.isKeyExpired = !1, r ? f.getPrivateModule() : f.installModule(t), f = null) }; u.tokenKey = this.prop.tokenKey; u.tokenKeyStatus = i; u.isCloudMarket = this.model.getIsCloudMarket(); u.show() }; i.prototype.show = function () { var t = new n.CFrame; t.setName(n.Msg.getMsg("Market")); t.setTitle(n.Msg.getMsg("Market")); t.hideHeader(!0); t.setContent(this); t.show() }; i.prototype.dispose = function () { this.disposeComponent() }; i.prototype.sizeChanged = function (n, t) { this.getRoot().css({ width: t, height: n }) }; Market.ImpModule.Market_ = i })(VIS, jQuery), function (n, t) { function i(i, r, u) { function l() { var u, f; for (e = t('<div class="market-dp-da" ><div class="market-app-detail"> <div class="market-about-app vis-pull-left" style="width:100%"><img src="' + n.Application.contextUrl + 'Areas/Market/Images/big_app_image.png"><div class="market-app-detail-inner"><p class="market-title">' + r + '<\/p><\/div><\/div> <div class="market-app-rating"><\/div><\/div><\/div>'), u = '<div class="market-app-description"><table style="width:400px;"><tr style="margin-bottom:5px"><th style="width:50%">' + n.Msg.getMsg("Name") + '<\/th><th style="width:30%">' + n.Msg.getMsg("VERSIONNO") + '<\/th><th style="width:20%">' + n.Msg.getMsg("Action") + "<\/th><\/tr>", f = 0; f < i.length; f++) u += "<tr>", u += '<td><p class="market-author" style="padding-right:5px"><small>' + i[f].Name + '<\/small><\/p><\/td><td ><p class="market-author"><small>' + i[f].VersionNo + '<\/small><\/p><\/td><td ><p class="market-install-detail"><a href="javascript:void(0);" class="market-button-Install"', u += c != i[f].Lable ? ' style="background-color:lightgray" disable' : " data-val=" + f, u += ">" + n.Msg.getMsg("Install") + "<\/a><\/p><\/td><\/tr>"; u += "<\/table><\/div>"; s = t('<div class="vis-apanel-busy" style="height:90%;width:80%;display:none">'); e.append(t(u)); e.append(s); a() } function a() { e.find(".market-button-Install").on("click", function () { var r, e; o || (o = !0, r = i[t(this).data("val")], r && (e = { AD_ModuleInfo_ID: r.ModuleID, tokenKey: u.prop.tokenKey }, s.show(), t.ajax({ url: n.Application.contextUrl + "Market/Module/GetModuleInfo", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: JSON.stringify(e) }).done(function (n) { n && n.result && n.result != "null" && (r = JSON.parse(n.result), u.installModule(r, !0), f.dispose(), o = !1) }).fail(function () { s.hide(); o = !1 }))) }) } var f, e, s, h = this, c = Math.max.apply(Math, i.map(function (n) { return n.Lable })), o; l(); o = !1; this.getRoot = function () { return e }; this.show = function () { f = new n.ChildDialog; f.setTitle(n.Msg.getMsg("Market_DependencyFound")); f.setModal(!0); f.show(); f.setContent(e); f.hideButtons(); f.onClose = function () { h.dispose() }; f.getRoot().dialog({ position: { at: "center center", of: window } }) }; this.disposeComponent = function () { e.remove(); parnet = null; this.getRoot = null; this.disposeComponent = null; f = null; h = null } } function r(i, r) { function o() { f = t('<div class="market-app-description" style="margin-top: 0;float:left;padding-top:30px;padding-bottom:0px;"><div class="comm-data"><div class="col50 vis-pull-right" style="width:100%"><label class="market-enter-key">' + n.Msg.getMsg("EnterKey") + '<\/label><input type="text" class="market-input-key" style="width:100%" value=' + Market.PrivateKey + '><a class="market-validate">' + n.Msg.getMsg("OK") + "<\/a><\/div><\/div><\/div>"); s() } function s() { f.find(".market-validate").on("click", function () { var n = t(".market-input-key").val(); if (n && n.length > 0) { Market.PrivateKey = n; i.getPrivateModule(r, !0); u.close(); return } alert("enterKey") }) } var u, f, e = this; o(); this.getRoot = function () { return f }; this.show = function () { u = new n.ChildDialog; u.setTitle("Market_PrivateKey"); u.setModal(!0); u.show(); u.setContent(f); u.hideButtons(); u.onClose = function () { e.disposeComponent() }; u.getRoot().dialog({ position: { at: "center center", of: window } }) }; this.disposeComponent = function () { f.remove(); parnet = null; this.getRoot = null; this.disposeComponent = null; u = null; e = null } } i.prototype.dispose = function () { this.disposeComponent() }; Market.DependencyDialog = i; Market.PrivateKey = ""; Market.PrivateKeyDialog = r }(VIS, jQuery), function (n, t) { function i(i) { function nt() { var r = n.Application.contextUrl + "Areas/Market/Images/big_app_image.png"; i.Image && (r = "data:image/png;base64," + i.Image); u = t('<div class="market-popup" ><div class="market-popup-content"><div style="position:relative">  <div class="market-about-app vis-pull-left">    <img src=' + r + ' style="max-width:120px">  <div class="market-app-detail-inner">    <p class="market-title">' + i.Name + '<\/p>  <!--<img src="img/progressbar.jpg">--><div class="market-popup-buttons"> \t<a href="javascript:void(0)" class="market-popup-btn market-install vis-pull-left">' + n.Msg.getMsg("Install") + '<\/a>   <a href="javascript:vois(0)" class="market-popup-btn market-cancel vis-pull-left">' + n.Msg.getMsg("Cancel") + '<\/a><\/div><\/div><!-- end of app_detail_inner --><\/div><!-- end of popup-content-top --><div class="market-popup-viennaLogo vis-pull-right">  <img src="' + n.Application.contextUrl + 'Areas/VIS/Images/logo.jpg"><\/div><!-- end of popup-viennaLogo --><\/div><!-- end of app_detail --><div class="market-app-description" style="float:left;padding-top:25px;"><div class="market-popup-description-inner">\t<div class="market-popup-install-text">      <p>' + n.Msg.getMsg("MigrationText") + ';<\/p>          <\/div><!-- end of popup-install-text -->        <div class="market-popup-client">      \t<h6>' + n.Msg.getMsg("SelectClient") + '<\/h6>        <div class="market-popup-client-options market-clients">                  <\/div><!-- end of popup-client-options -->            <\/div><!-- end of popup-client -->          <div class="market-popup-client" style="margin-right: 0; float: right;">        \t<h6>' + n.Msg.getMsg("SelectLanguage") + '<\/h6>          <div class="market-popup-client-options market-lang">  <\/div><!-- end of popup-client-options --> <\/div><!-- end of popup-client --><\/div><!-- end of popup-description-inner --><div class="market-pop-divider"><\/div> <div class="market-popup-description-inner" style="margin-top: 0;"><progress class="market-progress-in"><\/progress><progress max="100" value="0" class="market-progress"><\/progress>  <div class="market-popup-logs"><\/div><!-- end of popup-client-options --> <\/div><!-- end of popup-description-inner --> <\/div><!-- end of popup-description -->\t<\/div><!-- end of popup-content -->\t<div class="vis-apanel-busy" style="height:90%"><\/div><!-- end of popup-content -->  <\/div><!-- end of market-popup --> '); h = u.find(".market-install"); c = u.find(".market-cancel"); l = u.find(".market-clients"); a = u.find(".market-lang"); p = u.find(".market-popup-logs"); w = u.find(".vis-apanel-busy"); v = u.find(".market-progress"); b = u.find(".market-progress-in").hide(); tt(); it() } function k(n) { n ? w.show() : w.hide() } function y(n) { n ? (v.show(), c.hide(), h.hide()) : (v.hide(), c.show(), h.show()) } function tt() { var e, t; l.empty(); a.empty(); e = "SELECT Name as Name,AD_Client_ID as ID FROM AD_Client WHERE "; e += i.AccessLevel == "4" ? " AD_Client_ID = 0  " : i.AccessLevel == "6" ? " AD_Client_ID >= 0 ORDER BY AD_Client_ID  " : " AD_Client_ID > 0 "; i.Translations && i.Translations.length > 0 && (e += "~ SELECT Name as Name,AD_Language as ID FROM AD_Language WHERE AD_Language IN (" + i.Translations + ")"); var u = n.DB.executeDataSet(e), r = null, f = ""; if (u != null && u.getTables().length > 0) { for (r = u.getTables()[0], t = 0; t < r.getRows().length; t++) f += '<div class="market-client-data vis-pull-left"><input type="checkbox" data-val=' + r.getRows()[t].getCell("ID") + " ><label>" + r.getRows()[t].getCell("Name") + "<\/label><\/div>"; if (l.html(f), u.getTables().length > 1) { for (r = u.getTables()[1], f = "", t = 0; t < r.getRows().length; t++) f += '<div class="market-client-data vis-pull-left"><input type="checkbox" data-val=' + r.getRows()[t].getCell("ID") + " ><label>" + r.getRows()[t].getCell("Name") + "<\/label><\/div>"; a.html(f) } r = null; u.dispose() } k(!1) } function it() { h.on("click", function () { var r = [], u = []; if (l.find("input:checked").each(function () { r.push(t(this).data("val")) }), r.length < 1) { n.ADialog.error("SelectClient", !0); return } y(!0); p.empty(); a.find("input:checked").each(function () { u.push('"' + t(this).data("val") + '"') }); o("[step 1] Initializing Channel"); s(n.Application.contextUrl + "Market/Module/DownloadAndExtractModuleFiles", { AD_ModuleInfo_ID: i.AD_Module_ID }, function (n) { var t, i, e; n.startsWith("Error=>") ? g(n) : (t = n.indexOf("$ModulePath$"), t > -1 ? (i = n.substring(t), o(n.substring(0, t) + "<br/>[step 2] Importing module..."), e = i.replace("$ModulePath$", ""), f("11", "N"), window.setTimeout(rt(r, u, e), 100)) : (g("Module Path Not Found"), y(!1))) }); o("Downloading and extracting files"); o("Please wait..."); f("1", "Y") }); c.on("click", function () { r.close() }) } function rt(t, u, o) { s(n.Application.contextUrl + "Market/Module/ImportModuleFromLocalFile", { moduleName: o, clientIds: t, langCode: u, onlyTranslation: !1, ctxDic: n.context.getWindowCtx() }, function (t) { var h, o, u; if (t && t.Action == "Redirect") { h = t.Status; o = t.ActionMsg; f("99", "N"); u = n.Application.contextUrl + "Market/Module/ModuleLog"; u += "?id=" + h; o && o.length > 0 && (u += "&path=" + o, (e.isCloudMarket || n.Application.isSSL) && (u += "$Y$")); u += "&value=" + e.tokenKey; s(n.Application.contextUrl + "Market/Module/UpdateSubscrption", { AD_Module_ID: i.AD_Module_ID, Product_ID: i.Product_ID, token: e.tokenKey, isFree: !0, version: i.VersionNo }, function () { }); f("100", "N"); r.close(); setTimeout(function () { window.location = u }); return } }); window.setTimeout(d, 5e3) } function d() { s(n.Application.contextUrl + "Market/Module/PullMessage", {}, function (t) { var a = JSON.parse(t.result), u, c, v, l, h; if (t.status != "Finish" && a) { for (u = null, c = 0; c < a.length; c++) { if (u = a[c], u.Action == "Error") { n.ADialog.error("Error?", !0, u.ActionMsg); f("0", "N"); y(!1); return } if (u.Action == "Redirect") { v = u.Status; l = u.ActionMsg; f("99", "N"); h = n.Application.contextUrl + "Market/Module/ModuleLog"; h += "?id=" + v; l && l.length > 0 && (h += "&path=" + l, (e.isCloudMarket || n.Application.isSSL) && (h += "$Y$")); h += "&value=" + e.tokenKey; s(n.Application.contextUrl + "Market/Module/UpdateSubscrption", { AD_Module_ID: i.AD_Module_ID, Product_ID: i.Product_ID, token: e.tokenKey, isFree: !0, version: i.VersionNo }, function () { }); f("100", "N"); r.close(); setTimeout(function () { window.location = h }); return } if (u.Action == "Done") { f("0", "N"); y(!1); return } u.Action == "PValue" ? f(u.Status, u.ActionMsg) : o(u.Status) } window.setTimeout(d, 5e3, !0) } }, !0) } function s(n, i, r, u) { var f = !0; u && (f = !1); t.ajax({ url: n, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: f, data: JSON.stringify(i) }).done(function (n) { r && r(n) }).fail(function (n, t) { r && r("Error=>" + t) }) } function g(n) { o(n); f("0", "N"); k(!1) } function f(n, t) { if (n && n != "") { var i = n; v.val(n); t == "Y" ? b.show() : b.hide() } } function o(n) { var i = t('<p class="market-log">' + n + "<\/p>"); p.append(i); i[0].scrollIntoView(); i = null } var e, r, u, h, c, l, a, p, w, v, b; i.AD_Module_ID || (i.AD_Module_ID = i.ModuleID); this.tokenKey; this.isCloudMarket; e = this; r = null; sblog = ""; u = null; nt(); this.show = function () { r = new n.ChildDialog; r.setTitle(n.Msg.getMsg("Market_ModuleDialogHeader")); r.setModal(!0); r.show(); r.setContent(u); r.hideButtons(); r.onClose = function () { e.dispose() }; r.getRoot().dialog({ position: { at: "center center", of: window } }) }; this.dispose = function () { u.remove(); this.show = null; r = null; e = null } } Market.ModuleDialog = i }(VIS, jQuery), function (n, t) { function i(i, r) { function p() { Market.KeyHeader.Professional == i ? (h = n.Msg.getMsg("ProfessionalHeader"), s = n.Msg.getMsg("GetProfessionalKey"), o = n.Msg.getMsg("EnterProfessionalKey")) : Market.KeyHeader.Expired == i ? (h = n.Msg.getMsg("KeyExpiredHeader"), s = n.Msg.getMsg("RenewKey"), o = n.Msg.getMsg("EnterProfessionalKey")) : (h = n.Msg.getMsg("CommunityHeader"), s = n.Msg.getMsg("GetCommunityKey"), o = n.Msg.getMsg("EnterCommunityKey")); r && (o = n.Msg.getMsg("CloudProfessionalText")); var u = '<div style="max-width:500px;"> <div  style="position:relative" style="width:100%;float:left;"><div class="vis-pull-left"><p class="market-kd-title">' + h + '<\/p><\/div><div class="vis-pull-right"><img src="' + n.Application.contextUrl + 'Areas/VIS/Images/logo.jpg"><\/div><\/div><div class="market-app-description" style="margin-top: 0;float:left;padding-top:30px;padding-bottom:0px;"><div class="comm-data"><div class="col50 vis-pull-left" style="width:40%"><a class="market-community-key">' + s + '<\/a><\/div><div style="width: 20px; margin-right: 5%;margin-left:5%" class="vis-pull-left" ><div class="market-divide"><\/div><span class="market-span-or">' + n.Msg.getMsg("or") + '<\/span><div class="market-divide"><\/div><\/div><div class="col50 vis-pull-right" style="width:40%"><label class="market-enter-key" ' + (r ? 'style="min-width:200px"' : " ") + ">" + o + '<\/label><input type="text" class="market-input-key" style="width:100%;' + (r ? "display:none" : "") + '"><a class="market-validate" ' + (r ? 'style="display:none"' : " ") + ">" + n.Msg.getMsg("Validate") + '<\/a><\/div><\/div><\/div><div class="vis-apanel-busy" style="height:90%;width:90%;" ><\/div><\/div>'; e = t(u); c = e.find(".vis-apanel-busy").hide(); l = e.find(".market-validate"); a = e.find(".market-community-key"); y = e.find(".market-input-key"); w() } function w() { l.on("click", function () { var r = y.val(), e, i; if (!r || r.length < 1) { e = n.Msg.getMsg("EnterKey"); n.ADialog.error("Error?", !0, e); return } v(!0); i = {}; i.Url = n.Application.contextUrl; i.Client_ID = n.Env.getCtx().getAD_Client_ID(); i.UserName = n.Env.getCtx().getAD_User_Name(); i.RoleName = n.Env.getCtx().getAD_Role_Name(); i.ClientName = n.Env.getCtx().getAD_Client_Name(); i.Token = r; i.IsDemoCheck = !1; i.IsEntCheck = u.checkEntKey; t.ajax({ url: n.Application.contextUrl + "Market/Module/InitLoginOrValidate", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: JSON.stringify(i) }).done(function (t) { var i = JSON.parse(t); u.isValid = i.IsValid; u.isProfessinalEdition = i.IsAllowWork; u.tokenKey = i.Token; i.IsValid ? (v(!1), f.close()) : (v(!1), n.ADialog.error("Error?", !0, i.Message)) }).fail(function (t, i) { n.ADialog.error("Error?", !0, i) }) }); a.on("click", function () { var t = "https://login.viennaadvantage.com/buy.aspx?key"; u.tokenKeyStatus == Market.KeyStatus.Upgrade ? t += "key=" + u.tokenKey + "&request=U" : u.tokenKeyStatus == Market.KeyStatus.Renew ? t += "key=" + u.tokenKey + "&request=R" : t = "http://register.viennaadvantage.com"; n.Env.startBrowser(t) }) } function v(n) { n ? c.show() : c.hide() } this.tokenKey; this.tokenKeyStatus; this.isCloudMarket; this.isValid; this.checkEntKey = !1; this.isProfessinalEdition = !1; this.onClose = null; var f = null, s = "", o, h, c, l, a, y, u = this, e = null; p(); this.show = function () { f = new n.ChildDialog; f.setTitle(""); f.setModal(!0); f.show(); f.setContent(e); f.hideButtons(); f.onClose = function () { u.onClose && u.onClose(); u.dispose() }; f.getRoot().dialog({ position: { at: "center center", of: window } }) }; this.dispose = function () { u = null; f = null; this.show = null; e.remove(); f = s = o = h = e = null; c = l = a = null } } Market.KeyStatus = {}; Market.KeyHeader = {}; Market.KeyStatus.NotRegisterd = "N"; Market.KeyStatus.Renew = "R"; Market.KeyStatus.Upgrade = "U"; Market.KeyHeader.Expired = "E"; Market.KeyHeader.Community = "C"; Market.KeyHeader.Professional = "P"; i.prototype.getIsValid = function () { return this.isValid }; Market.KeyDialog = i }(VIS, jQuery)