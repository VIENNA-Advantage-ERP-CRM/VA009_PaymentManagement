String.prototype.equals=function(n,t){return t?this.toString().toLowerCase()===n.toLowerCase():this.toString()===n};String.prototype.equalsIgnoreCase=function(n){return this.toString().toLowerCase()===n.toLowerCase()};String.prototype.startsWith=function(n){return n===""?!0:this==null||n==null?!1:(n=String(n),this.length>=n.length&&this.slice(0,n.length)===n)};String.prototype.endsWith=function(n){return n===""?!0:this==null||n==null?!1:(n=String(n),this.length>=n.length&&this.slice(this.length-n.length)===n)};String.prototype.contains=function(n){return this.indexOf(n)>-1};String.prototype.toUpper=function(){return this.toUpperCase()};String.prototype.toLower=function(){return this.toLowerCase()};String.prototype.compareTo=function(n){var u=this.length,f=n.length,o=u<f?u:f,t,r,e;for(i=0;i<o;i++)if(t=this.charCodeAt(i),r=n.charCodeAt(i),t!=r)return t>r?1:t<r?-1:0;return e=u-f,e>0?1:e<0?-1:0};String.prototype.replaceAll=function(n,t){var i=this;return i.replace(new RegExp(n,"g"),t)};Number.prototype.compareTo=function(n){var t=this-n;return t>0?1:t<0?-1:0};Array.prototype.indexOf||(Array.prototype.indexOf=function(n){for(var t=0;t<this.length;t++)if(this[t]===n)return t;return-1});StringBuilder=function(n){this.str=n?n:""};StringBuilder.prototype.append=function(n){return this.str+=n,this};StringBuilder.prototype.toString=function(){return this.str};StringBuilder.prototype.endsWith=function(n){return this.str.endsWith(n)};StringBuilder.prototype.replace=function(n,t){var i=this.str;return i.replace(new RegExp(n,"g"),t)};StringBuilder.prototype.indexOf=function(n){return this.str.indexOf(n)};StringBuilder.prototype.length=function(){return this.str.length};StringBuilder.prototype.insert=function(n,t){return this.str=n>0?this.str.substring(0,n)+t+this.str.substring(n,this.str.length):t+this.str,str};StringBuilder.prototype.clear=function(){return this.str.length=0,this.str="",this};Date.prototype.toUniversalTime=function(){return new Date(this.getTime())};VISUtil=window.VISUtil||{},function(n,t){function h(t,i,r){var u=function(u){var f,e,o;if(isNaN(u)||u===null)return 0;if(f=u.toString(),e=f.indexOf("."),e!=-1){if(o=f.substring(0,e),o.length>t)return o=o.substring(0,t),o+f.substring(e,f.Length-e)}else if(i===0&&r===0){if(f>n.EnvConstants.INT32MAXVALUE)return n.EnvConstants.INT32MAXVALUE;if(f<-1*(n.EnvConstants.INT32MAXVALUE+1))return-1*(n.EnvConstants.INT32MAXVALUE+1)}return u};this.GetFormatedValue=function(n){var t=u(n).toString();return r!=0&&(t.indexOf(".")<=-1?t=parseFloat(t).toFixed(r):t.split(".")[1].length>r?(t=parseFloat(t).toFixed(i),t=parseFloat(t)):r===i&&(t=parseFloat(t).toFixed(r))),t};this.dispose=function(){this.GetFormatedValue=null;u=null}}function r(n){this.pattern;this.applyPattern(n)}function o(n,t){this.name=n;this.value=t;this.isDate=!1;this.isByteArray=!1}function f(){this.tables=[];this.total=0}function u(){this.count=0;this.totalPage=0;this.page=1;this.columns=[];this.rows=[];this.totalRecord=0;this.columnsName=[]}function e(n,t){this.cells=n.cells;this.id=n.id;this.parent=t}function i(){return this.rowIndex=-1,this.tables=[],this.curTable,this}function s(){}n.Events=function(){var n="click",t="click",i;return n="ontouchstart"in document?"touchstart":"click",t="ontouchend"in document?"touchend":"click",i="click",{onTouchStartOrClick:n,onTouchEndOrClick:t,onClick:i,onTouchStartAndClick:"touchstart click"}}();n.Actions={zoom:"zoom",refresh:"refresh",preference:"preference",add:"add",update:"update",remove:"delete",contact:"contact"};n.EnvConstants={WINDOW_FIND:1110,WINDOW_MLOOKUP:1111,WINDOW_CUSTOMIZE:1112,WINDOW_INFO:1113,TAB_INFO:1113,WINDOW_ACCOUNT:1114,WINDOW_TEMP:111e5,INT32MAXVALUE:2147483647};n.Format=h;n.Utility={divCoding:t("<div>"),inheritPrototype:function(n,t){var i=Object.create(t.prototype);i.constructor=n;n.prototype=i;n.prototype.$super=t.prototype},getBusyPanel:function(){return t("<div>").html(t("<strong>").html("Loading...."))},getFunctionByName:function(n,t){for(var f=[].slice.call(arguments).splice(2),r=n.split("."),u=r.pop(),i=0;i<r.length;i++)t=t[r[i]];return t[u]},utf8_to_b64:function(n){return window.btoa(unescape(encodeURIComponent(n)))},b64_to_utf8:function(n){return decodeURIComponent(escape(window.atob(n)))},decodeText:function(n){return this.divCoding.html(n).text()},encodeText:function(n){return this.divCoding.text(n).html()}};n.Utility.encode=n.Utility.utf8_to_b64;n.Utility.decode=n.Utility.b64_to_utf8;n.Utility.Util={getValueOfInt:function(n){return n==null||n.toString().trim()==""?0:isNaN(n)?0:parseInt(n.toString())},getValueOfDecimal:function(n){return n==null||n.toString().trim()==""?0:isNaN(n)?0:parseFloat(n.toString())},getValueOfDouble:function(n){return n==null||n.toString().trim()==""?0:isNaN(n)?0:parseFloat(n.toString())},getValueOfString:function(n){return n==null||n.toString().trim()==""?"":n==null?"":n.toString()},getValueOfDate:function(n){return n==null||n.toString().trim()==""?0:n?new Date(n):null},getValueOfFormattedDateTime:function(n){if(n==null||n.toString().trim()=="")return 0;if(n){var t=new Date(n),i,r,u,f,e,o;return i=t.getFullYear(),r=t.getMonth().toString().length===1?"0"+(t.getMonth()+1).toString():t.getMonth()+1,u=t.getDate().toString().length===1?"0"+t.getDate().toString():t.getDate(),f=t.getHours().toString().length===1?"0"+t.getHours().toString():t.getHours(),e=t.getMinutes().toString().length===1?"0"+t.getMinutes().toString():t.getMinutes(),o=t.getSeconds().toString().length===1?"0"+t.getSeconds().toString():t.getSeconds(),i+"-"+r+"-"+u+"T"+f+":"+e+":"+o}return null},getValueOfBoolean:function(n){return n==null||n.toString().trim()==""?null:n.toString().toLowerCase()=="true"||n.toString()=="Y"?!0:!1},contains:function(n,t){return n.indexOf(t)>-1},isEmpty:function(n){return n==null||n.length===0?!0:!1},cleanMnemonic:function(n){if(n==null||n.length==0)return n;var t=n.indexOf("&");return t==-1?n:(t+1<n.length&&n.charAt(t+1)!=" "&&(n=n.substring(0,t)+n.substring(t+1)),n)},scale:function(n){var t,i;return isNaN(n)?0:(t=1.1,t=t.toLocaleString().substring(1,2),i=n.toString().split(t),i.length>2||i.length==1)?0:i[1].length}};n.Env=function(){function o(){return i++}function s(){return n.context}function h(n,t,i,r,u){var c,s,o,l;if(i==null||i.Length==0)return"";for(var f="",h=new String(""),e=i.indexOf("@");e!=-1&&e!=i.lastIndexOf("@");){if(c=i.substring(0,e),h+=i.substring(0,e),i=i.substring(e+1,i.length),s=i.indexOf("@"),s<0)return"";if(o="",l="",f=i.substring(0,s),o=f.contains(".")?n.getWindowContext(t,f.substring(0,f.indexOf(".")),r):n.getWindowContext(t,f,r),o.length==0&&(f.startsWith("#")||f.startsWith("$"))&&(o=n.getContext(f)),o.length==0){if(!u)return""}else h+=o;i=i.substring(s+1,i.length);e=i.indexOf("@")}return h+i}function c(){return r}function l(n){n&&n.toString().length!=0||(n=50);r=n}function a(){return u}function v(n){u=n}function y(n,t,i,r){if(n==null||i==null)throw new IllegalArgumentException("Require Context");var u=null;return r?(u=n.getContext("#"+i),u.length==0&&(u=n.getContext("$"+i))):(u=n.getContext("P"+t+"|"+i),u.length==0&&(u=n.getContext("P|"+i))),u==null?"":u}function p(n,t){var i="";return t>0&&(i+=n.getWindowContext(t,"WindowName",!1)+"  "),i}function w(n){var t,u,r;if(n==null)throw new Error("Require Context");t=[];for(u in n)u.startsWith(i+"|")&&t.push(u);while(t.length>0)r=t.pop(),n[r]=null,delete n[r],r=null}function b(n,t){if(isNaN(n)||n===null)return"0";var i=n.toString();return i.contains(t)&&(i=i.split(t).join("")),i}function f(n,t){var i=[],r,u;return i=n.split("."),r=Globalize.format(Number(i[0]),"N",Globalize.cultureSelector),u=i[1]===""?".0":i[1],r.substring(0,r.length-3)+t+u}function k(t,i,r){return i=n.Env.removeCultCommaDot(i,t.thousendSeprator),i=i.split(t.decimalSeprator).join("."),i=t.format.GetFormatedValue(i),r===n.DisplayType.Amount?i=Globalize.format(Number(i),"N",Globalize.cultureSelector):r===n.DisplayType.Number&&(i=f(i.toString(),t.decimalSeprator)),i}function d(){return Date.now}function g(n){var i="";return i=typeof n!="string"?e(n):n,t()==i}function e(n){if(n!=null){var i=n.getContext("#AD_Language");if(i!=null&&i.length>0)return i}return t()}function t(){return"en_US"}function nt(n){return n==null||n.toString().trim()==""?0:isNaN(n)?0:n>0?1:n<0?-1:0}function tt(n){window.open(n)}var i=1,r=50,u=400;return{getWindowNo:o,getCtx:s,parseContext:h,getWINDOW_PAGE_SIZE:c,setWINDOW_PAGE_SIZE:l,setScreenHeight:v,getScreenHeight:a,getPreference:y,getHeader:p,clearWinContext:w,removeCultCommaDot:b,numberCultureValueFormat:f,numberDisplay:k,isBaseLanguage:g,getAD_Language:e,getBaseAD_Language:t,currentTimeMillis:d,signum:nt,startBrowser:tt,ZERO:0,ONE:1,ONEHUNDRED:100,NL:"\r\n",SHOW_CLIENT_ORG:0,SHOW_CLIENT_ONLY:1,SHOW_ORG_ONLY:2,HIDE_CLIENT_ORG:3,NULLString:"NULLValue"}}();n.AEnv=function(){function u(t,i,r){n.dataContext.getWindowJString({windowNo:t,AD_Window_ID:i},r)}function f(i){return t('<button class="vis-controls-txtbtn-table-td2" '+(i?"disabled":"")+' ><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/Zoom20.png" /><\/button>')}function e(i){var r=t("<ul class='vis-apanel-rb-ul'>");return typeof i[n.Actions.zoom]!="undefined"&&r.append(t("<li data-action='"+n.Actions.zoom+"' style='opacity:"+(i[n.Actions.zoom]?.7:1)+"'><img data-action='"+n.Actions.zoom+"' src='"+n.Application.contextUrl+"Areas/VIS/Images/Zoom16.png'><span data-action='"+n.Actions.zoom+"'>"+n.Msg.getMsg("Zoom")+"<\/span><\/li>")),i[n.Actions.preference]&&r.append(t("<li data-action='"+n.Actions.preference+"'><img data-action='"+n.Actions.preference+"' src='"+n.Application.contextUrl+"Areas/VIS/Images/Preference16.png'><span data-action='"+n.Actions.preference+"'>"+n.Msg.getMsg("Preference")+"<\/span><\/li>")),i[n.Actions.refresh]&&r.append(t("<li data-action='"+n.Actions.refresh+"'><img data-action='"+n.Actions.refresh+"' src='"+n.Application.contextUrl+"Areas/VIS/Images/Refresh16.png'><span data-action='"+n.Actions.refresh+"'>"+n.Msg.getMsg("Requery")+"<\/span><\/li>")),i[n.Actions.add]&&r.append(t("<li data-action='"+n.Actions.add+"'><img data-action='"+n.Actions.add+"' src='"+n.Application.contextUrl+"Areas/VIS/Images/AddBP16.png'><span data-action='"+n.Actions.add+"'>"+n.Msg.getMsg("Add")+"<\/span><\/li>")),i[n.Actions.update]&&r.append(t("<li data-action='"+n.Actions.update+"'><img data-action='"+n.Actions.update+"' src='"+n.Application.contextUrl+"Areas/VIS/Images/UpdateBP16.png'><span data-action='"+n.Actions.update+"'>"+n.Msg.getMsg("Update")+"<\/span><\/li>")),i[n.Actions.remove]&&r.append(t("<li data-action='"+n.Actions.remove+"'><img data-action='"+n.Actions.remove+"' src='"+n.Application.contextUrl+"Areas/VIS/Images/Clear16.png'><span data-action='"+n.Actions.remove+"'>"+n.Msg.getMsg("Clear")+"<\/span><\/li>")),i[n.Actions.contact]&&r.append(t("<li data-action='"+n.Actions.contact+"'><img data-action='"+n.Actions.contact+"' src='"+n.Application.contextUrl+"Areas/VIS/Images/Contact16.png'><span data-action='"+n.Actions.contact+"'>"+n.Msg.getMsg("Contact")+"<\/span><\/li>")),r}function o(){if(i==null){i=!1;var t=645;n.MRole.getIsTableAccess(t,!0)?i=!0:(t=644,n.MRole.getIsTableAccess(t,!0)&&(i=!0));i&&n.DB.executeScalar("SELECT AD_Window_ID FROM AD_Table WHERE AD_Table_ID="+t,null,function(n){n&&!isNaN(n)&&(r=parseInt(n));r==0&&(r=297)})}return i}function s(t,i){var u=null;t!=0&&i!=0&&(u=new n.Query("AD_WF_Process"),u.addRestriction("AD_Table_ID",n.Query.prototype.EQUAL,t),u.addRestriction("Record_ID",n.Query.prototype.EQUAL,i),n.viewManager.startWindow(r,u))}function h(t,i){var u=null,f=0,e=0,s="SELECT TableName, AD_Window_ID, PO_Window_ID FROM AD_Table WHERE AD_Table_ID="+t,r=null,o;(r=n.DB.executeReader(s),r.read()&&(u=r.get(0).toString(),f=n.Utility.Util.getValueOfInt(r.getInt(1)),e=n.Utility.Util.getValueOfInt(r.getInt(2))),r.dispose(),u!=null&&f!=0)&&(e==0||(o=u+"_ID="+i,f=n.ZoomTarget.getZoomAD_Window_ID(u,0,o,!0),f!=0))&&n.viewManager.startWindow(f,n.Query.prototype.getEqualQuery(u+"_ID",i))}var i=null,r=0;return{getGridWindow:u,getContextPopup:e,getZoomButton:f,getIsWorkflowProcess:o,startWorkflowProcess:s,zoom:h}}();r.prototype.typeList=["","","number","","date","","time","","choice"];r.prototype.modifierList=["","","currency","","percent","","integer"];r.prototype.dateModifierList=["","","short","","medium","","long","","full"];r.prototype.allFormats={currency:"C",decimal:"D",general:"G",number:"N",percent:"P",shortdate:"d",longdate:"D",shorttime:"t",longtime:"T",fulltime:"T",fulldate:"D",mediumdate:"d",mediumtime:"t",choice:""};r.prototype.applyPattern=function(n){var r,t,u,i;if(!this.cmpreFormat(n)){this.pattern=n;return}for(r=[],t=new StringBuilder(""),u=0;u<n.length;++u)i=n[u],i=="{"?t.length()==0?t.append(i):(r.push(t.toString()),t.clear(),t.append(i)):i=="}"?(t.append(i),r.push(t.toString()),t.clear()):u==n.length?(r.add(t.toString()),t.clear()):t.append(i);this.pattern=this.parsePattren(r)};r.prototype.parsePattren=function(n){for(var r=new StringBuilder(" "),t,i=0;i<n.length;i++){if(t=n[i],t.startsWith("{")&&this.cmpreFormat(t)){t=this.getFormat(t.split(","));r.append(t);continue}r.append(t)}return r.toString()};r.prototype.getFormat=function(n){var i=new StringBuilder(n[0]),t="";switch(this.findKeyword(n[1],this.typeList)){case 0:break;case 1:case 2:switch(this.findKeyword(n[2].toString(),this.modifierList)){case 0:t=this.allFormats.number;break;case 1:case 2:t=this.allFormats.currency;break;case 3:case 4:t=this.allFormats.percent;break;case 5:case 6:t=this.allFormats.decimal;break;default:t=this.allFormats.number}break;case 3:case 4:switch(this.findKeyword(n[2],this.dateModifierList)){case 0:t=this.allFormats.shortdate;break;case 1:case 2:t=this.allFormats.shortdate;break;case 3:case 4:t=this.allFormats.mediumdate;break;case 5:case 6:t=this.allFormats.longdate;break;case 7:case 8:t=this.allFormats.fulldate;break;default:t=n[3].ToString()}break;case 5:case 6:switch(this.FindKeyword(n[2].ToString(),this.dateModifierList)){case 0:t=this.allFormats.shorttime;break;case 1:case 2:t=this.allFormats.shorttime;break;case 3:case 4:t=this.allFormats.mediumtime;break;case 5:case 6:t=this.allFormats.mediumtime;break;case 7:case 8:t=this.allFormats.mediumtime;break;default:t=n[2].ToString()}break;case 7:case 8:try{t=n[3];this.allFormats.choice=n[3].ToString()}catch(r){throw new ArgumentException("Choice Pattern incorrect");}break;default:throw new ArgumentException("unknown format type at ");}return n=null,t="",i.append(t).append("}"),i.toString()};r.prototype.format=function(n){var i=this.pattern,t,r;for(this.pattern=null,t=0;t<n.length;t++)r=new RegExp("\\{"+t+"\\}","gm"),i=i.replace(r,n[t]);return i};r.prototype.cmpreFormat=function(n){return n.contains("number,")||n.contains("date,")||n.contains("time,")||n.contains("custom,")?!0:!1};r.prototype.findKeyword=function(n,t){for(var i=0;i<t.length;i++)if(n.equals(t[i]))return i;return-1};n.DB={QUOTE:"'",getDBDateFormat:function(n,t,i){var r="",u;return i||n.setMinutes(-n.getTimezoneOffset()),r=n.toISOString(),u=r.split("T"),r=u[0],t&&(r+=" "+u[1].substring(0,u[1].length-5)),r},to_date:function(n,t){time=n&&n.toString().length>0?n instanceof Date?n:new Date(n):null;time.toString()=="Invaild Date"&&(time=null);var i="",r="";if(1){if(time==null)return t?"TRUNC(SysDate)":"SysDate";i+="TO_DATE('";r=time;t?(r=this.getDBDateFormat(time,!1,!1),i+=r,i+="','YYYY-MM-DD')"):(r=this.getDBDateFormat(time,!0,!0),i+=r,i+="','YYYY-MM-DD HH24:MI:SS')")}else if(DatabaseType.IsPostgre){if(time==null)return t?"TRUNC(SysDate)":"SysDate";i=new StringBuilder("TO_DATE('");t?(r=time.Value.ToString("yyyy-MM-dd"),i.Append(r),i.Append("','YYYY-MM-DD')")):(r=time.Value.ToString("yyyy-MM-dd HH:mm:ss"),i.Append(r),i.Append("','YYYY-MM-DD HH24:MI:SS')"))}else if(DatabaseType.IsMSSql){if(time==null)return t?"CAST(STR(YEAR(Getdate()))+'-'+STR(Month(Getdate()))+'-'+STR(Day(Getdate())) AS DATETIME)":"getdate()";i=new StringBuilder("CAST('");r=time.ToString();t?(i.Append(r.Substring(0,10)),i.Append("' AS DATETIME)")):(i.Append(r.Substring(0,r.IndexOf("."))),i.Append("' AS DATETIME)"))}return i.toString()},to_char:function(t,i){var r="TRIM(TO_CHAR(";return r=r.concat(t),n.DisplayType.IsNumeric(i)?r=i==n.DisplayType.Amount?r.concat(",'9G999G990D00'"):r.concat(",'TM9'"):n.DisplayType.IsDate(i)&&(r=r.concat(",'").concat("yyyy-MM-dd").concat("'")),r=r.concat("))"),r.toString()},to_string:function(n,t){var i,r,u,f;if(n==null&&n.length==0)return"NULL";for(t!=null&&(t=0),i=n,t!=0&&i.length>t&&(i=n.substring(0,t)),r=new StringBuilder,r.append(this.QUOTE),u=0;u<i.length;u++)f=i.charAt(u),f==this.QUOTE?r.append("''"):r.append(f);return r.append(this.QUOTE),i=r.toString(),r.clear(),i},executeDataSet:function(t,i,r){var f=r?!0:!1,e={sql:t,page:1,pageSize:0},u;return i&&(e.param=i),u=null,n.dataContext.getDataSetJString(e,f,function(t){u=(new n.DB.DataSet).toJson(t);f&&r(u)}),u},executeDataReader:function(t,i,r){var f=r?!0:!1,e={sql:t,page:1,pageSize:0},u;return i&&(e.param=i),u=null,n.dataContext.getDataSetJString(e,f,function(t){u=(new n.DB.DataReader).toJson(t);f&&r(u)}),u},executeReader:function(t,i,r){var f=r?!0:!1,e={sql:t,page:1,pageSize:0},u;return i&&(e.param=i),u=null,n.dataContext.getDataSetJString(e,f,function(t){u=(new n.DB.DataReader).toJson(t);f&&r(u)}),u},executeDataReaderPaging:function(t,i,r,u,f){var o=f?!0:!1,s={sql:t,page:i,pageSize:r},e;return u&&(s.param=u),e=null,n.dataContext.getDataSetJString(s,o,function(t){e=(new n.DB.DataReader).toJson(t);o&&f(e)}),e},executeDataSetPaging:function(t,i,r,u,f){var o=f?!0:!1,s={sql:t,page:i,pageSize:r},e;return u&&(s.param=u),e=null,n.dataContext.getDataSetJString(s,o,function(t){e=(new n.DB.DataSet).toJson(t);o&&f(e)}),e},executeScalar:function(t,i,r){var f=r?!0:!1,e={sql:t,page:1,pageSize:0},u=null;return n.dataContext.getDataSetJString(e,f,function(t){var i=(new n.DB.DataSet).toJson(t);u=i.getTable(0).getRows().length>0?i.getTable(0).getRow(0).getCell(0):null;i.dispose();i=null;f&&r(u)}),u},executeQuery:function(t,i,r){var f=r?!0:!1,u=null,e={sql:t};return i&&(e.param=i),n.dataContext.executeQuery(e,f,function(n){u=JSON.parse(n);f&&r(u)}),u},executeQueries:function(t,i,r){var f=r?!0:!1,u=null,e={sql:t.join("/"),param:i};return n.dataContext.executeQueries(e,f,function(n){u=JSON.parse(n);f&&r(u)}),u}};o.prototype.setIsDate=function(n){this.isDate=n};o.prototype.setIsByteArray=function(n){this.isByteArray=n};f.prototype.toJson=function(i){for(var r=JSON.parse(i),f,r=t.isArray(r)?r:[r],u=0;u<r.length;u++)f=new n.DB.DataTable,f.toJson(r[u]),this.tables.push(f);return r=null,this};f.prototype.getTable=function(n){return n>-1&&n<this.tables.length?this.tables[n]:null};f.prototype.getTables=function(){return this.tables};f.prototype.dispose=function(){for(var n=this.tables.length;n>0;n--)this.tables.pop().dispose();this.tables.length=0;this.tables=null};u.prototype.toJson=function(t){var i,r;if(t){if(this.totalRecord=t.records,this.totalPage=t.total,this.page=t.page,t.columns){for(i=0;i<t.columns.length;i++)this.columnsName[i]=t.columns[i].name;for(r=0;r<t.rows.length;r++)this.rows.push(new n.DB.DataRow(t.rows[r],this));this.columns=t.columns}this.count=this.rows.count}t=null};u.prototype.getRowCount=function(){return this.rows.length};u.prototype.getColumnCount=function(){return this.columns.length};u.prototype.getRow=function(n){return n>-1&&n<this.rows.length?this.rows[n]:null};u.prototype.getRows=function(){return this.rows};u.prototype.getColumnsName=function(){return this.columnsName};u.prototype.dispose=function(){for(this.count=0,this.totalPage=0,this.page=1,this.columns.length=0,this.columns=null;this.rows.length>0;)this.rows.pop().dispose();this.rows.length=0;this.rows=null;this.totalRecord=0};e.prototype.getCell=function(n){var t=-1,i="";isNaN(n)?(n=n.toLowerCase(),t=this.parent.columnsName.indexOf(n),i=n):(t=n,i=this.parent.columnsName[t]);var r=this.parent.columns[t],u=r.type,f=this.cells[i];return u=="system.datetime",f};e.prototype.getJSCells=function(){return this.cells};e.prototype.dispose=function(){this.cells.length=0;this.cells=null;this.id=null;this.parent=null};i.prototype.toJson=function(i){for(var r=JSON.parse(i),f,r=t.isArray(r)?r:[r],u=0;u<r.length;u++)f=new n.DB.DataTable,f.toJson(r[u]),this.tables.push(f),u===0&&(this.curTable=this.tables[u]);return r=null,this};i.prototype.read=function(){return this.curTable?++this.rowIndex>=this.curTable.getRowCount()?!1:!0:!1};i.prototype.getCell=function(n){return this.curTable.getRow(this.rowIndex).getCell(n)};i.prototype.get=function(n){return this.curTable.getRow(this.rowIndex).getCell(n)};i.prototype.getString=function(n){var t=this.curTable.getRow(this.rowIndex).getCell(n);return t==null?"":t.toString()};i.prototype.getInt=function(n){var t=this.curTable.getRow(this.rowIndex).getCell(n);return t==null?0:parseInt(t)};i.prototype.getDecimal=function(n){var t=this.curTable.getRow(this.rowIndex).getCell(n);return t==null?0:parseFloat(t)};i.prototype.getDateTime=function(n){return this.curTable.getRow(this.rowIndex).getCell(n)};i.prototype.setTableIndex=function(n){this.rowIndex=0;this.curTable=this.tables[n]};i.prototype.close=function(){};i.prototype.dispose=function(){this.curTable=null;for(var n=this.tables.length;n>0;n--)this.tables.pop().dispose();this.tables.length=0;this.tables=null;this.rowIndex=null};s.prototype.max=function(n,t){return n==null?t:t==null?n:n>t?n:t};n.DB.DataSet=f;n.DB.DataTable=u;n.DB.DataRow=e;n.DB.SqlParam=o;n.DB.DataReader=i;n.MessageFormat=r;n.TimeUtil=s}(VIS,jQuery);VIS.Logging=VIS.Logging||{},function(n){function t(n,t){this.name=n;this.value=t}function e(n,t){this._level=n;this._sequenceNumber;this._sourceClassName;this._sourceMethodName;this._message=t;this._lineNumber;this._loggerName}function o(){if(o.prototype.singleInstance)return o.prototype.singleInstance;o.prototype.singleInstance=this}function u(){if(u.prototype.singletonInstance)return u.prototype.singletonInstance;u.prototype.singletonInstance=this}function s(){this.offValue=t.OFF.getIntValue();this.logLevel=t.ALL;this.formatter;this.filter}function f(){if(f.prototype.singleInstance)return f.prototype.singleInstance;this.setFormatter(u.get());this.setLevel(t.INFO);this.setFilter(o.get());this.ERROR_SIZE=20;this.m_errors=[];this.m_history=[];this.LOG_SIZE=100;this.m_logs=[];this.m_issueError=!0;f.prototype.singleInstance=this}function i(n){this.levelValue=t.INFO.getIntValue();this.name=n;this.levelObject;this.handlers=[];this.kids=[];this.manager=r.getLogManager();this.parent;this.offValue=t.OFF.getIntValue();this.filter}function c(){i.call(this,"");this.setLevel(t.INFO)}function r(){if(r.prototype.singleInstance)return r.prototype.singleInstance;this.emptyHandlers=[];this.loggers={};this.defaultLevel=t.INFO;this.rootLogger;r.prototype.singleInstance=this}function h(n){i.call(this,n)}function l(){var e=null,n=t.INFO,h=[t.OFF,t.SEVERE,t.WARNING,t.INFO,t.CONFIG,t.FINE,t.FINER,t.FINEST,t.ALL],c=function(n){if(n!=null){var t=i.getLogger("");t.addHandler(n);e.push(n)}},d=function(){return t.ALL.getIntValue()==n.getIntValue()},l=function(){var r,t,n;if(e==null){e=[];try{for(r=i.getLogger(""),t=r.getHandlers(),n=0;n<t.length;n++)e.contains(t[n])||e.Add(t[n])}catch(s){}f.get(!1)==null&&c(f.get(!0));v(u.get());y(o.get())}},s=function(t){var i,r;if(t!=null){for(e==null&&l(!0),i=0;i<e.length;i++)r=e[i],r.setLevel(t);t.getIntValue()!=n.getIntValue()&&a(t,null);n=t}},a=function(n,t){var f,e,o,u,s;if(n!=null){f=r.getLogManager();e=f.getLoggerNames();for(o in e)u=o,(t==null||u.indexOf(t)!=-1)&&(s=i.getLogger(u),s.setLevel(n))}},v=function(n){for(var i,t=0;t<e.length;t++)i=e[t],i.setFormatter(n)},y=function(n){for(var i,t=0;t<e.length;t++)i=e[t],i.setFilter(n)},p=function(){return n},w=function(n){if(n)for(var t=0;t<h.length;t++)if(h[t].getName().equals(n)){s(h[t]);return}},g=function(){return n.getIntValue()},b=function(){var n=r.getLogManager();n.reset()},k=function(i){if(i)s(n);else{var r=n;s(t.OFF);n=r}};return{initialize:l,addHandler:c,setLevel:s,setLevelByString:w,getLevel:p,shutdown:b,enable:k,getIsLevelAll:function(){return t.ALL.getIntValue()==n.getIntValue()},getIsLevelFinest:function(){return t.FINEST.getIntValue()>=n.getIntValue()},getIsLevelFiner:function(){return t.FINER.getIntValue()>=n.getIntValue()},getIsLevelFine:function(){return t.FINE.getIntValue()>=n.getIntValue()},getIsLevelInfo:function(){return t.INFO.IntValue()>=n.IntValue()}}}t.prototype.getIntValue=function(){return this.value};t.prototype.getName=function(){return this.name};t.prototype.getLevel=function(n){return t.OFF.getIntValue()==n?t.OFF:t.SEVERE.getIntValue()==n?t.SEVERE:t.WARNING.getIntValue()==n?t.WARNING:t.INFO.getIntValue()==n?t.INFO:t.CONFIG.getIntValue()==n?t.CONFIG:t.FINE.getIntValue()==n?t.FINE:t.FINER.getIntValue()==n?t.FINER:t.FINEST.getIntValue()==n?t.FINEST:t.ALL.getIntValue()==n?t.ALL:void 0};t.OFF=new t("OFF",9999);t.SEVERE=new t("SEVERE",1e3);t.WARNING=new t("WARNING",900);t.INFO=new t("INFO",800);t.CONFIG=new t("CONFIG",700);t.FINE=new t("FINE",600);t.FINER=new t("FINER",500);t.FINEST=new t("FINEST",400);t.ALL=new t("ALL",0);e.prototype.getMessage=function(){return this._message};e.prototype.setMessage=function(n){this._message=n};e.prototype.getSourceClassName=function(){return this._sourceClassName};e.prototype.setSourceClassName=function(n){this._sourceClassName=n};e.prototype.getSourceMethodName=function(){return this._sourceMethodName};e.prototype.setSourceMethodName=function(n){this._sourceMethodName=n};e.prototype.getLineNumber=function(){return this._lineNumber};e.prototype.setLineNumber=function(n){this._lineNumber=n};e.prototype.getLoggerName=function(){return this._loggerName};e.prototype.setLoggerName=function(n){this._loggerName=n};e.prototype.getLevel=function(){return this._level};o.prototype.singleInstance=null;o.get=function(){return o.prototype.singleInstance?o.prototype.singleInstance:new o};o.prototype.getIsLoggable=function(n){var i,r;return n.getLevel()===t.SEVERE||n.getLevel()===t.WARNING?!0:(i=n.getLoggerName(),i&&i.startsWith("System."))?!1:(r=n.sourceClassName,r&&r.startsWith("System."))?!1:!0};u.prototype.singletonInstance=null;u.prototype.NL="/n";u.get=function(){return u.prototype.singletonInstance?u.prototype.singletonInstance:new u};u.prototype.format=function(n){var i=new StringBuilder,r=Date.now.toString("yyyy-MM-dd hh:mm:ss.ms"),u;return r=r+"00",n.getLevel()==t.prototype.SEVERE?(i.append("===========> "),i.append("    (SEVERE)   ")):n.getLevel()==t.WARNING?(i.append("-----------> "),i.append("    (WARNING)  ")):(i.append(r.Substring(11,12)),u=11,n.getLevel()==t.INFO?i.append("    (INFO)     "):n.getLevel()==t.CONFIG?i.append("    (CONFIG)   "):n.getLevel()==t.FINE?i.append("    (FINE)     "):n.getLevel()==t.FINER?i.append("    (FINER)    "):n.getLevel()==t.FINEST&&i.append("    (FINEST)   ")),i.append(n.message),i.toString()};u.prototype.getHead=function(){var n=(new StringBuilder).append("*** ").append(DateTime.Now.ToString()).append(" VAdvantage Log ").append(" ***").append("\n").append("ViennaAdvantage");return n.toString()};u.prototype.getTail=function(){var n=(new StringBuilder).append("*** ").append(" VAdvantage Log").append(" ***");return n.toString()};u.prototype.getClassMethod=function(n){var i="",t=n.getLoggerName(),r,u;return((t==null||t.indexOf("default")!=-1||t.indexOf("global")!=-1)&&(t=n.getSourceClassName()),t!=null?(r=t.lastIndexOf("."),i+=r!=-1?t.substring(r+1):t):i+=n.getLoggerName(),n.getSourceMethodName()!=null&&(i+="."+n.getSourceMethodName()),u=i,u.equals("Trace.printStack"))?"":u};u.prototype.getParameters=function(n){var r="",i=n.getParameters(),t;if(i!=null&&i.length>0)for(t=0;t<i.length;t++)t>0&&(r+=", "),r+=i[t];return r};u.prototype.getExceptionTrace=function(){try{}catch(n){}return""};s.prototype.publish=function(){};s.prototype.close=function(){};s.prototype.flush=function(){};s.prototype.setLevel=function(n){if(n==null)throw new NullReferenceException("No Level");this.logLevel=n};s.prototype.getLevel=function(){return this.logLevel};s.prototype.getFilter=function(){return this.filter};s.prototype.setFilter=function(n){this.filter=n};s.prototype.getIsLoggable=function(n){var i=this.getLevel().getIntValue(),t;return n.getLevel().getIntValue()<i||i==this.offValue?!1:(t=this.getFilter(),t==null)?!0:t.getIsLoggable(n)};s.prototype.getFormatter=function(){return this.formatter};s.prototype.setFormatter=function(n){this.formatter=n};n.Utility.inheritPrototype(f,s);f.prototype.singleInstance=null;f.get=function(n){return f.prototype.singleInstance?f.prototype.singleInstance:n?new f:null};f.prototype.setLevel=function(n){n!=null&&(n==t.OFF?this.$super.setLevel.call(this,t.SEVERE):n==t.ALL||n==t.FINEST||n==t.FINER?this.$super.setLevel.call(this,t.FINE):this.$super.setLevel.call(this,n))};f.prototype.publish=function(n){var i,r,u,f,e;if(this.getIsLoggable(n)&&this.m_logs!=null){if(this.m_logs.length>=this.LOG_SIZE&&this.m_logs.shift(),this.m_logs.push(n),n.getLevel()==t.SEVERE){for(this.m_errors.length>=this.ERROR_SIZE&&(this.m_errors.shift(),this.m_history.shift()),this.m_errors.push(n),i=[],r=0;r<this.m_logs.length;r++)if(u=this.m_logs[r],u.getLevel()==t.SEVERE)if(i.length==0)i.push(u);else break;else if(i.push(u),i.length>10)break;this.m_history.push(i);this.m_issueError&&(f=n.getLoggerName(),e=n.getSourceMethodName())}console.log(n)}};f.prototype.close=function(){this.m_logs!=null&&(this.m_logs.length=0,this.m_logs=null);this.m_errors!=null&&(this.m_errors.length=0,this.m_errors=null);this.m_history!=null&&(this.m_history.length=0,this.m_history=null)};f.prototype.getColumnNames=function(){var n=[4];return n[0]="Time",n[1]="Level",n[2]="Class.Method",n[3]="Message",n};f.prototype.getRecords=function(n){return n?this.m_errors.slice():this.m_logs.slice()};f.prototype.getLogData=function(n){for(var f=this.getRecords(n),e=[],r,t,i=0,o=f.length;i<o;i++)r=f[i],t=[],t.push((new Date).toString()),t.push(r.getLevel().getName()),t.push(u.get().getClassMethod(r)),t.push(r.getMessage()),e.push(t);return e};f.prototype.resetBuffer=function(n){this.m_errors.length=0;this.m_history.length=0;n||(this.m_logs.length=0)};i.prototype.setFilter=function(n){this.filter=n};i.prototype.getFilter=function(){return this.filter};i.prototype.log=function(n,i,r){var i=i,f,u,o,s;if((r&&(r.message&&(i+=" => "+r.message),r.stack&&(i+=" ===> "+r.stack)),!(n.getIntValue()<this.levelValue)&&this.levelValue!=t.OFF.getIntValue())&&(f=new e(n,i),f.setLoggerName(this.name),this.filter==null||this.filter.getIsLoggable(f)))for(u=this;u!=null;){if(o=u.getHandlers(),o!=null)for(s=0;s<o.length;s++)o[s].publish(f);u=u.getParent()}};i.prototype.getParent=function(){return this.parent};i.prototype.getHandlers=function(){return this.handlers==null?emptyHandlers:this.handlers};i.prototype.getName=function(){return this.name};i.prototype.setLevel=function(n){this.levelObject=n;this.levelValue=n.getIntValue()};i.prototype.getLevel=function(){return this.levelObject};i.prototype.addHandler=function(n){this.handlers==null&&(handlers=[]);this.handlers.push(n)};i.prototype.removeHandler=function(n){n!=null&&this.handlers!=null&&this.handlers.remove(n)};i.getLogger=function(n){var u=r.getLogManager(),t=u.getLogger(n);return t==null&&(t=new i(n),u.addLogger(t),t=u.getLogger(n)),t};i.prototype.setParent=function(n){this.parent=n};i.prototype.getIsLoggable=function(n){return n.getIntValue()<levelValue||levelValue==offValue?!1:!0};i.prototype.fine=function(n){t.FINE.getIntValue()<this.levelValue||this.log(t.FINE,n)};i.prototype.info=function(n){t.INFO.getIntValue()<this.levelValue||this.log(t.INFO,n)};i.prototype.config=function(n){t.CONFIG.getIntValue()<this.levelValue||this.log(t.CONFIG,n)};i.prototype.finer=function(n){t.FINER.getIntValue()<this.levelValue||this.log(t.FINER,n)};i.prototype.finest=function(n){t.FINEST.getIntValue()<this.levelValue||this.log(t.FINEST,n)};i.prototype.severe=function(n){t.SEVERE.getIntValue()<this.levelValue||this.log(t.SEVERE,n)};i.prototype.warning=function(n){t.WARNING.getIntValue()<this.levelValue||this.log(t.WARNING,n)};i.prototype.saveError=function(n,t){return this.saveError(n,t.message,!0)};i.prototype.saveError=function(n,t,i){return i&&this.warning(n+" "+t.message),!0};i.prototype.getIsLevelFinest=function(){return l.getIsLevelFinest()};n.Utility.inheritPrototype(c,i);r.prototype.singleInstance=null;r.prototype.addLogger=function(n){var t=n.getName(),i=null;return(t in this.loggers&&(i=loggers[t]),i!=null)?!1:(this.loggers[t]=n,n instanceof c||n.setParent(this.rootLogger),!0)};r.prototype.reset=function(){for(var n in this.loggers)ResetLogger(n)};r.prototype.resetLogger=function(n){var t=this.getLogger(n),r,i,u;if(t!=null){for(r=t.getHandlers(),i=0;i<r.length;i++){u=r[i];t.removeHandler(u);try{u.close()}catch(f){}}n!=null&&n.equals("")?t.setLevel(this.defaultLevel):t.setLevel(null)}};r.prototype.getLogger=function(n){return n in this.loggers?this.loggers[n]:null};r.getLogManager=function(){if(!r.prototype.singleInstance){new r;var n=r.prototype.singleInstance;n.rootLogger=new c;n.addLogger(n.rootLogger)}return r.prototype.singleInstance};r.prototype.getLoggerNames=function(){return this.loggers};n.Utility.inheritPrototype(h,i);h.getVLogger=function(t){var f=r.getLogManager(),i,u;return(t||(t=""),i=f.getLogger(t),i!=null&&i instanceof h)?i:(u=new h(t),u.setLevel(n.Logging.VLogMgt.getLevel()),f.addLogger(u),u)};n.Logging.Level=t;n.Logging.LogRecord=e;n.Logging.VLogFilter=o;n.Logging.VLogFormatter=u;n.Logging.VLogErrorBuffer=f;n.Logging.Logger=i;n.Logging.VLogger=h;n.Logging.LogManager=r;n.Logging.VLogMgt=l()}(VIS,jQuery);VIS.Controls={},function(n,t){function i(n,r,u,f,e){if(this instanceof i)this.ctrl=n,this.displayType=r,this.isReadOnly=u,this.colName=f,this.isMandatory=e,this.oldValue="oldValue",this.visible,this.tag,this.setVisible(!0),this.editingGrid=null;else return new t.controls.IControl(n,r,u,f,e)}function v(r,u,f,e,o,s,h,c,l){var y=t.DisplayType.String,a=n("<input>",{type:l?"password":"text",name:r,maxlength:s}),v;i.call(this,a,y,f,r,u);f||!e?this.setReadOnly(!0):this.setReadOnly(!1);v=this;a.on("change",function(n){var t,i;n.stopPropagation();t=a.val();this.value=t;t!==v.oldValue&&(i={newValue:t,propertyName:v.getName()},v.fireValueChanged(i),i=null)});this.disposeComponent=function(){a.off("change");a=null;v=null}}function nt(r,u,f,e){var s,o;r=r!=null?r.replace("[&]",""):"";s=' for="'+u+'"';e&&(s="");o=n("<label "+s+">");i.call(this,o,t.DisplayType.Label,!0,e?u:"lbl"+u);f?o.text(r).append("<sup>*<\/sup>"):o.text(r);this.disposeComponent=function(){o=null;self=null}}function r(r,u,f,e,o,s,h,c,l,a){function p(n){b.attr("src",k+n)}var w;this.actionListner;this.AD_Process_ID=c;this.description=s;this.help=h;this.text=o;this.isLink=l;this.isRightLink=a;this.actionLink=null;this.values=null;var b=n("<img style='min-width:15px'>"),v=n("<span>").text(o),k=t.Application.contextUrl+"Areas/VIS/Images/base/",y=null;l?y=n("<li>"):(y=n('<button class="vis-gc-vpanel-table-btn-blue">',{type:"button",name:r}),b.css("margin-right","8px"));r.equals("PaymentRule")?(this.readReference(195),v.css("color","blue"),p("Payment20.png")):r.equals("DocAction")?(this.readReference(135),v.css("color","blue"),p("Process20.png")):r.equals("CreateFrom")?p("Copy16.png"):r.equals("Record_ID")?(p("Zoom20.png"),v.text(t.Msg.getMsg("ZoomDocument"))):r.equals("Posted")&&(this.readReference(234),v.css("color","magenta"),p("InfoAccount20.png"));y.append(b).append(v);i.call(this,y,t.DisplayType.Button,f,r,u);f||!e?this.setReadOnly(!0):this.setReadOnly(!1);w=this;y.on(t.Events.onClick,function(n){n.stopPropagation();w.isReadOnly||w.invokeActionPerformed({source:w})});this.setText=function(n){var t,i;if(n==null){v.text("");return}t=n.indexOf("&");t!=-1&&(i=n.toUpperCase().charAt(t+1),i!=" "&&(n=n.substring(0,t)+n.substring(t+1)));v.text(n)};this.disposeComponent=function(){y.off(t.Events.onClick);y=null;w=null;this.AD_Process_ID=null;this.description=null;this.help=null;this.setText=null}}function y(r,u,f,e,o){var s=n("<input>",{type:"checkbox",name:r,value:o}),c=n('<label class="vis-gc-vpanel-table-label-checkbox" />').html(o).prepend(s),h;i.call(this,c,t.DisplayType.YesNo,f,r,u);this.cBox=s;h=this;this.setReadOnly=function(n){this.isReadOnly=n;s.prop("disabled",n);c.css("opacity",n?.7:1)};f||!e?this.setReadOnly(!0):this.setReadOnly(!1);s.on("change",function(n){var t,i;n.stopPropagation();t=s.prop("checked");t!==h.oldValue&&(i={newValue:t,propertyName:h.getName()},h.fireValueChanged(i),i=null)});this.disposeComponent=function(){s.off("change");s=null;h=null;this.cBox=null}}function s(r,u,f,e,o,s,h,c){function d(){var i,n,r,f,e,u,o;if(l.lookup&&!w){if(i=l.lookup.getZoomQuery(),n=l.getValue(),n==null,n==""&&(n=null),n==null||isNaN(n)||(n=parseInt(n)),i==null||n!=null){if(i=new t.Query,r=null,l.lookup!=null&&l.lookup instanceof t.MLookup&&(f=l.lookup.getAD_Reference_Value_ID(),f!=0)){e="SELECT kc.ColumnName FROM AD_Ref_Table rt INNER JOIN AD_Column kc ON (rt.Column_Key_ID=kc.AD_Column_ID)WHERE rt.AD_Reference_ID="+f;try{u=t.DB.executeDataReader(e);u.read()&&(r=u.getString(0));u.dispose()}catch(s){this.log.log(t.Logging.Level.SEVERE,e,s)}}r!=null&&r.length!=0?i.addRestriction(r,t.Query.prototype.EQUAL,n):i.addRestriction(l.getColumnName(),t.Query.prototype.EQUAL,n);i.setRecordCount(1)}o=0;o=l.mField.getZoomWindow_ID()>0?l.mField.getZoomWindow_ID():l.lookup.getZoomWindow(i);t.viewManager.startWindow(o,i)}}var a,l;h||(h=t.DisplayType.Table);a=n("<select>",{name:r});i.call(this,a,h,f,r,u);this.lookup=o;this.lastDisplay="";this.settingFocus=!1;this.inserting=!1;this.settingValue=!1;this.loading=!1;o!=null&&o.getIsValidated()&&(this.loading=!0);a[0].selectedIndex=-1;f||!e?this.setReadOnly(!0):this.setReadOnly(!1);var k=!1,v=null,b=0,y=null,p={},w=!1;o!=null&&((o.getDisplayType()==t.DisplayType.List&&t.context.getAD_Role_ID()==0||o.getDisplayType()!=t.DisplayType.List)&&(k=!0,o instanceof t.MLookup&&o.getZoomWindow()==0&&c<1&&(w=!0),p[t.Actions.zoom]=w),(this.lookup&&(this.lookup.info.keyColumn.toLowerCase()=="ad_user.ad_user_id"||this.lookup.info.keyColumn.toLowerCase()=="ad_user_id")||r==="AD_User_ID"||r==="SalesRep_ID")&&(p[t.Actions.contact]=!0),v=n('<button tabindex="-1" class="vis-controls-txtbtn-table-td2"><img tabindex="-1" src="'+t.Application.contextUrl+'Areas/VIS/Images/base/Info20.png" /><\/button>'),p[t.Actions.refresh]=!0,t.MRole.getIsShowPreference()&&(p[t.Actions.preference]=!0),y=t.AEnv.getContextPopup(p),b+=1,p=null);this.getBtnCount=function(){return b};this.getBtn=function(){return v};this.setVisible=function(n){this.visible=n;n?(v&&v.show(),a.show()):(a.hide(),v&&v.hide())};l=this;a.on("focus",function(){var n;if(l.lookup!=null){if(n=a.val(),l.lookup.getIsValidated()&&!l.lookup.getHasInactive()){if(l.loading){if(l.lookup.fillCombobox(u,!1,!1,!1),l.lookup.loading)return;l.refreshOptions(l.lookup.data,n);n!=null&&a[0].selectedIndex<0&&(l.oldValue="old",a.trigger("change"));l.loading=!1}return}l.getIsReadonly()||(l.settingFocus=!0,n=a.val(),l.lookup.fillCombobox(l.getIsMandatory(),!0,!0,!0),l.refreshOptions(l.lookup.data,n),n&&a[0].selectedIndex<0&&(l.oldValue="old",a.trigger("change")),l.settingFocus=!1)}});a.on("change",function(n){var t=a.val(),i;t!==l.oldValue&&((t==-1||t=="")&&(t=null),i={newValue:t,propertyName:l.getName()},l.fireValueChanged(i),i=null);n.stopPropagation()});if(v)v.on(t.Events.onClick,function(n){v.w2overlay(y.clone(!0));n.stopPropagation()});if(y)y.on(t.Events.onTouchStartOrClick,"LI",function(i){var r=n(i.target).data("action"),u,e,f,s;if(r==t.Actions.preference)u=new t.ValuePreference(l.mField,l.getValue(),l.getDisplay()),u!=null&&u.showDialog(),u=null;else if(r==t.Actions.refresh){if(o==null)return;l.settingFocus=!0;e=a.val();l.lookup.refresh();l.lookup.getIsValidated()?l.lookup.fillCombobox(l.getIsMandatory(),!1,!1,!1):l.lookup.fillCombobox(l.getIsMandatory(),!0,!1,!1);l.refreshOptions(l.lookup.data,e);l.settingFocus=!1}else r==t.Actions.contact?(f=l.getValue(),f&&f.toString().length>0&&(s=new t.ContactInfo(f,l.mField.getWindowNo()),s.show())):r==t.Actions.zoom&&(w||d())});this.disposeComponent=function(){a.off("focus");a.off("change");v&&(v.off(t.Events.onClick),v.remove());v=null;y&&y.remove();y=null;this.lookup=null;this.lastDisplay=null;this.settingFocus=null;this.inserting=null;this.settingValue=null;a=null;l=null}}function p(r,u,f,e,o){var c="date",h,s;o==t.DisplayType.Time&&(c="time");o==t.DisplayType.DateTime&&(c="datetime-local");h=n("<input>",{type:c,name:r});i.call(this,h,o,f,r,u);f||!e?this.setReadOnly(!0):this.setReadOnly(!1);s=this;h.on("change",function(n){var t,i;n.stopPropagation();t=s.getValue();s.oldValue=t;i={newValue:t,propertyName:s.getName()};s.fireValueChanged(i);i=null});this.disposeComponent=function(){h.off("change");s=null;h=null}}function o(r,u,f,o,s,h,c){function ft(){var i,r,u,e,o,f,s;if(l.lookup&&!d){if(i=l.lookup.getZoomQuery(),r=l.getValue(),r==null,r==""&&(r=null),i==null||n.isEmptyObject(i)||r!=null){if(i=new t.Query,u=null,l.lookup!=null&&l.lookup instanceof t.MLookup&&(e=l.lookup.getAD_Reference_Value_ID(),e!=0)){o="SELECT kc.ColumnName FROM AD_Ref_Table rt INNER JOIN AD_Column kc ON (rt.Column_Key_ID=kc.AD_Column_ID)WHERE rt.AD_Reference_ID="+e;try{f=t.DB.executeDataReader(o);f.read()&&(u=f.getString(0));f.dispose()}catch(h){this.log.log(t.Logging.Level.SEVERE,o,h)}}u!=null&&u.length!=0?i.addRestriction(u,t.Query.prototype.EQUAL,r):i.addRestriction(l.getColumnName(),t.Query.prototype.EQUAL,r);i.setRecordCount(1)}s=0;s=l.mField!=null&&l.mField.getZoomWindow_ID()>0?l.mField.getZoomWindow_ID():l.lookup.getZoomWindow(i);t.viewManager.startWindow(s,i)}}var tt,it,rt,ut,l;s||(s=t.DisplayType.Search);this.lookup=h;this.isMultiKeyTextBox=s===t.DisplayType.MultiKey;this.value=null;tt=null;it=null;this.infoMultipleIds=null;rt=null;this.log=t.Logging.VLogger.getVLogger("VTextBoxButton");var g=1113,nt=1113,b=t.Application.contextUrl+"Areas/VIS/Images/base/";s==t.DisplayType.Location||s==t.DisplayType.MultiKey?b+=this.isMultiKeyTextBox?"PickOpen20.png":"Location10.png":s==t.DisplayType.Locator?b+="Locator10.png":s==t.DisplayType.Search&&(b+=r.equals("C_BPartner_ID")||r.equals("C_BPartner_To_ID")&&h.getColumnName().equals("C_BPartner.C_BPartner_ID")?"BPartner20.png":r.equals("M_Product_ID")||r.equals("M_Product_To_ID")&&h.getColumnName().equals("M_Product.M_Product_ID")?"Product20.png":"PickOpen20.png");var k=0,y=n("<input >",{type:"text",name:r}),p=n('<button  tabindex="-1" class="vis-controls-txtbtn-table-td2"><img  tabindex="-1" src="'+b+'" /><\/button>');k+=1;var a=null,w=null,v={},d=!1;h==null||this.isMultiKeyTextBox||(h instanceof t.MLookup&&h.getZoomWindow()==0&&c<1&&(d=!0),v[t.Actions.zoom]=d,a=n('<button  tabindex="-1" class="vis-controls-txtbtn-table-td2"><img tabindex="-1" src="'+t.Application.contextUrl+'Areas/VIS/Images/base/Info20.png" /><\/button>'),ut=!1,r==="C_BPartner_ID"&&(v[t.Actions.add]=!0,v[t.Actions.update]=!0),(this.lookup&&(this.lookup.info.keyColumn.toLowerCase()=="ad_user.ad_user_id"||this.lookup.info.keyColumn.toLowerCase()=="ad_user_id")||r==="AD_User_ID"||r==="SalesRep_ID")&&(v[t.Actions.contact]=!0),t.MRole.getIsShowPreference()&&(v[t.Actions.preference]=!0),v[t.Actions.refresh]=!0,v[t.Actions.remove]=!0,w=t.AEnv.getContextPopup(v),k+=1,v=null);this.isMultiKeyTextBox&&(a=n('<button  tabindex="-1" class="vis-controls-txtbtn-table-td2"><img  tabindex="-1" src="'+t.Application.contextUrl+'Areas/VIS/Images/clear16.png" /><\/button>'),k+=1);l=this;i.call(this,y,s,f,r,u);this.setReadOnly=function(n){this.isReadOnly=n;y.prop("disabled",n?!0:!1);n?p.css("opacity",.7):p.css("opacity",1)};y.on("keydown",function(n){(n.keyCode==13||n.keyCode==9)&&l.actionText()&&(n.stopPropagation(),n.preventDefault())});this.actionText=function(){var i=y.val().trim(),r;if(t.context.setContext(l.lookup.windowNo,"AttrCode",i),i!=null&&i.indexOf("(01)")>=0&&(r=i,r.indexOf("(10)")>=0&&(r=r.substring(0,r.indexOf("(10)"))),r.indexOf("(17)")>=0&&(r=r.substring(0,r.indexOf("(17)"))),r=r.replace("(01)",""),i=r),i==null||i.length==0||i.equals("%"))return l.openSearchForm(),!0;i=i.toUpper();var u=-3,f=null,n=null,o=t.Msg.parseTranslation(t.context,l.getDirectAccessSQL(i));try{if(n=t.DB.executeReader(o),n.read()){try{f=parseInt(n.get(0))}catch(s){f=n.get(0)}u=1;n.read()&&(u=-1,f=null)}n.close();n=null}catch(h){n!=null&&n.close();n=null;this.log.log(t.Logging.Level.SEVERE,e);u=-2}if(u==-3&&!i.endsWith("%")){i+="%";o=t.Msg.parseTranslation(t.context,l.getDirectAccessSQL(i));try{if(n=t.DB.executeReader(o),n.read()){try{f=parseInt(n.get(0))}catch(c){f=n.get(0)}u=1;n.read()&&(f=null,u=-1)}n.close()}catch(a){n!=null&&n.close();n=null;this.log.log(t.Logging.Level.SEVERE,e);u=-2}}return u<0&&f==null?(rt={},l.openSearchForm(),!0):(i="",l.setValue(f,!0,!0),!1)};this.getDirectAccessSQL=function(n){var i=l.getDirectAccessSQL1(t.context,r,h,n);return tt=i[1],it=i[2],i[0]};this.getDirectAccessSQL1=function(n,i,r,u){var f="",o=[],s=i.substring(0,i.length-3),c=i,v,e,w,k,d,tt,p,h,y,a;if(i.equals("M_Product_ID")?(n.setContext(g,nt,"M_Product_ID","0"),n.setContext(g,nt,"M_AttributeSetInstance_ID","0"),n.setContext(g,nt,"M_Locator_ID","0"),f+="SELECT DISTINCT p.M_Product_ID FROM M_Product p LEFT OUTER JOIN M_Manufacturer mr ON (p.M_Product_ID=mr.M_Product_ID) LEFT OUTER JOIN M_ProductAttributes patr ON (p.M_Product_ID=patr.M_Product_ID) WHERE (UPPER(p.Value) LIKE "+t.DB.to_string(u)+" OR UPPER(p.Name) LIKE "+t.DB.to_string(u)+" OR mr.UPC LIKE "+t.DB.to_string(u)+" OR patr.UPC LIKE "+t.DB.to_string(u)+" OR p.UPC LIKE "+t.DB.to_string(u)+")"):i.equals("C_BPartner_ID")?(f+="SELECT C_BPartner_ID FROM C_BPartner WHERE (UPPER(Value) LIKE ",f+=t.DB.to_string(u)+" OR UPPER(Name) LIKE "+t.DB.to_string(u)+")"):i.equals("C_Order_ID")?(f+="SELECT C_Order_ID FROM C_Order WHERE UPPER(DocumentNo) LIKE ",f+=t.DB.to_string(u)):i.equals("C_Invoice_ID")?(f+="SELECT C_Invoice_ID FROM C_Invoice WHERE UPPER(DocumentNo) LIKE ",f+=t.DB.to_string(u)):i.equals("M_InOut_ID")?(f+="SELECT M_InOut_ID FROM M_InOut WHERE UPPER(DocumentNo) LIKE ",f+=t.DB.to_string(u)):i.equals("C_Payment_ID")?(f+="SELECT C_Payment_ID FROM C_Payment WHERE UPPER(DocumentNo) LIKE ",f+=t.DB.to_string(u)):i.equals("GL_JournalBatch_ID")?(f+="SELECT GL_JournalBatch_ID FROM GL_JournalBatch WHERE UPPER(DocumentNo) LIKE ",f+=t.DB.to_string(u)):i.equals("SalesRep_ID")&&(f+="SELECT AD_User_ID FROM AD_User WHERE UPPER(Name) LIKE ",f+=t.DB.to_string(u),s="AD_User",c="AD_User_ID"),f.length>0)return v=l.getWhereClause(n,i,r),i.equals("M_Product_ID")?v!=null&&v.length>0&&(f+=" AND "+v.replace(/M_Product\./g,"p.")+" AND p.IsActive='Y'"):v!=null&&v.length>0&&(f+=" AND "+v+" AND IsActive='Y'"),o.push(t.MRole.getDefault().addAccessSQL(f,s,t.MRole.SQL_FULLYQUALIFIED,t.MRole.SQL_RO)),o.push(s),o.push(c),o;if(e=null,r!=null&&r instanceof t.MLookup&&(w=r.getAD_Reference_Value_ID(),w!=0)){k="SELECT Columnname, tbl.TableName FROM AD_Column clm INNER JOIN AD_Table tbl ON (tbl.AD_Table_ID = clm.AD_Table_ID) WHERE AD_Column_ID =  (SELECT Column_Key_ID FROM AD_Ref_Table WHERE AD_Reference_ID = @refid)";try{for(h=[],h[0]=new t.DB.SqlParam("@refid",w),e=t.DB.executeReader(k,h);e.read();){i=e.get(0);c=e.get(0);s=e.get(1);break}e.close();e=null}catch(b){e!=null&&(e.close(),e=null);this.log.log(t.Logging.Level.SEVERE,p,b)}d=" SELECT  tbl.tablename, clm.Columnname FROM (  SELECT kc.ColumnName, dc.ColumnName as ColName1, t.TableName,  t.AD_Table_ID  FROM AD_Ref_Table rt INNER JOIN AD_Column kc ON (rt.Column_Key_ID=kc.AD_Column_ID) INNER JOIN AD_Column dc ON (rt.Column_Display_ID=dc.AD_Column_ID) INNER JOIN AD_Table t ON (rt.AD_Table_ID=t.AD_Table_ID) WHERE rt.AD_Reference_ID=@refid ) rr  INNER JOIN AD_Table tbl  ON (tbl.AD_Table_ID = rr.AD_Table_ID)  INNER JOIN AD_Column clm  ON (clm.AD_Table_ID      = tbl.AD_Table_ID)  WHERE (clm.ColumnName   IN ('DocumentNo', 'Value', 'Name')  OR clm.IsIdentifier      ='Y')  AND clm.AD_Reference_ID IN (10,14)  AND EXISTS  (SELECT *  FROM AD_Column cc WHERE cc.AD_Table_ID=tbl.AD_Table_ID  AND cc.IsKey ='Y' AND cc.ColumnName = @colname)";tt=null;c=i;f="(";try{for(h=[],h[0]=new t.DB.SqlParam("@refid",w),h[1]=new t.DB.SqlParam("@colname",i),e=t.DB.executeReader(d,h);e.read();)f.length>1&&(f+=" OR "),s=e.get(0),f+="UPPER("+e.get(1)+") LIKE "+t.DB.to_string(u);f+=")";e.close();e=null}catch(b){e!=null&&(e.close(),e=null);this.log.log(t.Logging.Level.SEVERE,p,b)}return f.length==0?(this.log.log(t.Logging.Level.SEVERE,i+" (TableDir) - no standard/identifier columns"),o.push(""),o.push(s),o.push(c),o):(y="SELECT "+i+" FROM "+s+" WHERE "+f+" AND IsActive='Y'",a=l.getWhereClause(n,i,r),a!=null&&a.length>0&&(y+=" AND "+a),o.push(t.MRole.getDefault().addAccessSQL(y,s,t.MRole.SQL_NOTQUALIFIED,t.MRole.SQL_RO)),o.push(s),o.push(c),o)}p="SELECT t.TableName, c.ColumnName FROM AD_Column c  INNER JOIN AD_Table t ON (c.AD_Table_ID=t.AD_Table_ID AND t.IsView='N') WHERE (c.ColumnName IN ('DocumentNo', 'Value', 'Name') OR c.IsIdentifier='Y') AND c.AD_Reference_ID IN (10,14) AND EXISTS (SELECT * FROM AD_Column cc WHERE cc.AD_Table_ID=t.AD_Table_ID AND cc.IsKey='Y' AND cc.ColumnName=@colname)";c=i;f="(";try{for(h=[],h[0]=new t.DB.SqlParam("@colname",c),e=t.DB.executeReader(p,h);e.read();)f.length>1&&(f+=" OR "),s=e.get(0),f+="UPPER("+e.get(1)+") LIKE "+t.DB.to_string(u);f+=")";e.close();e=null}catch(b){e!=null&&(e.close(),e=null);this.log.log(t.Logging.Level.SEVERE,p,b)}return f.length==0?(this.log.log(t.Logging.Level.SEVERE,i+" (TableDir) - no standard/identifier columns"),o.push(""),o.push(s),o.push(c),o):(y="SELECT "+i+" FROM "+s+" WHERE "+f+" AND IsActive='Y'",a=l.getWhereClause(n,i,r),a!=null&&a.length>0&&(y+=" AND "+a),o.push(t.MRole.getDefault().addAccessSQL(y,s,t.MRole.SQL_NOTQUALIFIED,t.MRole.SQL_RO)),o.push(s),o.push(c),o)};this.getWhereClause=function(n,i,r){var u="",f,e;try{if(r==null)return"";if(r.getZoomQuery()!=null&&(u=r.getZoomQuery().getWhereClause()),f=r.getValidation(),f==null&&(f=""),u.length==0?u=f:f.length>0&&(u+=" AND "+f),u.indexOf("@")!=-1&&(e=t.Env.parseContext(n,r.getWindowNo(),u,!1),e.length!=0))return e}catch(o){}return u};f||!o?this.setReadOnly(!0):this.setReadOnly(!1);this.getBtnCount=function(){return k};this.getBtn=function(n){return n==0?p:n==1&&a?a:void 0};this.setVisible=function(n){this.visible=n;n?(y.css("visibility","visible"),a&&a.show(),p.show()):(y.css("visibility","hidden"),a&&a.hide(),p.hide())};this.openSearchForm=function(){var f=y.val().trim(),u,s,i,b,c;if((typeof f=="object"&&(f=""),!l.isReadOnly)&&l.lookup!=null){if(u=0,s=l.getWhereClause(t.Env.getCtx(),r,l.lookup),l.getField()!=null&&(u=l.getField().getAD_InfoWindow_ID()),i=null,u!=0)i=new t.InfoWindow(u,f,l.lookup.windowNo,s,l.isMultiKeyTextBox);else{var e=e,h=r,o=null,n=null,a=0,v=0,p=0,w=l.lookup.getAD_Reference_Value_ID();if(w>0){o="SELECT kc.ColumnName, dc.ColumnName, t.TableName FROM AD_Ref_Table rt INNER JOIN AD_Column kc ON (rt.Column_Key_ID=kc.AD_Column_ID) INNER JOIN AD_Column dc ON (rt.Column_Display_ID=dc.AD_Column_ID) INNER JOIN AD_Table t ON (rt.AD_Table_ID=t.AD_Table_ID) WHERE rt.AD_Reference_ID="+w;b=null;try{for(n=t.DB.executeDataReader(o);n.read();)h=n.getString(0),b=n.getString(1),e=n.getString(2);n.close();n=null}catch(k){n!=null&&(n.close(),n=null)}}else e=String(r).substr(0,r.length-3),h=r;if(h.equals("M_Product_ID"))o="SELECT AD_Window_ID FROM AD_Window WHERE Name = '"+t.context.getContext(l.lookup.windowNo,"WindowName")+"'",p=t.DB.executeScalar(o),a=window.DTD001&&p==170?t.context.getContextAsInt(l.lookup.windowNo,"DTD001_MWarehouseSource_ID"):t.context.getContextAsInt(l.lookup.windowNo,"M_Warehouse_ID"),v=t.context.getContextAsInt(l.lookup.windowNo,"M_PriceList_ID"),c=!1,l.lookup.windowNo>0&&(c=t.context.getWindowTabContext(l.lookup.windowNo,1,"KeyColumnName")=="C_OrderLine_ID"||t.context.getWindowTabContext(l.lookup.windowNo,1,"KeyColumnName")=="C_InvoiceLine_ID"||t.context.getWindowTabContext(l.lookup.windowNo,1,"KeyColumnName")=="M_InOutLine_ID"||t.context.getWindowTabContext(l.lookup.windowNo,1,"KeyColumnName")=="M_PackageLine_ID"||t.context.getWindowTabContext(l.lookup.windowNo,1,"KeyColumnName")=="M_MovementLine_ID"||t.context.getWindowTabContext(l.lookup.windowNo,1,"KeyColumnName")=="M_InventoryLine_ID"||t.context.getWindowTabContext(l.lookup.windowNo,1,"KeyColumnName")=="M_ProductPrice_ID"||t.context.getWindowTabContext(l.lookup.windowNo,1,"KeyColumnName")=="C_ProjectLine_ID"||t.context.getWindowTabContext(l.lookup.windowNo,1,"KeyColumnName")=="SAP001_StockTransferLine_ID"),i=new t.infoProduct(!0,l.lookup.windowNo,a,v,f,e,h,c,s);else{for(o="SELECT AD_InfoWindow_ID FROM AD_InfoWindow WHERE AD_Table_ID = (SELECT AD_Table_ID FROM AD_Table WHERE TableName='"+e+"') AND IsActive='Y'",n=t.DB.executeDataReader(o);n.read();){u=n.getString(0);break}n.close();n=null;i=u>0?new t.InfoWindow(u,f,l.lookup.windowNo,s,l.isMultiKeyTextBox):new t.infoGeneral(!0,l.lookup.windowNo,f,e,h,l.isMultiKeyTextBox,s)}}i.onClose=function(){var n,r;if(n=i.getSelectedValues(),l.isMultiKeyTextBox){for(var u="",t=0,f=0,t=0,f=n.length;t<f;t++){if(u.length==0){u+=n[t];continue}u+=","+n[t]}l.setValue(u,!1,!0)}else r=null,i.getRefreshStatus&&i.getRefreshStatus()?l.fireRefreshUI():(n!=null&&n.length==1?r=n[0]:(InfoMultipleIds=null,n.length>1&&(r=n[0])),r!=null&&l.setValue(r,!1,!0));i=null};i.show()}};p.on(t.Events.onClick,l.openSearchForm);if(a)a.on(t.Events.onClick,function(n){if(l.isMultiKeyTextBox){var t=l.getValue();t&&t.toString().length>0&&l.setValue(null,!1,!0)}else a.w2overlay(w.clone(!0));n.stopPropagation()});if(w)w.on(t.Events.onTouchStartOrClick,"LI",function(i){var u=n(i.target).data("action"),f,r,e;if(u==t.Actions.zoom){if(d)return;ft()}else if(u==t.Actions.preference)f=new t.ValuePreference(l.mField,l.getValue(),l.getDisplay()),f!=null&&f.showDialog(),f=null;else if(u==t.Actions.refresh){if(!l.lookup||l.isReadOnly)return;l.lookup.refresh()}else if(u==t.Actions.add)r=l.getValue(),t.AddUpdateBPartner(l.mField.getWindowNo(),0,t.Msg.getMsg("Customer"),null,0,0);else if(u==t.Actions.update)r=l.getValue(),r&&r.toString().length>0&&t.AddUpdateBPartner(l.mField.getWindowNo(),r,t.Msg.getMsg("Customer"),null,0,0);else if(u==t.Actions.contact)r=l.getValue(),r&&r.toString().length>0&&(e=new t.ContactInfo(r,l.mField.getWindowNo()),e.show());else if(u==t.Actions.remove){if(l.isReadOnly)return;l.setValue(null,!1,!0)}});this.disposeComponent=function(){p.off(t.Events.onClick);a&&a.off(t.Events.onClick);w&&w.off(t.Events.onTouchStartOrClick);w=null;l=null;y=null;p=null;a=null;this.getBtn=null;this.setVisible=null}}function d(r,u,f,e,o,s,h){var l=7,c,a;if(h!=t.DisplayType.Memo)h==t.DisplayType.TextLong?(l=7,s=2e4):l=s<300?3:s<2e3?5:7;else try{l=s<300?3:s<2e3?5:s/500}catch(v){l=s<300?3:s<2e3?5:7}c=n("<textarea>",{name:r,maxlength:s,rows:l});i.call(this,c,h,f,r,u);f||!e?this.setReadOnly(!0):this.setReadOnly(!1);a=this;c.on("change",function(n){var t,i;n.stopPropagation();t=c.val();t!==a.oldValue&&(i={newValue:t,propertyName:a.getName()},a.fireValueChanged(i),i=null)});this.disposeComponent=function(){c.off("change");c=null;a=null}}function h(r,u,f,e,o,s,h){var v=h,a=s,c=n("<input>",{type:"number",step:"any",name:r,maxlength:a}),l;i.call(this,c,v,f,r,u);this.format=t.DisplayType.GetNumberFormat(v);f||!e?this.setReadOnly(!0):this.setReadOnly(!1);l=this;c.on("keydown",function(n){return n.keyCode==189||n.keyCode==109||n.keyCode==173?n.keyCode==189&&this.value.length==0?!0:(this.value=Number(this.value*-1),setTimeout(function(){c.trigger("change")},100),!1):n.shiftKey?!1:n.keyCode>=37&&n.keyCode<=40||n.keyCode==8||n.keyCode==9||n.keyCode==16||n.keyCode==17||n.keyCode==35||n.keyCode==36||n.keyCode==46?!0:n.keyCode>=48&&n.keyCode<=57&&n.shiftKey==!1||n.keyCode>=96&&n.keyCode<=105&&n.shiftKey==!1?this.value.length>=a?!1:!0:n.keyCode==189||n.keyCode==109||n.keyCode==173?(this.value=this.value*-1,!1):n.keyCode==190||n.keyCode==110?(this.value.indexOf(".")>-1&&(this.value=this.value.replace(".","")),this.value.length>=a)?!1:!0:n.keyCode==188?!1:!1});c.on("change",function(n){var t,i;n.stopPropagation();t=l.getValue();this.value=t;t!==l.oldValue&&(i={newValue:t,propertyName:l.getName()},l.fireValueChanged(i),i=null)});this.disposeComponent=function(){c.off("keydown");c.off("change");c=null;l=null;this.format.dispose();this.format=null;a=null}}function w(r,u,f,e,o,s){var a=t.DisplayType.Integer,l=s,c=n("<input>",{type:"text",name:r,maxlength:l}),h;i.call(this,c,a,f,r,u);this.format=t.DisplayType.GetNumberFormat(a);f||!e?this.setReadOnly(!0):this.setReadOnly(!1);h=this;c.on("keydown",function(n){if(n.keyCode==189||n.keyCode==109||n.keyCode==173)return n.keyCode==189&&this.value.length==0?!0:(this.value=Number(this.value*-1),setTimeout(function(){c.trigger("change")},100),!1);if(n.shiftKey)return!1;if(n.keyCode>=37&&n.keyCode<=40||n.keyCode==8||n.keyCode==9||n.keyCode==16||n.keyCode==17||n.keyCode==35||n.keyCode==36||n.keyCode==46)return!0;if(this.value<0){if(this.value.length>t.DisplayType.INTEGER_DIGITS&&n.keyCode!=8&&n.keyCode!=9&&n.keyCode!=46)return!1}else if(this.value.length>=t.DisplayType.INTEGER_DIGITS&&n.keyCode!=8&&n.keyCode!=9&&n.keyCode!=46)return!1;return n.keyCode>=48&&n.keyCode<=57&&n.shiftKey==!1||n.keyCode>=96&&n.keyCode<=105&&n.shiftKey==!1?this.value.length>=l?!1:!0:!1});c.on("change",function(n){var t,i,r;n.stopPropagation();t=h.getValue();t=Globalize.parseInt(t.toString());i=Number(h.format.GetFormatedValue(t));t!=i&&(h.mField.setValue(null),t=i);t!==h.oldValue&&(r={newValue:t,propertyName:h.getName()},h.fireValueChanged(r),r=null)});this.disposeComponent=function(){c.off("keydown");c.off("change");c=null;h=null;this.format.dispose();this.format=null;l=null}}function b(r,u,f,e,o,s){o||(o=t.DisplayType.Location);this.lookup=s;this.lastDisplay="";this.settingFocus=!1;this.inserting=!1;this.settingValue=!1;this.value=null;var a=n("<input readonly>",{type:"text",name:r}),c=n('<button class="vis-controls-txtbtn-table-td2"><img src="'+t.Application.contextUrl+'Areas/VIS/Images/base/ToLink20.png" /><\/button>'),l=n('<button class="vis-controls-txtbtn-table-td2"><img src="'+t.Application.contextUrl+'Areas/VIS/Images/base/Location20.png" /><\/button>'),v=2,h=this;i.call(this,a,o,f,r,u);f||!e?this.setReadOnly(!0):this.setReadOnly(!1);this.getBtn=function(n){return n==0?c:n==1?l:void 0};this.getBtnCount=function(){return v};this.setVisible=function(n){this.visible=n;n?(a.show(),c.show(),l.show()):(a.hide(),c.hide(),l.hide())};c.on(t.Events.onClick,function(n){var t="http://local.google.com/maps?q="+h.getDisplay();window.open(t);n.stopPropagation()});l.on(t.Events.onClick,function(n){n.stopPropagation();var i=new t.LocationForm(h.value);i.load();i.showDialog();i.onClose=function(n,t){if(t){h.oldValue=0;h.lookup.refreshLocation(n);h.setValue(n);var i={newValue:n,propertyName:h.getColumnName()};h.fireValueChanged(i);i=null}};i=null});this.disposeComponent=function(){c.off(t.Events.onClick);l.off(t.Events.onClick);h=null;a=null;c=null;l=null;this.setVisible=null}}function f(r,u,f,e,o,s){var v;this.mandatory=u;this.onlyWarehouseId=0;this.onlyProductId=0;this.onlyOutgoing=null;this.windowNum=s.getWindowNo();this.columnName=r;this.lookup=s;v=t.Application.contextUrl+"Areas/VIS/Images/base/Locator20.png";this.value=null;o||(o=t.DisplayType.Locator);var a=n("<input readonly>",{type:"text",name:r}),c=n('<button class="vis-controls-txtbtn-table-td2"><img src="'+v+'" /><\/button>'),l=n('<button class="vis-controls-txtbtn-table-td2"><img src="'+t.Application.contextUrl+'Areas/VIS/Images/base/Zoom20.png" /><\/button>'),y=2,h=this;i.call(this,a,o,f,r,u);this.getBtnCount=function(){return y};this.getBtn=function(n){return n==0?c:n==1?l:void 0};this.setVisible=function(n){this.visible=n;n?(a.show(),c.show(),l.show()):(c.hide(),l.hide(),a.hide())};c.on(t.Events.onClick,function(n){n.stopPropagation();var t=h.getOnlyWarehouseID(),i=h.getOnlyProductID();h.showLocatorForm(t,i)});l.on(t.Events.onClick,function(n){var i,r,u,e,o,f,s;if(n.stopPropagation(),h.lookup){if(i=h.lookup.getZoomQuery(),r=h.getValue(),r==null,r==""&&(r=null),i==null||r!=null){if(i=new t.Query,u=null,h.lookup!=null&&h.lookup instanceof t.MLookup&&(e=h.lookup.getAD_Reference_Value_ID(),e!=0)){o="SELECT kc.ColumnName FROM AD_Ref_Table rt INNER JOIN AD_Column kc ON (rt.Column_Key_ID=kc.AD_Column_ID)WHERE rt.AD_Reference_ID="+e;try{f=t.DB.executeDataReader(o);f.read()&&(u=f.getString(0));f.dispose()}catch(n){this.log.log(t.Logging.Level.SEVERE,o,n)}}u!=null&&u.length!=0?i.addRestriction(u,t.Query.prototype.EQUAL,r):i.addRestriction(h.getColumnName(),t.Query.prototype.EQUAL,r);i.setRecordCount(1)}s=0;s=h.mField.getZoomWindow_ID()>0?h.mField.getZoomWindow_ID():h.lookup.getZoomWindow(i);t.viewManager.startWindow(s,i)}});this.disposeComponent=function(){c.off(t.Events.onClick);l.off(t.Events.onClick);h=null;a=null;c=null;this.getBtn=null;this.setVisible=null}}function u(r,u,f,e,o,s,h,c,l,a,v){function tt(n){var i=t.Env.getCtx().getContextAsInt(y.windowNo,"C_GenAttributeSetInstance_ID"),r;y.isFromActivityForm&&(i=y.C_GenAttributeSetInstance_ID);i==0;r=new t.GenralAttributeForm(i,n,y.windowNo,y.isSearch,y.getCanSaveRecord(),y.isFromDMS);r.showDialog();r.onClose=function(n,i,r){t.Env.getCtx().setContext(h,"C_GenAttributeSetInstance_ID",n);b(n,i);r!=null&&(y.setInstanceIDs=r);y.getControl().val(i)}}function b(n){if(y.log.finest("Changed M_AttributeSetInstance_ID="+n),y.oldValue!=n){n==0&&y.setValue(null);y.setValue(n);var t={newValue:n,propertyName:y.colName};y.fireValueChanged(t);t=null}}function it(i){var u=i==null?0:i,r=t.Env.getCtx().getContextAsInt(h,"M_Product_ID"),e=t.Env.getCtx().getContextAsInt(h,"M_ProductBOM_ID"),c=t.Env.getCtx().getContextAsInt(h,"M_Locator_ID"),f;y.log.config("M_Product_ID="+r+"/"+e+",M_AttributeSetInstance_ID="+u+", AD_Column_ID="+y.AD_Column_ID);var o=y.AD_Column_ID==8418,s=!0,l=!1;r!=0&&n.ajax({url:t.Application.contextUrl+"PAttributes/ExcludeEntry",dataType:"json",async:!1,data:{productId:r,adColumn:y.AD_Column_ID,windowNo:h},success:function(n){s=n.result}});e!=0&&(r=e);!o&&(r==0||s)?(l=!0,u=0,b(u)):(f=new t.PAttributesForm(u,r,c,y.C_BPartner_ID,o,y.AD_Column_ID,h),f.hasAttribute&&f.showDialog(),f.onClose=function(n,t,i){this.M_Locator_ID=i;b(n,t)})}var k,g,d;this.NO_INSTANCE=0;this.AD_Column_ID=0;k="M_AttributeSetInstance_ID";g=!1;this.C_GenAttributeSet_ID=0;this.C_GenAttributeSetInstance_ID=0;this.M_Locator_ID=0;k=r;this.value=null;this.windowNo=h;this.lookup=s;this.C_BPartner_ID=t.Env.getCtx().getContextAsInt(this.windowNo,"C_BPartner_ID");this.log=t.Logging.VLogger.getVLogger("VPAttribute");d=t.Application.contextUrl+"Areas/VIS/Images/base/PAttribute20.png";o||(o=t.DisplayType.PAttribute);this.isFromActivityForm=c;this.isSearch=l;this.isFromDMS=a;this.isPAttribute=v;this.canSaveRecord=!0;var w=n("<input >",{type:"text",name:r}),p=n('<button class="vis-controls-txtbtn-table-td2"><img src="'+d+'" /><\/button>'),nt=1,y=this;this.setInstanceIDs=null;i.call(this,w,o,f,r,u);f||!e?this.setReadOnly(!0):this.setReadOnly(!1);this.getBtnCount=function(){return nt};this.getBtn=function(n){if(n==0)return p};this.setVisible=function(n){this.visible=n;n?(w.show(),p.show()):(p.hide(),w.hide())};p.on(t.Events.onClick,function(n){var r,i;if(n.stopPropagation(),r=y.getValue(),!y.isPAttribute){if(i=0,i=t.Env.getCtx().getContextAsInt(y.windowNo,"C_GenAttributeSet_ID"),i==0&&(i=y.C_GenAttributeSet_ID,i==0)){t.ADialog.info("NoAttributeSet",null,null,null);return}tt(i,r);return}it(r)});this.SetC_GenAttributeSet_ID=function(n){this.C_GenAttributeSet_ID=n};this.disposeComponent=function(){p.off(t.Events.onClick);y=null;w=null;p=null;this.getBtn=null;this.setVisible=null;this.value=null;this.lookup=null}}function k(r,u,f,e,o,s,h,c){var y,p;this.value=null;this.windowNo=h;this.lookup=s;this.title=c;y=r;p=t.Application.contextUrl+"Areas/VIS/Images/base/Account20.png";o||(o=t.DisplayType.PAttribute);var v=n("<input readonly>",{type:"text",name:r}),a=n('<button class="vis-controls-txtbtn-table-td2"><img src="'+p+'" /><\/button>'),w=1,l=this;i.call(this,v,o,f,r,u);this.getBtnCount=function(){return w};this.getBtn=function(n){if(n==0)return a};this.setVisible=function(n){this.visible=n;n?(v.show(),a.show()):(v.hide(),a.hide())};a.on(t.Events.onClick,function(n){n.stopPropagation();var r=t.Env.getCtx().getContextAsInt(l.windowNo,"C_AcctSchema_ID"),i=new t.AccountForm(l.title,l.lookup,r);i.load();i.showDialog();i.onClose=function(n){if(l.oldValue!=n){l.setValue(n);var t={newValue:n,propertyName:y};l.fireValueChanged(t);t=null}};i=null});this.disposeComponent=function(){a.off(t.Events.onClick);l=null;v=null;a=null;this.getBtn=null;this.setVisible=null;this.value=null;this.lookup=null;this.value=null;this.windowNo=null;this.title=null}}function c(r,u,f,e){var s;this.values=null;this.log=t.Logging.VLogger.getVLogger("VImage");var a=e,l=r,h=n("<img style='width: 20px;height: 20px;'>"),o=n("<span>").text("-"),c=null;c=n("<button>",{type:"button",name:l});o.css("color","blue");c.append(h).append(o);i.call(this,c,t.DisplayType.Button,f,l,u);f?this.setReadOnly(!0):this.setReadOnly(!1);s=this;c.on(t.Events.onClick,function(n){if(n.stopPropagation(),!s.isReadOnly){var i=new t.VImageForm(s.getValue(),o.text().trim().length);i.showDialog();i.onClose=function(n,t){if(t&&(s.oldValue=0,s.oldValue!=n)){s.setValue(n);var i={newValue:n,propertyName:l};s.fireValueChanged(i,!0);i=null}};i=null}});this.setText=function(n){var t,i;if(n==null){o.text("");h.image.src="";return}t=n.indexOf("&");t!=-1&&(i=n.toUpperCase().charAt(t+1),i!=" "&&(n=n.substring(0,t)+n.substring(t+1)));o.text(n)};this.setIcon=function(n){n!=null?(h.attr("src","data:image/jpg;base64,"+n),h.show(),o.text("")):(h.attr("src","data:image/jpg;base64,"+n),h.hide(),o.text("-"))};this.disposeComponent=function(){c.off(t.Events.onClick);c=null;this.log=null;a=null;h=null;o=null;this.setText=null;this.setIcon=null;s=null}}function l(r,u,f,e,o){function b(){var i=n("<ul class='vis-apanel-rb-ul'>");return i.append(n("<a id='link' style='border-bottom: 1px solid #CCDADE;color: #535353;font-size: 12px;display: block;margin-bottom: 8px;'  href='javascript:void(0)'>"+t.Msg.getMsg("SaveTolocalFile")+"<\/a>")),i.append(n("<li data-action='"+y+"'>").text(t.Msg.getMsg("Open/LoadIntoDatabase"))),i}var l,s;this.values=null;var a=n("<span>").text(""),w=o,v=r,h=null,c=null,p="SaveTolocalFile",y="LoadIntoDatabase";if(this.data=null,l=n("<input type='file' class='file' name='file'/>"),h=n("<button>",{type:"button",name:v}),h.append(a),i.call(this,h,t.DisplayType.Button,f,v,u),f||!e?this.setReadOnly(!0):this.setReadOnly(!1),s=this,c=b(),c){c.on(t.Events.onTouchStartOrClick,"LI",function(t){var i=n(t.target).data("action");i==p||i==y&&l.trigger("click")});c.on(t.Events.onTouchStartOrClick,"a",function(){if(s.getValue()!=null){var t=(new Date).toISOString().slice(0,19).replace(/-/g,""),i="data:;base64,"+s.getValue();n(this).attr("href",i).attr("download","file-"+t+".log")}})}l.change(function(){var t=l[0].files[0],n=new FileReader,i=n.readAsDataURL(t);n.onloadend=function(){var t=n.result.split(",")[1],i;s.oldValue!=t&&(s.setValue(t),i={newValue:t,propertyName:v},s.fireValueChanged(i,!0),i=null)};return});h.on(t.Events.onClick,function(n){s.isReadOnly||h.w2overlay(c.clone(!0));n.stopPropagation()});this.setText=function(n){var t,i;if(n==null){a.text("");return}t=n.indexOf("&");t!=-1&&(i=n.toUpperCase().charAt(t+1),i!=" "&&(n=n.substring(0,t)+n.substring(t+1)));a.text(n)};this.disposeComponent=function(){h.off(t.Events.onClick);h=null;this.setText=null;this.values=null;a=null;w=null;v=null;c=null;p=null;y=null;this.data=null;l=null;s=null}}function g(r,u,f,e,o,s){var c;this.value=null;var v=t.Application.contextUrl+"Areas/VIS/Images/base/Url20.png",a=0,h=n("<input>",{type:"text",name:r,maxlength:s}),l=n('<button class="vis-controls-txtbtn-table-td2"><img src="'+v+'" /><\/button>');a+=1;c=this;i.call(this,h,t.DisplayType.URL,f,r,u);f||!e?this.setReadOnly(!0):this.setReadOnly(!1);this.getBtnCount=function(){return a};this.getBtn=function(n){if(n==0)return l};this.setVisible=function(n){this.visible=n;n?(h.show(),l.show()):(h.hide(),l.hide())};l.on(t.Events.onClick,function(n){if(n.stopPropagation(),c.value!=null){var i=c.value.trim();if(i.length>0){i.contains("http://")||i.contains("https://")||(i="http://"+i);window.open(i);return}t.ADialog.warn("URLnotValid",!0,null)}});h.on("change",function(n){var t,i;n.stopPropagation();t=h.val();t!==c.oldValue&&(i={newValue:t,propertyName:c.getName()},c.fireValueChanged(i),i=null)});this.disposeComponent=function(){l.off(t.Events.onClick);h.off("change");c=null;h=null;l=null;this.getBtn=null;this.setVisible=null;this.value=null;v=null;a=null;this.getBtnCount=null;this.getBtn=null}}function a(r,u,f,e,o,s){var k=!1,w,y,s,b,p,d,l,v,h;s==s.FileName&&(k=!0);DialogType={OpenFile:0,SaveFile:1,Custom:2};SelectionType={FilesOnly:0,DirectoryOnly:1};w=SelectionType.DirectoryOnly;y=DialogType.Custom;this.log=t.Logging.VLogger.getVLogger("VFile");s=t.DisplayType.FileName;b=t.Application.contextUrl+"Areas/VIS/Images/base/Folder20.png";k&&(w=SelectionType.FilesOnly,b=t.Application.contextUrl+"Areas/VIS/Images/base/File20.png");p=r.toUpperCase();p.indexOf("open")!=-1||p.indexOf("load")!=-1?y=DialogType.OpenFile:p.indexOf("save")!=-1&&(y=DialogType.SaveFile);d=o;l=r;this.value=null;var g=0,c=n("<input>",{type:"text",name:l}),a=n('<button class="vis-controls-txtbtn-table-td2"><img src="'+b+'" /><\/button>');g+=1;v=n("<input type='file' class='file' name='file'/>");c.append(a);i.call(this,c,s,f,l,u);f||!e?this.setReadOnly(!0):this.setReadOnly(!1);this.getBtnCount=function(){return g};this.getBtn=function(n){if(n==0)return a};this.setVisible=function(n){this.visible=n;n?(c.show(),a.show()):(c.hide(),a.hide())};h=this;a.on(t.Events.onClick,function(i){var u,f,r;i.stopPropagation();w==SelectionType.DirectoryOnly?(r=new t.VisImportFiles(!0),r.onClose=function(n){h.setValue(n)},r.show()):y==DialogType.SaveFile?h.getValue()!=null&&(u=(new Date).toISOString().slice(0,19).replace(/-/g,""),f="data:;base64,"+h.getValue(),n(this).attr("href",f).attr("download","file-"+u+".log")):(r=new t.VisImportFiles(!1),r.onClose=function(){h.setValue(name)},r.show())});v.on("change",function(t){var i,r;t.stopPropagation();i=n(v).val().split("\\").pop();h.oldValue!=i&&(h.setValue(i),r={newValue:i,propertyName:l},h.fireValueChanged(r),r=null)});c.on("change",function(n){var t,i;n.stopPropagation();t=c.val();this.value=t;t!==h.oldValue&&(i={newValue:t,propertyName:h.getName()},h.fireValueChanged(i),i=null,h.setValue(t))});this.disposeComponent=function(){c.off(t.Events.onClick);c.off("change");v.off("change");c=null;d=null;l=null;v=null;h=null}}t.DisplayType={String:10,Integer:11,Amount:12,ID:13,Text:14,Date:15,DateTime:16,List:17,Table:18,TableDir:19,YesNo:20,Location:21,Number:22,Binary:23,Time:24,Account:25,RowID:26,Color:27,Button:28,Quantity:29,Search:30,Locator:31,Image:32,Assignment:33,Memo:34,PAttribute:35,TextLong:36,CostPrice:37,FilePath:38,FileName:39,URL:40,PrinterName:42,Label:44,MultiKey:45,GAttribute:46,IsString:function(n){return t.DisplayType.String==n},IsText:function(n){return n==t.DisplayType.String||n==t.DisplayType.Text||n==t.DisplayType.TextLong||n==t.DisplayType.Memo||n==t.DisplayType.FilePath||n==t.DisplayType.FileName||n==t.DisplayType.URL||n==t.DisplayType.PrinterName?!0:!1},IsLookup:function(n){return t.DisplayType.List==n||n==t.DisplayType.TableDir||n==t.DisplayType.Table||n==t.DisplayType.Search||n==t.DisplayType.MultiKey?!0:!1},IsInt:function(n){return n==t.DisplayType.Integer?!0:!1},IsSearch:function(n){return n==this.Search?!0:!1},IsID:function(n){return n==t.DisplayType.ID||n==t.DisplayType.Table||n==t.DisplayType.TableDir||n==t.DisplayType.Search||n==t.DisplayType.Location||n==t.DisplayType.Locator||n==t.DisplayType.Account||n==t.DisplayType.Assignment||n==t.DisplayType.PAttribute||n==t.DisplayType.Image||n==t.DisplayType.Color?!0:!1},IsNumeric:function(n){return n==t.DisplayType.Amount||n==t.DisplayType.Number||n==t.DisplayType.CostPrice||n==t.DisplayType.Integer||n==t.DisplayType.Quantity?!0:!1},IsDate:function(n){return n==t.DisplayType.Date||n==t.DisplayType.DateTime||n==t.DisplayType.Time?!0:!1},IsLOB:function(n){return n==t.DisplayType.Binary||n==t.DisplayType.TextLong?!0:!1},MAX_DIGITS:28,INTEGER_DIGITS:10,MAX_FRACTION:12,AMOUNT_FRACTION:2,GetNumberFormat:function(n){return n==this.Integer?new t.Format(this.INTEGER_DIGITS,0,0):n==this.Quantity?new t.Format(this.MAX_DIGITS,this.MAX_FRACTION,0):n==this.Amount?new t.Format(this.MAX_DIGITS,this.AMOUNT_FRACTION,this.AMOUNT_FRACTION):n==this.CostPrice?new t.Format(this.MAX_DIGITS,this.MAX_FRACTION,this.AMOUNT_FRACTION):new t.Format(this.MAX_DIGITS,this.MAX_FRACTION,1)}};t.VControlFactory={getControl:function(n,i,e,tt){var rt,ft,wt,bt,pt,ht,ct,lt,kt,dt,gt,ni,ti,ii,at,ri,ui,fi,vt,st;if(!i||(rt=i.getColumnName(),ft=i.getIsMandatory(!1),i.getIsHeading()))return null;var ei=i.getIsDisplayed(),ut=null,it=i.getDisplayType(),et=i.getIsReadOnly(),ot=i.getIsEditable(!1),yt=i.getWindowNo();return it==t.DisplayType.Button?(wt=new r(rt,ft,et,ot,i.getHeader(),i.getDescription(),i.getHelp(),i.getAD_Process_ID(),i.getIsLink(),i.getIsRightPaneLink()),wt.setField(i),ut=wt):it==t.DisplayType.String?(st=new v(rt,ft,et,ot,i.getDisplayLength(),i.getFieldLength(),i.getVFormat(),i.getObscureType(),i.getIsEncryptedField()),st.setField(i),ut=st):it==t.DisplayType.YesNo?(bt=new y(rt,ft,et,ot,i.getHeader(),i.getDescription()),bt.setField(i),ut=bt):t.DisplayType.IsDate(it)?(it==t.DisplayType.DateTime&&(readOnly=!0),pt=new p(rt,ft,et,ot,it,i.getHeader()),pt.setName(rt),pt.setField(i),ut=pt):t.DisplayType.IsLookup(it)||t.DisplayType.ID==it?(ht=i.getLookup(),tt&&ht!=null&&ht.disableValidation(),tt?ht==null||it!=t.DisplayType.Search&&ht.getDisplayType()!=t.DisplayType.Search?(ct=new s(rt,ft,et,ot,ht,i.getDisplayLength(),it,i.getZoomWindow_ID()),ct.setDisplayType(it),ct.setField(i),ut=ct):(it=t.DisplayType.Search,lt=new o(rt,ft,et,ot,it,ht,i.getZoomWindow_ID()),lt.setField(i),ut=lt):it!=t.DisplayType.Search&&it!=t.DisplayType.MultiKey?(ct=new s(rt,ft,et,ot,ht,i.getDisplayLength(),it,i.getZoomWindow_ID()),ct.setField(i),ut=ct):(lt=new o(rt,ft,et,ot,it,ht,i.getZoomWindow_ID()),lt.setField(i),ut=lt)):it==t.DisplayType.Location?(kt=new b(rt,ft,et,ot,it,i.getLookup()),kt.setField(i),ut=kt):it==t.DisplayType.Locator?(dt=new f(rt,ft,et,ot,it,i.getLookup()),dt.setField(i),ut=dt):t.DisplayType.Text==it||t.DisplayType.TextLong==it||t.DisplayType.Memo==it?(gt=new d(rt,ft,et,ot,i.getDisplayLength(),i.getFieldLength(),it),gt.setField(i),ut=gt):t.DisplayType.IsNumeric(it)?t.DisplayType.Amount==it||t.DisplayType.Quantity==it||t.DisplayType.CostPrice==it?(ni=new h(rt,ft,et,ot,i.getDisplayLength(),i.getFieldLength(),it,"FixedHeader"),ni.setField(i),ut=ni):t.DisplayType.Integer==it?(ti=new w(rt,ft,et,ot,i.getDisplayLength(),i.getFieldLength(),"FixedHeader"),ti.setField(i),ut=ti):t.DisplayType.Number==it&&(ii=new h(rt,ft,et,ot,i.getDisplayLength(),i.getFieldLength(),it,"FixedHeader"),ii.setField(i),ut=ii):it==t.DisplayType.PAttribute?(at=new u(rt,ft,et,ot,it,i.getLookup(),yt,!1,!1,!1,!0),at.setField(i),ut=at):it==t.DisplayType.GAttribute?(at=new u(rt,ft,et,ot,it,i.getLookup(),yt,!1,!1,!1,!1),at.setField(i),ut=at):it==t.DisplayType.Account?(ri=new k(rt,ft,et,ot,it,i.getLookup(),yt,i.getHeader()),ri.setField(i),ut=ri):it==t.DisplayType.Binary?(ui=new l(rt,ft,et,ot,yt),ui.setField(i),ut=ui):it==t.DisplayType.Image?(fi=new c(rt,ft,et,yt),fi.setField(i),ut=fi):it==t.DisplayType.URL?(vt=new g(rt,ft,et,ot,i.getDisplayLength(),i.getFieldLength()),vt.setField(i),ut=vt):it==t.DisplayType.FileName||it==t.DisplayType.FilePath?(vt=new a(rt,ft,et,ot,yt,it),vt.setField(i),ut=vt):it==t.DisplayType.Label&&(st=new nt(i.getHelp(),rt,!1,!0),st.setField(i),ut=st),ut==null&&(st=new v(rt,ft,et,ot,i.getDisplayLength(),i.getFieldLength(),i.getVFormat(),i.getObscureType(),i.getIsEncryptedField()),st.setField(i),ut=st),ut},getLabel:function(n){if(n==null)return null;var i=n.getDisplayType();return n.getIsFieldOnly()||i==t.DisplayType.YesNo||i==t.DisplayType.Button||i==t.DisplayType.Label?null:new t.Controls.VLabel(n.getHeader(),n.getColumnName(),n.getIsMandatory())}};i.prototype.getControl=function(){return this.ctrl};i.prototype.getField=function(){return this.mField};i.prototype.getName=function(){return this.colName};i.prototype.getColumnName=function(){return this.colName};i.prototype.getIsMandatory=function(){return this.isMandatory};i.prototype.getIsReadonly=function(){return this.readOnly};i.prototype.getDisplayType=function(){return this.displayType};i.prototype.getIsVisible=function(){return this.visible};i.prototype.getValue=function(){return this.ctrl.val()};i.prototype.getDisplay=function(){return this.ctrl.val()};i.prototype.getBtnCount=function(){return 0};i.prototype.setName=function(n,t){t?this.name=t+n:this.colName=n};i.prototype.setField=function(n){this.mField=n};i.prototype.setValue=function(){};i.prototype.setVisible=function(n){this.visible=n;n?this.ctrl.show():this.ctrl.hide()};i.prototype.setReadOnly=function(n){this.isReadOnly=n;this.ctrl.prop("disabled",n?!0:!1);this.setBackground(!1)};i.prototype.setMandatory=function(n){this.isMandatory=n;this.setBackground(!1)};i.prototype.setBackground=function(n){if(!this.colName.startsWith("lbl")&&this.displayType!=t.DisplayType.Label&&this.displayType!=t.DisplayType.YesNo&&this.displayType!=t.DisplayType.Button)if(typeof n=="boolean")if(n)this.setBackground("vis-gc-vpanel-table-error");else if(this.isReadOnly)this.setBackground("vis-gc-vpanel-table-readOnly");else if(this.isMandatory){var i=this.getValue();if(i&&i.toString().length>0){this.setBackground("");return}this.setBackground("vis-gc-vpanel-table-mandatory")}else this.setBackground("");else{if(this.activeClass==n)return;this.ctrl.removeClass();n.length>0&&this.ctrl.addClass(n);this.activeClass=n}};i.prototype.setDisplayType=function(n){this.displayType=n};i.prototype.addVetoableChangeListener=function(n){this.vetoablechangeListner=n};i.prototype.fireValueChanged=function(n,t){this.editingGrid&&(this.gridPos.dialog||t)?window.setTimeout(function(t){t.ctrl.parent().length!=0&&t.ctrl.detach();t.editingGrid.editChange.call(t.editingGrid,t.ctrl[0],t.gridPos.index,t.gridPos.col,n,n.newValue);t=null;n=null},10,this):this.vetoablechangeListner&&window.setTimeout(function(t){t.vetoablechangeListner.vetoablechange(n);t=null;n=null},10,this)};i.prototype.fireRefreshUI=function(n){this.vetoablechangeListner&&window.setTimeout(function(t){t.vetoablechangeListner.refreshUI(n);t=null;n=null},10,this)};i.prototype.addActionListner=function(n){this.actionListner=n};i.prototype.invokeActionPerformed=function(n){this.actionListner&&this.actionListner.actionPerformed(n)};i.prototype.dispose=function(){console.log("dispose ");this.ctrl.remove();this.ctrl=null;this.mField=null;this.displayType=null;this.isReadOnly=null;this.colName=null;this.isMandatory=null;this.oldValue=null;this.vetoablechangeListner=null;this.actionListner=null;this.disposeComponent()};t.Utility.inheritPrototype(v,i);v.prototype.setValue=function(n){this.oldValue!=n&&(this.oldValue=n,this.ctrl.val(n))};v.prototype.getDisplay=function(){return this.ctrl.val()};t.Utility.inheritPrototype(nt,i);t.Utility.inheritPrototype(r,i);r.prototype.setValue=function(n){var t,i;this.value=n;t=this.text;n==null||this.colName.equals("Record_ID")||(this.values!=null?t=this.values[n]:this.lookup!=null&&(i=this.lookup.get(n),i!=null&&(t=i.getName())));this.setText(t!=null?t:"")};r.prototype.setReadOnly=function(n){this.isReadOnly=n;this.ctrl.css("opacity",n?.6:1);this.isLink||this.ctrl.prop("disabled",n?!0:!1);this.setBackground(!1)};r.prototype.getValue=function(){return this.value!=null?this.value.toString():null};r.prototype.getDisplay=function(){return this.value};r.prototype.readReference=function(n){var r,i;this.values={};r=t.Env.isBaseLanguage(t.Env.getCtx(),"AD_Ref_List")?"SELECT Value, Name FROM AD_Ref_List WHERE AD_Reference_ID="+n+" AND IsActive='Y'":"SELECT l.Value, t.Name FROM AD_Ref_List l, AD_Ref_List_Trl t WHERE l.AD_Ref_List_ID=t.AD_Ref_List_ID AND t.AD_Language='"+t.Env.getAD_Language(t.Env.getCtx())+"' AND l.AD_Reference_ID="+n+" AND l.IsActive='Y'";try{for(i=t.DB.executeDataReader(r);i.read();)this.values[i.getString(0)]=i.getString(1);i.close()}catch(u){t.Logging.VLogger.getVLogger().get().log(t.Logging.Level.SEVERE,r,u)}};r.prototype.getProcess_ID=function(){return this.AD_Process_ID};r.prototype.getDescription=function(){return this.description};r.prototype.getHelp=function(){return this.help};t.Utility.inheritPrototype(y,i);y.prototype.setValue=function(n){this.oldValue!=n&&(this.oldValue=n,this.cBox.prop("checked",n))};y.prototype.getValue=function(){return this.cBox.prop("checked")};y.prototype.getDisplay=function(){return this.cBox.prop("checked").toString()};t.Utility.inheritPrototype(s,i);s.prototype.setValue=function(n,i){var u,f,r;if(this.oldValue!=n){if(this.settingValue=!0,this.oldValue=n,this.ctrl.val(n),n==null){this.lastDisplay="";this.settingValue=!1;return}if(this.lookup==null){this.lastDisplay=n.toString();this.settingValue=!1;return}if(this.lastDisplay=this.lookup.getDisplay(n,!0),this.lastDisplay.equals("<-1>")&&(this.lastDisplay="",this.oldValue=null),this.inserting=i,u=this.lastDisplay.startsWith("<")&&this.lastDisplay.endsWith(">"),f=this.ctrl.val(),f==null||this.inserting&&this.lookup.getDisplayType()!=t.DisplayType.Search){if(u&&this.lookup.loading){window.setTimeout(function(t){t.setValue(n,i);t=null;return},500,this);this.oldValue="oldValue";return}u&&(this.lastDisplay=this.lookup.getDisplay(n,!1),u=this.lastDisplay.startsWith("<")&&this.lastDisplay.endsWith(">"));u?(this.oldValue="old",this.ctrl.val(null),this.inserting&&this.ctrl.trigger("change")):this.ctrl.val()==null&&(r=null,this.lookup.loading||(r=this.lookup.getFromList(n)),r==null&&(r=this.lookup.get(n)),r!=null&&(this.ctrl.append('<option value="'+r.Key+'">'+r.Name+"<\/option>"),this.ctrl.val(n)));this.ctrl.val()==null&&n!=null&&(this.oldValue=null)}this.settingValue=!1}this.inserting=!1};s.prototype.refreshOptions=function(n,t){for(var r=[],u=-1,i=0;i<n.length;i++)t&&t==n[i].Key&&(u=i),r[i]='<option value="'+n[i].Key+'">'+n[i].Name+"<\/option>";this.ctrl.empty();this.ctrl.html(r.join(""));this.ctrl[0].selectedIndex=u};s.prototype.getDisplay=function(){return this.lookup==null?this.ctrl.val():this.lookup.getDisplay(this.ctrl.val())};t.Utility.inheritPrototype(p,i);p.prototype.setValue=function(n){var i,f,e,r,u;if(this.oldValue!=n){if(this.oldValue=n,n==null||n==""){this.ctrl.val("");return}i=new Date(n);this.displayType!=t.DisplayType.Date&&i.setMinutes(-i.getTimezoneOffset()+i.getMinutes());n=i.toISOString();f=n.substring(0,n.length-1);e=n.indexOf("T");this.displayType==t.DisplayType.DateTime?this.ctrl.val(f):this.displayType==t.DisplayType.Date?this.ctrl.val(f.substring(0,e)):(r=i.getUTCHours(),u=i.getUTCMinutes(),this.ctrl.val((r<10?"0"+r:r)+":"+(u<10?"0"+u:u)))}};p.prototype.getValue=function(){var i=this.ctrl.val(),n;if(i==null||i=="")return null;if(n=null,this.displayType==t.DisplayType.Time){n=new Date(0);var r=i.match(/(\d+)\:(\d+)/),u=parseInt(r[1],10),f=parseInt(r[2],10);n.setHours(u);n.setMinutes(f)}else n=new Date(i);try{return this.displayType==t.DisplayType.DateTime&&n.setMinutes(n.getTimezoneOffset()+n.getMinutes()),n.toISOString()}catch(e){return console.log(i),new Date}};p.prototype.getDisplay=function(){return this.getValue()};t.Utility.inheritPrototype(o,i);o.prototype.setValue=function(n,i,r){var s,e,o,h,f,u;if(this.oldValue!=n||i){if(this.settingValue=!0,this.oldValue=n,this.value=n,n==null){this.lastDisplay="";this.ctrl.val("");this.settingValue=!1;r&&(u={newValue:n,propertyName:this.getName()},this.fireValueChanged(u),u=null);return}if(this.lookup==null){this.ctrl.val(n.toString());this.lastDisplay=n.toString();this.settingValue=!1;return}if(this.displayType!==t.DisplayType.MultiKey)this.lastDisplay=this.lookup.getDisplay(n);else{for(s=n.toString().split(","),e="",o=0,h=s.length;o<h;o++){if(f=s[o],isNaN(f)||(f=Number(f)),e.length==0){e+=this.lookup.getDisplay(f);continue}e+=","+this.lookup.getDisplay(f)}this.lastDisplay=e}this.lastDisplay.equals("<-1>")&&(this.lastDisplay="",this.oldValue=null,this.value=null);this.value=n;this.ctrl.val(this.lastDisplay);this.settingValue=!1;r&&((n==-1||n=="")&&(n=null),u={newValue:n,propertyName:this.getName()},this.fireValueChanged(u),u=null)}};o.prototype.getValue=function(){return this.value};o.prototype.getMultipleIds=function(){return this.infoMultipleIds};o.prototype.getDisplay=function(){return this.lookup==null?this.value:this.lookup.getDisplay(this.value)};t.Utility.inheritPrototype(d,i);d.prototype.setValue=function(n){this.oldValue!=n&&(this.oldValue=n,this.ctrl.val(n))};d.prototype.getDisplay=function(){return this.ctrl.val()};t.Utility.inheritPrototype(h,i);h.prototype.setValue=function(n){this.oldValue!=n&&(this.oldValue=n,n=this.format.GetFormatedValue(n),this.ctrl.val(n))};h.prototype.getValue=function(){var n=this.$super.getValue.call(this);return isNaN(n)||n===null?null:Number(n)};h.prototype.getDisplay=function(){return this.ctrl.val()};t.Utility.inheritPrototype(w,i);w.prototype.setValue=function(n){this.oldValue!=n&&(this.oldValue=n,n=Number(this.format.GetFormatedValue(n)),this.ctrl.val(n))};w.prototype.getValue=function(){var n=this.$super.getValue.call(this);return n===null?null:(this.editingGrid&&(n=this.format.GetFormatedValue(n)),n)};w.prototype.getDisplay=function(){return this.ctrl.val()};t.Utility.inheritPrototype(b,i);b.prototype.setValue=function(n){if(this.oldValue!=n){if(this.settingValue=!0,this.oldValue=n,this.value=n,n==null){this.lastDisplay="";this.ctrl.val("");this.settingValue=!1;return}if(this.lookup==null){this.ctrl.val(n.toString());this.lastDisplay=n.toString();this.settingValue=!1;return}this.lastDisplay=this.lookup.getDisplay(n);this.lastDisplay.equals("<-1>")&&(this.lastDisplay="",this.oldValue=null,this.value=null);this.value=n;this.ctrl.val(t.Utility.decodeText(this.lastDisplay));this.settingValue=!0}};b.prototype.getValue=function(){return this.value};b.prototype.getDisplay=function(){return this.lookup==null?this.value:this.lookup.getDisplay(this.value)};t.Utility.inheritPrototype(f,i);f.prototype.getOnlyWarehouseID=function(){var r=t.Env.getCtx(),u=r.getContext(this.windowNum,"0|AD_Table_ID",!0),n,i;if("572"==u)return 0;n=r.getContext(this.windowNum,"M_Warehouse_ID",!0);i=0;try{n!=null&&n.length>0&&(i=Number(n))}catch(f){}return i};f.prototype.getOnlyProductID=function(){var r=t.Env.getCtx(),u=r.getContext(this.windowNum,"0|AD_Table_ID",!0),n,i;if("572"==u)return 0;n=r.getContext(this.windowNum,"M_Product_ID",!0);i=0;try{n!=null&&n.length>0&&(i=Number(n))}catch(f){}return i};f.prototype.showLocatorForm=function(n,i){var u=0,r;this.value!=null&&(u=Number(this.value));this.lookup.setOnlyWarehouseID(n);this.lookup.setOnlyProductID(i);var f="Y".equals(t.context.getWindowContext(this.windowNum,"IsReturnTrx")),e=t.Env.getCtx().isSOTrx(this.windowNum),o=(e&&!f||!e&&f)&&this.columnName=="M_Locator_ID";this.lookup.setOnlyOutgoing(o);this.lookup.refresh();self=this;r=new t.LocatorForm(this.columnName,this.lookup,u,this.mandatory,n,this.windowNum);r.load();r.showDialog();r.onClose=function(n){if(self.oldValue!=n){self.setValue(n);var t={newValue:n,propertyName:self.columnName};self.fireValueChanged(t);t=null}}};f.prototype.setValue=function(n){if(this.oldValue!=n){if(this.settingValue=!0,this.oldValue=n,this.value=n,n==null){this.lastDisplay="";this.ctrl.val("");this.settingValue=!1;return}if(this.lookup==null){this.ctrl.val(n.toString());this.lastDisplay=n.toString();this.settingValue=!1;return}this.lastDisplay=this.lookup.getDisplay(n);this.lastDisplay.equals("<-1>")&&(this.lastDisplay="",this.oldValue=null,this.value=null);this.value=n;this.ctrl.val(this.lastDisplay);this.settingValue=!0}};f.prototype.getValue=function(){return this.value};f.prototype.getDisplay=function(){return this.lookup==null?this.value:this.lookup.getDisplay(this.value)};t.Utility.inheritPrototype(u,i);u.prototype.setValue=function(n){(n==null||0===n)&&(this.ctrl.text(""),this.value=n);this.value=n;this.ctrl.val(this.lookup.getDisplay(n))};u.prototype.setField=function(n){n!=null&&(this.windowNo=n.getWindowNo(),this.AD_Column_ID=n.getAD_Column_ID());this.mField=n};u.prototype.getValue=function(){return this.value};u.prototype.genSetInstanceIDs=function(){return this.setInstanceIDs};u.prototype.getDisplay=function(){return this.ctrl.val()};u.prototype.getCanSaveRecord=function(){return this.canSaveRecord};u.prototype.setCanSaveRecord=function(n){return this.canSaveRecord=n};t.Utility.inheritPrototype(k,i);k.prototype.setValue=function(n){this.oldValue!=n&&(this.oldValue=n,this.value=n,this.ctrl.val(this.lookup.getDisplay(n)))};k.prototype.getValue=function(){return this.value};k.prototype.getDisplay=function(){return this.ctrl.val()};t.Utility.inheritPrototype(c,i);c.prototype.setValue=function(i){if(this.oldValue!=i){if(this.oldValue=i,this.value=i,i==null){this.setIcon(null);this.value=0;return}var r=this;n.ajax({url:t.Application.contextUrl+"VImageForm/GetImageAsByte",dataType:"json",data:{ad_image_id:i},success:function(n){returnValue=n.result;r.setIcon(returnValue);r.ctrl.val(i);r=null}})}};c.prototype.setReadOnly=function(n){this.isReadOnly=n;this.isLink?this.ctrl.css("opacity",n?.6:1):this.ctrl.prop("disabled",n?!0:!1);this.setBackground(!1)};c.prototype.getValue=function(){return this.value};c.prototype.getDisplay=function(){return this.value};t.Utility.inheritPrototype(l,i);l.prototype.setValue=function(n){var t,i;this.oldValue!=n&&(this.oldValue=n,n==null?(this.setText("-"),this.value=n,this.ctrl.val(n)):(t="?",n.length>0?(i=n,t="#"+i.length):t=n.GetType().FullName,this.setText(t!=null?t:""),this.value=n,this.ctrl.val(n)))};l.prototype.setReadOnly=function(n){this.isReadOnly=n;this.ctrl.prop("disabled",n?!0:!1);this.setBackground(!1)};l.prototype.getValue=function(){return this.value};l.prototype.getDisplay=function(){return this.value};t.Utility.inheritPrototype(g,i);g.prototype.setValue=function(n){if(this.oldValue!=n){if(this.oldValue=n,this.value=n,n==null){this.lastDisplay="";this.ctrl.val("");return}this.value=n;this.ctrl.val(n);this.ctrl.val(n)}};g.prototype.getValue=function(){return this.value};g.prototype.getDisplay=function(){return this.ctrl.val()};t.Utility.inheritPrototype(a,i);a.prototype.setValue=function(n){this.oldValue!=n&&(this.oldValue=n,this.value=n,this.ctrl.val(n))};a.prototype.setReadOnly=function(n){this.isReadOnly=n;this.ctrl.prop("disabled",n?!0:!1);this.setBackground(!1)};a.prototype.getValue=function(){return this.value};a.prototype.getDisplay=function(){return this.value};t.Controls.IControl=i;t.Controls.VTextBox=v;t.Controls.VLabel=nt;t.Controls.VButton=r;t.Controls.VCheckBox=y;t.Controls.VComboBox=s;t.Controls.VTextBoxButton=o;t.Controls.VTextArea=d;t.Controls.VAmountTextBox=h;t.Controls.VNumTextBox=w;t.Controls.VLocation=b;t.Controls.VDate=p;t.Controls.VLocator=f;t.Controls.VAccount=k;t.Controls.VPAttribute=u;t.Controls.VImage=c;t.Controls.VBinary=l;t.Controls.VFile=a}(jQuery,VIS),function(n,t){function i(n){this.log=t.Logging.VLogger.getVLogger("AccessSqlParser");this.sqlOriginal;this.sql=[];this.tableInfo=[];this.setSql(n)}function u(n,t){this.tableName=n;this.synonym=t}function e(){function e(t){if(t==null)return!1;var i=t.getTableName();return r.push(i),n.push(t),!0}function o(t){var r,i,u;if(t==null)return!1;for(r=!1,i=n.lenght-1;i>=0;i--)u=n[i],t===u&&(n.splice(1,1),r=!0);return r}function u(){var r,u,e,t;if(arguments.length==2)return f(arguments[0],arguments[1]);if(arguments.length==1)return f(arguments[0]);for(r=0,u=0,e=0;e<n.length;e++)t=n.get(e),t!=null&&t.lenght>0&&(i.info(t.toString()),u+=t.reset(),r++);return r>0&&i.info("#"+r+" ("+u+")"),u}function f(t,f){var e,o,s,c,h;if(t==null||t.length()==0)return u();if(f||(f=0),r.indexOf(t)<0)return 0;for(t.equals("AD_Role"),e=0,o=0,s=0;s<n.length;s++)(c=n[s],c!=null)&&(h=c.reset(t,f),h>=0&&e++,h>0&&(o+=h));return e>0&&i.fine(t+": #"+e+" ("+o+")"),o}var n=[],r=[],i=t.Logging.VLogger.getVLogger("CacheMgt");return{register:e,reset:u,unregister:o}}function r(n,i,r,u,f,e){this.m_cacheK=[];this.m_cacheV=[];this.m_tableName=n;this.m_resetAll=u?u:!1;this.m_tableName2=e;this.setExpireMinutes(r);t.CacheMgt.register(this)}var f=/(\d{4})-(\d{2})-(\d{2})T(\d{2})\:(\d{2})\:(\d{2})/,o=t.Logging.Level;t.Evaluator={parseDepends:function(n,t){var i,r,u;if(t!=null&&t.length!=0)for(i=t;i.indexOf("@")!=-1;)(r=i.indexOf("@"),i=i.substring(r+1),r=i.indexOf("@"),r!=-1)&&(u=i.substring(0,r),i=i.substring(r+1),n.indexOf(u)<0&&(n[n.length]=u))},evaluateLogic:function(n,i){var u=new t.StringTokenizer(i.trim(),"&|",!0),o=u.countTokens(),r,f,e;if(o/2-(o+1)/2==0)return!1;for(r=this.evaluateLogicDouble(n,u.nextToken());u.hasMoreTokens();)if(f=u.nextToken().trim(),e=this.evaluateLogicDouble(n,u.nextToken()),f.equals("&"))r=r&&e;else if(f.equals("|"))r=r||e;else return!1;return r},evaluateLogicDouble:function(n,i){var o=new t.StringTokenizer(i.trim(),"!=^><",!0),e,u;if(o.countTokens()!==3)return!1;e=o.nextToken().trim();u=e.trim();e.indexOf("@")!=-1&&(e=e.replaceAll("@"," ").trim(),u=n.getValueAsString(e),u==null&&(u=""));u=u.replaceAll("'"," ").replaceAll('"'," ").trim();var s=o.nextToken(),f=o.nextToken(),r=f.trim();return f.indexOf("@")!=-1&&f[0]=="@"&&f[f.length-1]=="@"&&(f=f.replaceAll("@"," ").trim(),r=n.getValueAsString(f),r==null&&(r="")),r=r.replaceAll("'"," ").replaceAll('"'," ").trim(),e.indexOf("_ID")!=-1&&u.length==0&&(u="0"),f.indexOf("_ID")!=-1&&r.length==0&&(r="0"),u=="0"&&(r==""||r=="null")&&(r="0"),u.length==0&&r=="null"&&(r=""),this.evaluateLogicTuple(u,s,r)},evaluateLogicTuple:function(n,t,i){if(n==null||t==null||i==null)return!1;var r=0,u=0;try{n.startsWith("'")||isNaN(n)||(r=Number(n));i.startsWith("'")||isNaN(i)||(u=Number(i))}catch(f){r=0;u=0}return t.equals("=")?r!=0&&u!=0?r.compareTo(u)==0:n.compareTo(i)==0:t.equals("<")?r!=0&&u!=0?r.compareTo(u)<0:n.compareTo(i)<0:t.equals(">")?r!=0&&u!=0?r.compareTo(u)>0:n.compareTo(i)>0:r!=0&&u!=0?r.compareTo(u)!=0:n.compareTo(i)!=0},getVariables:function(n){for(var u=[],f=new StringBuilder,r=new t.StringTokenizer(n,"@"),i;r.hasMoreTokens();)f.append(r.nextToken()),r.hasMoreTokens()&&(f.append("?"),i=r.nextToken(),i.indexOf("|")!=-1&&(i=i.substring(0,i.indexOf("|"))),u.indexOf(i)===-1&&u.push(i));return u},replaceVariables:function(n,t,i){var u=n,h=[],e,f,r,o,s;for(this.parseDepends(h,n),e=0;e<h.length;e++){if(f=h[e],f.indexOf("\n")!=-1)break;if(r=null,i!=null&&(r=i.get(f)),r==null&&(r=t.getContext(f)),r!=null&&r.length>0){o=null;try{o=new Number(r)}catch(c){}if(o!=null)u=u.replaceAll("@"+f+"@",o.toString());else{s=null;try{s=new Double(r)}catch(c){}u=s!=null?u.replaceAll("@"+f+"@",s.toString()):u.replaceAll("@"+f+"@",r.replaceAll("'","''"))}}else u=u.replaceAll("@"+f+"@","NULL")}return u}};t.Query=function(n,t){this.tableName=n?n:"";this.list=[];this.recordCount=999999;this.newRecord=!1;this.isORcondition=!1;t&&t==!0&&(this.isORcondition=!0)};t.Query.prototype.addRestriction=function(){var n=null,i;if(arguments.length==5)n=new t.QueryRestriction(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]),this.isORcondition&&(n.andCondition=!1),arguments[3].toString().startsWith("-")||this.list.push(n);else if(arguments.length==3)n=new t.QueryRestriction(arguments[0],arguments[1],arguments[2],null,null),this.isORcondition&&(n.andCondition=!1),this.list.push(n);else if(arguments.length==1)if(i=arguments[0],typeof i=="string"){if(i==null||i.trim().length==0)return;n=new t.QueryRestriction(i);this.isORcondition&&(n.andCondition=!1);this.list.push(n);this.newRecord=i.equals(t.Query.NEWRECORD)}else n=i,this.isORcondition&&(n.andCondition=!1),this.list.push(n);else throw new Error("invalid arguments Addrestriction");n=null};t.Query.prototype.setTableName=function(n){this.tableName=n};t.Query.prototype.setRecordCount=function(n){this.recordCount=n};t.Query.prototype.setColumnName=function(n,t){n<0||n>=this.list.length||(this.list[n].columnName=t)};t.Query.prototype.getCode=function(n){if(n<0||n>=this.list.length)return null;this.list[n].code};t.Query.prototype.getInfo=function(){var i="",n=null,t;for(this.tableName!=null&&(i+=this.tableName+": "),t=0;t<this.list.length;t++)n=this.list[t],t!=0&&(i+=n.andCondition?" AND ":" OR "),i+=n.getInfoName()+n.getInfoOperator()+n.getInfoDisplayAll();return i};t.Query.prototype.getIsActive=function(){return this.list.length!=0};t.Query.prototype.getIsNewRecordQuery=function(){return this.newRecord};t.Query.prototype.getRecordCount=function(){return this.recordCount};t.Query.prototype.getWhereClause=function(){var t=arguments.length==1?arguments[0]:!1,n="",i=null,u,r;if(typeof t=="boolean"||isNaN(t)){for(u=t,u&&(this.tableName==null||this.tableName.length==0)&&(u=!1),r=0;r<this.list.length;r++)i=this.list[r],r!=0&&(n+=i.andCondition?" AND ":" OR "),n+=u?i.getSQL(this.tableName):i.getSQL(null);return n.length>0?" ( "+n+" ) ":n}return t>=0&&t<this.list.Count&&(i=this.list[t],n+=i.GetSQL(null)),n};t.Query.prototype.getRestrictionCount=function(){return this.list.length};t.Query.prototype.addRangeRestriction=function(){var n=null;n=arguments.length==3?new t.QueryRestriction(arguments[0],arguments[1],arguments[2],null,null,null):new t.QueryRestriction(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);this.list.push(n)};t.Query.prototype.getColumnName=function(n){return n<0||n>=this.list.length?null:this.list[n].columnName};t.Query.prototype.getTableName=function(){return this.tableName};t.Query.prototype.getOperator=function(n){return n<0||n>=this.list.length?null:this.list[n].operator};t.Query.prototype.getCodeTo=function(n){return n<0||n>=this.list.Count?null:this.list[n].code_to};t.Query.prototype.getInfoDisplay=function(n){return n<0||n>=this.list.length?null:this.list[n].infoDisplay};t.Query.prototype.getInfoDisplay_to=function(n){return n<0||n>=this.list.length?null:this.list[n].infoDisplay_to};t.Query.prototype.getInfoName=function(n){return n<0||n>=this.list.length?null:this.list[n].infoName};t.Query.prototype.getInfoOperator=function(n){return n<0||n>=this.list.length?null:this.list[n].getInfoOperator()};t.Query.prototype.getInfoDisplayAll=function(n){return n<0||n>=_list.Count?null:this.list[n].getInfoDisplayAll()};t.Query.prototype.deepCopy=function(){for(var i=new t.Query(this.tableName),n=0;n<this.list.length;n++)i.addRestriction(this.list[n]);return i};t.Query.prototype.getNoRecordQuery=function(n,i){var r=new t.Query(n);return i?r.AddRestriction(t.Query.NEWRECORD):r.AddRestriction("1=2"),r.setRecordCount(0),r};t.Query.prototype.NEWRECORD="2=3";t.Query.prototype.EQUAL="=";t.Query.prototype.EQUAL_INDEX=0;t.Query.prototype.NOT_EQUAL="!=";t.Query.prototype.LIKE=" LIKE ";t.Query.prototype.NOT_LIKE=" NOT LIKE ";t.Query.prototype.GREATER=">";t.Query.prototype.GREATER_EQUAL=">=";t.Query.prototype.LESS="<";t.Query.prototype.LESS_EQUAL="<=";t.Query.prototype.BETWEEN=" BETWEEN ";t.Query.prototype.BETWEEN_INDEX=8;t.Query.prototype.IN=" IN ";t.Query.prototype.NOT_IN=" NOT IN ";t.Query.prototype.OPERATORS={"=":" = ","!=":" != "," LIKE ":" ~ "," NOT LIKE ":" !~ ",">":" > ",">=":" >= ","<":" < ","<=":" <= "," BETWEEN ":" >-< "};t.Query.prototype.CVOPERATORS={"=":" = ","!":" != ",">":" > ","<":" < "};t.Query.prototype.OPERATORS_ID={"=":" = ","!=":" != "};t.Query.prototype.CVOPERATORS_ID={"=":" = ","!":" != "};t.Query.prototype.OPERATORS_YN={"=":" = "};t.Query.prototype.OPERATORS_DATE_DYNAMIC={"0":"Today","1":"lastxDays","2":"lastxMonth","3":"lastxYears"};t.Query.prototype.OPERATORS_DYNAMIC_ID={"@#AD_User_ID@":"LoginUser"};t.Query.prototype.getEqualQuery=function(n,i){var r=new t.Query;return r.addRestriction(n,t.Query.prototype.EQUAL,i),r.setRecordCount(1),r};t.QueryRestriction=function(){this.directWhereClause=null;this.columnName;this.infoName;this.operator;this.code;this.infoDisplay;this.code_to;this.infoDisplay_to;this.andCondition=!0;switch(arguments.length){case 5:this.fnArgu5(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);break;case 6:this.fnArgu6(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);break;case 9:this.fnArgu9(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8]);break;case 1:this.fnArgu1(arguments[0]);break;case 0:break;default:throw new Error("Invalid arguments");}};t.QueryRestriction.prototype.fnArgu5=function(n,t,i,r,u){var o=n.trim(),s,f,e;s=r!=null?r:o;Operator=t;f=i!=null&&typeof i=="Boolean"?new Boolean(i)==!0?"Y":"N":i;f!=null&&typeof f=="string"&&(f.startsWith("'")&&(f=f.substring(1)),f.endsWith("'")&&(f=f.substring(0,f.length-2)));u!=null?e=u.toString().trim():i!=null&&(e=i);this.columnName=o;this.infoName=s;this.operator=Operator;this.code=f;this.infoDisplay=e};t.QueryRestriction.prototype.fnArgu6=function(n,i,r,u,f,e){var o,s;this.fnArgu5(n,t.Query.prototype.BETWEEN,i,u,f);o=r;typeof o=="string"&&(o.startsWith("'")&&(o=o.substring(1)),o.endsWith("'")&&(o=o.substring(0,o.length-2)));e!=null?s=e.trim():o!=null&&(s=o.toString());this.code_to=o;this.infoDisplay_to=s};t.QueryRestriction.prototype.fnArgu9=function(n,t,i,r,u,f,e,o,s){this.columnName=n;this.infoName=r;this.code=t;this.code_to=i;this.infoName=r;this.infoDisplay=u;this.infoDisplay_to=f;this.operator=e;this.directWhereClause=o;this.andCondition=s};t.QueryRestriction.prototype.fnArgu1=function(n){this.directWhereClause=n};t.QueryRestriction.prototype.getInfoName=function(){return this.infoName};t.QueryRestriction.prototype.getInfoOperator=function(){return this.operator in t.Query.OPERATORS?t.Query.OPERATORS[this.operator]:this.operator};t.QueryRestriction.prototype.getInfoDisplayAll=function(){if(this.infoDisplay_to==null)return this.infoDisplay;var n=this.infoDisplay;return n+(" - "+InfoDisplay_to)};t.QueryRestriction.prototype.getSQL=function(n){var i,r,u;return this.directWhereClause!=null?this.directWhereClause:(i="",typeof this.code=="string"&&(i+=" UPPER( "),n!=null&&n.length>0?(r=this.columnName.lastIndexOf("(")+1,u=this.columnName.indexOf(")"),i+=r!=-1&&u!=-1?this.columnName.substring(0,r)+n+"."+this.columnName.substring(r,r+(u-r))+this.columnName.substring(u):n+"."+this.columnName):i+=this.columnName,typeof this.code=="string"&&(i+=" ) "),this.code==null||"NULL".equals(this.code.toString().toUpper())||"NullValue".equals(this.code.toString())?i+=this.operator.equals(t.Query.prototype.EQUAL)?" IS NULL ":" IS NOT NULL ":(i+=this.operator,(t.Query.prototype.IN.equals(this.operator)||t.Query.prototype.NOT_IN.equals(this.operator))&&(i+="("),this.code instanceof Date||this.code&&f.test(this.code.toString())?i+=t.DB.to_date(this.code,!1):"string"==typeof this.code?(i+=" UPPER( ",i+=t.DB.to_string(this.code.toString()),i+=" ) "):i+=this.code,t.Query.prototype.BETWEEN.equals(this.operator)?(i+=" AND ",i+=this.code_to instanceof Date||this.code_to&&f.test(this.code_to.toString())?t.DB.to_date(this.code_to,!1):typeof this.code_to=="string"?t.DB.to_string(this.code_to.toString()):this.code_to):(t.Query.prototype.IN.equals(this.operator)||t.Query.prototype.NOT_IN.equals(this.operator))&&(i+=")")),i)};i.prototype.FROM=" FROM ";i.prototype.FROM_LENGTH=i.prototype.FROM.length;i.prototype.WHERE=" WHERE ";i.prototype.ON=" ON ";i.prototype.setSql=function(n){if(n==null)throw new IllegalArgumentException("No SQL");this.sqlOriginal=n;var t=this.sqlOriginal.indexOf("\nFROM ");t!=-1&&(this.sqlOriginal=this.sqlOriginal.replace("\nFROM ",FROM));t=this.sqlOriginal.indexOf("\nWHERE ");t!=-1&&(this.sqlOriginal=this.sqlOriginal.replace("\nWHERE ",WHERE));this.parse()};i.prototype.getSql=function(){return this.sqlOriginal};i.prototype.setSql=function(n){if(n==null)throw new IllegalArgumentException("No SQL");this.sqlOriginal=n;var t=this.sqlOriginal.indexOf("\nFROM ");t!=-1&&(this.sqlOriginal=this.sqlOriginal.replaceAll("\nFROM ",FROM));t=this.sqlOriginal.indexOf("\nWHERE ");t!=-1&&(this.sqlOriginal=this.sqlOriginal.replaceAll("\nWHERE ",WHERE));this.parse()};i.prototype.getSql=function(){return this.sqlOriginal};i.prototype.parse=function(){var n,t;if(this.sqlOriginal==null||this.sqlOriginal.length==0)throw new IllegalArgumentException("No SQL");for(this.getSelectStatements(),n=0;n<this.sql.length;n++)t=this.getTableInfo(this.sql[n].trim()),this.tableInfo.push(t);return this.tableInfo.length>0};i.prototype.getSelectStatements=function(){var i=[this.sqlOriginal],n=null;try{n=this.getSubSQL(i)}catch(r){this.log.log(t.Logging.Level.SEVERE,this.sqlOriginal,r);throw new IllegalArgumentException(this.sqlOriginal);}while(i.length!=n.length){i=n;try{n=this.getSubSQL(i)}catch(r){this.log.log(t.Logging.Level.SEVERE,this.sqlOriginal,r);throw new IllegalArgumentException(n.length+": "+m_sqlOriginal);}}this.sql=n};i.prototype.getSubSQL=function(n){for(var e=[],t="",i,r,f,o,s,u=0;u<n.length;u++){for(t=n[u],i=t.indexOf("(SELECT ",7);i!=-1;){for(r=i+1,f=0;r++<t.length;)if(o=t.charAt(r),o==")")if(f==0)break;else f--;else o=="("&&f++;s=t.substring(i,r+1);e.push(s);t=t.substring(0,i+1)+"##"+t.substring(r);i=t.indexOf("(SELECT ",7)}e.push(t)}return e};i.prototype.getTableInfo=function(n){var o,f,i,e,s,h,r;if(isNaN(n)){for(o=[],n.startsWith("(")&&n.endsWith(")")&&(n=n.substring(1,n.length-1)),f=n.indexOf(this.FROM),f!=n.lastIndexOf(this.FROM)&&this.log.log(t.Logging.Level.FINE,"More than one FROM clause - "+n);f!=-1;){for(i=n.substring(f+this.FROM_LENGTH),r=i.indexOf(this.WHERE),r!=-1&&(i=i.substring(0,r)),i=i.replaceAll(" AS "," "),i=i.replaceAll(" as "," "),i=i.replaceAll(" INNER JOIN ",", "),i=i.replaceAll(" LEFT OUTER JOIN ",", "),i=i.replaceAll(" RIGHT OUTER JOIN ",", "),i=i.replaceAll(" FULL JOIN ",", "),r=i.indexOf(this.ON);r!=-1;){if(e=i.indexOf(")"),s=i.indexOf(this.ON,r+4),s!=-1&&(e=i.lastIndexOf(")",s)),e!=-1)i=i.substring(0,r)+i.substring(e+1);else{this.log.log(t.Logging.Level.SEVERE,"Could not remove ON "+i);break}r=i.indexOf(this.ON)}for(h=new t.StringTokenizer(i,",");h.hasMoreTokens();){var l=h.nextToken().trim(),c=new t.StringTokenizer(l," "),a=null;a=c.countTokens()>1?new u(c.nextToken(),c.nextToken()):new u(l);o.push(a)}n=n.substring(0,f);f=n.lastIndexOf(this.FROM)}return o}return(r=n,r<0||r>this.tableInfo.length)?null:this.tableInfo[r]};i.prototype.getSqlStatement=function(n){return n<0||n>this.sql.length?null:this.sql[n]};i.prototype.getNoSqlStatments=function(){return this.sql==null?0:this.sql.length};i.prototype.getMainSqlIndex=function(){if(this.sql==null)return-1;if(this.sql.length==1)return 0;for(var n=this.sql.length-1;n>=0;n--)if(this.sql[n].charAt(0)!="(")return n;return-1};i.prototype.getMainSql=function(){if(this.sql==null)return this.sqlOriginal;if(this.sql.length==1)return this.sql[0];for(var n=this.sql.length-1;n>=0;n--)if(this.sql[n].charAt(0)!="(")return this.sql[n];return""};i.prototype.size=function(){return this.tableInfo.length};u.prototype.getSynonym=function(){return this.synonym==null?"":this.synonym};u.prototype.getTableName=function(){return this.tableName};t.TableInfo=u;t.AccessSqlParser=i;t.ZoomTarget={log:t.Logging.VLogger.getVLogger("VIS.ZoomTarget"),getZoomAD_Window_ID:function(n,i,r,u){var s=0,h=0,l,f,p,e,a,v,c,o;n.equals("M_Product");l="SELECT DISTINCT AD_Window_ID, PO_Window_ID FROM AD_Table t WHERE TableName = '"+n+"'";f=null;try{p=1;f=t.DB.executeDataReader(l);f.read()&&(s=f.getInt(0),h=f.getInt(1))}catch(y){this.log.log(t.Logging.Level.SEVERE,l,y)}finally{f!=null&&f.dispose();f=null}if(h==0)return s;if(h!=0&&s!=0&&r!=null&&r.length!=0&&(e=null,a=n.indexOf("Line"),a!=-1&&(e=n.substring(0,a)),e!=null)){v=" SELECT p.IsSOTrx FROM "+e+" p, "+n+" c  WHERE "+r+" AND p."+e+"_ID = c."+e+"_ID";try{f=t.DB.executeDataReader(v);f.read()&&(u=f.getString(0).equals("Y"))}catch(y){this.log(t.Logging.Level.SEVERE,v.toString(),y)}finally{f!=null&&f.dispose();f=null}}return(c=0,r!=null&&r.length!=0&&(o=[],o=this.getZoomTargets(n,i,r),o!=null&&o.length>0&&(c=o[0].Key)),c!=0)?c:u?s:h},parseColumns:function(n,t){var i,e,u,f,r;if(t!=null&&t.length!=0&&(i=t,!i.contains(" EXISTS ")&&!i.contains(" IN ")&&!i.contains("(")&&!i.contains(")")))while(i.indexOf("=")!=-1)e=i.indexOf("="),u=i.substring(0,e),u=u.trim(),f=u.lastIndexOf(" ",u.length),r=u.substring(f+1),r.indexOf(".")!=-1&&(f=r.indexOf(".")+1,r=r.substring(f,r.length)),n.indexOf(r)<0&&n.push(r),i=i.substring(e+1)},evaluateWhereClause:function(n,i){var r,s,o;if(i==null||i.length==0)return!0;if(r=i,s=!0,r.contains(" EXISTS ")||r.contains(" IN ")||r.contains("(")||r.contains(")"))return!1;while(r.indexOf("=")!=-1){var u=r.indexOf("="),f=r.lastIndexOf(" ",u),e=r.substring(f+1,u),h="",c="";for(e.indexOf(".")!=-1&&(f=e.indexOf(".")+1,e=e.substring(f,e.length)),o=0;o<n.length;o++)if(e.equals(n[o].Name)){h=n[o].Value;break}if(r=r.substring(u+1),f=0,u=r.indexOf(" "),c=u==-1?r.substring(f):r.substring(f,u),!t.Evaluator.evaluateLogicTuple(h,"=",c)){s=!1;break}}return s},getZoomTargets:function(n,i,r,u){var it,e,b,y,l,tt,u,o,c,k,h,v,d,ot,p;if(arguments.length==4){if(u.length!=1)return null;it=u[0];e=r.replace("?",it.toString());e=e.replace("WHERE "," ");this.log.fine("WhereClause : "+e);r=e}var w=[],s=[],a=[],g=0,rt=0,ut="",e="",ft=!1,st=null,ht=0,ct=0,lt=0,et=" SELECT AD_Window_ID, Name FROM AD_Window WHERE Name LIKE 'Work Center%'  OR NAME LIKE 'Production Resource'",f=null;try{for(f=t.DB.executeDataReader(et);f.read();)b=f.getInt(0),y=f.getString(1),y.equals("Work Center")?ht=b:y.equals("Work Center Costs")?(ct=b,st=y):y.equals("Production Resource")&&(lt=b)}catch(nt){this.log.log(t.Logging.Level.SEVERE,et,nt)}finally{f!=null&&f.dispose();f=null}l="SELECT DISTINCT w.AD_Window_ID, w.Name, tt.WhereClause, t.TableName, wp.AD_Window_ID, wp.Name, ws.AD_Window_ID, ws.Name FROM AD_Table t INNER JOIN AD_Tab tt ON (tt.AD_Table_ID = t.AD_Table_ID) ";tt=t.Env.isBaseLanguage(t.Env.getCtx(),"AD_Window");tt?(l+="INNER JOIN AD_Window w ON (tt.AD_Window_ID=w.AD_Window_ID)",l+=" LEFT OUTER JOIN AD_Window ws ON (t.AD_Window_ID=ws.AD_Window_ID) LEFT OUTER JOIN AD_Window wp ON (t.PO_Window_ID=wp.AD_Window_ID)"):(l+="INNER JOIN AD_Window_Trl w ON (tt.AD_Window_ID=w.AD_Window_ID AND w.AD_Language=@para1)",l+=" LEFT OUTER JOIN AD_Window_Trl ws ON (t.AD_Window_ID=ws.AD_Window_ID AND ws.AD_Language=@para2) LEFT OUTER JOIN AD_Window_Trl wp ON (t.PO_Window_ID=wp.AD_Window_ID AND wp.AD_Language=@para3)");l+="WHERE t.TableName = @para4 AND w.AD_Window_ID <> @para5 AND w.isActive='Y' AND tt.SeqNo=10 AND (wp.AD_Window_ID IS NOT NULL OR EXISTS (SELECT 1 FROM AD_Tab tt2 WHERE tt2.AD_Window_ID = ws.AD_Window_ID AND tt2.AD_Table_ID=t.AD_Table_ID AND tt2.SeqNo=10)) ORDER BY 2";try{for(u=[],index=1,tt||(u.push(new t.SqlParam("@para1",t.Env.getAD_Language(t.Env.getCtx()))),u.push(new t.SqlParam("@para2",t.Env.getAD_Language(t.Env.getCtx()))),u.push(new t.SqlParam("@para3",t.Env.getAD_Language(t.Env.getCtx())))),u.push(new t.DB.SqlParam("@para4",n)),u.push(new t.DB.SqlParam("@para5",i)),f=t.DB.executeDataReader(l,u);f.read();){if(ft=!0,g=f.getInt(6),ut=f.getString(7),rt=f.getInt(4),e=f.getString(2),rt==0)break;s.push({AD_Window_ID:f.getInt(0),windowName:f.getString(1),whereClause:e})}}catch(nt){this.log.log(t.Logging.Level.SEVERE,l,nt)}finally{f!=null&&f.dispose()}if(o="",!ft||s.length<=1&&g==0)return w;if(s.length<=1)o="SELECT count(*) FROM "+n+" WHERE "+r,e!=null&&e.length!=0&&(o+=" AND "+t.Evaluator.replaceVariables(e,t.Env.getCtx(),null));else if(s.length>1){for(c=0;c<s.length;c++)this.parseColumns(a,s[c].whereClause);for(o="SELECT DISTINCT ",c=0;c<a.length;c++)c!=0&&(o+=","),o+=a[c];a.length==0&&(o+="count(*) ");o+=" FROM "+n+" WHERE "+r}this.log.fine(o);k=[];try{for(f=t.DB.executeDataReader(o);f.read();)if(a.length>0){for(k.length=0,h=0;h<a.length;h++)v=a[h],d="",d=typeof f.get(v)!="string"?f.get(v).toString():"'"+f.get(v).toString()+"'",this.log.fine(v+" = "+d),k.push({Value:d,Name:v});for(h=0;h<s.length;h++)if(this.evaluateWhereClause(k,s[h].whereClause)){p={Key:s[h].AD_Window_ID,Value:s[h].windowName};w.push(p);break}}else ot=f.getInt(0),ot!=0&&(p={Key:g,Value:ut},w.push(p))}catch(nt){this.log.log(t.Logging.Level.SEVERE,o,nt)}finally{f!=null&&f.dispose()}return w}};r.prototype.setExpireMinutes=function(n){if(n>0){this.m_expire=n;var i=6e4*n;this.m_timeExp=t.Env.currentTimeMillis()+i}else this.m_expire=0,this.m_timeExp=0};r.prototype.expire=function(){this.m_expire!=0&&this.m_timeExp<t.Env.currentTimeMillis()&&this.reset()};r.prototype.reset=function(){var n,i;return arguments.length==2?this.reset2(arguments[0],arguments[1]):arguments.length==1?this.reset2(arguments[0]):(n=this.m_cacheK.length,this.clear(),this.m_expire!=0&&(i=6e4*this.m_expire,this.m_timeExp=t.Env.currentTimeMillis()+i),n)};r.prototype.reset2=function(n,t){if(this.tableName==null)return-1;var i=n===this.m_tableName||n===this.m_tableName2;return i||this.m_tableName2.startsWith(n)?t==0||this.m_resetAll?reset():this.remove(t):-1};r.prototype.remove=function(n){var t=this.m_cacheK.indexOf(n);return t>-1?(this.m_cacheK.splice(t,1),this.m_cacheV.splice(t,1),1):0};r.prototype.get=function(n){this.expire();var t=this.m_cacheK.indexOf(n);return t>-1?this.m_cacheV[t]:null};r.prototype.contains=function(n){var t=this.m_cacheK.indexOf(n);return t>-1?!0:!1};r.prototype.add=function(t,i){var u,r;this.expire();(typeof i=="function"||n.isFunction(i))&&(u="");r=this.m_cacheK.indexOf(t);r<0?(this.m_cacheK.push(t),this.m_cacheV.push(i)):this.m_cacheV[r]=i};r.prototype.clear=function(){this.m_cacheK.length=0;this.m_cacheV.length=0};r.prototype.size=function(){return this.expire(),this.m_cacheV.length};r.prototype.getTableName=function(){return this.m_tableName};t.CacheMgt=e();t.CCache=r}(jQuery,VIS),function(n){var t=function(n,t,i,r){this.tokenizers=t.splice?t:t.split("");r&&(this.doBuild=r);this.src=n;this.ended=!1;this.tokens=[];this.returnDelim=i;this.curIndex=0;this.parse()};t.prototype={parse:function(){do this.next();while(!this.ended);return this.tokens},build:function(n,t){if(n){if(!this.returnDelim&&this.tokenizers.indexOf(n)>-1)return;this.tokens.push(this.doBuild?this.doBuild(n,t,this.tkn):n)}},next:function(){var n=this,t;n.findMin();t=n.src.slice(0,n.min);n.build(t,!1);n.src=n.src.slice(n.min).replace(n.tkn,function(t){return n.build(t,!0),""});n.src||(n.ended=!0)},findMin:function(){var n=this,r=0,t,i;for(n.min=-1,n.tkn="";(t=n.tokenizers[r++])!==undefined;)i=n.src[t.test?"search":"indexOf"](t),i!=-1&&(n.min==-1||i<n.min)&&(n.tkn=t,n.min=i);n.min==-1&&(n.min=n.src.length)},countTokens:function(){return this.tokens.length},nextToken:function(){return this.hasMoreTokens()?this.tokens[this.curIndex++]:null},hasMoreTokens:function(){return this.curIndex<this.tokens.length?!0:!1},reset:function(){this.curIndex=-1}};n.StringTokenizer=t}(VIS),function(n){function u(){function rt(){return b}function ut(){h.on(n.Events.onTouchStartOrClick,function(n){n.preventDefault();c()});var t=Date.now();d.on("click",function(i){if(i.target.nodeName==="LABEL"){if(Date.now()-t<300){i.preventDefault();i.stopPropagation();t=Date.now();return}t=Date.now()}if(i.target.nodeName==="A"){var r=$(i.target);if(r.data("isfavbtn")=="yes"){n.FavouriteHelper.showOverlay(r);return}l(r.data("action"),r.data("actionid"));return}});s.on(n.Events.onClick,function(n){n.preventDefault();var t=null;n.target.nodeName==="LI"?t=$(n.target):n.target.parentNode.nodeName==="LI"&&(t=$(n.target.parentNode));t&&(a(t[0].id),p(t));t=null});tt.on("click",function(n){n.preventDefault();et()});it.on("click",function(n){n.preventDefault();c()});w&&r.bind("input",function(){ot(r.val(),this.list)});$(window).resize(g)}function ft(){u&&u.id&&u.action&&(l(u.action,u.id),r.val(""));u=null}function c(){i.closePopup();k.hide("fast");h.fadeOut();r.val("");r.blur()}function et(){h.fadeIn();k.show("fast")}function g(){nt.css("height",window.innerHeight-22);n.Env.setScreenHeight(window.innerHeight-64);n.viewManager&&n.viewManager.sizeChanged()}function l(t,i){n.viewManager.startAction(t,i);c()}function p(n){y&&y.css("background-color","");y=n.css("background-color","#D7E3E7");n=null}function a(i){o?o.hide():b.children("div").hide();e[i]&&(o=e[i],o.css({opacity:0}),o.show().animate({opacity:1},500,"linear",function(){n.viewManager.resize(i)}));t.indexOf(i)!=-1&&t.splice(t.indexOf(i),1);t.push(i);c()}function ot(n,t){var i,u;if(n!==""&&!(n.length<1))for(i=0;i<t.options.length;i++)if(t.options[i].value===n){u=$(t.options[i]);l(u.data("action"),u.data("actionid"));r.val("");break}}function st(){vt();i.init(d,$("#vis_filterMenu"));f.init($("#vis_home_ca"),$("#vis_userName"));ht();historyMgr.restoreHistory()}function ht(){e.vis_lhome=v;o=v.show();n.HomeMgr.initHome(v)}function ct(n,i){return e[n]=i,t.push(n),a(n),i}function lt(n){var r,i;return s.find("LI#"+n).remove(),r=e[n],e[n]=null,delete e[n],t.pop(),r=null,i="",i=t.length>0?t[t.length-1]:"vis_lhome",a(i),p(s.find("LI#"+i)),!0}function at(n,t,i){var r=$("<li id="+n+"><img src= "+t+" /> <a >"+i+"<\/a><\/li>");s.append(r);p(r);r=null}function vt(){var n,i,t=[];w||(i=r.attr("list"),n=$("#"+i),n.length>0&&(t=[],n.find("option").each(function(){t.push({label:this.value,value:this.value,action:$(this).data("action"),id:$(this).data("actionid")})}),r.autocomplete({source:t,open:function(){window.setTimeout(function(){$(".ui-autocomplete").css("z-index",1e3)})},select:function(n,t){u=t.item},close:function(){ft()}})),n.remove())}var u=null,o=null,e={},t=[],w=Modernizr.input.list,v=$("#vis_home"),nt=$("#vis_mainSection"),b=$("#vis_mainConatiner"),s=$("#vis_taskbar"),tt=$("#vis_appMenu"),k=$("#vis_mainMenu"),it=$("#vis_closeMenu"),r=$("#vis_menuSearch"),d=$("#vis_divTree"),h=$("#vis_menuOverlay"),y=null;return g(),ut(),{startMenuAction:l,getMainConatiner:rt,toggleContainer:a,registerView:ct,unRegisterView:lt,addTaskBarItem:at,start:st}}n.desktopMgr=u();var f=function(){function et(s,l){s.remove();b=l;o=s;v=s.find("#vis_changeAuthForm");f=s.find("#vis_home_role");r=s.find("#vis_home_client");i=s.find("#vis_home_org");t=s.find("#vis_home_warehouse");y=s.find("#vis_home_warehouseId");e=s.find("#vis-auth-close");u=s.find("#vis-auth-change");tt=s.find('label[for="Login2Model_Role"]');it=s.find('label[for="Login2Model_Client"]');rt=s.find('label[for="Login2Model_Org"]');ut=s.find('label[for="Login2Model_Warehouse"]');k=f.val();d=r.html();g=i.html();nt=t.html();st();$("body").append(c);$("body").append(o);h=n.Application.contextUrl;ot();y.val()=="-1"&&t.val(null)}function ot(){tt.text(Globalize.localize("Role"));it.text(Globalize.localize("Client"));rt.text(Globalize.localize("Organization"));ut.text(Globalize.localize("Warehouse"));u.val(n.Msg.getMsg("Change"));e.val(n.Msg.getMsg("Close"))}function st(){b.on("click",ct);c.on("click",ft);e.on("click",ft);f.on("change",l);r.on("change",l);i.on("change",l);t.on("change",l);v.submit(at)}function ht(){f.val(k);r.html(d);i.html(g);t.html(nt);y.val()=="-1"&&t.val(null);u.prop("disabled",!0);a(v,"");s=!1}function ct(){c.show();o.show("slideDown");e.prop("disabled",!1);u.prop("disabled",!0)}function ft(n){return s&&ht(),c.hide(),o.hide("slideUp"),n.preventDefault(),!1}function w(n,t,i){$.ajax(t,{data:i}).success(function(t){lt(n,t.data)}).fail(function(n){alert(n)})}function l(){if(!p){s||(s=!0,u.prop("disabled",!1));combo=this;combo.id===f.attr("id")?(r.empty(),i.empty(),t.empty(),w(r,h+"Account/GetClients",{Id:combo.value})):combo.id===r.attr("id")?(i.empty(),t.empty(),w(i,h+"Account/GetOrgs",{role:f.val(),user:n.context.getAD_User_ID(),client:combo.value})):combo.id===i.attr("id")?(t.empty(),w(t,h+"Account/GetWarehouse",{id:i.val()})):combo.id===t.attr("id");var e=$("#"+combo.id+"Name"),o=this.options[this.selectedIndex].innerHTML;e.val(o)}}function lt(n,t){p=!0;n.empty();var u=Globalize.localize("SelectWarehouse");n===f?u=Globalize.localize("SelectRole"):n===r?u=Globalize.localize("SelectClient"):n===i&&(u=Globalize.localize("SelectOrg"));$("<option />",{val:"-1",text:u}).appendTo(n);$(t).each(function(){$("<option />",{val:this.Key,text:this.Name}).appendTo(n)});p=!1}function at(n){var t=$(this);a(t,"");e.prop("disabled",!0);u.prop("disabled",!0);t.find("#vis_home_langugage").val(localStorage.getItem("vis_login_langCode"));(!t.valid||t.valid())&&$.post(t.attr("action"),t.serializeArray()).done(function(n){n=n||{};n.success?(window.location=n.redirect||location.href,window.location.href.indexOf("#")!=-1&&location.reload()):n.errors&&(a(t,n.errors),e.prop("disabled",!1),u.prop("disabled",!1))}).error(function(){a(t,["An unknown error happened."]);e.prop("disabled",!1);u.prop("disabled",!1)});n.preventDefault()}var v,f,r,i,t,b,o,e,u,k,d,g,nt,y,s=!1,p=!1,h="",tt,it,rt,ut,c=$('<div class="vis-wakeup-main" >').hide(),vt=function(n){return n.find(".validation-summary-errors, .validation-summary-valid")},a=function(n,t){var i=vt(n).removeClass("validation-summary-valid").addClass("validation-summary-errors"),r=$.map(t,function(n){return"<li>"+Globalize.localize(n)+"<\/li>"}).join("");i.find("ul").empty().append(r)};return{init:et}}(),i=function(){function h(r,o){i.html('<input type="radio" name="filter" id="vis_filter_radio_1" value="A" checked style="margin-bottom:5px;margin:1px;" /><label for="vis_filter_radio_1">'+n.Msg.getMsg("All")+'<\/label><br><input type="radio" name="filter" id="vis_filter_radio_2" value="W" style="margin-bottom:5px;margin:1px;" /><label for="vis_filter_radio_2">'+n.Msg.getMsg("Window")+'<\/label><br><input type="radio" name="filter" id="vis_filter_radio_3" value="X" style="margin-bottom:5px;margin:1px;"/><label for="vis_filter_radio_3">'+n.Msg.getMsg("Form")+'<\/label><br><input type="radio" name="filter" id="vis_filter_radio_4" value="P" style="margin-bottom:5px;margin:1px;"/><label for="vis_filter_radio_4">'+n.Msg.getMsg("Process")+'<\/label><br><input type="radio" name="filter" id="vis_filter_radio_5" value="R" style="margin-bottom:20px;margin:1px;"/><label for="vis_filter_radio_5">'+n.Msg.getMsg("Report")+'<\/label><br/><input type="button" name="filter" style="background-color: #616364;color:white" value='+n.Msg.getMsg("Filter")+"><\/input>");t=r.find(">ul");var s=[],h=null;t.find("li").each(function(){h=$(this);h.data("summary")=="N"&&s.push(h[0].outerHTML)});u=t.html();f=s.join("");s.length=0;s=null;e=o;$("body").append(i);c()}function c(){e.on("click",o);i.on("click","input[type=button]",function(n){n.stopPropagation();var t=i.find("input[type=radio]:checked").val();l(t);s()})}function l(n){n==="A"?(t.empty(),t.html(u)):(t.empty(),t.html(f),t.find("li").hide(),t.find('li > a[data-action="'+n+'"]').parent().show())}function o(){r=!r;r?i.show("slide-down"):i.hide("slide-up")}function s(){r&&o()}var t=null,u="",f="",e=null,r=!1,i=$('<div class="vis-dialog vis-filter-dialog">');return{init:h,closePopup:s}}(),r=function(){function e(n){f.text(n);$("body").append(t)}var t=$('<div class="vis-wakeup-main"><\/div><div class="vis-wakeup"><\/div><div class="vis-wakeup-content"><div style="width: 40%; float: left; height: 100%"><img src="'+n.Application.contextUrl+'Areas/VIS/Images/smiley-sleep.gif" style="padding: 10px;padding-top:15px;" class="vis-wakeup-sleep" /><img src="'+n.Application.contextUrl+'Areas/VIS/Images/smiley-awake.gif" style="padding: 10px;display:none;padding-top:15px;" class="vis-wakeup-awake" /><\/div><div style="width: 60%; height: 100%; float: right;text-align:right"><div style="height: 70%;margin: 10px; overflow: auto;" class="vis-wakeup-text"><\/div><button style="margin-right:5px;">WakeUp <\/button><\/div><\/div><\/div>'),i=t.find("button"),r=t.find(".vis-wakeup-sleep"),u=t.find(".vis-wakeup-awake"),f=t.find(".vis-wakeup-text");i.on("click",function(){i.prop("disabled",!0);r.hide();u.show();window.location.reload()});return{init:e}}(),t=!1;$(document).ajaxError(function(i,u){u.status===401?t||(r.init(n.Msg.getMsg("UnAuthorized")),t=!0):u.status===999?t||(r.init(n.Msg.getMsg("WakeupText")),t=!0):console.log(u.responseText)})}(VIS),function(n){function u(){function w(n,t){l===n?b(t):a===n?k(t):(c===n||p===n)&&d(t)}function o(t,i,u,f){var o=n.Application.contextUrl+"Areas/VIS/Images/base/window-default.png";i&&(o=i);r.addTaskBarItem(t,o,u);f&&(e.push(f),historyMgr.updateHistory(y(e.join(v))))}function y(t){return n.Utility.encode(t)}function h(n,i,u,o){var s,h;return(r.unRegisterView(n),u&&(s=e.indexOf(u),s>-1&&e.splice(s,1),historyMgr.updateHistory(y(e.join(v)))),h=t[n],t[n]=null,delete t[n],f=null,o&&ut(h))?!1:!0}function b(t,r){var f=null,u;return(t.toString().indexOf("&")!=-1&&(f=t.split("&")[1],t=t.split("&")[0]),u=ft(t),u)?(u.show(i,o),s(u),u):(u=new n.AWindow,u.initWindow(t,r,o,l,f)&&(u.onClosed=h,u.show(i),s(u)),u)}function k(t){var r=new n.AWindow;r.initForm(t,o,a)&&(r.onClosed=h,r.show(i),s(r))}function d(t){var r=new n.AWindow;r.initProcess(t,o,c)&&(r.onClosed=h,r.show(i),s(r))}function g(n){n.onClosed=h;n.show(i);o(n.getId(),null,n.getName(),null);s(n)}function s(n){r.registerView(n.getId(),n.getRootLayout());t[n.getId()]=n}function nt(t){var i,e,r,o;try{for(historyMgr.updateHistory("#"),i=[],t.indexOf("&")!=-1&&(t=t.split("&"),i=t[1].split(","),t=t[0]),t=n.Utility.decode(t),e=t.split(v),r=0,o=e.length;r<o;r++)if(e[r].length>0){var s=e[r],u=s.substring(0,1),f=s.substring(2);if(a===u){if(!n.MRole.getFormAccess(f)){console.log("No Form Access");continue}}else if(c===u||p===u){if(!n.MRole.getProcessAccess(f)){console.log("No Process Access");continue}}else if(l===u){if(!n.MRole.getWindowAccess(f)){console.log("No Window Access");continue}i&&i.length>0&&(f+="&"+i.shift())}w(u,f)}}catch(h){historyMgr.updateHistory("#");console.log(h)}}function tt(n){t[n]&&(f=t[n].refresh())}function it(){for(var n in t)t[n].sizeChanged()}function rt(t,i){if(t&&i){var r=t+"="+i;r=y(r);window.open(n.Application.contextUrl+"#"+r);return}alert("improper data")}function ut(t){var i,r;if(!n.Ini.getIsCacheWindow())return!1;for(i=0;i<u.length;i++)if(r=u[i],r.getAD_Window_ID()==t.getAD_Window_ID())return!0;if(t.getAD_Window_ID()!=0)try{return u.push(t),u.length>10&&u.splice(0,1),!0}catch(f){return!1}return!1}function ft(n){for(var i,t=0;t<u.length;t++)if(i=u[t],i.getAD_Window_ID()==n)return u.splice(t,1),i;return}function et(){$(document).on("keydown",ot);$(document).on("mousedown",st)}function ot(n){var t=n.target.tagName;$.inArray(t,["INPUT","SELECT","TEXTAREA"])===-1&&$(n.target).prop("contenteditable")!=="true"&&f&&f&&typeof f.keyDown=="function"&&f.keyDown.call(f,n)}function st(){}var c="P",p="R",l="W",a="X",v="!",e=[],t={},u=[],f=null;return et(),{startAction:w,restoreActions:nt,resize:tt,sizeChanged:it,startWindow:b,startForm:k,startCFrame:g,startActionInNewTab:rt}}function t(t){var i,r;this.frame=new n.AWindow;this.frame.setName("Form");this.onOpened=null;this.onClose=null;i=null;this.contentDispose=null;this.error=!1;this.windowNo=t||n.Env.getWindowNo();this.hideH=!1;r=this;this.setContent=function(t){t.getRoot&&t.getRoot()||(n.Dialog.error("Error",!0,"class must define root element  and implement getRoot function"),t.dispose(),this.error=!0);t.sizeChanged||(t.sizeChanged=function(){});t.refresh||(t.refresh=function(){});t.dispose&&(this.contentDispose=t.dispose,t.dispose=function(){r.dispose()});i=t;this.frame.setCFrameContent(t,this.windowNo);this.hideH&&this.frame.hideHeader(this.hideH)};this.dispose=function(){this.disposing||(this.disposing=!0,this.contentDispose.call(i),this.frame&&this.frame.dispose(),this.frame=null,this.onOpened=null,this.onClose=null,i=null,this.contentDispose=null,r=null)}}var r=n.desktopMgr,i=r.getMainConatiner();t.prototype.setTitle=function(n){this.frame.setTitle(n)};t.prototype.getTitle=function(){return this.frame.getTitle()};t.prototype.setName=function(n){this.frame.setName(n)};t.prototype.show=function(){if(this.error){this.dispose();return}n.viewManager.startCFrame(this.frame);this.onOpened&&this.onOpened()};t.prototype.hideHeader=function(n){this.hideH=n;this.frame.cPanel&&this.frame.hideHeader(n)};n.viewManager=u();n.CFrame=t}(VIS);VIS.context.m_map={};VIS.context.getContext=function(n){if(n==null)throw new ArgumentException("Require Context");if(arguments.length>2)return typeof arguments[1]=="int"?this.getWindowTabContext(arguments[0],arguments[1],arguments[2]):this.getWindowContext(arguments[0],arguments[1],arguments[2]);if(arguments.length==2)return this.getWindowContext(arguments[0],arguments[1]);var t=VIS.context.ctx[n];return t?t:n=="#AD_User_ID"?VIS.context.getContext("#"+n):n=="#AD_User_Name"?VIS.context.getContext("#"+n):""};VIS.context.getWindowContext=function(n,t,i){if(t==null)throw new ArgumentException("Require Context");var u=n+"|"+t,r="";return(this.m_map[n]&&(r=this.m_map[n][u]),!r||r=="")?t.startsWith("#")||t.startsWith("$")?VIS.context.getContext(t):i?"":VIS.context.getContext("#"+t):r};VIS.context.getWindowTabContext=function(n,t,i){if(i==null)throw new ArgumentException("Require Context");var r="";return(this.m_map[n]&&(r=this.m_map[n][n+"|"+t+"|"+i]),!r||r=="")?VIS.context.getWindowContext(n,i,!1):r};VIS.context.setContext=function(n,t){return arguments.length==4?this.setWindowTabContext(arguments[0],arguments[1],arguments[2],arguments[3]):arguments.length==3?this.setWindowContext(arguments[0],arguments[1],arguments[2]):VIS.context.ctx[n]=t,n};VIS.context.setWindowContext=function(n,t,i){t!=null&&(this.m_map[n]||(this.m_map[n]={}),this.m_map[n][n+"|"+t]=i==null||i===""?null:i)};VIS.context.setWindowTabContext=function(n,t,i,r){i!=null&&(this.m_map[n]||(this.m_map[n]={}),this.m_map[n][n+"|"+t+"|"+i]=r==null||String(r).equals("")?null:r)};VIS.context.getAD_User_ID=function(){return VIS.context.getContext("##AD_User_ID")};VIS.context.getAD_User_Name=function(){return this.getContext("#AD_User_Name")};VIS.context.getAD_Role_ID=function(){return this.getContextAsInt("#AD_Role_ID")};VIS.context.getAD_Role_Name=function(){return this.getContext("#AD_Role_Name")};VIS.context.getAD_Client_ID=function(){return VIS.context.getContext("#AD_Client_ID")};VIS.context.getAD_Client_Name=function(){return this.getContext("#AD_Client_Name")};VIS.context.getAD_Org_ID=function(){return VIS.context.getContext("#AD_Org_ID")};VIS.context.getAD_Language=function(){return VIS.context.getContext("#AD_Language")};VIS.context.setAutoCommit=function(n,t){VIS.context.setWindowContext(n,"AutoCommit",t?"Y":"N")};VIS.context.setAutoNew=function(n,t){VIS.context.setWindowContext(n,"AutoNew",t?"Y":"N")};VIS.context.isAutoNew=function(){var n=VIS.context.getContext("AutoNew");return n!=null&&n==="Y"?!0:!1};VIS.context.getStdPrecision=function(){return VIS.context.getContext("#StdPrecision")};VIS.context.setStdPrecision=function(){return VIS.context.getContext("#StdPrecision")};VIS.context.getIsAutoNew=function(n){var t=this.getWindowContext(n,"AutoNew",!1);return t!=null&&t!=""?t.equals("Y")?!0:!1:this.isAutoNew()};VIS.context.isAutoCommit=function(){var n=VIS.context.getContext("AutoCommit");return n!=null&&n==="Y"?!0:!1};VIS.context.setContextOfWindow=function(n,t){if(n&&t){for(prop in n)VIS.context.setWindowContext(t,prop,n[prop]);n=null}};VIS.context.getContextAsInt=function(n,t,i){var r="";if(r=arguments.length>1&&typeof arguments[0]=="number"?this.getWindowContext(n,t,i):this.getContext(arguments[0]),r.length==0)return 0;try{return parseInt(r)}catch(u){}return 0};VIS.context.getWindowContextAsInt=function(n,t,i){var r=this.getWindowContext(n,t,i);if(r.length==0)return 0;try{return parseInt(r)}catch(u){}return 0};VIS.context.getContextAsTime=function(n,t){var i=this.getContext(n,t,!1);return i==null||i.length==0?Date.now().getTime():new Date(i).getTime()};VIS.context.getShowClientOrg=function(){return this.getContextAsInt("#ClientOrgLevel")};VIS.context.removeWindow=function(n){this.m_map[n]=null;delete this.m_map[n];key=null};VIS.context.getWindowCtx=function(n){var t={};return $.extend(t,this.ctx),n&&$.extend(t,this.m_map[n]),t};VIS.context.getEntireCtx=function(){var n={},t;$.extend(n,this.ctx);for(t in this.m_map)this.m_map.hasOwnProperty(t)&&$.extend(n,this.m_map[t]);return n};VIS.context.isSOTrx=function(n){var t=!1;return(t=n?this.getWindowContext(n,"IsSOTrx",!0):this.getContext("IsSOTrx"),t!=null&&t.equals("Y"))?!0:!1};VIS.context.setIsSOTrx=function(){arguments.length==2?this.setContext(arguments[0],"IsSOTrx",arguments[1]?"Y":"N"):this.setContext("IsSOTrx",arguments[0]?"Y":"N")};VIS.Msg={};VIS.Msg.elements={};VIS.I18N.getLabel=function(n,t,i,r){var u,f;if(!VIS.I18N.labels[n])return i&&r&&VIS.I18N.getLabelFromServer(n,t,i,r),"["+n+"]";if(u=VIS.I18N.labels[n],t&&t.length&&t.length>0)for(f=0;f<t.length;f++)u=u.replace("%"+f,t[f]);return i&&r&&(Object.prototype.toString.call(i[r])==="[object Function]"?i[r](u):i[r]=u),u};VIS.I18N.getLabelFromServer=function(n){return"UNDEFINED "+n};VIS.Msg.getMsg=function(n,t,i){if(!VIS.I18N.labels[n])return"["+n+"]";label=VIS.Utility.Util.cleanMnemonic(VIS.I18N.labels[n]);var r=label.split("      ");return t||(label=r[0]),i&&r.length>1&&(label=r[1]),label};VIS.Msg.parseTranslation=function(n,t){var u;if(t==null||t.length==0)return t;for(var i=t,e,f="",r=i.indexOf("@");r!=-1;){if(f+=i.substring(0,r),i=i.substring(r+1,i.length),u=i.indexOf("@"),u<0){i="@"+i;break}e=i.substring(0,u);f+=this.translate(n,e);i=i.substring(u+1,i.length);r=i.indexOf("@")}return f+i};VIS.Msg.translate=function(n,t){return t==null||t.length==0?t:VIS.Msg.translate3(VIS.Env.getAD_Language(n),n.isSOTrx(),t)};VIS.Msg.getElement=function(n,t){return VIS.Msg.getElement3(VIS.Env.getAD_Language(n),t,!0)};VIS.Msg.getElement1=function(n){return VIS.Msg.getElement3(VIS.Env.getAD_Language(VIS.Env.getCtx()),n,!0)};VIS.Msg.translate3=function(n,t,i){var r,u;return i==null||i.equals("")?"":(r=n,(r==null||r.length==0)&&(r=VIS.Env.getBaseAD_Language()),u=VIS.Msg.getElement3(r,i,t),!u.equals(""))?u.trim():i};VIS.Msg.getElement3=function(n,t,i){var r,u,s;if(t==null||t.equals(""))return"";if(r=n,(r==null||r.length==0)&&(r=VIS.Env.getBaseAD_Language()),VIS.Msg.elements[t])return VIS.Msg.elements[t];var f="",o="",e=null;try{r==null||r.length==0||VIS.Env.isBaseLanguage(r,"AD_Element")?(o="SELECT Name, PO_Name FROM AD_Element WHERE UPPER(ColumnName)=@ColumnName",u=[],u[0]=new VIS.DB.SqlParam("@ColumnName",t.toUpper()),e=VIS.DB.executeReader(o,u)):(o="SELECT t.Name, t.PO_Name FROM AD_Element_Trl t, AD_Element e WHERE t.AD_Element_ID=e.AD_Element_ID AND UPPER(e.ColumnName)=@ColumnName AND t.AD_Language=@AD_Language",u=[],u[0]=new VIS.DB.SqlParam("@ColumnName",t.toUpper()),u[1]=new VIS.DB.SqlParam("@AD_Language",r),e=VIS.DB.executeReader(o,u));e.read()&&(f=e.getString(0),i||(s=e.getString(1),s!=null&&s.length>0&&(f=s)));e.close()}catch(h){e.close()}return f!=null&&(f=f.trim()),VIS.Msg.elements[t]=f,f};VIS.MRole.getDefault=function(){return VIS.MRole};VIS.MRole.log=VIS.Logging.VLogger.getVLogger("MRole");VIS.MRole.canUpdate=function(n,t,i,r,u){var e=this.vo.UserLevel.trim(),f=!0,o="";return n==0&&t==0&&e.indexOf("S")==-1?(f=!1,o+="S"):n!=0&&t==0&&e.indexOf("C")==-1?e.indexOf("O")==-1&&this.getIsOrgAccess(t,!0)||(f=!1,o+="C"):n!=0&&t!=0&&e.indexOf("O")==-1&&(f=!1,o+="O"),f&&(f=this.getIsTableAccess(i,!1)),f&&r!=0&&(f=this.getIsRecordAccess(i,r,!1)),!f&&u,f};VIS.MRole.getIsColumnAccess=function(n,t,i){var u,f,r;if(!this.getIsTableAccess(n,i))return!1;for(u=!0,f=this.vo.columnAccess,r=0;r<f.length;r++)if(f[r].IsExclude){if(f[r].AD_Table_ID==n&&f[r].AD_Column_ID==t&&(u=i?!1:!f[r].IsReadOnly,!u))return u}else if(f[r].AD_Table_ID==n&&f[r].AD_Column_ID==t&&(u=i?!0:!f[r].IsReadOnly,!u))return u;return!u,u};VIS.MRole.getIsTableAccessLevel=function(n,t){var i,r;return t?!0:(i=this.vo.tableAccessLevel[n],i==null)?!1:i.equals(VIS.Consts.ACCESSLEVEL_All)?!0:(r=this.vo.UserLevel.trim(),r.indexOf("S")!=-1&&(i.equals(VIS.Consts.ACCESSLEVEL_SystemOnly)||i.equals(VIS.Consts.ACCESSLEVEL_SystemPlusClient)))?!0:r.indexOf("C")!=-1&&(i.equals(VIS.Consts.ACCESSLEVEL_ClientOnly)||i.equals(VIS.Consts.ACCESSLEVEL_SystemPlusClient))?!0:r.indexOf("O")!=-1&&(i.equals(VIS.Consts.ACCESSLEVEL_Organization)||i.equals(VIS.Consts.ACCESSLEVEL_ClientPlusOrganization))?!0:!1};VIS.MRole.canView=function(n){var i=this.vo.UserLevel.trim(),t=!0;return VIS.Consts.ACCESSLEVEL_All.equals(n)?t=!0:VIS.Consts.ACCESSLEVEL_SystemOnly.equals(n)&&i.indexOf("S")==-1?t=!1:VIS.Consts.ACCESSLEVEL_ClientOnly.equals(n)&&i.indexOf("C")==-1?t=!1:VIS.Consts.ACCESSLEVEL_Organization.equals(n)&&i.indexOf("O")==-1?t=!1:!VIS.Consts.ACCESSLEVEL_ClientPlusOrganization.equals(n)||i.indexOf("C")!=-1||i.indexOf("O")!=-1?!VIS.Consts.ACCESSLEVEL_SystemPlusClient.equals(n)||i.indexOf("S")!=-1||i.indexOf("C")!=-1||(t=!1):t=!1,t,t};VIS.MRole.getIsTableAccess=function(n,t){var u,i,r;if(!this.getIsTableAccessLevel(n,t))return!1;for(u=!0,i=this.vo.tableAccess,r=0;r<i.length;r++)if(VIS.Consts.ACCESSTYPERULE_Accessing.equals(i[r].AccessTypeRule))if(i[r].IsExclude){if(i[r].AD_Table_ID===n)return t?i[r].IsReadOnly:!1}else if(u=!1,i[r].AD_Table_ID==n)return t?!0:!i[r].IsReadOnly;return!u,i=null,u};VIS.MRole.getIsCanReport=function(n){var r,t,i;if(!this.vo.IsCanReport||!this.getIsTableAccess(n,!0))return!1;for(r=!0,t=this.vo.tableAccess,i=0;i<t.length;i++)if(VIS.Consts.ACCESSTYPERULE_Reporting.equals(t[i].AccessTypeRule))if(t[i].IsExclude){if(t[i].AD_Table_ID===n)return t[i].IsCanReport}else if(r=!1,t[i].AD_Table_ID===n)return t[i].IsCanReport;return t=null,r};VIS.MRole.getIsCanExport=function(n){var r,t,i;if(!this.vo.IsCanExport||!this.getIsTableAccess(n,!0)||!this.getIsCanReport(n))return!1;for(r=!0,t=this.vo.tableAccess,i=0;i<t.length;i++)if(VIS.Consts.ACCESSTYPERULE_Exporting.equals(t[i].AccessTypeRule))if(t[i].IsExclude){if(t[i].AD_Table_ID===n)return t[i].IsCanExport}else if(r=!1,t[i].AD_Table_ID===n)return t[i].IsCanExport;return t=null,r};VIS.MRole.getIsOrgAccess=function(n,t){var i,r;if(this.vo.IsAccessAllOrgs||n==0&&!t)return!0;for(i=this.vo.orgAccess,r=0;r<i.length;r++)if(i[r].AD_Org_ID===n)return t?i[r].readOnly?!1:!0:!0;return i=null,!1};VIS.MRole.getIsRecordAccess=function(n,t,i){for(var e=!0,u=this.vo.recordAccess,r=null,f=0;f<u.length;f++)if(r=u[f],r.AD_Table_ID===n)if(r.IsExclude){if(r.Record_ID===t)return u=null,i?r.IsReadOnly:!1}else if(e=!1,r.Record_ID===t)return u=null,i?!0:!r.IsReadOnly;return e};VIS.MRole.getClientWhere=function(n){var t,r,u,i,e,f;if(this.vo.IsAccessAllOrgs)return n||this.vo.AD_Client_ID==0?"AD_Client_ID="+this.vo.AD_Client_ID:"AD_Client_ID IN (0,"+this.vo.AD_Client_ID+")";for(t=[],n||t.push("0"),r=0;r<this.vo.orgAccess.length;r++)u=this.vo.orgAccess[r].AD_Client_ID.toString(),t.indexOf(u)<0&&t.push(u),u=null;for(i=new StringBuilder,e=!0,f=0;f<t.length;f++)i.length()>0&&(i.append(","),e=!1),i.append(t[f]);return(t=null,e)?i.length()>0?"AD_Client_ID="+i.toString():(this.log.log(VIS.Logging.Level.SEVERE,"No Access Org records"),"AD_Client_ID=-1"):"AD_Client_ID IN("+i.toString()+")"};VIS.MRole.getOrgWhere=function(n,t){var i,f,e,r,s;if(this.vo.IsAccessAllOrgs)return null;for(i=[],t||i.push("0"),f=this.vo.orgAccess,e=0;e<f.length;e++)r=f[e].AD_Org_ID.toString(),t?r.readOnly||i.indexOf(r)<0&&i.push(r):i.indexOf(r)<0&&i.push(r);if(f=null,i.length==1)return"COALESCE("+(n==null?"":n+".")+"AD_Org_ID,0)="+i[0];if(i.length==0)return this.log.log(VIS.Logging.Level.SEVERE,"No Access Org records"),(n==null?"":n+".")+"AD_Org_ID=-1";var o=new StringBuilder,u=new StringBuilder,h=0;for(s=0;s<i.length;s++)u.length()>0&&u.append(","),u.append(i[s]),h++,(h%999==0||h==i.length)&&(o.length()>0&&o.append(" OR "),o.append("COALESCE("+(n==null?"":n+".")+"AD_Org_ID,0) IN(").append(u.toString()).append(")"),u=null,u=new StringBuilder);return"("+o.toString()+")"};VIS.MRole.getAD_Table_ID=function(n){var t=this.vo.tableName[n];return t!=null?t:0};VIS.MRole.getSynonym=function(n){var t=this.columnSynonym[n];return t?t:null};VIS.MRole.getKeyColumnName=function(n,t){var u=this.getSynonym(t),i,r;if(u==null)return t;for(i=0;i<n.length;i++)if(r=n[i],t.equals("AD_User_ID")){if(r.getTableName().equals("AD_User"))return t}else if(t.equals("AD_ElementValue_ID")&&r.getTableName().equals("AD_ElementValue"))return t;return u};VIS.MRole.getDependentAccess=function(n,t,i){var r,u;if(t.length==0&&i.length==0)return"";if(t.length!=0&&i.length!=0&&this.log.warning("Mixing Include and Excluse rules - Will not return values"),r=new StringBuilder(" AND "),t.length==1)r.append(n).append("=").append(t[0]);else if(t.length>1){for(r.append(n).append(" IN ("),u=0;u<t.length;u++)u>0&&r.append(","),r.append(t[u]);r.append(")")}else if(i.length==1)r.append(n).append("<>").append(i[0]);else if(i.length>1){for(r.append(n).append(" NOT IN ("),u=0;u<i.length;u++)u>0&&r.append(","),r.append(i[u]);r.append(")")}return r.toString()};VIS.MRole.getDependentRecordWhereColumn=function(n,t){var f=t,e=n.indexOf(t),u=e-1,i=n.charAt(u),r;if(i=="."){for(r=new StringBuilder;i!=" "&&i!=","&&i!="(";)r.insert(0,i),i=n.charAt(--u);return r.append(t),r.toString()}return f};VIS.MRole.getRecordWhere=function(n,t,i){for(var e=new StringBuilder,o=new StringBuilder,f=this.vo.recordAccess,r,s,u=0;u<f.length;u++)f[u].AD_Table_ID==n&&(f[u].IsExclude?(o.length()==0?o.append(t).append(" NOT IN ("):o.append(","),o.append(f[u].Record_ID)):i&&f[u].IsReadOnly||(e.length()==0?e.append(t).append(" IN ("):e.append(","),e.append(f[u].Record_ID)));return r=new StringBuilder,o.length()>0&&r.append(o).append(")"),e.length()>0&&(r.length()>0&&r.append(" AND "),r.append(e).append(")")),this.vo.IsPersonalAccess||!this.vo.tableData[n].IsView&&this.vo.tableData[n].HasKey&&(s=" NOT IN ( SELECT Record_ID FROM AD_Private_Access WHERE AD_Table_ID = "+n+" AND AD_User_ID <> "+this.vo.AD_User_ID+" AND IsActive = 'Y' )",r.length()>0&&r.append(" AND "),r.append(t).append(s)),f=null,r.toString()};VIS.MRole.getDocWhere=function(n){if(!this.vo.IsUseBPRestrictions)return"";var r=!1,u="SELECT count(*) FROM AD_Table t INNER JOIN AD_Column c ON (t.AD_Table_ID=c.AD_Table_ID) WHERE t.TableName='"+n+"' AND c.ColumnName='C_BPartner_ID' ",t=VIS.DB.executeScalar(u);if(r=(t?parseInt(t):0)!=0,!r)return"";var i=VIS.context.getAD_User_ID(),f="(EXISTS (SELECT 1 FROM C_BPartner bp INNER JOIN AD_User u ON (u.C_BPartner_ID=bp.C_BPartner_ID)  WHERE u.AD_User_ID="+i+" AND bp.C_BPartner_ID="+n+".C_BPartner_ID) OR EXISTS (SELECT 1 FROM C_BP_Relation bpr INNER JOIN AD_User u ON (u.C_BPartner_ID=bpr.C_BPartnerRelation_ID)  WHERE u.AD_User_ID="+i+" AND bpr.C_BPartner_ID="+n+".C_BPartner_ID)",e=!1,o="SELECT count(*) FROM AD_Table t INNER JOIN AD_Column c ON (t.AD_Table_ID=c.AD_Table_ID) WHERE t.tableName='"+n+"' AND c.ColumnName='AD_User_ID' ";return t=VIS.DB.executeScalar(u),e=(t?parseInt(t):0)!=0,e&&(f+=" OR "+n+".AD_User_ID ="+i),f+")"};VIS.MRole.addAccessSQL=function(n,t,r,u,f){var a,h,o,d,ut,s,b,p,k,v,g,w,y,tt,l,st,it;r&&VIS.Utility.Util.isEmpty(t)&&(r=!1);var e=new StringBuilder,ot="",rt=n.lastIndexOf(" ORDER BY ");for(rt!=-1?(ot=n.substring(rt),e.append(n.substring(0,rt))):e.append(n),a=new VIS.AccessSqlParser(e.toString()),h=a.getTableInfo(a.getMainSqlIndex()),a.getMainSql().indexOf(" WHERE ")==-1?e.append(" WHERE "):e.append(" AND "),o="",h.length>0&&(h[0].getTableName().equals(t)||h[0].getSynonym().equals(t))&&(o=h[0].getSynonym(),VIS.Utility.Util.isEmpty(o)&&(o=h[0].getTableName())),!VIS.Utility.Util.isEmpty(t)&&VIS.Utility.Util.isEmpty(o)&&(d="TableName not correctly parsed - TableNameIn="+t+" - "+a,h.length>0&&(d+=" - #1 "+h[0]),d+="\n = "+n,this.log.log(VIS.Logging.Level.SEVERE,d),o=t),r&&!VIS.Utility.Util.isEmpty(o)&&e.append(o).append("."),e.append(this.getClientWhere(u)),this.vo.IsAccessAllOrgs||f||(e.append(" AND "),r&&!VIS.Utility.Util.isEmpty(o)?e.append(this.getOrgWhere(o,u)):e.append(this.getOrgWhere(null,u))),this.vo.IsUseBPRestrictions&&(ut=this.getDocWhere(o),ut.length()>0&&(e.append(" AND "),e.append(ut))),s=0,i=0;i<h.length;i++){if(b=h[i],p=b.getTableName(),s=this.getAD_Table_ID(p),s!=0&&!this.vo.IsAccessAllOrgs&&f&&(k=b.getSynonym(),(k==null||k.isEmpty())&&(k=p),e.append(" AND "),e.append(this.getOrgWhere(k,u))),s!=0&&!this.getIsTableAccess(s,!u)){e.append(" AND 1=3");this.log.fine("No access to AD_Table_ID="+s+" - "+p+" - "+e);break}v="";r&&(v=b.getSynonym(),v.length==0&&(v=p),v+=".");v+=p+"_ID";g=this.getRecordWhere(s,v,u);g.length>0&&(e.append(" AND ").append(g),this.log.finest("Record access - "+g))}b=null;w=a.getMainSql();s=0;var nt=null,ft=[],et=[],c=this.vo.recordDependentAccess;for(i=0;i<c.length;i++)(y=this.getKeyColumnName(a.getTableInfo(a.getMainSqlIndex()),c[i].KeyColumnName),y!=null)&&(tt=w.indexOf(y),tt!=-1)&&(l=w.charAt(tt-1),l==","||l=="."||l==" "||l=="(")&&(l=w.charAt(tt+y.length),l==","||l==" "||l==")")&&(s!=0&&s!=c[i].AD_Table_ID&&e.append(this.getDependentAccess(nt,ft,et)),s=c[i].AD_Table_ID,c[i].IsExclude?(et.push(c[i].Record_ID),this.log.fine("Exclude "+y+" - "+c[i])):u&&c[i].IsReadOnly||ft.push(c[i].Record_ID),st=null,st!=null?(it="",nt=it==null||it.length()==0?this.getDependentRecordWhereColumn(w,y):it):nt=this.getDependentRecordWhereColumn(w,y));return e.append(this.getDependentAccess(nt,ft,et)),e.append(ot),e.toString()};VIS.MRole.getWindowAccess=function(n){return this.vo.windowAccess[n]?!0:!1};VIS.MRole.getFormAccess=function(n){return this.vo.formAccess[n]?!0:!1};VIS.MRole.getProcessAccess=function(n){return this.vo.processAccess[n]?!0:!1};VIS.MRole.getIsClientAccess=function(n,t){var r,i;if(n==0&&!t)return!0;for(r=this.vo.orgAccess,i=0;i<r.length;i++)if(r[i].AD_Client_ID==n&&(!t||!r[i].readOnly))return!0;return!1};VIS.MRole.getIsShowPreference=function(){return this.vo.IsShowPreference};VIS.MRole.getName=function(){return this.vo.Name};VIS.MRole.getPreferenceType=function(){return this.vo.PreferenceType};VIS.MRole.getIsDisplayClient=function(){return this.vo.IsDisplayClient};VIS.MRole.getIsDisplayOrg=function(){return this.vo.IsDisplayOrg};VIS.MRole.getIsPersonalLock=function(){return this.vo.IsPersonalLock};VIS.MRole.getMaxQueryRecords=function(){return this.vo.MaxQueryRecords};VIS.MRole.getIsQueryMax=function(n){var t=this.getMaxQueryRecords();return t>0&&n>t};VIS.MRole.getIsShowAcct=function(){return this.vo.IsShowAcct};VIS.MRole.getIsOverwritePriceLimit=function(){return this.vo.IsOverwritePriceLimit};VIS.MRole.getIsOverrideReturnPolicy=function(){return this.vo.IsOverrideReturnPolicy};VIS.MRole.toStringX=function(n){var t=new StringBuilder;return t.append(VIS.Msg.translate(n,"AD_Role_ID")).append("=").append(this.getName()).append(" - ").append(VIS.Msg.translate(n,"IsCanExport")).append("=").append(this.getIsCanExport()).append(" - ").append(VIS.Msg.translate(n,"IsCanReport")).append("=").append(this.getIsCanReport()).append(VIS.Env.NL).append(VIS.Env.NL),t.toString()},function(n){n.ADialog={info:function(t,i,r){var u="";t==null||t.equals("")||(u+=n.Msg.getMsg(t));r!=null&&r.length>0&&(u+="\n"+r);alert(u);u=null},ask:function(t,i,r){var u="",f;return t==null||t.equals("")||(u+=n.Msg.getMsg(t)),r!=null&&r.length>0&&(u+="\n"+r),f=!1,confirm(u)&&(f=!0),f},error:function(t,i,r){var u="";t==null||t.equals("")||(u+=n.Msg.getMsg(t));r!=null&&r.length>0&&(u+="\n"+r);alert(u);u=null},warn:function(t,i,r){var u="";t==null||t.equals("")||(u+=n.Msg.getMsg(t));r!=null&&r.length>0&&(u+="\n"+r);alert(u);u=null}}}(VIS,jQuery),function(n,t){function i(n,t,i,r,u){this.info=n;this.lookup=null;this.allLoaded=!1;this.hasInactive=!1;this.displayType=u;this.selectedObject;this.windowNo=r;this.validationDisabled=!1;this.data=[];this.ctx=i;t&&(this.lookup=t._lookup,this.allLoaded=t._allLoaded,this.hasInactive=t._hasInactive,this.displayType=t._displayType,this.windowNo=t._WindowNo,this.info&&(this.info.windowNo=t._WindowNo))}function r(t,r){i.call(this,t,r);this.lookupDirect={};this.directNullKey;this.loading=!1;this.nextRead=0;this.cLookup=!1;this.lookupDirectAll={};this.zomQuery=null;this.prepareZQuery();this.log=n.Logging.VLogger.getVLogger("MLookup")}function f(t,r){i.call(this,null,null,t,r,n.DisplayType.TableDir);this.lookup={};this.load()}function u(t,r){i.call(this,null,null,t,r,n.DisplayType.TableDir);this.C_Locator_ID=0;this.onlyWarehouseID=0;this.onlyProductID=0;this.onlyOutgoing=!1;this.lookup={};this.maxRows=1e4;this.defaultID="";this.log=n.Logging.VLogger.getVLogger("MLocatorLookup");this.load(!1);this.disposeLocal=function(){this.lookup=null;this.log=null}}function o(t,r){i.call(this,null,null,t,r,n.DisplayType.TableDir);this.log=n.Logging.VLogger.getVLogger("MAccountLookup");this.C_ValidCombination_ID=0;this.combination;this.description}function c(t,r){i.call(this,null,null,t,r,n.DisplayType.TableDir);this.NO_INSTANCE={Key:0,Name:""};this.log=n.Logging.VLogger.getVLogger("MPAttributeLookup")}function s(t,r){i.call(this,null,null,t,r,n.DisplayType.TableDir);this.NO_INSTANCE={Key:0,Name:""};this.log=n.Logging.VLogger.getVLogger("MGAttributeLookup")}var e=n.DB,h=n.Logging.Level;i.prototype.INACTIVE_S="~";i.prototype.INACTIVE_E="~";i.prototype.MAX_ROWS=1e4;i.prototype.MINUS_ONE=-1;i.prototype.getValidation=function(){return""};i.prototype.getWindowNo=function(){return this.windowNo};i.prototype.getDisplayType=function(){return this.displayType};i.prototype.setDisplayType=function(n){this.displayType=n};i.prototype.disableValidation=function(){this.validationDisabled=!0};i.prototype.getIsValidationDisabled=function(){return this.validationDisabled};i.prototype.getIsValidated=function(){return!0};i.prototype.getHasInactive=function(){return this.hasInactive};i.prototype.getData=function(){return[]};i.prototype.getDisplay=function(){return""};i.prototype.getSelectedItem=function(){return this.selectedObject};i.prototype.fillCombobox=function(n,t,i,r){var u=this.selectedObject,f;this.data!=null&&(this.data.length=0);this.data=this.getData(n,t,i,r);f=0;this.data!=null&&(f=this.data.length);u!=this.selectedObject&&(u=this.selectedObject);u==null&&n&&f>0&&(u=this.data[0],this.selectedObject=u)};i.prototype.setSelectedItem=function(n){(this.selectedObject!=null&&this.selectedObject!==n||this.selectedObject==null&&n!=null)&&this.setSelectedItemAlways(n)};i.prototype.setSelectedItemAlways=function(n){this.selectedObject=this.data.indexOf(n)>-1||n==null?n:null};i.prototype.refresh=function(){return 0};i.prototype.getZoomQuery=function(){return null};i.prototype.getColumnName=function(){return this.info.keyColumn};i.prototype.dispose=function(){this.info=null;this.lookup=null;this.allLoaded=null;this._hasInactive=null;this.selectedObject=null;this.data=null;this.ctx=null};i.prototype.removeAllElements=function(){this.data.length>0&&(this.data.length=0,this.selectedObject=null)};i.prototype.clear=function(){this.removeAllElements()};n.Utility.inheritPrototype(r,i);r.prototype.prepareZQuery=function(){var r,f,u,i;if(this.info.zoomQuery!=null&&!t.isEmptyObject(this.info.zoomQuery))for(r=this.info.zoomQuery,this.zomQuery=new n.Query(r._tableName),f=null,u=0;u<r._list.length;u++)i=r._list[u],f=new n.QueryRestriction(i.ColumnName,i.Code,i.Code_to,i.InfoName,r.InfoDisplay,i.InfoDisplay_to,i.Operator,i.DirectWhereClause,i.AndCondition),this.zomQuery.addRestriction(f)};r.prototype.initialize=function(n){return n?this:this.info.isCreadedUpdatedBy?this:this.info.isParent||this.info.isKey?(this.hasInactive=!0,this):(this.info.isValidated?this.load(!0,!0):this.fillDirectList(),this)};r.prototype.getValidation=function(){return this.getIsValidationDisabled()?"":this.info.validationCode};r.prototype.getIsValidated=function(){return this.getIsValidationDisabled()?!0:this.info==null?!1:this.info.isValidated};r.prototype.getData=function(n,t,i,r){var u=this.getData2(t,r),f,o,e,s;if(i&&this.hasInactive)for(f=u.length;f>0;f--)o=u[f-1],o!=null&&(e=o.Name,e.startsWith(this.INACTIVE_S)&&e.endsWith(this.INACTIVE_E)&&(console.log(e),u.splice(f-1,1)));return n||(s=null,s=this.info.keyColumn!=null&&this.info.keyColumn.toUpperCase().endsWith("_ID")?{Key:-1,Name:""}:{Key:"",Name:""},u.unshift(s)),u};r.prototype.getData2=function(n,i){return((!this.allLoaded||t.isEmptyObject(this.lookup))&&this.refresh(i),this.info.isValidated)?this.getObjectArray(this.lookup):(!this.info.isValidated&&n&&this.refresh(i),this.getObjectArray(this.lookup))};r.prototype.getObjectArray=function(n){var t=[],r=0,i;for(i in n)t[r++]=n[i];return t};r.prototype.getDisplay=function(n,t){if(n==null)return"";var i=t?this.getFromList(n):this.get(n);return i==null?"<"+n.toString()+">":i.Name};r.prototype.get=function(i){var r,u;return i==null||this.MINUS_ONE===i?null:(this.info.isParent&&this.nextRead<Date.now()&&(this.lookup=null,this.lookup={},this.lookupDirect&&(this.lookupDirect=null,this.lookupDirect={}),this.nextRead=Date.now()+500),r=this.lookup[" "+i],r)?r:!this.info.isParent&&this.info.isValidated&&this.allLoaded?this.getDirect(i,!1,!0):!this.allLoaded&&t.isEmptyObject(this.lookup)&&!this.info.isCreadedUpdatedBy&&!this.info.isParent&&this.getDisplayType()!=n.DisplayType.Search&&(this.load(),r=this.lookup[" "+i],r!=null)?r:(u=this.info.isValidated,this.getDirect(i,!1,u))};r.prototype.getFromList=function(i){var r,u;return i==null||this.MINUS_ONE===i?null:this.info.isParent&&this.nextRead<Date.now()?(this.lookup=null,this.lookup={},this.lookupDirect&&(this.lookupDirect=null,this.lookupDirect={}),this.nextRead=Date.now()+500,this.get(i)):(r=this.lookup[" "+i],r!=null)?r:!this.info.isParent&&this.info.isValidated&&this.allLoaded?this.getDirectFromList(i,!1,!0):!this.allLoaded&&t.isEmptyObject(this.lookup)&&!this.info.isCreadedUpdatedBy&&!this.info.isParent&&this.getDisplayType()!=n.DisplayType.Search&&(r=this.lookup[" "+i],r!=null)?r:(u=this.info.isValidated,this.getDirectFromList(i,!1,u))};r.prototype.getDirect=function(t,i,r){var u,h,c,s,f,o,p,l,a,v,y;if(t==null||this.info.queryDirect==null||this.info.queryDirect.length==0||t===this.directNullKey)return null;if(u=null,this.lookupDirect!=null&&(u=this.lookupDirect[t],u))return u;h=this.info.keyColumn.toUpperCase().endsWith("_ID");try{c=this.info.queryDirect;s=[];h?s.push(new e.SqlParam("@key",parseInt(t))):s.push(new e.SqlParam("@key",t.toString()));f=e.executeDataReader(c,s);f.read()?(o=f.getString(2),p=f.getString(3).equals("Y"),p||(o=this.INACTIVE_S+o+this.INACTIVE_E,this.hasInactive=!0),h?(l=f.getInt(0),a={Key:l,Name:n.Utility.encodeText(o)},i&&(this.lookup[" "+l]=a),u=a):(v=f.getString(1),y={Key:v,Name:n.Utility.encodeText(o)},i&&(this.lookup[" "+v]=y),u=y),f.read()&&this.log.log(n.Logging.Level.SEVERE,this.info.keyColumn+": Not unique (first returned) for "+t+" SQL="+c)):(this.directNullKey=t,u=null)}catch(w){this.log.log(n.Logging.Level.SEVERE,this.info.keyColumn+": SQL="+this.info.queryDirect+"; Key="+t,w);u=null}finally{f!=null&&f.dispose();f=null}return r&&!i&&u!=null&&(this.lookupDirect==null&&(this.lookupDirect={}),this.lookupDirect[t]=u),this.hasInactive=!0,u};r.prototype.getDirectFromList=function(n,t,i){var r,u,f;return n==null||this.info.queryDirect==null||this.info.queryDirect.length==0?null:n===this.directNullKey?null:(r=null,this.lookupDirect!=null&&(u=null,u=this.lookupDirect[" "+n],u&&u!=null))?u:(this.lookupDirectAll[" "+n]?(f=this.lookupDirectAll[" "+n],t&&(this.lookup[" "+n]=f),r=f):this.loading||(this.addInList(n),r=null),i&&!t&&r!=null&&(this.lookupDirect==null&&(this.lookupDirect={}),this.lookupDirect[" "+n]=r),this.hasInactive=!0,r)};r.prototype.addInList=function(t){var f,i;if(!(this.info.queryDirect.length<=0)&&t!=null){var r=this.info.keyColumn.toUpperCase().endsWith("_ID"),o=this.info.queryDirect,u=[];r?u.push(new e.SqlParam("@key",parseInt(t))):u.push(new e.SqlParam("@key",t.toString()));f=this.info.queryDirect.replace("@key",t.toString());i=this;n.DB.executeDataReader(f,null,function(u){var f,e,o;try{u.read()?(f=u.getString(2),r?(e=n.Utility.Util.getValueOfInt(u.getCell(0)),i.lookupDirectAll[" "+e]={Key:e,Name:n.Utility.encodeText(f)}):(o=u.getString(1),i.lookupDirectAll[" "+o]={Key:o,Name:n.Utility.encodeText(f)})):i.directNullKey=t}catch(s){console.log(s)}i=null})}};r.prototype.load=function(t,i){var r=this.info.query,o,h,f,u;if(!this.info.isValidated){if(o=n.Env.parseContext(n.context,this.getWindowNo(),this.info.validationCode,!1),o.length==0&&this.info.validationCode.length>0){this.log.fine(this.info.keyColumn+": Loader NOT Validated: "+this.info.validationCode);return}var l=r.lastIndexOf(" FROM "),c=r.indexOf(" WHERE ",l)!=-1,s=r.lastIndexOf(" ORDER BY ");s!=-1?r=r.substring(0,s)+(c?" AND ":" WHERE ")+o+r.substring(s):r+=(c?" AND ":" WHERE ")+o;this.log.fine(this.info.keyColumn+": Validation="+o)}if(h=this.info.keyColumn.toUpperCase().endsWith("_ID"),this.hasInactive=!1,f=null,this.lookup={},i&&(this.cLookup=!1,n.MLookupCache.loadFromCache(this.info,this)))return this;if(t)return u=this,u.loading=!0,e.executeDataReaderPaging(r,1,1e3,null,function(t){u.readData(t,h);i&&n.MLookupCache.loadEnd(u.info,u);u.loading=!1;u=null}),0;try{f=e.executeDataReader(r,null);this.readData(f,h);i&&n.MLookupCache.loadEnd(this.info,this)}catch(a){this.log.log(n.Logging.Level.SEVERE,this.info.keyColumn+": Loader - "+r,a)}finally{f!=null&&(f.dispose(),f=null)}return 0};r.prototype.fillDirectList=function(){var i,t;this.info.queryAll==null||this.info.queryAll.length<=0||(i=this.info.queryAll,this.cLookup=!0,n.MLookupCache.loadFromCache(this.info,this))||(t=this,n.DB.executeDataReaderPaging(i,1,1e3,null,function(i){var e,r,u,f;try{for(e=t.info.keyColumn.endsWith("_ID");i.read();)r=i.getString(2),e?(u=i.getInt(0),t.lookupDirectAll[" "+u]={Key:u,Name:n.Utility.encodeText(r)}):(f=i.getString(1),t.lookupDirectAll[" "+f]={Key:f,Name:n.Utility.encodeText(r)})}catch(o){console.log(o)}n.MLookupCache.loadEnd(t.info,t);t.loading=!1;t=null}),this.loading=!0)};r.prototype.readData=function(t,i){var u={},c=0,r,o,f,s,e,h;for(this.allLoaded=!0;t.read();){if(c++>this.MAX_ROWS){this.log.fine(this.info.keyColumn+": Loader - Too many records");this.allLoaded=!1;break}r=t.getString(2);o=t.getString(3).equals("Y");o||(r=this.INACTIVE_S+r+this.INACTIVE_E,this.hasInactive=!0);i?(f=t.getInt(0),s={Key:f,Name:n.Utility.encodeText(r)},u[" "+f]=s):(e=t.getString(1),h={Key:e,Name:n.Utility.encodeText(r)},u[" "+e]=h)}this.lookup=null;this.lookup=u;this.loading=!1};r.prototype.refresh=function(){if(this.getDisplayType()==n.DisplayType.Search||this.info.IsCreadedUpdatedBy||this.loading)return 0;return this.load()};r.prototype.clear=function(){this.$super.clear.call(this);this.lookup={}};r.prototype.getCLookup=function(){return this.cLookup&&this.lookupDirectAll,this.lookup};r.prototype.setCLookup=function(n){this.cLookup&&(this.lookupDirectAll=n);this.lookup=n};r.prototype.getIsLoading=function(){return this.loading};r.prototype.setIsLoading=function(n){this.loading=n};r.prototype.getZoomWindow=function(){if(arguments.length==0)return this.info.zoomWindow;var t=arguments[0];return n.ZoomTarget.getZoomAD_Window_ID(this.info.tableName,this.windowNo,t.getWhereClause(),n.context.isSOTrx(this.windowNo))};r.prototype.getZoomQuery=function(){return this.zomQuery};r.prototype.getAD_Reference_Value_ID=function(){return this.info.AD_Reference_Value_ID};r.prototype.disableValidation=function(){var t=this.info.validationCode;this.$super.disableValidation.call(this);this.info.isValidated=!0;this.info.validationCode="";t!=null&&t.length>0&&(t.indexOf("@")!=-1&&this.getDisplayType()==n.DisplayType.Table||this.getDisplayType()==n.DisplayType.TableDir)&&this.setDisplayType(n.DisplayType.Search)};r.prototype.dispose=function(){this.$super.dispose.call(this);this.lookupDirect=null;this.directNullKey=null;this.log=null};n.Utility.inheritPrototype(f,i);f.prototype.cacheLookup=null;f.prototype.getDisplay=function(n){if(n==null)return"";var t=this.getLocation(n,null);return t==null?"<"+n.toString()+">":t.Name};f.prototype.get=function(n){if(n==null)return null;var t=this.getLocation(n,null);return t==null?null:t};f.prototype.getColumnName=function(){return"C_Location_ID"};f.prototype.getLocation=function(t,i){if(t==null)return null;if(t in this.lookup)return this.lookup[t];var r=n.dataContext.getJSONData(n.Application.contextUrl+"Location/GetLocation",{id:t});return(this.lookup[t]=r.LocItem,this.lstLatLng[t]=r.LocLatLng,!i)?r.LocItem:r.LocLatLng};f.prototype.refreshLocation=function(t){if(t==null)return null;var i=n.dataContext.getJSONData(n.Application.contextUrl+"Location/GetLocation",{id:t});return this.lookup[t]=i.LocItem,this.lstLatLng[t]=i.LocLatLng,i};f.prototype.load=function(){var t=this;if(t.lstLatLng={},f.prototype.cacheLookup!=null){t.lookup=f.prototype.cacheLookup.LocLookup;t.lstLatLng=f.prototype.cacheLookup.LocLatLng;t=null;return}n.dataContext.getJSONData(n.Application.contextUrl+"Location/GetLocations","",function(n){f.prototype.cacheLookup||(f.prototype.cacheLookup=n);t.lookup=n.LocLookup;t.lstLatLng=n.LocLatLng;t=null})};f.prototype.getLatLng=function(n){if(n==null||n.toString().len<1)return null;if(n in this.lstLatLng)return this.lstLatLng[n];return this.getLocation(n,!0)};f.prototype.dispose=function(){this.lstLatLng=null;this.$super.dispose.call(this);this.lookup=null};n.Utility.inheritPrototype(u,i);u.prototype.getDefault=function(){return this.defaultID};u.prototype.getOnlyWarehouseID=function(){return this.onlyWarehouseID};u.prototype.getOnlyProductId=function(){return this.onlyProductID};u.prototype.getIsOnlyOutgoing=function(){return this.onlyOutgoing};u.prototype.setOnlyWarehouseID=function(n){this.onlyWarehouseID=n};u.prototype.setOnlyProductID=function(n){this.onlyProductID=n};u.prototype.setOnlyOutgoing=function(n){this.onlyOutgoing=n};u.prototype.getDirect=function(t,i){var u;if(t==null)return null;var e="SELECT Value FROM M_Locator WHERE IsActive='Y' and M_Locator_ID="+t,r=n.DB.executeDataReader(e),f="";if(r.read())f=r.getString(0);else return null;return r.dispose(),u={Key:t,Name:n.Utility.encodeText(f)},i&&(this.lookup[" "+t]=u),u};u.prototype.getIsValid=function(n){if(n==null)return!0;var t=this.lookup[n];return t!=null};u.prototype.load=function(i){var l=[],a=0,h=0,y=this.getOnlyWarehouseID(),p=this.getOnlyProductId(),b=this.getIsOnlyOutgoing(),v="Value",c,r,s;try{var u="SELECT ColumnName FROM AD_Column WHERE AD_Table_ID = 207 AND IsIdentifier  = 'Y' AND SeqNo  IS NOT NULL ORDER BY SeqNo",o=n.DB.executeDataSet(u,a>0?l:null),f=o.getTable(0),w=f.getRows().length;for(r=0;r<w;r++)r==0?v=f.getRow(r).getCell(0):v+=" || '_' || "+f.getRow(r).getCell(0);o.dispose();o=null}catch(k){this.log.log(n.Logging.Level.SEVERE,u,k);v="Value"}u="SELECT M_Locator_ID,"+v+" FROM M_Locator WHERE IsActive='Y'";y!=0&&(u+=" AND M_Warehouse_ID=@w");p!=0&&(u+=" AND (IsDefault='Y' OR EXISTS (SELECT * FROM M_Storage s WHERE s.M_Locator_ID=M_Locator.M_Locator_ID AND s.M_Product_ID=@p)",b!=null&&b.value||(u+="OR EXISTS (SELECT * FROM M_Product p WHERE p.M_Locator_ID=M_Locator.M_Locator_ID AND p.M_Product_ID=@p)OR EXISTS (SELECT * FROM M_ProductLocator pl  WHERE pl.M_Locator_ID=M_Locator.M_Locator_ID AND pl.M_Product_ID=@p) OR 0 = (SELECT COUNT(*) FROM M_ProductLocator pl  INNER JOIN M_Locator l2 ON (pl.M_Locator_ID=l2.M_Locator_ID) WHERE pl.M_Product_ID=@p AND l2.M_Warehouse_ID=M_Locator.M_Warehouse_ID )"),u+=")");c=n.MRole.addAccessSQL(u,"M_Locator",n.MRole.SQL_NOTQUALIFIED,n.MRole.SQL_RO);this.lookup=null;this.lookup={};try{if(y!=0&&(l.push(new e.SqlParam("@w",parseInt(y))),a+=1),p!=0&&(l.push(new e.SqlParam("@p",p)),a+=1),i){var o=n.DB.executeDataSet(c,a>0?l:null),f=o.getTable(0),w=f.getRows().length;for(r=0;r<w;r++){if(h++>this.maxRows){this.log.warning("Over Max Rows - "+h);break}this.lookup[f.getRow(r).getCell(0)]={Key:f.getRow(r).getCell(0),Name:n.Utility.Util.getValueOfString(f.getRow(r).getCell(1))}}o.dispose();o=null;this.log.fine("Complete #"+h)}else s=this,n.DB.executeDataSet(c,a>0?l:null,function(t){var r,u,i;try{for(r=t.getTable(0),u=r.getRows().length,i=0;i<u;i++){if(h++>s.maxRows){s.log.warning("Over Max Rows - "+h);break}s.lookup[r.getRow(i).getCell(0)]={Key:r.getRow(i).getCell(0),Name:n.Utility.Util.getValueOfString(r.getRow(i).getCell(1))}}t.dispose();t=null;s.log.fine("Complete #"+h)}catch(f){s.log(n.Logging.Level.SEVERE,c,f)}s=null})}catch(d){this.log.log(n.Logging.Level.SEVERE,c,d)}i&&t.isEmptyObject(this.lookup)&&this.log.Finer(c)};u.prototype.get=function(n){if(n==null)return null;var i=Number(n),t=this.lookup[i];return t!=null?t:this.getDirect(n,!0,null)};u.prototype.getDisplay=function(n){if(n==null)return"";var t=this.get(n);return t==null?"<"+n.toString()+">":t.Name};u.prototype.getData=function(){var n=this.lookup;return t.map(this.lookup,function(n){return n})};u.prototype.refresh=function(){this.log.fine("start");try{this.load(!0)}catch(n){this.log.severe("#"+this.lookup.Count)}return this.log.info("#"+this.lookup.Count),this.lookup.length};u.prototype.getColumnName=function(){return"M_Locator.M_Locator_ID"};u.prototype.dispose=function(){this.disposeLocal();this.$super.dispose.call(this);this.lookupDirect=null;this.directNullKey=null;this.log=null;this.disposeLocal=null};n.Utility.inheritPrototype(o,i);o.prototype.getDisplay=function(n){return this.containsKey(n)?this.toStringX():"<"+n.toString()+">"};o.prototype.toStringX=function(){return this.C_ValidCombination_ID==0?"":this.combination};o.prototype.containsKey=function(n){var t=0;return n!=null&&(t=parseInt(n.toString())),this.load(t)};o.prototype.load=function(n){if(n==0)return this.C_ValidCombination_ID=0,this.combination="",this.description="",!0;if(n==this.C_ValidCombination_ID)return!0;var i="SELECT C_ValidCombination_ID, Combination, Description FROM C_ValidCombination WHERE C_ValidCombination_ID="+n,t=null;try{if(t=e.executeDataReader(i,null),!t.read())return!1;this.C_ValidCombination_ID=t.getInt(0);this.combination=t.getString(1);this.description=t.getString(2)}catch(r){return!1}return!0};o.prototype.getColumnName=function(){return""};o.prototype.getData=function(n,t,i){var f=[],u,r;n||f.push({Key:-1,Name:""});u="SELECT C_ValidCombination_ID, Combination, Description FROM C_ValidCombination WHERE AD_Client_ID="+this.ctx.getAD_Client_ID();i&&(u+=" AND IsActive='Y'");u.append(" ORDER BY 2");r=null;try{for(r=e.executeDataReader(u.toString(),null);r.read();)f.push({Key:r.getInt(0),Name:r.getString(1)+" - "+r.getString(2)})}catch(o){this.log.log(h.SEVERE,u,o)}return f};n.Utility.inheritPrototype(c,i);c.prototype.getDisplay=function(n){if(n==null)return"";var t=this.get(n);return t==null?"<"+n.toString()+">":t.Name};c.prototype.get=function(t){var i,r,u;if(t==null)return null;if(i=0,t instanceof Number)i=t;else try{i=parseInt(t.toString())}catch(f){this.log.log(h.SEVERE,"Value="+t,f)}if(i==0)return this.NO_INSTANCE;r=null;try{u=n.DB.executeDataReader("SELECT Description FROM M_AttributeSetInstance WHERE M_AttributeSetInstance_ID="+i);u.read()&&(r=u.getString(0),(r==null||r.length==0)&&(r=n.Logging.VLogMgt.getIsLevelFine()?"{"+i+"}":""));u.dispose();u=null}catch(f){this.log.log(h.SEVERE,"get",f)}return r==null?null:{Key:i,Name:r}};c.prototype.getColumnName=function(){return"M_AttributeSetInstance_ID"};c.prototype.dispose=function(){this.$super.dispose.call(this);this.NO_INSTANCE=null;this.log=null};n.Utility.inheritPrototype(s,i);s.prototype.getDisplay=function(n){if(n==null)return"";var t=this.get(n);return t==null?"<"+n.toString()+">":t.Name};s.prototype.get=function(t){var i,r,u;if(t==null)return null;if(i=0,t instanceof Number)i=t;else try{i=parseInt(t.toString())}catch(f){this.log.log(h.SEVERE,"Value="+t,f)}if(i==0)return this.NO_INSTANCE;r=null;try{u=n.DB.executeDataReader("SELECT Description FROM C_GenattributeSetInstance WHERE C_GenattributeSetInstance_ID="+i);u.read()&&(r=u.getString(0),(r==null||r.length==0)&&(r=n.Logging.VLogMgt.getIsLevelFine()?"{"+i+"}":""));u.dispose();u=null}catch(f){this.log.log(h.SEVERE,"get",f)}return r==null?null:{Key:i,Name:r}};s.prototype.getColumnName=function(){return"C_GenAttributeSetInstance_ID"};s.prototype.dispose=function(){this.$super.dispose.call(this);this.NO_INSTANCE=null;this.log=null};s.prototype.getData=function(t,i,r){var o=[],f,u;t||o.push({Key:-1,Name:""});f="SELECT ASI.C_GenAttributeSetInstance_ID, ASI.Description  from C_GenAttributeSetInstance ASI, M_Product P WHERE ASI.C_GenAttributeSet_ID  = "+n.Env.getCtx().getContextAsInt(this.windowNo,"C_GenAttributeSet_ID");r&&(f+=" AND IsActive='Y'");f.append(" ORDER BY 2");u=null;try{for(u=e.executeDataReader(f.toString(),null);u.read();)o.push({Key:u.getInt(0),Name:u.getString(1)+" - "+u.getString(2)})}catch(s){this.log.log(h.SEVERE,f,s)}return o};n.MLookupFactory={get:function(t,i,r,u,f,e,o,s){var c={ctx:t.getWindowCtx(i),windowNo:i,column_ID:r,AD_Reference_ID:u,columnName:f,AD_Reference_Value_ID:e,isParent:o,validationCode:s},h=n.dataContext.getJSONData(n.Application.contextUrl+"JsonData/GetLookup",c);return new n.MLookup(h._vInfo,h)},getMLookUp:function(t,i,r,u){var e="",o=0,s=!1,h="",c="SELECT c.ColumnName, c.AD_Reference_Value_ID, c.IsParent, vr.Code FROM AD_Column c LEFT OUTER JOIN AD_Val_Rule vr ON (c.AD_Val_Rule_ID=vr.AD_Val_Rule_ID) WHERE c.AD_Column_ID="+r,f=null;try{f=n.DB.executeReader(c.toString(),null,null);f.read()&&(e=f.getString(0),o=f.getInt(1),s="Y".equals(f.getString(2)),h=f.getString(3));f.close();f=null}catch(l){f!=null&&(f.close(),f=null)}return n.MLookupFactory.get(t,i,r,u,e,o,s,h)},GetLookUpInfo:function(n,t,i,r,u,f,e,o){var s={WindowNum:t,AD_Reference_ID:i,Column_ID:r,columnName:u,AD_Reference_Value_ID:f,IsParent:e,ValidationCode:o}},getLookup_TableDirEmbed:function(t,i,r,u){var s=i.substring(0,i.length-3),l="SELECT c.ColumnName,c.IsTranslated,c.AD_Reference_ID,c.AD_Reference_Value_ID FROM AD_Table t INNER JOIN AD_Column c ON (t.AD_Table_ID=c.AD_Table_ID) WHERE TableName='"+s+"' AND c.IsIdentifier='Y' ORDER BY c.SeqNo",c=[],o,f,h,e;try{for(o=n.DB.executeReader(l);o.read();)c.push({ColumnName:o.getString(0),IsTranslated:o.getString(1),DisplayType:o.getInt(2),AD_Reference_Value_ID:o.getInt(3)});o.close();o=null}catch(a){return""}if(c.length==0)return"";for(f="SELECT ",h=0;h<c.length;h++)h>0&&(f=f.concat("||' - '||")),e=c[h],n.DisplayType.IsDate(e.DisplayType)||n.DisplayType.IsNumeric(e.DisplayType)?f=f.concat(n.DB.to_char(s+"."+e.ColumnName,e.DisplayType,n.Env.getAD_Language(n.Env.getCtx()))):(e.DisplayType==n.DisplayType.TableDir||e.DisplayType==n.DisplayType.Search)&&e.ColumnName.endsWith("_ID")?alert("TableDir"):f=f.concat(s).concat(".").concat(e.ColumnName);return f=f.concat(" FROM ").concat(s),f=f.concat(" WHERE ").concat(r).concat(".").concat(u),f=f.concat("=").concat(s).concat(".").concat(i),f.toString()}};n.MLookupCache={s_log:n.Logging.VLogger.getVLogger("MLookupCache"),s_loadedLookups:new n.CCache("MLookupCache"),s_sentLookups:new n.CCache("MLookupCacheSent"),s_windowLookup:{},getKey:function(t){if(t==null)return n.Env.currentTimeMillis();var i=t.windowNo+":";return i+(":"+t.keyColumn+t.AD_Reference_Value_ID+t.query+t.validationCode)},loadFromCache:function(n,i){var u=this.getKey(n),f=null,r=!0;return this.s_loadedLookups.contains(u)&&(f=this.s_loadedLookups.get(u)),f==null&&(r=!1),r&&t.isEmptyObject(f)&&(this.s_loadedLookups.remove(u),r=!1),r&&(i.setCLookup(jQuery.extend({},f)),i.setIsLoading(!1)),r||(r=!0,this.s_sentLookups.contains(u)?this.s_sentLookups.get(u).indexOf(i)==-1&&(i.setIsLoading(!0),this.s_sentLookups.get(u).push(i)):(this.s_sentLookups.add(u,[]),r=!1)),r},loadEnd:function(n,i){var f=this.getKey(n),o,e,r,u;if(i.getCLookup()&&!t.isEmptyObject(i.getCLookup())){if(this.s_loadedLookups.add(f,i.getCLookup()),this.s_sentLookups.contains(f)){for(r=this.s_sentLookups.get(f),r.length>0&&(o=""),u=0;u<r.length;u++)e=r[u],e.setCLookup(t.extend({},i.getCLookup())),e.setIsLoading(!1);r.length=0;this.s_sentLookups.remove(f)}}else if(this.s_sentLookups.contains(f)){for(r=this.s_sentLookups.get(f),u=0;u<r.length;u++)r[u].setIsLoading(!1);r.length=0;this.s_sentLookups.remove(f)}},cacheReset:function(n){for(var e=n.toString()+":",h=this.s_loadedLookups.size(),u=[],i,o,r,s,t=0,f=this.s_loadedLookups.m_cacheK.length;t<f;t++){i=this.s_loadedLookups.m_cacheK[t];try{i!=null&&i.startsWith(e)&&u.push(i)}catch(c){o=""}}for(r=0;r<u.length;r++)this.s_loadedLookups.remove(u[r]);s=this.s_loadedLookups.size()},addWindowLookup:function(n,t){if(this.s_windowLookup[n])this.s_windowLookup[n].push(t);else{var i=[];i.push(t);this.s_windowLookup[n]=i}},initWindowLookup:function(n){var t,i,r;if(this.s_windowLookup[n]){for(t=this.s_windowLookup[n],i=0,r=t.length;i<r;i++)t[i].initialize();t.length=0;delete this.s_windowLookup[n]}}};n.MLookup=r;n.MLocationLookup=f;n.MAccountLookup=o;n.MPAttributeLookup=c;n.MGAttributeLookup=s;n.MLocatorLookup=u}(VIS,jQuery),function(n,t){function i(i,r,u){function rt(){s=t("<table style='width:100%;height:100%'><tr><td style='height:100%'><div class='vis-css-treewindow' ><\/td><\/tr><tr><td style='text-align:center'><div class='vis-tree-search'><div class='input-group'><input type='text' class='form-control ui-autocomplete-input' placeholder='Search'>  <span class='input-group-addon'><a href='#' class='glyphicon glyphicon-search'><\/a><\/span><\/div><\/div><\/td><\/tr><\/table>");e=s.find(".vis-css-treewindow");e.css({"margin-left":"5px","max-width":"295px","background-color":"#eee"});it=s.find(".vis-tree-search");g=s.find(".input-group-addon");tt=s.find("input");a=t("<ul class='vis-apanel-rb-ul'>");y=t("<li data-action='Copy'>").text(n.Msg.getMsg("Copy"));p=t("<li data-action='Move'>").text(n.Msg.getMsg("Move"));w=t("<li data-action='Cancel'>").text(n.Msg.getMsg("Cancel"));a.append(y).append(p).append(w)}function ut(){var y,e,i,h;if(f!=null&&o!=null&&f!=o){y=f.parent();f.remove();var w=y.parent().data("value"),a=null,r=o,p=0;o.data("summary")!="Y"?(r=o.parent(),p=o.index(),f.insertAfter(r.children()[p]),a=r.parent().data("value")):(e=r.find(">ul"),e.children().length>0?f.insertBefore(e.children()[p]):f.appendTo(e),a=r.data("value"),r=e);for(var v=[],s=y.children(),i=0,u="",i=0;i<s.length;i++)h=t(s[i]),u="UPDATE ",u+=b+" SET Parent_ID="+w+", SeqNo="+i+", Updated=SysDate WHERE AD_Tree_ID="+l+" AND Node_ID="+h.data("value"),v.push(u);if(w!=a)for(s=r.children(),i=0,i=0;i<s.length;i++)h=t(s[i]),u="UPDATE ",u+=b+" SET Parent_ID="+a+", SeqNo="+i+", Updated=SysDate WHERE AD_Tree_ID="+l+" AND Node_ID="+h.data("value"),v.push(u);console.log(v);n.DB.executeQueries(v,null,function(n){console.log(n);c})}}function ft(){k.length=0;d.length=0;e.find("LI").each(function(n,i){var r=t(i),u=r.find(">label");u.length<1&&(u=r.find(">A"));k.push(r.data("value"));d.push(u.text())})}var h;this.selectionChangeListner=null;this.windowNo=i;var b="",c=null,k=[],d=[],nt=-1,v=null,f=null,o=null,l=0,s=null,e=null,it=null,g=null,tt=null,a=null,y,p,w;rt();h=this;this.setSize=function(n){e.height(n-40)};this.initTree=function(t){l=t;var r={AD_Tree_ID:l,editable:u,windowNo:i};l=l;n.dataContext.getTreeAsString(r,function(n){e.html(n);ft();c=e.find(">ul");b=c.data("tablename");c=c.find(">li>ul")})};this.getRoot=function(){return s};e.on(n.Events.onClick,function(n){var i,r;n.target.nodeName==="INPUT"||n.target.nodeName==="LI"||n.target.nodeName==="A"?(i=t(n.target),n.target.nodeName==="INPUT"&&(i=t(n.target.parentNode)),h.selectionChangeListner&&h.selectionChangeListner.nodeSelectionChanged({newValue:i.data("value"),propertyName:""}),n.stopPropagation()):n.target.nodeName==="SPAN"&&(n.target.parentNode.nodeName=="SPAN"||n.target.parentNode.nodeName=="LI")&&(r=t(n.target.parentNode),n.target.parentNode.nodeName==="SPAN"&&(r=t(n.target.parentNode.parentNode)),v=r,y.hide(),w.hide(),p.hide(),f!=null?(p.show(),w.show()):y.show(),t(n.target).w2overlay(a.clone(!0)))});g.on(n.Events.onTouchStartOrClick,function(){var t=tt.val(),n,i;t==null||t.length<2||(n=h.containsTextInArray(d,t,nt),n>-1&&(i=k[n],nt=n,h.setSelectedNode(i),h.selectionChangeListner&&h.selectionChangeListner.nodeSelectionChanged({newValue:i,propertyName:""})))});a.on(n.Events.onTouchStartOrClick,"LI",function(n){var i=t(n.target).data("action");i=="Copy"?f=v:i=="Move"?(o=v,ut(),f=null,o=null,v=null):i=="Cancel"&&(f=null,v=null)});this.getRootNode=function(){return c};this.disposeLocal=function(){e.off(n.Events.onClick);g.off(n.Events.onTouchStartOrClick);a.off(n.Events.onTouchStartOrClick);a=null;e=null;s.remove();s=null;h=null}}i.prototype.containsTextInArray=function(n,t,i){for(var r=i+1;r<n.length;r++)if(r!=-1&&n[r].trim().toLowerCase().contains(t.trim().toLowerCase()))return r;return i>-1?(i=-1,this.containsTextInArray(n,t,i)):-1};i.prototype.addSelectionChangeListner=function(n){this.selectionChangeListner=n};i.prototype.setSelectedNode=function(n){return n!=-1?this.selectID(n,!0):!1};i.prototype.selectID=function(n){var u=this.getRoot(),t=u.find("li[data-value='"+n+"']"),r,f,i;if(t!=null&&t.length>0){for(r=u.find("*.vis-css-treewindow-selected"),r.length>0&&r.removeClass("vis-css-treewindow-selected"),t.find(">label").length>0?t.find(">label").addClass("vis-css-treewindow-selected"):t.find(">a").addClass("vis-css-treewindow-selected"),f=t;t!=null;)i=t.find("input"),i.length>0&&(i.prop("checked")||i.prop("checked",!0)),t=t.parent(),t[0].nodeName=="UL"&&(t=t.parent()),t[0].nodeName=="LI"||(t=null);return f[0].scrollIntoView(),!0}return!1};i.prototype.nodeChanged=function(n,i,r,u,f,e){var l,s,c;if(console.log("Save="+n+", KeyID="+i+", Name="+r+", Description="+u+", IsSummary="+f+", ImageInd="+e),i!=0){var a=this.getRoot(),h=!1,o=a.find("li[data-value='"+i+"']");o!=null&&o.length>0&&(h=!0);!h&&n?(l=this.getRootNode(),l.append(this.getNode(i,r,u,f,e,this.windowNo))):h&&n?(this.toggleTypeOfNode(o,f,i,this.windowNo,e),f&&o.find(">ul").length==0&&o.append(t("<ul>")),s=o.find(">label"),s&&s.length!=0||(s=o.find(">a")),s.length>0&&s.text(r)):h&&!n?(c=o.find(">ul"),c.length>0&&(c.remove(),this.getRootNode().append(c.children())),o.remove()):o=null;o==null}};i.prototype.getNode=function(i,r,u,f,e,o){var s='<li data-value="'+i+'"';return s+=f?'data-summary="Y" class="vis-hasSubMenu"> <input type="checkbox" id="'+o+i+'"><label for="'+o+i+'">'+r+'<\/label><span class="vis-treewindow-span"><span class="vis-css-treewindow-arrow-up"><\/span><\/span><ul><ul>':'data-summary="N">  <img src="'+n.Application.contextUrl+"Areas/VIS/Images/login/"+this.getIcon(e)+'">  <a href="javascript:void(0)" data-value="'+i+'" data-action="'+e+'" data-actionid="'+i+'"> '+r+'<\/a><span class="vis-treewindow-span"><span class="vis-css-treewindow-arrow-up"> <\/span><\/span><\/li>',t(s)};i.prototype.getIcon=function(n){switch(n){case"W":return"mWindow.png";case"R":return"mReport.png";case"P":return"mProcess.png";case"F":return"mWorkflow.png";case"B":return"mWorkbench.png";case"X":return"mWindow.png";case"V":return"mWindow.png";case"D":return"mDocAction.png";default:return"mWindow.png"}};i.prototype.toggleTypeOfNode=function(n,t,i,r,u){var s=n.data("summary")=="Y",e,f,o;t!==s?(e=n.find(">ul"),e.remove(),n.data("summary",t?"Y":"N"),n.toggleClass("vis-hasSubMenu"),t?n.html('<input type="checkbox" id="'+r+i+'"><label for="'+r+i+'">'+name+'<\/label><span class="vis-treewindow-span"><span class="vis-css-treewindow-arrow-up"><\/span><\/span>'):n.html('<img src="/ViennaHTML/Areas/VIS/Images/login/'+this.getIcon(u)+'">  <a href="javascript:void(0)" data-value="'+i+'" data-action="'+u+'" data-actionid="'+i+'"> '+name+'<\/a><span class="vis-treewindow-span"><span class="vis-css-treewindow-arrow-up"> <\/span><\/span>'),e.length>0&&n.append(e)):t||(f=n.find(">a"),f.length>0&&(o=f.data("action"),f!=u&&(n.find(">img").attr("src","/ViennaHTML/Areas/VIS/Images/login/"+this.getIcon(u)),f.data("action",u)),f=o=null))};i.prototype.dispose=function(){this.disposeLocal();this.addPropertyChangeListner=null};n.TreePanel=i}(VIS,jQuery),function(n,t){function u(){function h(){var n,s,h;i=t("<table class='vis-awindow'>");n=t("<td style='max-height:42px;'>");u=t("<td class='vis-height-full'>");e=t("<p>");r=t('<a href="javascript:void(0)" class="vis-mainMenuIcons vis-icon-menuclose"><\/a>');o=t("<div class='vis-awindow-toolbar' >");f=t("<div class='vis-awindow-header vis-menuTitle' >").append(r).append(e).append(o);n.append(f);s=t("<tr>").append(n);h=t("<tr>").append(u);i.append(s).append(h)}var f,i,u,e,r,o,s;this.name;this.windowNo;this.id;this.cPanel;this.isHeaderVisible=!0;this.onClosed;this.title="window";f=null;o=null;this.onLoad=null;h();this.setTitle=function(n){this.title=n;e.text(this.title)};this.setSize=function(n){i.height(n)};this.hideHeader=function(n){this.isHeaderVisible=!n;n?f.hide():f.show();this.sizeChanged()};this.getRootLayout=function(){return i};this.getContentGrid=function(){return u};this.setToolbar=function(n){o.append(n)};s=this;r.on("touchstart click",function(n){n.preventDefault();n.stopPropagation();s.dispose()});this.disposeComponent=function(){s=null;r&&r.off(n.Events.onTouchStartOrClick);r=null;i&&i.remove();u&&u.remove();i=u=e=r=null;this.setTitle=null;this.name=null;this.windowNo=null;this.id=null;this.setTitle=null;this.setName=null;this.getRootLayout=null;this.getContentGrid=null;this.onLoad=null}}function i(){function oi(){var i,e,o;y=t("<div style='position:relative;'>");p=t("<div class='vis-apanel-busy'>");u=t("<ul class='vis-appsaction-ul'>");ct=t("<div class='vis-apanel-search'>");wt=t("<div class='vis-apanel-toolbar'>").append(u);k=t("<ul class='vis-appsaction-ul vis-apanel-nav-ul'>");pt=t("<div class='vis-apanel-nav'>").append(k);d=t("<ul class='vis-appsaction-ul vis-apanel-tabcontrol-ul'>");c=t("<div class='vis-apanel-tabcontrol'>").append(d);g=t("<div class='vis-apanel-tab-oflow'>").hide();g.html("<a href='javascript:void(0)'><img data-dir='bf' src='"+n.Application.contextUrl+"Areas/VIS/Images/base/thumb-"+(n.Application.isRTL?"last":"first")+".png'><\/a><a href='javascript:void(0)'><img data-dir='b' src='"+n.Application.contextUrl+"Areas/VIS/Images/base/thumb-"+(n.Application.isRTL?"forward":"back")+".png'><\/a><a href='javascript:void(0)' ><img data-dir='r' src='"+n.Application.contextUrl+"Areas/VIS/Images/base/thumb-"+(n.Application.isRTL?"back":"forward")+".png' /><\/a><a href='javascript:void(0)' ><img data-dir='rl' src='"+n.Application.contextUrl+"Areas/VIS/Images/base/thumb-"+(n.Application.isRTL?"first":"last")+".png' /><\/a>");yt=t("<div class='vis-apanel-header-nav'>").hide();ot=t("<td style='width:40px;' style='height:100%' rowspan='3'>");rt=t("<div class='vis-apanel-lb'>");vt=t("<div class='vis-apanel-lb-toggle' ><img class='vis-apanel-lb-img' src='"+n.Application.contextUrl+"Areas/VIS/Images/base/mt24.png'><\/div>");r=t("<ul class='vis-apanel-lb-ul'>");l=t('<div class="vis-apanel-lb-main">');it=t("<div class='vis-apanel-lb-oflow'>").hide();it.html("<a data-dir='u' href='javascript:void(0)'><img style='margin-left:10px' data-dir='u' src='"+n.Application.contextUrl+"Areas/VIS/Images/base/arrow-top.png' ><\/a><a data-dir='d' href='javascript:void(0)' ><img style='margin-left:10px' data-dir='d' src='"+n.Application.contextUrl+"Areas/VIS/Images/base/arrow-bottom.png' /><\/a>");rt.append(vt);rt.append(l);rt.append(it);ot.append(rt);st=t("<td style='width:auto;height:100%;' rowspan='3'>");bt=t("<td class='vis-apanel-table-td3' style='height:100%;' rowspan='3'>");ri=t("<a href='javascript:void(0)' class='vis-flex-prev'>").html("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/arrow-slider.png'>");ft=t("<div class='vis-apanel-bar-fixpart' style='position:absolute'>").append(ri);w=t("<div class='vis-apanel-bar-varpart' style='overflow-y:auto'>");nt=t("<div class='vis-apanel-bar'>").append(ft).append(w);i=t("<td rowspan='3' style='width:8px;height:100%;vertical-align:top;max-width:8px;'>").append(nt);at=t("<ul class='vis-apanel-rb-ul'>");ei=t("<ul class='vis-apanel-rb-ul'>");et=t("<ul class='vis-apanel-rb-ul'>");e=t("<td style='height:"+a+"px'>").append(yt);ht=t("<td style='height:100%;'>");tt=t("<div class='vis-apanel-statusbar'>").hide();o=t("<td style='height:"+h+"px'>").append(tt);kt=t("<tr>").append(o);dt=t("<tr>").append(ht);gt=t("<tr>").append(ot).append(st).append(e).append(bt).append(i);b=t("<table class='vis-apanel-table' >");y.append(b);y.append(p);v=t("<input type='text' class='vis-apanel-search' placeholder='"+n.Msg.getMsg("Search")+"'>");lt=t("<img  src='"+f.prototype.getPath()+"Sear.png'>");ct.append(v).append(lt)}function si(){yt.append(c).append(g).append(pt);w.append("<h1 class='vis-apnel-rb-header'>"+n.Msg.getMsg("Action")+"<\/h1>").append(at);w.append("<h1 class='vis-apnel-rb-header'>"+n.Msg.getMsg("Related")+"<\/h1>").append(et);l.append(r);yt.show();tt.show();b.append(gt).append(dt).append(kt);kt=dt=gt=null}var ui,ii,ti,e,i;this.$parentWindow;this.ctx=n.Env.getCtx();this.curGC;this.curST;this.curTab;this.vTabbedPane=new n.VTabbedPane(!1);this.statusBar=new s;this.curWinTab=null;this.curTabIndex;this.firstTabId=null;ui=0;ii=0;this.toolbarCreated=!1;this.errorDisplayed=!1;this.isPersonalLock=n.MRole.getIsPersonalLock();this.log=n.Logging.VLogger.getVLogger("APanel");var fi=!1,b,pt,ht,k,ct,wt,u,tt,d,c,g,v,lt,y,p,ft,w,nt,ei,et,at,ot,vt,r,l,it,st="",bt,rt,yt,ri,kt,dt,gt,ut=[],ni={};oi();tt.append(this.statusBar.getRoot());ti=n.Env.getScreenHeight()-o;b.height(ti);p.height(ti);this.setSize=function(t){b.height(t);rt.height(t);nt.height(t);tt.height(h);l.height(t-43);r.height()>l.height()&&(n.Application.isMobile||(l.height(t-83),it.show()));this.aParentDetail&&this.aParentDetail.setSize(t);p.height(t);t=null};e=this;i=function(n){e.actionPerformed(n)};this.onTabChange=function(n){e.tabActionPerformed(n)};this.statusBar.onComboChange=function(n){e.setBusy(!0);setTimeout(function(){e.curGC.navigatePageExact(n+1);e.setBusy(!1)},100)};this.createToolBar=function(){this.aRefresh=this.addActions(this.ACTION_NAME_REFRESH,null,!0,!0,!1,i);this.aDelete=this.addActions(this.ACTION_NAME_DELETE,null,!0,!0,!1,i);this.aNew=this.addActions(this.ACTION_NAME_NEW,null,!0,!0,!1,i);this.aIgnore=this.addActions("Ignore",null,!0,!0,!1,i);this.aSave=this.addActions("Save",null,!0,!0,!1,i);this.aFind=this.addActions("Find",null,!0,!0,!1,i);this.aInfo=this.addActions("Info",null,!0,!0,!1,i);this.aReport=this.addActions("Report",null,!0,!0,!1,i);this.aPrint=this.addActions("Print",null,!0,!0,!1,i);u.append(this.aIgnore.getListItm());u.append(this.aNew.getListItm());u.append(this.aDelete.getListItm());u.append(this.aSave.getListItm());u.append(this.aRefresh.getListItm());u.append(this.aReport.getListItm());u.append(this.aPrint.getListItm());u.append((new f).getSeprator(!1,!0));u.append(this.aFind.getListItm());this.aPrevious=this.addActions(this.ACTION_NAME_PREV,null,!0,!0,!0,i);this.aFirst=this.addActions(this.ACTION_NAME_FIRST,null,!0,!0,!0,i);this.aLast=this.addActions(this.ACTION_NAME_LAST,null,!0,!0,!0,i);this.aNext=this.addActions(this.ACTION_NAME_NEXT,null,!0,!0,!0,i);this.aMulti=this.addActions("Multi",null,!1,!0,!0,i,!0);this.aCard=this.addActions("Card",null,!1,!0,!0,i);this.aMap=this.addActions("Map",null,!1,!0,!0,i);k.append(this.aFirst.getListItm()).append(this.aPrevious.getListItm()).append(this.aNext.getListItm()).append(this.aLast.getListItm());k.append(this.aMulti.getListItm());k.append(this.aCard.getListItm());k.append(this.aMap.getListItm().hide());this.aPageUp=this.addActions("PageUp",null,!0,!0,!0,i);this.aPageFirst=this.addActions("PageFirst",null,!0,!0,!0,i);this.aPageLast=this.addActions("PageLast",null,!0,!0,!0,i);this.aPageDown=this.addActions("PageDown",null,!0,!0,!0,i);var t=this.gridWindow;ii=0;t.getIsAppointment()&&(this.aAppointment=this.addActions("Appointment",null,!1,!1,!1,i),r.append(this.aAppointment.getListItmIT()));t.getIsTask()&&(this.aTask=this.addActions("Task",null,!1,!1,!1,i),r.append(this.aTask.getListItmIT()));t.getIsEmail()&&(this.aEmail=this.addActions("EMail",null,!1,!1,!1,i),r.append(this.aEmail.getListItmIT()));t.getIsLetter()&&(this.aLetter=this.addActions("Letter",null,!1,!1,!1,i),r.append(this.aLetter.getListItmIT()));t.getIsSms()&&(this.aSms=this.addActions("Sms",null,!1,!1,!1,i),r.append(this.aSms.getListItmIT()));t.getIsFaxEmail()&&(this.aFaxEmail=this.addActions("FaxEmail",null,!1,!1,!1,i),r.append(this.aFaxEmail.getListItmIT()));t.getIsChat()&&(this.aChat=this.addActions(this.ACTION_NAME_CHAT,null,!1,!1,!1,i,!0),r.append(this.aChat.getListItmIT()));t.getIsAttachment()&&(this.aAttachment=this.addActions("Attachment",null,!1,!1,!1,i,!0),r.append(this.aAttachment.getListItmIT()));t.getIsHistory()&&(this.aHistory=this.addActions("History",null,!1,!1,!1,i),r.append(this.aHistory.getListItmIT()));t.getIsCheckRequest()&&(this.aRequest=this.addActions("Request",null,!0,!1,!1,i),r.append(this.aRequest.getListItmIT()));n.AEnv.getIsWorkflowProcess()&&(this.aWorkflow=this.addActions("Workflow",null,!0,!1,!1,i),r.append(this.aWorkflow.getListItmIT()));t.getIsCopyReocrd()&&(this.aCopy=this.addActions("Copy",null,!1,!1,!1,i),r.append(this.aCopy.getListItmIT()));t.getIsSubscribedRecord()&&(this.aSubscribe=this.addActions("Subscribe",null,!0,!1,!1,i,!0),r.append(this.aSubscribe.getListItmIT()));t.getIsZoomAcross()&&(this.aZoomAcross=this.addActions("ZoomAcross",null,!0,!1,!1,i),r.append(this.aZoomAcross.getListItmIT()));t.getIsCreatedDocument()&&(this.aCreateDocument=this.addActions("CreateDocument",null,!1,!1,!1,i),r.append(this.aCreateDocument.getListItmIT()));t.getIsUploadedDocument()&&(this.aUploadDocument=this.addActions("UploadDocument",null,!1,!1,!1,i),r.append(this.aUploadDocument.getListItmIT()));t.getIsViewDocument()&&(this.aViewDocument=this.addActions("ViewDocument",null,!1,!1,!1,i,!0),r.append(this.aViewDocument.getListItmIT()));t.getIsAttachDocumentFrom()&&(this.aAttachFrom=this.addActions("AttachDocumentFrom",null,!1,!1,!1,i,!0),r.append(this.aAttachFrom.getListItmIT()));t.getIsMarkToExport()&&(this.aMarkToExport=this.addActions("Mark",null,!1,!1,!1,i),r.append(this.aMarkToExport.getListItmIT()));t.getIsImportMap()&&(this.aImportMap=this.addActions("Import",null,!1,!1,!1,i),r.append(this.aImportMap.getListItmIT()));t.getIsArchive();t.getIsAttachmail();t.getIsRoleCenterView();this.isPersonalLock&&(this.aLock=this.addActions("Lock",null,!0,!1,!1,i,!0),r.append(this.aLock.getListItmIT()),this.aRecAccess=this.addActions("RecordAccess",null,!0,!1,!1,i,!0),r.append(this.aRecAccess.getListItmIT()));this.aPreference=this.addActions("Preference",null,!1,!1,!0,i);n.MRole.getDefault().getIsShowPreference()&&et.append(this.aPreference.getListItmIT());this.aHelp=this.addActions("Help",null,!0,!1,!0,i);et.append(this.aHelp.getListItmIT());this.aCardDialog=this.addActions("CardDialog",null,!0,!1,!0,i);et.append(this.aCardDialog.getListItmIT());t=null;this.statusBar.setPageItem(this.aPageFirst.getListItm());this.statusBar.setPageItem(this.aPageUp.getListItm());this.statusBar.setComboPage();this.statusBar.setPageItem(this.aPageDown.getListItm());this.statusBar.setPageItem(this.aPageLast.getListItm());this.statusBar.render();this.toolbarCreated=!0;this.$parentWindow.setToolbar(wt);this.$parentWindow.setToolbar(ct);si()};this.setDynamicActions=function(){if(this.curGC!=null){var n=0,t=[];if(this.curGC.leftPaneLinkItems.length>0)for(t=this.curGC.leftPaneLinkItems,n=0;n<t.length;n++)at.append(t[n].getControl());if(n=0,this.curGC.rightPaneLinkItems.length>0)for(t=this.curGC.rightPaneLinkItems,n=0;n<t.length;n++)at.append(t[n].getControl());t=null}};this.getRoot=function(){return y};this.getLayout=function(){return ht};this.getIncludedEmptyArea=function(){return bt};this.getParentDetailPane=function(){return st};this.setTabControl=function(t){var i,r;for(ut=t,i=0;i<t.length;i++)r=t[i].getListItm(),ni[ut[i].action]=r,d.append(r);d.width()>c.width()&&(n.Application.isMobile||g.show())};this.setTabNavigation=function(){d.width()>c.width()&&(n.Application.isMobile||g.show())};this.setSelectedTab=function(n){this.selectedTab&&this.selectedTab.removeClass("vis-apanel-tab-selected");this.selectedTab=ni[n];this.selectedTab.addClass("vis-apanel-tab-selected")};this.setBusy=function(n,t){fi=n;n?p[0].style.visibility="visible":(p[0].style.visibility="hidden",t)};g.on("click",function(n){var f,e;if(n.stopPropagation(),f=t(n.target).data("dir"),f){var s=c.width(),o=d.width(),i=c.scrollLeft(),r=Math.ceil(s/2),u=0;if(f=="r"){if(i+r>=o-r)return;e=o-s;u=i+r;c.animate({scrollLeft:u>e?e:u},1e3,"easeOutBounce")}else if(f=="b"){if(i==0)return;u=i-r;c.animate({scrollLeft:u<0?0:u},1e3,"easeOutBounce")}if(f=="rl"){if(i+r>=o-r)return;e=o-s;c.animate({scrollLeft:e},500,"easeOutBounce")}else if(f=="bf"){if(i==0)return;u=i-r;c.animate({scrollLeft:0},500,"easeOutBounce")}}});it.on("click",function(n){var u,o;if(n.stopPropagation(),u=t(n.target).data("dir"),u){var s=l.height(),h=r.height(),f=l.scrollTop(),e=Math.ceil(s/2),i=0;if(u=="d"){if(f+e>=h-e)return;o=h-s;i=f+e;l.animate({scrollTop:i>o?o:i},1e3,"easeOutBounce")}else if(u=="u"){if(f==0)return;i=f-e;l.animate({scrollTop:i<0?0:i},1e3,"easeOutBounce")}}});lt.on(n.Events.onTouchStartOrClick,function(n){e.cmd_find(v.val());v.val("");n.stopPropagation()});if(!n.Application.isMobile)v.on("keyup",function(n){var t=n.charCode||n.keyCode;t==13&&(e.cmd_find(v.val()),v.val(""))});vt.on(n.Events.onTouchStartOrClick,function(n){n.stopPropagation();var t=ot.width();t>50&&r.find("span").hide();ot.animate({width:t>50?40:200},300,"swing",function(){t<50&&r.find("span").show();e.curGC&&e.curGC.multiRowResize()})});ft.on(n.Events.onTouchStartOrClick,function(t){t.stopPropagation();var i=n.Application.isRTL;nt.width()>100?(nt.animate({left:i?0:y.width()-8+"px",width:"8px"},500,"swing",function(){w.css({width:"0px"})}),w.animate({width:"0px"},500,"swing")):(nt.css({position:"absolute",width:"8px",left:i?0:y.width()-8}),nt.animate({left:i?0:y.width()-220+"px",width:"220px"},500,"swing"),w.animate({width:"212px"},500,"swing"))});this.disposeComponent=function(){if(lt.off(n.Events.onTouchStartOrClick),v.remove(),v=null,vt.off(n.onTouchStartOrClick),it.off("click"),g.off("click"),y.remove(),p.remove(),b.remove(),y=p=b=pt=ht=k=ct=wt=u=tt=null,e=null,i=null,this.toolbarCreated&&(this.aRefresh.dispose(),this.aDelete.dispose(),this.aNew.dispose(),this.aSave.dispose(),this.aPrevious.dispose(),this.aFirst.dispose(),this.aLast.dispose(),this.aNext.dispose(),this.aPageUp.dispose(),this.aPageFirst.dispose(),this.aPageLast.dispose(),this.aPageDown.dispose(),this.aCard.dispose(),this.aCardDialog.dispose(),this.aChat&&this.aChat.dispose(),this.aAppointment&&this.aAppointment.dispose(),this.aHelp.dispose(),this.aSubscribe&&this.aSubscribe.dispose(),this.aAttachment&&this.aAttachment.dispose(),this.aHistory&&this.aHistory.dispose(),this.aZoomAcross&&this.aZoomAcross.dispose(),this.aRequest&&this.aRequest.dispose(),this.aMarkToExport&&this.aMarkToExport.dispose(),this.aWorkflow&&this.aWorkflow.dispose(),this.aRecAccess&&this.aRecAccess.dispose(),this.aImportMap&&this.aImportMap.dispose(),this.aRefresh=this.aDelete=this.aNew=this.aPrevious=this.aFirst=this.aLast=this.aNext=null,this.aChat=this.aPageUp=this.aPageFirst=this.aPageLast=this.aPageDown=null,this.aHelp=this.aSubscribe=this.aAttachment=null,this.toolbarCreated=null,this.aZoomAcross=this.aRequest=this.aMark=this.aWorkflow=this.aHistory=null,this.aAppointment=null,this.aRecAccess=this.aImportMap=this.aCard=this.aCardDialog=null),this.statusBar.dispose(),this.statusBar.onComboChange=null,this.statusBar=null,this.getRoot=null,this.getLayout=null,this.setBusy=null,this.createToolBar=null,this.$parentWindow=null,this.ctx=null,this.curGC=null,this.curST=null,this.curTab=null,this.vTabbedPane=null,this.curWinTab=null,this.curTabIndex=null,this.firstTabId=null,ft.off(n.Events.onTouchStartOrClick),ft=null,w=null,st.remove(),st=null,this.getParentDetailPane=null,ut)for(var t=0;t<ut.length;t++)ut[t].dispose();ut=null;ni=null;d.remove()}}function v(n,t,i,r,u,f,e){if(n.getProcess_ID()!=0)return u.curTab.needSave(!0,!1)&&!u.cmd_save(!0)?void 0:p(n,t,i,r,u,f,e)}function p(t,i,r,u,f,e,o){var a=t.getName(),c=!1,s,h,l;try{if(!e&&!(t.getDescription().equals("")&&t.getHelp().equals(""))&&!n.ADialog.ask("StartProcess?",!0,t.getDescription()+"\n"+t.getHelp()))return;s=t.getDescription();(s==null||s.length==0)&&(s=a);h=new n.ProcessInfo(s,t.getProcess_ID(),i,r);h.setAD_User_ID(u.getAD_User_ID());h.setAD_Client_ID(u.getAD_Client_ID());h.setIsBatch(o);l=new n.ProcessCtl(f,h,null);l.process(f.curWindowNo);c=!0}catch(v){n.ADialog.error("Error?",!0,"error in process : "+v.message);c=!1}return f=null,t=null,o=!1,e=!1,actionProcessAfterSave=null,c}function f(i){var u,f,r;i&&(this.action,this.toggle,this.enableDisable,this.pressed,this.isEnabled=!0,this.text,this.toolTipText,this.imageOnly,this.textOnly,this.onAction=null,this.isSmall,t.extend(!0,this,i),this.items={},this.$li,this.text||(this.text=n.I18N.getLabel(this.action),this.text.contains("&")&&(this.text=this.text.replace("&","")),this.toolTipText=this.toolTipText?n.Msg.getMsg(this.toolTipText):n.Msg.getMsg(this.action),this.toolTipText.contains("&")&&(this.toolTipText=this.toolTipText.replace("&",""))),u=this.getPath(),f=this.getPath(),this.isSmall?(u+=this.action+"16.png",(this.toggle||this.enableDisable)&&(f+=this.action+"X16.png")):(u+=this.action+"24.png",(this.toggle||this.enableDisable)&&(f+=this.action+"X24.png")),this.imgUrl=u,this.imgUrlX=f);r=this;this.getListItm=function(i){var u=t("<li>"),f=t("<div><\/div>"),e=!0;u.on(n.Events.onClick,function(n){n.stopPropagation();e&&r.onAction&&r.isEnabled&&(r.toggle&&r.setPressed(!r.pressed),e=!1,f.css("background-color","red"),setTimeout(function(){f.css("background-color","transparent");r.onAction(r.action);e=!0},10))});return this.textOnly?u.text(this.text):this.imageOnly?(this.img=t("<img />").attr({src:this.imgUrl,alt:this.text,title:this.text}),u.append(f),f.append(this.img)):(u.append('<ul class="vis-appsaction-ul-inner"><li><img src="'+this.imgUrl+'" /><\/li><li><span>'+this.text+"<\/span><\/li><\/ul>"),this.img=u.find("img")),this.$li=u,i&&(this.items[i]=u),this.$li};this.getListItmIT=function(i){if(this.$li)return this.$li;var u=t("<li>"),f=t("<div><\/div>"),e=!0;u.on(n.Events.onClick,function(n){n.stopPropagation();e&&r.onAction&&r.isEnabled&&(r.toggle&&r.setPressed(!r.pressed),e=!1,f.css("background-color","red"),setTimeout(function(){f.css("background-color","transparent");r.onAction(r.action);e=!0},10))});return this.textOnly?u.text(this.text):this.imageOnly?(this.img=t("<img />").attr({src:this.imgUrl,alt:this.text,title:this.text}),u.append(f),f.append(this.img)):(u.append('<img src="'+this.imgUrl+'"  /><span> '+this.text+"<\/span>"),this.img=u.find("img")),this.$li=u,i&&(this.items[i]=u),this.$li};this.disposeComponent=function(){r=null;this.getListItm=null;this.getListItmIT=null}}function s(i){function p(){f=t("<table class='vis-statusbar-table'>");o=t("<td style='text-align:center' colspan='3' >");s=t("<td style='width:auto;white-space:nowrap;'>");c=t("<td  style='width:100%;'>");l=t("<td style='width:auto;white-space:nowrap;'>");u=t("<ul class='vis-statusbar-ul'>")}var v,y,f,o,s,u,c,l,e;this.$statusLine=t("<span>");this.$statusDB=t("<span class='vis-statusbar-statusDB'>").text("0/0");this.$infoLine=t("<span class='vis-statusbar-infoLine'>").text("info");var h=t("<span class='vis-statusbar-pageMsg'>"),a=t("<img class='vis-statusbar-img' src= '"+n.Application.contextUrl+"Areas/VIS/Images/base/seprator16.png'>"),r=t("<select class='vis-statusbar-combo'>");this.text="";this.dse;this.merror;this.mtext;v=n.Msg.getMsg("ShowingResult");y=n.Msg.getMsg("of");this.onComboChange;p();u.append(t("<li>").append(this.$statusDB));s.append(h).append(a);c.append(t("<div class='vis-statusbar-statusLine'>").append(this.$statusLine));l.append(u);o.append(this.$infoLine);i||this.$infoLine.hide();this.getRoot=function(){return f};this.render=function(){f.empty();f.append(t("<tr class='vis-height-auto'>").append(o)).append(t("<tr class='vis-height-full'>").append(s).append(c).append(l))};this.setPageItem=function(n){u.append(n)};this.setComboPage=function(){u.append(t("<li>").append(r))};this.setPageLine=function(n){var l,f,a,t;if(n!=null){var i=n.getCurrentPage(),e=n.getTotalPage(),o=n.getPageSize(),s=n.getTotalRecords(),c=(i-1)*o,u=c+o;if(u>s&&(u=s),l=v+" "+(c+1)+"-"+u+" "+y+" "+n.getTotalRecords(),h.text(l),e!=r[0].options.length){for(f=[],a=-1,t=0;t<e;t++)f[t]="<option>"+(t+1)+"<\/option>";r.empty();r.html(f.join(""))}r[0].selectedIndex!=i-1&&(r[0].selectedIndex=i-1)}};this.setComboCallback=function(n){selectionCallback=n};e=this;r.on("change",function(n){if(n.stopPropagation(),e.onComboChange)e.onComboChange(this.selectedIndex)});this.$statusDB.on("click",function(){var t=n.Msg.getMsg("Who")+e.text,i=new n.RecordInfo(t,e.dse);i.show()});this.disposeComponent=function(){e=null;f.remove();o=null;s=null;f=null;this.getRoot=null;this.onComboChange=null;u.remove();u=null;h=null;this.$statusLine=null;this.$statusDB=null;a=null;this.disposeComponent=null;this.setPageItem=null;this.getRoot=null;this.render=null;this.setPageLine=null;this.$infoLine=null;this.text=null;this.dse=null;this.merror=null;this.mtext=null;r.empty();r.remove();r=null}}function r(){function r(n){var i,r;return t.readOnly?!1:(i=t.grid.columns[n],!t.mTab.getTableModel().getIsInserting()&&i.readOnly)?!1:(r=i.gridField,r.getIsEditable(!0,!0))?!0:!1}function u(n,i){return t.readOnly?!1:i==t.indexActiveColumn&&t.indexProcessedColumn==-1?!0:f(n)?!0:!1}function f(i){var r,u;if(t.readOnly||i<0)return!1;if(t.indexActiveColumn&&t.indexActiveColumn>0)if(r=t.grid.getCellValue(i,t.indexActiveColumn),typeof r=="boolean"){if(!r)return r}else if("True".equals(r)){if("N".equals(r))return!1}else return!1;if(t.indexProcessedColumn&&t.indexProcessedColumn>0)if(u=t.grid.getCellValue(i,t.indexProcessedColumn),typeof u=="boolean"){if(u)return!1}else if("True".equals(u)||"Y".equals(u))return!1;var f=e(i),o=f[0],s=f[1],h=f[2];return n.MRole.canUpdate(o,s,t.AD_Table_ID,h,!1)}function e(i){var e=-1,u,f,r;return typeof t.indexClientColumn!="undefined"&&t.indexClientColumn!=-1&&(r=t.grid.getCellValue(i,t.indexClientColumn),r!=null&&r!==""&&(e=n.Utility.Util.getValueOfInt(r))),u=0,typeof t.indexOrgColumn!="undefined"&&t.indexOrgColumn!=-1&&(r=t.grid.getCellValue(i,t.indexOrgColumn),r!=null&&r!==""&&(u=n.Utility.Util.getValueOfInt(r))),f=0,typeof t.indexKeyColumn!="undefined"&&t.indexKeyColumn!=-1&&(r=t.grid.getCellValue(i,t.indexKeyColumn),r!=null&&r!==""&&(f=n.Utility.Util.getValueOfInt(r))),[e,u,f]}this.grid=null;this.id=null;this.$container=null;this.rendered=!1;this.onSelect=null;this.onCellEditing=null;this.onCellValueChanged=null;this.onSort=null;this.onEdit=null;this.onAdd=null;this.editColumnIndex=-1;var t=this,i={caption:"",sortable:!1,render:function(){return'<img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/pencil.png"  />'},size:"25px"};this.getEditColumn=function(){return i};this.onClick=function(n){this.readOnly||(t.skipEditing=!1,this.records.length>0&&this.records[t.mTab.getCurrentRow()].recid!=n.recid&&(t.skipEditing=!0))};this.onSingleClick=function(){};this.onSelectLocal=function(n){if(t.blockSelect){t.blockSelect=!1;return}if(t.onSelect)t.onSelect(n)};this.checkCellEditable=!0;this.onEditField=function(n){if(t.skipEditing){t.skipEditing=!1;n.isCancelled=!0;this.select({recid:n.recid});return}n.isCancelled=!r(n.column)||n.originalEvent&&n.originalEvent.altKey;t.blockSelect=!n.isCancelled};this.onChange=function(n){if(t.grid.columns[n.column].editable.type=="checkbox"){if(this.records.length>0&&this.records[t.mTab.getCurrentRow()].recid!=n.recid){n.isCancelled=!0;return}n.isCancelled=!r(n.column)}n.onComplete=function(n){var i={newValue:n.value_new,propertyName:t.grid.columns[n.column].field};if(t.onCellValueChanged)t.onCellValueChanged(i,t.grid.columns[n.column].editable.type=="checkbox")}};this.onUnSelect=function(){};this.onRowAdd=function(n){t.paintRow(n.index)};this.paintRow=function(n){var t=this.grid.records[n];if(!u(n,0)){t.style="background-color:whitesmoke";return}t&&t.style&&delete t.style};this.disposeComponenet=function(){t=null;i=null;this.getEditColumn=null;this.onClick=null}}function e(){function o(){r=t("<div class='vis-cv-body vis-noselect'>");n=t("<div class='vis-cv-main'>");f=t("<div class='vis-cv-header'>");r.append(n)}var r,n,f,u,i,e;this.cGroupInfo={};this.cCols=[];this.cConditions=[];this.cGroup=null;this.mTab;this.AD_Window_ID;this.AD_Tab_ID;this.groupCtrls=[];this.fields=[];this.grpCount=0;this.grpColName="";this.hasIncludedCols=!1;this.onCardEdit=null;n=null;o();this.getRoot=function(){return r};this.getBody=function(){return n};this.setHeader=function(n){f.text(n)};this.getHeader=function(){return f};this.sizeChanged=function(n,t){r.height(n-12+"px");this.calculateWidth(t)};this.calculateWidth=function(t){var i=this.groupCtrls.length,r,u;if(!(i<1)){if(t)if(r=262*i,r>t)n.width(262*i);else for(n.width(t),u=Math.ceil(t/i)-24;i>0;)--i,this.groupCtrls[i].setWidth(u);else n.width(262*i);this.navigate()}};u=this;n.on("click","div.vis-cv-card",function(n){var r,i,f;if(u.onCardEdit)if(r=t(n.target),r[0].nodeName=="SPAN"&&r.hasClass("vis-cv-card-edit")){if(i=r.data("recid"),i||i===0)u.onCardEdit({recid:i})}else{for(f=0;!r.hasClass("vis-cv-card");){if(f>5)break;r=r.parent();f++}if(i=r.data("recid"),i||i===0){u.onCardEdit({recid:i},!0);u.navigate(i,!1,!0)}}n.stopPropagation()});this.getAD_CardView_ID=function(){return this.AD_CardView_ID};this.getField_Group_ID=function(){return this.cGroup?this.cGroup.getAD_Field_ID():0};i=null;e=null;this.navigate=function(t,r,u){(t&&(e=t),r)||(i&&i.length>0&&i.toggleClass("vis-cv-card-selected"),i=n.find("div.vis-cv-card[name~=vc_"+e+"]"),i.length!=0&&(i.toggleClass("vis-cv-card-selected"),u||i[0].scrollIntoView()))};this.dC=function(){for(n.off("click"),this.onCardEdit=null,u=null,r.remove(),n.remove(),f.remove(),r=n=f=null,this.getRoot=this.getBody=this.setHeader=this.getHeader=this.dC=null,i=null,this.cGroupInfo={},this.cCols.length=0,this.cConditions.length=0,this.cGroup=null,this.mTab=null,this.fields.length=0,this.grpCount=null;this.groupCtrls.length>0;)this.groupCtrls.pop().dispose()}}function y(i,r,u,f,e){function l(){var n="<div class='vis-cv-cg vis-pull-left'> <div class='vis-cv-head' >"+u+"<\/div><div class='vis-cv-grpbody'><\/div><\/div>";o=t(n);s=o.find(".vis-cv-grpbody");i&&o.css({"margin-right":"0px",width:"100%"})}function a(){for(var t=null,u=0;u<r.length;u++)t=new c(f,r[u]),i&&t.getRoot().width("240px").css({margin:"5px 12px 12px 5px",float:n.Application.isRTL?"right":"left"}),h.push(t),s.append(t.getRoot()),t.evaluate(e)}var o=null,s,h=[];l();a();this.getRoot=function(){return o};this.getBody=function(){return s};this.setWidth=function(n){o.width(n)};this.dC=function(){while(h.length>0)h.pop().dispose();o.remove();o=null;s=null;this.getBody=null;this.getRoot=null}}function c(i,r){var f,s,e,o,h,u,c;for(this.record=r,f=t('<div class="vis-cv-card" data-recid='+r.recid+" name = vc_"+r.recid+" ><\/div>"),s=t('<span class="glyphicon glyphicon-pencil vis-cv-card-edit vis-pull-right" data-recid='+r.recid+"><\/span>"),f.append(s),e=null,h=0;h<i.length;h++)e=i[h],u=r[e.getColumnName().toLowerCase()],o=e.getDisplayType(),n.DisplayType.IsLookup(o)?u=e.getLookup().getDisplay(u):n.DisplayType.YesNo==o?u=u||u=="Y"?n.Msg.getMsg("Yes"):u=n.Msg.getMsg("No"):n.DisplayType.IsDate(o)&&(u=u?o==n.DisplayType.Date?Globalize.format(new Date(u),"d"):col.displayType==n.DisplayType.DateTime?Globalize.format(new Date(u),"f"):Globalize.format(new Date(u),"t"):null),u||u==0||(u=" -- "),u=w2utils.encodeTags(u),c="",c=n.Application.isRTL?"<p><strong title='"+u+"'>"+u+"<\/strong> :"+e.getHeader()+"<\/p>":"<p>"+e.getHeader()+": <strong title='"+u+"'>"+u+"<\/strong><\/p>",f.append(t(c));this.setColor=function(n,t){n&&f.css("background-color",n);t&&f.css("color",n)};s.on("touchstart",function(){t(this).css({color:"gray"})});this.getRoot=function(){return f};this.setWidth=function(n){f.width(n)};this.dC=function(){s.off("touchstart mouseover");f.remove();f=null;this.getRoot=null;this.dc=null}}function l(){function y(t,i){var u=new google.maps.Marker({position:t,animation:google.maps.Animation.DROP,map:n,title:i});u.info=new google.maps.InfoWindow({content:i});u.info.open(n,u);google.maps.event.addListener(u,"click",function(){this.info.open(n,this)});r.push(u)}function p(n,t,i){window.setTimeout(function(){y(n,t)},i)}function a(n){for(var t=0;t<r.length;t++)r[t].setMap(n),google.maps.event.clearListeners(r[t],"click"),r[t].info=null}function w(){a(null)}function v(){w();r=[]}function b(){v();n=null}function k(){n||(n=new google.maps.Map(f[0],c),d())}function d(){var r="",t=i.mapFields,n;if(t.length>1){for(n=0;n<t.length;n++)r+="<option value="+t[n].getColumnName()+" >"+t[n].getHeader()+"<\/option>";o.html(r);o[0].selectedIndex=0;nt()}else s.hide(),f.css("top","0")}function g(){f=t('<div class="vis-mv-map">');e=t('<div class="vis-apanel-busy vis-full-height">').hide();s=t('<div class="vis-mv-header"> <select class="vis-mv-select vis-pull-right" /> <\/div>');o=s.find(".vis-mv-select");h.append(s).append(f).append(e);l&&(c={center:new google.maps.LatLng(26,76),zoom:4,mapTypeId:google.maps.MapTypeId.ROADMAP})}function nt(){o.on("change",function(){i.setBusy(!0);i.curIndex=this.selectedIndex;i.setMapData(i.mapcols[i.curIndex])})}var n=null,h=t('<div class="vis-mv-main">'),f="",e="",r=[],c,u=null,o=null,s=null,i=this,l=window.google&&google.maps?!0:!1;g();this.setBusy=function(n){n?e.show():e.hide()};this.getRoot=function(){return h};this.sizeChanged=function(){};this.setMapData=function(t){var e,r,f;if(l){for(k(),v(),u=null,u=new google.maps.LatLngBounds,google.maps.event.trigger(n,"resize"),e=t.length,r=0;r<e;r++)if(t[r].Latitude&&t[r].Longitude){f=null;try{f=new google.maps.LatLng(Number(t[r].Latitude),Number(t[r].Longitude));p(f,t[r].msg,100);u.extend(f);n.fitBounds(u)}catch(o){console.log(o)}}n.fitBounds(u);i.setBusy(!1)}};this.dc=function(){b();h.remove();this.cols=this.gc=this.aPanel=this.mapcols=null;this.mapFields=null;this.curIndex=0;this.getRoot=null;this.dc=null}}var o=43,a=50,h=40,w=n.Logging.Level;u.prototype.setName=function(n){this.name=n};u.prototype.getName=function(){return this.name};u.prototype.sizeChanged=function(t,i){t||(t=n.Env.getScreenHeight());i||(i=window.innerWidth);this.setSize(t);var r=this.isHeaderVisible?o:0;this.cPanel.sizeChanged(t-r,i)};u.prototype.refresh=function(){return this.cPanel.refresh(),this};u.prototype.keyDown=function(n){return this.cPanel.keyDown&&this.cPanel.keyDown(n),this};u.prototype.initWindow=function(i,r,u,f,e){var s,o;return this.cPanel=new n.APanel,s=n.Env.getWindowNo(),this.id=s+"_"+i,this.hid=f+"="+i,o=this,n.AEnv.getGridWindow(s,i,function(i){if(i.error!=null){n.ADialog.error(i.error);o.dispose();o=null;return}var f=t.parseJSON(i.result);n.context.setContextOfWindow(t.parseJSON(i.wCtx),s);o.cPanel.initPanel(f,r,o,!1,e);o.sizeChanged();o.cPanel.selectFirstTab();n.MLookupCache.initWindowLookup(s);u&&u(o.id,null,o.name,o.hid);o.onLoad&&o.onLoad();f=null;o=null}),this.AD_Window_ID=i,this.windowNo=s,this.getRootLayout().id=this.id,this.getContentGrid().append(this.cPanel.getRoot()),!0};u.prototype.setCFrameContent=function(n,t){this.cPanel=n;this.windowNo=t;this.id=this.windowNo+"_CFrame";this.getRootLayout().id=this.id;this.getContentGrid().append(this.cPanel.getRoot())};u.prototype.initForm=function(i,r,u){var e,f;return this.cPanel=new n.AForm(n.Env.getScreenHeight()-o),e=n.Env.getWindowNo(),this.id=e+"_"+i,this.hid=u+"="+i,f=this,n.dataContext.getFormDataString({AD_Form_ID:i},function(i){if(i.error!=null){n.ADialog.error(i.error);f.dispose();f=null;return}var u=t.parseJSON(i.result);if(u.IsError){n.ADialog.error(u.Message);f.dispose();f=null;return}if(f.setTitle(u.DisplayName),f.setName(u.DisplayName),!f.cPanel.openForm(u,f,e)){f.dispose();f=null;return}r&&r(f.id,null,f.name,f.hid);u=null;f=null}),this.windowNo=e,this.getRootLayout().id=this.id,this.getContentGrid().append(this.cPanel.getRoot()),!0};u.prototype.initProcess=function(i,r,u){var e,f;return this.cPanel=new n.AProcess(n.Env.getScreenHeight()-o),e=n.Env.getWindowNo(),this.id=e+"_"+i,this.hid=u+"="+i,f=this,n.dataContext.getProcessDataString({AD_Process_ID:i},function(u){if(u.error!=null){n.ADialog.error(u.error);f.dispose();f=null;return}var o=t.parseJSON(u.result);if(o.IsError){n.ADialog.error(o.Message);f.dispose();f=null;return}if(f.setTitle(""),f.setName(o.Name),o.AD_Process_ID=i,!f.cPanel.init(o,f,e)){f.dispose();f=null;return}r&&r(f.id,null,f.name,f.hid);o=null;f=null}),this.windowNo=e,this.getRootLayout().id=this.id,this.getContentGrid().append(this.cPanel.getRoot()),!0};u.prototype.getTitile=function(){return this.title};u.prototype.getAD_Window_ID=function(){return this.AD_Window_ID};u.prototype.show=function(n,t){return n.append(this.getRootLayout()),t&&t(this.id,null,this.name,this.hid),!0};u.prototype.getId=function(){return this.id};u.prototype.getWindowNo=function(){return this.windowNo};u.prototype.dispose=function(){(!this.onClosed||this.onClosed(this.id,this.$layout,this.hid,this.AD_Window_ID))&&(this.onClosed=null,this.cPanel&&this.cPanel.dispose(),this.cPanel=null,this.children=null,this.disposeComponent())};i.prototype.ACTION_NAME_FIRST="First";i.prototype.ACTION_NAME_LAST="Last";i.prototype.ACTION_NAME_PREV="Previous";i.prototype.ACTION_NAME_NEXT="Next";i.prototype.ACTION_NAME_NEW="New";i.prototype.ACTION_NAME_DELETE="Delete";i.prototype.ACTION_NAME_REFRESH="Refresh";i.prototype.ACTION_NAME_FIND="Find";i.prototype.ACTION_NAME_CHAT="Chat";i.prototype.ACTION_NAME_APPOINTMENT="Appointment";i.prototype.ACTION_NAME_ARCHIVE="Archive";i.prototype.keyDown=function(n){if(n.altKey&&this.curGC){var t=this.aNew.getIsEnabled();switch(n.keyCode){case 65:t&&this.actionPerformed(this.aNew.getAction());break;case 83:t||this.actionPerformed(this.aSave.getAction());break;case 68:t&&this.actionPerformed(this.aDelete.getAction());break;case 90:t||this.actionPerformed(this.aIgnore.getAction());break;case 88:this.$parentWindow.dispose()}n.preventDefault();n.stopPropagation()}};i.prototype.sizeChanged=function(n,t){this.setSize(n,t);this.vTabbedPane&&this.vTabbedPane.sizeChanged(n-(a+h),t)};i.prototype.refresh=function(){this.curGC&&this.curGC.vTable.resize()};i.prototype.addActions=function(t,i,r,u,f,e,o){var t=new n.AppsAction({action:t,parent:i,enableDisable:r,toggle:o,imageOnly:u,isSmall:f,onAction:e});return t};i.prototype.initPanel=function(i,r,u,f,e){var y,a,s,p,b,o,v,w,g,c,k,nt;this.$parentWindow=u;y=new n.GridWindow(i);this.gridWindow=y;this.createToolBar();var h=u.getWindowNo(),d=this.ctx.isAutoNew(),l=y.getTabs();for(this.ctx.setAutoCommit(h,this.ctx.isAutoCommit()),this.ctx.setAutoNew(h,d),this.ctx.setIsSOTrx(h,y.getIsSOTrx()),!d&&y.getIsTransaction()&&this.ctx.setAutoNew(h,!0),this.ctx.setContext(h,"WindowName",y.getName()),!r&&e&&(r=new n.Query,a=l[0].getKeyColumnName(),a.length==0&&(a=l[0].getLinkColumnName()),a.length!=0&&(a.endsWith("_ID")?r.addRestriction(a,n.Query.prototype.EQUAL,e):r.addRestriction(a,n.Query.prototype.EQUAL,e))),p=[],b={},o=0;o<l.length;o++)v=h+"_"+l[o].getAD_Tab_ID(),p[o]=new n.AppsAction({action:v,text:l[o].getName(),toolTipText:l[o].getDescription,textOnly:!0}),s=l[o],o===0&&(this.curTab=s,r!=null&&s.setQuery(r)),w=null,s.getIsSortTab()?(g=new n.VSortTab(h,s.getAD_Table_ID(),s.getAD_ColumnSortOrder_ID(),s.getAD_ColumnSortYesNo_ID(),s.getIsReadOnly(),v),w=g,o==0&&(firstTabId=v)):(c=new n.GridController(!0,!0,v),c.initGrid(!1,h,this,s),o===0&&(this.curGC=c,this.firstTabId=v),w=c,o===0&&f&&c.switchSingleRow(),s.getIncluded_Tab_ID()!=0&&(b[s.getIncluded_Tab_ID()]=c,o==0&&(this.aParentDetail=new n.AParentDetail(c,this.getParentDetailPane()))),t.isEmptyObject(b)||(k=b[s.getAD_Tab_ID()],k!=null&&(nt=k.includeTab(c)))),this.vTabbedPane.addTab(v,s,w,p[o]),w&&this.getLayout().append(w.getRoot()),p[o].onAction=this.onTabChange;this.setTabControl(p);p=null;this.ctx.setWindowContext(h,"WindowName",i._vo.DisplayName);u.setTitle(n.Env.getHeader(this.ctx,h));u.setName(i._vo.DisplayName);this.curWindowNo=h;i=null;u=null};i.prototype.selectFirstTab=function(){setTimeout(function(n){n.tabActionPerformed(n.firstTabId);n.setTabNavigation();n=null},10,this)};i.prototype.getIsUILocked=function(){return this.isLocked};i.prototype.lockUI=function(){this.setBusy(!0,!1)};i.prototype.unlockUI=function(t){var r=t!=null&&t.getAD_Process_ID()!=this.curTab.getAD_Process_ID(),i;r&&(this.curTab.dataRefresh(),t.getIsTimeout()&&n.context.setWindowContext(this.curWindowNo,"Processed","Y"),this.curGC.dynamicDisplay(-1),this.setStatusLine(t.getSummary(),t.getIsError()),n.ProcessInfoUtil.setLogFromDB(t),i=t.getLogInfo(),i.length>0&&(n.ADialog.info(t.getTitle(),!0,i,""),this.setStatusLine(t.getSummary(),t.getIsError())));this.setBusy(!1,r)};i.prototype.actionPerformed=function(i){this.getIsUILocked()||(this.setBusy(!0),setTimeout(function(r){var o,u,f,e,s,h;if(i.source instanceof n.Controls.VButton){r.actionButton(i.source)||r.setBusy(!1,!0);return}r.aFirst.getAction()===i?r.curGC.navigate(0):r.aPrevious.getAction()===i?r.curGC.navigateRelative(-1):r.aLast.getAction()===i?r.curGC.navigate(r.curTab.getRowCount()-1):r.aNext.getAction()===i?r.curGC.navigateRelative(1):r.aMulti.getAction()===i?(r.aMulti.setPressed(!r.curGC.getIsSingleRow()),r.curGC.switchRowPresentation()):r.aCard.getAction()===i?(r.aMulti.setPressed(!1),r.curGC.switchCardRow()):r.aMap.getAction()===i?(r.aMulti.setPressed(!0),r.curGC.switchMapRow()):r.aPageUp.getAction()===i?r.curGC.navigatePage(-1):r.aPageFirst.getAction()===i?r.curGC.navigatePage(0):r.aPageDown.getAction()===i?r.curGC.navigatePage(1):r.aPageLast.getAction()===i?r.curGC.navigatePage("last"):r.aRefresh.getAction()===i?r.cmd_refresh():r.aIgnore.getAction()===i?r.cmd_ignore():r.aSave.getAction()===i?r.cmd_save(!0):r.aNew.getAction()===i?r.cmd_new(!1):r.aCopy&&r.aCopy.getAction()===i?r.cmd_new(!0):r.aDelete.getAction()===i?r.cmd_delete():r.aFind.getAction()===i?r.cmd_finddialog():r.aChat&&r.aChat.getAction()===i?r.cmd_chat():r.aAttachment&&r.aAttachment.getAction()===i?r.cmd_attachment():r.aHistory&&r.aHistory.getAction()==i?r.cmd_history():r.aPreference.getAction()===i?r.cmd_preference():r.aHelp.getAction()===i?r.cmd_help():r.aCardDialog.getAction()===i?r.cmd_cardDialog():r.aAppointment&&r.aAppointment.getAction()===i?r.cmd_appointment():r.aTask&&r.aTask.getAction()===i?r.cmd_task():r.aSubscribe&&r.aSubscribe.getAction()===i?r.cmd_subscribe():r.aImportMap&&r.aImportMap.getAction()===i?r.cmd_ImportMap():r.aEmail&&r.aEmail.getAction()===i?r.cmd_email():r.aLetter&&r.aLetter.getAction()===i?r.cmd_letter():r.aSms&&r.aSms.getAction()===i?r.cmd_sms():r.aInfo.getAction()===i?r.cmd_infoWindow():r.aZoomAcross&&r.aZoomAcross.getAction()===i?r.cmd_zoomAcross():r.aRequest&&r.aRequest.getAction()===i?r.cmd_request():r.aReport.getAction()===i?r.cmd_report():r.isPersonalLock&&r.aLock.getAction()===i?r.cmd_lock():r.isPersonalLock&&r.aRecAccess.getAction()===i?r.cmd_recAccess():r.aWorkflow!=null&&i===r.aWorkflow.getAction()?r.curTab.getRecord_ID()>0&&n.AEnv.startWorkflowProcess(r.curTab.getAD_Table_ID(),r.curTab.getRecord_ID()):r.aPrint.getAction()===i?r.cmd_print():r.aCreateDocument&&r.aCreateDocument.getAction()===i?window.VADMS?(u=new n.CFrame,o=new window.VADMS.editDocument(0,"",0,"",0,null,"",r.curTab.getAD_Window_ID(),r.curTab.getAD_Table_ID(),r.curTab.getRecord_ID()),u.setName(n.Msg.getMsg("VADMS_CreateDocument")),u.setTitle(n.Msg.getMsg("VADMS_CreateDocument")),u.hideHeader(!0),u.setContent(o),o.initialize(),u.show()):n.ADialog.error("PleaseInstallDMSModule",!0,""):r.aUploadDocument&&r.aUploadDocument.getAction()===i?window.VADMS?window.VADMS.uploaddocument(0,r.curTab.getAD_Window_ID(),r.curTab.getAD_Table_ID(),r.curTab.getRecord_ID()):n.ADialog.error("PleaseInstallDMSModule",!0,""):r.aViewDocument&&r.aViewDocument.getAction()===i?window.VADMS?(u=new n.CFrame,f=new window.VADMS.DocumentManagementSystem,u.setName(n.Msg.getMsg("VADMS_Document")),u.setTitle(n.Msg.getMsg("VADMS_Document")),u.hideHeader(!0),f.setWindowNo(n.Env.getWindowNo()),f.setWindowID(r.curTab.getAD_Window_ID()),f.setTableID(r.curTab.getAD_Table_ID()),f.setRecordID(r.curTab.getRecord_ID()),f.setWindowName(r.gridWindow.getName()),u.setContent(f),f.initialize(),u.show()):n.ADialog.error("PleaseInstallDMSModule",!0,""):r.aAttachFrom&&r.aAttachFrom.getAction()===i?window.VADMS?(e=r,s=n.context.getContext("VADMS_Document_ID"),s.length>0&&(h={docID:s,winID:r.curTab.getAD_Window_ID(),tableID:r.curTab.getAD_Table_ID(),recID:r.curTab.getRecord_ID()},t.ajax({url:n.Application.contextUrl+"JsonData/AttachFrom",dataType:"json",data:h,success:function(t){JSON.parse(t)=="OK"?(e.curTab.loadDocuments(),e.aViewDocument.setPressed(e.curTab.hasDocument()),n.ADialog.ask("AttachWithOther")||n.context.setContext("VADMS_Document_ID",0),e=null):n.ADialog.error("NotAttached",!0,"")}}))):n.ADialog.error("PleaseInstallDMSModule",!0,""):r.aMarkToExport.getAction()===i&&r.cmd_markToExport();r.setBusy(!1);r=null},20,this))};i.prototype.actionButton=function(i){var b=!1,k=!1,o=i.getColumnName(),s=n.context,r=this,g,nt,y,u,tt,h,f,p,e,c,it,l,a,w,d,rt;if(o.equals("Record_ID")){g=s.getContextAsInt(this.curWindowNo,"AD_Table_ID");nt=s.getContextAsInt(this.curWindowNo,"Record_ID");n.AEnv.zoom(g,nt);return}if(!this.curTab.needSave(!0,!1)||this.cmd_save(!0)){if(y=this.curTab.getAD_Table_ID(),u=this.curTab.getRecord_ID(),u==-1&&this.curTab.getKeyColumnName().equals("AD_Language")&&(u=s.getContextAsInt(this.curWindowNo,"AD_Language_ID")),u==-1&&(i.getProcess_ID()==306||i.getProcess_ID()==307)&&(tt=this.curTab.getValue("AD_ChangeLog_ID"),u=tt),u==-1&&this.curTab.getKeyColumnName().equals("EntityType")&&(u=this.curTab.getValue("AD_EntityType_ID")),u==-1&&this.curTab.getKeyColumnName().toUpperCase().endsWith("_ID")){n.ADialog.error("SaveErrorRowNotFound",!0,"");return}if(o.equals("PaymentRule")){h=new n.VPayment(this.curWindowNo,this.curTab,i);h.show();h.init();h.onClose=function(){h.isInitOK()&&(r.curGC.dynamicDisplay(i.getName()),r.cmd_save(!1),v(i,y,u,s,r,b,k))};return}if(o.equals("DocAction")){f=new n.VDocAction(this.curWindowNo,this.curTab,u);f.show();f.onClose=function(){if(f.getNumberOfOptions()==0){f.dispose();r.log.info("DocAction - No Options");return}if(!f.isStartProcess()){f.dispose();return}k=f.isBatch();b=!0;v(i,y,u,s,r,b,k);f.dispose();r=null};return}if(o.equals("CreateFrom")){if(p=!1,(this.curTab.getAD_Window_ID()==341||this.curTab.getAD_Window_ID()==170)&&(window.MMPM?(c=MMPM.Requisition.prototype.create(this.curTab.getAD_Window_ID(),this.curTab.getRecord_ID()),p=!0):window.DTD001&&(c=DTD001.Requisition.prototype.create(this.curTab.getAD_Window_ID(),this.curTab.getRecord_ID()),p=!0)),p)return;if(e=n.VCreateFrom.prototype.create(this.curTab),e!=null){e.isInitOK()?(e.showDialog(),e.onClose=function(){e.dispose();this.curTab.dataRefresh()},e=null):e.dispose();return}}else{if(o.equals("GenerateSticker")){window.DTD001&&(c=DTD001.StickerProduct.prototype.create(this.curTab.getAD_Window_ID(),this.curTab.getRecord_ID()));return}if(o=="Posted"&&n.MRole.getDefault().getIsShowAcct()){if(it=n.context.getWindowContext(this.curWindowNo,"Processed"),it!="Y"&&(l=n.context.getWindowContext(this.curWindowNo,"DocStatus"),DocActionVariables.STATUS_Completed!=l&&DocActionVariables.STATUS_Closed!=l&&DocActionVariables.STATUS_Reversed!=l&&DocActionVariables.STATUS_Voided!=l)){alert(n.Msg.getMsg("PostDocNotComplete"));return}if(a=this.curTab.getValue("Posted"),a!=null&&a=="Y")w=new n.AcctViewer(n.context.getAD_Client_ID(),this.curTab.getAD_Table_ID(),this.curTab.getRecord_ID(),this.curWindowNo,this.curTab.getAD_Window_ID()),w!=null&&(this.setBusy(!1),w.showDialog()),w=null;else if(n.ADialog.ask("PostImmediate?")){if(d=a!=null&&a!="N",window.FRPT){var ut=Number(n.context.getWindowTabContext(this.curWindowNo,0,"AD_Org_ID")),ft=this.curTab.getAD_Window_ID(),et=Number(n.context.getWindowTabContext(this.curWindowNo,0,"C_DocType_ID")),ot=FRPT.PostingLogic(this.curWindowNo,this.curTab.getAD_Table_ID(),this.curTab.getRecord_ID(),d,ut,ft,et);r.curGC.dataRefresh();return}t.ajax({url:n.Application.contextUrl+"Posting/PostImmediate",dataType:"json",data:{AD_Client_ID:n.context.getAD_Client_ID(),AD_Table_ID:this.curTab.getAD_Table_ID(),Record_ID:this.curTab.getRecord_ID(),force:d},error:function(){r.setBusy(!1,!0);alert(n.Msg.getMsg("ERRORGettingPostingServer"))},success:function(n){n.result!="OK"?alert(n.result):r.curGC.dataRefresh();r.setBusy(!1,!0)}})}else return!1;return!0}if(o.equals("SendNewEMail"))return}return rt=v(i,y,u,s,r),r=null,rt}};i.prototype.tabActionPerformed=function(t){var s,i,u;if(!this.vTabbedPane.getIsTabChanged(t))return console.log("tabNotChange"),!1;var h=!1,f=!1,r=this.vTabbedPane.getTabElement(t),e=this.curST||this.curGC,o=null;if(!this.vTabbedPane.getIsWorkbench()){if(this.curWinTab=this.vTabbedPane,s=this.curWinTab.getSelectedIndex(),h=s<this.curTabIndex,i=null,u=null,r instanceof n.VSortTab?(u=r,f=!0):i=r,this.curGC!=null){if(this.curTab.needSave(!0,!1))if(this.curTab.needSave(!0,!0))if(this.ctx.isAutoCommit(this.curWindowNo)){if(!this.curTab.dataSave(!0))return this.vTabbedPane.restoreTabChange(),this.setBusy(!1,!0),!1}else if(n.ADialog.ask("SaveChanges?",!0,this.curTab.getCommitWarning(),"")){if(!this.curTab.dataSave(!0))return this.vTabbedPane.restoreTabChange(),this.setBusy(!1,!0),!1}else this.curTab.dataIgnore();else this.curTab.dataIgnore();e=this.curGC;o=this.curGC;this.curGC=null}this.curST!=null&&(this.curST.saveData(),this.curST.unRegisterAPanel(),e=this.curST,this.curST=null);this.curTabIndex=s;f||(this.curGC=i)}return this.setSelectedTab(t),f?(this.curST=u,u.registerAPanel(this),u.loadData()):(i.activate(o),o&&o.detachDynamicAction(),this.curTab=i.getMTab(),this.setDynamicActions(),h&&this.curTab.getIsCurrent()?i.dataRefresh():(this.curTab.getTableModel().setCurrentPage(1),i.query(this.curTab.getOnlyCurrentDays(),0,!1))),f?(this.aMulti.setPressed(!1),this.aMulti.setEnabled(!1),this.aCard.setEnabled(!1),this.aCardDialog.setEnabled(!1),this.aNew.setEnabled(!1),this.aDelete.setEnabled(!1),this.aFind.setEnabled(!1),this.aRefresh.setEnabled(!1),this.aNext.setEnabled(!1),this.aLast.setEnabled(!1),this.aFirst.setEnabled(!1),this.aPrevious.setEnabled(!1),this.aPageFirst.setEnabled(!1),this.aPageUp.setEnabled(!1),this.aPageLast.setEnabled(!1),this.aPageDown.setEnabled(!1)):(this.aMulti.setEnabled(!0),this.aMulti.setPressed(this.curGC.getIsSingleRow()||this.curGC.getIsMapRow()),this.aCard.setEnabled(!0),this.aCardDialog.setEnabled(!0),this.aFind.setEnabled(!0),this.aRefresh.setEnabled(!0)),e.setVisible(!1),r.setVisible(!0),this.aParentDetail&&this.aParentDetail.evaluate(r),e=r=null,this.curTab.getAD_Process_ID()==0?this.aPrint.setEnabled(!1):this.aPrint.setEnabled(!0),this.curTab.getIsMapView()?this.aMap.show():this.aMap.hide(),!0};i.prototype.dataStatusChanged=function(t){var o=t.getMessage(),p=this.curTab.getIsQueryActive()||this.curTab.getOnlyCurrentDays()>0,i,s,e,y,h,c,l,a,v;p&&(o="[ "+o+" ]");this.statusBar.setStatusDB(o,t);(t.getAD_Message()!=null||t.getInfo()!=null)&&(i=new StringBuilder,s=t.getMessage(),s!=null&&s.length>0&&i.append(n.Msg.getMsg(t.getAD_Message())),e=t.getInfo(),e!=null&&e.length>0&&(i.length()>0&&!i.endsWith(":")&&i.append(": "),i.append(e)),i.length()>0&&(y=i.indexOf("\n"),y!=-1&&i.replace("\n"," - "),this.setStatusLine(i.toString(),t.getIsError())));t.getIsError()&&!t.getIsConfirmed()?(n.ADialog.error(t.getAD_Message(),!0,t.getInfo()),t.setConfirmed(!0),this.errorDisplayed=!0):t.getIsWarning()&&!t.getIsConfirmed()&&(n.ADialog.warn(t.getAD_Message(),!0,t.getInfo()),t.setConfirmed(!0));h=t.getIsFirstRow();this.aFirst.setEnabled(!h);this.aPrevious.setEnabled(!h);c=t.getIsLastRow();this.aNext.setEnabled(!c);this.aLast.setEnabled(!c);l=t.getIsFirstPage();this.aPageFirst.setEnabled(!l);this.aPageUp.setEnabled(!l);a=t.getIsLastPage();this.aPageLast.setEnabled(!a);this.aPageDown.setEnabled(!a);var r=t.getIsChanged()||t.getIsInserting(),u=this.curTab.getIsReadOnly(),f=!u;f&&(f=this.curTab.getIsInsertRecord());this.aNew.setEnabled(!r&&f);this.aCopy&&this.aCopy.setEnabled(!r&&f);this.aRefresh.setEnabled(!r);this.aDelete.setEnabled(!r&&!u&&t.getCurrentRow()>-1);u&&this.curTab.getIsAlwaysUpdateField()&&(u=!1);this.aIgnore.setEnabled(r&&!u);this.aSave.setEnabled(r&&!u);this.aCardDialog.setEnabled(!r);t.getTotalRows()==0&&f&&(this.aNew.setEnabled(!0),this.aDelete.setEnabled(!1));this.aMulti.setPressed(this.curGC.getIsSingleRow()||this.curGC.getIsMapRow());this.aChat&&this.aChat.setPressed(this.curTab.hasChat());this.aAttachment&&this.aAttachment.setPressed(this.curTab.hasAttachment());this.aMarkToExport&&this.aMarkToExport.setPressed(this.curTab.hasMarked());this.aSubscribe&&this.aSubscribe.setPressed(this.curTab.HasSubscribed());this.isPersonalLock&&(this.aLock.setEnabled(!0),this.aLock.setPressed(this.curTab.getIsLocked()),this.aRecAccess.setEnabled(!0));this.curTab.getRecord_ID()==-1?(this.aChat&&this.aChat.setEnabled(!1),this.aAttachment&&this.aAttachment.setEnabled(!1),this.aSubscribe&&this.aSubscribe.setEnabled(!1),this.aImportMap&&this.aImportMap.setEnabled(!1),this.aHistory&&this.aHistory.setEnabled(!1),this.aEmail&&this.aEmail.setEnabled(!1),this.aLetter&&this.aLetter.setEnabled(!1),this.aSms&&this.aSms.setEnabled(!1),this.aFaxEmail&&this.aFaxEmail.setEnabled(!1),this.aCreateDocument&&this.aCreateDocument.setEnabled(!1),this.aUploadDocument&&this.aUploadDocument.setEnabled(!1),this.aViewDocument&&this.aViewDocument.setEnabled(!1),this.aAttachFrom&&this.aAttachFrom.setEnabled(!1),this.aZoomAcross&&this.aZoomAcross.setEnabled(!1),this.aMarkToExport&&this.aMarkToExport.setEnabled(!1),this.aArchive&&this.aArchive.setEnabled(!1),this.aEmailAttach&&this.aEmailAttach.setEnabled(!1),this.aAppointment&&this.aAppointment.setEnabled(!1),this.aTask&&this.aTask.setEnabled(!1),this.aRequest&&this.aRequest.setEnabled(!1),this.aWorkflow&&this.aWorkflow.setEnabled(!1),this.aCopy&&this.aCopy.setEnabled(!1),this.aLock&&this.aLock.setEnabled(!1),this.aRecAccess&&this.aRecAccess.setEnabled(!1)):(this.aChat&&this.aChat.setEnabled(!0),this.aAttachment&&this.aAttachment.setEnabled(!0),this.aSubscribe&&this.aSubscribe.setEnabled(!0),this.aHistory&&this.aHistory.setEnabled(!0),this.aEmail&&this.aEmail.setEnabled(!0),this.aLetter&&this.aLetter.setEnabled(!0),this.aSms&&this.aSms.setEnabled(!0),this.aFaxEmail&&this.aFaxEmail.setEnabled(!0),this.aImportMap&&this.aImportMap.setEnabled(!0),this.aCreateDocument&&this.aCreateDocument.setEnabled(!0),this.aUploadDocument&&this.aUploadDocument.setEnabled(!0),this.aViewDocument&&this.aViewDocument.setEnabled(!0),this.aAttachFrom&&this.aAttachFrom.setEnabled(!0),this.aZoomAcross&&this.aZoomAcross.setEnabled(!0),this.aMarkToExport&&this.aMarkToExport.setEnabled(!0),this.aArchive&&this.aArchive.setEnabled(!0),this.aEmailAttach&&this.aEmailAttach.setEnabled(!0),this.aAppointment&&this.aAppointment.setEnabled(!0),this.aTask&&this.aTask.setEnabled(!0),this.aRequest&&this.aRequest.setEnabled(!0),this.aWorkflow&&this.aWorkflow.setEnabled(!0),this.aCopy&&this.aCopy.setEnabled(!0),this.aLock&&this.aLock.setEnabled(!0));v=n.GridTab.prototype.getTrxInfo(this.curTab.getTableName(),n.context,this.curTab.getWindowNo(),this.curTab.getTabNo());v!=null&&this.statusBar.setInfo(v);this.curWinTab==this.vTabbedPane&&this.curWinTab.evaluate(null)};i.prototype.setStatusLine=function(n,t){this.statusBar.setStatusLine(n,t)};i.prototype.cmd_refresh=function(){this.cmd_save(!1);this.curGC.dataRefreshAll()};i.prototype.cmd_ignore=function(){this.curGC.dataIgnore()};i.prototype.cmd_help=function(){var t=new n.Apps.help(this.gridWindow)};i.prototype.cmd_cardDialog=function(){var t=new n.CVDialog(this);t.show()};i.prototype.cmd_save=function(t){if(this.curST!=null&&(t=!1),this.errorDisplayed=!1,this.curST!=null){this.curST.saveData();this.aSave.setEnabled(!1);return}if(this.curTab.getCommitWarning().length>0&&this.curTab.needSave(!0,!1)&&!n.ADialog.ask("SaveChanges?",!0,this.curTab.getCommitWarning()))return!1;var i=this.curGC.dataSave(t);return t&&!i&&!this.errorDisplayed,t&&this.curGC.dynamicDisplay(-1),i};i.prototype.cmd_new=function(n){this.curTab.getIsInsertRecord()&&this.curGC.dataNew(n)};i.prototype.cmd_delete=function(){if(!this.curTab.getIsReadOnly()){var t=this.curGC.canDeleteRecords();if(t.length>0){n.ADialog.error("CannotDelete",!0," [ "+t.join(",")+"]");return}n.ADialog.ask("DeleteRecord?")&&this.curGC.dataDelete()}};i.prototype.cmd_find=function(n){var t,r,i,u;this.curTab&&(this.setBusy(!0),t=null,n&&n.trim()!==""&&(n="%"+n+"%",t=this.curTab.getSearchQuery(n)),r=0,i=!1,this.curTab.getTableModel().setCurrentPage(1),this.curGC.skipRowInserting(!0),t!=null&&t.getIsActive()?(this.curTab.setQuery(t),this.curGC.query(0,0,i)):(u=0,this.curTab.setQuery(null),this.curGC.query(r,u,i)))};i.prototype.cmd_chat=function(){var o=this.curTab.getRecord_ID(),r,u,f,t,i,e;if(o==-1){this.aChat.setEnabled(!1);return}for(r=null,u=null,f=0;f<this.curTab.getFieldCount();f++)if(t=this.curTab.getField(f),t.getIsKey()&&(r=t.getHeader()),(t.getColumnName().toString()=="Name"||t.getColumnName().toString()=="DocumentNo")&&t.getValue()!=null&&t.getValue()!=""&&(u=t.getValue()),r!=null&&u!=null)break;i=this;e=new n.Chat(o,this.curTab.getCM_ChatID(),this.curTab.getAD_Table_ID(),r+": "+u,this.curWindowNo);e.onClose=function(){i.curTab.loadChats();i.aChat.setPressed(i.curTab.hasChat());i=null};e.show()};i.prototype.cmd_appointment=function(){var t=this.curTab.getRecord_ID(),i=this.curTab.getAD_Table_ID();t!=-1&&n.AppointmentsForm.init(i,t,0,0,!1)};i.prototype.cmd_task=function(){var t=this.curTab.getRecord_ID(),i=this.curTab.getAD_Table_ID();t!=-1&&n.AppointmentsForm.init(i,t,0,0,!0)};i.prototype.cmd_letter=function(){var r=this.curTab.getRecord_ID(),i,t;if(r==-1){this.aLetter.setEnabled(!1);return}i=new n.Email("",this.curTab,this.curGC,r,!1);t=new n.CFrame;t.setName(n.Msg.getMsg("Letter"));t.setTitle(n.Msg.getMsg("Letter"));t.hideHeader(!0);t.setContent(i);t.show();i.initializeComponent()};i.prototype.cmd_email=function(){var r=this.curTab.getRecord_ID(),i,t;if(r==-1){this.aEmail.setEnabled(!1);return}i=new n.Email("",this.curTab,this.curGC,r,!0);t=new n.CFrame;t.setName(n.Msg.getMsg("EMail"));t.setTitle(n.Msg.getMsg("EMail"));t.hideHeader(!0);t.setContent(i);t.show();i.initializeComponent()};i.prototype.cmd_report=function(){var f,t,i,r,e,o,u,s,h;if(!n.MRole.getDefault().getIsCanReport(this.curTab.getAD_Table_ID())){n.ADialog.warn("AccessCannotReport");return}if(this.curTab.needSave(!0,!1)){this.cmd_save(!0);return}for(f=this.curTab.query,t=this.curTab.getLinkColumnName(),t.length==0&&(t=this.curTab.getKeyColumnName()),i=null,r=null,e=0,o=this.curTab.getFieldCount();e<o;e++)if(u=this.curTab.getField(e),u.getIsKey()&&(i=u.getHeader()),(u.getColumnName()=="Name"||u.getColumnName()=="DocumentNo")&&u.getValue()!=null&&(r=u.getValue()),i!=null&&r!=null)break;s=this.curTab.getParentColumnNames().length==0;t.length!=0&&(s&&(this.curTab.getLinkColumnName()==null||this.curTab.getLinkColumnName()=="")||(t.endsWith("_ID")?i==null&&r==null?f.addRestriction(t,n.Query.prototype.EQUAL,n.context.getContextAsInt(this.curWindowNo,t)):f.addRestriction(t,n.Query.prototype.EQUAL,n.context.getContextAsInt(this.curWindowNo,t),i,r):i==null&&r==null?f.addRestriction(t,n.Query.prototype.EQUAL,n.context.getContext(this.curWindowNo,t)):f.addRestriction(t,n.Query.prototype.EQUAL,n.context.getContext(this.curWindowNo,t),i,r)));h=new n.AReport(this.curTab.getAD_Table_ID(),f,this.curTab.getAD_Tab_ID(),this.curWindowNo,this.curTab)};i.prototype.cmd_print=function(){var i=this.curTab.getRecord_ID(),t,r;if(i==-1){n.ADialog.info(n.Msg.getMsg("SelectRecord"));return}if(t=this.curTab.getAD_Process_ID(),t!=0){if(this.curTab.needSave(!0,!1)){this.cmd_save(!0);return}r=new n.APrint(t,this.curTab.getAD_Table_ID(),i,this.curWindowNo);r.start(this.aPrint.getListItmIT())}};i.prototype.cmd_sms=function(){var r=this.curTab.getRecord_ID(),i,t;if(r==-1){this.aSms.setEnabled(!1);return}i=new n.Sms(this.curTab,this.curGC,r,!1);t=new n.CFrame;t.setName(n.Msg.getMsg("Sms"));t.setTitle(n.Msg.getMsg("Sms"));t.hideHeader(!0);t.setContent(i);t.show();i.initializeComponent()};i.prototype.cmd_subscribe=function(){var i=this.curTab.getRecord_ID(),t,r;if(i==-1){this.aSubscribe.setEnabled(!1);return}t=this;r=function(){t.curTab.loadSubscribe();t.aSubscribe.setPressed(t.curTab.HasSubscribed())};n.dataContext.subscribeUnsubscribeRecords(this.curTab.getCM_SubScribedID(),this.curTab.getAD_Window_ID(),i,this.curTab.getAD_Table_ID(),r)};i.prototype.cmd_ImportMap=function(){if(window.VDIU){if(this.curTab.getIsReadOnly()){this.log.warn("ReadOnly");return}var i=new VDIU.ImportExcel(this.curTab.getAD_Window_ID(),this.gridWindow.getName()),t=new n.CFrame;t.setName(n.Msg.getMsg("Import"));t.setTitle(n.Msg.getMsg("Import"));t.setContent(i);t.show();i.initialize()}else n.ADialog.error("PleaseInstallExcelImportModule")};i.prototype.cmd_attachment=function(){if(this.curTab.getRecord_ID()<1){this.aAttachment.setEnabled(!1);return}var t=this,i=new n.attachmentForm(0,0,this.curTab.getAD_Table_ID(),this.curTab.getRecord_ID(),"");i.show();i.onClose=function(){t.curTab.loadAttachments();t.aAttachment.setPressed(t.curTab.hasAttachment());t=null}};i.prototype.cmd_history=function(){var t=null,i=0,r=0;(Object.keys(this.curGC.getColumnNames()).indexOf("C_BPartner_ID")>0||this.curTab.getField("C_BPartner_ID")!=null&&this.curTab.getField("C_BPartner_ID").getValue()>0)&&(i=this.curTab.getField("C_BPartner_ID").getValue());(Object.keys(this.curGC.getColumnNames()).indexOf("AD_User_ID")>0||this.curTab.getField("AD_User_ID")!=null&&this.curTab.getField("AD_User_ID").getValue()>0)&&(r=this.curTab.getField("AD_User_ID").getValue());t=new n.AttachmentHistory(this.curTab.getAD_Table_ID(),this.curTab.getRecord_ID(),i,r,this.curTab.getKeyColumnName());t.show()};i.prototype.cmd_finddialog=function(){var i=new n.Find(this.curWindowNo,this.curTab,0),t=this;i.onClose=function(){var f,e;if(i.getIsOKPressed()){var r=i.getQuery(),o=i.getCurrentDays(),u=i.getIsCreated();i.dispose();i=null;t.curTab.getTableModel().setCurrentPage(1);r!=null&&r.getIsActive()?(t.curTab.setQuery(r),t.curGC.query(0,0,u)):r!=null&&(f=n.MRole.getDefault().getMaxQueryRecords(),t.curTab.setQuery(null),t.curGC.query(o,f,u));e=t.curTab.getIsQueryActive()||t.curTab.getOnlyCurrentDays()>0;t.aFind.setPressed(e)}t=null};i.show()};i.prototype.cmd_preference=function(){var t=new n.Framework.UserPreference;t.load();t.showDialog();t=null};i.prototype.cmd_infoWindow=function(){n.InfoMenu.show(this.aInfo.getItem())};i.prototype.cmd_zoomAcross=function(){var r=this.curTab.getRecord_ID(),i,t,u;r>0&&(i=new n.Query,t=this.curTab.getKeyColumnName(),t.length==0&&(t=this.curTab.getLinkColumnName()),t.length!=0&&(t.endsWith("_ID")?i.addRestriction(t,n.Query.prototype.EQUAL,n.context.getContextAsInt(this.curWindowNo,t)):i.addRestriction(t,n.Query.prototype.EQUAL,n.context.getContext(this.curWindowNo,t))),u=new n.AZoomAcross(this.aZoomAcross,this.curTab.getTableName(),i,this.curTab.getAD_Window_ID(),this,this.aZoomAcross.getListItmIT(),t,r),u.init())};i.prototype.cmd_request=function(){var t=this.curTab.getRecord_ID();if(t>0){var r=this.curTab.getAD_Table_ID(),u=this.curTab.getValue("C_BPartner_ID"),i=new n.ARequest(this.aRequest,r,t,u,null,this.aRequest.getListItmIT());i.getRequests();i=null}};i.prototype.cmd_markToExport=function(){var f=this.curTab.getRecord_ID(),e=this.curGC.getSelectedRows(),h=null,o=this.curTab.getAD_Table_ID(),s=this.curTab.getTableName(),c,l,a,r,v,u,i,t;if(f==-1){if(c={AD_Table_ID:o},l=n.dataContext.getJSONData(n.Application.contextUrl+"JsonData/GetKeyColumns",c),l==null)return}else{if(a=s+"_ID",r="",this.curGC.singleRow){h=f;i=new n.MarkModule;i.init(h,o,s);i.show();t=this;i.onClose=function(){t.curTab.loadMarking();t.aMarkToExport.setPressed(t.curTab.hasMarked());t=null};return}if(v=e.length,v==1)r=f;else{for(u=0;u<e.length;u++)r+=e[u][a.toLowerCase()]+",";r.endsWith(",")&&(r=r.substring(0,r.length-1))}i=new n.MarkModule;i.init(r,o,s);i.show();t=this;i.onClose=function(){t.curTab.loadMarking();t.aMarkToExport.setPressed(t.curTab.hasMarked());t=null};return}};i.prototype.cmd_lock=function(){var i=!1,t;this.isPersonalLock&&((t=this.curTab.getRecord_ID(),t==-1||t<0)||(this.curTab.locks(n.context,t,this.aLock.getIsPressed()),this.curTab.loadAttachments(),i=this.curTab.getIsLocked(),this.aLock.setPressed(i)))};i.prototype.cmd_recAccess=function(){var t=new n.RecordAccessDialog;t.Load(this.curTab.getAD_Table_ID(),this.curTab.getRecord_ID())};i.prototype.dispose=function(){this.aParentDetail&&this.aParentDetail.dispose();this.curST!=null&&(this.curST.unRegisterAPanel(),this.curST=null);this.vTabbedPane.dispose();this.vTabbedPane=null;this.gridWindow&&(this.gridWindow.dispose(),this.gridWindow=null,this.ctx.setAutoCommit(this.$parentWindow.getWindowNo(),!1),this.ctx.removeWindow(this.$parentWindow.getWindowNo()),n.MLookupCache.cacheReset(this.$parentWindow.getWindowNo()));this.ctx=null;this.$parentWindow=null;this.tabPages=null;this.curGC=null;this.curST=null;this.aParentDetail=null;this.curTab=null;this.disposeComponent()};n.VTabbedPane=function(){var n=!1;this.oldTabIndex=-1;this.Items=[];this.ItemsIds=[];this.count=0;this.dependents=[];this.TabItems=[];this.getIsWorkbench=function(){return n}};n.VTabbedPane.prototype.setTabObject=function(n){this.tabObj=n};n.VTabbedPane.prototype.addTab=function(n,t,i,r){var f,u,e;for(this.ItemsIds[this.count]=n,this.Items[this.count]=i,this.TabItems.push(r),f=t.getDependentOn(),u=0;u<f.length;u++)e=f[u],this.dependents.indexOf(e)<0&&this.dependents.push(e);this.count++};n.VTabbedPane.prototype.getIsTabChanged=function(t){var u=this.ItemsIds.indexOf(t),f=this.oldTabIndex,r,h,i,e,s,o;if(u===f)return console.log("same tab"),!1;if(i=this.Items[u],r=null,i instanceof n.GridController&&(r=i,h=r.getIsDisplayed(),!h))return!1;if(r!=null&&f>=0&&u!=f&&(i=this.Items[f],i!=null&&i instanceof n.GridController)){if(r.getTabLevel()>i.getTabLevel()+1){for(e=u-1;e>=0;e--)if(s=this.Items[e],o=null,s instanceof n.GridController&&(o=s,o.getTabLevel()==i.getTabLevel()+1))return n.ADialog.warn("TabSwitchJumpGo",!0,"",o.getTitle()),!1;return n.ADialog.warn("TabSwitchJump"),!1}i.setMnemonics(!1)}return r!=null&&r.setMnemonics(!0),this.oldTabIndex=u,!0};n.VTabbedPane.prototype.restoreTabChange=function(){this.oldTabIndex=-1};n.VTabbedPane.prototype.getTabElement=function(){return this.Items[this.oldTabIndex]};n.VTabbedPane.prototype.getSelectedIndex=function(){return this.oldTabIndex};n.VTabbedPane.prototype.sizeChanged=function(n,t){for(var i in this.Items)this.Items[i].sizeChanged(n,t)};n.VTabbedPane.prototype.evaluate=function(t){var r=t==null,u=null,i,f,e,o;if(r||(u=t,r=u!=null?this.dependents.indexOf(u)>-1:!0),r)for(i=0;i<this.TabItems.length;i++)f=this.Items[i],f instanceof n.GridController&&(e=f,o=e.getIsDisplayed(),this.TabItems[i].setEnabled(o))};n.VTabbedPane.prototype.dispose=function(){for(var n in this.Items)this.Items[n].dispose(),this.Items[n]=null;this.TabItems.length=0;this.TabItems=null;this.Items.length=0;this.Items=null;this.ItemsIds.length=0;this.ItemsIds=null;this.dependents.length=0;this.dependents=null};f.prototype.setPressed=function(n){this.toggle&&(this.pressed=n,this.img&&this.toggle&&this.img.prop("src",n?this.imgUrlX:this.imgUrl))};f.prototype.getIsPressed=function(){return this.pressed};f.prototype.getAction=function(){return this.action};f.prototype.getPath=function(){return n.Application.contextUrl+"Areas/VIS/Images/base/"};f.prototype.getSeprator=function(n,t){var i=this.getPath();return(i+=n?"seprator16.png":"seprator24.png",t)?"<li>|<\/li>":'<li><img src="'+i+'"><\/li>'};f.prototype.setEnabled=function(n){this.isEnabled=n;this.$li&&this.$li.css("opacity",n?1:.6);this.img&&this.img.prop("disabled",!n).css("opacity",n?1:.6)};f.prototype.show=function(){this.$li&&this.$li.show();this.img&&this.img.show()};f.prototype.hide=function(){this.$li&&this.$li.hide();this.img&&this.img.hide()};f.prototype.getItem=function(){return this.$li};f.prototype.getIsEnabled=function(){return this.isEnabled};f.prototype.dispose=function(t){if(this.action=this.toggle=this.pressed=this.isEnabled=this.text=this.toolTipText=this.imageOnly=null,this.textOnly=this.onAction=this.isSmall=null,this.$li&&(this.$li.off(n.Events.onClick),this.$li.remove(),this.$li=null),this.img&&(this.img=null),t&&t in this.items){var i=this.items[t];i&&(i.off(n.Events.onClick),i.remove(),i=null);delete this.items[t]}this.disposeComponent()};f.prototype.setIsRo;s.prototype.setStatusDB=function(n,t){n==null||n.length==0?this.$statusDB.text(""):this.$statusDB.text(n);this.text=n;this.dse=t;this.setPageLine(t)};s.prototype.setStatusLine=function(n,t){this.merror=t;this.mtext=n;this.$statusLine.text(n)};s.prototype.setInfo=function(n){this.$infoLine.is(":visible")||this.$infoLine.show();this.$infoLine.text(n)};s.prototype.dispose=function(){this.disposeComponent()};n.GridController=function(i,r,u){function st(){b=t("<td colspan='2' class='vis-height-auto'>");k=t("<td colspan='2' class='vis-height-auto'>");tt=t("<td style='width:100%'>");d=t("<div>");rt=t("<td>").append(d).hide();p=t("<table class='vis-gc-table'>").append(t("<tr>").append(b)).append(t("<tr>").append(k)).append(t("<tr  class='vis-height-full'>").append(rt).append(tt)).hide();l=t("<ul  class='vis-appsaction-ul vis-gc-tabcontrol'>").hide();v=t("<div class='vis-gc-header'>").hide();y=t("<div class='vis-gc-vtable'>");e=t("<div class='vis-gc-vpanel'>");s=t("<div class='vis-gc-vcard'>");c=t("<div class='vis-gc-vmap'>");b.append(v);k.append(l);it=t("<div class='vis-height-full' style='overflow:hidden'>");ot=t("<div class='vis-height-full'>");it.append(y).append(e).append(s).append(c);tt.append(it)}function ht(){et=new n.AppsAction({action:"Add_sub",parent:null,enableDisable:!0,toggle:!1,imageOnly:!0,isSmall:!0,onAction:ft});g=new n.AppsAction({action:"Edit_sub",parent:null,enableDisable:!0,toggle:!1,imageOnly:!0,isSmall:!0,onAction:ft});l.append(g.getListItm()).append(et.getListItm())}var w,f,ft;this.id=u;this.vGridPanel=new n.VGridPanel;this.vTable=new n.VTable;this.vCardView=new n.VCardView;this.vMapView=new n.VMapView;this.windowNo=0;this.aPanel=null;this.singleRow=!1;this.isCardRow=!1;this.doPaging=r;this.vIncludedGC=null;this.m_tree=null;this.onRowInserted=null;this.onRowInserting=null;this.rightPaneLinkItems=[];this.leftPaneLinkItems=[];this.showClient=!1;this.showOrg=!1;w=n.Env.getCtx().getShowClientOrg();w==n.Env.SHOW_CLIENT_ONLY?this.showClient=!0:w==n.Env.SHOW_ORG_ONLY?this.showOrg=!0:w==n.Env.SHOW_CLIENT_ORG&&(this.showOrg=!0,this.showClient=!0);this.isParentDetailVisible=!1;this.isIncludedGCVisible=!1;this.displayAsIncludedGC=!1;var e,s,c,l,p,v,nt=[],b,k,tt,y,d,it,ot,rt,ut=null,et,g=null;st();f=this;ft=function(n){if(n=="Edit_sub"){if(f.displayAsIncludedGC){f.aPanel.tabActionPerformed(f.id)&&f.switchSingleRow();return}}else if(f.displayAsIncludedGC){if(!f.aPanel.tabActionPerformed(f.id))return;f.switchSingleRow();setTimeout(function(n){n.aPanel.cmd_new()},500,f)}};ht();this.initLayout=function(){this.layoutLoaded=!0};this.sizeChanged=function(t,i){t||(t=n.Env.getScreenHeight()-(o+a+h));p.height(t);y.height(t-2);e.height(t);d.height(t);s.height(t);c.height(t);this.m_tree&&this.m_tree.setSize(t,i);this.vCardView&&this.vCardView.sizeChanged(t,s.width());this.vMapView&&this.vMapView.sizeChanged(t,c.width())};this.sizeChanged();e.append(this.vGridPanel.getRoot());this.getRoot=function(){return p};this.getTreeArea=function(){return d};this.setTreePanelWidth=function(){rt.show()};this.getId=function(){return u};this.getReocrdDiv=function(){return v};this.getTabControl=function(){return l};this.setRecord=function(){};this.getVTablePanel=function(){return y};this.getVPanel=function(){return e};this.getVCardPanel=function(){return s};this.getVMapPanel=function(){return c};this.setUI=function(n){n?(v.html(this.gTab.getName()),v.show(),l.show(),g.setEnabled(!1),this.vTable.grid.show.selectColumn=!1):(v.hide(),l.hide(),this.vTable.grid.show.selectColumn=!0)};this.enableDisableToolbarItems=function(n){g.setEnabled(n)};this.vTable.onSelect=function(n){f.aPanel&&f.aPanel.setBusy&&f.aPanel.setBusy(!0);f.cancelSel=!1;f.onTableRowSelect(n);f.cancelSel&&(n.isCancelled=!0);f.aPanel&&f.aPanel.setBusy&&f.aPanel.setBusy(!1)};this.vTable.onCellValueChanged=function(n,t){t?window.setTimeout(function(){f.vetoablechange(n);f.vTable.refreshCells()},10):(f.vetoablechange(n),f.vTable.refreshCells())};this.vCardView.onCardEdit=function(n,t){f.onTableRowSelect(n);t||f.switchSingleRow()};this.vTable.onSort=function(){window.setTimeout(function(){f.navigate(f.gTab.getCurrentRow(),!0)},10)};this.disposeComponent=function(){this.rightPaneLinkItems.length=0;this.rightPaneLinkItems=null;this.leftPaneLinkItems.length=0;this.leftPaneLinkItems=null;y=null;$divRecords=null;for(var n=0;n<nt.length;n++)nt[n].dispose("ul_"+this.id);nt=null;this.seletedTab=null;b=null;k=null;this.vGridPanel.dispose();this.vGridPanel=null;this.vCardView.dispose();this.vCardView.onSelect=null;this.vMapView.dispose();this.vTable.dispose();this.vTable.onSelect=null;this.vTable.onSort=null;this.vTable=null;y=null;e=null;s=null;c=null;f=null;this.getId=null;this.getReocrdDiv=null;this.getRoot=null;this.getVTablePanel=null;this.getVPanel=null;this.getVCardPanel=null;p.remove();p=null;ut&&ut.destroy();ut=null;this.onRowInserted=null}};n.GridController.prototype.initGrid=function(t,i,r,u){var c=u.gridTable.gridFields,e=null,v=i+"_"+u.vo.AD_Tab_ID,y=i+"_c"+u.vo.AD_Tab_ID,p=i+"_m"+u.vo.AD_Tab_ID,h,l,o,f,s,a;if(u.getTableModel().setDoPaging(this.doPaging),h=n.MRole,h.getIsDisplayClient()&&this.showClient||u.getField("AD_Client_ID").setDisplayed(!1),h.getIsDisplayOrg()&&this.showOrg||u.getField("AD_Org_ID").setDisplayed(!1),l=this.vTable.setupGridTable(r,c,this.getVTablePanel(),v,u,this),u.addDataStatusListener(this),!t)for(this.vCardView.setupCardView(r,u,this.getVCardPanel(),y),u.getIsMapView()&&this.vMapView.setupMapView(r,this,u,this.getVMapPanel(),p),o=0;o<l;o++)if(e=c[o],e.getIsDisplayed()){if(f=n.VControlFactory.getControl(u,e,!1,!1,!1),f==null&&!e.getIsHeading())continue;f!=null&&(f.setReadOnly(!0),e.setPropertyChangeListener(f),f.addVetoableChangeListener(this));this.vGridPanel.addField(f,e);f instanceof n.Controls.VButton&&(e.getIsLink()&&(e.getIsRightPaneLink()?this.rightPaneLinkItems.push(f):this.leftPaneLinkItems.push(f)),f.addActionListner(r));f=null}s=0;u.getIsTreeTab()&&(a="SELECT AD_Tree_ID FROM AD_Tree WHERE AD_Client_ID="+n.Env.getCtx().getAD_Client_ID()+" AND AD_Table_ID="+u.getAD_Table_ID()+" AND IsActive='Y' AND IsAllNodes='Y' ORDER BY IsDefault DESC, AD_Tree_ID",s=n.DB.executeScalar(a),s>0&&(this.m_tree=new n.TreePanel(i,!1,!0),u.getTabNo()==0&&this.m_tree.initTree(s),this.getTreeArea().append(this.m_tree.getRoot()),this.m_tree.addSelectionChangeListner(this),this.setTreePanelWidth("300px"),this.getTreeArea().width("300px"),this.m_tree.setSize(this.getTreeArea().height())));u.getTableModel().addTableModelListener(this.vTable);u.getTableModel().addCardModelListener(this.vCardView);u.getTableModel().addRowChangedListener(this);u.getTableModel().addQueryCompleteListner(this);u.getTableModel().setDoPaging(this.doPaging);u.getTableModel().setCurrentPage(1);this.gTab=u;this.windowNo=i;this.onlyMultiRow=t;this.aPanel=r;t||!u.getIsSingleRow()?this.singleRow=!1:this.switchSingleRow(!0)};n.GridController.prototype.detachDynamicAction=function(){for(var n=0,t=0,n=0,t=this.leftPaneLinkItems.length;n<t;n++)this.leftPaneLinkItems[n].getControl().detach();for(n=0,t=this.rightPaneLinkItems.length;n<t;n++)this.rightPaneLinkItems[n].getControl().detach();n=null;t=null};n.GridController.prototype.switchRowPresentation=function(){this.singleRow?this.switchMultiRow():this.switchSingleRow()};n.GridController.prototype.getIsSingleRow=function(){return this.singleRow};n.GridController.prototype.getIsMapRow=function(){return this.isMapRow};n.GridController.prototype.onTableRowSelect=function(n){if(!this.rowSetting&&this.gTab.getRowCount()!=0){var t=this.vTable.get(n.recid,!0),i=this.gTab.getCurrentRow();if(t==-1&&i>=0){this.vTable.select(n.recid);this.vCardView.navigate(n.recid,!this.isCardRow);return}if(t!=i)this.rowSetting=!0,this.navigate(t),this.rowSetting=!1;else if(!this.settingGridSelecton)return;this.dynamicDisplay(-1);this.vIncludedGC!=null&&this.switchIncludedGC()}};n.GridController.prototype.switchIncludedGC=function(){this.vIncludedGC!=null&&this.switchIncludedGC()};n.GridController.prototype.dynamicDisplay=function(t){var e,i,u,r,o,f,c;if(this.gTab!=null&&!this.isCardRow&&!this.isMapRow){if(!this.getIsSingleRow()){this.dynamicDisplayLinks(t);return}if(this.gTab.getIsOpen()){if(t>=0){var s=this.gTab.getField(t),u=s.getColumnName(),l=this.gTab.getDependantFields(u);if(l.length==0&&s.getCallout().length>0)return}var a=this.gTab.getRowCount()==0,h=this.vGridPanel.getComponents(),v=h.length;for(e=0;e<v;e++)i=h[e],u=i.getName(),u!=null&&(u.startsWith("lbl")&&(u=u.substring(3)),r=this.gTab.getField(u),r!=null&&(r.getIsDisplayed(!0)?(o=i.tag,!i.getIsVisible()&&(o==null||o=="undefined"||o)&&i.setVisible(!0),i instanceof n.Controls.IControl&&(f=i,a?f.setReadOnly(!0):(c=r.getIsEditable(!0),f.setReadOnly(!c),f.setMandatory(r.getIsMandatory(!0)),f.setBackground(r.getIsError())))):i.getIsVisible()&&i.setVisible(!1),r.getIsDisplayed(!0)||r.getIsMandatory(!0)||r.setError(!1)))}}};n.GridController.prototype.dynamicDisplayLinks=function(){var s,o,f,t,r,i,e,u,h;if(!this.displayAsIncludedGC)for(s=this.gTab.getRowCount()==0,o=this.vGridPanel.getLinkComponents(),f=0;f<o.length;f++)t=o[f],r=t.getName(),r!=null&&(r.startsWith("lbl")&&(r=r.substring(3)),i=this.gTab.getField(r),i!=null&&(i.getIsDisplayed(!0)?(e=t.tag,!t.getIsVisible()&&(e==null||e=="undefined"||e)&&t.setVisible(!0),t instanceof n.Controls.IControl&&(u=t,s?u.setReadOnly(!0):(h=i.getIsEditable(!0),u.setReadOnly(!h),u.setMandatory(i.getIsMandatory(!0)),u.setBackground(i.getIsError())))):t.getIsVisible()&&t.setVisible(!1),i.getIsDisplayed(!0)||i.getIsMandatory(!0)||i.setError(!1)))};n.GridController.prototype.setVisible=function(n){this.layoutLoaded||this.initLayout();n?(this.getRoot().show(),this.vTable.resize()):this.getRoot().hide()};n.GridController.prototype.getMTab=function(){return this.gTab};n.GridController.prototype.getIsDisplayed=function(){return this.gTab.getIsDisplayed(!1)};n.GridController.prototype.getTabLevel=function(){return this.gTab.getTabLevel()};n.GridController.prototype.getTitle=function(){return this.gTab.getName()};n.GridController.prototype.getSelection=function(n){return this.vTable.getSelection(n)};n.GridController.prototype.getSelectedRows=function(){return this.vTable.getSelectedRows()};n.GridController.prototype.getColumnNames=function(){var t,i,n;if(this.colNames)return this.colNames;for(t=this.gTab.getTableModel().getFields(),i={},n=0;n<t.length;n++)i[t[n].getColumnName()]=t[n].getHeader();return this.colNames=i,this.colNames};n.GridController.prototype.setMnemonics=function(){};n.GridController.prototype.activate=function(n){if(this.vTable.activate(),n=n||{},this.vTable.setReadOnly(!1),this.displayAsIncludedGC){var t=this.aPanel.getLayout();this.setUI(!1);this.getRoot().detach();t.append(this.getRoot());this.displayAsIncludedGC=!1;this.aPanel.getIncludedEmptyArea().css({width:"",padding:""})}this.isIncludedGCVisible=!1;this.vIncludedGC&&(this.vIncludedGC.displayAsIncludedGC=!1,this.vIncludedGC.isIncludedGCVisible=!1);this.activateTree()};n.GridController.prototype.multiRowResize=function(){this.singleRow||this.isCardRow||this.vTable.resize()};n.GridController.prototype.activateTree=function(){var t,i,r,f,e,u;if(this.gTab.getIsTreeTab()&&this.gTab.getTabNo()>0){if(t=0,this.gTab.getTabLevel()>0&&(i=this.gTab.getKeyColumnName(),r="AD_Tree_ID",i.startsWith("CM")&&(i.equals("CM_Container_ID")?r="AD_TreeCMC_ID":i.equals("CM_CStage_ID")?r="AD_TreeCMS_ID":i.equals("CM_Template_ID")?r="AD_TreeCMT_ID":i.equals("CM_Media_ID")&&(r="AD_TreeCMM_ID")),t=n.Env.getCtx().getWindowContextAsInt(this.windowNo,r)),t==0){if(f=this.gTab.getAD_Table_ID(),e=n.Env.getCtx().getAD_Client_ID(),f==0)return 0;u=n.DB.executeReader("SELECT AD_Tree_ID, Name FROM AD_Tree WHERE AD_Client_ID="+e+" AND AD_Table_ID="+f+" AND IsActive='Y' AND IsAllNodes='Y' ORDER BY IsDefault DESC, AD_Tree_ID");u.read()&&(t=u.getInt(0));u=null}this.m_tree!=null&&t>0&&this.m_tree.initTree(t)}};n.GridController.prototype.nodeSelectionChanged=function(n){var r,u,f,i,t;if(n!=null&&(r=n.newValue,r!=null)&&(u=r,u!=0)){for(f=this.gTab.getRowCount(),i=-1,t=0;t<f;t++)if(this.gTab.getKeyID(t)==u){i=t;break}i!=-1&&this.navigate(i)}};n.GridController.prototype.skipRowInserting=function(n){this.skipInserting=n};n.GridController.prototype.query=function(n,t,i){this.aPanel&&this.aPanel.setBusy&&this.aPanel.setBusy(!0);var r=this.gTab.prepareQuery(n,t,i,!1)};n.GridController.prototype.queryCompleted=function(){this.vTable.clear();this.gTab.clearSelectedRow();this.vTable.add(this.gTab.getTableModel().getDataTable());this.gTab.getTableModel().setSortModel(this.vTable.getGrid().records);this.displayAsIncludedGC||(this.onRowInserting?this.onRowInserting():this.checkInsertNewRow());!this.vIncludedGC||this.isIncludedGCVisible?this.navigate(this.gTab.getCurrentRow(),!this.gTab.getTableModel().getIsInserting()):(this.gTab.currentRow=-1,this.gTab.fireDataStatusEventOnly());this.isCardRow&&this.vCardView.refreshUI(this.getVCardPanel().width());this.isMapRow&&this.vMapView.refreshUI(this.getVMapPanel().width());this.aPanel&&this.aPanel.setBusy(!1);this.skipInserting=!1;this.dynamicDisplay(-1)};n.GridController.prototype.checkInsertNewRow=function(){if(this.aPanel==null)return!1;var t=!0,i=this.gTab.getLinkColumnName(),r=n.context.getWindowContext(this.windowNo,i);return(i.Length>0&&r.length==0&&(t=!1),this.gTab.getTableModel().getTotalRowCount()==0&&!this.gTab.getIsReadOnly()&&(n.context.getIsAutoNew(this.windowNo)||this.gTab.getIsQueryNewRecord())&&t&&this.gTab.getIsInsertRecord()&&!this.skipInserting)?(this.dataNew(!1),!0):!1};n.GridController.prototype.vetoablechange=function(n){var t=this.gTab.getTableModel(),i=this.gTab.getCurrentRow(),r=t.findColumn(n.propertyName);t.setValueAt(n.newValue,i,r)};n.GridController.prototype.refreshUI=function(){this.dataRefreshAll()};n.GridController.prototype.navigate=function(n,t){if(!t&&n==this.gTab.getCurrentRow())return this.gTab.getCurrentRow();var i=this.gTab.navigate(n,!0,t);if(i>-1&&!this.rowSetting?(this.settingGridSelecton=!0,this.vTable.select(i),this.settingGridSelecton=!1,this.vCardView.navigate(i,!this.isCardRow)):i>-1&&this.vCardView.navigate(i,!0),i==-1){this.cancelSel=!0;return}return this.m_tree!=null&&this.m_tree.setSelectedNode(this.gTab.getRecord_ID()),this.vTable.scrollInView(n),this.gTab.getCurrentRow()};n.GridController.prototype.navigatePageExact=function(n){this.gTab.getTableModel().setCurrentPage(n);this.query(this.gTab.getOnlyCurrentDays(),0,!1)};n.GridController.prototype.navigatePage=function(n){this.gTab.getTableModel().setCurrentPageRelative(n);this.query(this.gTab.getOnlyCurrentDays(),0,!1)};n.GridController.prototype.navigateRelative=function(n){return this.navigate(this.gTab.getCurrentRow()+n)};n.GridController.prototype.dataRefresh=function(){var n=this.gTab.dataRefresh();this.dynamicDisplay(-1);window.setTimeout(function(n){n.switchIncludedGC();n=null},500,this)};n.GridController.prototype.dataRefreshAll=function(){this.gTab.getTableModel().dataRefreshAll()};n.GridController.prototype.dataSave=function(n){var t=this.gTab.dataSave(n);return t,t};n.GridController.prototype.dataNew=function(n){this.gTab.dataNew(n);this.dynamicDisplay(-1);this.switchIncludedGC();this.onRowInserted&&this.onRowInserted()};n.GridController.prototype.canDeleteRecords=function(){for(var i=this.vTable.getSelection(!0),f=this.vTable.getGrid().records,u=[],r,t=0;t<i.length;t++)r=f[i[t]],"ad_client_id"in r&&(n.MRole.getIsClientAccess(r.ad_client_id,!0)||u.push(i[t]));return u};n.GridController.prototype.dataDelete=function(){var n=this.gTab.dataDelete(this.vTable.getSelection(!0));return this.dynamicDisplay(-1),n};n.GridController.prototype.rowChanged=function(n,i){var r;if(this.m_tree!=null){if(t.isArray(i)&&!n){for(r=0;r<i.length;r++)this.m_tree.nodeChanged(n,i[r],"","","","");return}if(!(i<=0)){var f=this.gTab.getValue("Name"),e=this.gTab.getValue("Description"),u=this.gTab.getValue("IsSummary"),o=u==!0||u=="Y",s=this.gTab.getValue("Action");this.m_tree.nodeChanged(n,i,f,e,o,s)}}};n.GridController.prototype.dataIgnore=function(){this.gTab.dataIgnore();this.dynamicDisplay(-1);this.switchIncludedGC();this.vTable.refreshUndo()};n.GridController.prototype.dataStatusChanged=function(t){var r,i,f,e,u,o,s,h;if(this.displayAsIncludedGC){this.enableDisableToolbarItems(!0);return}if(this.aPanel.dataStatusChanged(t),r=t.getChangedColumn(),t.getIsChanged()&&!(r<0)){if(i=this.gTab.getField(r),i!=null)if(i.getCallout().length>0)f=this.gTab.processFieldChange(i),f.length>0&&n.ADialog.error(f);else for(e=i.getColumnName(),dependants=this.gTab.getDependantFields(e),u=0;u<dependants.length;u++)(o=dependants[u],o!=null)&&(s=o.getLookup(),s!=null)&&(h=s.getValidation(),h.indexOf(e)!=-1);this.dynamicDisplay(r)}};n.GridController.prototype.includeTab=function(n){var t=n.getMTab();return this.gTab.getIncluded_Tab_ID()!=t.getAD_Tab_ID()?!1:(this.vIncludedGC=n,this.vIncludedGC.switchMultiRow(),!0)};n.GridController.prototype.switchSingleRow=function(){if(!this.onlyMultiRow&&!this.singleRow){this.singleRow=!0;this.isCardRow=!1;this.isMapRow=!1;var n=this.getVTablePanel(),t=this.getVPanel();(this.isIncludedGCVisible||!0)&&(n.hide(),t.show(),this.getVCardPanel().hide(),this.getVMapPanel().hide());this.dynamicDisplay(-1)}};n.GridController.prototype.switchMultiRow=function(){if(this.singleRow){this.singleRow=!1;this.isCardRow=!1;this.isMapRow=!1;var n=this.getVTablePanel();this.getVPanel().hide();this.getVCardPanel().hide();this.getVMapPanel().hide();n.width(this.displayAsIncludedGC?"98%":"97%");this.isIncludedGCVisible?n.css({float:"right"}):n.css({float:""});n.show();n=null;this.vTable.resize();this.vTable.refreshRow()}};n.GridController.prototype.switchCardRow=function(){if(!this.isCardRow){this.singleRow=!1;this.isCardRow=!0;this.isMapRow=!1;this.getVTablePanel().hide();this.getVPanel().hide();this.getVMapPanel().hide();var n=this.getVCardPanel();this.isIncludedGCVisible?n.css({float:"right"}):n.css({float:""});n.show();this.vCardView.refreshUI(this.getVCardPanel().width());n=null}};n.GridController.prototype.switchMapRow=function(){if(!this.isMapRow){this.singleRow=!0;this.isCardRow=!1;this.isMapRow=!0;this.getVTablePanel().hide();this.getVPanel().hide();this.getVCardPanel().hide();var n=this.getVMapPanel();this.isIncludedGCVisible?n.css({float:"right"}):n.css({float:""});n.show();this.vMapView.refreshUI(this.getVMapPanel().width());n=null}};n.GridController.prototype.switchIncludedGC=function(){var r,t,i;this.vIncludedGC&&!this.displayAsIncludedGC&&(r=this.isIncludedGCVisible,r||(t=this.vIncludedGC.getRoot(),t.detach(),i=this.aPanel.getIncludedEmptyArea(),this.vIncludedGC.setUI(!0),i.append(t),i.css("padding","0px 5px 0px 7px"),i.width(n.Application.isMobile?250:350),t.show(),this.vIncludedGC.vTable.activate(),this.vIncludedGC.vTable.setReadOnly(!0),this.isIncludedGCVisible=!0,this.singleRow||(this.singleRow=!0,this.switchMultiRow()),this.vIncludedGC.displayAsIncludedGC=!0,this.vIncludedGC.singleRow=!0,this.vIncludedGC.switchMultiRow(),this.vTable.resize()),window.setTimeout(function(n){n.vIncludedGC.query(0,0,!1);n=null},1,this))};n.GridController.prototype.dispose=function(){this.gTab.removeDataStatusListener(this.aPanel);this.gTab.removeDataStatusListener();this.gTab.getTableModel().removeTableModelListener(this.vTable);this.gTab.getTableModel().removeCardModelListener(this.vCardView);this.gTab.getTableModel().removeRowChangedListener();this.gTab.getTableModel().removeQueryCompleteListner();this.disposeComponent();this.gTab=null;this.windowNo=null;this.onlyMultiRow=null;this.aPanel=null;this.m_tree&&this.m_tree.dispose();this.m_tree=null};n.GridController.prototype.HEADER_HEIGHT=55;n.AParentDetail=function(i,r){function y(){f=t("<div class='vis-apanel-bar'>");c=t("<div class='vis-apanel-bar-fixpart' style='background-color:white'>");o=t("<div class='vis-apanel-bar-varpart vis-apanel-bar-pdetail'>");e=t('<div class="vis-apanel-lb-main">');s=t("<div class='vis-apanel-lb-oflow' style='border-left: 1px solid white;'>").hide();s.html("<a data-dir='u' href='javascript:void(0)'><img style='margin-left:10px' data-dir='u' src='"+n.Application.contextUrl+"Areas/VIS/Images/base/arrow-top.png' ><\/a><a data-dir='d' href='javascript:void(0)' ><img style='margin-left:10px' data-dir='d' src='"+n.Application.contextUrl+"Areas/VIS/Images/base/arrow-bottom.png' /><\/a>");o.append(e).append(s);h=t("<div style='width:192px;overflow-y:auto;padding-left: 4px;padding-right:3px;'>");e.append(h);f.append(o).append(c);r.append(f);f.hide()}function a(){for(var r=null,c="",t="",o,s,e=0;e<v;e++)(r=l[e],t=null,t=r.getValue(),t&&t!=""&&r.getIsDisplayed())&&(c+="<h3>"+w2utils.encodeTags(r.getHeader())+"<\/h3>",o=r.getDisplayType(),r.lookup?t=r.lookup.getDisplay(t,!0):n.DisplayType.IsDate(o)?t=new Date(t).toLocaleString():o==n.DisplayType.YesNo?(s=t.toString(),r.getIsEncryptedColumn()&&(s=n.secureEngine.decrypt(s)),t=s.equals("Y")):t=t.toString(),r.getIsEncryptedColumn()&&o!=n.DisplayType.YesNo&&(t=n.secureEngine.decrypt(t)),c+="<h5>"+w2utils.encodeTags(t)+"<\/h5>");h.empty();h.html("<h1>"+i.getMTab().getName()+"<\/h1>"+c);u.setSize(f.height())}function p(){u.curGC&&u.curGC.multiRowResize()}function w(){a();u.curGC&&u.curGC.multiRowResize()}var u;this.gc=i;this.$root=r;this.visible=!1;this.expaned=!1;this.curGC=null;var l=i.getMTab().getTableModel().getFields(),v=l.length,c,o,f=null,e,s,h;y();u=this;c.on(n.Events.onTouchStartOrClick,function(n){u.$root.width()>20?u.hide():u.show();n.stopPropagation()});s.on("click",function(n){var r,o;if(n.stopPropagation(),r=t(n.target).data("dir"),r){var s=e.height(),c=h.height(),u=e.scrollTop(),f=Math.ceil(s/2),i=0;if(r=="d"){if(u+f>=c-f)return;o=c-s;i=u+f;e.animate({scrollTop:i>o?o:i},1e3,"easeOutBounce")}else if(r=="u"){if(u==0)return;i=u-f;e.animate({scrollTop:i<0?0:i},1e3,"easeOutBounce")}}});this.show=function(){if(u.expaned){a();return}this.expaned=!0;u.visible&&f.show();r.animate({width:"200px"},300,"swing");o.show().animate({width:"192px"},300,"swing",w)};this.hide=function(){(this.expaned||!this.visible)&&(this.expaned=!1,r.animate({width:u.visible?"8px":"0px"},300,"swing"),u.visible||f.hide(),o.hide().animate({width:"0px"},300,"swing",p))};this.setSize=function(t){f.height(t);e.height(t);h.height()>e.height()&&(n.Application.isMobile||(e.height(t-40),s.show()))};this.disposeComponenet=function(){this.gc=null;this.$root=null;this.visible=null;this.expaned=null;s.off("click");c.off(n.Events.onTouchStartOrClick);c=o=null;f.remove();f=null;u=null;this.curGC=null;l.length=0;l=null;this.show=null;this.hide=null}};n.AParentDetail.prototype.evaluate=function(n){if(this.curGC=null,this.curGC=n,this.gc.getId()===n.getId())this.visible=!1,this.hide();else{if(this.curGC.isParentDetailVisible=!0,this.visible)return;this.visible=!0;this.show()}};n.AParentDetail.prototype.dispose=function(){this.disposeComponenet()};n.VSortTab=function(i,r,u,f,e,o){function d(){b=t("<span>").text(n.Msg.getMsg("N"));k=t("<span>").text(n.Msg.getMsg("Y"));h=t("<ul class='vis-sortTab-select' "+(e?" disabled":"")+">");s=t("<ul class='vis-sortTab-select' "+(e?" disabled":"")+" >");v=t("<button"+(e?" disabled":"")+" ><img src='"+w+"Left32.png' /><\/button");a=t("<button"+(e?" disabled":"")+" ><img src='"+w+"Right32.png' /><\/button");y=t("<button"+(e?" disabled":"")+" ><img src='"+w+"Up32.png' /><\/button");p=t("<button"+(e?" disabled":"")+" ><img src='"+w+"Down32.png' /><\/button");l=t("<table class='vis-apanel-sorttab' style='display:none;'>");var i=t("<td class='vis-apanel-sorttab-td'>");i.append(t("<div class='vis-apanel-sorttab-td-inner'>").append(b).append(h).append(t("<div class='vis-apanel-sorttab-td-right'>").append(a).append(v)));i.append(t("<div class='vis-apanel-sorttab-td-inner'>").append(k).append(s).append(t("<div class='vis-apanel-sorttab-td-right'>").append(y).append(p)));l.append(t("<tr>").append(i))}var l,b,k,h,s,a,v,y,p,w,c;this.winNumber=i;this.tableName=null;this.columnSortName=null;this.columnYesNoName=null;this.keyColumnName=null;this.identifierColumnName=null;this.identifierTranslated=!1;this.parentColumnName=null;this.aPanel=null;this.log=n.Logging.VLogger.getVLogger("VSortTab");w=n.Application.contextUrl+"Areas/VIS/Images/base/";d();this.dynInit(r,u,f);this.getRoot=function(){return l};this.getId=function(){return o};this.getlstModel=function(n){return n?s.find("li"):h.find("li")};this.setLabelName=function(n,t){b.text(n);k.text(t)};this.setListOptions=function(n,t){h.empty();h.append(n);s.empty();s.append(t)};c=this;v.on(n.Events.onTouchStartOrClick,function(n){c.btn_Click("Left");n.stopPropagation()});a.on(n.Events.onTouchStartOrClick,function(n){c.btn_Click("Right");n.stopPropagation()});y.on(n.Events.onTouchStartOrClick,function(n){c.btn_Click("Up");n.stopPropagation()});p.on(n.Events.onTouchStartOrClick,function(n){c.btn_Click("Down");n.stopPropagation()});h.on(n.Events.onClick,"LI",function(){t(this).toggleClass("vis-apanel-sorttab-selected")});s.on(n.Events.onClick,"LI",function(){t(this).toggleClass("vis-apanel-sorttab-selected")});this.btn_Click=function(n){var e=!1,i=null,u,f,c,r,o;if(n=="Right"){for(i=h.find("li.vis-apanel-sorttab-selected"),s.children().removeClass("vis-apanel-sorttab-selected"),u=0;u<i.length;u++)i[u].remove(),t(i[u]).toggleClass("vis-apanel-sorttab-selected"),s.append(i[u]),e=!0;i.length=0;i=0}else if(n=="Left"){for(i=s.find("li.vis-apanel-sorttab-selected"),h.children().removeClass("vis-apanel-sorttab-selected"),f=0;f<i.length;f++)i[f].remove(),t(i[f]).toggleClass("vis-apanel-sorttab-selected"),h.append(i[f]),e=!0;i.length=0;i=0}else{if(i=s.find("li.vis-apanel-sorttab-selected"),i==null)return;if(c=i.length,c==0)return;if(r=t(i[0]),r==null)return;if(s.children().removeClass("vis-apanel-sorttab-selected"),r.addClass("vis-apanel-sorttab-selected"),o=r.index(),n=="Up"){if(o==0)return;r.remove();r.insertBefore(s.find("li").eq(o-1));e=!0}else if(n=="Down"){if(o>=s.children().length-1)return;r.remove();r.insertAfter(s.find("li").eq(o));e=!0}}e&&this.aPanel!=null&&this.aPanel.aSave.setEnabled(!0)};this.disposeComponent=function(){v.off(n.Events.onTouchStartOrClick);a.off(n.Events.onTouchStartOrClick);y.off(n.Events.onTouchStartOrClick);p.off(n.Events.onTouchStartOrClick);this.seletedTab=null;l.remove();l=null;c=null;this.winNumber=null;this.tableName=null;this.columnSortName=null;this.columnYesNoName=null;this.keyColumnName=null;this.identifierColumnName=null;this.identifierTranslated=!1;this.parentColumnName=null;this.aPanel=null;this.log=null;h=null;s=null;y=p=v=a=null;this.btn_Click=this.setListOptions=this.getlstModel=this.setLabelName=this.setListOptions=this.getRoot=this.getId=null;console.log("dispose vSortTab")}};n.VSortTab.prototype.dynInit=function(t,i,r){var f=!n.Env.isBaseLanguage(n.Env.getCtx(),""),e="SELECT t.TableName, c.AD_Column_ID, c.ColumnName, e.Name,c.IsParent, c.IsKey, c.IsIdentifier, c.IsTranslated FROM AD_Table t, AD_Column c, AD_Element e WHERE t.AD_Table_ID="+t+" AND t.AD_Table_ID=c.AD_Table_ID AND (c.AD_Column_ID="+i+" OR AD_Column_ID="+r+" OR c.IsParent='Y' OR c.IsKey='Y' OR c.IsIdentifier='Y') AND c.AD_Element_ID=e.AD_Element_ID",u,o;f&&(e="SELECT t.TableName, c.AD_Column_ID, c.ColumnName, et.Name,c.IsParent, c.IsKey, c.IsIdentifier, c.IsTranslated FROM AD_Table t, AD_Column c, AD_Element_Trl et WHERE t.AD_Table_ID="+t+" AND t.AD_Table_ID=c.AD_Table_ID AND (c.AD_Column_ID="+i+" OR AD_Column_ID="+r+"\tOR c.IsParent='Y' OR c.IsKey='Y' OR c.IsIdentifier='Y') AND c.AD_Element_ID=et.AD_Element_ID AND et.AD_Language='"+n.Env.getAD_Language(n.Env.getCtx())+"'");u=this;o="";n.DB.executeReader(e,null,function(t){if(t!=null){for(var e="";t.read();)u.tableName=t.getString(0),i==t.get(1)?(u.columnSortName=t.getString(2),e=t.getString(3)):r==t.get(1)?u.columnYesNoName=t.getString(2):t.getString(4)=="Y"?u.parentColumnName=t.getString(2):t.getString(5)=="Y"?u.keyColumnName=t.getString(2):t.getString(6)=="Y"&&(u.identifierColumnName=t.getString(2),f&&(u.identifierTranslated="Y"==t.getString(7)));t.close();u.setLabelName(n.Msg.getMsg("Available"),e)}u=null})};n.VSortTab.prototype.setVisible=function(n){n?this.getRoot().show():this.getRoot().hide()};n.VSortTab.prototype.loadData=function(){var t="",r;t+="SELECT t."+this.keyColumnName;t+=this.identifierTranslated?",tt.":",t.";t+=this.identifierColumnName+",t."+this.columnSortName;this.columnYesNoName!=null&&(t+=",t."+this.columnYesNoName);t+=" FROM "+this.tableName+" t";this.identifierTranslated&&(t+=", "+this.tableName+"_Trl tt");t+=" WHERE t."+this.parentColumnName+"=@ID";this.identifierTranslated&&(t+=" AND t."+this.keyColumnName+"=tt."+this.keyColumnName+" AND tt.AD_Language='"+n.Env.getAD_Language(VAdvantage.Utility.Env.getCtx())+"'");t+=" ORDER BY ";this.columnYesNoName!=null&&(t+="4 DESC,");t+="3,2";var o=n.Env.getCtx().getWindowContext(this.winNumber,this.parentColumnName),i=i=n.DB.executeReader(t,[new n.DB.SqlParam("@ID",o)]),u="",f="";try{while(i.read()){var s=i.get(0),h=i.getString(1),c=i.get(2),e=c!=0;this.columnYesNoName!=null&&(e=i.getString(3)=="Y");r="<li data-value='"+s+"'>"+h+"<\/li>";e?u+=r:f+=r}i.close();i.dispose();this.setListOptions(f,u)}catch(l){this.log.Log(n.Logging.Level.SEVERE,t,l)}this.aPanel.aSave.setEnabled(!1)};n.VSortTab.prototype.saveData=function(){var s,c;if(this.aPanel.aSave.getIsEnabled()){var i=null,h=this.getlstModel(),u=[],f=this.tableName,e=this.columnSortName,r=this.columnYesNoName,o=this.keyColumnName;h.each(function(n,s){var h=t(s).data("value");i="";i+="UPDATE "+f+" SET "+e+"=0";r!=null&&(i+=","+r+"='N'");i+=" WHERE "+o+"="+h;u.push(i)});s=this.getlstModel(!0);s.each(function(n,s){var h=t(s).data("value");i="";i+="UPDATE "+f+" SET "+e+"="+(n+1)+"0";r!=null&&(i+=","+r+"='Y'");i+=" WHERE "+o+"="+h;u.push(i)});c=n.DB.executeQueries(u,null)}};n.VSortTab.prototype.unRegisterAPanel=function(){this.saveData();this.aPanel=null};n.VSortTab.prototype.registerAPanel=function(n){this.aPanel=n};n.VSortTab.prototype.sizeChanged=function(n){this.getRoot().height(n)};n.VSortTab.prototype.dispose=function(){this.disposeComponent()};n.VGridPanel=function(){function tt(){h=t("<table class='vis-gc-vpanel-table'>")}function l(){p=i=k=d=c=u=g=nt=w=y=null;p=t("<td  class='vis-gc-vpanel-table-td0'>");i=t("<td colspan = '3' class='vis-gc-vpanel-table-td1'>");c=t("<td class='vis-gc-vpanel-table-td2'>");u=t("<td colspan='3' class='vis-gc-vpanel-table-td3'>");w=t("<td class='vis-gc-vpanel-table-td4'>");y=t("<tr>");h.append(y);y.append(p).append(i).append(c).append(u).append(w)}function it(n){var u,r,o;n.stopPropagation();var i=t(this),h=i.data("name"),c=i.data("display"),e=!1;for(c==="show"?(i.data("display","hide"),t(i.children()[0]).addClass("vis-gc-vpanel-fieldgroup-img-rotate")):(i.data("display","show"),e=!0,t(i.children()[0]).removeClass("vis-gc-vpanel-fieldgroup-img-rotate")),u=f[h],r=0;r<u.length;r++)o=s[u[r].getName()],u[r].tag=e,u[r].setVisible(e&&o.getIsDisplayed(!0))}function rt(f){if(r==null&&(r=""),f==null||f.length==0||f.equals(r))return!1;r=f;l();var o=t("<span class='vis-gc-vpanel-fieldgroup-span'>"+f+"<\/span>"),s=t("<img class='vis-gc-vpanel-fieldgroup-img' src= '"+n.Application.contextUrl+"Areas/VIS/Images/base/fieldgrpdown.png' >"),e=t("<div class='vis-gc-vpanel-fieldgroup' data-name='"+f+"' data-display='show' >").append(s).append(o);u.remove();c.remove();i.prop("colspan",8);i.append(e);e.on("click",it);return!0}function b(n){if(r!=null&&!r.equals("")){var t=null;f[r]&&(t=f[r]);t==null&&(t=[],f[r]=t);t.push(n)}}var r=null,e=-2,a=-1,o=[],v=[],h,y=null,p,i,k,d,c,u,g,nt,w,s={},f={};tt();this.addField=function(r,f){var y,p,h,w;if(f.getIsLink()){o[++a]=r;v.push(r);return}if((y=n.VControlFactory.getLabel(f),y!=null||r!=null)&&(p=f.getIsSameLine(),rt(f.getFieldGroup())&&(p=!1),p?(++e,e>2?(p=!1,l(),e=0):e<0&&(l(),e=0)):(e=0,l()),y!=null&&(p?u.append(y.getControl()):i.append(y.getControl()),f.getDescription().length>0&&y.getControl().prop("title",f.getDescription()),b(y),s[y.getName()]=f,o[++a]=y),r!=null)){if(p?u.append(r.getControl()):i.append(r.getControl()),h=r.getBtnCount(),h>0){while(h>0)w=r.getBtn(h-1),w!=null&&(p?t("<td class='vis-gc-vpanel-table-td-fix30'>").append(w).insertAfter(u):t("<td class='vis-gc-vpanel-table-td-fix30'>").append(w).insertAfter(i)),--h;h=-1;w=null}h=r.getBtnCount();!p&&f.getIsLongField()?(c.remove(),u.remove(),i.prop("colspan",8-h),i.css("width","100%"),e=2):p?(u.prop("colspan",3-h),e=2):i.prop("colspan",3-h);h=0;b(r);s[r.getName()]=f;o[++a]=r}};this.getRoot=function(){return h};this.getComponents=function(){return o};this.getLinkComponents=function(){return v};this.dispose=function(){var n,t;for(v.length=0,v=null;o.length>0;)o.pop().dispose();for(n in s)s[n]=null,delete s[n];s=null;for(t in f)f[t].length=0,f[t]=null,delete f[n];f=null;a=null;o=null;h.remove();h=null;this.addField=null;l=null;b=null}};r.prototype.ROW_ADD="A";r.prototype.ROW_DELETE="D";r.prototype.ROW_REFRESH="F";r.prototype.ROW_UNDO="U";r.prototype.setupGridTable=function(i,r,u,f,e,o){var v,p,a,c,s,ut,y,g,b;if(!e.getIsDisplayed(!0))return 0;this.id=f;this.$container=u;this.mTab=e;this.AD_Table_ID=this.mTab.getAD_Table_ID();var h=[],l=null,nt=r.length,k=0,d=r.slice(0);for(d.sort(function(n,t){return n.getMRSeqNo()-t.getMRSeqNo()}),v=-1,p=0;p<d.length;p++)if(l=d[p],l!=null){a=l.getColumnName();c=l.getDisplayType();++v;l.getIsKey()?this.indexKeyColumn=v:a.equals("IsActive")?this.indexActiveColumn=v:a.equals("Processed")?this.indexProcessedColumn=v:a.equals("AD_Client_ID")?this.indexClientColumn=v:a.equals("AD_Org_ID")&&(this.indexOrgColumn=v);var w=l.getIsDisplayedMR?l.getIsDisplayedMR():l.getIsDisplayed(),tt=l.getIsMandatory(!1),it=l.getIsReadOnly(),rt=l.getIsEditable(!1);l.getIsHeading()||(s={resizable:!0},s.gridField=l,(it||!rt)&&(s.readOnly=!0),s.caption=l.getHeader(),tt&&(s.caption+='<sup style="color:red;font-size: 11px;top: 0;">*<\/sup>'),s.field=a.toLowerCase(),s.hidden=!w,n.DisplayType.IsNumeric(c)?(s.sortable=!0,s.customFormat=n.DisplayType.GetNumberFormat(c),s.render=function(n,t,i){var r=h[i].field,u=n[r];return h[i].customFormat.GetFormatedValue(u)}):c==n.DisplayType.YesNo?(s.sortable=!0,ut=a.toLowerCase(),s.editable={type:"checkbox"}):c==n.DisplayType.String||c==n.DisplayType.Text||c==n.DisplayType.TextLong||c==n.DisplayType.Memo?(s.sortable=!0,s.render=l.getIsEncryptedField()?function(n,t,i){var u=h[i].field,r=n[u];return(n.changes&&typeof n.changes[u]!="undefined"&&(r=n.changes[u]),r=n[h[i].field],r||r===0)?r.replace(/\w|\W/g,"*"):""}:function(n,t,i){var u=h[i].field,r=n[u];return(n.changes&&typeof n.changes[u]!="undefined"&&(r=n.changes[u]),r||r==0)?w2utils.encodeTags(r):""}):n.DisplayType.IsLookup(c)||c==n.DisplayType.ID?(s.sortable=!0,s.lookup=l.getLookup(),w&&(s.render=function(n,t,i){var r=h[i].lookup,u=h[i].field,e=n[u],f;return n.changes&&typeof n.changes[u]!="undefined",r&&(f=r.getDisplay(e,!0)),f})):n.DisplayType.IsDate(c)?(s.sortable=!0,s.displayType=c,s.render=function(t,i,r){var o=h[r],e=h[r].field,u=t[e],f;return t.changes&&typeof t.changes[e]!="undefined"&&(u=t.changes[e]),u?o.displayType==n.DisplayType.Date?(f=new Date(u),f.setMinutes(f.getTimezoneOffset()+f.getMinutes()),u=Globalize.format(f,"d")):u=o.displayType==n.DisplayType.DateTime?Globalize.format(new Date(u),"f"):Globalize.format(new Date(u),"t"):u="",u}):c==n.DisplayType.Location||c==n.DisplayType.Locator?(s.sortable=!0,s.lookup=l.getLookup(),w&&(s.render=function(n,t,i){var f=h[i].lookup,u=h[i].field,r=n[u];return n.changes&&typeof n.changes[u]!="undefined"&&(r=n.changes[u]),f&&(r=f.getDisplay(r,!0),r=w2utils.encodeTags(r)),r})):c==n.DisplayType.Account||c==n.DisplayType.PAttribute?(s.sortable=!0,s.lookup=l.getLookup(),w&&(s.render=function(n,t,i){var f=h[i].lookup,u=h[i].field,r=n[u];return n.changes&&typeof n.changes[u]!="undefined"&&(r=n.changes[u]),f&&(r=f.getDisplay(r,!0),r=w2utils.encodeTags(r)),r})):c==n.DisplayType.PAttribute?(s.sortable=!0,s.render="int"):c==n.DisplayType.Button?s.sortable=!0:c==n.DisplayType.Image?(s.sortable=!0,s.render=function(t,i,r){var u=h[r].field,f=t[u];return(t.changes&&typeof t.changes[u]!="undefined"&&(f=t.changes[u]),!f)?"-":n.Msg.getElement1("AD_Image_ID")+"-"+f}):n.DisplayType.IsLOB(c)?(s.sortable=!0,s.render=function(n,t,i){var u=h[i].field,r=n[u];return n.changes&&typeof n.changes[u]!="undefined"&&(r=n.changes[u]),r||(r=""),"#"+r.toString().length}):(s.sortable=!0,s.render=function(n,t,i){var u=h[i].field,r=n[u];return(n.changes&&typeof n.changes[u]!="undefined"&&(r=n.changes[u]),r||r==0)?w2utils.encodeTags(r):""}),s.hidden||k++,h.push(s),s.columnName=a,y=n.VControlFactory.getControl(e,l,!1,!1,!1),y.setReadOnly(!1),s.editable||(s.editable={type:"custom",ctrl:y}),y.addVetoableChangeListener(o),y instanceof n.Controls.VButton&&y.addActionListner(i))}if(k>0){g=Math.floor(100/k);for(b in h)h[b].hidden||(h[b].size=g+"%",h[b].min=100)}return this.grid=t().w2grid({name:f,autoLoad:!1,columns:h,records:[],show:{toolbar:!1,columnHeaders:!0,lineNumbers:!1,selectColumn:!0,toolbarReload:!1,toolbarColumns:!0,toolbarSearch:!1,toolbarAdd:!1,toolbarDelete:!1,toolbarSave:!1,selectionBorder:!1,recordTitles:!1},recordHeight:36,onSelect:this.onSelectLocal,onUnselect:this.onUnSelect,onSort:this.onSort,onClick:this.onSingleClick,onDblClick:this.onClick,onEditField:this.onEditField,onChange:this.onChange,onRowAdd:this.onRowAdd}),nt};r.prototype.get=function(n,t){return this.grid.get(n,t)};r.prototype.activate=function(){this.grid&&!this.rendred&&(this.$container.w2render(this.grid.name),this.rendred=!0)};r.prototype.setReadOnly=function(n){this.readOnly=n};r.prototype.getGrid=function(){return this.grid};r.prototype.select=function(n){var t=this.grid.getSelection();if(t.indexOf(n)==-1){if(t.length==1)this.grid.unselect(t[0]);else if(t.length>1)while(t.length>0)this.grid.unselect(t.pop());return this.grid.select(n)}};r.prototype.add=function(n){this.grid.add(n)};r.prototype.clear=function(){this.grid.clear(!0);this.grid.reset()};r.prototype.refresh=function(){this.grid.refresh()};r.prototype.resize=function(){this.grid.resize()};r.prototype.setRow=function(n){isNaN(n)?this.grid.set(n.recid,n):this.grid.set(n)};r.prototype.refreshRow=function(n,t){if(!(this.grid.records.length<1)){var i=this.mTab.getCurrentRow();typeof n!="undefined"&&(i=n);this.paintRow(t?this.grid.get(n,!0):i);this.grid.clearRowChanges(t?n:this.grid.records[i].recid)}};r.prototype.refreshCells=function(){if(!(this.grid.records.length<1)){var n=this.mTab.getCurrentRow();this.paintRow(n);this.grid.refreshRow(this.grid.records[n].recid)}};r.prototype.refreshUndo=function(){if(!(this.grid.records.length<1)){var n=this.mTab.getCurrentRow();this.grid.clearRowChanges(this.grid.records[n].recid);this.paintRow(n);this.grid.refreshRow(this.grid.records[n].recid)}};r.prototype.getSelection=function(n){return this.grid.getSelection(n)};r.prototype.getSelectedRows=function(){for(var t=this.grid.getSelection(!0),i=[],n=0,r=t.length;n<r;n++)i.push(this.grid.records[t[n]]);return i};r.prototype.getColumnNames=function(){for(var t=this.grid.columns,i={},n=0,r=t.length;n<r;n++)i[t[n].columnName]=t[n].caption;return i};r.prototype.scrollInView=function(n){this.grid.scrollIntoView(n)};r.prototype.tableModelChanged=function(t,i,r){var u,f,e;if(this.blockSelect=!0,t===n.VTable.prototype.ROW_REFRESH)this.setRow(i),this.refreshRow(i.recid,!0);else{if(u=null,t===n.VTable.prototype.ROW_UNDO)this.grid.unselect(i),this.grid.remove(i),r>=this.grid.records.length-1&&this.grid.records.length>0?(this.blockSelect=!1,u=this.grid.records[this.grid.records.length-1].recid):r<this.grid.records.length&&(u=this.grid.records[r].recid);else if(t===n.VTable.prototype.ROW_ADD)this.grid.records.splice(r,0,i),u=i.recid,this.grid.refresh(),this.blockSelect=!0;else if(t===n.VTable.prototype.ROW_DELETE){for(f=i.slice();f.length>0;)e=f.pop(),this.grid.unselect(e),this.grid.remove(e);isNaN(r)?u=r[0]:this.grid.records.length>0&&(u=this.grid.records[this.grid.records.length-1<r?this.grid.records.length-1:r].recid)}u&&this.select(u)}this.blockSelect=!1};r.prototype.dispose=function(){var n,t;this.grid.off("select",this.onSelect);this.grid.off("sort",this.onSort);this.grid.off("click",this.onClick);this.onSelect=null;this.onSort=null;n=this.grid.columns;for(t in n)n[t].editable.ctrl&&n[t].editable.ctrl.dispose();this.grid.destroy();this.grid=null;this.id=null;this.$container=null;this.rendered=null;this.disposeComponenet()};e.prototype.tableModelChanged=function(t,i,r){var u=null,f,e;if(t===n.VTable.prototype.ROW_REFRESH)u=i.recid?i.recid:i;else if(t===n.VTable.prototype.ROW_UNDO)this.getBody().find("div.vis-cv-card[name~=vc_"+i+"]").remove();else if(t===n.VTable.prototype.ROW_DELETE){for(f=i.slice();f.length>0;)e=f.pop(),this.getBody().find("div.vis-cv-card[name~=vc_"+e+"]").remove();isNaN(r)&&(u=r[0])}else t===n.VTable.prototype.ROW_ADD&&(u=i.recid);u&&this.navigate(u)};e.prototype.setupCardView=function(t,i,r){this.mTab=i;var u=this;n.dataContext.getCardViewInfo(i.getAD_Window_ID(),i.getAD_Tab_ID(),function(n){u.setCardViewData(n)});r.append(this.getHeader());r.append(this.getRoot())};e.prototype.setCardViewData=function(n){var i,t,r;if(this.hasIncludedCols=!1,this.fields=[],this.cGroup=null,this.cConditions=[],n)for(this.AD_CardView_ID=n.AD_CardView_ID,t=this.mTab.getFieldById(n.FieldGroupID),t&&(this.cGroup=t),this.cConditions=n.Conditions,i=0;i<n.IncludedCols.length;i++)t=this.mTab.getFieldById(n.IncludedCols[i]),t&&this.fields.push(t),this.hasIncludedCols=!0;this.fields.length<1&&this.fields.length<1&&(t=this.mTab.getField("Name"),t&&this.fields.push(t),t=this.mTab.getField("Description"),t&&this.fields.push(t),t=this.mTab.getField("Help"),t&&this.fields.push(t));for(r in this.cGroupInfo)this.cGroupInfo[r].records.length=0;this.cGroupInfo={};this.grpCount=0;this.isProcessed=!1};e.prototype.createGroups=function(){var f,t,u,r,i;if(this.isProcessed){for(f in this.cGroupInfo)this.cGroupInfo[f].records=[];return}if(this.cGroup)if(t=this.cGroup,t){if(t.getDisplayType()==n.DisplayType.YesNo)this.cGroupInfo["true"]={name:"Yes",records:[]},this.cGroupInfo["false"]={name:"No",records:[]},this.grpCount=2;else if(n.DisplayType.IsLookup(t.getDisplayType())&&t.getLookup())for(u=t.getLookup(),u.fillCombobox(!0,!0,!0,!1),r=u.data,i=0;i<r.length;i++)this.cGroupInfo[r[i].Key]={name:r[i].Name,records:[]},this.grpCount+=1;this.setHeader(t.getHeader())}else this.setHeader("");this.grpCount<1&&(this.cGroupInfo.All={name:n.Msg.getMsg("All"),records:[]},this.grpCount=1);this.isProcessed=!0};e.prototype.refreshUI=function(n){var u,r,t,f,i;for(this.createGroups(),u=this.mTab.getTableModel().mSortList,r=this.getBody();this.groupCtrls.length>0;)this.groupCtrls.pop().dispose();if(this.groupCtrls.length=0,r.empty(),t=null,this.grpCount==1){f="";for(i in this.cGroupInfo){f=this.cGroupInfo[i].name;break}t=new y(!0,u,f,this.fields,this.cConditions);this.groupCtrls.push(t);r.append(t.getRoot())}else{this.filterRecord(u);for(i in this.cGroupInfo)t=new y(this.grpCount===1,this.cGroupInfo[i].records,this.cGroupInfo[i].name,this.fields,this.cConditions),this.groupCtrls.push(t),r.append(t.getRoot())}this.calculateWidth(n)};e.prototype.filterRecord=function(n){for(var e=n.length,o=this.cGroup.getColumnName().toLowerCase(),i=null,u=null,t,f,r=0;r<e;r++)i=n[r],u=i[o],this.cGroupInfo[u]?this.cGroupInfo[u].records.push(i):(this.cGroupInfo.Other__1||(this.cGroupInfo.Other__1={name:"Others",records:[]},this.grpCount+=1),this.cGroupInfo.Other__1.records.push(i));t=[];for(f in this.cGroupInfo)this.cGroupInfo[f].records.length<1&&t.push(f);for(this.grpCount-=t.length;t.length>0;)delete this.cGroupInfo[t.pop()]};e.prototype.dispose=function(){this.dC()};y.prototype.dispose=function(){this.dC()};c.prototype.evaluate=function(t){for(var i=null,r=0;r<t.length;r++)(i=t[r],i.ConditionValue)&&n.Evaluator.evaluateLogic(this,i.ConditionValue)&&this.setColor(i.Color,i.FColor)};c.prototype.getValueAsString=function(n){var t=this.record[n.toLowerCase()];return t?(t===!0?t="Y":t&&t.toString().endsWith(".000Z")&&(t=t.replace(".000Z","Z")),t=t.toString()):t===!1?t="N":t===0&&(t="0"),t};c.prototype.dispose=function(){this.dC()};l.prototype.setupMapView=function(n,t,i,r){var u,f,e;for(this.mapFields=[],u=i.getMapColumns(),f=0;f<u.length;f++)e=i.getField(u[f]),e&&this.mapFields.push(e);this.cols=u;this.gc=t;this.aPanel=n;this.mapcols={};this.curIndex=0;r.append(this.getRoot())};l.prototype.refreshUI=function(){var u=this.gc.getSelectedRows(),o=u.length,s,n,t,i,r;if(!(u.length<1)&&!(this.cols.length<1)){for(s=[[]],n=0;n<this.cols.length;n++){var h=this.cols[n],f=this.mapFields[n].getLookup(),e=[];for(t=0;t<o;t++)i=u[t][h.toLowerCase()],i&&(r=f.getLatLng(i),r&&(r.msg=f.getDisplay(i),e.push(r)));this.mapcols[n]=e}this.setMapData(this.mapcols[this.curIndex])}};l.prototype.dispose=function(){this.dc()};n.RecordInfo=function(i,r){function c(){e=null;s=null;u.remove();u=null}var e=null,o=i,s=n.Logging.VLogger.getVLogger("VIS.RecordInfo"),u=t("<div style='min-width:550px;max-width:600px'>"),f=null,h={CreatedBy:r.CreatedBy,Created:r.Created,Updated:r.Updated,UpdatedBy:r.UpdatedBy,Info:r.Info,AD_Table_ID:r.AD_Table_ID,Record_ID:r.Record_ID};n.dataContext.getJSONData(n.Application.contextUrl+"JsonData/GetRecordInfo",{dse:h},function(n){var s,h,f,c,o;if(u.html("<span>"+n.Info+"<\/span>"),n.ShowGrid){s=t("<table class='vis-advancedSearchTable'>");h=t("<div class='vis-advancedSearchTableWrap vis-table-responsive' style='max-height:200px;overflow-y:auto'>").append(s);u.append(h);var i="",e="",r=null;for(f=0,c=n.Rows.length;f<c;f++){if(f==0){for(i+='<thead><tr class="vis-advancedSearchTableHead">',o=0;o<n.Headers.length;o++)i+="<th>"+n.Headers[o]+"<\/th>";i+="<\/tr><\/thead><tbody>"}e='<tr class="vis-advancedSearchTableRow">';r=n.Rows[f];e+="<td>"+r.AD_Column_ID+"<\/td><td>"+r.NewValue+"<\/td><td>"+r.OldValue+"<\/td><td>"+r.UpdatedBy+"<\/td><td>"+Globalize.format(new Date(r.Updated),"f")+"<\/td>";e+="<\/tr>";i+=e}i+="<\/tbody>";s.html(i)}});this.show=function(){f=new n.ChildDialog;f.setTitle(o);f.setContent(u);f.close=function(){c()};f.show()}};n.AWindow=u;n.AppsAction=f;n.APanel=i;n.VTable=r;n.VCardView=e;n.VMapView=l}(VIS,jQuery),function(n,t){function e(t){this.vo=t._vo;this.tabs=[];for(var i=0;i<t._tabs.length;i++)this.tabs.push(new n.GridTab(t._tabs[i],this.vo));t=null}function i(t,i){this.gTab=t;this.vo=t._vo;this.gridTable=new n.GridTable(t._gridTable);this.parents=[];this.orderBys=[];this.depOnFieldColumn=[];this.depOnField=[];this.linkColumnName=t._linkColumnName;this.extendendWhere=t._extendedWhere;this.keyColumnName="";this.isThroughRoleCenter=!1;this.query=new n.Query;this.oldQuery="0=9";this.linkValue="999999";this.currentRow=-1;this.mDataStatusEvent;this.mDataListenerList=[];this.loadFields();this.gridTable.addDataStatusListener(this);this.log=n.Logging.VLogger.getVLogger("VIS.GridTab");this.loadData(i);i=null}function r(t){this.gTable=t;this.readOnly=this.gTable._readOnly;this.AD_Table_ID=t._AD_Table_ID;this.deleteable=this.gTable._deleteable;this.gridFields=[];this.keyColumnName="";this.isOpen=!1;this.inserting=!1;this.SQL_Select="";this.SQL_Count="";this.SQL="";this.bufferList=[];this.defaultModel={};this.pazeSize=n.Env.getWINDOW_PAGE_SIZE();this.newRow=-1;this.compareDB=!0;this.currentPage;this.dopaging;t=null;this.mSortList;this.log=n.Logging.VLogger.getVLogger("VIS.GridTable")}function u(t){this.gfield=t;this.vo=t._vo;this.oldValue;this.value;this.inserting;this.error;this.valueNoFire=!0;var i=null;t._vo.lookupInfo!=null&&n.DisplayType.IsLookup(t._vo.displayType)?n.DisplayType.IsLookup(t._vo.displayType)&&(i=new n.MLookup(t._vo.lookupInfo,t._lookup),this.vo.tabNo>0?(i.initialize(!0),n.MLookupCache.addWindowLookup(this.vo.windowNo,i)):i.initialize()):t._vo.displayType==n.DisplayType.Location?i=new n.MLocationLookup(n.context,t._vo.windowNo):t._vo.displayType==n.DisplayType.Locator?(i=new n.MLocatorLookup(n.context,t._vo.windowNo),this.vo.DefaultValue=i.getDefault()):t._vo.displayType==n.DisplayType.Account?i=new n.MAccountLookup(n.context,t._vo.windowNo):t._vo.displayType==n.DisplayType.PAttribute?i=new n.MPAttributeLookup(n.context,t._vo.windowNo):t._vo.displayType==n.DisplayType.GAttribute&&(i=new n.MGAttributeLookup(n.context,t._vo.windowNo));this.lookup=i;this.propertyChangeListner;this.log=n.Logging.VLogger.getVLogger("VIS.GridField");t=null}function f(t,i,r,u,f){this.mTotalPage=1;this.mCurrentPage=1;this.mPageSize=n.Env.getWINDOW_PAGE_SIZE();this.totalRecords=1;this.m_totalRows=i;this.m_changed=r;this.m_autoSave=u;this.m_inserting=f;this.m_AD_Message;this.m_info=null;this.m_isError=!1;this.m_isWarning=!1;this.m_confirmed=!1;this.m_allLoaded=!0;this.m_loadedRows=-1;this.m_currentRow=-1;this.m_changedColumn=-1;this.m_columnName=null;this.Created;this.CreatedBy;this.Updated;this.UpdatedBy;this.Info;this.AD_Table_ID;this.Record_ID;this.source=t}var o=n.Logging.Level;e.prototype.getTabs=function(){return this.tabs};e.prototype.getIsAppointment=function(){return this.vo.IsAppointment};e.prototype.getIsTask=function(){return this.vo.IsTask};e.prototype.getIsEmail=function(){return this.vo.IsEmail};e.prototype.getIsLetter=function(){return this.vo.IsLetter};e.prototype.getIsSms=function(){return this.vo.IsSms};e.prototype.getIsChat=function(){return this.vo.IsChat};e.prototype.getIsAttachment=function(){return this.vo.IsAttachment};e.prototype.getIsHistory=function(){return this.vo.IsHistory};e.prototype.getIsCheckRequest=function(){return this.vo.IsCheckRequest};e.prototype.getIsCopyReocrd=function(){return this.vo.IsCopyReocrd};e.prototype.getIsSubscribedRecord=function(){return this.vo.IsSubscribedRecord};e.prototype.getIsZoomAcross=function(){return this.vo.IsZoomAcross};e.prototype.getIsCreatedDocument=function(){return this.vo.IsCreatedDocument};e.prototype.getIsUploadedDocument=function(){return this.vo.IsUploadedDocument};e.prototype.getIsViewDocument=function(){return this.vo.IsViewDocument};e.prototype.getIsAttachDocumentFrom=function(){return this.vo.IsAttachDocumentFrom};e.prototype.getIsFaxEmail=function(){return this.vo.IsFaxEmail};e.prototype.getIsMarkToExport=function(){return this.vo.IsMarkToExport};e.prototype.getIsArchive=function(){return this.vo.IsArchive};e.prototype.getIsImportMap=function(){return this.vo.IsImportMap};e.prototype.getIsAttachmail=function(){return this.vo.IsAttachmail};e.prototype.getIsRoleCenterView=function(){return this.vo.IsRoleCenterView};e.prototype.getIsSOTrx=function(){return this.vo.IsSOTrx};e.prototype.getIsTransaction=function(){return this.vo.IsTransaction};e.prototype.getName=function(){return this.vo.Name};e.prototype.dispose=function(){var n;for(originalLength=this.tabs.length,n=originalLength;n>0;n--)gtab=this.tabs.pop(),gtab.dispose(),gtab=null;this.tabs.length=0;this.vo=null;this.tabs=null};i.prototype.getAD_Tab_ID=function(){return this.vo.AD_Tab_ID};i.prototype.getAD_Window_ID=function(){return this.vo.AD_Window_ID};i.prototype.getAD_Table_ID=function(){return this.vo.AD_Table_ID};i.prototype.getTableName=function(){return this.vo.TableName};i.prototype.getName=function(){return this.vo.Name};i.prototype.getDescription=function(){return this.vo.Description};i.prototype.getIsSortTab=function(){return this.vo.IsSortTab};i.prototype.getDependentOn=function(){var t=[];return n.Evaluator.parseDepends(t,this.vo.DisplayLogic),t};i.prototype.getTabLevel=function(){return this.vo.TabLevel};i.prototype.getWindowNo=function(){return this.vo.windowNo};i.prototype.getTabNo=function(){return this.vo.tabNo};i.prototype.getIsSingleRow=function(){return this.vo.IsSingleRow};i.prototype.getIsDisplayed=function(t){var i=this.vo.DisplayLogic,r;return i==null||i.equals("")?!0:t?i.indexOf("@#")!=-1&&(r=n.Env.parseContext(n.context,0,i,!1,!0).trim(),r.Length!=0)?n.Evaluator.evaluateLogic(this,i):!0:n.Evaluator.evaluateLogic(this,i)};i.prototype.getValueAsString=function(t){return n.context.getWindowContext(this.vo.windowNo,t,!0)};i.prototype.getIsCurrent=function(){if(!this.gridTable.getIsOpen()||!this.oldQuery.equals(this.query.getWhereClause()))return!1;if(!this.getIsDetail())return!0;var t=n.context.getWindowContext(this.vo.windowNo,this.getLinkColumnName());return this.linkValue.equals(t)};i.prototype.getIsDetail=function(){return this.parents.length>0||this.vo.AD_Column_ID!=0?!0:!1};i.prototype.getField=function(n){return this.gridTable.getField(n)};i.prototype.getFieldById=function(n){return this.gridTable.getFieldById(n)};i.prototype.getFields=function(){return this.gridTable.getFields()};i.prototype.getLinkColumnName=function(){return this.linkColumnName?this.linkColumnName:""};i.prototype.getOnlyCurrentDays=function(){return this.vo.onlyCurrentDays};i.prototype.getIsTreeTab=function(){return this.vo.HasTree};i.prototype.getRowCount=function(){return this.gridTable.getRowCount()};i.prototype.getRecords=function(){return this.gridTable.getDataTable()};i.prototype.getCurrentRow=function(){return this.currentRow};i.prototype.getOrderByClause=function(n){var i,t;if(this.vo.orderByClause.length>0)return this.vo.OrderByClause;for(this.vo.orderByClause="",i=0;i<3;i++)t=this.orderBys[i],t&&t!=null&&t!=""&&t.length>0&&(this.vo.orderByClause.length>0&&(this.vo.OrderByClause+=","),this.vo.orderByClause+=t);return this.vo.orderByClause.Length>0?this.vo.orderByClause:(this.vo.orderByClause="Created",n>0&&(this.vo.orderByClause+=" DESC"),this.vo.orderByClause)};i.prototype.getTableModel=function(){return this.gridTable};i.prototype.getIsOpen=function(){return this.gridTable!=null?this.gridTable.getIsOpen():!1};i.prototype.getIsQueryActive=function(){return this.query!=null?this.query.getIsActive():!1};i.prototype.getDependantFields=function(n){var i=[],r,t;if(this.depOnFieldColumn.indexOf(n)!=-1)for(r=this.depOnFieldColumn.length,t=0;t<r;t++)this.depOnFieldColumn[t].equals(n)&&i.indexOf(this.depOnField[t])<0&&i.push(this.depOnField[t]);return i};i.prototype.getIsReadOnly=function(){if(this.vo.IsReadOnly)return!0;if(this.vo.ReadOnlyLogic==null||this.vo.ReadOnlyLogic.equals(""))return this.vo.IsReadOnly;return n.Evaluator.evaluateLogic(this,this.vo.ReadOnlyLogic)};i.prototype.getIsQueryNewRecord=function(){return this.query!=null?this.query.getIsNewRecordQuery():!1};i.prototype.getIsInsertRecord=function(){return this.getIsReadOnly()?!1:this.vo.IsInsertRecord};i.prototype.getIncluded_Tab_ID=function(){return this.vo.Included_Tab_ID};i.prototype.getIsAlwaysUpdateField=function(){for(var t,n=0;n<this.gridTable.getColumnCount();n++)if(t=this.gridTable.getField(n),t.getIsAlwaysUpdateable())return!0;return!1};i.prototype.getValue=function(n){if(n==null)return null;var t=this.gridTable.getField(n);return this.getValueOfField(t)};i.prototype.getValueOfField=function(n){return n==null?null:n.getValue()};i.prototype.getAD_Process_ID=function(){return this.vo.AD_Process_ID};i.prototype.getRecord_ID=function(){return this.gridTable.getKeyID(this.currentRow)};i.prototype.getKeyID=function(n){return this.gridTable.getKeyID(n)};i.prototype.getTrxInfo=function(t,i,r){var e,h,f,o,s,l,a,v,y,p;if(t.startsWith("C_Order")||t.startsWith("C_Invoice")){h=t.startsWith("C_Order");f=new StringBuilder("SELECT COUNT(*) AS Lines,c.ISO_Code,o.TotalLines,o.GrandTotal,currencyBase(o.GrandTotal,o.C_Currency_ID,o.DateAcct, o.AD_Client_ID,o.AD_Org_ID) AS ConvAmt ");h?(e=i.getContextAsInt(r,"C_Order_ID"),f.append("FROM C_Order o INNER JOIN C_Currency c ON (o.C_Currency_ID=c.C_Currency_ID) INNER JOIN C_OrderLine l ON (o.C_Order_ID=l.C_Order_ID) WHERE o.C_Order_ID="+e+"")):(e=i.getContextAsInt(r,"C_Invoice_ID"),f.append("FROM C_Invoice o INNER JOIN C_Currency c ON (o.C_Currency_ID=c.C_Currency_ID) INNER JOIN C_InvoiceLine l ON (o.C_Invoice_ID=l.C_Invoice_ID) WHERE o.C_Invoice_ID="+e+""));f.append("GROUP BY o.C_Currency_ID, c.ISO_Code, o.TotalLines, o.GrandTotal, o.DateAcct, o.AD_Client_ID, o.AD_Org_ID");o=null;s=null;try{o=new n.MessageFormat(n.Msg.getMsg("OrderSummary"));s=new n.MessageFormat(n.Msg.getMsg("OrderSummaryMC"))}catch(w){}if(o==null||s==null)return" ";var arguments=[],c=!1,u=null;try{u=n.DB.executeDataReader(f.toString());u.read()&&(l=u.getInt(0),arguments[0]=l,a=u.getDecimal(2).toFixed(2),arguments[1]=a,v=u.getDecimal(3).toFixed(2),arguments[2]=v,y=u.getString(1),arguments[3]=y,p=u.getDecimal(4).toFixed(2),arguments[4]=p,arguments[5]=i.getContext("$CurrencyISO"),c=!0)}catch(w){}finally{u!=null&&u.dispose()}return c?arguments[2]===arguments[4]?o.format(arguments):s.format(arguments):" "}};i.prototype.getIsProcessed=function(){var i=this.gridTable.findColumn("Processed"),t;if(i!=-1){if(t=this.gridTable.getValueAt(this.currentRow,i),typeof t=="string")return"Y".equals(t);if(typeof t=="boolean")return t}return"Y".equals(n.context.getWindowContext(this.vo.windowNo,"Processed"))};i.prototype.getKeyColumnName=function(){return this.keyColumnName};i.prototype.getAD_ColumnSortOrder_ID=function(){return this.vo.AD_ColumnSortOrder_ID};i.prototype.getIsMapView=function(){return this.vo.locationCols&&this.vo.locationCols.length>0?!0:!1};i.prototype.getMapColumns=function(){return this.vo.locationCols};i.prototype.getAD_ColumnSortYesNo_ID=function(){return this.vo.AD_ColumnSortYesNo_ID};i.prototype.getWhereClause=function(){return this.vo.WhereClause};i.prototype.getSearchQuery=function(t){for(var r=null,f=this.getFields(),i=null,u=0;u<f.length;u++)(i=f[u],i.getIsVirtualColumn())||n.DisplayType.IsText(i.getDisplayType())&&(r||(r=new n.Query(this.getTableName(),!0)),r.addRestriction(i.getColumnName(),n.Query.prototype.LIKE,t,i.getColumnName(),t));return f=null,i=null,r};i.prototype.getParentColumnNames=function(){return this.parents};i.prototype.clearSelectedRow=function(){for(var i=this.gridTable.getFields().length,t,n=0;n<i;n++)t=this.gridTable.getField(n),t.getIsKey()?t.setValue(null,!1):t.setNullValue()};i.prototype.setCurrentRow=function(n,t){var e=-1,c=this.verifyRow(n),r,s,u,i,h,o;for(this.currentRow=c,r=this.gridTable.getRow(this.currentRow),r&&(e=r.recid),s=this.gridTable.getFields().length,u=0;u<s;u++)i=this.gridTable.getField(u),r?(h=r[i.getColumnName().toLowerCase()],i.setValue(h,this.gridTable.getIsInserting())):i.getIsKey()?i.setValue(null,!1):i.setNullValue();return t?(this.mDataStatusEvent==null&&(this.mDataStatusEvent=new f(null,this.getRowCount(),this.gridTable.getIsInserting(),!1,this.gridTable.getIsInserting()),this.mDataStatusEvent.setPageInfo(this.gridTable.currentPage,this.gridTable.rowCount,this.gridTable.pazeSize)),this.mDataStatusEvent.setCurrentRow(this.currentRow),o=this.mDataStatusEvent.getAD_Message(),(o==null||o.length==0)&&this.mDataStatusEvent.setInfo("NavigateOrUpdate",null,!1,!1),this.fireDataStatusChanged(this.mDataStatusEvent),e):e};i.prototype.fireDataStatusEventOnly=function(){this.mDataStatusEvent==null&&(this.mDataStatusEvent=new f(null,this.getRowCount(),this.gridTable.getIsInserting(),!1,this.gridTable.getIsInserting()),this.mDataStatusEvent.setPageInfo(this.gridTable.currentPage,this.gridTable.rowCount,this.gridTable.pazeSize));this.mDataStatusEvent.setCurrentRow(this.currentRow);var n=this.mDataStatusEvent.getAD_Message();(n==null||n.length==0)&&this.mDataStatusEvent.setInfo("NavigateOrUpdate",null,!1,!1);this.fireDataStatusChanged(this.mDataStatusEvent)};i.prototype.setQuery=function(t){t==null?this.query=new n.Query:(this.query=t,this.vo.onlyCurrentDays=0)};i.prototype.setValue=function(t,i){var r,u;if(!(t instanceof n.GridField)){if(t==null)return"NoColumn";t=this.gridTable.getField(t)}return t==null?"NoField":(r=t.getDisplayType(),i==null||i.toString()==""?i=null:i===0&&(n.DisplayType.IsID(r)||r==n.DisplayType.List)&&!this.getIsStdColumn(t.getColumnName().toUpper())&&(i=null),u=this.gridTable.findColumn(t.getColumnName()),this.gridTable.setValueAt(i,this.currentRow,u,!1),this.processFieldChange(t))};i.prototype.getIsStdColumn=function(n){return n=="AD_USER_ID"||n=="AD_ROLE_ID"||n=="AD_CLIENT_ID"||n=="AD_ORG_ID"?!0:!1};i.prototype.addDataStatusListener=function(n){this.mDataListenerList.push(n)};i.prototype.removeDataStatusListener=function(n){for(var t=this.mDataListenerList.length-1;t>=0;t--)this.mDataListenerList[t]===n&&(this.mDataListenerList[t]=null,this.mDataListenerList.splice(t,1))};i.prototype.needSave=function(n,t){return n?this.gridTable.needSave(-2,t):t?this.gridTable.needSave():this.gridTable.needSave(t)};i.prototype.loadFields=function(){for(var t,n,i,e,f,r=0;r<this.gTab._gridTable.m_fields.length;r++){for(t=new u(this.gTab._gridTable.m_fields[r]),this.gridTable.gridFields.push(t),n=t.getColumnName(),t.getIsKey()&&(this.keyColumnName=n,this.gridTable.setKeyColumnName(n)),t.getIsParentColumn()&&this.parents.push(n),i=t.getSortNo(),i==0||(Math.abs(i)==1?(this.orderBys[0]=n,i<0&&(this.orderBys[0]+=" DESC")):Math.abs(i)==2?(this.orderBys[1]=n,i<0&&(this.orderBys[1]+=" DESC")):Math.abs(i)==3&&(this.orderBys[2]=n,i<0&&(this.orderBys[2]+=" DESC"))),e=t.getDependentOn(),f=0;f<e.length;f++)this.depOnFieldColumn.push(e[f]),this.depOnField.push(t);(n.equals("IsActive")||n.equals("Processed")||n.equals("Processing"))&&(this.depOnFieldColumn.push(n),this.depOnField.push(null));t=null}};i.prototype.validateQuery=function(t){var i,r,e,u,s,f,l,h;if(t==null||t.getRestrictionCount()==0)return null;if(t.getRestrictionCount()!=1||(i=t.getColumnName(0),i==null)||i.indexOf("(")!=-1)return t.getWhereClause();if(r=null,i.equals("R_RequestRelated_ID")?r="R_Request_ID":i.startsWith("C_DocType")?r="C_DocType_ID":i.equals("CreatedBy")||i.equals("UpdatedBy")?r="AD_User_ID":i.equals("Orig_Order_ID")?r="C_Order_ID":i.equals("Orig_InOut_ID")&&(r="M_InOut_ID"),r!=null){if(this.getField(r)!=null)return t.setColumnName(0,r),t.getWhereClause();r=null}if(this.getField(i)!=null)return t.getWhereClause();e="SELECT cc.ColumnName FROM AD_Column c INNER JOIN AD_Ref_Table r ON (c.AD_Reference_Value_ID=r.AD_Reference_ID) INNER JOIN AD_Column cc ON (r.Column_Key_ID=cc.AD_Column_ID) WHERE c.AD_Reference_ID IN (18,30) AND c.ColumnName='"+i+"'";u=null;try{u=n.DB.executeDataReader(e);u.read()&&(r=u.getString(0))}catch(c){return this.log.log(o.SEVERE,"(ref) - Column="+i,c),t.getWhereClause()}finally{u!=null&&u.dispose()}if(r!=null){if(t.setColumnName(0,r),this.getField(r)!=null)return this.log.fine("Column "+i+" replaced with "+r),t.getWhereClause();i=r}s=null;f=this.getKeyColumnName();e="SELECT t.TableName FROM AD_Column c INNER JOIN AD_Table t ON (c.AD_Table_ID=t.AD_Table_ID) WHERE c.ColumnName='"+i+"' AND IsKey='Y' AND EXISTS (SELECT * FROM AD_Column cc WHERE cc.AD_Table_ID=t.AD_Table_ID AND cc.ColumnName='"+f+"')";try{u=n.DB.executeDataReader(e);u.read()&&(s=u.getString(0))}catch(c){return this.log.log(o.SEVERE,"Column="+i+", Key="+f,c),null}finally{u!=null&&u.dispose()}return f.equals("AD_Reference_ID")?(e="SELECT AD_Reference_ID FROM AD_Column WHERE ColumnName='"+i+"'",l=n.DB.executeScalar(e,i),"AD_Reference_ID="+l):s==null?(this.log.info("Not successfull - Column="+i+", Key="+f+", Query="+t),t.getWhereClause()):(t.setTableName("xx"),h="EXISTS (SELECT * FROM "+s+" xx WHERE "+t.getWhereClause(!0)+" AND xx."+f+"="+this.getTableName()+"."+f+")",this.log.fine(h),h)};i.prototype.prepareQuery=function(t,i,r,u){var f,c,o,e,l;this.getIsTreeTab()&&this.gridTable.setDoPaging(!1);var h=!0,a=!1,s=this.oldQuery.equals(this.query.getWhereClause())&&this.vo.onlyCurrentDays==t;return this.oldQuery=this.query.getWhereClause(),this.vo.onlyCurrentDays=t,f="",u||(f+=this.vo.WhereClause),this.vo.onlyCurrentDays>0&&(f.length>0&&(f+=" AND "),c=this.findColumn("Processed")!=-1,c&&(f+="(Processed='N' OR "),f+=r?"Created>=":"Updated>=",f+="addDays(SysDate, -"+this.vo.onlyCurrentDays+")",c&&(f+=")")),this.isThroughRoleCenter||this.getIsDetail()&&(o=this.getLinkColumnName(),o.equals("")?(f.length>0&&(f+=" AND "),f+=" 2=3",h=!1):(e=n.context.getWindowContext(this.vo.windowNo,o),s&&(s=this.linkValue.equals(e),a=!s),this.linkValue=e,e.length==0?(f.length>0&&(f+=" AND "),f+=" 2=4",h=!1):(f.length>0&&(f+=" AND "),"NULL".equals(e.toUpper())?f+=o+" IS NULL ":(f+=o+"=",f+=o.endsWith("_ID")?e:"'"+e+"'")))),this.extendedWhere=f.toString(),this.query.getIsActive()&&(l=this.validateQuery(this.query),l==null||a||(f.length>0&&(f+=" AND "),f+=l)),this.gridTable.getIsOpen()?s?this.gridTable.dataRefreshAll():this.gridTable.dataRequery(f.toString()):(this.gridTable.setSelectWhereClause(f.toString()),this.gridTable.open(i)),h};i.prototype.dataRefresh=function(){var n=this.currentRow,t=this.gridTable.dataRefresh(n);return this.setCurrentRow(n,!0),t};i.prototype.dataIgnore=function(){this.gridTable.dataIgnore();this.setCurrentRow(this.currentRow,!1)};i.prototype.dataSave=function(t){try{var i=this.gridTable.dataSave(t)==n.GridTable.prototype.SAVE_OK;return t&&this.setCurrentRow(this.currentRow,!1),i,i}catch(r){this.log.log(n.Logging.Level.SEVERE,"#"+this.vo.tabNo+" - row="+this.currentRow,r)}return!1};i.prototype.dataNew=function(t){var r,u,f,i;if(!this.getIsInsertRecord())return this.log.warning("Insert Not allowed in TabNo="+this.vo.tabNo),null;if(this.vo.tabNo>0){if(r="Y".equals(n.context.getWindowContext(this.vo.windowNo,"Processed")),r)return this.log.warning("Not allowed in TabNo="+this.vo.tabNo+" -> Processed="+r),null;this.log.finest("Processed="+r)}if(u=this.gridTable.dataNew(this.currentRow,t),!u)return u;for(this.setCurrentRow(this.currentRow+1,!0),f=this.getFieldCount(),i=0;i<f;i++)this.processCallout(this.getField(i));for(i=0;i<f;i++)this.getField(i).refreshLookup(),this.getField(i).setError(!1);return u};i.prototype.dataDelete=function(n){var t=this.gridTable.dataDelete(n,this.currentRow);return this.setCurrentRow(this.currentRow,!0),t};i.prototype.findColumn=function(n){return this.gridTable.findColumn(n)};i.prototype.navigate=function(n,t,i){var u=-1,r=null;return!i&&(n===this.currentRow||(r=this.verifyRow(n),r===this.currentRow))?u:(r=r!=null?r:this.currentRow,this.gridTable.dataSave(r,!1)&&(u=this.setCurrentRow(r,t)),u)};i.prototype.verifyRow=function(n){var t=n,i;return this.gridTable.getIsOpen()?(i=this.getRowCount(),i==0)?-1:(t>=i?t=i-1:t<0&&(t=0),t):-1};i.prototype.navigateRelative=function(n){return this.navigate(this.currentRow+n)};i.prototype.hasDependants=function(n){return this.depOnFieldColumn.indexOf(n)!==-1};i.prototype.dataStatusChanged=function(n){var i=n.getCurrentRow(),r=n.getAD_Message(),t;n.setCurrentRow(this.currentRow);this.mDataStatusEvent=n;i==this.currentRow?(t=this.gridTable.getField(n.getChangedColumn()),t!=null):this.fireDataStatusChanged(this.mDataStatusEvent)};i.prototype.fireDataStatusChanged=function(n){var u=this.mDataListenerList,t,i,f,r;if(u.length!=0){if(n.getCurrentRow()>=0){if(n.Created=this.getValue("Created"),n.CreatedBy=this.getValue("CreatedBy"),n.Updated=this.getValue("Updated"),n.UpdatedBy=this.getValue("UpdatedBy"),n.Record_ID=this.getKeyID(n.getCurrentRow()),t=new StringBuilder(this.getTableName()),this.keyColumnName!=null&&this.keyColumnName.length>0)t.append(" - ").append(this.keyColumnName).append("=").append(n.Record_ID);else for(i=0;i<this.parents.length;i++)f=this.parents[i],t.append(" - ").append(f).append("=").append(this.getValue(f));n.Info=t.toString()}for(n.setInserting(this.gridTable.getIsInserting()),r=0;r<u.length;r++)u[r].dataStatusChanged(n)}};i.prototype.processFieldChange=function(n){return this.processDependencies(n),this.processCallout(n)};i.prototype.processDependencies=function(t){var r=t.getColumnName(),f,u,i,e;if(this.hasDependants(r))for(f=this.getDependantFields(r),u=0;u<f.length;u++)i=f[u],i!=null&&i.getLookup()instanceof n.MLookup&&(e=i.getLookup(),e.getValidation().indexOf("@"+r+"@")!=-1&&(this.log.fine(r+" changed - "+i.getColumnName()+" set to null"),this.setValue(i,null))),i!=null&&i.getLookup()instanceof n.MLocatorLookup};i.prototype.processCallout=function(t){var l=t.getCallout(),r,e,s,i;if(l.length==0||this.getIsProcessed())return"";for(var v=t.getValue(),y=t.getOldValue(),a=new n.StringTokenizer(l,";,",!1);a.hasMoreTokens();){var u=a.nextToken().trim(),c=null,f=null;u=u.replace("org.compiere.model","VAdvantage.Model");r=u;e=u.lastIndexOf(".");try{e!=-1&&(r=u.substring(0,e).replace("ViennaAdvantage","VIS").replace("VAdvantage","VIS"),s=n.Utility.getFunctionByName(r,window),s||r.startsWith("VIS")||(r="VIS"+r.substring(r.indexOf(".")),s=n.Utility.getFunctionByName(r,window)),c=new s,f=u.substring(e+1))}catch(h){return this.log.log(o.SEVERE,r,h),"Callout Invalid: "+r+" ("+h.toString()+")"}if(c==null||f==null||f.length==0)return"Callout Invalid: "+f;i="";try{i=c.start(n.context,f,this.vo.windowNo,this,t,v,y)}catch(h){return this.log.log(n.Logging.Level.SEVERE,"start",h),i="Callout Invalid: "+h.toString()}if(i&&!i.toString().equals(""))return i instanceof Error&&(i=i.toString()+"-> "+u),this.log.warning(i),i}return""};i.prototype.getFieldCount=function(){return this.gridTable.getColumnCount()};i.prototype.getCM_ChatID=function(){var t;return((this.chats==null||this.chats.length==0)&&this.loadChats(),this.chats==null)?0:(t=this.getRecord_ID(),this.hasKey(this.chats,t))?n.Utility.Util.getValueOfInt(this.getKeyValue(this.chats,t)):0};i.prototype.getCM_SubScribedID=function(){var t;return((this._subscribe==null||this._subscribe.length==0)&&this.loadSubscribe(),this._subscribe==null)?0:(t=this.getRecord_ID(),this.hasKey(this._subscribe,t))?n.Utility.Util.getValueOfInt(this.getKeyValue(this._subscribe,t)):0};i.prototype.hasKey=function(n,t){for(var i=0;i<n.length;i++)if(n[i].ID===t)return!0;return!1};i.prototype.getKeyValue=function(n,t){for(var i=0;i<n.length;i++)if(n[i].ID===t)return n[i].value;return 0};i.prototype.getCommitWarning=function(){return this.vo.CommitWarning};i.prototype.getField=function(n){return this.gridTable.getField(n)};i.prototype.dispose=function(){if(this.gTab=null,this.vo=null,this.gridTable.removeDataStatusListener(this),this.gridTable.dispose(),this.gridTable=null,this.mDataListenerList!=null)for(var n=this.mDataListenerList.length-1;n>=0;n--)this.mDataListenerList[n]=null,this.mDataListenerList.splice(n,1)};i.prototype.getIsLocked=function(){if(!n.MRole.getIsPersonalLock()||this.isDataLoading||(this._Lock==null&&this.loadLocks(),this._Lock==null||this._Lock.length==0))return!1;var t=this.getRecord_ID();return this._Lock.indexOf(t)>-1};i.prototype.loadLocks=function(){var u=n.context.getAD_User_ID(),i,t,r;if(this.canHaveAttachment()){i="SELECT Record_ID FROM AD_Private_Access WHERE AD_User_ID="+u.toString()+" AND AD_Table_ID="+this.vo.AD_Table_ID.toString()+" AND IsActive='Y' ORDER BY Record_ID";t=null;try{for(this._Lock==null?this._Lock=[]:this._Lock.length=0,t=n.DB.executeReader(i,null);t.read();)r=n.Utility.Util.getValueOfInt(t.get("Record_ID")),this._Lock.push(r);t.close();t=null}catch(f){this.log.Log(o.SEVERE,i,f)}this.log.fine("#"+this._Lock.length)}};i.prototype.loadSubscribe=function(){var i,t,r,u;if(this.canHaveAttachment()){i="SELECT CM_Subscribe_ID, Record_ID FROM CM_Subscribe WHERE AD_User_ID="+n.context.getAD_User_ID()+" AND AD_Table_ID="+this.getAD_Table_ID();t=null;try{for(this._subscribe=[],this._subscribe==null?this._subscribe={}:this._subscribe.length=0,t=n.DB.executeDataReader(i);t.read();)r=n.Utility.Util.getValueOfInt(t.getString(1)),u=n.Utility.Util.getValueOfInt(t.getString(0)),this._subscribe.push({ID:r,value:u});t=null}catch(f){}}};i.prototype.loadDocuments=function(){var i,t,r,u;if(this.canHaveAttachment()){i="SELECT vadms_windowdoclink_id,record_id FROM vadms_windowdoclink wdl JOIN vadms_document doc  ON wdl.VADMS_Document_ID  =doc.VADMS_Document_ID  WHERE doc.vadms_docstatus!='DD' AND ad_table_id="+this.getAD_Table_ID();t=null;try{for(this.viewDocument=[],this.viewDocument==null?this.viewDocument={}:this.viewDocument.length=0,t=n.DB.executeDataReader(i);t.read();)r=n.Utility.Util.getValueOfInt(t.getString(1)),u=n.Utility.Util.getValueOfInt(t.getString(0)),this.viewDocument.push({ID:r,value:u});t=null}catch(f){}}};i.prototype.loadChats=function(){var i,t,r,u;if(this.canHaveAttachment()){i="SELECT CM_Chat_ID, Record_ID FROM CM_Chat WHERE AD_Table_ID="+this.getAD_Table_ID();t=null;try{for(this.chats=[],this.chats==null?this.chats={}:this.chats.length=0,t=n.DB.executeDataReader(i);t.read();)r=n.Utility.Util.getValueOfInt(t.getString(1)),u=n.Utility.Util.getValueOfInt(t.getString(0)),this.chats.push({ID:r,value:u});t=null}catch(f){}}};i.prototype.canHaveAttachment=function(){return this.keyColumnName.endsWith("_ID")?!0:!1};i.prototype.hasChat=function(){if(this.isDataLoading||(this.chats==null&&this.loadChats(),this.chats==null))return!1;var n=this.getRecord_ID();return this.hasKey(this.chats,n)};i.prototype.hasDocument=function(){if(this.isDataLoading||(this.viewDocument==null&&this.loadDocuments(),this.viewDocument==null))return!1;var n=this.getRecord_ID();return this.hasKey(this.viewDocument,n)};i.prototype.HasSubscribed=function(){if(this.isDataLoading||(this._subscribe==null&&this.loadSubscribe(),this._subscribe==null))return!1;var n=this.getRecord_ID();return this.hasKey(this._subscribe,n)};i.prototype.loadAttachments=function(){var i,t,r,u;if(this.canHaveAttachment()){i="SELECT distinct att.AD_Attachment_ID, att.Record_ID FROM AD_Attachment att INNER JOIN AD_Attachmentline al ON (al.AD_Attachment_id=att.AD_Attachment_id) WHERE att.AD_Table_ID="+this.getAD_Table_ID();t=null;try{for(this._attachments=[],t=n.DB.executeDataReader(i);t.read();)r=n.Utility.Util.getValueOfInt(t.getString(1)),u=n.Utility.Util.getValueOfInt(t.getString(0)),this._attachments.push({ID:r,value:u});t=null}catch(f){}}};i.prototype.loadMarking=function(){var u="SELECT AD_ExportData_ID, Record_ID FROM AD_ExportData WHERE AD_Table_ID="+this.getAD_Table_ID(),t=null,i,r;try{for(this._marking=[],t=n.DB.executeDataReader(u);t.read();)i=n.Utility.Util.getValueOfInt(t.getString(1)),r=n.Utility.Util.getValueOfInt(t.getString(0)),this._marking.push({ID:i,value:r});t=null}catch(f){}};i.prototype.hasAttachment=function(){if(this.isDataLoading||(this._attachments==null&&this.loadAttachments(),this._attachments==null))return!1;var n=this.getRecord_ID();return this.hasKey(this._attachments,n)};i.prototype.hasMarked=function(){if(this.isDataLoading||(this._marking==null&&this.loadMarking(),this._marking==null))return!1;var n=this.getRecord_ID();return this.hasKey(this._marking,n)};i.prototype.loadData=function(t){var r,u,f,e,o,s,h,l,c,i;this.isDataLoading=!0;this.isExportLoading=!0;r=[];u={};t.IsExportData&&(u.AD_EXPORTDATA=r.length,r.push("SELECT AD_EXPORTDATA_ID,RECORD_ID, AD_ColOne_ID FROM AD_EXPORTDATA WHERE AD_Table_ID="+this.getAD_Table_ID()));this.canHaveAttachment()&&(t.IsAttachment&&(u.AD_Attachment=r.length,r.push("SELECT distinct att.AD_Attachment_ID, att.Record_ID FROM AD_Attachment att  INNER JOIN AD_Attachmentline al ON (al.AD_Attachment_id=att.AD_Attachment_id)  WHERE att.AD_Table_ID="+this.getAD_Table_ID())),t.IsChat&&(u.CM_Chat=r.length,r.push("SELECT CM_Chat_ID, Record_ID FROM CM_Chat WHERE AD_Table_ID="+this.getAD_Table_ID())),n.MRole.getIsPersonalLock()&&(u.AD_Private_Access=r.length,r.push("SELECT Record_ID FROM AD_Private_Access WHERE AD_User_ID="+n.context.getAD_User_ID()+" AND AD_Table_ID="+this.getAD_Table_ID()+" AND IsActive='Y' ORDER BY Record_ID")),t.IsSubscribeRecord&&(u.Cm_Subscribe=r.length,r.push("Select cm_Subscribe_ID,Record_ID from Cm_Subscribe where AD_User_ID="+n.context.getAD_User_ID()+" AND ad_Table_ID="+this.getAD_Table_ID())),t.IsViewDocument&&window.VADMS&&(u.vadms_windowdoclink=r.length,r.push("SELECT vadms_windowdoclink_id, record_id FROM vadms_windowdoclink wdl JOIN vadms_document doc ON wdl.VADMS_Document_ID  =doc.VADMS_Document_ID WHERE doc.vadms_docstatus!='DD' AND AD_Table_ID ="+this.getAD_Table_ID())));r=r.join("~");f=null;try{if(f=n.DB.executeDataSet(r),f!=null&&f.getTables().length>0){if(this.canHaveAttachment()){if(t.IsAttachment)for(s=f.getTables()[u.AD_Attachment],elements=null,this._attachments==null?this._attachments=[]:this._attachments.length=0,i=0;i<s.getRows().length;i++)e=n.Utility.Util.getValueOfInt(s.getRows()[i].getCell("Record_ID")),o=n.Utility.Util.getValueOfInt(s.getRows()[i].getCell("AD_Attachment_ID")),this._attachments.push({ID:e,value:o});if(t.IsChat)for(h=f.getTables()[u.CM_Chat],this.chats==null?this.chats=[]:this.chats.length=0,i=0;i<h.getRows().length;i++)e=n.Utility.Util.getValueOfInt(h.getRows()[i].getCell("Record_ID")),o=n.Utility.Util.getValueOfInt(h.getRows()[i].getCell("CM_Chat_ID")),this.chats.push({ID:e,value:o});if(n.MRole.getIsPersonalLock())for(l=f.getTables()[u.AD_Private_Access],this._Lock==null?this._Lock=[]:this._Lock.length=0,i=0;i<l.getRows().length;i++)e=n.Utility.Util.getValueOfInt(l.getRows()[i].getCell("Record_ID")),this._Lock.push(e);if(t.IsSubscribeRecord)for(c=f.getTables()[u.Cm_Subscribe],this._subscribe==null?this._subscribe=[]:this._subscribe.length=0,i=0;i<c.getRows().length;i++)e=n.Utility.Util.getValueOfInt(c.getRows()[i].getCell("Record_ID")),o=n.Utility.Util.getValueOfInt(c.getRows()[i].getCell("CM_Subscribe_ID")),this._subscribe.push({ID:e,value:o});t.IsViewDocument;this.isDataLoading=!1;this.isExportLoading=!1;u=null;r=null}}else this.isDataLoading=!1,this.isExportLoading=!1}catch(a){this.isDataLoading=!1;this.isExportLoading=!1}};i.prototype.locks=function(t,i,r){var u=t.getAD_User_ID();n.dataContext.updateInsertLocks(u,this.vo.AD_Table_ID,i,r);this.loadLocks()};i.prototype.setRecordStatus=function(n){var t=n};r.prototype.ctx=n.context;r.prototype.SAVE_OK="O";r.prototype.SAVE_ERROR="E";r.prototype.SAVE_ACCESS="A";r.prototype.SAVE_MANDATORY="M";r.prototype.SAVE_ABORT="U";r.prototype.getReadOnly=function(){return!1};r.prototype.getField=function(n){var r,t,i;if(isNaN(n)){if(n==null||n.length==0)return null;for(r=this.gridFields.length,t=0;t<r;t++)if(i=this.gridFields[t],n.equals(i.getColumnName(),!0))return i;return null}return n<0||n>=this.gridFields.length?null:this.gridFields[n]};r.prototype.getFieldById=function(n){var r,t,i;if(n<1)return null;for(r=this.gridFields.length,t=0;t<r;t++)if(i=this.gridFields[t],n===i.getAD_Field_ID())return i;return null};r.prototype.getIsInserting=function(){return this.inserting};r.prototype.getColumnCount=function(){return this.gridFields.length};r.prototype.getFields=function(){return this.gridFields};r.prototype.getWhereClause=function(t){for(var h=this.gridFields.length,s=null,u=null,f,i,r,e=0;e<h;e++)if(f=this.gridFields[e],f.getIsKey()){if(i=f.getColumnName().toLowerCase(),r=t[i],r==null)return this.log.log(n.Logging.Level.WARNING,"PK data is null - "+i),null;s=i.toUpperCase().endsWith("_ID")?new StringBuilder(i).append("=").append(r):new StringBuilder(i).append("=").append(n.DB.to_string(r.toString()))}else if(f.getIsParentColumn()){if(i=f.getColumnName().toLowerCase(),r=t[i],r==null){this.log.log(o.INFO,"FK data is null - "+i);continue}u==null?u=new StringBuilder:u.append(" AND ");i.toUpperCase().endsWith("_ID")?u.append(i).append("=").append(r):u.append(i).append("=").append(n.DB.to_string(r.toString()))}return s!=null?s.toString():u!=null?u.toString():(this.log.log(o.WARNING,"No key Found"),null)};r.prototype.getIsOpen=function(){return this.isOpen};r.prototype.getTableID=function(){return this.gTable._AD_Table_ID};r.prototype.getDataTable=function(){return this.bufferList};r.prototype.getSortModel=function(){return this.mSortList};r.prototype.getRow=function(n){return this.mSortList[n]};r.prototype.getRowCount=function(){return this.mSortList?this.mSortList.length:this.bufferList?this.bufferList.length:0};r.prototype.getTotalRowCount=function(){return this.rowCount};r.prototype.getValueAt=function(n,t){var i=this.getRow(n);return i&&t in i?i[t]:null};r.prototype.getMandatory=function(n){for(var i=new StringBuilder,f=this.gridFields.length,t,u,r=0;r<f;r++)t=this.gridFields[r],t.getIsMandatory(!0)&&(u=t.getColumnName().toLowerCase(),(n[u]==null||n[u].toString().length==0)&&(t.setInserting(!0),t.setError(!0),i.length()>0&&i.append(", "),i.append(t.getHeader())));return i.length()==0?"":i.toString()};r.prototype.getErrorColumns=function(){for(var n=new StringBuilder,r=this.gridFields.length,i,t=0;t<r;t++)i=this.gridFields[t],i.getIsError()&&(n.length()>0&&n.append(", "),n.append(i.getHeader()));return n.length()==0?"":n.toString()};r.prototype.getClientOrg=function(n){var u=-1,t,i,r;return this.gTable._indexClientColumn!=-1&&(t=this.getValueAt(n,"ad_client_id"),t!=null&&(u=t)),i=0,this.gTable._indexOrgColumn!=-1&&(r=this.getValueAt(n,"ad_org_id"),r!=null&&(i=r)),[u,i]};r.prototype.getKeyID=function(n){if(this.gTable._indexKeyColumn!=-1)try{var t=this.getValueAt(n,this.keyColumnName.toLowerCase());return t==null||isNaN(t)?-1:t}catch(i){return-1}return-1};r.prototype.setKeyColumnName=function(n){this.keyColumnName=n};r.prototype.setTableName=function(n){this.isOpen||n!=null&&n.length!=0&&(this.gTable._tableName=n)};r.prototype.setReadOnly=function(n){this.readOnly=n};r.prototype.setDeleteable=function(n){this.gTable._deleteable=n};r.prototype.setOrderClause=function(n){this.gTable._orderClause=n;this.gTable._orderClause==null&&(this.gTable._orderClause="")};r.prototype.setSelectWhereClause=function(n){return this.isOpen?!1:(this.gTable._whereClause=n,this.gTable._whereClause==null&&(this.gTable._whereClause=""),!0)};r.prototype.setDoPaging=function(n){this.dopaging=n};r.prototype.setCurrentPage=function(n){this.currentPage=n};r.prototype.setCurrentPageRelative=function(n){var t=this.currentPage;isNaN(n)?t=Math.ceil(this.rowCount/this.pazeSize):n!==0?t+=n:t=1;this.currentPage=t};r.prototype.setSortModel=function(n){this.mSortList=null;this.mSortList=n};r.prototype.setValueAt=function(n,i,r,u){var f,e,o,s;!this.isOpen||this.readOnly||i<0||r<0||this.rowCount==0||(f=this.getField(r),e=this.getValueAt(i,f.getColumnName().toLowerCase()),u||(e!=null||n!=null)&&e!==n)&&(o=this.getRow(i),this.rowChanged=i,this.rowData==null&&(this.rowData={},t.extend(this.rowData,o)),f.setValue(n,this.inserting),o[f.getColumnName().toLowerCase()]=n,s=this.createDSE(),s.setChangedColumn(r,f.getColumnName()),this.fireDataStatusChanged(s))};r.prototype.needSave=function(n,t){var i=n,r=t;return(arguments.length==0?(i=this.rowChanged,r=!1):arguments.length==1?(i=arguments[0],r=!1):(i=arguments[0],r=arguments[1]),typeof this.changed=="undefined"||!this.changed&&(this.rowChanged==-1||typeof this.rowChanged=="undefined"))?!1:this.changed&&(typeof this.rowChanged=="undefined"||this.rowChanged==-1)&&r?!1:i==this.rowChanged?!1:!0};r.prototype.findColumn=function(n){for(var i=this.gridFields,r,t=0;t<i.length;t++)if(r=i[t],n.equals(r.getColumnName(),!0))return t;return-1};r.prototype.createSelectSql=function(){var t=this.gTable,r,u,e,o,f,i;if(this.gridFields.length==0||t._tableName==null||t._tableName.equals(""))return"";for(r=new StringBuilder("SELECT "),u=null,e=0;e<this.gridFields.length;e++)e>0&&r.append(","),o=this.gridFields[e],u=o.getColumnSQL(!0),u.indexOf("@")==-1?r.append(u):r.append(n.Env.parseContext(this.ctx,t._windowNo,u,!1));return u=null,r.append(" FROM ").append(t._tableName),this.SQL_Select=r.toString(),this.SQL_Count="SELECT COUNT(*) FROM "+t._tableName,f=new StringBuilder(""),i=t._whereClause,i.length>0&&(f.append(" WHERE "),i.indexOf("@")==-1?f.append(i):f.append(n.Env.parseContext(this.ctx,t._windowNo,i,!1)),i.toUpperCase().indexOf("=NULL")>0&&this.log.Severe("Invalid NULL - "+_tableName+"="+i)),this.SQL=this.SQL_Select+f.toString(),this.SQL_Count+=f.toString(),t._withAccessControl&&(this.SQL=n.MRole.addAccessSQL(this.SQL,t._tableName,n.MRole.SQL_FULLYQUALIFIED,n.MRole.SQL_RO),this.SQL_Count=n.MRole.addAccessSQL(this.SQL_Count,t._tableName,n.MRole.SQL_FULLYQUALIFIED,n.MRole.SQL_RO)),t._orderClause.equals("")||(this.SQL+=" ORDER BY "+t._orderClause),this.ctx.setWindowTabContext(t._windowNo,t._tabNo,"SQL",this.SQL),this.SQL};r.prototype.open=function(t){return(this.maxRows=t,this.isOpen)?(this.dataRefreshAll(),!0):(this.createSelectSql(),this.SQL==null||this.SQL.equals(""))?!1:(this.rowCount=n.DB.executeScalar(this.SQL_Count,null),this.rowCount>0?(this.fillData(),this.isOpen=!0,this.changed=!1,this.rowChanged=-1):(this.bufferList!=null&&(this.bufferList.length=0),this.mSortList!=null&&(this.mSortList=null),this.currentPage=1,this.isOpen=!0,this.changed=!1,this.rowChanged=-1,window.setTimeout(function(n){n.fireQueryCompleted(!0)},300,this)),!0)};r.prototype.fillData=function(){this.pazeSize=n.Env.getWINDOW_PAGE_SIZE();this.maxRows>0&&this.rowCount>this.maxRows?(this.pazeSize=this.maxRows,this.rowChanged=this.maxRows):(!this.dopaging||this.pazeSize>this.rowCount)&&(this.pazeSize=this.rowCount);this.dopaging&&this.rowCount+this.pazeSize<=this.currentPage*this.pazeSize&&--this.currentPage;this.bufferList.length=0;var t=this,i=this.createGridFieldArr(this.gridFields,!0),r={sql:this.SQL,page:this.dopaging?this.currentPage:0,pageSize:this.dopaging?this.pazeSize:0};n.dataContext.getWindowRecords(r,i,this.rowCount,this.SQL_Count,this.AD_Table_ID,function(n){var s,e,r,u,f,i;try{if(n!=null){if(s=0,n.getTables().length!=0)for(e=n.getTable(0).getRows(),r=n.getTable(0).getColumnsName(),u=0;u<e.length;u++){for(f=e[u].getJSCells(),i=0;i<r.length;i++)f[r[i]]=t.readDataOfColumn(r[i],f[r[i]]);t.bufferList[u]=f;s++}n.dispose();n=null}}catch(h){this.log.Log(o.SEVERE,t.SQL,h)}t.fireQueryCompleted(!0);t=null})};r.prototype.readDataOfColumn=function(t,i){var f,u,r,o,e;if(i==null)return i;try{if(f=this.getField(t),f==null)return i;u=f.getColumnName();r=f.getDisplayType();n.DisplayType.IsID(r)&&(u.endsWith("_ID")||u.endsWith("_Acct"))||u.endsWith("atedBy")||u.endsWith("_ID_1")||u.endsWith("_ID_2")||u.endsWith("_ID_3")||r==n.DisplayType.Integer?i=n.Utility.Util.getValueOfInt(i):n.DisplayType.IsNumeric(r)?i=n.Utility.Util.getValueOfDecimal(i):n.DisplayType.IsDate(r)?dte=null:r==n.DisplayType.RowID?i=null:r==n.DisplayType.YesNo?(o=i.toString(),f.getIsEncryptedColumn()&&(o=this.decrypt(o)),i=o.equals("Y")):n.DisplayType.IsLOB(r)?(e=i,e==null&&(i=null),i=typeof e==typeof string?e.toString():e):i=i.toString();f.getIsEncryptedColumn()&&r!=n.DisplayType.YesNo&&(i=this.decrypt(i))}catch(s){console.log(s)}return i};r.prototype.encrypt=function(t){return t==null||t.length<1?t:n.secureEngine.encrypt(t)};r.prototype.decrypt=function(t){return t==null||t.length<1?t:n.secureEngine.isEncrypted(t)?n.secureEngine.decrypt(t):t};r.prototype.dataSave=function(n,t){return arguments.length==2?!this.changed&&(typeof this.rowChanged=="undefined"||this.rowChanged==-1)?!0:n==this.rowChanged?!0:this.dataSaveL(t)==r.prototype.SAVE_OK:this.dataSaveL(t)};r.prototype.dataSaveL=function(i){var e,h,c,l,b,f,k,r;if(!this.isOpen)return this.log.warning("Error - Open="+this.isOpen),this.SAVE_ERROR;if(this.rowChanged==-1&&(this.log.config("NoNeed - Changed="+this.changed+", Row="+this.rowChanged),!i))return this.SAVE_OK;if(this.rowData==null)return this.log.fine("No Changes"),this.SAVE_ERROR;if(this.readOnly)return log.warning("IsReadOnly - ignored"),this.dataIgnore(),this.SAVE_ACCESS;if(this.rowChanged==-1)if(this.newRow!=-1)this.rowChanged=this.newRow;else return this.fireDataStatusEEvent("SaveErrorNoChange","",!1),this.SAVE_ERROR;var v=this.getClientOrg(this.rowChanged),y=v[0],p=v[1];if(!n.MRole.canUpdate(y,p,this.AD_Table_ID,0,!0))return this.fireDataStatusEEvent("cant-update"),this.dataIgnore(),this.SAVE_ACCESS;if(e=this.getRow(this.rowChanged),h=this.getMandatory(e),h.length!=0)return this.fireDataStatusEEvent("FillMandatory",h+"\n",!0),this.SAVE_MANDATORY;if(c=this.getErrorColumns(),c.length!=0)return this.fireDataStatusEEvent("Error",c+"\n",!0),this.SAVE_ERROR;l=0;this.inserting||(l=this.getKeyID(this.rowChanged));var w=[],a=this.gridFields,d=a.length;w=this.createGridFieldArr(a);var u=this.createGridFieldArr(a,!0),o={},s={};if(t.extend(!0,o,e),t.extend(!0,s,this.rowData),u&&u.length>0)for(b=u.length,f=0;f<b;f++)o[u[f]]&&(o[u[f]]=this.encrypt(o[u[f]])),s[u[f]]&&(s[u[f]]=this.encrypt(s[u[f]]));return k={Record_ID:l,AD_Table_ID:this.AD_Table_ID,TableName:this.gTable._tableName,Inserting:this.inserting,CompareDB:this.compareDB,RowData:o,OldRowData:s,ManualCmd:i,WhereClause:this.getWhereClause(e),Fields:w,AD_Client_ID:y,AD_Org_ID:p,SelectSQL:this.SQL_Select},r=n.dataContext.insertOrUpdateWRecord(k),r=JSON.parse(r),r.IsError||(t.extend(!0,e,this.readDataOfObject(r.RowData)),this.fireTableModelChanged(n.VTable.prototype.ROW_REFRESH,e,this.rowChanged),this.fireRowChanged(!0,this.getKeyID(this.rowChanged)),this.rowData=null,this.changed=!1,this.compareDB=!0,this.rowChanged=-1,this.newRow=-1,this.inserting=!1),r.ErrorMsg!=null&&this.log.log(n.Logging.Level.SEVERE,r.ErrorMsg),r.FireEEvent?this.fireDataStatusEEvent(r.EventParam.Msg,r.EventParam.Info,r.EventParam.IsError):r.FireIEvent&&this.fireDataStatusIEvent(r.EventParam.Msg,r.EventParam.Info,r.EventParam.IsError),r.Status};r.prototype.createGridFieldArr=function(n,t){var u=n.length,r,i;if(t){if(this.gFieldLessData)return this.gFieldLessData;for(this.gFieldLessData=[],r=0;r<u;r++)i=n[r],i.getIsEncryptedColumn()&&this.gFieldLessData.push(i.getColumnName().toLowerCase());return this.gFieldLessData}if(this.gFieldData)return this.gFieldData;for(this.gFieldData=[],r=0;r<u;r++)i=n[r],this.gFieldData.push({IsVirtualColumn:i.getIsVirtualColumn(),DisplayType:i.getDisplayType(),ColumnName:i.getColumnName(),IsKey:i.getIsKey(),ColumnSQL:i.getColumnSQL(!0),IsEncryptedColumn:i.getIsEncryptedColumn(),IsParentColumn:i.getIsParentColumn()});return this.gFieldData};r.prototype.dataRefreshAll=function(){this.inserting=!1;this.dataIgnore();this.close(!1);this.open(this.maxRows);this.dseEvent="Refreshed"};r.prototype.dataRequery=function(n){return this.close(!1),this.setSelectWhereClause(n),this.rowData=null,this.changed=!1,this.rowChanged=-1,this.inserting=!1,this.open(this.maxRows),this.dseEvent="Refreshed",!0};r.prototype.dataRefresh=function(t){var f,i;if(t<0||this.getRowCount()==0||this.inserting)return null;f=this.getRow(t);this.dataIgnore();i=this.getWhereClause(f);(i==null||i.length==0)&&(i="1=2");var e=this.SQL_Select+" WHERE "+i,u=null,r=null;try{r=n.dataContext.getWindowRecord(e,this.createGridFieldArr(this.gridFields,!0));r.read()&&(u=this.readData(r));u.recid=f.recid}catch(s){return this.log.log(o.SEVERE,e,s),this.fireDataStatusEEvent("RefreshError",e,!0),null}finally{r!=null&&r.dispose()}return this.rowData=null,this.changed=!1,this.rowChanged=-1,this.inserting=!1,this.fireTableModelChanged(n.VTable.prototype.ROW_REFRESH,u),this.fireDataStatusIEvent("Refreshed",""),u};r.prototype.dataNew=function(t,i){var c,s,o,l,h,f,u,e;if(this.log.info("Current="+t+", Copy="+i),this.readOnly)return this.fireDataStatusEEvent("AccessCannotInsert","",!0),!1;if(this.inserting=!0,c=this.gridFields.length,this.rowData={},s={},o=this.gTable._windowNo+n.EnvConstants.WINDOW_TEMP,i)for(l=this.getRow(t),f=0;f<c;f++){var u=this.gridFields[f],r=u.getColumnName(),a=r.toLowerCase();u.getIsVirtualColumn()||(u.getIsKey()||r.equals("AD_Client_ID")||r.equals("IsActive")||r.startsWith("Created")||r.startsWith("Updated")||r.equals("EntityType")||r.equals("DocumentNo")||r.equals("Processed")||r.equals("IsSelfService")||r.equals("DocAction")||r.equals("DocStatus")||r.startsWith("Ref_")||r.equals("Posted")||r.equals("GrandTotal")||r.equals("TotalLines")||r.equals("C_CashLine_ID")||r.equals("C_Payment_ID")||r.equals("IsPaid")||r.equals("IsAllocated")||r.equalsIgnoreCase("C_Location_ID")||r.equals("IsApproved")||r.equals("IsDelivered")||r.equals("IsInvoiced")||r.equals("TotalDr")||r.equals("TotalCr")||r.equalsIgnoreCase("I_IsImported")?(e=u.getDefault(this.ctx,o),s[a]=e,e!=null&&this.ctx.setWindowContext(o,u.getColumnName(),e.toString())):u.getIsCopy()&&(h=l[r.toLowerCase()],s[a]=h,h!=null&&this.ctx.setWindowContext(o,u.getColumnName(),h.toString())))}else for(f=0;f<c;f++)u=this.gridFields[f],e=u.getDefault(this.ctx,o),s[u.getColumnName().toLowerCase()]=e,e!=null&&this.ctx.setWindowContext(o,u.getColumnName(),e.toString());return this.ctx.removeWindow(o),this.changed=!0,this.compareDB=!0,this.newRow=t+1,this.getRowCount()<this.newRow&&(this.newRow=this.getRowCount()),this.rowChanged=this.newRow,this.rowCount++,s.recid=this.rowCount,this.pazeSize++,this.fireTableModelChanged(n.VTable.prototype.ROW_ADD,s,this.newRow),this.fireDataStatusIEvent(i?"UpdateCopied":"Inserted",""),this.log.fine("Current="+this.currentRow+", New="+this.newRow+" - complete"),!0};r.prototype.dataDelete=function(t,i){var f,l,r,s,w;if(!t||t.length<0)return!1;if(this.readOnly)return this.fireDataStatusEEvent("AccessCannotDelete","",!0),!1;if(!this.deleteable)return this.fireDataStatusEEvent("AccessNotDeleteable","",!0),!1;var h=this.gTable._indexKeyColumn!=-1,y=this.gTable._indexProcessedColumn>0&&!this.gTable._tableName.startsWith("I_"),e=[],c=[],a=[],v=[],p=this.AD_Table_ID,u=null;for(f=0;f<t.length;f++){if(u=this.mSortList[t[f]],y&&(l=this.getValueAt(t[f],"processed"),l!=null&&l)){e.push(u.recid);continue}c.push(u.recid);h?a.push(u[this.keyColumnName.toLowerCase()]):v.push(this.getWhereClause(u))}if(r=null,c.length>0)s={RecIds:c,HasKeyColumn:h,TableName:this.gTable._tableName,AD_Table_ID:p},h?s.SingleKeyWhere=a:s.MultiKeyWhere=v,r=n.dataContext.deleteWRecords(s),r=JSON.parse(r);else if(e.length>0)return this.fireDataStatusEEvent("CannotDeleteTrx","",!0),!1;if(r){if(w=null,selIndexOrId=r.UnDeletedRecIds&&r.UnDeletedRecIds.length>0?r.UnDeletedRecIds:e.length>0?e:i,r.DeletedRecIds&&r.DeletedRecIds.length>0&&(this.rowCount-=r.DeletedRecIds.length,this.fireTableModelChanged(n.VTable.prototype.ROW_DELETE,r.DeletedRecIds,selIndexOrId),r.RecIds&&r.RecIds.length>0&&this.fireRowChanged(!1,r.RecIds)),r.ErrorMsg&&this.log.log(o.SEVERE,r.ErrorMsg),r.InfoMsg&&this.log.log(o.Info,r.InfoMsg),r.IsError)return r.FireEEvent&&this.fireDataStatusEEvent(r.EventParam.Msg,r.EventParam.Info,r.EventParam.IsError),!1;this.changed=!1;this.rowChanged=-1;this.fireDataStatusIEvent("Deleted","")}return!0};r.prototype.readData=function(n){var r={},u=this.gridFields.length,t=null,i;try{for(i=0;i<u;i++)t=this.gridFields[i].getColumnName().toLowerCase(),r[t]=this.readDataOfColumn(t,n.getCell(t)),t=null;return r}catch(f){throw f;}};r.prototype.readDataOfObject=function(n){var r={},u=this.gridFields.length,t=null,i;try{for(i=0;i<u;i++)t=this.gridFields[i].getColumnName().toLowerCase(),r[t]=this.readDataOfColumn(t,n[t]),t=null;return r}catch(f){throw f;}};r.prototype.close=function(n){this.isOpen&&(n,!this.inserting,this.bufferList!=null&&(this.bufferList.length=0,this.bufferList=null,this.bufferList=[],this.mSortList=null),this.mSortList!=null&&(this.mSortList=null),n&&this.dispose(),this.isOpen=!1)};r.prototype.dataIgnore=function(){if(this.inserting||this.changed||!(this.rowChanged<0)){if(this.inserting)this.rowCount--,this.pazeSize--,this.changed=!1,this.rowChanged=-1,this.inserting=!1,this.fireTableModelChanged(n.VTable.prototype.ROW_UNDO,this.mSortList[this.newRow].recid,this.newRow);else if(this.rowData!=null){var i=this.getRow(this.rowChanged);t.extend(i,this.rowData)}this.changed=!1;this.rowChanged=-1;this.rowData=null;this.inserting=!1;this.newRow=-1;this.fireDataStatusIEvent("Ignored","")}};r.prototype.createDSE=function(){var t=this.changed,n;return this.rowChanged!=-1&&(t=!0),n=new f(null,this.getRowCount(),t,!1,this.inserting),n.setPageInfo(this.currentPage,this.rowCount,this.pazeSize),n.AD_Table_ID=this.gTable._AD_Table_ID,n.Record_ID=null,n};r.prototype.fireDataStatusChanged=function(n){this.mDataListener&&this.mDataListener.dataStatusChanged(n);n=null};r.prototype.fireTableModelChanged=function(n,t,i,r){this.mCardModelListener&&this.mCardModelListener.tableModelChanged(n,t,i,r);this.mTableModelListener&&this.mTableModelListener.tableModelChanged(n,t,i,r)};r.prototype.fireRowChanged=function(n,t){this.mRowChangedListener&&this.mRowChangedListener.rowChanged(n,t)};r.prototype.fireDataStatusIEvent=function(n,t){var i=this.createDSE();i.setInfo(n,t,!1,!1);this.fireDataStatusChanged(i)};r.prototype.fireQueryCompleted=function(n){this.fireDataStatusIEvent(this.dseEvent);this.mQueryCompletedListener&&this.mQueryCompletedListener.queryCompleted(n);n=null};r.prototype.fireDataStatusEEvent=function(n,t,i){if(arguments.length===1)this.fireDataStatusEEvent(arguments[0].value,arguments[0].name,!0);else{var r=this.createDSE();r.setInfo(n,t,i,!i);this.fireDataStatusChanged(r)}};r.prototype.addDataStatusListener=function(n){this.mDataListener=n};r.prototype.removeDataStatusListener=function(){this.mDataListener=null};r.prototype.addQueryCompleteListner=function(n){this.mQueryCompletedListener=n};r.prototype.removeQueryCompleteListner=function(){this.mQueryCompletedListener=null};r.prototype.addTableModelListener=function(n){this.mTableModelListener=n};r.prototype.removeTableModelListener=function(n){this.mTableModelListener=null;n=null};r.prototype.addCardModelListener=function(n){this.mCardModelListener=n};r.prototype.removeCardModelListener=function(n){this.mCardModelListener=null;n=null};r.prototype.addRowChangedListener=function(n){this.mRowChangedListener=n};r.prototype.removeRowChangedListener=function(n){this.mRowChangedListener=null;n=null};r.prototype.updateTableModel=function(t){var i=t.getColumnName(),r=t.getDisplayType();r==n.DisplayType.Integer||n.DisplayType.IsID(r)&&(i.endsWith("_ID")||i.endsWith("_Acct")||i.endsWith("_ID_1")||i.endsWith("_ID_2")||i.endsWith("_ID_3"))||i.endsWith("atedBy")?this.defaultModel[i.toLowerCase()]=new Number:n.DisplayType.IsNumeric(r)?this.defaultModel[i.toLowerCase()]=new Number:n.DisplayType.IsDate(r)?this.defaultModel[i.toLowerCase()]=new Date:r==n.DisplayType.RowID?(dc=new DataColumn(i,typeof Object),this.defaultModel[i.toLowerCase()]={}):this.defaultModel[i.toLowerCase()]=r==n.DisplayType.YesNo?new Boolean:n.DisplayType.IsLOB(r)?new String:new String};r.prototype.dispose=function(){var n,t;for(originalLength=this.gridFields.length,t=originalLength;t>0;t--)n=this.gridFields.pop(),n.dispose(),n=null;this.gridFields.length=0;this.gTable=null;this.gridFields=null;this.gFieldLessData=null;this.gFieldData=null};u.prototype.PROPERTY="FieldValue";u.prototype.INSERTING="FieldValueInserting";u.prototype.getIsDisplayed=function(t){var u;if(arguments.length==0)return this.vo.IsDisplayedf;if(!this.vo.IsDisplayedf)return!1;if(this.vo.DisplayLogic==null||this.vo.DisplayLogic.equals(""))return!0;if(t){for(var i=!1,r=[],f=[],e=new n.StringTokenizer(this.vo.DisplayLogic,"[]");e.hasMoreTokens();)u=e.nextToken(),u.trim()!=" & ".trim()?(i=n.Evaluator.evaluateLogic(this,u),r.push(i)):f.push(u);return r.length>1&&(f[0].trim().equals("&")?i=r.indexOf(!1)>-1?!1:!0:f[0].trim().equals("|")&&r.indexOf(!0)>-1&&(i=!0)),i}return!0};u.prototype.getIsDisplayedMR=function(t){var u;if(arguments.length==0)return this.vo.IsDisplayedMR;if(!this.vo.IsDisplayedMR)return!1;if(this.vo.DisplayLogic==null||this.vo.DisplayLogic.equals(""))return!0;if(t){for(var i=!1,r=[],f=[],e=new n.StringTokenizer(this.vo.DisplayLogic,"[]");e.hasMoreTokens();)u=e.nextToken(),u.trim()!=" & ".trim()?(i=n.Evaluator.evaluateLogic(this,u),r.push(i)):f.push(u);return r.length>1&&(f[0].trim().equals("&")?i=r.indexOf(!1)>-1?!1:!0:f[0].trim().equals("|")&&r.indexOf(!0)>-1&&(i=!0)),i}return!0};u.prototype.getColumnName=function(){return this.vo.ColumnName};u.prototype.getIsLongField=function(){return this.vo.DisplayLength>=30};u.prototype.getIsMandatory=function(t){var r,i;return t&&this.vo.mandatoryLogic!=null&&this.vo.mandatoryLogic.length>0&&(r=n.Evaluator.evaluateLogic(this,this.vo.mandatoryLogic),r)?!0:!this.vo.IsMandatoryUI||this.getIsVirtualColumn()?!1:(i=this.vo,i.IsKey&&i.ColumnName.endsWith("_ID")||i.ColumnName.startsWith("Created")||i.ColumnName.startsWith("Updated")||i.ColumnName.equals("Value")||i.ColumnName.equals("DocumentNo")||i.ColumnName.equals("M_AttributeSetInstance_ID"))?!1:this.getIsDisplayed(t)};u.prototype.getDisplayType=function(){return this.vo.displayType};u.prototype.getIsVirtualColumn=function(){return this.vo.ColumnSQL&&this.vo.ColumnSQL.length>0?!0:!1};u.prototype.getIsReadOnly=function(){return this.getIsVirtualColumn()?!0:this.vo.IsReadOnly};u.prototype.setReadOnly=function(n){this.vo.IsReadOnly=n};u.prototype.getIsEditable=function(t,i){var r=this.vo,u,s,e,o,h;if(this.getIsVirtualColumn())return!1;if(r.ColumnName.equals("Posted")||r.ColumnName.equals("Record_ID")&&r.displayType==n.DisplayType.Button||r.IsAlwaysUpdateable&&!r.tabReadOnly)return!0;if(r.tabReadOnly||r.IsReadOnly||!r.IsUpdateable&&!this.inserting||r.ColumnName.equals(n.context.getWindowTabContext(r.windowNo,r.tabNo,"LinkColumnName")))return!1;if(u=n.context,t){s=parseInt(u.getWindowTabContext(r.windowNo,r.tabNo,"AD_Client_ID"));r.ColumnName.equals("AD_Org_ID")&&(u.getWindowContext(r.windowNo,"AD_Org_ID")==null||u.getWindowContext(r.windowNo,"AD_Org_ID").length==0)&&u.setWindowContext(r.windowNo,"AD_Org_ID",u.getContext("#AD_Org_ID"));var c=parseInt(u.getWindowTabContext(r.windowNo,r.tabNo,"AD_Org_ID")),f=u.getWindowTabContext(r.windowNo,r.tabNo,"KeyColumnName"),l=r.AD_Window_ID;if(("EntityType".equals(f)&&(f="AD_EntityType_ID"),f.toUpperCase().endsWith("_ID")||(f+="_ID"),e=u.getWindowTabContext(r.windowNo,r.tabNo,f),e==""&&(e=0),o=r.AD_Table_ID,!n.MRole.canUpdate(s,c,o,e,!1)||!n.MRole.getWindowAccess(l))||!n.MRole.getIsColumnAccess(o,this.vo.AD_Column_ID,!1))return!1}return t&&r.ReadOnlyLogic.length>0&&(h=!n.Evaluator.evaluateLogic(this,r.ReadOnlyLogic),!h)?!1:r.ColumnName.equals("Processing")||r.ColumnName.equals("DocAction")||r.ColumnName.equals("GenerateTo")?!0:t&&(u.getWindowContext(r.windowNo,"Processed").equals("Y")||u.getWindowContext(r.windowNo,"Processing").equals("Y"))?!1:r.ColumnName.equals("IsActive")?!0:t&&!u.getWindowContext(r.windowNo,"IsActive").equals("Y")?!1:i?this.getIsDisplayedMR(t):this.getIsDisplayed(t)};u.prototype.getWindowNo=function(){return this.vo.windowNo};u.prototype.getIsHeading=function(){return this.vo.IsHeading};u.prototype.getIsSameLine=function(){return this.vo.IsSameLine};u.prototype.getHeader=function(){return this.vo.Header};u.prototype.getDescription=function(){return this.vo.Description};u.prototype.getHelp=function(){return this.vo.Help};u.prototype.getAD_Process_ID=function(){return this.vo.AD_Process_ID};u.prototype.getAD_Column_ID=function(){return this.vo.AD_Column_ID};u.prototype.getAD_Field_ID=function(){return this.vo.AD_Field_ID};u.prototype.getFieldGroup=function(){return this.vo.FieldGroup};u.prototype.getIsFieldOnly=function(){return this.vo.IsFieldOnly};u.prototype.getIsKey=function(){return this.vo.IsKey};u.prototype.getIsParentColumn=function(){return this.vo.IsParent};u.prototype.getSortNo=function(){return this.vo.SortNo};u.prototype.getMRSeqNo=function(){return this.vo.mrSeqNo};u.prototype.getIsSelectionColumn=function(){return this.vo.IsSelectionColumn};u.prototype.getIsIncludedColumn=function(){return this.vo.IsIncludedColumn};u.prototype.getDependentOn=function(){var t=[],i=this.getColumnName();return i.equals("M_AttributeSetInstance_ID")?t.push("M_Product_ID"):(i.equals("M_Locator_ID")||i.equals("M_LocatorTo_ID"))&&(t.push("M_Product_ID"),t.push("M_Warehouse_ID")),n.Evaluator.parseDepends(t,this.vo.DisplayLogic),n.Evaluator.parseDepends(t,this.vo.ReadOnlyLogic),this.lookup!=null&&n.Evaluator.parseDepends(t,this.lookup.getValidation()),t};u.prototype.getAD_Window_ID=function(){return this.vo.AD_Window_ID};u.prototype.getAD_InfoWindow_ID=function(){return this.vo.AD_InfoWindow_ID};u.prototype.getValueAsString=function(t){return n.context.getWindowContext(this.vo.windowNo,t,!0)};u.prototype.getColumnSQL=function(t){return arguments.length==0?this.vo.ColumnName:this.vo.ColumnSQL!=null&&this.vo.ColumnSQL.length>0?t?(this.vo.displayType==n.DisplayType.YesNo,this.vo.ColumnSQL+" AS "+this.vo.ColumnName):(this.vo.displayType==n.DisplayType.YesNo,this.vo.ColumnSQL):(this.vo.displayType==n.DisplayType.YesNo,this.vo.ColumnName)};u.prototype.getIsLink=function(){return this.vo.isLink};u.prototype.getIsRightPaneLink=function(){return this.vo.isRightPaneLink};u.prototype.getIsAlwaysUpdateable=function(){return this.getIsVirtualColumn()||!this.vo.IsUpdateable?!1:this.vo.IsAlwaysUpdateable};u.prototype.getIsEncryptedField=function(){return this.vo.IsEncryptedField};u.prototype.getIsEncrypted=function(){if(this.vo.IsEncryptedField)return!0;var n=this.getObscureType();return n!=null&&n.length>0?!0:this.vo.ColumnName.equals("Password")};u.prototype.getObscureType=function(){return this.vo.ObscureType};u.prototype.getDisplayLength=function(){return this.vo.DisplayLength};u.prototype.getFieldLength=function(){return this.vo.FieldLength};u.prototype.getVFormat=function(){return this.vo.VFormat};u.prototype.getLookup=function(){return this.lookup};u.prototype.getIsError=function(){return this.error};u.prototype.getIsCopy=function(){return this.vo.IsCopy};u.prototype.getCallout=function(){return this.vo.Callout};u.prototype.getValue=function(){return this.value};u.prototype.getOldValue=function(){return this.oldValue};u.prototype.getIsRange=function(){return this.vo.isRange};u.prototype.getIsParentValue=function(){var i=n.context,t;return this.parentValue!=null?this.parentValue:(n.DisplayType.IsID(this.vo.displayType)&&this.vo.tabNo!=0?(t=i.getWindowTabContext(this.vo.windowNo,this.vo.tabNo,"LinkColumnName"),this.parentValue=t.length==0?!1:this.vo.ColumnName.equals(t),this.parentValue&&this.log.config(this.parentValue+" - Link("+t+", W="+this.vo.windowNo+",T="+this.vo.tabNo+") = "+this.vo.ColumnName)):this.parentValue=!1,this.parentValue)};u.prototype.getDefault=function(t,i){var r=this.vo,l,u,s,y,f,b,k,c,h,g;if(r.IsKey||r.displayType==n.DisplayType.RowID||n.DisplayType.IsLOB(r.displayType))return null;if(this.getIsParentValue()&&n.Utility.Util.isEmpty(r.DefaultValue))return l=t.getWindowContext(r.windowNo,r.ColumnName),this.log.fine("[Parent] "+r.ColumnName+"="+l),this.createDefault(r.ColumnName,l);if(r.ColumnName.equals("IsActive"))return this.log.fine("[IsActive] "+r.ColumnName+"=Y"),!0;if(n.Consts.ACCESSLEVEL_SystemOnly.equals(t.getWindowTabContext(r.windowNo,r.tabNo,"AccessLevel"))&&(r.ColumnName.equals("AD_Client_ID")||r.ColumnName.equals("AD_Org_ID")))return this.log.fine("[SystemAccess] "+r.ColumnName+"=0"),0;if(n.Consts.ACCESSLEVEL_SystemPlusClient.equals(t.getWindowTabContext(r.windowNo,r.tabNo,"AccessLevel"))&&r.ColumnName.equals("AD_Org_ID"))return this.log.fine("[ClientAccess] "+r.ColumnName+"=0"),0;if(u="",r.DefaultValue.startsWith("@SQL=")){var a=r.DefaultValue.substring(5),e=n.Env.parseContext(t,r.windowNo,a,!1,!0),v=e.toUpperCase();if(v.indexOf("DELETE ")!=-1&&v.indexOf("UPDATE ")!=-1&&v.indexOf("DROP ")!=-1&&(e=""),e.equals(""))this.log.log(o.WARNING,"("+r.ColumnName+") - Default SQL variable parse failed: "+a);else{s=null;try{s=n.DB.executeDataReader(e);s.read()?u=s.getString(0):this.log.log(o.WARNING,"("+r.ColumnName+") - no Result: "+e);s.close()}catch(w){e.endsWith("=")?this.log.log(o.SEVERE,"("+r.ColumnName+") "+a,w):this.log.log(o.WARNING,"("+r.ColumnName+") "+e,w)}finally{s!=null&&s.dispose()}}if(u!=null&&u.length>0)return this.log.fine("[SQL] "+r.ColumnName+"="+u),this.createDefault("",u)}if(!r.DefaultValue.equals("")&&!r.DefaultValue.startsWith("@SQL="))for(u="",y=new n.StringTokenizer(r.DefaultValue,",;",!1);y.hasMoreTokens();){if(f=y.nextToken().trim(),f.equals("@SysDate@")||f.equals("@Now@"))return b=new Date,k=b.toISOString(),k;if(u=f.indexOf("@")!=-1?t.getWindowContext(r.windowNo,f.replaceAll("@"," ").trim()):f.startsWith("'")&&f.endsWith("'")?f.length-2>0?f.substring(1,f.length-1):f.replaceAll("'",""):f,u.length>0)return this.log.fine("[DefaultValue] "+r.ColumnName+"="+u),this.createDefault(f,u)}if(this.lookup!=null&&!n.Utility.Util.isEmpty(this.lookup.getValidation())){var nt=this.lookup.getValidation(),d=n.Evaluator.getVariables(nt),p=!1;for(c=0;c<d.length;c++)if(h=d[c],!h.startsWith("#")&&h.toUpperCase().endsWith("_ID")&&!h.equals(r.ColumnName)&&(g=t.getWindowContext(i,h),p=n.Utility.Util.isEmpty(g),p))break;if(p)return this.lookup.clear(),null}return(u=n.Env.getPreference(t,r.AD_Window_ID,r.ColumnName,!1),u!=="")?(this.log.fine("[UserPreference] "+r.ColumnName+"="+u),this.createDefault("",u)):(u=n.Env.getPreference(t,r.AD_Window_ID,r.ColumnName,!0),u!=="")?(this.log.fine("[SystemPreference] "+r.ColumnName+"="+u),this.createDefault("",u)):r.displayType==n.DisplayType.Button&&!r.ColumnName.toUpperCase().endsWith("_ID")?(this.log.fine("[Button=N] "+r.ColumnName),"N"):this.vo.displayType==n.DisplayType.YesNo?(this.log.fine("[YesNo=N] "+r.ColumnName),!1):r.ColumnName.toUpperCase().endsWith("_ID")?(this.log.fine("[ID=null] "+r.ColumnName),null):n.DisplayType.IsNumeric(r.displayType)?(this.log.fine("[Number=0] "+r.ColumnName),this.createDefault("","0")):(this.log.fine("[NONE] "+r.ColumnName),null)};u.prototype.getIsEncryptedColumn=function(){return this.vo.IsEncryptedColumn};u.prototype.getZoomWindow_ID=function(){return this.vo.ZoomWindow_ID};u.prototype.createDefault=function(t,i){var u,r,f,e;if(i==null||i.length==0)return null;try{if(this.vo.ColumnName.endsWith("atedBy")||this.vo.ColumnName.toUpperCase().endsWith("_ID")){try{return(u=parseInt(i),u<0)?null:u}catch(s){this.log.warning("Cannot parse: "+i+" - "+s.message)}return 0}if(this.vo.displayType==n.DisplayType.Integer)return parseInt(i);if(n.DisplayType.IsNumeric(this.vo.displayType))return parseFloat(i);if(n.DisplayType.IsDate(this.vo.displayType)){try{return r=null,isNaN(Number(i))?r=new Date(i):(r=new Date,console.log(this.vo.ColumnName+"==>[1n] "+r),r.setMinutes(-r.getTimezoneOffset()+r.getMinutes()),console.log(this.vo.ColumnName+"==>[3n] "+r.toISOString())),r.toISOString()}catch(c){}f=i+"2014-01-01T01:00:05Z".substring(i.length);try{new Date(f).toISOString()}catch(l){this.log.warning("Cannot convert to Timestamp: "+f)}return(new Date).toISOString()}if(this.vo.displayType==n.DisplayType.YesNo)return"Y".equals(i);if(t.equals("@#Date@"))try{e=new Date(parseInt(i));i=e.toLocaleDateString()}catch(a){}return i}catch(h){this.log.log(o.SEVERE,this.vo.ColumnName+" - "+h.message)}return null};u.prototype.setValue=function(t,i){var e;this.inserting||(this.oldValue=this.value);this.value=t;this.inserting=i;this.error=!1;var r=this.vo,u=n.DisplayType,f=n.context;r.displayType==u.Text||r.displayType==u.Memo||r.displayType==u.TextLong||r.displayType==u.Binary||r.displayType==u.RowID||this.getIsEncrypted()||(t=="undefined"||t==null?f.setWindowContext(r.windowNo,r.ColumnName,null):typeof t==typeof Boolean||r.displayType==u.YesNo?t.toString()=="Y"||t.toString()=="N"?f.setWindowContext(r.windowNo,r.ColumnName,t.toString()):f.setWindowContext(r.windowNo,r.ColumnName,t.toString().toLowerCase()=="true"?"Y":"N"):typeof t==typeof date||u.IsDate(r.displayType)?f.setWindowContext(r.windowNo,r.ColumnName,t):f.setWindowContext(r.windowNo,r.ColumnName,t==null?null:t.toString()));e=this.oldValue;i&&(e=this.INSERTING);(e!==t||this.forcefirepropchange)&&this.propertyChangeListner&&this.propertyChangeListner.setValue(t,i);this.forcefirepropchange=this.inserting||r.displayType==u.YesNo};u.prototype.setNullValue=function(){this.valueNoFire&&(this.oldValue=this.value);this.value=null;this.inserting=!1;this.error=!1;this.oldValue!==this.value&&this.propertyChangeListner&&this.propertyChangeListner.setValue(this.value)};u.prototype.setPropertyChangeListener=function(n){this.propertyChangeListner=n};u.prototype.setError=function(n){this.error=n};u.prototype.setInserting=function(n){this.inserting=n};u.prototype.getAD_Reference_Value_ID=function(){return this.vo.AD_Reference_Value_ID};u.prototype.setDisplayType=function(n){this.vo.displayType=n};u.prototype.setDisplayLength=function(n){this.vo.DisplayLength=n};u.prototype.setDisplayed=function(n){this.vo.IsDisplayedf=n};u.prototype.setValueNoFire=function(n){this.valueNoFire=n};u.prototype.refreshLookup=function(){return!this.lookup||this.lookup.getValidation().length==0?!0:(this.lookup.refresh(),this.lookup.getIsValidated())};u.prototype.dispose=function(){this.lookup!=null&&(this.lookup.dispose(),this.lookup=null);this.gfield=null;this.vo=null;this.propertyChangeListner=null};f.prototype.setLoading=function(n){this.m_allLoaded=!1;this.m_loadedRows=n};f.prototype.getIsLoading=function(){return!this.m_allLoaded};f.prototype.getLoadedRows=function(){return this.m_loadedRows};f.prototype.setCurrentRow=function(n){this.m_currentRow=n};f.prototype.setCurrentPage=function(n){this.mCurrentPage=n};f.prototype.getCurrentRow=function(){return this.m_currentRow};f.prototype.getTotalRows=function(){return this.m_totalRows};f.prototype.getTotalRecords=function(){return this.totalRecords};f.prototype.getCurrentPage=function(){return this.mCurrentPage};f.prototype.getTotalPage=function(){return this.mTotalPage};f.prototype.getPageSize=function(){return this.mPageSize};f.prototype.setInfo=function(n,t,i,r){this.m_AD_Message=n;this.m_info=t;this.m_isError=i;this.m_isWarning=r};f.prototype.setPageInfo=function(n,t,i){this.mCurrentPage=n;this.mPageSize=i;t<1||t<i?(this.mcurrentPage=1,this.mTotalPage=1):this.mTotalPage=i==0?1:Math.ceil(t/i);this.totalRecords=t};f.prototype.setInserting=function(n){this.m_inserting=n};f.prototype.getIsInserting=function(){return this.m_inserting};f.prototype.getAD_Message=function(){return this.m_AD_Message};f.prototype.getInfo=function(){return this.m_info};f.prototype.getIsError=function(){return this.m_isError};f.prototype.getIsWarning=function(){return this.m_isWarning};f.prototype.getMessage=function(){var n=new StringBuilder;return this.m_inserting&&n.append("+"),n.append(this.m_changed?this.m_autoSave?"*":"?":" "),this.m_totalRows==0?n.append(this.m_currentRow):n.append(this.m_currentRow+1),n.append("/"),this.m_allLoaded?n.append(this.m_totalRows):n.append(this.m_loadedRows).append("->").append(this.m_totalRows),n.toString()};f.prototype.getIsChanged=function(){return this.m_changed};f.prototype.getIsFirstRow=function(){return this.m_totalRows==0?!0:this.m_currentRow==0};f.prototype.getIsLastRow=function(){return this.m_totalRows==0?!0:this.m_currentRow==this.m_totalRows-1};f.prototype.getIsFirstPage=function(){return this.mTotalPage<2?!0:this.mCurrentPage<2};f.prototype.getIsLastPage=function(){return this.mTotalPage<2?!0:this.mCurrentPage>=this.mTotalPage};f.prototype.setChangedColumn=function(n,t){this.m_changedColumn=n;this.m_columnName=t};f.prototype.getChangedColumn=function(){return this.m_changedColumn};f.prototype.getColumnName=function(){return this.m_columnName};f.prototype.setConfirmed=function(n){this.m_confirmed=n};f.prototype.getIsConfirmed=function(){return this.m_confirmed};n.GridWindow=e;n.GridTab=i;n.GridTable=r;n.GridField=u}(VIS,jQuery),function(n,t){function i(i){function e(){r=t("<div class='vis-height-full'>");u=t("<div class='vis-apanel-busy'>");f=t("<div class='vis-height-full'>");r.append(f).append(u)}this.$parent;this.mPanel;this.ctx=n.Env.getCtx();this.log=n.Logging.VLogger.getVLogger("VIS.AForm");var r,u,f;e();this.setSize=function(n){r.height(n);f.height(n)};this.setSize(i);this.getRoot=function(){return r};this.getContentGrid=function(){return f};this.setBusy=function(n,t){isLocked=n;n?u[0].style.visibility="visible":(u[0].style.visibility="hidden",t)};this.disposeComponent=function(){r.remove();r=null;f.remove();f=null;u.remove();u=null;this.$parentWindow=null;this.ctx=null;this.getRoot=null;this.getContentGrid=null;this.setBusy=null;this.setSize=null}}i.prototype.openForm=function(t,i,r){var u,e,f;if(t.IsReport)return n.ADialog.info("Form Report is not supported"),!1;this.parent=i;u="";u=t.Prefix+t.ClassName;console.log(u);this.log.info("Form Name= "+t.Name+", Class="+u);this.ctx.setWindowContext(r,"WindowName",t.DisplayName);try{e=n.Utility.getFunctionByName(u,window);f=new e(r);f.init(r,this);this.mPanel=f;f=null}catch(o){return this.log.log(n.Logging.Level.WARNING,"Class="+u+", AD_Form Name="+t.Name,o),!1}return this.setBusy(!1),this.windowNo=r,this.setTitle(n.Env.getHeader(this.ctx,r)),this.parent.setName(t.DisplayName),i=null,!0};i.prototype.setTitle=function(t){this.parent&&this.parent.setTitle(n.Utility.Util.cleanMnemonic(t))};i.prototype.hideHeader=function(n){this.parent&&this.parent.hideHeader(n)};i.prototype.sizeChanged=function(n,t){this.setSize(n);this.mPanel&&this.mPanel.sizeChanged&&this.mPanel.sizeChanged(n,t)};i.prototype.refresh=function(){this.mPanel&&this.mPanel.refresh&&this.mPanel.refresh()};i.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.mPanel&&(this.mPanel.disposeComponent&&this.mPanel.dispose(),this.mPanel=null),this.parent&&(this.parent.dispose(),this.parent=null),n.Env.clearWinContext(this.ctx,this.windowNo),this.disposeComponent())};n.AForm=i}(VIS,jQuery),function(n,t){function i(i){function l(){e=t("<div style='position:relative;'>");u=t("<div class='vis-apanel-busy'>");h=t("<table  class='vis-process-table'>");h.height(i);u.height(i);f=t("<td>");h.append(t("<tr>").append(f));e.append(h).append(u);o=t("<button class='vis-button-ok'>").text(n.Msg.getMsg("OK"));s=t("<button class='vis-button-close'>").text(n.Msg.getMsg("Close"));c=t("<span>").val("asassasasasasaasa");f.append(c);f.append(o).append(s)}var e,u,f,h,o,s,c,r;this.parent;this.mPanel;this.ctx=n.Env.getCtx();this.isLocked=!1;this.log=n.Logging.VLogger.getVLogger("VIS.AProcess");this.isComplete=!1;this.jpObj=null;l();this.setSize=function(n){e&&(e.height(n),u.height(n),f.height(n))};this.setSize(i);this.getRoot=function(){return e};this.getContentGrid=function(){return f};this.setBusy=function(n,t){isLocked=n;n?u[0].style.visibility="visible":(u[0].style.visibility="hidden",t)};this.setMsg=function(n){c.append(n)};r=this;o.on(n.Events.onTouchStartOrClick,function(){var t,i;if(r.isComplete){r.dispose();return}t=new n.ProcessInfo(r.jpObj.Name,r.jpObj.AD_Process_ID,0,0);t.setAD_User_ID(r.ctx.getAD_User_ID());t.setAD_Client_ID(r.ctx.getAD_Client_ID());i=new n.ProcessCtl(r,t,null);i.process(r.windowNo);i=null});s.on(n.Events.onTouchStartOrClick,function(){r.parent.dispose()});this.disposeComponent=function(){o&&o.off(n.Events.onTouchStartOrClick);s&&s.off(n.Events.onTouchStartOrClick);e&&e.remove();e=null;f&&f.remove();f=null;u&&u.remove();u=null;o=s=c=null;this.$parentWindow=null;this.isComplete=!1;this.jpObj=null;r=null}}i.prototype.init=function(t,i,r){return t.Name==null||t.Name==""?(n.ADialog.info("Process Name is empty"),fasle):(this.ctx.setWindowContext(r,"IsSOTrx",t.IsSOTrx),i.getContentGrid().append(this.getRoot()),this.setMsg(t.MessageText),this.setBusy(!1),this.parent=i,this.jpObj=t,this.windowNo=r,!0)};i.prototype.setTitle=function(t){this.parent&&this.parent.setTitle(n.Utility.Util.cleanMnemonic(t))};i.prototype.lockUI=function(){this.isLocked=!0;this.setBusy(!0)};i.prototype.unlockUI=function(t){n.ProcessInfoUtil.setLogFromDB(t);var i="";i='<p><font color="'+(t.getIsError()?"#FF0000":"#0000FF")+'">** '+t.getSummary()+"<\/font><\/p>";i+=t.getLogInfo(!0);this.setMsg(i);console.log(i);this.isComplete=!0;this.setBusy(!1);this.isLocked=!1};i.prototype.getIsUILocked=function(){return this.isLocked};i.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.mPanel&&(this.mPanel.dispose(),this.mPanel=null),this.parent&&(this.parent.dispose(),this.parent=null),n.Env.clearWinContext(this.ctx,this.windowNo),this.disposeComponent())};i.prototype.showReport=function(i,r,u,f,e,o,s){var y=null,b=null,ut=null,c=null,nt=null,k=null,p=null,w=null,ft=null,et=null,d=null,wt=t("<div>"),a=t("<ul class='vis-apanel-rb-ul'>"),it,rt,ht,ct,lt,at,dt,pt;wt.append(a);var g=null,ot=null,h=null,gt=null,st=null,tt=null,bt=null,vt=!1,l=[],ni=null;tt=o;st=e;h=u;gt=f;vt=n.MRole.getDefault().getIsCanExport(tt);this.mPanel&&(this.mPanel.dispose(),this.mPanel=null);this.disposeComponent();this.mPanel=i;ot=this.parent;g=i;bt=n.DB.executeScalar("SELECT TableName FROM AD_Table WHERE AD_Table_ID="+tt);a.empty();var ti=n.MRole.getDefault().addAccessSQL("SELECT AD_PrintFormat_ID, Name, Description,IsDefault FROM AD_PrintFormat WHERE AD_Table_ID= "+tt+" ORDER BY Name","AD_PrintFormat",n.MRole.SQL_NOTQUALIFIED,n.MRole.SQL_RO),v=null,kt=[],yt=-1;l=[];try{for(v=n.DB.executeReader(ti,null,null);v.read();)yt=parseInt(yt)+1,it=v.getString(1),kt.indexOf(it)>-1&&(it=it+"_"+(parseInt(yt)+1)),rt={},rt.ID=n.Utility.Util.getValueOfInt(v.get(0)),rt.Name=it,rt.IsDefault=v.getString(3),kt.push(v.getString(1)),l.push(rt);v.close()}catch(ii){v.close()}v=null;a.append(t('<li data-id="-1">').append(n.Msg.getMsg("NewReport")));i.getRoot().height(this.parent.getContentGrid().height());y=t("<div class='vis-report-header'>").append(t('<h3 class="vis-report-tittle" style="float:left;padding-top: 10px;">').append(n.Msg.getMsg("Report")));b=t('<a href="javascript:void(0)" class="vis-mainMenuIcons vis-icon-menuclose" style="float:right">');ut=t('<div class="vis-report-top-icons" style="float:right;">');c=t('<ul style="margin-top: 10px;">');ut.append(c);d=t("<li><a style='cursor:pointer;' class='vis-report-icon vis-repformat-ico'><\/a><\/li>");c.append(d);vt&&(ft=t("<li><a style='cursor:pointer;' class='vis-report-icon vis-savecsv-ico'><\/a><\/li>"),c.append(ft),et=t("<li><a style='cursor:pointer;' class='vis-report-icon vis-savepdf-ico'><\/a><\/li>"),c.append(et));nt=t("<li><a style='cursor:pointer;' class='vis-report-icon vis-archive-ico'><\/a><\/li>");c.append(nt);k=t("<li><a style='cursor:pointer;' class='vis-report-icon vis-requery-ico'><\/a><\/li>");c.append(k);p=t("<li><a style='cursor:pointer;' class='vis-report-icon vis-customize-ico'><\/a><\/li>");c.append(p);w=t('<li><a style="cursor:pointer;" class="vis-report-icon vis-print-ico"><\/a><\/li>');c.append(w);s&&(w.css("display","none"),p.css("display","none"),d.css("display","none"));y.append(b);y.append(ut);i.getRoot().css("width",t(window).width());this.parent.getContentGrid().append(y).append(i.getRoot());try{if(ht=document.getElementsByClassName("vis-reptabledetect"),ht.length>0){for(ct=0,lt=0,at=0,dt=ht.length;at<dt;at++)lt=t(ht[at]).width(),lt>ct&&(ct=lt);i.getRightDiv().width(t(window).width()-10);i.getRightInnerDiv().width(ct+50)}}catch(ii){}pt=function(){b.off("click");k.off("click");p.off("click");w.off("click");d.off("click");a.off("click");nt.off("click");b.on("click",function(){g&&(g.dispose(),g=null);ot&&(ot.dispose(),ot=null);h.pi&&h.pi.dispose();h.pi=null;c.empty();y.empty();y.remove();b.off("click");k.off("click");p.off("click");w.off("click");d.off("click");a.off("click");y=null;b=null;ut=null;c=null;nt=null;k=null;p=null;w=null;ft=null;et=null;pt=null});k.on("click",function(){i.setBusy(!0);i.getRightInnerDiv().html("");i.getRightInnerDiv().width(0);var r={AD_Process_ID:h.pi.getAD_Process_ID(),AD_PInstance_ID:h.pi.getAD_PInstance_ID(),Name:h.pi.getTitle(),AD_Table_ID:h.pi.getTable_ID(),Record_ID:h.pi.getRecord_ID(),ParameterList:st,csv:!1,pdf:!1};n.dataContext.executeProcess(r,function(n){var u,f,r,e,o,s;if(n.error!=null){h.pi.setSummary(n.error,!0);h.unlock();h=null;return}if(u=JSON.parse(n.result),u.IsError){h.pi.setSummary(u.Message,!0);h.unlock();h=null;return}try{if(i.getRightInnerDiv().html(u.HTML),f=document.getElementsByClassName("vis-reptabledetect"),f.length>0){for(r=0,e=0,o=0,s=f.length;o<s;o++)e=t(f[o]).width(),e>r&&(r=e);i.getRightDiv().width(t(window).width()-10);i.getRightDiv().css("min-width",t(window).width()+"px");i.getRightInnerDiv().width(r+50)}i.getRightInnerDiv().width(r)}catch(c){}i.setBusy(!1)})});p.on("click",function(){var t=new n.Query;t.addRestriction("AD_PrintFormat_ID",n.Query.prototype.EQUAL,r);n.viewManager.startWindow(240,t)});w.on("click",function(){if(g.getIsHtmlReport()){var n=window.open();n.document.write("<html><head>");n.document.write("<\/head><body >");n.document.write(g.getHtml());n.document.write("<\/body><\/html>");n.print();n.close()}});if(vt){ft.on("click",function(){i.setBusy(!0);var t={AD_Process_ID:h.pi.getAD_Process_ID(),AD_PInstance_ID:h.pi.getAD_PInstance_ID(),Name:h.pi.getTitle(),AD_Table_ID:h.pi.getTable_ID(),Record_ID:h.pi.getRecord_ID(),ParameterList:st,csv:!0,pdf:!1};n.dataContext.executeProcess(t,function(t){if(t.error!=null){h.pi.setSummary(t.error,!0);h.unlock();h=null;return}var r=JSON.parse(t.result);if(r.IsError){h.pi.setSummary(r.Message,!0);h.unlock();h=null;return}window.open(n.Application.contextUrl+r.ReportFilePath);i.setBusy(!1)})});et.on("click",function(){i.setBusy(!0);var t={AD_Process_ID:h.pi.getAD_Process_ID(),AD_PInstance_ID:h.pi.getAD_PInstance_ID(),Name:h.pi.getTitle(),AD_Table_ID:h.pi.getTable_ID(),Record_ID:h.pi.getRecord_ID(),ParameterList:st,csv:!1,pdf:!0};n.dataContext.executeProcess(t,function(t){if(t.error!=null){h.pi.setSummary(t.error,!0);h.unlock();h=null;return}var r=JSON.parse(t.result);if(r.IsError){h.pi.setSummary(r.Message,!0);h.unlock();h=null;return}window.open(n.Application.contextUrl+r.ReportFilePath);i.setBusy(!1)})})}d.on("click",function(){var i,u,r;for(a.empty(),i=0;i<l.length;i++)u=l[i].IsDefault=="Y"?"vis-mainfavitem":"vis-mainnonfavitem",r=t('<li><a data-isdefbtn="no" data-id="'+l[i].ID+'">'+l[i].Name+"<\/a><\/li>"),a.append(r);a.append(t('<li><a data-id="-1">'+n.Msg.getMsg("NewReport")+"<\/a>"));t(this).w2overlay(wt.clone(!0),{css:{height:"300px"}})});a.on("click","LI",function(u){var a,f,e,o,v,s,c;if(i.setBusy(!0),a=t(u.target),f=a.data("id"),a.data("isdefbtn")=="yes"){for(e="UPDATE AD_PrintFormat SET IsDefault='N' WHERE IsDefault='Y' AND AD_Table_ID="+Ad_Table_ID+" AND AD_Tab_ID="+curTab.getAD_Tab_ID(),n.DB.executeQuery(e),e="UPDATE AD_PrintFormat SET IsDefault='Y' WHERE AD_PrintFormat_ID="+f,n.DB.executeQuery(e),o=0;o<l.length;o++)l[o].IsDefault=l[o].ID==f?"Y":"N";return}r=f;v=!1;f==-1&&(f=tt,v=!0);s=[];c=new n.Query(bt);s.push(c.getTableName());s.push(c.getWhereClause(!0));t.ajax({url:n.Application.contextUrl+"JsonData/GenerateReport/",dataType:"json",data:{id:f,queryInfo:JSON.stringify(s),code:c.getCode(0),isCreateNew:v,nProcessInfo:JSON.stringify(""),pdf:!1,csv:!1},success:function(n){var o=jQuery.parseJSON(n),u,r,f,e,s;if(o.IsError){h.pi.setSummary(o.Message,!0);h.unlock();h=null;return}try{if(i.getRightInnerDiv().html(o.HTML),u=document.getElementsByClassName("vis-reptabledetect"),u.length>0){for(r=0,f=0,e=0,s=u.length;e<s;e++)f=t(u[e]).width(),f>r&&(r=f);i.getRightDiv().width(t(window).width()-10);i.getRightInnerDiv().width(r+50)}i.getRightInnerDiv().width(r)}catch(c){}i.setBusy(!1)}})});nt.on("click",function(){i.setBusy(!0);t.ajax({url:n.Application.contextUrl+"JsonData/ArchiveDoc/",dataType:"json",type:"post",data:{AD_Process_ID:h.pi.getAD_Process_ID(),Name:h.pi.getTitle(),AD_Table_ID:h.pi.getTable_ID(),Record_ID:h.pi.getRecord_ID(),C_BPartner_ID:0,isReport:!0,binaryData:ni},success:function(){n.ADialog.info("Archived",!0,"","");i.setBusy(!1)}})})};pt();i.setBusy(!1);this.parent.hideHeader(!0)};i.prototype.setReportBytes=function(n){reportBytes=n};i.prototype.sizeChanged=function(n,t){this.setSize(n,t);this.mPanel&&this.mPanel.sizeChanged&&this.mPanel.sizeChanged(n,t)};i.prototype.refresh=function(){this.mPanel&&this.mPanel.refresh&&this.mPanel.refresh()};n.AProcess=i}(VIS,jQuery),function(n,t){function i(n,t){this.parent=n;this.pi=t;this.windowNo;this.paraList=null;this.isPdf=!1;this.isCsv=!1}function r(i,r,u){function h(){e=t("<div class='vis-height-full'>");f=t("<div class='vis-height-full' style='overflow:auto;background: #63BFE9;'>");$innerRightDiv=t("<div class='vis-height-full' style='padding:5px;'>");e.append(f);u?(f.append($innerRightDiv),f.append(s),$innerRightDiv.html(i)):(o=t("<iframe style = 'width:100%;height:99.4%;' pluginspage='http://www.adobe.com/products/acrobat/readstep2.html'>"),o.attr("src",n.Application.contextUrl+i),f.css("height","100%"),f.css("width","100%"),f.append(s),f.append(o))}this.bytes=null;this.RptFileName=i;this.Pi=r;var e=null,f=null;$innerRightDiv=null;var o=null,s=t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>");h();this.getRoot=function(){return e};this.getRightDiv=function(){return f};this.getRightInnerDiv=function(){return $innerRightDiv};this.getIsHtmlReport=function(){return u};this.getHtml=function(){return i};this.disposeComponent=function(){e!=null&&(e.remove(),e=null)};this.setBusy=function(n){s.css("display",n?"block":"none")}}i.prototype.setIsPdf=function(n){this.isPdf=n};i.prototype.setIsCsv=function(n){this.isCsv=n};i.prototype.process=function(t){this.lock();this.windowNo=t;var i=this,r={AD_Process_ID:this.pi.getAD_Process_ID(),Name:this.pi.getTitle(),AD_Table_ID:this.pi.getTable_ID(),Record_ID:this.pi.getRecord_ID(),WindowNo:t,csv:this.isCsv,pdf:this.isPdf};n.dataContext.process(r,function(n){if(n.error!=null){i.pi.setSummary(n.error,!0);i.unlock();i=null;return}var t=JSON.parse(n.result);if(t.IsError){i.pi.setSummary(t.Message,!0);i.unlock();i=null;return}i.complete(t);i=null})};i.prototype.complete=function(t){var i,r;if(t.ShowParameter){this.pi.setAD_PInstance_ID(t.AD_PInstance_ID);try{i=new n.ProcessParameter(this.pi,this,this.windowNo);i.initDialog(t.ProcessFields);i.showDialog();i=null}catch(u){this.pi.setSummary(u.message,!0)}this.unlock()}else this.pi.dispose(),this.pi=this.pi.fromJson(t.ReportProcessInfo),this.unlock(),t.HTML&&t.HTML.length>0?this.parent&&(t.AskForNewTab?n.ADialog.ask("VIS_OpenNewTab")&&window.open(n.Application.contextUrl+t.ReportFilePath):(this.parent.setReportBytes(t.Report),this.parent.showReport(new n.PdfViewer(t.HTML,null,!0),t.AD_PrintFormat_ID,this,this.windowNo,this.paraList,t.AD_Table_ID,!1))):t.ReportFilePath&&t.ReportFilePath.length>0&&(r=/ipad|iphone|ipod|mobile|android|blackberry|webos|windows phone/i.test(navigator.userAgent.toLowerCase()),r?window.open(n.Application.contextUrl+t.ReportFilePath):this.parent.setReportBytes?(this.parent.setReportBytes(t.Report),this.parent.showReport(new n.PdfViewer(t.ReportFilePath),t.AD_PrintFormat_ID,this,this.windowNo,this.paraList,t.AD_Table_ID,!0)):window.open(n.Application.contextUrl+t.ReportFilePath)),this.dispose()};i.prototype.onProcessDialogClosed=function(t,i){if(t){this.paraList=i;this.lock();var r=this,u={AD_Process_ID:this.pi.getAD_Process_ID(),AD_PInstance_ID:this.pi.getAD_PInstance_ID(),Name:this.pi.getTitle(),AD_Table_ID:this.pi.getTable_ID(),Record_ID:this.pi.getRecord_ID(),ParameterList:i,csv:this.isCsv,pdf:this.isPdf};n.dataContext.executeProcess(u,function(n){if(n.error!=null){r.pi.setSummary(n.error,!0);r.unlock();r=null;return}var t=JSON.parse(n.result);if(t.IsError){r.pi.setSummary(t.Message,!0);r.unlock();r=null;return}r.complete(t);r=null})}};i.prototype.unlock=function(){var t=this.pi.getSummary();t!=null&&t.indexOf("@")!=-1&&this.pi.setSummary(n.Msg.parseTranslation(n.Env.getCtx(),t));this.parent&&this.parent.unlockUI(this.pi)};i.prototype.lock=function(){this.parent&&this.parent.lockUI(this.pi)};i.prototype.dispose=function(){this.parent=null};r.prototype.dispose=function(){this.disposeComponent()};n.PdfViewer=r;n.ProcessCtl=i}(VIS,jQuery),function(n){function t(n,t,i,r){this.title=n;this.AD_Process_ID=t;this.table_ID=i;this.tableName;this.record_ID=r;this.AD_User_ID;this.AD_Client_ID;this.className=null;this.AD_PInstance_ID=0;this.summary="";this.error=!1;this.batch=!1;this.timeout=!1;this.parameter=null;this.AD_PrintFormat_Table_ID=0;this.AD_PrintFormat_ID=0;this.isReportFormat=!1;this.isCrystal=!1;this.totalrecords=0}function i(n,t,i,r,u){this.P_ID;this.P_Date;this.P_Number;this.P_Msg;n?this.setLog_ID(n):this.setLog_ID(this.Log_ID++);this.setP_ID(t);this.setP_Date(i);this.setP_Number(r);this.setP_Msg(u)}t.prototype.toJson=function(){return{Title:this.title,Process_ID:this.AD_Process_ID,AD_PInstance_ID:this.AD_PInstance_ID,Record_ID:this.record_ID,Error:this.error,Summary:this.getSummary(),ClassName:this.className,AD_Table_ID:this.table_ID,AD_TableName:this.tableName,AD_User_ID:this.AD_User_ID,AD_Client_ID:this.AD_Client_ID,Batch:this.batch,TimeOut:this.timeout,AD_PrintFormat_Table_ID:this.AD_PrintFormat_Table_ID,AD_PrintFormat_ID:this.AD_PrintFormat_ID}};t.prototype.fromJson=function(n){var i=null;return this instanceof t?(this.title=n.Title,this.AD_Process_ID=n.Process_ID,this.className=n.ClassName,this.record_ID=n.Record_ID,this.error=n.Error,this.AD_PInstance_ID=n.AD_PInstance_ID,this.summary=n.Summary,this.table_ID=n.AD_Table_ID,this.tableName=n.AD_TableName,this.AD_User_ID=n.AD_User_ID,this.AD_Client_ID=n.AD_Client_ID,this.batch=n.Batch,this.timeout=n.TimeOut,this.AD_PrintFormat_Table_ID=n.AD_PrintFormat_Table_ID,this.AD_PrintFormat_ID=n.AD_PrintFormat_ID,this.isCrystal=n.IsCrystal,this.isReportFormat=n.IsReportFormat,this.totalrecords=n.TotalRecords,i=this):(i=new t(n.Title,n.Process_ID),i.className=n.ClassName,i.record_ID=n.Record_ID,i.error=n.Error,i.AD_PInstance_ID=n.AD_PInstance_ID,i.summary=n.Summary,i.table_ID=n.AD_Table_ID,i.tableName=n.AD_TableName,i.AD_User_ID=n.AD_User_ID,i.AD_Client_ID=n.AD_Client_ID,i.batch=n.Batch,i.timeout=n.TimeOut,i.AD_PrintFormat_Table_ID=n.AD_PrintFormat_Table_ID,i.AD_PrintFormat_ID=n.AD_PrintFormat_ID,i.isCrystal=n.IsCrystal,i.isReportFormat=n.IsReportFormat,i.totalrecords=Convert.ToInt32(TotalRecords)),i};t.prototype.setError=function(n){this.error=n};t.prototype.getIsError=function(){return this.error};t.prototype.getIsBatch=function(){return this.batch};t.prototype.setIsBatch=function(n){this.batch=n};t.prototype.getAD_PInstance_ID=function(){return this.AD_PInstance_ID};t.prototype.setAD_PInstance_ID=function(n){this.AD_PInstance_ID=n};t.prototype.getAD_Process_ID=function(){return this.AD_Process_ID};t.prototype.setAD_Process_ID=function(n){this.AD_Process_ID=n};t.prototype.getClassName=function(){return this.className};t.prototype.setClassName=function(n){this.className=n;n!=null&&n.length==0&&(this.className=null)};t.prototype.getTable_ID=function(){return this.table_ID};t.prototype.setTable_ID=function(n){this.table_ID=n};t.prototype.setTable_Name=function(n){this.tableName=n};t.prototype.getTable_Name=function(){return this.tableName};t.prototype.getRecord_ID=function(){return this.record_ID};t.prototype.setRecord_ID=function(n){this.record_ID=n};t.prototype.getTitle=function(){return this.title};t.prototype.setTitle=function(n){this.title=n};t.prototype.setAD_Client_ID=function(n){this.AD_Client_ID=n};t.prototype.getAD_Client_ID=function(){return this.AD_Client_ID};t.prototype.setAD_User_ID=function(n){this.AD_User_ID=n};t.prototype.getAD_User_ID=function(){return this.AD_User_ID};t.prototype.getParameter=function(){return this.parameter};t.prototype.setParameter=function(n){this.parameter=n};t.prototype.setIsTimeout=function(n){this.timeout=n};t.prototype.getIsTimeout=function(){return this.timeout};t.prototype.set_AD_PrintFormat_Table_ID=function(n){this.AD_PrintFormat_Table_ID=n};t.prototype.get_AD_PrintFormat_Table_ID=function(){return this.AD_PrintFormat_Table_ID};t.prototype.set_AD_PrintFormat_ID=function(n){this.AD_PrintFormat_ID=n};t.prototype.Get_AD_PrintFormat_ID=function(){return this.AD_PrintFormat_ID};t.prototype.setIsCrystal=function(n){this.isCrystal=n};t.prototype.getIsCrystal=function(){return this.isCrystal};t.prototype.setIsReportFormat=function(n){this.isReportFormat=n};t.prototype.getIsReportFormat=function(){return this.isReportFormat};t.prototype.gGetTotalRecord=function(){return this.totalrecords};t.prototype.setSummary=function(n,t){arguments.length==2&&this.setError(t);this.summary=n};t.prototype.getSummary=function(){return this.summary};t.prototype.addLog=function(n,t,r,u,f){return this.addLogEntry(new i(n,t,r,u,f))};t.prototype.addLogEntry=function(n){var r,t,i,u;if(n==null)return null;for(this.logs==null&&(this.logs=[]),r=n.getLog_ID(),t=0;t<this.logs.length;t++)if(i=this.logs[t],u=i.getLog_ID(),r==u)return i;return this.logs.push(n),n};t.prototype.getLogInfo=function(t){var i,u,r,s;if(this.logs==null)return"";i=new StringBuilder;t&&i.append('<table width="100%" border="1" cellspacing="0" cellpadding="2">');var f=!1,e=!1,o=!1;for(u=0;u<this.logs.length;u++)r=this.logs[u],r.getP_Date()!=null&&(f=!0),r.getP_Number()!=null&&(e=!0),r.getP_Msg()!=null&&(o=!0);for(u=0;u<this.logs.length;u++)t?i.append("<tr>"):u>0&&i.append("\n"),r=this.logs[u],r.getP_Date()!=null?(i.append(t?"<td>":""),s=r.getP_Date(),i.append(t?"<\/td>":" \t")):f&&i.append(t?"<td>&nbsp;<\/td>":" \t"),r.getP_Number()!=null?i.append(t?"<td>":"").append(r.getP_Number()).append(t?"<\/td>":" \t"):e&&i.append(t?"<td>&nbsp;<\/td>":" \t"),r.getP_Msg()!=null?i.append(t?"<td>":"").append(n.Msg.parseTranslation(n.Env.getCtx(),r.getP_Msg())).append(t?"<\/td>":""):o&&i.append(t?"<td>&nbsp;<\/td>":""),t&&i.append("<\/tr>");return t&&i.append("<\/table>"),i.toString()};t.prototype.dispose=function(){this.title=null;this.AD_Process_ID=null;this.table_ID=null;this.tableName=null;this.record_ID=null;this.AD_User_ID=null;this.AD_Client_ID==null;this.className=null;this.AD_PInstance_ID=null;this.summary=null;this.error=null;this.batch=null;this.timeout=null;this.parameter=null;this.AD_PrintFormat_Table_ID=null;this.AD_PrintFormat_ID=null;this.isReportFormat=null;this.isCrystal=null;this.totalrecords=null};n.ProcessInfoUtil={setLogFromDB:function(t){var r="SELECT Log_ID, P_ID, P_Date, P_Number, P_Msg FROM AD_PInstance_Log WHERE AD_PInstance_ID= "+t.getAD_PInstance_ID()+" ORDER BY Log_ID",i=null;try{for(i=n.DB.executeDataReader(r);i.read();)t.addLog(i.getInt(0),i.getInt(1),i.getDateTime(2),i.getDecimal(3),i.getString(4))}catch(u){console.log(u)}finally{i&&i.dispose()}}};i.prototype.Log_ID=0;i.prototype.getLog_ID=function(){return this.Log_ID};i.prototype.setLog_ID=function(n){this.Log_ID=n};i.prototype.getP_ID=function(){return this.P_ID};i.prototype.setP_ID=function(n){this.P_ID=n};i.prototype.getP_Date=function(){return this.P_Date};i.prototype.setP_Date=function(n){this.P_Date=n};i.prototype.getP_Number=function(){return this.P_Number};i.prototype.setP_Number=function(n){this.P_Number=n};i.prototype.getP_Msg=function(){return this.P_Msg};i.prototype.setP_Msg=function(n){this.P_Msg=n};n.ProcessInfo=t}(VIS,jQuery),function(n,t){function i(i,r,u){function w(){o=t("<div title='Process'>");l=t("<table class='vis-processpara-table'>");y=t('<div style="overflow:auto">');v=t('<div style="overflow-y:auto;overflow-x:hidden">');v.append(l);o.append(v).append(y);h=t('<input type="button" style="margin-right:5px" >').val(n.Msg.getMsg("OK"));h.addClass("VIS_Pref_btn-2");e=t("<input type='button'>").val(n.Msg.getMsg("Close"));e.addClass("VIS_Pref_btn-2");e.css({"margin-bottom":"0px","margin-top":"7px"});h.css({"margin-bottom":"0px","margin-top":"7px"});v.css("max-height",window.innerHeight-200+"px")}var o,l,p,c,a,s,h,e,y,v,f;this.pi=i;this.parent=r;this.windowNo=u;this.gridFields=[];this.depOnFieldColumn=[];this.depOnField=[];this.vEditors=[];this.vEditors2=[];this.mFields=[];this.mFields2=[];this.isOkClicked=!1;this.onClosed;w();f=this;this.addLine=function(){p=c=a=s=null;c=t("<td class=''>");a=t("<td class=''>");s=t("<td class='vis-processpara-table-td3'>");l.append(t("<tr>").append(c).append(a).append(s))};this.addFields=function(t,i){if(t&&c.append(t.getControl()),i&&(i.getControl().width("200px"),i.getControl().height("30px"),s.append(i.getControl()),i.getBtnCount()>0)){var r=i.getBtn(0);s.append(r);i.getDisplayType()==n.DisplayType.MultiKey&&s.append(i.getBtn(1))}};this.addButtons=function(){this.addLine();y.append(e).append(h)};this.showDialog=function(){o.dialog({modal:!0,width:"auto",close:function(){if(f.parent)f.parent.onProcessDialogClosed(f.isOkClicked,f.parameterList);f.dispose();f=null}});window.setTimeout(function(){e.focus()},200)};this.onClose=function(n){f.isOkClicked=n;o.dialog("close")};e.on(n.Events.onTouchStartOrClick,function(){f.onClose(!1)});h.on(n.Events.onTouchStartOrClick,function(){var n=f.saveParameters();if(n){f.parameterList=n;f.onClose(!0,n)}});this.disposeComponent=function(){e.off(n.Events.onTouchStartOrClick);h.off(n.Events.onTouchStartOrClick);o.dialog("destroy");o.remove();f=null;this.gridFields.length=0;this.gridFields=null;this.depOnFieldColumn.length=0;this.depOnFieldColumn-null;this.depOnField.length=0;this.depOnField=null;this.vEditors.length=0;this.vEditors2.length=0;this.mFields.length=0;this.mFields2.length=0;this.parent=null;this.parameterList=null;this.pi=null;this.addLine=null;this.addFields=null;this.addButtons=null;this.showDialog=null;this.onClose=null;this.isOkClicked=null;o=l=p=c=a=s=h=e=null}}i.prototype.initDialog=function(i){for(var r=null,c,s,v,u,l,h,f,o,e=0,a=i.length;e<a;e++){for(r=new n.GridField(i[e]),this.addLine(),this.mFields.push(r),c=r.getDependentOn(!1),s=0;s<c.length;s++)this.depOnField.push(r),this.depOnFieldColumn.push(c[s]);v=n.VControlFactory.getLabel(r);u=n.VControlFactory.getControl(null,r,!1);u&&(o=r.getDefault(n.context,this.windowNo),u.setValue(o),u.addVetoableChangeListener(this));r.setPropertyChangeListener(u);this.vEditors.push(u);this.addFields(v,u);r.getIsRange()?(this.addLine(),l={},t.extend(!0,l,i[e]),h=new n.GridField(l),this.mFields2.push(h),f=n.VControlFactory.getControl(null,h,!1),f&&(o=h.getDefault(n.context,this.windowNo),f.setValue(o),f.addVetoableChangeListener(this)),this.vEditors2.push(f),this.addFields(null,f)):(this.mFields2.push(null),this.vEditors2.push(null))}return this.addButtons(),!0};i.prototype.vetoablechange=function(t){var f,r,e,u,o,i;if(console.log(t),f=t.newValue==null?"":t.newValue.toString(),r=t.propertyName,n.Env.getCtx().setWindowContext(this.windowNo,r,f),this.depOnFieldColumn.indexOf(r)!==-1)for(e=this.getDependantFields(r),u=0,o=e.length;u<o;u++)(i=field,i!=null)&&(i.refreshLookup(),i.setValue(i.getDefault(Env.getCtx(),this.windowNo),!0))};i.prototype.getDependantFields=function(n){var i=[],r,t;if(this.depOnFieldColumn.indexOf(n)!=-1)for(r=this.depOnFieldColumn.length,t=0;t<r;t++)this.depOnFieldColumn[t].equals(n)&&i.indexOf(this.depOnField[t])<0&&i.push(this.depOnField[t]);return i};i.prototype.saveParameters=function(){for(var r=new StringBuilder,v=this.mFields.length,t=0,u,e,o,y,s,h,c,i,a,t=0;t<v;t++)u=this.mFields[t],u.getIsMandatory(!0)&&(e=this.vEditors[t],o=e.getValue(),o==null||o.toString().length==0?(u.setInserting(!0),u.setError(!0),r.length()>0&&r.append(", "),r.append(u.getHeader())):u.setError(!1),y=this.vEditors2[t],y!=null&&(s=e.getValue(),h=this.mFields2[t],s==null||s.toString().length==0?(u.setInserting(!0),h.setError(!0),r.length()>0&&r.append(", "),r.append(u.getHeader())):h.setError(!1)));if(r.length()!=0)return n.ADialog.error("FillMandatory",!0,r.toString()),!1;for(c=[],i={},t=0;t<v;t++){var p=this.vEditors[t],f=this.vEditors2[t],w=p.getValue(),l=null;(f!=null&&(l=f.getValue()),w!=null||l!=null)&&(i={},a=this.mFields[t],i.Name=a.getColumnName(),i.DisplayType=a.getDisplayType(),i.Result=w,i.Result2=l,i.Info=p.getDisplay(),f!=null&&(i.Info_To=f.getDisplay()),c.push(i))}return c};i.prototype.dispose=function(){this.disposeComponent()};n.ProcessParameter=i}(VIS,jQuery),function(n,t){n.Apps=n.Apps||{};n.Apps.TestForm=function(){function o(){i=t("<div class='vis-height-full'>");f=t("<input type='text'>");r=t("<input type='button'>").val(n.Msg.getMsg("OK"));u=t("<input type='button'>").val(n.Msg.getMsg("Close"));i.append(t('<div class="vis-awindow-header vis-menuTitle"><a href="javascript:void(0)" class="vis-mainMenuIcons vis-icon-menuclose"><\/a><p>Workspace  SuperUser@HQ.IdeasInc.<\/p><div class="vis-awindow-toolbar"><\/div><\/div>')).append(f).append(r).append(u)}var i,f,r,u,e;this.frame;this.windowNo;o();e=this;r.on(n.Events.onTouchStartOrClick,function(){alert("Test From has value :==> "+f.val())});u.on(n.Events.onTouchStartOrClick,function(){confirm("wanna close this form???")&&e.dispose()});this.getRoot=function(){return i};this.disposeComponent=function(){e=null;i&&i.remove();i=null;r&&r.off(n.Events.onTouchStartOrClick);u&&u.off(n.Events.onTouchStartOrClick);f=r=u=null;this.getRoot=null;this.disposeComponent=null}};n.Apps.TestForm.prototype.init=function(n,t){this.frame=t;this.frame.getContentGrid().append(this.getRoot())};n.Apps.TestForm.prototype.sizeChanged=function(){};n.Apps.TestForm.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.TestForm.prototype.show=function(){var t=new n.CFrame;t.setName(n.Msg.getMsg("Tect"));t.setTitle(n.Msg.getMsg("Test"));t.hideHeader(!0);t.setContent(this);t.show()}}(VIS,jQuery),function(n,t){var i=n.Application.contextUrl,u=i+"JsonData/GetGridWindow",f=i+"JsonData/InsertOrUpdateWRecords",e=i+"JsonData/DeleteWRecords",o=i+"JsonData/GetWindowRecords",s=i+"JsonData/GetFormInfo",h=i+"JsonData/GetProcessInfo",c=i+"JsonData/Process",l=i+"JsonData/ExecuteProcess",a=i+"JsonData/UpdateOrInsertPersonalLock",v=i+"JsonData/JDataSet",r=i+"JsonData/ExecuteNonQuer",y=i+"JsonData/GetCardViewDetail",p=i+"JsonData/GetLocLatLng",w=function(){function w(n,r){t.ajax({url:i+"JsonData/UpdateCtx",type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:!0,data:JSON.stringify({dCtx:n})}).done(function(n){r&&r(n)})}function b(n,i,r){var u={AD_Window_ID:n,AD_Tab_ID:i};t.ajax({url:y,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:!0,data:JSON.stringify(u)}).done(function(n){if(r){var t=null;n&&(t=n,typeof n=="string"&&(t=JSON.parse(n)));r(t)}})}function k(n,i){t.ajax({url:u,type:"GET",datatype:"json",async:!0,data:n}).done(function(n){i&&i(n)})}function d(n){var i=null;return t.ajax({url:f,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:JSON.stringify(n)}).done(function(n){i=n}),i}function g(n){var i=null;return t.ajax({url:e,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:JSON.stringify(n)}).done(function(n){i=n}),i}function nt(i,r,u,f,e,s){var h={fields:r,sqlIn:i,rowCount:u,sqlCount:f,AD_Table_ID:e};t.ajax({url:o,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:!0,data:JSON.stringify(h)}).done(function(t){if(s){var i=null;t&&(i=(new n.DB.DataSet).toJson(t));s(i)}})}function tt(r,u){var f=null;return t.ajax({url:i+"JsonData/GetWindowRecord",type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:JSON.stringify({sql:r,fields:u})}).done(function(t){t&&(f=(new n.DB.DataReader).toJson(t))}),f}function it(n,i,r,u){var f=null,e={AD_User_ID:n,AD_Table_ID:i,Record_ID:r,locked:u};return t.ajax({url:a,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:JSON.stringify(e)}).done(function(n){f=n}),f}function rt(i,r){var u=null;return i.indexOf(n.Application.contextUrl)==-1&&(i=n.Application.contextUrl+i),t.ajax({url:i,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:JSON.stringify({fields:r})}).done(function(n){n&&(u=JSON.parse(n))}).fail(function(n,t,i){alert(i)}),u}function ut(n,i){t.ajax({url:s,type:"GET",datatype:"json",async:!0,data:n}).done(function(n){i&&i(n)})}function ft(n,i){t.ajax({url:h,type:"GET",datatype:"json",async:!0,data:n}).done(function(n){i&&i(n)})}function et(n,i){t.ajax({url:c,type:"GET",datatype:"json",async:!0,data:n}).done(function(n){i&&i(n)})}function ot(n,i){t.ajax({url:l,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:!0,data:JSON.stringify(n)}).done(function(n){i&&i(n)})}function st(n,i,r){var u=null;return t.ajax({url:v,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){u=n;r&&r(n)}),u}function ht(n,i,u){var f=null;return t.ajax({url:r+"y",type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){f=n;u&&u(n)}),f}function ct(n,i,u){var f=null;return t.ajax({url:r+"ies",type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){f=n;u&&u(n)}),f}function lt(n,i,r){var f=r?!0:!1,u=null;return t.ajax({url:n,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:f,data:JSON.stringify(i)}).done(function(n){n&&(u=n,typeof n=="string"&&(u=JSON.parse(n)));f&&r(u)}),u}function at(i,r){t.ajax({url:n.Application.contextUrl+"Chat/LoadChat",data:i,type:"GET",cache:!1,datatype:"Json",success:function(n){r&&r(n)}})}function vt(i){t.ajax({url:n.Application.contextUrl+"Chat/SaveChat",type:"POST",dataType:"Json",data:i,success:function(n){n?console.log("Chat Saved"):console.log("Chat Not Saved")},error:function(){console.log("Chat Not Saved")}})}function yt(n,r){var u=null,f=r?!0:!1;return t.ajax({url:i+"Tree/GetTreeAsString",async:f,data:n}).done(function(n){u=n;r&&r(n)}),u}function pt(i,r,u,f,e){var o,s;i==0?(o=n.Application.contextUrl+"Subscribe/Subscribe",s={AD_Window_ID:r,Record_ID:u,AD_Table_ID:f}):(o=n.Application.contextUrl+"Subscribe/UnSubscribe",s={AD_Window_ID:r,Record_ID:u,AD_Table_ID:f});t.ajax({url:o,type:"GET",dataType:"Json",data:s,success:function(t){t==0?i==0?n.ADialog.error(n.Msg.getMsg("SubscriptionFailed")):n.ADialog.error(n.Msg.getMsg("UnSubscriptionFailed")):t==2&&n.ADialog.info(n.Msg.getMsg("AlreadyUnsubscribed"));e()},error:function(t){n.ADialog.error(n.Msg.getMsg("Error")+t.statusText)}})}return{insertOrUpdateWRecord:d,getWindowJString:k,deleteWRecords:g,getWindowRecords:nt,getWindowRecord:tt,updateInsertLocks:it,getDataSetJString:st,getFormDataString:ut,getProcessDataString:ft,process:et,executeProcess:ot,updateClientCtx:w,executeQueries:ct,executeQuery:ht,getJSONRecord:rt,getJSONData:lt,subscribeUnsubscribeRecords:pt,getChatRecords:at,saveChat:vt,getTreeAsString:yt,getCardViewInfo:b}}();n.dataContext=w}(VIS,jQuery);VIS.Model=VIS.Model||{},function(n){function t(t){t||(t="CalloutEngine");this.log=n.Logging.VLogger.getVLogger(t)}var i=!1;t.prototype.isCalloutActive=function(){return i};t.prototype.setCalloutActive=function(n){i=n};t.prototype.start=function(t,i,r,u,f,e,o){var c,l,s,h;if(i==null||i.length==0)throw new Error("No Method Name");if(c="",l=i+" - "+f.getColumnName()+"="+e+" (old="+o+") {active="+this.isCalloutActive()+"}",this.isCalloutActive()||this.log.info(l.toString()),s=this[i],s==null&&(i=i.charAt(0).toUpperCase()+i.substr(1),s=this[i],!s))throw new Error("Method not found: "+i);if(h=s.length,!(h==5||h==6))throw new Error("Method "+i+" has invalid no of arguments: "+h);try{c=h==6?this[i](t,r,u,f,e,o):this[i](t,r,u,f,e)}catch(a){this.setCalloutActive(!1);this.log.log(n.Logging.Level.SEVERE,"start: "+i,a);c=a.toString()}return c};t.prototype.DateAcct=function(n,t,i,r,u,f){return this.isCalloutActive()?"":u?(i.setValue("DateAcct",u),this.setCalloutActive(!1),n=t=i=r=u=f=null,""):""};t.prototype.Rate=function(t,i,r,u,f,e){if(this.isCalloutActive()||f==null)return"";this.setCalloutActive(!0);var s=f,o=n.Env.ZERO;return n.Utility.Util.getValueOfDouble(s)!=0&&(o=(1/s).toFixed(12)),u.getColumnName().toString()=="MultiplyRate"?r.setValue("DivideRate",o):r.setValue("MultiplyRate",o),this.log.info(u.getColumnName()+"="+s+" => "+o),this.setCalloutActive(!1),t=i=r=u=f=e=null,""};n.Model.CalloutEngine=t;n.CalloutEngine=t}(VIS,jQuery),function(n){function gt(){n.CalloutEngine.call(this,"VIS.TestClass")}function u(){n.CalloutEngine.call(this,"VIS.CalloutOrder")}function ni(){n.CalloutEngine.call(this,"VIS.CalloutAssignment")}function h(){n.CalloutEngine.call(this,"VIS.CalloutCashJournal")}function ot(){n.CalloutEngine.call(this,"VIS.CalloutSetAttributeCode")}function w(){n.CalloutEngine.call(this,"VIS.CalloutProduct")}function st(){n.CalloutEngine.call(this,"VIS.CalloutProject")}function d(){n.CalloutEngine.call(this,"VIS.CalloutBankStatement")}function c(){n.CalloutEngine.call(this,"VIS.CalloutOfferSerIncluded")}function l(){n.CalloutEngine.call(this,"VIS.CalloutOfferServices")}function g(){n.CalloutEngine.call(this,"VIS.CalloutCheckInOut")}function b(){n.CalloutEngine.call(this,"VIS.CalloutInventory")}function f(){n.CalloutEngine.call(this,"VIS.CalloutInvoice")}function a(){n.CalloutEngine.call(this,"VIS.CalloutInvoiceBatch")}function ti(){n.CalloutEngine.call(this,"VIS.CalloutMovement")}function ii(){n.CalloutEngine.call(this,"VIS.CalloutObjectData")}function ht(){n.CalloutEngine.call(this,"VIS.CalloutOffer")}function nt(){n.CalloutEngine.call(this,"VIS.CalloutGLJournal")}function ri(){n.CalloutEngine.call(this,"VIS.CalloutProduction")}function tt(){n.CalloutEngine.call(this,"VIS.CalloutRequest")}function ct(){n.CalloutEngine.call(this,"VIS.CalloutRequisition")}function lt(){n.CalloutEngine.call(this,"VIS.CalloutPaySelection")}function it(){n.CalloutEngine.call(this,"VIS.CalloutOrderLine")}function ui(){n.CalloutEngine.call(this,"VIS.CalloutOrderlineRecording")}function fi(){n.CalloutEngine.call(this,"VIS.CalloutCurrency")}function ei(){n.CalloutEngine.call(this,"VIS.CalloutContractQty")}function oi(){n.CalloutEngine.call(this,"VIS.CalloutContractProduct")}function v(){n.CalloutEngine.call(this,"VIS.CalloutContract")}function at(){n.CalloutEngine.call(this,"VIS.copyname")}function si(){n.CalloutEngine.call(this,"VIS.CalloutUserTimeRec")}function vt(){n.CalloutEngine.call(this,"VIS.CalloutTimeExpense")}function yt(){n.CalloutEngine.call(this,"VIS.CalloutTeamForcast")}function pt(){n.CalloutEngine.call(this,"VIS.CalloutTaxAmt")}function hi(){n.CalloutEngine.call(this,"VIS.CalloutTax")}function ci(){n.CalloutEngine.call(this,"VIS.CalloutSetBP")}function li(){n.CalloutEngine.call(this,"VIS.CalloutProjectLine")}function ai(){n.CalloutEngine.call(this,"VIS.CalloutProductToOpportunity")}function vi(){n.CalloutEngine.call(this,"VIS.CalloutPriceListOpp")}function s(){n.CalloutEngine.call(this,"VIS.CalloutInOut")}function wt(){n.CalloutEngine.call(this,"VIS.CalloutPaymentAllocate")}function y(){n.CalloutEngine.call(this,"VIS.CalloutPayment")}function p(){n.CalloutEngine.call(this,"VIS.CalloutOrderContract")}function rt(){n.CalloutEngine.call(this,"VIS.CalloutKPI")}function k(){n.CalloutEngine.call(this,"VIS.CalloutDashboard")}function ut(){n.CalloutEngine.call(this,"VIS.CalloutDashboardView")}function yi(){n.CalloutEngine.call(this,"VIS.CalloutService")}function bt(){n.CalloutEngine.call(this,"VIS.CalloutSetReadOnly")}function pi(){n.CalloutEngine.call(this,"VIS.CalloutSetContract")}function kt(){n.CalloutEngine.call(this,"VIS.CallOutWorkflow ")}function wi(){n.CalloutEngine.call(this,"VIS.CalloutSalesQuotation ")}function bi(){n.CalloutEngine.call(this,"VIS.CalloutSetDate ")}function ki(){n.CalloutEngine.call(this,"VIS.CalloutDisplayButton ")}function di(){n.CalloutEngine.call(this,"VIS.CalloutMoveConfirmLine")}function gi(){n.CalloutEngine.call(this,"VIS.CalloutDocumentType")}function nr(){n.CalloutEngine.call(this,"VIS.CalloutProjectCBPartner")}function tr(){n.CalloutEngine.call(this,"VIS.CalloutPaymentTypeSO")}function ir(){n.CalloutEngine.call(this,"VIS.CalloutMCampaign")}function dt(){n.CalloutEngine.call(this,"VIS.CalloutMRequest")}function ft(){n.CalloutEngine.call(this,"VIS.CalloutModuleMgmt")}function rr(){n.CalloutEngine.call(this,"VIS.CalloutPriclistUOM")}function et(){n.CalloutEngine.call(this,"VIS.CalloutTaxAmount")}var i=n.Logging.Level,t=n.Utility.Util,o=!1,r=0;n.Utility.inheritPrototype(gt,n.CalloutEngine);gt.prototype.set=function(n,t,i,r,u){return i.setValue("Description",u),""};n.Model.TestClass=gt;n.Utility.inheritPrototype(u,n.CalloutEngine);u.prototype.DocType=function(r,u,f,e,o,s){var d="PR",y="WR",tt="F",b,k,a,g,rt,c,ut;if(this.isCalloutActive()||o==null||o.toString()==""||(b=t.getValueOfInt(o),b==null||b==0))return"";this.setCalloutActive(!0);k=t.getValueOfString(f.getValue("DocumentNo"));a=k==null;!a&&k.startsWith("<")&&k.endsWith(">")&&(a=!0);var it=t.getValueOfInt(f.getValue("C_DocType_ID")),p="SELECT d.DocSubTypeSO,d.HasCharges,'N',d.IsDocNoControlled,s.CurrentNext,s.CurrentNextSys,s.AD_Sequence_ID,d.IsSOTrx, d.IsReturnTrx FROM C_DocType d LEFT OUTER JOIN AD_Sequence s ON (d.DocNoSequence_ID=s.AD_Sequence_ID) WHERE C_DocType_ID=@param1",h=null,v=[];try{g=0;a||t.getValueOfInt(it)==0||(v[0]=new n.DB.SqlParam("@param1",it),h=n.DB.executeReader(p,v),h.read()&&(g=t.getValueOfInt(h.get("currentnextsys"))),h.close());v[0]=new n.DB.SqlParam("@param1",b);h=n.DB.executeReader(p,v);v.length=0;v=null;var l="",w=!0,nt=!1;if(h.read()&&(l=h.get("docsubtypeso"),l==null&&(l="--"),r.setContext(u,"OrderType",l),!l=="SO"&&f.setValue("IsDropShip","N"),"N"==h.get("issotrx")&&(w=!1),nt=h.get("isreturntrx")=="Y"?!0:!1,nt?l==y?f.setValue("DeliveryRule",tt):f.setValue("DeliveryRule","M"):(l==y?f.setValue("DeliveryRule",tt):l==d?f.setValue("DeliveryRule","R"):f.setValue("DeliveryRule","A"),l==y||l==d||l=="WI"?f.setValue("InvoiceRule","I"):f.setValue("InvoiceRule","D"),l==y?f.setValue("PaymentRule","B"):f.setValue("PaymentRule","P"),r.setContext(u,"HasCharges",t.getValueOfString(h.get("hascharges")))),h.get("isdocnocontrolled")=="Y"&&(a||g==t.getValueOfInt(h.get("ad_sequence_id"))||(a=!0),a&&(n.Ini.getLocalStorage(n.IniConstants.P_VIENNASYS)&&r.getAD_Client_ID()<1e6?f.setValue("DocumentNo","<"+h.tables[0].rows[0].cells.currentnextsys+">"):f.setValue("DocumentNo","<"+h.tables[0].rows[0].cells.currentnext+">")))),h.close(),nt)return this.setCalloutActive(!1),"";l==y||l==d||(rt=r.getContextAsInt(u,"C_BPartner_ID"),p="SELECT PaymentRule,C_PaymentTerm_ID,InvoiceRule,DeliveryRule,FreightCostRule,DeliveryViaRule, PaymentRulePO,PO_PaymentTerm_ID FROM C_BPartner WHERE C_BPartner_ID="+rt,h=n.DB.executeReader(p,null),h.read()&&(c=h.get(w?"paymentrule":"paymentrulepo"),c!=null&&c.length!=0&&((w&&c=="B"||c=="S"||c=="U")&&(c="P"),w||c!="B"||(c="P"),f.setValue("PaymentRule",c)),ut=h.get(w?"c_paymentterm_id":"po_paymentterm_id"),h!=null&&f.setValue("C_PaymentTerm_ID",ut),c=h.get("invoicerule"),c!=null&&c.length!=0&&f.setValue("InvoiceRule",c),c=h.get("deliveryrule"),c!=null&&c.length!=0&&f.setValue("DeliveryRule",c),c=h.get("freightcostrule"),c!=null&&c.length!=0&&f.setValue("FreightCostRule",c),c=h.get("deliveryviarule"),c!=null&&c.length!=0&&f.setValue("DeliveryViaRule",c)),h.close())}catch(ft){return this.setCalloutActive(!1),h!=null&&(h.close(),h=null),this.log.log(i.SEVERE,p,ft),ft}return this.setCalloutActive(!1),r=u=f=e=o=s=null,""};u.prototype.BPartner=function(r,u,f,e,o,s){var l=null,w="",c=null,v,ut,y,p,g,nt,b,tt,d,k,it,ft,et,h,rt,a;if(this.isCalloutActive()||o==null||o.toString()=="")return"";try{if((v=0,o!=null&&(v=t.getValueOfInt(o.toString())),v==0)||(ut=t.getValueOfBoolean(f.getValue("IsReturnTrx")),ut))return"";this.setCalloutActive(!0);w="SELECT p.AD_Language,p.C_PaymentTerm_ID,  COALESCE(p.M_PriceList_ID,g.M_PriceList_ID) AS M_PriceList_ID, p.PaymentRule,p.POReference, p.SO_Description, ";a=t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='VA009_'  AND IsActive = 'Y'"));a>0&&(w+=" p.VA009_PaymentMethod_ID, ");w+=" p.IsDiscountPrinted, p.InvoiceRule,p.DeliveryRule,p.FreightCostRule,DeliveryViaRule, p.SO_CreditLimit, p.SO_CreditLimit-p.SO_CreditUsed AS CreditAvailable, lship.C_BPartner_Location_ID,c.AD_User_ID, COALESCE(p.PO_PriceList_ID,g.PO_PriceList_ID) AS PO_PriceList_ID, p.PaymentRulePO,p.PO_PaymentTerm_ID, lbill.C_BPartner_Location_ID AS Bill_Location_ID, p.SOCreditStatus, lbill.IsShipTo  FROM C_BPartner p INNER JOIN C_BP_Group g ON (p.C_BP_Group_ID=g.C_BP_Group_ID) LEFT OUTER JOIN C_BPartner_Location lbill ON (p.C_BPartner_ID=lbill.C_BPartner_ID AND lbill.IsBillTo='Y' AND lbill.IsActive='Y') LEFT OUTER JOIN C_BPartner_Location lship ON (p.C_BPartner_ID=lship.C_BPartner_ID AND lship.IsShipTo='Y' AND lship.IsActive='Y') LEFT OUTER JOIN AD_User c ON (p.C_BPartner_ID=c.C_BPartner_ID) WHERE p.C_BPartner_ID="+v+" AND p.IsActive='Y'";y=r.isSOTrx(u);c=n.DB.executeReader(w);c.read()&&(p=t.getValueOfInt(c.get(y?"m_pricelist_id":"po_pricelist_id")),c!=null&&p!=0?f.setValue("M_PriceList_ID",p):(g=r.getContextAsInt(u,"#M_PriceList_ID",!1),g!=0&&f.setValue("M_PriceList_ID",g)),f.setValue("Bill_BPartner_ID",v),nt=t.getValueOfInt(c.get("bill_location_id")),nt==0?f.setValue("Bill_Location_ID",null):f.setValue("Bill_Location_ID",nt),b=t.getValueOfInt(c.get("c_bpartner_location_id")),v.toString()==r.getContext("C_BPartner_ID")&&(tt=r.getContext("C_BPartner_Location_ID"),tt.length>0&&(b=t.getValueOfInt(tt))),b==0?f.setValue("C_BPartner_Location_ID",null):(f.setValue("C_BPartner_Location_ID",b),"Y"==c.get("isshipto").toString()&&f.setValue("Bill_Location_ID",b)),a=t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='VA009_'  AND IsActive = 'Y'")),a>0&&(d=t.getValueOfInt(c.get("VA009_PaymentMethod_ID")),d==0?f.setValue("VA009_PaymentMethod_ID",null):(f.setValue("VA009_PaymentMethod_ID",d),l=n.DB.executeScalar("SELECT VA009_PaymentBaseType FROM VA009_PaymentMethod WHERE VA009_PaymentMethod_ID="+d),l!="W"&&l!=null?(f.setValue("PaymentMethod",l),f.setValue("PaymentRule",l)):(f.setValue("PaymentMethod","T"),f.setValue("PaymentRule","T")))),k=t.getValueOfInt(c.get("ad_user_id")),v.toString()==r.getContext("C_BPartner_ID")&&(it=r.getContext("AD_User_ID"),it.length>0&&(k=t.getValueOfInt(it))),k==0?f.setValue("AD_User_ID",null):(f.setValue("AD_User_ID",k),f.setValue("Bill_User_ID",k)),y&&(ft=t.getValueOfDouble(c.get("so_creditlimit")),ft!=0&&(et=t.getValueOfDouble(c.get("creditavailable")),c!=null&&et<0&&n.ADialog.info("CreditLimitOver",null,"",""))),h=c.get("poreference"),h!=null&&h.length!=0&&f.setValue("POReference",h),h=c.get("so_description"),h!=null&&h.trim().length!=0&&f.setValue("Description",h),h=c.get("isdiscountprinted"),h!=null&&h.length!=0?f.setValue("IsDiscountPrinted",h):f.setValue("IsDiscountPrinted","N"),rt=r.getContext("OrderType"),f.setValue("InvoiceRule","D"),f.setValue("DeliveryRule","A"),a=t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='VA009_'  AND IsActive = 'Y'")),a>0?l!="W"&&l!=null?f.setValue("PaymentRule",l):(f.setValue("PaymentRule","T"),f.setValue("PaymentMethod","T")):f.setValue("PaymentRule","P"),rt=="PR"?(f.setValue("InvoiceRule","I"),f.setValue("DeliveryRule","R")):rt=="WR"?(a=t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='VA009_'  AND IsActive = 'Y'")),a>0?l!="W"&&l!=null?f.setValue("PaymentRule",l):(f.setValue("PaymentRule","T"),f.setValue("PaymentMethod","T")):f.setValue("PaymentRule","B")):(a=t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='VA009_'  AND IsActive = 'Y'")),a>0?l!="W"&&l!=null?f.setValue("PaymentRule",l):(f.setValue("PaymentRule","T"),f.setValue("PaymentMethod","T")):(h=c.get(y?"paymentrule":"paymentrulepo"),h!=null&&h.length!=0&&(h=="B"&&(h="P"),(y&&h=="S"||h=="U")&&(h="P"),f.setValue("PaymentRule",h))),p=t.getValueOfInt(c.get(y?"c_paymentterm_id":"po_paymentterm_id")),c!=null&&p!=0&&f.setValue("C_PaymentTerm_ID",p),h=c.get("invoicerule"),h!=null&&h.length!=0&&f.setValue("InvoiceRule",h),h=c.get("deliveryrule"),h!=null&&h.length!=0&&f.setValue("DeliveryRule",h),h=c.get("freightcostrule"),h!=null&&h.length!=0&&f.setValue("FreightCostRule",h),h=c.get("deliveryviarule"),h!=null&&h.length!=0&&f.setValue("DeliveryViaRule",h)));c.close()}catch(ot){return c!=null&&(c.close(),c=null),this.log.log(i.SEVERE,w,ot),this.setCalloutActive(!1),ot}return this.setCalloutActive(!1),r=u=f=e=o=s=null,""};u.prototype.BPartnerBill=function(r,u,f,e,o,s){var c,l,g,nt,a,v,w,y,b,p,k,tt,it,h,d;if(this.isCalloutActive()||o==null||o.toString()=="")return"";c=null;try{if(l=t.getValueOfInt(o.toString()),l==null||l==0)return"";if(this.setCalloutActive(!0),g=t.getValueOfBoolean(f.getValue("IsReturnTrx")),g)return this.setCalloutActive(!1),"";nt="SELECT p.AD_Language,p.C_PaymentTerm_ID,p.M_PriceList_ID,p.PaymentRule,p.POReference,p.SO_Description,p.IsDiscountPrinted,p.InvoiceRule,p.DeliveryRule,p.FreightCostRule,DeliveryViaRule,p.SO_CreditLimit, p.SO_CreditLimit-p.SO_CreditUsed AS CreditAvailable,c.AD_User_ID,p.PO_PriceList_ID, p.PaymentRulePO, p.PO_PaymentTerm_ID,lbill.C_BPartner_Location_ID AS Bill_Location_ID FROM C_BPartner p LEFT OUTER JOIN C_BPartner_Location lbill ON (p.C_BPartner_ID=lbill.C_BPartner_ID AND lbill.IsBillTo='Y' AND lbill.IsActive='Y') LEFT OUTER JOIN AD_User c ON (p.C_BPartner_ID=c.C_BPartner_ID) WHERE p.C_BPartner_ID="+l+" AND p.IsActive='Y'";a="Y"==r.getWindowContext(u,"IsSOTrx",!0);c=n.DB.executeReader(nt);c.read()&&(v=t.getValueOfInt(c.get(a?"m_pricelist_id":"po_pricelist_id")),v!=0?f.setValue("M_PriceList_ID",v):(w=r.getContextAsInt(u,"#M_PriceList_ID",!1),w!=0&&f.setValue("M_PriceList_ID",t.getValueOfInt(w))),y=t.getValueOfInt(c.get("bill_location_id")),l.toString()==r.getContext("C_BPartner_ID")&&(b=r.getContext("C_BPartner_Location_ID"),b.length>0&&(y=t.getValueOfInt(b))),y==0?f.setValue("Bill_Location_ID",null):f.setValue("Bill_Location_ID",t.getValueOfInt(y)),p=t.getValueOfInt(c.get("ad_user_id")),l.toString()==r.getContext("C_BPartner_ID")&&(k=r.getContext("AD_User_ID"),k.length>0&&(p=t.getValueOfInt(k))),p==0?f.setValue("Bill_User_ID",null):f.setValue("Bill_User_ID",t.getValueOfInt(p.toString())),a&&(tt=0,tt!=0&&(it=0,c!=null&&it<0&&n.ADialog.info("CreditLimitOver",null,"",""))),h=c.get("poreference"),h=c.get("so_description"),h!=null&&h.toString().trim().length!=0&&f.setValue("Description",h),h=c.get("isdiscountprinted"),h!=null&&h.toString().length!=0?f.setValue("IsDiscountPrinted",h):f.setValue("IsDiscountPrinted","N"),d=r.getContext("OrderType"),f.setValue("InvoiceRule","D"),f.setValue("PaymentRule","P"),d=="PR"?f.setValue("InvoiceRule","I"):d=="WR"?f.setValue("PaymentRule","B"):(h=c.get(a?"paymentrule":"paymentrulepo"),h!=null&&h.toString().length!=0&&(h=="B"&&(h="P"),a&&(h=="S"||h=="U")&&(h="P"),f.setValue("PaymentRule",h)),v=c.get(a?"c_paymentterm_id":"po_paymentterm_id"),c!=null&&f.setValue("C_PaymentTerm_ID",v),h=c.get("invoicerule"),h!=null&&h.toString().length!=0&&f.setValue("InvoiceRule",h)));c.close()}catch(rt){return this.setCalloutActive(!1),c!=null&&(c.close(),c=null),this.log(i.SEVERE,"bPartnerBill",rt),rt}return this.setCalloutActive(!1),r=u=f=e=o=s=null,""};u.prototype.PriceList=function(r,u,f,e,s,h){var a="",c=null,l,v,y;if(this.isCalloutActive()||s==null||s.toString()=="")return"";try{if(l=t.getValueOfInt(s.toString()),l==null||l==0)return"";this.setCalloutActive(!0);o&&this.log.warning("init");a="SELECT pl.IsTaxIncluded,pl.EnforcePriceLimit,pl.C_Currency_ID,c.StdPrecision,plv.M_PriceList_Version_ID,plv.ValidFrom FROM M_PriceList pl,C_Currency c,M_PriceList_Version plv WHERE pl.C_Currency_ID=c.C_Currency_ID AND pl.M_PriceList_ID=plv.M_PriceList_ID AND pl.M_PriceList_ID="+l+"ORDER BY plv.ValidFrom DESC";c=n.DB.executeReader(a);c.read()&&(f.setValue("IsTaxIncluded","Y"==c.get("istaxincluded").toString()),r.setContext(u,"EnforcePriceLimit",c.get("enforcepricelimit").toString()),v=t.getValueOfInt(c.get("c_currency_id")),f.setValue("C_Currency_ID",v),y=t.getValueOfInt(c.get("m_pricelist_version_id")),r.setContext(u,"M_PriceList_Version_ID",y));c.close()}catch(p){return this.setCalloutActive(!1),c!=null&&c.close(),this.log(i.SEVERE,a,p),p}return o&&this.log.warning("finish"),this.setCalloutActive(!1),r=u=f=e=s=h=null,""};u.prototype.Product=function(i,u,f,e,s,h){var c,ct,g,k,y,w,gt,p,d,ot,vt,nt,l,b,v,it,st,wt;if(this.isCalloutActive()||s==null||s.toString()=="")return"";var c="",rt=0,a=t.getValueOfInt(s);if(a==null||a==0||(k="Y"==i.getContext("IsReturnTrx"),k))return"";this.setCalloutActive(!0);try{o&&this.log.warning("init");f.setValue("C_Charge_ID",null);i.getContextAsInt(u,"M_Product_ID",!1)==a&&i.getContextAsInt(u,"M_AttributeSetInstance_ID",!1)!=0?f.setValue("M_AttributeSetInstance_ID",t.getValueOfInt(i.getContextAsInt(u,"M_AttributeSetInstance_ID",!1))):f.setValue("M_AttributeSetInstance_ID",null);c="SELECT producttype FROM m_product where isactive = 'Y' AND M_Product_ID = "+a;ct=t.getValueOfString(n.DB.executeScalar(c,null,null));ct=="S"?f.setValue("IsContract",!0):(f.setValue("IsContract",!1),f.setValue("NoofCycle",null),f.setValue("QtyPerCycle",null),f.setValue("StartDate",null),f.setValue("C_Contract_ID",0),f.setValue("EndDate",null),f.setValue("C_Frequency_ID",0));g=i.getWindowContext(u,"IsSOTrx",!0)=="Y";k=i.getWindowContext(u,"IsReturnTrx",!0)=="Y";c="SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='ED011_'";r=t.getValueOfInt(n.DB.executeScalar(c));y=0;r>0&&(c="SELECT C_UOM_ID FROM M_Product_PO WHERE IsActive = 'Y' AND  C_BPartner_ID = "+f.getValue("C_BPartner_ID")+" AND M_Product_ID = "+a,y=t.getValueOfInt(n.DB.executeScalar(c)),y>0&&g==!1&&k==!1?f.setValue("C_UOM_ID",y):(c="SELECT C_UOM_ID FROM M_Product WHERE IsActive = 'Y' AND M_Product_ID = "+a,f.setValue("C_UOM_ID",t.getValueOfInt(n.DB.executeScalar(c)))));var lt=i.getContextAsInt(u,"C_BPartner_ID",!1),bt=t.getValueOfDecimal(f.getValue("QtyOrdered")),g=i.getWindowContext(u,"IsSOTrx",!0)=="Y",et=i.getContextAsInt(u,"M_PriceList_ID",!1),kt=i.getContextAsInt(u,"M_PriceList_Version_ID",!1),ut=i.getContextAsInt(u,"M_AttributeSetInstance_ID",!1),dt=f.getValue("DateOrdered"),p=t.getValueOfInt(f.getValue("C_UOM_ID")),v=a.toString().concat(",",lt.toString(),",",bt.toString(),",",g,",",et.toString(),",",kt.toString(),",",dt.toString(),",",null,",",ut.toString(),",",p,",",r);try{if(w=null,w=n.dataContext.getJSONRecord("MProductPricing/GetProductPricing",v),gt=null,f.setValue("PriceList",w.PriceList),f.setValue("PriceLimit",w.PriceLimit),f.setValue("PriceActual",w.PriceActual),f.setValue("PriceEntered",w.PriceEntered),f.setValue("C_Currency_ID",t.getValueOfInt(w.C_Currency_ID)),f.setValue("Discount",w.Discount),r<=0&&f.setValue("C_UOM_ID",t.getValueOfInt(w.C_UOM_ID)),f.setValue("QtyOrdered",f.getValue("QtyEntered")),r>0&&y>0&&g==!1&&k==!1){v=a.toString();p=n.dataContext.getJSONRecord("MProduct/GetC_UOM_ID",v);v=t.getValueOfInt(f.getValue("C_Order_ID")).toString();var et=n.dataContext.getJSONRecord("MOrder/GetM_PriceList",v),rt=n.dataContext.getJSONRecord("MPriceListVersion/GetM_PriceList_Version_ID",et.toString()),at=n.dataContext.getJSONRecord("MUOM/GetPrecision",p.toString()),ft=n.dataContext.getJSONRecord("MBPartner/GetBPartner",lt.toString());c="SELECT PriceList , PriceStd , PriceLimit FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+rt+" AND ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL ) AND C_UOM_ID="+y;d=n.DB.executeDataSet(c);d.getTables().length>0&&(d.getTables()[0].getRows().length>0?(ot=this.FlatDiscount(a,i.getAD_Client_ID(),t.getValueOfDecimal(d.getTables()[0].getRows()[0].getCell("PriceStd")),ft.M_DiscountSchema_ID,t.getValueOfDecimal(ft.FlatDiscount),t.getValueOfInt(f.getValue("QtyEntered"))),f.setValue("PriceList",t.getValueOfDecimal(d.getTables()[0].getRows()[0].getCell("PriceList"))),f.setValue("PriceLimit",t.getValueOfDecimal(d.getTables()[0].getRows()[0].getCell("PriceLimit"))),f.setValue("PriceActual",ot),f.setValue("PriceEntered",ot),c="SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y' AND con.M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND con.C_UOM_ID = "+p+" AND con.C_UOM_To_ID = "+y,l=t.getValueOfDecimal(n.DB.executeScalar(c)),l==0&&(c="SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y' AND con.C_UOM_ID = "+p+" AND con.C_UOM_To_ID = "+y,l=t.getValueOfDecimal(n.DB.executeScalar(c))),p==y&&l==0&&(l=1),f.setValue("QtyOrdered",t.getValueOfDecimal(f.getValue("QtyEntered")).toFixed(at)*l)):(c="SELECT PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+rt+" AND M_AttributeSetInstance_ID = 0 AND C_UOM_ID="+p,vt=t.getValueOfDecimal(n.DB.executeScalar(c)),c="SELECT PriceStd FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+rt+" AND M_AttributeSetInstance_ID = 0 AND C_UOM_ID="+p,nt=t.getValueOfDecimal(n.DB.executeScalar(c)),nt=this.FlatDiscount(a,i.getAD_Client_ID(),nt,ft.M_DiscountSchema_ID,t.getValueOfDecimal(ft.FlatDiscount),t.getValueOfInt(f.getValue("QtyEntered"))),c="SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y' AND con.M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND con.C_UOM_ID = "+p+" AND con.C_UOM_To_ID = "+y,l=t.getValueOfDecimal(n.DB.executeScalar(c)),l==0&&(c="SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y' AND con.C_UOM_ID = "+p+" AND con.C_UOM_To_ID = "+y,l=t.getValueOfDecimal(n.DB.executeScalar(c))),f.setValue("PriceList",vt*l),f.setValue("PriceActual",nt*l),f.setValue("PriceEntered",nt*l),l==0&&(l=1),f.setValue("QtyOrdered",t.getValueOfDecimal(f.getValue("QtyEntered")).toFixed(at)*l)))}if(i.setContext(u,"EnforcePriceLimit",w.IsEnforcePriceLimit?"Y":"N"),i.setContext(u,"DiscountSchema",w.IsDiscountSchema?"Y":"N"),i.isSOTrx()){var yt=t.getValueOfDecimal(f.getValue("QtyOrdered")),pt=i.getContextAsInt(u,"M_Warehouse_ID"),ut=i.getContextAsInt(u,"M_AttributeSetInstance_ID"),tt=0;f.getValue("C_OrderLine_ID")!=null&&(tt=t.getValueOfInt(f.getValue("C_OrderLine_ID")));tt==null&&(tt=0);v=a.toString().concat(",",pt.toString(),",",ut.toString(),",",tt.toString());b=n.dataContext.getJSONRecord("MStorage/GetQtyAvailable",v);b==null&&(b=n.Env.ZERO);b==0||b.toString().compareTo(yt)<0||(v=pt.toString()+","+a.toString()+","+ut.toString()+","+tt.toString(),it=n.dataContext.getJSONRecord("MOrderLine/GetNotReserved",v),it==null&&(it=n.Env.ZERO),st=b-it,st.compareTo(yt)<0&&(wt=n.Msg.parseTranslation(i,"@QtyAvailable@="+b+" - @QtyNotReserved@="+it+" = "+st),n.ADialog.info("InsufficientQtyAvailable",!0,wt,"")))}o&&this.log.warning("fini")}catch(ht){return this.log.saveError("calloutorder",ht.toString()),this.setCalloutActive(!1),ht.message}this.setCalloutActive(!1)}catch(ht){this.setCalloutActive(!1);this.log.saveError("calloutorder",ht.toString())}return this.setCalloutActive(!1),h=null,this.Tax(i,u,f,e,s)};u.prototype.Charge=function(r,u,f,e,o,s){var c,v,l,h,a;try{if(this.isCalloutActive()||o==null||o.toString()=="")return"";if((this.setCalloutActive(!0),c=t.getValueOfInt(o),c==null||c==0)||(v="Y"==r.getContext("IsReturnTrx"),v))return this.setCalloutActive(!1),"";f.getValue("M_Product_ID")!=null&&f.setValue("M_Product_ID",null);f.setValue("M_AttributeSetInstance_ID",null);f.setValue("S_ResourceAssignment_ID",null);f.setValue("C_UOM_ID",100);r.setContext(u,"DiscountSchema","N");l="SELECT ChargeAmt FROM C_Charge WHERE C_Charge_ID="+c;h=null;h=n.DB.executeReader(l);h!=null&&h.read()&&(a=t.getValueOfDecimal(h.get("chargeamt")));f.setValue("PriceEntered",a);f.setValue("PriceActual",a);f.setValue("PriceLimit",n.Env.ZERO);f.setValue("PriceList",n.Env.ZERO);f.setValue("Discount",n.Env.ZERO);h.close()}catch(y){return this.setCalloutActive(!1),h!=null&&(h.close(),h=null),this.log.log(i.SEVERE,l,y),y}return this.setCalloutActive(!1),s=null,this.Tax(r,u,f,e,o)};u.prototype.Tax=function(i,r,u,f,e,s){var a,v,b,et,k,y,p,l,d,g,nt,tt,w;if(this.isCalloutActive()||e==null||e.toString()=="")return"";this.setCalloutActive(!0);try{var rt="",h="",c="",ot=t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX IN ('VATAX_' )")),ut=i.getWindowContext(r,"IsSOTrx",!0)=="Y",ft=i.getWindowContext(r,"IsReturnTrx",!0)=="Y";if(c=u.getValue("C_Order_ID").toString(),a=n.dataContext.getJSONRecord("MOrder/GetOrder",c),h="SELECT VATAX_TaxRule FROM AD_OrgInfo WHERE AD_Org_ID="+t.getValueOfInt(a.AD_Org_ID)+" AND IsActive ='Y' AND AD_Client_ID ="+i.getAD_Client_ID(),ot>0&&(rt=t.getValueOfString(n.DB.executeScalar(h))),rt=="T"&&(ut==!0&&ft==!1||ut==!1&&ft==!1))if(v=0,h="SELECT Count(*) FROM AD_Column WHERE ColumnName = 'C_Tax_ID' AND AD_Table_ID = (SELECT AD_Table_ID FROM AD_Table WHERE TableName = 'C_TaxCategory')",t.getValueOfInt(n.DB.executeScalar(h))>0?(c=t.getValueOfInt(u.getValue("C_Order_ID")).toString()+","+t.getValueOfInt(u.getValue("M_Product_ID")).toString()+","+t.getValueOfInt(u.getValue("C_Charge_ID")).toString(),v=n.dataContext.getJSONRecord("MOrderLine/GetTax",c)):(h="SELECT VATAX_TaxType_ID FROM C_BPartner_Location WHERE C_BPartner_ID ="+t.getValueOfInt(a.C_BPartner_ID)+" AND IsActive = 'Y'  AND C_BPartner_Location_ID = "+t.getValueOfInt(a.Bill_Location_ID),b=t.getValueOfInt(n.DB.executeScalar(h)),b==0&&(h="SELECT VATAX_TaxType_ID FROM C_BPartner WHERE C_BPartner_ID ="+t.getValueOfInt(a.C_BPartner_ID)+" AND IsActive = 'Y'",b=t.getValueOfInt(n.DB.executeScalar(h))),et=n.dataContext.getJSONRecord("MProduct/GetTaxCategory",e.toString()),h="SELECT C_Tax_ID FROM VATAX_TaxCatRate WHERE C_TaxCategory_ID = "+et+" AND IsActive ='Y' AND VATAX_TaxType_ID ="+b,v=t.getValueOfInt(n.DB.executeScalar(h))),t.getValueOfInt(v)>0)u.setValue("C_Tax_ID",v);else{if(t.getValueOfInt(u.getValue("M_Product_ID"))>0)return u.setValue("M_Product_ID",""),this.setCalloutActive(!1),n.ADialog.info("VATAX_DefineTax");if(t.getValueOfInt(u.getValue("C_Charge_ID"))>0)return u.setValue("C_Charge_ID",""),this.setCalloutActive(!1),n.ADialog.info("VATAX_DefineChargeTax")}else{if(k=f.getColumnName(),e==null)return"";if((o&&this.log.warning("init"),y=0,y=k=="M_Product_ID"?t.getValueOfInt(e):t.getValueOfInt(i.getContextAsInt(r,"M_Product_ID")),p=0,p=k=="C_Charge_ID"?t.getValueOfInt(e):t.getValueOfInt(i.getContextAsInt(r,"C_Charge_ID")),this.log.fine("Product="+y+", C_Charge_ID="+p),y==0&&p==0)||(l=0,l=k=="C_BPartner_Location_ID"?t.getValueOfInt(e):t.getValueOfInt(i.getContextAsInt(r,"C_BPartner_Location_ID")),l==0))return this.setCalloutActive(!1),this.Amt(i,r,u,f,e);this.log.fine("Ship BP_Location="+l);d=i.getContext("DateOrdered");this.log.fine("Bill Date="+d);g=i.getContext("DatePromised");this.log.fine("Ship Date="+g);nt=i.getContextAsInt(r,"AD_Org_ID");this.log.fine("Org="+nt);tt=i.getContextAsInt(r,"M_Warehouse_ID");this.log.fine("Warehouse="+tt);w=i.getContextAsInt(r,"Bill_Location_ID");w==0&&(w=l);this.log.fine("Bill BP_Location="+w);var st="Y"==i.getWindowContext(r,"IsSOTrx",!0),c=y.toString()+","+p.toString()+","+d.toString()+","+g.toString()+","+nt.toString()+","+tt.toString()+","+w.toString()+","+l.toString()+","+st.toString(),it=n.dataContext.getJSONRecord("MTax/Get_Tax_ID",c);this.log.info("Tax ID="+it);it==0||u.setValue("C_Tax_ID",t.getValueOfInt(it));o&&this.log.warning("fini")}}catch(ht){return this.setCalloutActive(!1),ht}return this.setCalloutActive(!1),s=null,this.Amt(i,r,u,f,e)};u.prototype.Amt=function(i,u,f,e,s,h){var et,yt,ot,c,a,it,k,p,ni,st,pt,ii,rt,vt,ri,kt,ti,ct,g,d,y,bt,nt,wt,ei,at;if(this.isCalloutActive()||s==null||s.toString()==""||(console.log("Before Charge Or Product"),t.getValueOfInt(f.getValue("C_Charge_ID"))==0&&t.getValueOfInt(f.getValue("M_Product_ID"))==0))return"";console.log("After Charge Or Product");this.setCalloutActive(!0);try{o&&this.log.Warning("init");var tt=i.getContextAsInt(u,"C_UOM_ID"),b=i.getContextAsInt(u,"M_Product_ID"),ut=i.getContextAsInt(u,"M_PriceList_ID"),hi=ut.toString(),vt;if(vt=n.dataContext.getJSONRecord("MPriceList/GetPriceList",ut.toString()),et=t.getValueOfInt(vt.StdPrecision),yt=t.getValueOfDecimal(f.getValue("QtyEntered")),ot=t.getValueOfDecimal(f.getValue("QtyOrdered")),this.log.fine("QtyEntered="+yt+", Ordered="+ot+", UOM="+tt),c=t.getValueOfDecimal(f.getValue("PriceEntered")),a=t.getValueOfDecimal(f.getValue("PriceActual")),t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO  WHERE PREFIX IN('VAPRC_','ED011_')"))>=1&&(a=c),k=t.getValueOfDecimal(f.getValue("Discount")),it=t.getValueOfDecimal(f.getValue("PriceLimit")),p=t.getValueOfDecimal(f.getValue("PriceList")),this.log.fine("PriceList="+p+", Limit="+it+", Precision="+et),this.log.fine("PriceEntered="+c+", Actual="+a+", Discount="+k),r=t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='ED011_'")),e.getColumnName()=="QtyEntered"&&r>0){rt=t.getValueOfInt(f.getValue("C_Order_ID")).toString();var ut=n.dataContext.getJSONRecord("MOrder/GetM_PriceList",rt),v=n.dataContext.getJSONRecord("MPriceListVersion/GetM_PriceList_Version_ID",ut.toString()),gt=i.getContextAsInt(u,"C_BPartner_ID",!1),w=n.dataContext.getJSONRecord("MBPartner/GetBPartner",gt.toString());l=t.getValueOfInt(f.getValue("M_AttributeSetInstance_ID"))>0?"SELECT COUNT(*) FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+v+" AND  M_AttributeSetInstance_ID = "+t.getValueOfInt(f.getValue("M_AttributeSetInstance_ID"))+"  AND C_UOM_ID="+t.getValueOfInt(f.getValue("C_UOM_ID")):"SELECT COUNT(*) FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+v+" AND  ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL )   AND C_UOM_ID="+t.getValueOfInt(f.getValue("C_UOM_ID"));ni=t.getValueOfInt(n.DB.executeScalar(l));ni>0?(l=t.getValueOfInt(f.getValue("M_AttributeSetInstance_ID"))>0?"SELECT PriceStd , PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+v+" AND  M_AttributeSetInstance_ID = "+t.getValueOfInt(f.getValue("M_AttributeSetInstance_ID"))+"  AND C_UOM_ID="+t.getValueOfInt(f.getValue("C_UOM_ID")):"SELECT PriceStd , PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+v+" AND  ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL )   AND C_UOM_ID="+t.getValueOfInt(f.getValue("C_UOM_ID")),y=n.DB.executeDataSet(l),y.getTables().length>0&&y.getTables()[0].getRows().length>0&&(c=this.FlatDiscount(b,i.getAD_Client_ID(),t.getValueOfDecimal(y.getTables()[0].getRows()[0].getCell("PriceStd")),w.M_DiscountSchema_ID,t.getValueOfDecimal(w.FlatDiscount),t.getValueOfInt(f.getValue("QtyEntered"))),p=t.getValueOfDecimal(y.getTables()[0].getRows()[0].getCell("PriceList")),f.setValue("PriceList",t.getValueOfDecimal(y.getTables()[0].getRows()[0].getCell("PriceList"))),f.setValue("PriceEntered",c),a=c,f.setValue("PriceActual",a))):t.getValueOfInt(f.getValue("M_AttributeSetInstance_ID"))>0&&ni==0?(l="SELECT PriceStd , PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+v+" AND  ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL )   AND C_UOM_ID="+t.getValueOfInt(f.getValue("C_UOM_ID")),st=n.DB.executeDataSet(l),st.getTables().length>0&&st.getTables()[0].getRows().length>0&&(c=this.FlatDiscount(b,i.getAD_Client_ID(),t.getValueOfDecimal(st.getTables()[0].getRows()[0].getCell("PriceStd")),w.M_DiscountSchema_ID,t.getValueOfDecimal(w.FlatDiscount),t.getValueOfInt(f.getValue("QtyEntered"))),p=t.getValueOfDecimal(st.getTables()[0].getRows()[0].getCell("PriceList")),f.setValue("PriceList",t.getValueOfDecimal(st.getTables()[0].getRows()[0].getCell("PriceList"))),f.setValue("PriceEntered",c),a=c,f.setValue("PriceActual",a))):(g=b.toString(),d=n.dataContext.getJSONRecord("MProduct/GetC_UOM_ID",g),l=t.getValueOfInt(f.getValue("M_AttributeSetInstance_ID"))>0?"SELECT PriceStd , PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+v+" AND  M_AttributeSetInstance_ID = "+t.getValueOfInt(f.getValue("M_AttributeSetInstance_ID"))+"  AND C_UOM_ID="+d:"SELECT PriceStd , PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+v+" AND  ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL )   AND C_UOM_ID="+d,y=n.DB.executeDataSet(l),y.getTables().length>0&&(y.getTables()[0].getRows().length>0?(c=this.FlatDiscount(b,i.getAD_Client_ID(),t.getValueOfDecimal(y.getTables()[0].getRows()[0].getCell("PriceStd")),w.M_DiscountSchema_ID,t.getValueOfDecimal(w.FlatDiscount),t.getValueOfInt(f.getValue("QtyEntered"))),p=t.getValueOfDecimal(y.getTables()[0].getRows()[0].getCell("PriceList"))):t.getValueOfInt(f.getValue("M_AttributeSetInstance_ID"))>0&&(l="SELECT PriceStd , PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+v+" AND  ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL )   AND C_UOM_ID="+d,pt=n.DB.executeDataSet(l),pt.getTables().length>0&&pt.getTables()[0].getRows().length>0&&(c=this.FlatDiscount(b,i.getAD_Client_ID(),t.getValueOfDecimal(pt.getTables()[0].getRows()[0].getCell("PriceStd")),w.M_DiscountSchema_ID,t.getValueOfDecimal(w.FlatDiscount),t.getValueOfInt(f.getValue("QtyEntered"))),p=t.getValueOfDecimal(pt.getTables()[0].getRows()[0].getCell("PriceList"))))),l="SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y'  AND con.M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND con.C_UOM_ID = "+d+" AND con.C_UOM_To_ID = "+tt,nt=t.getValueOfDecimal(n.DB.executeScalar(l)),nt==0&&(l="SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y' AND con.C_UOM_ID = "+d+" AND con.C_UOM_To_ID = "+tt,nt=t.getValueOfDecimal(n.DB.executeScalar(l))),c=c*nt,p=p*nt,f.setValue("PriceList",p),f.setValue("PriceEntered",c),a=c,f.setValue("PriceActual",a))}if(e.getColumnName()!="QtyOrdered"&&e.getColumnName()!="QtyEntered"&&e.getColumnName()!="M_Product_ID"||"N"==i.getContext("DiscountSchema"))e.getColumnName()=="PriceActual"?(a=t.getValueOfDecimal(s),c=a,this.log.fine("PriceActual="+a+" -> PriceEntered="+c),f.setValue("PriceEntered",c)):e.getColumnName()=="PriceEntered"&&(c=t.getValueOfDecimal(s),g=b.toString().concat(",",tt.toString(),",",c.toString()),wt=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo",g),a=wt,t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO  WHERE PREFIX IN('VAPRC_','ED011_')"))>1&&(a=c),a==null&&(a=c),this.log.fine("PriceEntered="+c+" -> PriceActual="+a),f.setValue("PriceActual",a));else{ii=i.getContextAsInt(u,"C_BPartner_ID");e.getColumnName()=="QtyEntered"&&(rt=b.toString().concat(",",tt.toString()+","+yt.toString()),vt=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo",rt),ot=vt);ot==null&&(ot=yt);ri=i.getWindowContext(u,"IsSOTrx",!0)=="Y";r=t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='ED011_'"));var ft=t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='VAPRC_'")),oi=f.getValue("DateOrdered"),g=b.toString().concat(",",ii.toString(),",",ot.toString(),",",ri,",",ut.toString(),",","0,",oi.toString(),",",null,",",null,",",tt,",",r),ht=null;if(ht=n.dataContext.getJSONRecord("MProductPricing/GetProductPricing",g),kt=ht.PriceStd,r<=0&&ft<=0)g=b.toString().concat(",",tt.toString(),",",kt.toString()),wt=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",g),c=wt;else{rt=t.getValueOfInt(f.getValue("C_Order_ID")).toString();var ut=n.dataContext.getJSONRecord("MOrder/GetM_PriceList",rt),v=n.dataContext.getJSONRecord("MPriceListVersion/GetM_PriceList_Version_ID",ut.toString()),gt=i.getContextAsInt(u,"C_BPartner_ID",!1),w=n.dataContext.getJSONRecord("MBPartner/GetBPartner",gt.toString());r>0?l=t.getValueOfInt(f.getValue("M_AttributeSetInstance_ID"))>0?"SELECT COUNT(*) FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+v+" AND  M_AttributeSetInstance_ID = "+t.getValueOfInt(f.getValue("M_AttributeSetInstance_ID"))+"  AND C_UOM_ID="+t.getValueOfInt(f.getValue("C_UOM_ID")):"SELECT COUNT(*) FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+v+" AND  ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL )   AND C_UOM_ID="+t.getValueOfInt(f.getValue("C_UOM_ID")):ft>0&&(l=t.getValueOfInt(f.getValue("M_AttributeSetInstance_ID"))>0?"SELECT COUNT(*) FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+v+" AND  M_AttributeSetInstance_ID = "+t.getValueOfInt(f.getValue("M_AttributeSetInstance_ID")):"SELECT COUNT(*) FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+v+" AND  ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL )");ti=t.getValueOfInt(n.DB.executeScalar(l));ti>0?(r>0?l=t.getValueOfInt(f.getValue("M_AttributeSetInstance_ID"))>0?"SELECT PriceStd , PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+v+" AND  M_AttributeSetInstance_ID = "+t.getValueOfInt(f.getValue("M_AttributeSetInstance_ID"))+"  AND C_UOM_ID="+t.getValueOfInt(f.getValue("C_UOM_ID")):"SELECT PriceStd , PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+v+" AND  ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL )   AND C_UOM_ID="+t.getValueOfInt(f.getValue("C_UOM_ID")):ft>0&&(l=t.getValueOfInt(f.getValue("M_AttributeSetInstance_ID"))>0?"SELECT PriceStd , PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+v+" AND  M_AttributeSetInstance_ID = "+t.getValueOfInt(f.getValue("M_AttributeSetInstance_ID")):"SELECT PriceStd , PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+v+" AND  ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL ) "),y=n.DB.executeDataSet(l),y.getTables().length>0&&y.getTables()[0].getRows().length>0&&(c=this.FlatDiscount(b,i.getAD_Client_ID(),t.getValueOfDecimal(y.getTables()[0].getRows()[0].getCell("PriceStd")),w.M_DiscountSchema_ID,t.getValueOfDecimal(w.FlatDiscount),t.getValueOfInt(f.getValue("QtyEntered"))),p=t.getValueOfDecimal(y.getTables()[0].getRows()[0].getCell("PriceList")),f.setValue("PriceList",t.getValueOfDecimal(y.getTables()[0].getRows()[0].getCell("PriceList"))))):t.getValueOfInt(f.getValue("M_AttributeSetInstance_ID"))>0&&ti==0?(r>0?l="SELECT PriceStd , PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+v+" AND  ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL )   AND C_UOM_ID="+t.getValueOfInt(f.getValue("C_UOM_ID")):ft>0&&(l="SELECT PriceStd , PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+v+" AND  ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL ) "),ct=n.DB.executeDataSet(l),ct.getTables().length>0&&ct.getTables()[0].getRows().length>0&&(c=this.FlatDiscount(b,i.getAD_Client_ID(),t.getValueOfDecimal(ct.getTables()[0].getRows()[0].getCell("PriceStd")),w.M_DiscountSchema_ID,t.getValueOfDecimal(w.FlatDiscount),t.getValueOfInt(f.getValue("QtyEntered"))),p=t.getValueOfDecimal(ct.getTables()[0].getRows()[0].getCell("PriceList")),f.setValue("PriceList",t.getValueOfDecimal(ct.getTables()[0].getRows()[0].getCell("PriceList"))))):(g=b.toString(),d=n.dataContext.getJSONRecord("MProduct/GetC_UOM_ID",g),r>0?l=t.getValueOfInt(f.getValue("M_AttributeSetInstance_ID"))>0?"SELECT PriceStd , PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+v+" AND  M_AttributeSetInstance_ID = "+t.getValueOfInt(f.getValue("M_AttributeSetInstance_ID"))+"  AND C_UOM_ID="+d:"SELECT PriceStd , PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+v+" AND  ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL )   AND C_UOM_ID="+d:ft>0&&(l=t.getValueOfInt(f.getValue("M_AttributeSetInstance_ID"))>0?"SELECT PriceStd , PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+v+" AND  M_AttributeSetInstance_ID = "+t.getValueOfInt(f.getValue("M_AttributeSetInstance_ID")):"SELECT PriceStd , PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+v+" AND  ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL ) "),y=n.DB.executeDataSet(l),y.getTables().length>0&&(y.getTables()[0].getRows().length>0?(c=this.FlatDiscount(b,i.getAD_Client_ID(),t.getValueOfDecimal(y.getTables()[0].getRows()[0].getCell("PriceStd")),w.M_DiscountSchema_ID,t.getValueOfDecimal(w.FlatDiscount),t.getValueOfInt(f.getValue("QtyEntered"))),p=t.getValueOfDecimal(y.getTables()[0].getRows()[0].getCell("PriceList"))):t.getValueOfInt(f.getValue("M_AttributeSetInstance_ID"))>0&&(r>0?l="SELECT PriceStd , PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+v+" AND  ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL )   AND C_UOM_ID="+t.getValueOfInt(f.getValue("C_UOM_ID")):ft>0&&(l="SELECT PriceStd , PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+v+" AND  ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL ) "),bt=n.DB.executeDataSet(l),bt.getTables().length>0&&bt.getTables()[0].getRows().length>0&&(c=this.FlatDiscount(b,i.getAD_Client_ID(),t.getValueOfDecimal(bt.getTables()[0].getRows()[0].getCell("PriceStd")),w.M_DiscountSchema_ID,t.getValueOfDecimal(w.FlatDiscount),t.getValueOfInt(f.getValue("QtyEntered"))),p=t.getValueOfDecimal(bt.getTables()[0].getRows()[0].getCell("PriceList"))))),l="SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y'  AND con.M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND con.C_UOM_ID = "+d+" AND con.C_UOM_To_ID = "+tt,nt=t.getValueOfDecimal(n.DB.executeScalar(l)),nt==0&&(l="SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y' AND con.C_UOM_ID = "+d+" AND con.C_UOM_To_ID = "+tt,nt=t.getValueOfDecimal(n.DB.executeScalar(l))),c=c*nt,p=p*nt,f.setValue("PriceList",p))}c==null&&(c=kt);this.log.fine("QtyChanged -> PriceActual="+kt+", PriceEntered="+c+", Discount="+ht.Discount);a=ht.PriceStd;f.setValue("PriceActual",c);r<=0&&ft<=0?f.setValue("Discount",ht.Discount):(a=c,f.setValue("Discount",(t.getValueOfDecimal(f.getValue("PriceList"))-c)/t.getValueOfDecimal(f.getValue("PriceList"))*100));f.setValue("PriceEntered",c);i.setContext(u,"DiscountSchema",ht.DiscountSchema?"Y":"N")}if(e.getColumnName()=="Discount")a=t.getValueOfDecimal((100-k)/100*p),t.scale(a)>et&&(a=a.toFixed(et)),c=a,c==null&&(c=a),f.setValue("PriceActual",a),f.setValue("PriceEntered",c);else{if(p==0)k=n.Env.ZERO;else if(k=t.getValueOfDecimal((p-a)/p*100),isNaN(k))return this.setCalloutActive(!1),"PriceListNotSelected";k=k.toFixed(2);f.setValue("Discount",k)}this.log.fine("PriceEntered="+c+", Actual="+a+", Discount="+k);var ui=!1,lt=i.getContext("EnforcePriceLimit"),dt=i.isSOTrx()&&lt!=null&&lt=="Y";if(lt==""){var rt=t.getValueOfInt(f.getValue("C_Order_ID")).toString(),fi=n.dataContext.getJSONRecord("MOrder/GetOrder",rt),l="SELECT EnforcePriceLimit FROM M_PriceList WHERE IsActive = 'Y' AND M_PriceList_ID = "+fi.M_PriceList_ID;lt=n.DB.executeScalar(l);dt=fi.IsSOTrx&&lt!=null&&lt=="Y";l="SELECT OverwritePriceLimit FROM AD_Role WHERE IsActive = 'Y' AND AD_Role_ID = "+i.getContext("#AD_Role_ID");ui=t.getValueOfBoolean(n.DB.executeScalar(l))}ei="Y"==i.getContext("IsReturnTrx");dt&&(ui||ei)&&(dt=!1);dt&&it!=0&&a.compareTo(it)<0&&(a=it,c=a,c==null&&(c=it),this.log.fine("(under) PriceEntered="+c+", Actual"+it),f.setValue("PriceActual",it),f.setValue("PriceEntered",c),n.ADialog.info("UnderLimitPrice",!0,"",""),p!=0&&(k=t.getValueOfDecimal((p-a)/p*100),k=k.toFixed(2),f.setValue("Discount",k)));c=t.getValueOfDecimal(f.getValue("PriceEntered"));at=yt*c;t.scale(at)>et&&(at=at.toFixed(et));this.log.info("LineNetAmt="+at);f.setValue("LineNetAmt",at)}catch(si){return this.setCalloutActive(!1),si}return this.setCalloutActive(!1),i=u=f=e=s=h=null,""};u.prototype.FlatDiscount=function(i,r,u,f,e,o){var y=u,a="SELECT UNIQUE M_Product_Category_ID FROM M_Product WHERE IsActive='Y' AND M_Product_ID = "+i,p=t.getValueOfInt(n.DB.executeScalar(a)),l=!1,v,h,s,c;if(a="SELECT  DiscountType  FROM M_DiscountSchema WHERE M_DiscountSchema_ID = "+f+" AND IsActive='Y'  AND AD_Client_ID="+r,v=t.getValueOfString(n.DB.executeScalar(a)),v=="F")return l=!0,u-u*e/100;if(v=="B"){if(a="SELECT M_Product_Category_ID , M_Product_ID , BreakValue , IsBPartnerFlatDiscount , BreakDiscount FROM M_DiscountSchemaBreak WHERE M_DiscountSchema_ID = "+f+" AND M_Product_ID = "+i+" AND IsActive='Y'  AND AD_Client_ID="+r+"Order BY BreakValue DESC",h=n.DB.executeDataSet(a),h.getTables().length>0){for(s=0,c=0,s=0;s<h.getTables()[0].getRows().length;s++)if(!(o<t.getValueOfDecimal(h.getTables()[0].getRows()[s].getCell("BreakValue"))))if(t.getValueOfString(h.getTables()[0].getRows()[0].getCell("IsBPartnerFlatDiscount"))=="N"){l=!0;c=u-u*t.getValueOfDecimal(h.getTables()[0].getRows()[s].getCell("BreakDiscount"))/100;break}else{l=!0;c=u-u*e/100;break}if(l)return c}if(a="SELECT M_Product_Category_ID , M_Product_ID , BreakValue , IsBPartnerFlatDiscount , BreakDiscount FROM M_DiscountSchemaBreak WHERE  M_DiscountSchema_ID = "+f+" AND M_Product_Category_ID = "+p+" AND IsActive='Y'  AND AD_Client_ID="+r+"Order BY BreakValue DESC",h=n.DB.executeDataSet(a),h.getTables().length>0){for(s=0,c=0,s=0;s<h.getTables()[0].getRows().length;s++)if(!(o<t.getValueOfDecimal(h.getTables()[0].getRows()[s].getCell("BreakValue"))))if(t.getValueOfString(h.getTables()[0].getRows()[0].getCell("IsBPartnerFlatDiscount"))=="N"){l=!0;c=u-u*t.getValueOfDecimal(h.getTables()[0].getRows()[s].getCell("BreakDiscount"))/100;break}else{l=!0;c=u-u*e/100;break}if(l)return c}if(a="SELECT M_Product_Category_ID , M_Product_ID , BreakValue , IsBPartnerFlatDiscount , BreakDiscount FROM M_DiscountSchemaBreak WHERE  M_DiscountSchema_ID = "+f+" AND M_Product_Category_ID IS NULL AND m_product_id IS NULL  AND IsActive='Y'  AND AD_Client_ID="+r+"Order BY BreakValue DESC",h=n.DB.executeDataSet(a),h.getTables().length>0){for(s=0,c=0,s=0;s<h.getTables()[0].getRows().length;s++)if(!(o<t.getValueOfDecimal(h.getTables()[0].getRows()[s].getCell("BreakValue"))))if(t.getValueOfString(h.getTables()[0].getRows()[0].getCell("IsBPartnerFlatDiscount"))=="N"){l=!0;c=u-u*t.getValueOfDecimal(h.getTables()[0].getRows()[s].getCell("BreakDiscount"))/100;break}else{l=!0;c=u-u*e/100;break}if(l)return c}}return y};u.prototype.Qty=function(i,u,f,e,s,h){var a="",p,hi,et,pt,wt,gt,li,ti,y,ri,ui,k,bt,d,v,w,b,ut,st,ht,fi,it,ot,ei,nt,oi,ai,at,yt,si,vi;if(this.isCalloutActive()||s==null||s.toString()==""||(console.log("Before Charge Or Product"),t.getValueOfInt(f.getValue("C_Charge_ID"))==0&&t.getValueOfInt(f.getValue("M_Product_ID"))==0))return"";console.log("After Charge Or Product");this.setCalloutActive(!0);try{p=i.getContextAsInt(u,"M_Product_ID");o&&this.log.Warning("init - M_Product_ID="+p+" - ");var l=n.Env.ZERO,c=n.Env.ZERO,rt,g,kt="Y"==i.getContext("IsReturnTrx");if(p==0)c=t.getValueOfDecimal(f.getValue("QtyEntered")),l=c,f.setValue("QtyOrdered",l);else if(e.getColumnName()=="C_UOM_ID")if(y=t.getValueOfInt(s),c=t.getValueOfDecimal(f.getValue("QtyEntered")),hi=i.getContextAsInt(u,"C_BPartner_ID",!1),et=n.dataContext.getJSONRecord("MBPartner/GetBPartner",hi.toString()),r=t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='ED011_'")),r>0){vt=f.getValue("C_Order_ID").toString();var dt=n.dataContext.getJSONRecord("MOrder/GetM_PriceList",vt),tt=n.dataContext.getJSONRecord("MPriceListVersion/GetM_PriceList_Version_ID",dt.toString()),ci=!1;if(sql="SELECT PriceList , PriceStd , PriceLimit FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+tt+" AND  M_AttributeSetInstance_ID = "+t.getValueOfInt(f.getValue("M_AttributeSetInstance_ID"))+"  AND C_UOM_ID="+y,k=n.DB.executeDataSet(sql),k.getTables().length>0)if(k.getTables()[0].getRows().length>0)ci=!0,pt=this.FlatDiscount(p,i.getAD_Client_ID(),t.getValueOfDecimal(k.getTables()[0].getRows()[0].getCell("PriceStd")),et.M_DiscountSchema_ID,t.getValueOfDecimal(et.FlatDiscount),t.getValueOfInt(f.getValue("QtyEntered"))),f.setValue("PriceList",t.getValueOfDecimal(k.getTables()[0].getRows()[0].getCell("PriceList"))),f.setValue("PriceLimit",t.getValueOfDecimal(k.getTables()[0].getRows()[0].getCell("PriceLimit"))),f.setValue("PriceActual",pt),f.setValue("PriceEntered",pt),a=y.toString().concat(","),d=n.dataContext.getJSONRecord("MUOM/GetPrecision",a),v=c.toFixed(t.getValueOfInt(d)),c!=v&&(this.log.fine("Corrected QtyEntered Scale UOM="+y+"; QtyEntered="+c+"->"+v),c=v,f.setValue("QtyEntered",c)),a=p.toString().concat(",",y.toString(),",",c.toString()),b=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a),l=b,w=!1,l!=null&&(w=c!=l),l==null&&(w=!1,l=1),w?f.setValue("QtyOrdered",l):f.setValue("QtyOrdered",l*v),f.setValue("PriceActual",pt),f.setValue("PriceList",t.getValueOfDecimal(k.getTables()[0].getRows()[0].getCell("PriceList")));else if(ci==!1&&(sql="SELECT PriceList , PriceStd , PriceLimit FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+tt+" AND ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL ) AND C_UOM_ID="+y,k=n.DB.executeDataSet(sql),k.getTables().length>0))if(k.getTables()[0].getRows().length>0)wt=this.FlatDiscount(p,i.getAD_Client_ID(),t.getValueOfDecimal(k.getTables()[0].getRows()[0].getCell("PriceStd")),et.M_DiscountSchema_ID,t.getValueOfDecimal(et.FlatDiscount),t.getValueOfInt(f.getValue("QtyEntered"))),f.setValue("PriceList",t.getValueOfDecimal(k.getTables()[0].getRows()[0].getCell("PriceList"))),f.setValue("PriceLimit",t.getValueOfDecimal(k.getTables()[0].getRows()[0].getCell("PriceLimit"))),f.setValue("PriceActual",wt),f.setValue("PriceEntered",wt),a=y.toString().concat(","),d=n.dataContext.getJSONRecord("MUOM/GetPrecision",a),v=c.toFixed(t.getValueOfInt(d)),c!=v&&(this.log.fine("Corrected QtyEntered Scale UOM="+y+"; QtyEntered="+c+"->"+v),c=v,f.setValue("QtyEntered",c)),a=p.toString().concat(",",y.toString(),",",c.toString()),b=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a),l=b,w=!1,l!=null&&(w=c!=l),l==null&&(w=!1,l=1),w?f.setValue("QtyOrdered",l):f.setValue("QtyOrdered",l*v),f.setValue("PriceActual",wt),f.setValue("PriceList",t.getValueOfDecimal(k.getTables()[0].getRows()[0].getCell("PriceList")));else{a=y.toString().concat(",");d=n.dataContext.getJSONRecord("MUOM/GetPrecision",a);v=c.toFixed(t.getValueOfInt(d));c!=v&&(this.log.fine("Corrected QtyEntered Scale UOM="+y+"; QtyEntered="+c+"->"+v),c=v,f.setValue("QtyEntered",c));a=p.toString().concat(",",y.toString(),",",c.toString());b=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a);l=b;l==null&&(l=c);w=c!=l;rt=t.getValueOfDecimal(f.getValue("PriceEntered"));a=p.toString().concat(",",y.toString(),",",rt.toString());b=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a);g=b;g==null&&(g=rt);this.log.fine("UOM="+y+", QtyEntered/PriceActual="+c+"/"+rt+" -> "+w+" QtyOrdered/PriceEntered="+l+"/"+g);i.setContext(u,"UOMConversion",w?"Y":"N");f.setValue("QtyOrdered",l);f.setValue("PriceEntered",g);a=p.toString();var ut=n.dataContext.getJSONRecord("MProduct/GetC_UOM_ID",a),st=0,ht=0;t.getValueOfInt(f.getValue("M_AttributeSetInstance_ID"))>0?(sql="SELECT PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+tt+" AND  M_AttributeSetInstance_ID = "+t.getValueOfInt(f.getValue("M_AttributeSetInstance_ID"))+" AND C_UOM_ID="+ut,st=t.getValueOfDecimal(n.DB.executeScalar(sql)),sql="SELECT PriceStd FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+tt+" AND  M_AttributeSetInstance_ID = "+t.getValueOfInt(f.getValue("M_AttributeSetInstance_ID"))+" AND C_UOM_ID="+ut,ht=t.getValueOfDecimal(n.DB.executeScalar(sql))):(sql="SELECT PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+tt+" AND ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL ) AND C_UOM_ID="+ut,st=t.getValueOfDecimal(n.DB.executeScalar(sql)),sql="SELECT PriceStd FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+tt+" AND ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL ) AND C_UOM_ID="+ut,ht=t.getValueOfDecimal(n.DB.executeScalar(sql)));gt=this.FlatDiscount(p,i.getAD_Client_ID(),ht,et.M_DiscountSchema_ID,t.getValueOfDecimal(et.FlatDiscount),t.getValueOfInt(f.getValue("QtyEntered")));sql="SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y'  AND con.M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND con.C_UOM_ID = "+ut+" AND con.C_UOM_To_ID = "+y;it=t.getValueOfDecimal(n.DB.executeScalar(sql));it==0&&(sql="SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y' AND con.C_UOM_ID = "+ut+" AND con.C_UOM_To_ID = "+y,it=t.getValueOfDecimal(n.DB.executeScalar(sql)));f.setValue("PriceList",st*it);f.setValue("PriceActual",gt*it);f.setValue("PriceEntered",gt*it)}}else a=y.toString().concat(","),d=n.dataContext.getJSONRecord("MUOM/GetPrecision",a),v=c.toFixed(t.getValueOfInt(d)),c!=v&&(this.log.fine("Corrected QtyEntered Scale UOM="+y+"; QtyEntered="+c+"->"+v),c=v,f.setValue("QtyEntered",c)),a=p.toString().concat(",",y.toString(),",",c.toString()),b=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a),l=b,l==null&&(l=c),w=c!=l,rt=t.getValueOfDecimal(f.getValue("PriceActual")),a=p.toString().concat(",",y.toString(),",",rt.toString()),b=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a),g=b,g==null&&(g=rt),this.log.fine("UOM="+y+", QtyEntered/PriceActual="+c+"/"+rt+" -> "+w+" QtyOrdered/PriceEntered="+l+"/"+g),i.setContext(u,"UOMConversion",w?"Y":"N"),f.setValue("QtyOrdered",l),f.setValue("PriceEntered",g);else if(e.getColumnName()=="QtyEntered")y=i.getContextAsInt(u,"C_UOM_ID"),c=t.getValueOfDecimal(s),a=y.toString().concat(","),d=n.dataContext.getJSONRecord("MUOM/GetPrecision",a),v=c.toFixed(t.getValueOfInt(d)),c!=v&&(this.log.fine("Corrected QtyEntered Scale UOM="+y+"; QtyEntered="+c+"->"+v),c=v,f.setValue("QtyEntered",c)),a=p.toString().concat(",",y.toString(),",",c.toString()),b=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a),l=b,l==null&&(l=c),w=c!=l,this.log.fine("UOM="+y+", QtyEntered="+c+" -> "+w+" QtyOrdered="+l),i.setContext(u,"UOMConversion",w?"Y":"N"),f.setValue("QtyOrdered",l);else if(e.getColumnName()=="QtyOrdered"){y=i.getContextAsInt(u,"C_UOM_ID");l=t.getValueOfDecimal(s);a=p.toString().concat(",");var d=n.dataContext.getJSONRecord("MProduct/GetUOMPrecision",a),yi=d,ni=l.toFixed(yi);l!=ni&&(this.log.fine("Corrected QtyOrdered Scale "+l+"->"+ni),l=ni,f.setValue("QtyOrdered",l));a=p.toString().concat(",",y.toString(),",",l.toString());li=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo",a);c=li;c==null&&(c=l);w=l!=c;this.log.fine("UOM="+y+", QtyOrdered="+l+" -> "+w+" QtyEntered="+c);i.setContext(u,"UOMConversion",w?"Y":"N");f.setValue("QtyEntered",c)}else l=t.getValueOfDecimal(f.getValue("QtyOrdered"));if(p!=0&&kt&&(ti=t.getValueOfInt(f.getValue("Orig_InOutLine_ID")),ti!=0)){a=ti.toString();var ii=n.dataContext.getJSONRecord("MInOutLine/GetMInOutLine",a),pi=ii.MovementQty,lt=t.getValueOfDecimal(pi);l=t.getValueOfDecimal(f.getValue("QtyOrdered"));lt<l&&(i.isSOTrx()?n.ADialog.info("QtyShippedAndReturned",null,lt.toString(),""):n.ADialog.info("QtyRecievedAndReturnd",null,lt.toString(),""),f.setValue("QtyOrdered",lt),l=lt,y=i.getContextAsInt(u,"C_UOM_ID"),a=p.toString().concat(",",y.toString(),",",l.toString()),c=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo",a),c==null&&(c=l),f.setValue("QtyEntered",c),this.log.fine("QtyEntered : "+c.toString()+"QtyOrdered : "+l.toString()))}if(p!=0&&i.isSOTrx()&&l>0&&!kt&&e.getColumnName()=="M_AttributeSetInstance_ID"){r=t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='ED011_'"));ri=t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='VAPRC_'"));vt=f.getValue("C_Order_ID").toString();var dt=n.dataContext.getJSONRecord("MOrder/GetM_PriceList",vt),tt=n.dataContext.getJSONRecord("MPriceListVersion/GetM_PriceList_Version_ID",dt.toString()),wi=i.getContextAsInt(u,"C_BPartner_ID",!1),ft=n.dataContext.getJSONRecord("MBPartner/GetBPartner",wi.toString());r>0&&ri>0&&(sql="SELECT PriceList , PriceStd , PriceLimit FROM M_ProductPrice WHERE IsActive='Y' AND M_Product_ID = "+p+" AND C_UOM_ID ="+t.getValueOfInt(f.getValue("C_UOM_ID"))+" AND M_AttributeSetInstance_ID = "+s+" AND M_PriceList_Version_ID = "+tt,nt=n.DB.executeDataSet(sql),nt!=null&&nt.getTables().length>0&&(nt.getTables()[0].getRows().length>0?(ui=this.FlatDiscount(p,i.getAD_Client_ID(),t.getValueOfDecimal(nt.getTables()[0].getRows()[0].getCell("PriceStd")),ft.M_DiscountSchema_ID,t.getValueOfDecimal(ft.FlatDiscount),t.getValueOfInt(f.getValue("QtyEntered"))),f.setValue("PriceList",t.getValueOfDecimal(nt.getTables()[0].getRows()[0].getCell("PriceList"))),f.setValue("PriceLimit",t.getValueOfDecimal(nt.getTables()[0].getRows()[0].getCell("PriceLimit"))),f.setValue("PriceActual",ui),f.setValue("PriceEntered",ui)):(c=t.getValueOfDecimal(f.getValue("QtyEntered")),sql="SELECT PriceList , PriceStd , PriceLimit FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+tt+" AND ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL ) AND C_UOM_ID="+t.getValueOfInt(f.getValue("C_UOM_ID")),k=n.DB.executeDataSet(sql),k.getTables().length>0&&(k.getTables()[0].getRows().length>0?(bt=this.FlatDiscount(p,i.getAD_Client_ID(),t.getValueOfDecimal(k.getTables()[0].getRows()[0].getCell("PriceStd")),ft.M_DiscountSchema_ID,t.getValueOfDecimal(ft.FlatDiscount),t.getValueOfInt(f.getValue("QtyEntered"))),f.setValue("PriceList",t.getValueOfDecimal(k.getTables()[0].getRows()[0].getCell("PriceList"))),f.setValue("PriceLimit",t.getValueOfDecimal(k.getTables()[0].getRows()[0].getCell("PriceLimit"))),f.setValue("PriceActual",bt),f.setValue("PriceEntered",bt),a=f.getValue("C_UOM_ID").toString().concat(","),d=n.dataContext.getJSONRecord("MUOM/GetPrecision",a),v=c.toFixed(t.getValueOfInt(d)),c!=v&&(this.log.fine("Corrected QtyEntered Scale UOM="+t.getValueOfInt(f.getValue("C_UOM_ID"))+"; QtyEntered="+c+"->"+v),c=v,f.setValue("QtyEntered",c)),a=p.toString().concat(",",f.getValue("C_UOM_ID").toString(),",",c.toString()),b=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a),l=b,w=!1,l!=null&&(w=c!=l),l==null&&(w=!1,l=1),w?f.setValue("QtyOrdered",l):f.setValue("QtyOrdered",l*v),f.setValue("PriceActual",bt),f.setValue("PriceList",t.getValueOfDecimal(k.getTables()[0].getRows()[0].getCell("PriceList")))):(a=f.getValue("C_UOM_ID").toString().concat(","),d=n.dataContext.getJSONRecord("MUOM/GetPrecision",a),v=c.toFixed(t.getValueOfInt(d)),c!=v&&(this.log.fine("Corrected QtyEntered Scale UOM="+t.getValueOfInt(f.getValue("C_UOM_ID"))+"; QtyEntered="+c+"->"+v),c=v,f.setValue("QtyEntered",c)),a=p.toString().concat(",",f.getValue("C_UOM_ID").toString(),",",c.toString()),b=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a),l=b,l==null&&(l=c),w=c!=l,rt=t.getValueOfDecimal(f.getValue("PriceEntered")),a=p.toString().concat(",",f.getValue("C_UOM_ID").toString(),",",rt.toString()),b=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a),g=b,g==null&&(g=rt),this.log.fine("UOM="+y+", QtyEntered/PriceActual="+c+"/"+rt+" -> "+w+" QtyOrdered/PriceEntered="+l+"/"+g),i.setContext(u,"UOMConversion",w?"Y":"N"),f.setValue("QtyOrdered",l),f.setValue("PriceEntered",g),a=p.toString(),ut=n.dataContext.getJSONRecord("MProduct/GetC_UOM_ID",a),sql="SELECT PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+tt+" AND ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL ) AND C_UOM_ID="+ut,st=t.getValueOfDecimal(n.DB.executeScalar(sql)),sql="SELECT PriceStd FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+tt+" AND ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL ) AND C_UOM_ID="+ut,ht=t.getValueOfDecimal(n.DB.executeScalar(sql)),fi=this.FlatDiscount(p,i.getAD_Client_ID(),ht,ft.M_DiscountSchema_ID,t.getValueOfDecimal(ft.FlatDiscount),t.getValueOfInt(f.getValue("QtyEntered"))),sql="SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y'  AND con.M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND con.C_UOM_ID = "+ut+" AND con.C_UOM_To_ID = "+t.getValueOfInt(f.getValue("C_UOM_ID")),it=t.getValueOfDecimal(n.DB.executeScalar(sql)),it==0&&(sql="SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y' AND con.C_UOM_ID = "+ut+" AND con.C_UOM_To_ID = "+t.getValueOfInt(f.getValue("C_UOM_ID")),it=t.getValueOfDecimal(n.DB.executeScalar(sql))),f.setValue("PriceList",st*it),f.setValue("PriceActual",fi*it),f.setValue("PriceEntered",fi*it))))));r<=0&&ri>0&&(sql="SELECT PriceList , PriceStd , PriceLimit FROM M_ProductPrice WHERE IsActive='Y' AND M_Product_ID = "+p+" AND M_AttributeSetInstance_ID =  "+s+" AND M_PriceList_Version_ID = "+tt,ot=n.DB.executeDataSet(sql),ot.getTables().length>0&&(ot.getTables()[0].getRows().length>0?(ei=this.FlatDiscount(p,i.getAD_Client_ID(),t.getValueOfDecimal(ot.getTables()[0].getRows()[0].getCell("PriceStd")),ft.M_DiscountSchema_ID,t.getValueOfDecimal(ft.FlatDiscount),t.getValueOfInt(f.getValue("QtyEntered"))),f.setValue("PriceList",t.getValueOfDecimal(ot.getTables()[0].getRows()[0].getCell("PriceList"))),f.setValue("PriceLimit",t.getValueOfDecimal(ot.getTables()[0].getRows()[0].getCell("PriceLimit"))),f.setValue("PriceActual",ei),f.setValue("PriceEntered",ei)):(sql="SELECT PriceList , PriceStd , PriceLimit FROM M_ProductPrice WHERE IsActive='Y' AND M_Product_ID = "+p+" AND M_AttributeSetInstance_ID = 0  AND M_PriceList_Version_ID = "+tt,nt=n.DB.executeDataSet(sql),nt!=null&&nt.getTables().length>0&&nt.getTables()[0].getRows().length>0&&(oi=this.FlatDiscount(p,i.getAD_Client_ID(),t.getValueOfDecimal(ot.getTables()[0].getRows()[0].getCell("PriceStd")),ft.M_DiscountSchema_ID,t.getValueOfDecimal(ft.FlatDiscount),t.getValueOfInt(f.getValue("QtyEntered"))),f.setValue("PriceList",t.getValueOfDecimal(nt.getTables()[0].getRows()[0].getCell("PriceList"))),f.setValue("PriceLimit",t.getValueOfDecimal(nt.getTables()[0].getRows()[0].getCell("PriceLimit"))),f.setValue("PriceActual",oi),f.setValue("PriceEntered",oi)))))}if(p!=0&&i.isSOTrx()&&l>0&&!kt&&(ai=n.dataContext.getJSONRecord("MProduct/GetProduct",p.toString()),at=0,t.getValueOfBoolean(ai.IsStocked))){var bi=i.getContextAsInt(u,"M_Warehouse_ID"),ki=i.getContextAsInt(u,"M_AttributeSetInstance_ID"),vt=p.toString().concat(",",bi.toString(),",",ki.toString(),",",at.toString()),ii=null,ct=n.dataContext.getJSONRecord("MStorage/GetQtyAvailable",vt);ct==null&&(ct=n.Env.ZERO);ct==0||ct.toString().compareTo(l)<0||(at=f.getValue("C_OrderLine_ID")==""?0:t.getValueOfInt(f.getValue("C_OrderLine_ID")),at==null&&(at=0),yt=ii.notReserved,yt==null&&(yt=n.Env.ZERO),si=ct-yt,si<l&&(vi=n.Msg.parseTranslation(i,"@QtyAvailable@="+ct+"  -  @QtyNotReserved@="+yt+"  =  "+si),n.ADialog.info("InsufficientQtyAvailable",null,vi,"")))}}catch(di){return this.setCalloutActive(!1),di}return this.setCalloutActive(!1),i=u=f=e=s=h=null,""};u.prototype.Orig_Order=function(i,r,u,f,e,o){var h,s,a,v,l,c;if(this.isCalloutActive()||e==null||e.toString()==""||(h=t.getValueOfInt(e),h==null||h==0))return"";this.setCalloutActive(!0);try{s=n.dataContext.getJSONRecord("MOrder/GetOrder",h.toString());a=n.dataContext.getJSONRecord("MBPartner/GetBPartner",s.C_BPartner_ID.toString());u.setValue("Orig_InOut_ID",null);u.setValue("C_BPartner_ID",t.getValueOfInt(s.C_BPartner_ID));u.setValue("C_BPartner_Location_ID",t.getValueOfInt(s.C_BPartner_Location_ID));u.setValue("Bill_BPartner_ID",t.getValueOfInt(s.Bill_BPartner_ID));u.setValue("Bill_Location_ID",t.getValueOfInt(s.Bill_Location_ID));s.AD_User_ID!=0&&u.setValue("AD_User_ID",t.getValueOfInt(s.AD_User_ID));s.Bill_User_ID!=0&&u.setValue("Bill_User_ID",t.getValueOfInt(s.Bill_User_ID));i.isSOTrx()?u.setValue("M_ReturnPolicy_ID",t.getValueOfInt(a.M_ReturnPolicy_ID)):u.setValue("M_ReturnPolicy_ID",t.getValueOfInt(a.PO_ReturnPolicy_ID));u.setValue("M_PriceList_ID",t.getValueOfInt(s.M_PriceList_ID));u.setValue("PaymentRule",s.PaymentRule);u.setValue("C_PaymentTerm_ID",t.getValueOfInt(s.C_PaymentTerm_ID));u.setValue("Bill_Location_ID",t.getValueOfInt(s.Bill_Location_ID));u.setValue("InvoiceRule",s.InvoiceRule);u.setValue("PaymentRule",s.PaymentRule);u.setValue("DeliveryViaRule",s.DeliveryViaRule);u.setValue("FreightCostRule",s.FreightCostRule);v=t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='VA009_'  AND IsActive = 'Y'"));v>0&&(l=n.DB.executeScalar("SELECT VA009_PaymentMethod_ID FROM C_Order WHERE C_Order_ID="+h),l>0&&(u.setValue("VA009_PaymentMethod_ID",l),c=n.DB.executeScalar("SELECT VA009_PaymentBaseType FROM VA009_PaymentMethod WHERE VA009_PaymentMethod_ID="+l),c!="W"&&c!=null&&(u.setValue("PaymentMethod",c),u.setValue("PaymentRule",c))))}catch(y){this.setCalloutActive(!1)}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};u.prototype.Orig_InOut=function(i,r,u,f,e,o){var h,s;if(this.isCalloutActive()||e==null||e.toString()=="")return"";try{if(h=t.getValueOfInt(e),h==null||h==0)return"";this.setCalloutActive(!0);s=n.dataContext.getJSONRecord("MInOut/GetInOut",h.toString());u.setValue("C_Project_ID",t.getValueOfInt(s.C_Project_ID));u.setValue("C_Campaign_ID",t.getValueOfInt(s.C_Campaign_ID));u.setValue("C_Activity_ID",t.getValueOfInt(s.C_Activity_ID));u.setValue("AD_OrgTrx_ID",t.getValueOfInt(s.AD_OrgTrx_ID));u.setValue("User1_ID",t.getValueOfInt(s.User1_ID));u.setValue("User2_ID",t.getValueOfInt(s.User2_ID))}catch(c){this.setCalloutActive(!1)}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};u.prototype.Orig_OrderLine=function(i,r,u,f,e,o){var c,s,a,v,l,y,h;if(this.isCalloutActive()||e==null||e.toString()=="")return"";try{if(c=t.getValueOfInt(e),c==null||c==0)return"";this.setCalloutActive(!0);s=n.dataContext.getJSONRecord("MOrderLine/GetOrderLine",c.toString());u.setValue("Orig_InOutLine_ID",null);u.setValue("C_Tax_ID",t.getValueOfInt(s.C_Tax_ID));u.setValue("PriceList",t.getValueOfDecimal(s.PriceList));u.setValue("PriceLimit",t.getValueOfDecimal(s.PriceLimit));u.setValue("PriceActual",t.getValueOfDecimal(s.PriceActual));u.setValue("PriceEntered",t.getValueOfDecimal(s.PriceEntered));u.setValue("C_Currency_ID",t.getValueOfInt(s.C_Currency_ID));u.setValue("Discount",t.getValueOfDecimal(s.Discount));a=i.getContextAsInt(r,"M_PriceList_ID");v=n.dataContext.getJSONRecord("MPriceList/GetPriceList",a.toString());l=t.getValueOfInt(v.StdPrecision);y=t.getValueOfDecimal(u.getValue("QtyOrdered"));h=y*t.getValueOfDecimal(s.PriceActual);t.scale(h)>l&&(h=h.toFixed(l));this.log.info("LineNetAmt="+h);u.setValue("LineNetAmt",h)}catch(p){this.setCalloutActive(!1)}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};u.prototype.Orig_InOutLine=function(i,r,u,f,e,o){var h,s;if(this.isCalloutActive()||e==null||e.toString()=="")return"";try{if(h=t.getValueOfInt(e),h==null||h==0)return"";this.setCalloutActive(!0);s=n.dataContext.getJSONRecord("MInOutLine/GetMInOutLine",h.toString());s!=null&&(u.setValue("C_Project_ID",t.getValueOfInt(s.C_Project_ID)),u.setValue("C_Campaign_ID",t.getValueOfInt(s.C_Campaign_ID)),u.setValue("M_Product_ID",t.getValueOfInt(s.M_Product_ID)),u.setValue("M_AttributeSetInstance_ID",t.getValueOfInt(s.M_AttributeSetInstance_ID)),u.setValue("C_UOM_ID",t.getValueOfInt(s.C_UOM_ID)))}catch(c){this.setCalloutActive(!1)}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};n.Model.CalloutOrder=u;n.Utility.inheritPrototype(ni,n.CalloutEngine);ni.prototype.Product=function(r,u,f,e,o,s){var c,v;if(o==null||o.toString()==""||this.isCalloutActive()||o==null||(c=t.getValueOfInt(o),c==0))return"";this.setCalloutActive(!0);var l=0,a=null,y=null,p=null,w="SELECT p.M_Product_ID, ra.Name, ra.Description, ra.Qty FROM S_ResourceAssignment ra INNER JOIN M_Product p ON (p.S_Resource_ID=ra.S_Resource_ID) WHERE ra.S_ResourceAssignment_ID="+c,h=null;try{h=n.DB.executeReader(w,null,null);h.read()&&(l=t.getValueOfInt(h.get(0)),a=t.getValueOfString(h.get(1)),y=t.getValueOfString(h.get(2)),p=t.getValueOfDecimal(h.get(3)));h.close()}catch(b){h!=null&&(h.close(),h=null);this.setCalloutActive(!1);this.log.log(i.SEVERE,"product",b)}return this.log.fine("S_ResourceAssignment_ID="+c+" - M_Product_ID="+l),l!=0&&(f.setValue("M_Product_ID",t.getValueOfInt(l)),y!=null&&(a+=" ("+y+")"),"."!=a&&f.setValue("Description",a),v="Qty",f.getTableName().startsWith("C_Order")?v="QtyOrdered":f.getTableName().startsWith("C_Invoice")&&(v="QtyInvoiced"),p!=null&&f.setValue(v,p)),this.setCalloutActive(!1),r=u=f=e=o=s=null,""};n.Model.CalloutAssignment=ni;n.Utility.inheritPrototype(h,n.CalloutEngine);h.prototype.Invoice=function(r,u,f,e,o,s){var l,a,g;if(this.isCalloutActive()||o==null||o.toString()=="")return"";this.setCalloutActive(!0);var v=t.getValueOfInt(o),p=0,k=0,w=0,d="SELECT * FROM   (SELECT ips.C_InvoicePaySchedule_ID,  ips.DueAmt  FROM C_Invoice i  INNER JOIN C_InvoicePaySchedule ips  ON (i.C_Invoice_ID        =ips.C_Invoice_ID)  WHERE i.IsPayScheduleValid='Y'  AND ips.IsValid           ='Y'  AND ips.isactive          ='Y'  AND i.C_Invoice_ID    = "+v+"  AND ips.C_InvoicePaySchedule_ID NOT IN(SELECT NVL(C_InvoicePaySchedule_ID,0) FROM C_InvoicePaySchedule WHERE c_payment_id IN(SELECT NVL(c_payment_id,0) FROM C_InvoicePaySchedule)  union  SELECT NVL(C_InvoicePaySchedule_id,0) FROM C_InvoicePaySchedule  WHERE c_cashline_id IN(SELECT NVL(c_cashline_id,0) FROM C_InvoicePaySchedule ))  ORDER BY ips.duedate ASC  ) WHERE rownum=1",c=null;try{c=n.DB.executeReader(d,null,null);c.read()&&(k=t.getValueOfInt(c.get("c_invoicepayschedule_id")),f.setValue("C_InvoicePaySchedule_ID",k),p=t.getValueOfDecimal(c.get("dueamt")),w=1);c.close()}catch(y){return c!=null&&c.close(),this.log.log(i.SEVERE,d,y.message),y.toString()}if(v==null||v==0)return f.setValue("C_Currency_ID",null),this.setCalloutActive(!1),"";var b=new Date(r.getContext(u,"DateAcct")),tt="TO_DATE( '"+(Number(b.getMonth())+1)+"-"+b.getDate()+"-"+b.getFullYear()+"', 'MM-DD-YYYY')",it="SELECT C_BPartner_ID, C_Currency_ID, invoiceOpen(C_Invoice_ID, 0) as invoiceOpen, IsSOTrx, paymentTermDiscount(invoiceOpen(C_Invoice_ID, 0),C_Currency_ID,C_PaymentTerm_ID,DateInvoiced, "+tt+" ) as paymentTermDiscount,C_DocTypeTarget_ID FROM C_Invoice WHERE C_Invoice_ID="+v,h=null;try{if(h=n.DB.executeReader(it,null,null),h!=null){if(h.read()){l=0;f.setValue("C_BPartner_ID",t.getValueOfInt(h.get("c_bpartner_id")));f.setValue("C_Currency_ID",t.getValueOfInt(h.get("c_currency_id")));l=w==0?t.getValueOfDecimal(h.get("invoiceopen")):p*-1;a=t.getValueOfDecimal(h.get("paymenttermdiscount"));g="Y"==h.get("issotrx");g||(l=w==0?l*-1:p*-1,a=a*-1);var rt=t.getValueOfInt(h.get("c_doctypetarget_id")),ut="SELECT DocBaseType FROM C_DocType WHERE C_DocType_ID = "+rt,nt=t.getValueOfString(n.DB.executeScalar(ut));"ARC"==nt||"API"==nt?f.setValue("VSS_PAYMENTTYPE","P"):f.setValue("VSS_PAYMENTTYPE","R");f.setValue("Amount",l-a);f.setValue("DiscountAmt",a);f.setValue("WriteOffAmt",n.Env.ZERO);r.setContext("InvTotalAmt",l.toString())}h.close()}}catch(y){return h!=null&&(h.close(),h=null),this.log.log(i.SEVERE,"invoice",y),this.setCalloutActive(!1),y.toString()}return this.setCalloutActive(!1),r=u=f=e=o=s=null,""};h.prototype.SetAmount=function(i,r,u,f,e){var y,l,o,a,v,s,h,c;if(this.isCalloutActive()||e==null||e.toString()=="")return"";if(e==null||e.toString()=="")return t.getValueOfInt(u.getValue("C_Invoice_ID"))>0?(this.setCalloutActive(!0),y="SELECT sum(ips.DueAmt)  FROM C_Invoice i INNER JOIN C_InvoicePaySchedule ips ON (i.C_Invoice_ID=ips.C_Invoice_ID) WHERE i.IsPayScheduleValid='Y' AND ips.IsValid ='Y' AND ips.isactive ='Y'AND i.C_Invoice_ID = "+t.getValueOfInt(u.getValue("C_Invoice_ID"))+" AND C_InvoicePaySchedule_ID NOT IN (SELECT NVL(C_InvoicePaySchedule_ID,0) FROM C_InvoicePaySchedule WHERE C_Payment_ID IN (SELECT NVL(C_Payment_ID,0) FROM C_InvoicePaySchedule) UNION SELECT NVL(C_InvoicePaySchedule_ID,0) FROM C_InvoicePaySchedule WHERE C_Cashline_ID IN (SELECT NVL(C_Cashline_ID,0) FROM C_InvoicePaySchedule))",l=t.getValueOfDecimal(n.DB.executeScalar(y,null,null)),i.setContext(r,"InvTotalAmt",l.toString()),u.setValue("Amount",l),this.setCalloutActive(!1),""):"";if(t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='VA009_'  AND IsActive = 'Y'"))>0){if(i.setContext("InvTotalAmt",""),s=t.getValueOfInt(e),s==null||s==0)return i.setContext(r,"InvTotalAmt",null),u.getTableName()=="C_Payment"?u.setValue("PayAmt",null):u.setValue("Amount",null),u.setValue("DiscountAmt",0),u.setValue("WriteOffAmt",n.Env.ZERO),i.setContext("InvTotalAmt",0),this.setCalloutActive(!1),"";h="SELECT DueAmt , DiscountDate , DiscountAmt , DiscountDays2 , Discount2  FROM C_InvoicePaySchedule WHERE C_InvoicePaySchedule_ID="+s;o=n.DB.executeDataSet(h,null,null);i.setContext(r,"InvTotalAmt",t.getValueOfString(o.getTables()[0].getRows()[0].getCell("DueAmt")));u.getTableName()=="C_Payment"?u.setValue("PayAmt",t.getValueOfDecimal(o.getTables()[0].getRows()[0].getCell("DueAmt"))):(u.setValue("Amount",t.getValueOfDecimal(o.getTables()[0].getRows()[0].getCell("DueAmt"))),u.setValue("WriteOffAmt",0),u.setValue("OverUnderAmt",0),h="SELECT DateAcct FROM C_Cash WHERE IsActive = 'Y' AND C_Cash_ID = "+u.getValue("C_Cash_ID"),a=t.getValueOfDate(n.DB.executeScalar(h)),h="SELECT IsSoTrx FROM C_Invoice WHERE C_Invoice_ID = "+u.getValue("C_Invoice_ID"),v=t.getValueOfString(n.DB.executeScalar(h)),t.getValueOfDate(o.getTables()[0].getRows()[0].getCell("DiscountDate"))>=a?(v=="N"?u.setValue("DiscountAmt",-1*t.getValueOfDecimal(o.getTables()[0].getRows()[0].getCell("DiscountAmt"))):u.setValue("DiscountAmt",t.getValueOfDecimal(o.getTables()[0].getRows()[0].getCell("DiscountAmt"))),u.setValue("Amount",t.getValueOfDecimal(o.getTables()[0].getRows()[0].getCell("DueAmt"))-t.getValueOfDecimal(o.getTables()[0].getRows()[0].getCell("DiscountAmt")))):t.getValueOfDate(o.getTables()[0].getRows()[0].getCell("DiscountDays2"))>=a?(v=="N"?u.setValue("DiscountAmt",-1*t.getValueOfDecimal(o.getTables()[0].getRows()[0].getCell("Discount2"))):u.setValue("DiscountAmt",t.getValueOfDecimal(o.getTables()[0].getRows()[0].getCell("Discount2"))),u.setValue("Amount",t.getValueOfDecimal(o.getTables()[0].getRows()[0].getCell("DueAmt"))-t.getValueOfDecimal(o.getTables()[0].getRows()[0].getCell("Discount2")))):u.setValue("DiscountAmt",0))}else{if(s=t.getValueOfInt(e),s==null||s==0)return i.setContext(r,"InvTotalAmt",null),u.getTableName()=="C_Payment"?u.setValue("PayAmt",null):u.setValue("Amount",null),this.setCalloutActive(!1),"";h="SELECT DueAmt FROM C_InvoicePaySchedule WHERE C_InvoicePaySchedule_ID="+s;c=t.getValueOfDecimal(n.DB.executeScalar(h,null,null));i.setContext(r,"InvTotalAmt",c.toString());u.getTableName()=="C_Payment"?u.setValue("PayAmt",c):u.setValue("Amount",c)}return this.setCalloutActive(!1),""};h.prototype.Amounts=function(n,i,r,u,f,e){var o,s,c;if(this.isCalloutActive()||"I"!=r.getValue("CashType")||(o=n.getContext("InvTotalAmt"),o==null||o.toString().length==0))return"";s=t.getValueOfDecimal(o);this.setCalloutActive(!0);var h=t.getValueOfDecimal(r.getValue("Amount")),l=t.getValueOfDecimal(r.getValue("DiscountAmt")),a=t.getValueOfDecimal(r.getValue("WriteOffAmt")),v=t.getValueOfDecimal(r.getValue("OverUnderAmt")),y=u.getColumnName();return this.log.fine(y+" - Invoice="+s+" - Amount="+h+", Discount="+l+", WriteOff="+a),y=="Amount"?(c=s-h,v=c-l-a,r.setValue("OverUnderAmt",v)):(c=s-l,h=c-a-v,r.setValue("Amount",h)),this.setCalloutActive(!1),n=i=r=u=f=e=null,""};h.prototype.BeginningBalCalc=function(r,u,f,e,o,s){var c,y;if(o==null||o.toString()==""||this.isCalloutActive())return"";if(this.setCalloutActive(!0),c=t.getValueOfInt(o),c==null||c==0)return f.setValue("BeginningBalance",0),this.setCalloutActive(!1),"";var l=t.getValueOfInt(f.getValue("C_CashBook_ID")),a=t.getValueOfInt(f.getValue("AD_Client_ID")),v=t.getValueOfInt(f.getValue("AD_Org_ID")),b=r.getContext("DateAcct"),w="SELECT EndingBalance FROM C_Cash WHERE C_CashBook_ID="+l+" AND AD_Client_ID="+a+" AND AD_Org_ID="+v+" AND c_cash_id IN (SELECT Max(c_cash_id) FROM C_Cash WHERE C_CashBook_ID="+l+"AND AD_Client_ID="+a+" AND AD_Org_ID="+v+") AND Processed='Y'",h=null;try{h=n.DB.executeReader(w,null,null);h.read()?(y=t.getValueOfDecimal(h.get(0)),f.setValue("BeginningBalance",y)):f.setValue("BeginningBalance",0);h.close()}catch(p){return h!=null&&h.close(),this.log.log(i.SEVERE,"Beginning balance",p),this.setCalloutActive(!1),p.toString()}return this.setCalloutActive(!1),r=u=f=e=o=s=null,""};h.prototype.SetCurrency=function(i,r,u,f,e,o){var s,h,c;return e==null||e.toString()==""?(u.setValue("C_Currency_ID",0),""):this.isCalloutActive()?"":(this.setCalloutActive(!0),s=t.getValueOfInt(e),s==null||s==0)?(u.setValue("C_Currency_ID",0),this.setCalloutActive(!1),""):(h=s.toString(),c=n.dataContext.getJSONRecord("MCashBook/GetCashBook",h),u.setValue("C_Currency_ID",c.C_Currency_ID),this.setCalloutActive(!1),i=r=u=f=e=o=null,"")};h.prototype.ConvertedAmt=function(i,r,u,f,e,o){var h,s;if(e==null||e.toString()==""||this.isCalloutActive())return"";this.setCalloutActive(!0);h="SELECT CASHLINE.Amount FROM C_CashLine CASHLINE INNER JOIN C_Cashbook CB ON (CB.C_Cashbook_ID=CASHLINE.C_Cashbook_ID) WHERE CASHLINE.C_CashLine_ID ="+e;try{if(s=t.getValueOfInt(n.DB.executeScalar("SELECT C_Currency_ID FROM C_CashBook WHERE C_CashBook_ID=(SELECT C_CashBook_ID FROM C_Cash WHERE C_Cash_ID="+u.getValue("C_Cash_ID")+")")),s==0)return this.setCalloutActive(!1),"";var l=t.getValueOfDecimal(n.DB.executeScalar(h)),a=t.getValueOfInt(n.DB.executeScalar("SELECT C_Currency_ID FROM C_Cashbook WHERE C_Cashbook_ID= (SELECT C_CashBook_ID FROM C_Cash WHERE C_Cash_ID= (SELECT C_Cash_ID FROM C_CashLine WHERE C_CashLine_ID= "+e+"))")),v=l.toString()+","+a.toString()+","+s.toString()+","+i.getAD_Client_ID().toString()+","+i.getAD_Org_ID().toString(),c=n.dataContext.getJSONRecord("MConversionRate/Convert",v);u.setValue("ConvertedAmt",c);u.setValue("Amount",c)}catch(y){this.setCalloutActive(!1)}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};h.prototype.GetBeginBal=function(i,r,u,f,e){if(e==null||e=="")return u.getField("C_Invoice_ID").setReadOnly(!1),"";if(this.isCalloutActive())return"";this.setCalloutActive(!0);var o=t.getValueOfDecimal(n.DB.executeScalar(" select sum(nvl(CompletedBalance,0)) + sum(nvl(runningbalance,0)) as TotalBal from c_cashbook where c_cashbook_id="+e));return u.setValue("BeginningBalance",o),this.setCalloutActive(!1),""};n.Model.CalloutCashJournal=h;n.Utility.inheritPrototype(ot,n.CalloutEngine);ot.prototype.FillAttribute=function(i,r,u,f,e){var o,s,l,h,a,c;return this.isCalloutActive()||e==null||e.toString()==""?"":(o=i.getContext(r,"AttrCode"),this.setCalloutActive(!0),o!=null&&o!=""&&(s="SELECT M_AttributeSet_ID FROM M_Product WHERE M_Product_ID = "+t.getValueOfInt(e),l=t.getValueOfInt(n.DB.executeScalar(s)),l>0&&(s="SELECT M_AttributeSetInstance_ID FROM M_ProductAttributes WHERE UPC = '"+o+"' AND M_Product_ID = "+t.getValueOfInt(e),h=t.getValueOfInt(n.DB.executeScalar(s)),h>0?u.setValue("M_AttributeSetInstance_ID",h):o.indexOf("(01)")>=0&&(a=o+","+t.getValueOfInt(e)+","+r,c=n.dataContext.getJSONRecord("MInOut/GetASIID",a),c!=0&&u.setValue("M_AttributeSetInstance_ID",c)))),this.setCalloutActive(!1),"")};ot.prototype.FillUPC=function(i,r,u,f,e){var s="",h=0,o;if(this.isCalloutActive()||e==null||e.toString()=="")return"";if(o=i.getContext(r,"AttrCode"),this.setCalloutActive(!0),t.getValueOfString(o)!=""){if(s="SELECT Count(*) FROM M_Manufacturer WHERE IsActive = 'Y' AND UPC = '"+o+"'",h=t.getValueOfInt(n.DB.executeScalar(s,null,null)),h>0)return this.setCalloutActive(!1),n.Msg.getMsg("Attribute Code Already Exist");u.setValue("UPC",o)}return this.setCalloutActive(!1),""};n.Model.CalloutSetAttributeCode=ot;n.Utility.inheritPrototype(w,n.CalloutEngine);w.prototype.ProductCategory=function(i,r,u,f,e,o){var s,c,h,l;return e==null||e.toString()==""?"":(s=t.getValueOfInt(e),s==null||t.getValueOfInt(s)==0||s==0)?"":(c=t.getValueOfInt(e),h=null,h=n.dataContext.getJSONRecord("MProductCategory/GetProductCategory",c),l=h.IsPurchasedToOrder,u.setValue("IsPurchasedToOrder",l),pc=null,i=r=u=f=e=o=null,"")};w.prototype.UOM=function(i,r,u,f,e,o){var s,h,c;return this.isCalloutActive()||e==null||e.toString()==""?"":u.getValue("M_Product_id")==null?"":(this.setCalloutActive(!0),s="select count(*) from m_transaction where m_product_id = "+t.getValueOfInt(u.getValue("M_Product_id")),h=t.getValueOfInt(n.DB.executeScalar(s,null,null)),h>0&&(n.ADialog.info("Can't change UOM due to Transactions happens based on existing UOM"),s="select c_uom_id from m_product where m_product_id =  "+t.getValueOfInt(u.getValue("M_Product_id")),c=t.getValueOfInt(n.DB.executeScalar(s,null,null)),u.setValue("C_UOM_ID",c)),this.setCalloutActive(!1),i=r=u=f=e=o=null,"")};w.prototype.ResourceGroup=function(n,i,r,u,f,e){if(f==null||f.toString()=="")return"";var o=t.getValueOfString(f);return o==null||o.length==0?"":("O"==o?r.setValue("BasisType",null):r.setValue("BasisType","I"),n=i=r=u=f=e=null,"")};w.prototype.Organization=function(i,r,u,f,e,o){var h,s,c;return e==null||e.toString()==""?"":(h=t.getValueOfInt(e),h==null)?"":(s=null,s=n.dataContext.getJSONRecord("MLocator/GetLocator",paramString),c=s.Default_Locator_ID,u.setValue("M_Locator_ID",c),i=r=u=f=e=o=null,"")};n.Model.CalloutProduct=w;n.Utility.inheritPrototype(st,n.CalloutEngine);st.prototype.Planned=function(i,r,u,f,e,o){var d,g,p,a,v;if(e==null||e.toString()==""||this.isCalloutActive()||e==null)return"";this.setCalloutActive(!0);var y,s,c,h,w=0,l=i.getStdPrecision(),b=t.getValueOfInt(u.getValue("C_ProjectTask_ID")),nt="SELECT C_Project_ID FROM C_ProjectPhase WHERE C_ProjectPhase_id IN (select C_ProjectPhase_id from C_ProjectTask WHERE C_ProjectTask_ID="+b+")",k=t.getValueOfInt(n.DB.executeScalar(nt,null,null));return b==0&&(k=t.getValueOfInt(u.getValue("C_Project_ID"))),d="SELECT PriceLimit FROM M_ProductPrice WHERE M_PriceList_Version_ID = (SELECT c.m_pricelist_version_id FROM  c_project c WHERE c.c_project_Id="+k+")  AND M_Product_id="+t.getValueOfInt(u.getValue("M_Product_ID")),g=t.getValueOfDecimal(n.DB.executeScalar(d,null,null)),y=t.getValueOfDecimal(u.getValue("PlannedQty")),y==null?y=Envs.ONE:w=(t.getValueOfDecimal(u.getValue("PlannedPrice"))-g)*t.getValueOfDecimal(u.getValue("PlannedQty")),s=t.getValueOfDecimal(u.getValue("PlannedPrice")),s==null&&(s=n.Env.ZERO),c=u.getValue("PriceList"),c==null&&(c=s),h=u.getValue("Discount"),h==null&&(h=n.Env.ZERO),p=f.getColumnName(),p=="PlannedPrice"?(c==0?h=n.Env.ZERO:(a=(s*n.Env.ONEHUNDRED/c).toFixed(l),h=n.Env.ONEHUNDRED-a),u.setValue("Discount",h),this.log.fine("PriceList="+c+" - Discount="+h+" -> [PlannedPrice="+s+"] (Precision="+l+")")):p=="PriceList"?(n.Env.signum(c)==0?h=n.Env.ZERO:(a=(s*n.Env.ONEHUNDRED/c).toFixed(l),h=n.Env.ONEHUNDRED-a),u.setValue("Discount",h),this.log.fine("[PriceList="+c+"] - Discount="+h+" -> PlannedPrice="+s+" (Precision="+l+")")):p=="Discount"&&(a=(h/n.Env.ONEHUNDRED).toFixed(10),a=n.Env.ONE-a,s=c*a,t.scale(s)>l&&(s=s.toFixed(l)),u.setValue("PlannedPrice",s),this.log.fine("PriceList="+c+" - [Discount="+h+"] -> PlannedPrice="+s+" (Precision="+l+")")),v=y*s,t.scale(v)>l&&(v=v.toFixed(l)),this.log.fine("PlannedQty="+y+" * PlannedPrice="+s+" -> PlannedAmt="+v+" (Precision="+l+")"),u.setValue("PlannedAmt",v),u.setValue("PlannedMarginAmt",w),this.setCalloutActive(!1),i=r=u=f=e=o=null,""};st.prototype.Product=function(i,r,u,f,e,o){var c,l,a,h,p;if(e==null||e.toString()==""||(c=t.getValueOfInt(e),l=i.getContextAsInt(r,"M_PriceList_Version_ID"),c==null||t.getValueOfInt(c)==0||l==0))return"";this.setCalloutActive(!0);var v=i.getContextAsInt(r,"C_BPartner_ID"),y=t.getValueOfDecimal(u.getValue("PlannedQty")),s=t.getValueOfDateTime(u.getValue("PlannedDate"));return s==null?(s=t.getValueOfDateTime(u.getValue("DateContract")),s==null&&(s=t.getValueOfDateTime(u.getValue("DateFinish")),s==null&&(s=new Date)),a=c.toString().concat(",",v.toString(),",",y.toString(),",",isSOTrx,",",M_PriceList_ID.toString(),",",l.toString(),",",s.toString(),",",null),h=null,h=n.dataContext.getJSONRecord("MProductPricing/GetProductPricing",a),p=null,u.setValue("PriceList",h.PriceList),u.setValue("PlannedPrice",h.PriceActual),u.setValue("Discount",h.Discount),u.setValue("PlannedAmt",h.LineAmt),""):(i=r=u=f=e=o=null,"")};n.Model.CalloutProject=st;n.Utility.inheritPrototype(d,n.CalloutEngine);d.prototype.BankAccount=function(t,r,u,f,e,o){if(e==null||e.toString()=="")return"";try{var l=e,h=e.toString(),s;s=n.dataContext.getJSONRecord("MBankStatement/GetCurrentBalance",h);u.setValue("BeginningBalance",s)}catch(c){this.setCalloutActive(!1);this.log.log(i.SEVERE,"",c)}return t=r=u=f=e=o=null,""};d.prototype.Amount=function(n,t,i,r,u,f){var e,o,s,h,c;return u==null||u.toString()==""?"":this.isCalloutActive()?"":(this.setCalloutActive(!0),e=i.getValue("StmtAmt"),e==null&&(e=0),o=i.getValue("TrxAmt"),o==null&&(o=0),s=i.getValue("ChargeAmt"),s==null&&(s=0),h=e-o,c=e-(h-s),r.getColumnName()=="StmtAmt"?i.setValue("ChargeAmt",h):r.getColumnName()=="ChargeAmt"&&i.setValue("StmtAmt",c),this.setCalloutActive(!1),n=t=i=r=u=f=null,"")};d.prototype.Payment=function(t,r,u,f,e,o){var h,c,l;if(e==null||e.toString()==""||(h=e,h==null||h==0))return"";c=u.getValue("StmtAmt");c==null&&(c=0);var s=null,a=[];try{a[0]=new n.DB.SqlParam("@C_Payment_ID",h);s=n.DB.executeReader("SELECT PayAmt FROM C_Payment_v WHERE C_Payment_ID=@C_Payment_ID",a,null);s.read()&&(l=s.get("payamt"),u.setValue("TrxAmt",l),c==0&&u.setValue("StmtAmt",l));s.close()}catch(v){return this.setCalloutActive(!1),s!=null&&s.close(),this.log.log(i.SEVERE,"BankStmt_Payment",v),v.toString()}return this.Amount(t,r,u,f,e),t=r=u=f=e=o=null,""};n.Model.CalloutBankStatement=d;n.Utility.inheritPrototype(c,n.CalloutEngine);c.prototype.CalculatePrice=function(n,t,i){return Decimal.Subtract(Decimal.Multiply(n,t),i)};c.prototype.CalculateRebate=function(n,t,i){return Decimal.Multiply(Decimal.Multiply(n,t),Decimal.Multiply(new Decimal(.01),i))};c.prototype.OfferServices=function(i,r,u,f,e,o){var it,ht,kt,st;if(e==null||e.toString()==""||(it=24,ht=t.getValueOfInt(e),ht==null||ht==0))return"";var ct=0,lt=new Decimal(0),at=new Decimal(0),vt=new Decimal(0),s,l,a,v,h,k,d,pt,wt,ut=null;try{for(st=[],st[0]=new n.DB.SqlParam("@FO_SERVICE_ID",ht),ut=n.DB.executeReader("select uom.FO_HOTEL_UOM_ID,s.DESCRIPTION from FO_HOTEL_UOM uom inner join FO_SERVICE s ON(uom.FO_HOTEL_UOM_ID= s.FO_HOTEL_UOM_ID) where s.FO_SERVICE_ID=@FO_SERVICE_ID ",st,null);ut.read();)ct=t.getValueOfInt(ut[0]),u.setValue("AUOM_ID",ct),u.setValue("CG1UOM_ID",ct),u.setValue("CG2UOM_ID",ct),u.setValue("DESCRIPTION",t.getValueOfString(ut[1]));ut.close()}catch(bt){this.setCalloutActive(!1);ut!=null&&ut.close();this.log.severe(bt.toString())}kt="select PRICE,CHILDGROUP1,CHILDGROUP2,UOM1,UOM2 from FO_SERVICE_PRICE_PRICELINE where CREATED=(select max(CREATED) from FO_SERVICE_PRICE_PRICELINE where FO_SERVICE_ID=@FO_SERVICE_ID)";try{for(st=[],st[0]=new n.DB.SqlParam("@FO_SERVICE_ID",ht),ut=n.DB.executeReader(kt,st,null);ut.read();)lt=t.getValueOfDecimal(ut[0]),at=t.getValueOfDecimal(ut[1]),vt=t.getValueOfDecimal(ut[2]),pt=ut[3].toString(),wt=ut[4].toString(),pt.equals("Y")&&(at=Decimal.Multiply(Decimal.Multiply(lt,at),new Decimal(.01))),wt.equals("Y")&&(vt=Decimal.Multiply(Decimal.Multiply(lt,vt),new Decimal(.01))),u.setValue("APRICE",lt),u.setValue("CG1PRICE",at),u.setValue("CG2PRICE",vt);ut.close()}catch(bt){this.setCalloutActive(!1);this.log.severe(bt.toString())}var dt=u.getValue("AUOM_ID").toString(),g=t.getValueOfInt(u.getValue("ANUM")),p=t.getValueOfDecimal(u.getValue("AP0RICE")),b=t.getValueOfDecimal(u.getValue("AREBATE")),nt=t.getValueOfInt(u.getValue("CG1NUM")),tt=t.getValueOfInt(u.getValue("CG2NUM")),y=t.getValueOfDecimal(u.getValue("CG1P0RICE")),w=t.getValueOfDecimal(u.getValue("CG2PRICE")),gt=t.getValueOfDateTime(u.getValue("ADATETO")),ni=t.getValueOfDateTime(u.getValue("ADATEFROM")),c=Utility.timeUtil.getDaysBetween(ni,gt),yt=ni.Subtract(gt),ft,rt,ti=c/30,ri=c%30,ii=c/7,ui=c%7;ft=ri==0?ti:ti+1;rt=ui==0?ii:ii+1;var fi=yt.TotalMilliseconds,et=yt.TotalSeconds,ot=yt.TotalMinutes;if(t.getValueOfInt(b)==0){h=n.Env.ZERO;switch(int.Parse(dt)){case 1000003:s=p;l=y;a=w;l=y;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:s=CalculatePrice(new Decimal(g),p,h);l=CalculatePrice(new Decimal(nt),y,h);a=CalculatePrice(new Decimal(tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:s=CalculatePrice(new Decimal(g),p,h);l=CalculatePrice(new Decimal(nt),y,h);a=CalculatePrice(new Decimal(tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:s=CalculatePrice(new Decimal(c),p,h);l=CalculatePrice(new Decimal(c),y,h);a=CalculatePrice(new Decimal(c),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:s=CalculatePrice(new Decimal(ft),p,h);l=CalculatePrice(new Decimal(ft),y,h);a=CalculatePrice(new Decimal(ft),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:s=CalculatePrice(new Decimal(rt),p,h);l=CalculatePrice(new Decimal(rt),y,h);a=CalculatePrice(new Decimal(rt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:s=CalculatePrice(new Decimal(c+1),p,h);l=CalculatePrice(new Decimal(c+1),y,h);a=CalculatePrice(new Decimal(c+1),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:s=CalculatePrice(new Decimal(it*c),p,h);l=CalculatePrice(new Decimal(it*c),y,h);a=CalculatePrice(new Decimal(it*c),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:s=CalculatePrice(new Decimal(ot),p,h);l=CalculatePrice(new Decimal(ot),y,h);a=CalculatePrice(new Decimal(ot),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:s=CalculatePrice(new Decimal(et),p,h);l=CalculatePrice(new Decimal(et),y,h);a=CalculatePrice(new Decimal(et),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:s=CalculatePrice(new Decimal(c*g),p,h);l=CalculatePrice(new Decimal(c*nt),y,h);a=CalculatePrice(new Decimal(c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:s=CalculatePrice(new Decimal(c*g),p,h);l=CalculatePrice(new Decimal(c*nt),y,h);a=CalculatePrice(new Decimal(c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:s=CalculatePrice(new Decimal(g*rt),p,h);l=CalculatePrice(new Decimal(nt*rt),y,h);a=CalculatePrice(new Decimal(tt*rt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:s=CalculatePrice(new Decimal(g*rt),p,h);l=CalculatePrice(new Decimal(nt*rt),y,h);a=CalculatePrice(new Decimal(tt*rt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:s=CalculatePrice(new Decimal(g*(c+1)),p,h);l=CalculatePrice(new Decimal(nt*(c+1)),y,h);a=CalculatePrice(new Decimal(tt*(c+1)),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:s=CalculatePrice(new Decimal((c+1)*g),p,h);l=CalculatePrice(new Decimal((c+1)*nt),y,h);a=CalculatePrice(new Decimal((c+1)*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:s=CalculatePrice(new Decimal(it*c*g),p,h);l=CalculatePrice(new Decimal(it*c*nt),y,h);a=CalculatePrice(new Decimal(it*c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:s=CalculatePrice(new Decimal(it*c*g),p,h);l=CalculatePrice(new Decimal(it*c*nt),y,h);a=CalculatePrice(new Decimal(it*c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v)}}else switch(int.Parse(dt)){case 1000003:s=p;l=y;a=w;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:h=CalculateRebate(new Decimal(g),p,b);s=CalculatePrice(new Decimal(g),p,h);k=CalculateRebate(new Decimal(nt),y,b);l=CalculatePrice(new Decimal(nt),y,k);d=CalculateRebate(new Decimal(tt),w,b);a=CalculatePrice(new Decimal(tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:h=CalculateRebate(new Decimal(g),p,b);s=CalculatePrice(new Decimal(g),p,h);k=CalculateRebate(new Decimal(nt),y,b);l=CalculatePrice(new Decimal(nt),y,k);d=CalculateRebate(new Decimal(tt),w,b);a=CalculatePrice(new Decimal(tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:h=CalculateRebate(new Decimal(c),p,b);s=CalculatePrice(new Decimal(c),p,h);k=CalculateRebate(new Decimal(c),y,b);l=CalculatePrice(new Decimal(c),y,k);d=CalculateRebate(new Decimal(c),w,b);a=CalculatePrice(new Decimal(c),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:h=CalculateRebate(new Decimal(ft),p,b);s=CalculatePrice(new Decimal(ft),p,h);k=CalculateRebate(new Decimal(ft),y,b);l=CalculatePrice(new Decimal(ft),y,k);d=CalculateRebate(new Decimal(ft),w,b);a=CalculatePrice(new Decimal(ft),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:h=CalculateRebate(new Decimal(rt),p,b);s=CalculatePrice(new Decimal(rt),p,h);k=CalculateRebate(new Decimal(rt),y,b);l=CalculatePrice(new Decimal(rt),y,k);d=CalculateRebate(new Decimal(rt),w,b);a=CalculatePrice(new Decimal(rt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:h=CalculateRebate(new Decimal(c+1),p,b);s=CalculatePrice(new Decimal(c+1),p,h);k=CalculateRebate(new Decimal(c+1),y,b);l=CalculatePrice(new Decimal(c+1),y,k);d=CalculateRebate(new Decimal(c+1),w,b);a=CalculatePrice(new Decimal(c+1),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:h=CalculateRebate(new Decimal(it*c),p,b);s=CalculatePrice(new Decimal(it*c),p,h);k=CalculateRebate(new Decimal(it*c),y,b);l=CalculatePrice(new Decimal(it*c),y,k);d=CalculateRebate(new Decimal(it*c),w,b);a=CalculatePrice(new Decimal(it*c),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:h=CalculateRebate(new Decimal(ot),p,b);s=CalculatePrice(new Decimal(ot),p,h);k=CalculateRebate(new Decimal(ot),y,b);l=CalculatePrice(new Decimal(ot),y,k);d=CalculateRebate(new Decimal(ot),w,b);a=CalculatePrice(new Decimal(ot),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:h=CalculateRebate(new Decimal(et),p,b);s=CalculatePrice(new Decimal(et),p,h);k=CalculateRebate(new Decimal(et),y,b);l=CalculatePrice(new Decimal(et),y,k);d=CalculateRebate(new Decimal(et),w,b);a=CalculatePrice(new Decimal(et),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:h=CalculateRebate(new Decimal(c*g),p,b);s=CalculatePrice(new Decimal(c*g),p,h);k=CalculateRebate(new Decimal(c*nt),y,b);l=CalculatePrice(new Decimal(c*nt),y,k);d=CalculateRebate(new Decimal(c*tt),w,b);a=CalculatePrice(new Decimal(c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:h=CalculateRebate(new Decimal(c*g),p,b);s=CalculatePrice(new Decimal(c*g),p,h);k=CalculateRebate(new Decimal(c*nt),y,b);l=CalculatePrice(new Decimal(c*nt),y,k);d=CalculateRebate(new Decimal(c*tt),w,b);a=CalculatePrice(new Decimal(c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:h=CalculateRebate(new Decimal(g*rt),p,b);s=CalculatePrice(new Decimal(g*rt),p,h);k=CalculateRebate(new Decimal(nt*rt),y,b);l=CalculatePrice(new Decimal(nt*rt),y,k);d=CalculateRebate(new Decimal(tt*rt),w,b);a=CalculatePrice(new Decimal(tt*rt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:h=CalculateRebate(new Decimal(g*rt),p,b);s=CalculatePrice(new Decimal(g*rt),p,h);k=CalculateRebate(new Decimal(nt*rt),y,b);l=CalculatePrice(new Decimal(nt*rt),y,k);d=CalculateRebate(new Decimal(tt*rt),w,b);a=CalculatePrice(new Decimal(tt*rt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:h=CalculateRebate(new Decimal(g*(c+1)),p,b);s=CalculatePrice(new Decimal(g*(c+1)),p,h);k=CalculateRebate(new Decimal(nt*(c+1)),y,b);l=CalculatePrice(new Decimal(nt*(c+1)),y,k);d=CalculateRebate(new Decimal(tt*(c+1)),w,b);a=CalculatePrice(new Decimal(tt*(c+1)),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:h=CalculateRebate(new Decimal(g*(c+1)),p,b);s=CalculatePrice(new Decimal((c+1)*g),p,h);k=CalculateRebate(new Decimal(nt*(c+1)),y,b);l=CalculatePrice(new Decimal(nt*(c+1)),y,k);d=CalculateRebate(new Decimal(tt*(c+1)),w,b);a=CalculatePrice(new Decimal(tt*(c+1)),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:h=CalculateRebate(new Decimal(it*c*g),p,b);s=CalculatePrice(new Decimal(it*c*g),p,h);k=CalculateRebate(new Decimal(it*c*nt),y,b);l=CalculatePrice(new Decimal(it*c*nt),y,k);d=CalculateRebate(new Decimal(it*c*tt),w,b);a=CalculatePrice(new Decimal(it*c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:h=CalculateRebate(new Decimal(it*c*g),p,b);s=CalculatePrice(new Decimal(it*c*g),p,h);k=CalculateRebate(new Decimal(it*c*nt),y,b);l=CalculatePrice(new Decimal(it*c*nt),y,k);d=CalculateRebate(new Decimal(it*c*tt),w,b);a=CalculatePrice(new Decimal(it*c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v)}return g==0&&(u.setValue("ATOTAL_AMOUNT",0),u.setValue("GRAND_TOTAL",0)),nt==0&&u.setValue("CG1TOTAL_AMOUNT",0),tt==0&&u.setValue("CG2TOTAL_AMOUNT",0),i=r=u=f=e=o=null,""};c.prototype.tochkdate=function(i,r,u,f,e,o){var it,s,l,a,h,k,d,v,ct,vt,yt,at,st;if(e==null||e.toString()==""||(it=24,ct=t.getValueOfDateTime(e),ct==null||ct.equals(0)))return"";var ot=t.getValueOfDateTime(e),ht=t.getValueOfDateTime(u.getValue("ADATEFROM")),g=t.getValueOfInt(u.getValue("CG1NUM")),nt=t.getValueOfInt(u.getValue("CG2NUM")),y=t.getValueOfDecimal(u.getValue("CG1PRICE")),p=t.getValueOfDecimal(u.getValue("CG2PRICE"));try{if(ot=t.getValueOfDateTime(u.getValue("ADATETO")),vt=Utility.timeUtil.getDaysBetween(ht,ot),vt<=0)yt=Utility.TimeUtil.AddDays(ht,1),u.setValue("ADATETO",yt);else if(ot.compareTo(ht)>0){var lt=ot.Subtract(ht),c=Utility.timeUtil.getDaysBetween(ht,ot),gt=lt.TotalMilliseconds,ft=lt.TotalMinutes,et=lt.TotalMinutes,ut,rt,pt=c/30,bt=c%30,wt=c/7,kt=c%7;ut=bt==0?pt:pt+1;rt=kt==0?wt:wt+1;at=t.getValueOfDateTime(u.getValue("ADATEFROM"));u.setValue("CG1DATETO",ot);u.setValue("CG2DATETO",ot);u.setValue("CG1DATEFROM",at);u.setValue("CG2DATEFROM",at);st=u.getValue("AUOM_ID").toString();(st==""||st.toString().trim().length==0)&&(st="0");var w=t.getValueOfDecimal(u.getValue("APRICE")),tt=t.getValueOfInt(u.getValue("ANUM")),b=t.getValueOfDecimal(u.getValue("AREBATE"));if(t.getValueOfInt(b)==0){h=n.Env.ZERO;switch(int.Parse(st)){case 1000003:s=w;l=y;a=p;l=y;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:s=CalculatePrice(new Decimal(tt),w,h);l=CalculatePrice(new Decimal(g),y,h);a=CalculatePrice(new Decimal(nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:s=CalculatePrice(new Decimal(tt),w,h);l=CalculatePrice(new Decimal(g),y,h);a=CalculatePrice(new Decimal(nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:s=CalculatePrice(new Decimal(c),w,h);l=CalculatePrice(new Decimal(c),y,h);a=CalculatePrice(new Decimal(c),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:s=CalculatePrice(new Decimal(ut),w,h);l=CalculatePrice(new Decimal(ut),y,h);a=CalculatePrice(new Decimal(ut),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:s=CalculatePrice(new Decimal(rt),w,h);l=CalculatePrice(new Decimal(rt),y,h);a=CalculatePrice(new Decimal(rt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:s=CalculatePrice(new Decimal(c+1),w,h);l=CalculatePrice(new Decimal(c+1),y,h);a=CalculatePrice(new Decimal(c+1),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:s=CalculatePrice(new Decimal(it*c),w,h);l=CalculatePrice(new Decimal(it*c),y,h);a=CalculatePrice(new Decimal(it*c),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:s=CalculatePrice(new Decimal(et),w,h);l=CalculatePrice(new Decimal(et),y,h);a=CalculatePrice(new Decimal(et),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:s=CalculatePrice(new Decimal(ft),w,h);l=CalculatePrice(new Decimal(ft),y,h);a=CalculatePrice(new Decimal(ft),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:s=CalculatePrice(new Decimal(c*tt),w,h);l=CalculatePrice(new Decimal(c*g),y,h);a=CalculatePrice(new Decimal(c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:s=CalculatePrice(new Decimal(c*tt),w,h);l=CalculatePrice(new Decimal(c*g),y,h);a=CalculatePrice(new Decimal(c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:s=CalculatePrice(new Decimal(tt*rt),w,h);l=CalculatePrice(new Decimal(g*rt),y,h);a=CalculatePrice(new Decimal(nt*rt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:s=CalculatePrice(new Decimal(tt*rt),w,h);l=CalculatePrice(new Decimal(g*rt),y,h);a=CalculatePrice(new Decimal(nt*rt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:s=CalculatePrice(new Decimal(tt*(c+1)),w,h);l=CalculatePrice(new Decimal(g*(c+1)),y,h);a=CalculatePrice(new Decimal(nt*(c+1)),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:s=CalculatePrice(new Decimal((c+1)*tt),w,h);l=CalculatePrice(new Decimal((c+1)*g),y,h);a=CalculatePrice(new Decimal((c+1)*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:s=CalculatePrice(new Decimal(it*c*tt),w,h);l=CalculatePrice(new Decimal(it*c*g),y,h);a=CalculatePrice(new Decimal(it*c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:s=CalculatePrice(new Decimal(it*c*tt),w,h);l=CalculatePrice(new Decimal(it*c*g),y,h);a=CalculatePrice(new Decimal(it*c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v)}}else switch(int.Parse(st)){case 1000003:s=w;l=y;a=p;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:h=CalculateRebate(new Decimal(tt),w,b);s=CalculatePrice(new Decimal(tt),w,h);k=CalculateRebate(new Decimal(g),y,b);l=CalculatePrice(new Decimal(g),y,k);d=CalculateRebate(new Decimal(nt),p,b);a=CalculatePrice(new Decimal(nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:h=CalculateRebate(new Decimal(tt),w,b);s=CalculatePrice(new Decimal(tt),w,h);k=CalculateRebate(new Decimal(g),y,b);l=CalculatePrice(new Decimal(g),y,k);d=CalculateRebate(new Decimal(nt),p,b);a=CalculatePrice(new Decimal(nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:h=CalculateRebate(new Decimal(c),w,b);s=CalculatePrice(new Decimal(c),w,h);k=CalculateRebate(new Decimal(c),y,b);l=CalculatePrice(new Decimal(c),y,k);d=CalculateRebate(new Decimal(c),p,b);a=CalculatePrice(new Decimal(c),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:h=CalculateRebate(new Decimal(ut),w,b);s=CalculatePrice(new Decimal(ut),w,h);k=CalculateRebate(new Decimal(ut),y,b);l=CalculatePrice(new Decimal(ut),y,k);d=CalculateRebate(new Decimal(ut),p,b);a=CalculatePrice(new Decimal(ut),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:h=CalculateRebate(new Decimal(rt),w,b);s=CalculatePrice(new Decimal(rt),w,h);k=CalculateRebate(new Decimal(rt),y,b);l=CalculatePrice(new Decimal(rt),y,k);d=CalculateRebate(new Decimal(rt),p,b);a=CalculatePrice(new Decimal(rt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:h=CalculateRebate(new Decimal(c+1),w,b);s=CalculatePrice(new Decimal(c+1),w,h);k=CalculateRebate(new Decimal(c+1),y,b);l=CalculatePrice(new Decimal(c+1),y,k);d=CalculateRebate(new Decimal(c+1),p,b);a=CalculatePrice(new Decimal(c+1),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:h=CalculateRebate(new Decimal(it*c),w,b);s=CalculatePrice(new Decimal(it*c),w,h);k=CalculateRebate(new Decimal(it*c),y,b);l=CalculatePrice(new Decimal(it*c),y,k);d=CalculateRebate(new Decimal(it*c),p,b);a=CalculatePrice(new Decimal(it*c),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:h=CalculateRebate(new Decimal(et),w,b);s=CalculatePrice(new Decimal(et),w,h);k=CalculateRebate(new Decimal(et),y,b);l=CalculatePrice(new Decimal(et),y,k);d=CalculateRebate(new Decimal(et),p,b);a=CalculatePrice(new Decimal(et),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:h=CalculateRebate(new Decimal(ft),w,b);s=CalculatePrice(new Decimal(ft),w,h);k=CalculateRebate(new Decimal(ft),y,b);l=CalculatePrice(new Decimal(ft),y,k);d=CalculateRebate(new Decimal(ft),p,b);a=CalculatePrice(new Decimal(ft),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:h=CalculateRebate(new Decimal(c*tt),w,b);s=CalculatePrice(new Decimal(c*tt),w,h);k=CalculateRebate(new Decimal(c*g),y,b);l=CalculatePrice(new Decimal(c*g),y,k);d=CalculateRebate(new Decimal(c*nt),p,b);a=CalculatePrice(new Decimal(c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:h=CalculateRebate(new Decimal(c*tt),w,b);s=CalculatePrice(new Decimal(c*tt),w,h);k=CalculateRebate(new Decimal(c*g),y,b);l=CalculatePrice(new Decimal(c*g),y,k);d=CalculateRebate(new Decimal(c*nt),p,b);a=CalculatePrice(new Decimal(c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:h=CalculateRebate(new Decimal(tt*rt),w,b);s=CalculatePrice(new Decimal(tt*rt),w,h);k=CalculateRebate(new Decimal(g*rt),y,b);l=CalculatePrice(new Decimal(g*rt),y,k);d=CalculateRebate(new Decimal(nt*rt),p,b);a=CalculatePrice(new Decimal(nt*rt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:h=CalculateRebate(new Decimal(tt*rt),w,b);s=CalculatePrice(new Decimal(tt*rt),w,h);k=CalculateRebate(new Decimal(g*rt),y,b);l=CalculatePrice(new Decimal(g*rt),y,k);d=CalculateRebate(new Decimal(nt*rt),p,b);a=CalculatePrice(new Decimal(nt*rt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:h=CalculateRebate(new Decimal(tt*(c+1)),w,b);s=CalculatePrice(new Decimal(tt*(c+1)),w,h);k=CalculateRebate(new Decimal(g*(c+1)),y,b);l=CalculatePrice(new Decimal(g*(c+1)),y,k);d=CalculateRebate(new Decimal(nt*(c+1)),p,b);a=CalculatePrice(new Decimal(nt*(c+1)),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:h=CalculateRebate(new Decimal(tt*(c+1)),w,b);s=CalculatePrice(new Decimal((c+1)*tt),w,h);k=CalculateRebate(new Decimal(g*(c+1)),y,b);l=CalculatePrice(new Decimal(g*(c+1)),y,k);d=CalculateRebate(new Decimal(nt*(c+1)),p,b);a=CalculatePrice(new Decimal(nt*(c+1)),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:h=CalculateRebate(new Decimal(it*c*tt),w,b);s=CalculatePrice(new Decimal(it*c*tt),w,h);k=CalculateRebate(new Decimal(it*c*g),y,b);l=CalculatePrice(new Decimal(it*c*g),y,k);d=CalculateRebate(new Decimal(it*c*nt),p,b);a=CalculatePrice(new Decimal(it*c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:h=CalculateRebate(new Decimal(it*c*tt),w,b);s=CalculatePrice(new Decimal(it*c*tt),w,h);k=CalculateRebate(new Decimal(it*c*g),y,b);l=CalculatePrice(new Decimal(it*c*g),y,k);d=CalculateRebate(new Decimal(it*c*nt),p,b);a=CalculatePrice(new Decimal(it*c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v)}tt==0&&(u.setValue("ATOTAL_AMOUNT",0),u.setValue("GRAND_TOTAL",0));g==0&&u.setValue("CG1TOTAL_AMOUNT",0);nt==0&&u.setValue("CG2TOTAL_AMOUNT",0)}}catch(dt){this.setCalloutActive(!1);this.log.severe(dt.toString())}return i=r=u=f=e=o=null,""};c.prototype.fromchkdate=function(i,r,u,f,e,o){var it,s,l,a,h,k,d,v,ct,vt,at,ht;if(e==null||e.toString()==""||(it=24,ct=t.getValueOfDateTime(e),ct==null||ct.equals(0)))return"";var ot=t.getValueOfDateTime(u.getValue("ADATEFROM")),st=t.getValueOfDateTime(u.getValue("ADATETO")),g=t.getValueOfInt(u.getValue("CG1NUM")),nt=t.getValueOfInt(u.getValue("CG2NUM")),y=t.getValueOfDecimal(u.getValue("CG1PRICE")),p=t.getValueOfDecimal(u.getValue("CG2PRICE"));try{if(ot=t.getValueOfDateTime(u.getValue("ADATEFROM")),ot.compareTo(st)>0)u.setValue("CG1DATEFROM",ot),u.setValue("CG2DATEFROM",ot),vt=Utility.timeUtil.addDays(ot,1),u.setValue("ADATETO",vt);else if(st.compareTo(ot)>0){var lt=st.Subtract(ot),c=Utility.timeUtil.getDaysBetween(ot,st),dt=lt.TotalMilliseconds,ft=lt.TotalSeconds,et=lt.TotalMinutes,ut,rt,yt=c/30,wt=c%30,pt=c/7,bt=c%7;ut=wt==0?yt:yt+1;rt=bt==0?pt:pt+1;at=t.getValueOfDateTime(u.getValue("ADATEFROM"));u.setValue("CG1DATETO",st);u.setValue("CG2DATETO",st);u.setValue("CG1DATEFROM",at);u.setValue("CG2DATEFROM",at);ht=u.getValue("AUOM_ID").toString();(ht==""||ht.toString().trim().length==0)&&(ht="0");var w=t.getValueOfDecimal(u.getValue("APRICE")),tt=t.getValueOfInt(u.getValue("ANUM")),b=t.getValueOfDecimal(u.getValue("AREBATE"));if(t.getValueOfInt(b)==0){h=n.Env.ZERO;switch(int.Parse(ht)){case 1000003:s=w;l=y;a=p;l=y;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:s=CalculatePrice(new Decimal(tt),w,h);l=CalculatePrice(new Decimal(g),y,h);a=CalculatePrice(new Decimal(nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:s=CalculatePrice(new Decimal(tt),w,h);l=CalculatePrice(new Decimal(g),y,h);a=CalculatePrice(new Decimal(nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:s=CalculatePrice(new Decimal(c),w,h);l=CalculatePrice(new Decimal(c),y,h);a=CalculatePrice(new Decimal(c),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:s=CalculatePrice(new Decimal(ut),w,h);l=CalculatePrice(new Decimal(ut),y,h);a=CalculatePrice(new Decimal(ut),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:s=CalculatePrice(new Decimal(rt),w,h);l=CalculatePrice(new Decimal(rt),y,h);a=CalculatePrice(new Decimal(rt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:s=CalculatePrice(new Decimal(c+1),w,h);l=CalculatePrice(new Decimal(c+1),y,h);a=CalculatePrice(new Decimal(c+1),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:s=CalculatePrice(new Decimal(it*c),w,h);l=CalculatePrice(new Decimal(it*c),y,h);a=CalculatePrice(new Decimal(it*c),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:s=CalculatePrice(new Decimal(et),w,h);l=CalculatePrice(new Decimal(et),y,h);a=CalculatePrice(new Decimal(et),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:s=CalculatePrice(new Decimal(ft),w,h);l=CalculatePrice(new Decimal(ft),y,h);a=CalculatePrice(new Decimal(ft),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:s=CalculatePrice(new Decimal(c*tt),w,h);l=CalculatePrice(new Decimal(c*g),y,h);a=CalculatePrice(new Decimal(c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:s=CalculatePrice(new Decimal(c*tt),w,h);l=CalculatePrice(new Decimal(c*g),y,h);a=CalculatePrice(new Decimal(c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:s=CalculatePrice(new Decimal(tt*rt),w,h);l=CalculatePrice(new Decimal(g*rt),y,h);a=CalculatePrice(new Decimal(nt*rt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:s=CalculatePrice(new Decimal(tt*rt),w,h);l=CalculatePrice(new Decimal(g*rt),y,h);a=CalculatePrice(new Decimal(nt*rt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:s=CalculatePrice(new Decimal(tt*(c+1)),w,h);l=CalculatePrice(new Decimal(g*(c+1)),y,h);a=CalculatePrice(new Decimal(nt*(c+1)),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:s=CalculatePrice(new Decimal((c+1)*tt),w,h);l=CalculatePrice(new Decimal((c+1)*g),y,h);a=CalculatePrice(new Decimal((c+1)*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:s=CalculatePrice(new Decimal(it*c*tt),w,h);l=CalculatePrice(new Decimal(it*c*g),y,h);a=CalculatePrice(new Decimal(it*c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:s=CalculatePrice(new Decimal(it*c*tt),w,h);l=CalculatePrice(new Decimal(it*c*g),y,h);a=CalculatePrice(new Decimal(it*c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v)}}else switch(int.Parse(ht)){case 1000003:s=w;l=y;a=p;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:h=CalculateRebate(new Decimal(tt),w,b);s=CalculatePrice(new Decimal(tt),w,h);k=CalculateRebate(new Decimal(g),y,b);l=CalculatePrice(new Decimal(g),y,k);d=CalculateRebate(new Decimal(nt),p,b);a=CalculatePrice(new Decimal(nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:h=CalculateRebate(new Decimal(tt),w,b);s=CalculatePrice(new Decimal(tt),w,h);k=CalculateRebate(new Decimal(g),y,b);l=CalculatePrice(new Decimal(g),y,k);d=CalculateRebate(new Decimal(nt),p,b);a=CalculatePrice(new Decimal(nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:h=CalculateRebate(new Decimal(c),w,b);s=CalculatePrice(new Decimal(c),w,h);k=CalculateRebate(new Decimal(c),y,b);l=CalculatePrice(new Decimal(c),y,k);d=CalculateRebate(new Decimal(c),p,b);a=CalculatePrice(new Decimal(c),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:h=CalculateRebate(new Decimal(ut),w,b);s=CalculatePrice(new Decimal(ut),w,h);k=CalculateRebate(new Decimal(ut),y,b);l=CalculatePrice(new Decimal(ut),y,k);d=CalculateRebate(new Decimal(ut),p,b);a=CalculatePrice(new Decimal(ut),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:h=CalculateRebate(new Decimal(rt),w,b);s=CalculatePrice(new Decimal(rt),w,h);k=CalculateRebate(new Decimal(rt),y,b);l=CalculatePrice(new Decimal(rt),y,k);d=CalculateRebate(new Decimal(rt),p,b);a=CalculatePrice(new Decimal(rt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:h=CalculateRebate(new Decimal(c+1),w,b);s=CalculatePrice(new Decimal(c+1),w,h);k=CalculateRebate(new Decimal(c+1),y,b);l=CalculatePrice(new Decimal(c+1),y,k);d=CalculateRebate(new Decimal(c+1),p,b);a=CalculatePrice(new Decimal(c+1),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:h=CalculateRebate(new Decimal(it*c),w,b);s=CalculatePrice(new Decimal(it*c),w,h);k=CalculateRebate(new Decimal(it*c),y,b);l=CalculatePrice(new Decimal(it*c),y,k);d=CalculateRebate(new Decimal(it*c),p,b);a=CalculatePrice(new Decimal(it*c),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:h=CalculateRebate(new Decimal(et),w,b);s=CalculatePrice(new Decimal(et),w,h);k=CalculateRebate(new Decimal(et),y,b);l=CalculatePrice(new Decimal(et),y,k);d=CalculateRebate(new Decimal(et),p,b);a=CalculatePrice(new Decimal(et),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:h=CalculateRebate(new Decimal(ft),w,b);s=CalculatePrice(new Decimal(ft),w,h);k=CalculateRebate(new Decimal(ft),y,b);l=CalculatePrice(new Decimal(ft),y,k);d=CalculateRebate(new Decimal(ft),p,b);a=CalculatePrice(new Decimal(ft),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:h=CalculateRebate(new Decimal(c*tt),w,b);s=CalculatePrice(new Decimal(c*tt),w,h);k=CalculateRebate(new Decimal(c*g),y,b);l=CalculatePrice(new Decimal(c*g),y,k);d=CalculateRebate(new Decimal(c*nt),p,b);a=CalculatePrice(new Decimal(c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:h=CalculateRebate(new Decimal(c*tt),w,b);s=CalculatePrice(new Decimal(c*tt),w,h);k=CalculateRebate(new Decimal(c*g),y,b);l=CalculatePrice(new Decimal(c*g),y,k);d=CalculateRebate(new Decimal(c*nt),p,b);a=CalculatePrice(new Decimal(c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:h=CalculateRebate(new Decimal(tt*rt),w,b);s=CalculatePrice(new Decimal(tt*rt),w,h);k=CalculateRebate(new Decimal(g*rt),y,b);l=CalculatePrice(new Decimal(g*rt),y,k);d=CalculateRebate(new Decimal(nt*rt),p,b);a=CalculatePrice(new Decimal(nt*rt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:h=CalculateRebate(new Decimal(tt*rt),w,b);s=CalculatePrice(new Decimal(tt*rt),w,h);k=CalculateRebate(new Decimal(g*rt),y,b);l=CalculatePrice(new Decimal(g*rt),y,k);d=CalculateRebate(new Decimal(nt*rt),p,b);a=CalculatePrice(new Decimal(nt*rt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:h=CalculateRebate(new Decimal(tt*(c+1)),w,b);s=CalculatePrice(new Decimal(tt*(c+1)),w,h);k=CalculateRebate(new Decimal(g*(c+1)),y,b);l=CalculatePrice(new Decimal(g*(c+1)),y,k);d=CalculateRebate(new Decimal(nt*(c+1)),p,b);a=CalculatePrice(new Decimal(nt*(c+1)),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:h=CalculateRebate(new Decimal(tt*(c+1)),w,b);s=CalculatePrice(new Decimal((c+1)*tt),w,h);k=CalculateRebate(new Decimal(g*(c+1)),y,b);l=CalculatePrice(new Decimal(g*(c+1)),y,k);d=CalculateRebate(new Decimal(nt*(c+1)),p,b);a=CalculatePrice(new Decimal(nt*(c+1)),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:h=CalculateRebate(new Decimal(it*c*tt),w,b);s=CalculatePrice(new Decimal(it*c*tt),w,h);k=CalculateRebate(new Decimal(it*c*g),y,b);l=CalculatePrice(new Decimal(it*c*g),y,k);d=CalculateRebate(new Decimal(it*c*nt),p,b);a=CalculatePrice(new Decimal(it*c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:h=CalculateRebate(new Decimal(it*c*tt),w,b);s=CalculatePrice(new Decimal(it*c*tt),w,h);k=CalculateRebate(new Decimal(it*c*g),y,b);l=CalculatePrice(new Decimal(it*c*g),y,k);d=CalculateRebate(new Decimal(it*c*nt),p,b);a=CalculatePrice(new Decimal(it*c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v)}tt==0&&(u.setValue("ATOTAL_AMOUNT",0),u.setValue("GRAND_TOTAL",0));g==0&&u.setValue("CG1TOTAL_AMOUNT",0);nt==0&&u.setValue("CG2TOTAL_AMOUNT",0)}}catch(kt){this.setCalloutActive(!1);this.log.severe(kt.toString())}return i=r=u=f=e=o=null,""};c.prototype.UOMSelected=function(i,r,u,f,e,o){var it,s,l,a,h,k,d,v,ot;if(e==null||e.toString()==""||(it=24,ot=t.getValueOfInt(e),ot=t.getValueOfInt(u.getValue("AUOM_ID")),ot==null))return"";u.setValue("CG1UOM_ID",ot);u.setValue("CG2UOM_ID",ot);var ht=u.getValue("AUOM_ID").toString(),p=t.getValueOfDecimal(u.getValue("APRICE")),g=t.getValueOfInt(u.getValue("ANUM")),b=t.getValueOfDecimal(u.getValue("AREBATE")),nt=t.getValueOfInt(u.getValue("CG1NUM")),tt=t.getValueOfInt(u.getValue("CG2NUM")),y=t.getValueOfDecimal(u.getValue("CG1PRICE")),w=t.getValueOfDecimal(u.getValue("CG2PRICE")),ct=t.getValueOfDateTime(u.getValue("ADATETO")),lt=t.getValueOfDateTime(u.getValue("ADATEFROM")),st=ct.Subtract(lt),c=Utility.timeUtil.getDaysBetween(lt,ct),wt=st.TotalMilliseconds,ft=st.TotalSeconds,et=st.TotalMinutes,ut,rt,at=c/30,yt=c%30,vt=c/7,pt=c%7;if(ut=yt==0?at:at+1,rt=pt==0?vt:vt+1,t.getValueOfInt(b)==0){h=n.Env.ZERO;switch(int.Parse(ht)){case 1000003:s=p;l=y;a=w;l=y;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:s=CalculatePrice(new Decimal(g),p,h);l=CalculatePrice(new Decimal(nt),y,h);a=CalculatePrice(new Decimal(tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:s=CalculatePrice(new Decimal(g),p,h);l=CalculatePrice(new Decimal(nt),y,h);a=CalculatePrice(new Decimal(tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:s=CalculatePrice(new Decimal(c),p,h);l=CalculatePrice(new Decimal(c),y,h);a=CalculatePrice(new Decimal(c),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:s=CalculatePrice(new Decimal(ut),p,h);l=CalculatePrice(new Decimal(ut),y,h);a=CalculatePrice(new Decimal(ut),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:s=CalculatePrice(new Decimal(rt),p,h);l=CalculatePrice(new Decimal(rt),y,h);a=CalculatePrice(new Decimal(rt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:s=CalculatePrice(new Decimal(c+1),p,h);l=CalculatePrice(new Decimal(c+1),y,h);a=CalculatePrice(new Decimal(c+1),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:s=CalculatePrice(new Decimal(it*c),p,h);l=CalculatePrice(new Decimal(it*c),y,h);a=CalculatePrice(new Decimal(it*c),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:s=CalculatePrice(new Decimal(et),p,h);l=CalculatePrice(new Decimal(et),y,h);a=CalculatePrice(new Decimal(et),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:s=CalculatePrice(new Decimal(ft),p,h);l=CalculatePrice(new Decimal(ft),y,h);a=CalculatePrice(new Decimal(ft),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:s=CalculatePrice(new Decimal(c*g),p,h);l=CalculatePrice(new Decimal(c*nt),y,h);a=CalculatePrice(new Decimal(c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:s=CalculatePrice(new Decimal(c*g),p,h);l=CalculatePrice(new Decimal(c*nt),y,h);a=CalculatePrice(new Decimal(c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:s=CalculatePrice(new Decimal(g*rt),p,h);l=CalculatePrice(new Decimal(nt*rt),y,h);a=CalculatePrice(new Decimal(tt*rt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:s=CalculatePrice(new Decimal(g*rt),p,h);l=CalculatePrice(new Decimal(nt*rt),y,h);a=CalculatePrice(new Decimal(tt*rt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:s=CalculatePrice(new Decimal(g*(c+1)),p,h);l=CalculatePrice(new Decimal(nt*(c+1)),y,h);a=CalculatePrice(new Decimal(tt*(c+1)),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:s=CalculatePrice(new Decimal((c+1)*g),p,h);l=CalculatePrice(new Decimal((c+1)*nt),y,h);a=CalculatePrice(new Decimal((c+1)*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:s=CalculatePrice(new Decimal(it*c*g),p,h);l=CalculatePrice(new Decimal(it*c*nt),y,h);a=CalculatePrice(new Decimal(it*c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:s=CalculatePrice(new Decimal(it*c*g),p,h);l=CalculatePrice(new Decimal(it*c*nt),y,h);a=CalculatePrice(new Decimal(it*c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v)}}else switch(int.Parse(ht)){case 1000003:s=p;l=y;a=w;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:h=CalculateRebate(new Decimal(g),p,b);s=CalculatePrice(new Decimal(g),p,h);k=CalculateRebate(new Decimal(nt),y,b);l=CalculatePrice(new Decimal(nt),y,k);d=CalculateRebate(new Decimal(tt),w,b);a=CalculatePrice(new Decimal(tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:h=CalculateRebate(new Decimal(g),p,b);s=CalculatePrice(new Decimal(g),p,h);k=CalculateRebate(new Decimal(nt),y,b);l=CalculatePrice(new Decimal(nt),y,k);d=CalculateRebate(new Decimal(tt),w,b);a=CalculatePrice(new Decimal(tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:h=CalculateRebate(new Decimal(c),p,b);s=CalculatePrice(new Decimal(c),p,h);k=CalculateRebate(new Decimal(c),y,b);l=CalculatePrice(new Decimal(c),y,k);d=CalculateRebate(new Decimal(c),w,b);a=CalculatePrice(new Decimal(c),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:h=CalculateRebate(new Decimal(ut),p,b);s=CalculatePrice(new Decimal(ut),p,h);k=CalculateRebate(new Decimal(ut),y,b);l=CalculatePrice(new Decimal(ut),y,k);d=CalculateRebate(new Decimal(ut),w,b);a=CalculatePrice(new Decimal(ut),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:h=CalculateRebate(new Decimal(rt),p,b);s=CalculatePrice(new Decimal(rt),p,h);k=CalculateRebate(new Decimal(rt),y,b);l=CalculatePrice(new Decimal(rt),y,k);d=CalculateRebate(new Decimal(rt),w,b);a=CalculatePrice(new Decimal(rt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:h=CalculateRebate(new Decimal(c+1),p,b);s=CalculatePrice(new Decimal(c+1),p,h);k=CalculateRebate(new Decimal(c+1),y,b);l=CalculatePrice(new Decimal(c+1),y,k);d=CalculateRebate(new Decimal(c+1),w,b);a=CalculatePrice(new Decimal(c+1),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:h=CalculateRebate(new Decimal(it*c),p,b);s=CalculatePrice(new Decimal(it*c),p,h);k=CalculateRebate(new Decimal(it*c),y,b);l=CalculatePrice(new Decimal(it*c),y,k);d=CalculateRebate(new Decimal(it*c),w,b);a=CalculatePrice(new Decimal(it*c),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:h=CalculateRebate(new Decimal(et),p,b);s=CalculatePrice(new Decimal(et),p,h);k=CalculateRebate(new Decimal(et),y,b);l=CalculatePrice(new Decimal(et),y,k);d=CalculateRebate(new Decimal(et),w,b);a=CalculatePrice(new Decimal(et),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:h=CalculateRebate(new Decimal(ft),p,b);s=CalculatePrice(new Decimal(ft),p,h);k=CalculateRebate(new Decimal(ft),y,b);l=CalculatePrice(new Decimal(ft),y,k);d=CalculateRebate(new Decimal(ft),w,b);a=CalculatePrice(new Decimal(ft),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:h=CalculateRebate(new Decimal(c*g),p,b);s=CalculatePrice(new Decimal(c*g),p,h);k=CalculateRebate(new Decimal(c*nt),y,b);l=CalculatePrice(new Decimal(c*nt),y,k);d=CalculateRebate(new Decimal(c*tt),w,b);a=CalculatePrice(new Decimal(c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:h=CalculateRebate(new Decimal(c*g),p,b);s=CalculatePrice(new Decimal(c*g),p,h);k=CalculateRebate(new Decimal(c*nt),y,b);l=CalculatePrice(new Decimal(c*nt),y,k);d=CalculateRebate(new Decimal(c*tt),w,b);a=CalculatePrice(new Decimal(c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:h=CalculateRebate(new Decimal(g*rt),p,b);s=CalculatePrice(new Decimal(g*rt),p,h);k=CalculateRebate(new Decimal(nt*rt),y,b);l=CalculatePrice(new Decimal(nt*rt),y,k);d=CalculateRebate(new Decimal(tt*rt),w,b);a=CalculatePrice(new Decimal(tt*rt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:h=CalculateRebate(new Decimal(g*rt),p,b);s=CalculatePrice(new Decimal(g*rt),p,h);k=CalculateRebate(new Decimal(nt*rt),y,b);l=CalculatePrice(new Decimal(nt*rt),y,k);d=CalculateRebate(new Decimal(tt*rt),w,b);a=CalculatePrice(new Decimal(tt*rt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:h=CalculateRebate(new Decimal(g*(c+1)),p,b);s=CalculatePrice(new Decimal(g*(c+1)),p,h);k=CalculateRebate(new Decimal(nt*(c+1)),y,b);l=CalculatePrice(new Decimal(nt*(c+1)),y,k);d=CalculateRebate(new Decimal(tt*(c+1)),w,b);a=CalculatePrice(new Decimal(tt*(c+1)),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:h=CalculateRebate(new Decimal(g*(c+1)),p,b);s=CalculatePrice(new Decimal((c+1)*g),p,h);k=CalculateRebate(new Decimal(nt*(c+1)),y,b);l=CalculatePrice(new Decimal(nt*(c+1)),y,k);d=CalculateRebate(new Decimal(tt*(c+1)),w,b);a=CalculatePrice(new Decimal(tt*(c+1)),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:h=CalculateRebate(new Decimal(it*c*g),p,b);s=CalculatePrice(new Decimal(it*c*g),p,h);k=CalculateRebate(new Decimal(it*c*nt),y,b);l=CalculatePrice(new Decimal(it*c*nt),y,k);d=CalculateRebate(new Decimal(it*c*tt),w,b);a=CalculatePrice(new Decimal(it*c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:h=CalculateRebate(new Decimal(it*c*g),p,b);s=CalculatePrice(new Decimal(it*c*g),p,h);k=CalculateRebate(new Decimal(it*c*nt),y,b);l=CalculatePrice(new Decimal(it*c*nt),y,k);d=CalculateRebate(new Decimal(it*c*tt),w,b);a=CalculatePrice(new Decimal(it*c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v)}return g==0&&(u.setValue("ATOTAL_AMOUNT",0),u.setValue("GRAND_TOTAL",0)),nt==0&&u.setValue("CG1TOTAL_AMOUNT",0),tt==0&&u.setValue("CG2TOTAL_AMOUNT",0),i=r=u=f=e=o=null,""};c.prototype.AVALSelected=function(i,r,u,f,e,o){var it,s,l,a,h,k,d,v,ot;if(e==null||e.toString()=="")return"";it=24;ot=null;try{ot=u.getValue("AUOM_ID").toString()}catch(pt){return this.setCalloutActive(!1),""}var p=t.getValueOfDecimal(u.getValue("APRICE")),b=t.getValueOfDecimal(u.getValue("AREBATE")),g=t.getValueOfInt(u.getValue("ANUM")),ht=t.getValueOfDateTime(u.getValue("ADATETO")),nt=t.getValueOfInt(u.getValue("CG1NUM")),tt=t.getValueOfInt(u.getValue("CG2NUM")),y=t.getValueOfDecimal(u.getValue("CG1PRICE")),w=t.getValueOfDecimal(u.getValue("CG2PRICE")),ct=t.getValueOfDateTime(u.getValue("ADATEFROM")),st=ht.Subtract(ct),c=Utility.timeUtil.getDaysBetween(ct,ht),wt=st.TotalMilliseconds,ft=st.TotalSeconds,et=st.TotalMinutes,ut,rt,lt=c/30,vt=c%30,at=c/7,yt=c%7;if(ut=vt==0?lt:lt+1,rt=yt==0?at:at+1,t.getValueOfInt(b)==0){h=n.Env.ZERO;switch(int.Parse(ot)){case 1000003:s=p;l=y;a=w;l=y;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:s=CalculatePrice(new Decimal(g),p,h);l=CalculatePrice(new Decimal(nt),y,h);a=CalculatePrice(new Decimal(tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:s=CalculatePrice(new Decimal(g),p,h);l=CalculatePrice(new Decimal(nt),y,h);a=CalculatePrice(new Decimal(tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:s=CalculatePrice(new Decimal(c),p,h);l=CalculatePrice(new Decimal(c),y,h);a=CalculatePrice(new Decimal(c),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:s=CalculatePrice(new Decimal(ut),p,h);l=CalculatePrice(new Decimal(ut),y,h);a=CalculatePrice(new Decimal(ut),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:s=CalculatePrice(new Decimal(rt),p,h);l=CalculatePrice(new Decimal(rt),y,h);a=CalculatePrice(new Decimal(rt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:s=CalculatePrice(new Decimal(c+1),p,h);l=CalculatePrice(new Decimal(c+1),y,h);a=CalculatePrice(new Decimal(c+1),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:s=CalculatePrice(new Decimal(it*c),p,h);l=CalculatePrice(new Decimal(it*c),y,h);a=CalculatePrice(new Decimal(it*c),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:s=CalculatePrice(new Decimal(et),p,h);l=CalculatePrice(new Decimal(et),y,h);a=CalculatePrice(new Decimal(et),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:s=CalculatePrice(new Decimal(ft),p,h);l=CalculatePrice(new Decimal(ft),y,h);a=CalculatePrice(new Decimal(ft),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:s=CalculatePrice(new Decimal(c*g),p,h);l=CalculatePrice(new Decimal(c*nt),y,h);a=CalculatePrice(new Decimal(c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:s=CalculatePrice(new Decimal(c*g),p,h);l=CalculatePrice(new Decimal(c*nt),y,h);a=CalculatePrice(new Decimal(c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:s=CalculatePrice(new Decimal(g*rt),p,h);l=CalculatePrice(new Decimal(nt*rt),y,h);a=CalculatePrice(new Decimal(tt*rt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:s=CalculatePrice(new Decimal(g*rt),p,h);l=CalculatePrice(new Decimal(nt*rt),y,h);a=CalculatePrice(new Decimal(tt*rt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:s=CalculatePrice(new Decimal(g*(c+1)),p,h);l=CalculatePrice(new Decimal(nt*(c+1)),y,h);a=CalculatePrice(new Decimal(tt*(c+1)),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:s=CalculatePrice(new Decimal((c+1)*g),p,h);l=CalculatePrice(new Decimal((c+1)*nt),y,h);a=CalculatePrice(new Decimal((c+1)*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:s=CalculatePrice(new Decimal(it*c*g),p,h);l=CalculatePrice(new Decimal(it*c*nt),y,h);a=CalculatePrice(new Decimal(it*c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:s=CalculatePrice(new Decimal(it*c*g),p,h);l=CalculatePrice(new Decimal(it*c*nt),y,h);a=CalculatePrice(new Decimal(it*c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v)}}else switch(int.Parse(ot)){case 1000003:s=p;l=y;a=w;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:h=CalculateRebate(new Decimal(g),p,b);s=CalculatePrice(new Decimal(g),p,h);k=CalculateRebate(new Decimal(nt),y,b);l=CalculatePrice(new Decimal(nt),y,k);d=CalculateRebate(new Decimal(tt),w,b);a=CalculatePrice(new Decimal(tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:h=CalculateRebate(new Decimal(g),p,b);s=CalculatePrice(new Decimal(g),p,h);k=CalculateRebate(new Decimal(nt),y,b);l=CalculatePrice(new Decimal(nt),y,k);d=CalculateRebate(new Decimal(tt),w,b);a=CalculatePrice(new Decimal(tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:h=CalculateRebate(new Decimal(c),p,b);s=CalculatePrice(new Decimal(c),p,h);k=CalculateRebate(new Decimal(c),y,b);l=CalculatePrice(new Decimal(c),y,k);d=CalculateRebate(new Decimal(c),w,b);a=CalculatePrice(new Decimal(c),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:h=CalculateRebate(new Decimal(ut),p,b);s=CalculatePrice(new Decimal(ut),p,h);k=CalculateRebate(new Decimal(ut),y,b);l=CalculatePrice(new Decimal(ut),y,k);d=CalculateRebate(new Decimal(ut),w,b);a=CalculatePrice(new Decimal(ut),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:h=CalculateRebate(new Decimal(rt),p,b);s=CalculatePrice(new Decimal(rt),p,h);k=CalculateRebate(new Decimal(rt),y,b);l=CalculatePrice(new Decimal(rt),y,k);d=CalculateRebate(new Decimal(rt),w,b);a=CalculatePrice(new Decimal(rt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:h=CalculateRebate(new Decimal(c+1),p,b);s=CalculatePrice(new Decimal(c+1),p,h);k=CalculateRebate(new Decimal(c+1),y,b);l=CalculatePrice(new Decimal(c+1),y,k);d=CalculateRebate(new Decimal(c+1),w,b);a=CalculatePrice(new Decimal(c+1),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:h=CalculateRebate(new Decimal(it*c),p,b);s=CalculatePrice(new Decimal(it*c),p,h);k=CalculateRebate(new Decimal(it*c),y,b);l=CalculatePrice(new Decimal(it*c),y,k);d=CalculateRebate(new Decimal(it*c),w,b);a=CalculatePrice(new Decimal(it*c),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:h=CalculateRebate(new Decimal(et),p,b);s=CalculatePrice(new Decimal(et),p,h);k=CalculateRebate(new Decimal(et),y,b);l=CalculatePrice(new Decimal(et),y,k);d=CalculateRebate(new Decimal(et),w,b);a=CalculatePrice(new Decimal(et),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:h=CalculateRebate(new Decimal(ft),p,b);s=CalculatePrice(new Decimal(ft),p,h);k=CalculateRebate(new Decimal(ft),y,b);l=CalculatePrice(new Decimal(ft),y,k);d=CalculateRebate(new Decimal(ft),w,b);a=CalculatePrice(new Decimal(ft),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:h=CalculateRebate(new Decimal(c*g),p,b);s=CalculatePrice(new Decimal(c*g),p,h);k=CalculateRebate(new Decimal(c*nt),y,b);l=CalculatePrice(new Decimal(c*nt),y,k);d=CalculateRebate(new Decimal(c*tt),w,b);a=CalculatePrice(new Decimal(c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:h=CalculateRebate(new Decimal(c*g),p,b);s=CalculatePrice(new Decimal(c*g),p,h);k=CalculateRebate(new Decimal(c*nt),y,b);l=CalculatePrice(new Decimal(c*nt),y,k);d=CalculateRebate(new Decimal(c*tt),w,b);a=CalculatePrice(new Decimal(c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:h=CalculateRebate(new Decimal(g*rt),p,b);s=CalculatePrice(new Decimal(g*rt),p,h);k=CalculateRebate(new Decimal(nt*rt),y,b);l=CalculatePrice(new Decimal(nt*rt),y,k);d=CalculateRebate(new Decimal(tt*rt),w,b);a=CalculatePrice(new Decimal(tt*rt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:h=CalculateRebate(new Decimal(g*rt),p,b);s=CalculatePrice(new Decimal(g*rt),p,h);k=CalculateRebate(new Decimal(nt*rt),y,b);l=CalculatePrice(new Decimal(nt*rt),y,k);d=CalculateRebate(new Decimal(tt*rt),w,b);a=CalculatePrice(new Decimal(tt*rt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:h=CalculateRebate(new Decimal(g*(c+1)),p,b);s=CalculatePrice(new Decimal(g*(c+1)),p,h);k=CalculateRebate(new Decimal(nt*(c+1)),y,b);l=CalculatePrice(new Decimal(nt*(c+1)),y,k);d=CalculateRebate(new Decimal(tt*(c+1)),w,b);a=CalculatePrice(new Decimal(tt*(c+1)),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:h=CalculateRebate(new Decimal(g*(c+1)),p,b);s=CalculatePrice(new Decimal((c+1)*g),p,h);k=CalculateRebate(new Decimal(nt*(c+1)),y,b);l=CalculatePrice(new Decimal(nt*(c+1)),y,k);d=CalculateRebate(new Decimal(tt*(c+1)),w,b);a=CalculatePrice(new Decimal(tt*(c+1)),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:h=CalculateRebate(new Decimal(it*c*g),p,b);s=CalculatePrice(new Decimal(it*c*g),p,h);k=CalculateRebate(new Decimal(it*c*nt),y,b);l=CalculatePrice(new Decimal(it*c*nt),y,k);d=CalculateRebate(new Decimal(it*c*tt),w,b);a=CalculatePrice(new Decimal(it*c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:h=CalculateRebate(new Decimal(it*c*g),p,b);s=CalculatePrice(new Decimal(it*c*g),p,h);k=CalculateRebate(new Decimal(it*c*nt),y,b);l=CalculatePrice(new Decimal(it*c*nt),y,k);d=CalculateRebate(new Decimal(it*c*tt),w,b);a=CalculatePrice(new Decimal(it*c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v)}return g==0&&(u.setValue("ATOTAL_AMOUNT",0),u.setValue("GRAND_TOTAL",0)),nt==0&&u.setValue("CG1TOTAL_AMOUNT",0),tt==0&&u.setValue("CG2TOTAL_AMOUNT",0),i=r=u=f=e=o=null,""};n.Model.CalloutOfferSerIncluded=c;n.Utility.inheritPrototype(l,n.CalloutEngine);l.prototype.CalculatePrice=function(n,t,i){return Decimal.Subtract(Decimal.Multiply(n,t),i)};l.prototype.CalculateRebate=function(n,t,i){return Decimal.Multiply(Decimal.Multiply(n,t),Decimal.Multiply(new Decimal(.01),i))};l.prototype.OfferServices=function(i,r,u,f,e,o){var st,wt,ot,ft,et;if(e==null||e.toString()==""||(st=t.getValueOfInt(e),st==null||st==0))return"";var ht=0,ct=new Decimal(0),lt=new Decimal(0),at=new Decimal(0),s,l,a,v,h,k,d,vt,yt,rt=null;try{for(ot=[],ot[0]=new n.DB.SqlParam("@FO_SERVICE_ID",st),rt=n.DB.executeReader("select uom.FO_HOTEL_UOM_ID,s.DESCRIPTION from FO_HOTEL_UOM uom inner join FO_SERVICE s ON(uom.FO_HOTEL_UOM_ID= s.FO_HOTEL_UOM_ID) where s.FO_SERVICE_ID=@FO_SERVICE_ID ",ot,null);rt.read();)ht=t.getValueOfInt(rt[0]),u.setValue("AUOM_ID",ht),u.setValue("CG1UOM_ID",ht),u.setValue("CG2UOM_ID",ht),u.setValue("DESCRIPTION",t.getValueOfString(rt[1]));rt.close()}catch(pt){this.setCalloutActive(!1);rt!=null&&rt.close();this.log.severe(pt.toString())}finally{rt!=null&&rt.close()}wt="select PRICE,CHILDGROUP1,CHILDGROUP2,UOM1,UOM2 from FO_SERVICE_PRICE_PRICELINE where CREATED=(select max(CREATED) from FO_SERVICE_PRICE_PRICELINE where FO_SERVICE_ID=@FO_SERVICE_ID)";try{for(ot=[],ot[0]=new SqlParameter("@FO_SERVICE_ID",st),rt=n.DB.executeReader(wt,ot,null);rt.read();)ct=t.getValueOfDecimal(rt[0]),lt=t.getValueOfDecimal(rt[1]),at=t.getValueOfDecimal(rt[2]),vt=rt[3].toString(),yt=rt[4].toString(),vt=="Y"&&(lt=Decimal.Multiply(Decimal.Multiply(ct,lt),new Decimal(.01))),yt=="Y"&&(at=Decimal.Multiply(Decimal.Multiply(ct,at),new Decimal(.01))),u.setValue("APRICE",ct),u.setValue("CG1PRICE",lt),u.setValue("CG2PRICE",at)}catch(pt){this.setCalloutActive(!1);this.log.severe(pt.toString())}finally{rt!=null&&rt.close()}var bt=u.getValue("AUOM_ID").toString(),g=t.getValueOfInt(u.getValue("ANUM")),p=t.getValueOfDecimal(u.getValue("APRICE")),b=t.getValueOfDecimal(u.getValue("AREBATE")),nt=t.getValueOfInt(u.getValue("CG1NUM")),tt=t.getValueOfInt(u.getValue("CG2NUM")),y=t.getValueOfDecimal(u.getValue("CG1PRICE")),w=t.getValueOfDecimal(u.getValue("CG2PRICE")),kt=t.getValueOfDateTime(u.getValue("ADATETO")),dt=t.getValueOfDateTime(u.getValue("ADATEFROM")),c=Utility.timeUtil.getDaysBetween(dt,kt),gt=dt.Subtract(kt),ut,it,ni=c/30,ii=c%30,ti=c/7,ri=c%7;if(ut=ii==0?ni:ni+1,it=ri==0?ti:ti+1,ft=gt.Seconds,et=gt.Minutes,t.getValueOfInt(b)==0){h=n.Env.ZERO;switch(int.Parse(bt)){case 1000003:s=p;l=y;a=w;l=y;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:s=CalculatePrice(new Decimal(g),p,h);l=CalculatePrice(new Decimal(nt),y,h);a=CalculatePrice(new Decimal(tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:s=CalculatePrice(new Decimal(g),p,h);l=CalculatePrice(new Decimal(nt),y,h);a=CalculatePrice(new Decimal(tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:s=CalculatePrice(new Decimal(c),p,h);l=CalculatePrice(new Decimal(c),y,h);a=CalculatePrice(new Decimal(c),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:s=CalculatePrice(new Decimal(ut),p,h);l=CalculatePrice(new Decimal(ut),y,h);a=CalculatePrice(new Decimal(ut),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:s=CalculatePrice(new Decimal(it),p,h);l=CalculatePrice(new Decimal(it),y,h);a=CalculatePrice(new Decimal(it),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:s=CalculatePrice(new Decimal(c+1),p,h);l=CalculatePrice(new Decimal(c+1),y,h);a=CalculatePrice(new Decimal(c+1),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:s=CalculatePrice(new Decimal(24*c),p,h);l=CalculatePrice(new Decimal(24*c),y,h);a=CalculatePrice(new Decimal(24*c),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:s=CalculatePrice(new Decimal(et),p,h);l=CalculatePrice(new Decimal(et),y,h);a=CalculatePrice(new Decimal(et),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:s=CalculatePrice(new Decimal(ft),p,h);l=CalculatePrice(new Decimal(ft),y,h);a=CalculatePrice(new Decimal(ft),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:s=CalculatePrice(new Decimal(c*g),p,h);l=CalculatePrice(new Decimal(c*nt),y,h);a=CalculatePrice(new Decimal(c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:s=CalculatePrice(new Decimal(c*g),p,h);l=CalculatePrice(new Decimal(c*nt),y,h);a=CalculatePrice(new Decimal(c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:s=CalculatePrice(new Decimal(g*it),p,h);l=CalculatePrice(new Decimal(nt*it),y,h);a=CalculatePrice(new Decimal(tt*it),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:s=CalculatePrice(new Decimal(g*it),p,h);l=CalculatePrice(new Decimal(nt*it),y,h);a=CalculatePrice(new Decimal(tt*it),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:s=CalculatePrice(new Decimal(g*(c+1)),p,h);l=CalculatePrice(new Decimal(nt*(c+1)),y,h);a=CalculatePrice(new Decimal(tt*(c+1)),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:s=CalculatePrice(new Decimal((c+1)*g),p,h);l=CalculatePrice(new Decimal((c+1)*nt),y,h);a=CalculatePrice(new Decimal((c+1)*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:s=CalculatePrice(new Decimal(24*c*g),p,h);l=CalculatePrice(new Decimal(24*c*nt),y,h);a=CalculatePrice(new Decimal(24*c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:s=CalculatePrice(new Decimal(24*c*g),p,h);l=CalculatePrice(new Decimal(24*c*nt),y,h);a=CalculatePrice(new Decimal(24*c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;default:ShowMessage.Info("false",!0,"","")}}else switch(int.Parse(bt)){case 1000003:s=p;l=y;a=w;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:h=CalculateRebate(new Decimal(g),p,b);s=CalculatePrice(new Decimal(g),p,h);k=CalculateRebate(new Decimal(nt),y,b);l=CalculatePrice(new Decimal(nt),y,k);d=CalculateRebate(new Decimal(tt),w,b);a=CalculatePrice(new Decimal(tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:h=CalculateRebate(new Decimal(g),p,b);s=CalculatePrice(new Decimal(g),p,h);k=CalculateRebate(new Decimal(nt),y,b);l=CalculatePrice(new Decimal(nt),y,k);d=CalculateRebate(new Decimal(tt),w,b);a=CalculatePrice(new Decimal(tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:h=CalculateRebate(new Decimal(c),p,b);s=CalculatePrice(new Decimal(c),p,h);k=CalculateRebate(new Decimal(c),y,b);l=CalculatePrice(new Decimal(c),y,k);d=CalculateRebate(new Decimal(c),w,b);a=CalculatePrice(new Decimal(c),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:h=CalculateRebate(new Decimal(ut),p,b);s=CalculatePrice(new Decimal(ut),p,h);k=CalculateRebate(new Decimal(ut),y,b);l=CalculatePrice(new Decimal(ut),y,k);d=CalculateRebate(new Decimal(ut),w,b);a=CalculatePrice(new Decimal(ut),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:h=CalculateRebate(new Decimal(it),p,b);s=CalculatePrice(new Decimal(it),p,h);k=CalculateRebate(new Decimal(it),y,b);l=CalculatePrice(new Decimal(it),y,k);d=CalculateRebate(new Decimal(it),w,b);a=CalculatePrice(new Decimal(it),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:h=CalculateRebate(new Decimal(c+1),p,b);s=CalculatePrice(new Decimal(c+1),p,h);k=CalculateRebate(new Decimal(c+1),y,b);l=CalculatePrice(new Decimal(c+1),y,k);d=CalculateRebate(new Decimal(c+1),w,b);a=CalculatePrice(new Decimal(c+1),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:h=CalculateRebate(new Decimal(24*c),p,b);s=CalculatePrice(new Decimal(24*c),p,h);k=CalculateRebate(new Decimal(24*c),y,b);l=CalculatePrice(new Decimal(24*c),y,k);d=CalculateRebate(new Decimal(24*c),w,b);a=CalculatePrice(new Decimal(24*c),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:h=CalculateRebate(new Decimal(et),p,b);s=CalculatePrice(new Decimal(et),p,h);k=CalculateRebate(new Decimal(et),y,b);l=CalculatePrice(new Decimal(et),y,k);d=CalculateRebate(new Decimal(et),w,b);a=CalculatePrice(new Decimal(et),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:h=CalculateRebate(new Decimal(ft),p,b);s=CalculatePrice(new Decimal(ft),p,h);k=CalculateRebate(new Decimal(ft),y,b);l=CalculatePrice(new Decimal(ft),y,k);d=CalculateRebate(new Decimal(ft),w,b);a=CalculatePrice(new Decimal(ft),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:h=CalculateRebate(new Decimal(c*g),p,b);s=CalculatePrice(new Decimal(c*g),p,h);k=CalculateRebate(new Decimal(c*nt),y,b);l=CalculatePrice(new Decimal(c*nt),y,k);d=CalculateRebate(new Decimal(c*tt),w,b);a=CalculatePrice(new Decimal(c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:h=CalculateRebate(new Decimal(c*g),p,b);s=CalculatePrice(new Decimal(c*g),p,h);k=CalculateRebate(new Decimal(c*nt),y,b);l=CalculatePrice(new Decimal(c*nt),y,k);d=CalculateRebate(new Decimal(c*tt),w,b);a=CalculatePrice(new Decimal(c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:h=CalculateRebate(new Decimal(g*it),p,b);s=CalculatePrice(new Decimal(g*it),p,h);k=CalculateRebate(new Decimal(nt*it),y,b);l=CalculatePrice(new Decimal(nt*it),y,k);d=CalculateRebate(new Decimal(tt*it),w,b);a=CalculatePrice(new Decimal(tt*it),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:h=CalculateRebate(new Decimal(g*it),p,b);s=CalculatePrice(new Decimal(g*it),p,h);k=CalculateRebate(new Decimal(nt*it),y,b);l=CalculatePrice(new Decimal(nt*it),y,k);d=CalculateRebate(new Decimal(tt*it),w,b);a=CalculatePrice(new Decimal(tt*it),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:h=CalculateRebate(new Decimal(g*(c+1)),p,b);s=CalculatePrice(new Decimal(g*(c+1)),p,h);k=CalculateRebate(new Decimal(nt*(c+1)),y,b);l=CalculatePrice(new Decimal(nt*(c+1)),y,k);d=CalculateRebate(new Decimal(tt*(c+1)),w,b);a=CalculatePrice(new Decimal(tt*(c+1)),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:h=CalculateRebate(new Decimal(g*(c+1)),p,b);s=CalculatePrice(new Decimal((c+1)*g),p,h);k=CalculateRebate(new Decimal(nt*(c+1)),y,b);l=CalculatePrice(new Decimal(nt*(c+1)),y,k);d=CalculateRebate(new Decimal(tt*(c+1)),w,b);a=CalculatePrice(new Decimal(tt*(c+1)),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:h=CalculateRebate(new Decimal(24*c*g),p,b);s=CalculatePrice(new Decimal(24*c*g),p,h);k=CalculateRebate(new Decimal(24*c*nt),y,b);l=CalculatePrice(new Decimal(24*c*nt),y,k);d=CalculateRebate(new Decimal(24*c*tt),w,b);a=CalculatePrice(new Decimal(24*c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:h=CalculateRebate(new Decimal(24*c*g),p,b);s=CalculatePrice(new Decimal(24*c*g),p,h);k=CalculateRebate(new Decimal(24*c*nt),y,b);l=CalculatePrice(new Decimal(24*c*nt),y,k);d=CalculateRebate(new Decimal(24*c*tt),w,b);a=CalculatePrice(new Decimal(24*c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;default:ShowMessage.Info("false",!0,"","")}return g==0&&(u.setValue("ATOTAL_AMOUNT",0),u.setValue("GRAND_TOTAL",0)),nt==0&&u.setValue("CG1TOTAL_AMOUNT",0),tt==0&&u.setValue("CG2TOTAL_AMOUNT",0),i=r=u=f=e=o=null,""};l.prototype.tochkdate=function(i,r,u,f,e,o){var s,l,a,h,k,d,v,ht,ut,at,vt,lt,ot;if(e==null||e.toString()==""||(ht=t.getValueOfDateTime(e),ht==null||ht.equals(0)))return"";ut=t.getValueOfDateTime(e);ut=t.getValueOfDateTime(u.getValue("ADATETO"));var st=t.getValueOfDateTime(u.getValue("ADATEFROM")),g=t.getValueOfInt(u.getValue("CG1NUM")),nt=t.getValueOfInt(u.getValue("CG2NUM")),y=t.getValueOfDecimal(u.getValue("CG1PRICE")),p=t.getValueOfDecimal(u.getValue("CG2PRICE"));try{if(ut=t.getValueOfDateTime(u.getValue("ADATETO")),at=Utility.TimeUtil.getDaysBetween(st,ut),at<=0)vt=Utility.TimeUtil.AddDays(st,1),u.setValue("ADATETO",vt);else if(ut.compareTo(st)>0){var ct=ut.Subtract(st),c=Utility.TimeUtil.getDaysBetween(st,ut),dt=ct.Milliseconds,ft=ct.Seconds,et=ct.Minutes,rt,it,yt=c/30,wt=c%30,pt=c/7,bt=c%7;rt=wt==0?yt:yt+1;it=bt==0?pt:pt+1;lt=t.getValueOfDateTime(u.getValue("ADATEFROM"));u.setValue("CG1DATETO",ut);u.setValue("CG2DATETO",ut);u.setValue("CG1DATEFROM",lt);u.setValue("CG2DATEFROM",lt);ot=u.getValue("AUOM_ID").toString();(ot==""||ot.Trim().Length==0)&&(ot="0");var w=t.getValueOfDecimal(u.getValue("APRICE")),tt=System.Convert.ToInt16(u.getValue("ANUM")),b=t.getValueOfDecimal(u.getValue("AREBATE"));if(t.getValueOfInt(b)==0){h=n.Env.ZERO;switch(int.Parse(ot)){case 1000003:s=w;l=y;a=p;l=y;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:s=CalculatePrice(new Decimal(tt),w,h);l=CalculatePrice(new Decimal(g),y,h);a=CalculatePrice(new Decimal(nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:s=CalculatePrice(new Decimal(tt),w,h);l=CalculatePrice(new Decimal(g),y,h);a=CalculatePrice(new Decimal(nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:s=CalculatePrice(new Decimal(c),w,h);l=CalculatePrice(new Decimal(c),y,h);a=CalculatePrice(new Decimal(c),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:s=CalculatePrice(new Decimal(rt),w,h);l=CalculatePrice(new Decimal(rt),y,h);a=CalculatePrice(new Decimal(rt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:s=CalculatePrice(new Decimal(it),w,h);l=CalculatePrice(new Decimal(it),y,h);a=CalculatePrice(new Decimal(it),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:s=CalculatePrice(new Decimal(c+1),w,h);l=CalculatePrice(new Decimal(c+1),y,h);a=CalculatePrice(new Decimal(c+1),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:s=CalculatePrice(new Decimal(24*c),w,h);l=CalculatePrice(new Decimal(24*c),y,h);a=CalculatePrice(new Decimal(24*c),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:s=CalculatePrice(new Decimal(et),w,h);l=CalculatePrice(new Decimal(et),y,h);a=CalculatePrice(new Decimal(et),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:s=CalculatePrice(new Decimal(ft),w,h);l=CalculatePrice(new Decimal(ft),y,h);a=CalculatePrice(new Decimal(ft),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:s=CalculatePrice(new Decimal(c*tt),w,h);l=CalculatePrice(new Decimal(c*g),y,h);a=CalculatePrice(new Decimal(c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:s=CalculatePrice(new Decimal(c*tt),w,h);l=CalculatePrice(new Decimal(c*g),y,h);a=CalculatePrice(new Decimal(c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:s=CalculatePrice(new Decimal(tt*it),w,h);l=CalculatePrice(new Decimal(g*it),y,h);a=CalculatePrice(new Decimal(nt*it),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:s=CalculatePrice(new Decimal(tt*it),w,h);l=CalculatePrice(new Decimal(g*it),y,h);a=CalculatePrice(new Decimal(nt*it),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:s=CalculatePrice(new Decimal(tt*(c+1)),w,h);l=CalculatePrice(new Decimal(g*(c+1)),y,h);a=CalculatePrice(new Decimal(nt*(c+1)),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:s=CalculatePrice(new Decimal((c+1)*tt),w,h);l=CalculatePrice(new Decimal((c+1)*g),y,h);a=CalculatePrice(new Decimal((c+1)*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:s=CalculatePrice(new Decimal(24*c*tt),w,h);l=CalculatePrice(new Decimal(24*c*g),y,h);a=CalculatePrice(new Decimal(24*c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:s=CalculatePrice(new Decimal(24*c*tt),w,h);l=CalculatePrice(new Decimal(24*c*g),y,h);a=CalculatePrice(new Decimal(24*c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;default:ShowMessage.Info("false",!0,"","")}}else switch(int.Parse(ot)){case 1000003:s=w;l=y;a=p;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:h=CalculateRebate(new Decimal(tt),w,b);s=CalculatePrice(new Decimal(tt),w,h);k=CalculateRebate(new Decimal(g),y,b);l=CalculatePrice(new Decimal(g),y,k);d=CalculateRebate(new Decimal(nt),p,b);a=CalculatePrice(new Decimal(nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:h=CalculateRebate(new Decimal(tt),w,b);s=CalculatePrice(new Decimal(tt),w,h);k=CalculateRebate(new Decimal(g),y,b);l=CalculatePrice(new Decimal(g),y,k);d=CalculateRebate(new Decimal(nt),p,b);a=CalculatePrice(new Decimal(nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:h=CalculateRebate(new Decimal(c),w,b);s=CalculatePrice(new Decimal(c),w,h);k=CalculateRebate(new Decimal(c),y,b);l=CalculatePrice(new Decimal(c),y,k);d=CalculateRebate(new Decimal(c),p,b);a=CalculatePrice(new Decimal(c),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:h=CalculateRebate(new Decimal(rt),w,b);s=CalculatePrice(new Decimal(rt),w,h);k=CalculateRebate(new Decimal(rt),y,b);l=CalculatePrice(new Decimal(rt),y,k);d=CalculateRebate(new Decimal(rt),p,b);a=CalculatePrice(new Decimal(rt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:h=CalculateRebate(new Decimal(it),w,b);s=CalculatePrice(new Decimal(it),w,h);k=CalculateRebate(new Decimal(it),y,b);l=CalculatePrice(new Decimal(it),y,k);d=CalculateRebate(new Decimal(it),p,b);a=CalculatePrice(new Decimal(it),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:h=CalculateRebate(new Decimal(c+1),w,b);s=CalculatePrice(new Decimal(c+1),w,h);k=CalculateRebate(new Decimal(c+1),y,b);l=CalculatePrice(new Decimal(c+1),y,k);d=CalculateRebate(new Decimal(c+1),p,b);a=CalculatePrice(new Decimal(c+1),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:h=CalculateRebate(new Decimal(24*c),w,b);s=CalculatePrice(new Decimal(24*c),w,h);k=CalculateRebate(new Decimal(24*c),y,b);l=CalculatePrice(new Decimal(24*c),y,k);d=CalculateRebate(new Decimal(24*c),p,b);a=CalculatePrice(new Decimal(24*c),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:h=CalculateRebate(new Decimal(et),w,b);s=CalculatePrice(new Decimal(et),w,h);k=CalculateRebate(new Decimal(et),y,b);l=CalculatePrice(new Decimal(et),y,k);d=CalculateRebate(new Decimal(et),p,b);a=CalculatePrice(new Decimal(et),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:h=CalculateRebate(new Decimal(ft),w,b);s=CalculatePrice(new Decimal(ft),w,h);k=CalculateRebate(new Decimal(ft),y,b);l=CalculatePrice(new Decimal(ft),y,k);d=CalculateRebate(new Decimal(ft),p,b);a=CalculatePrice(new Decimal(ft),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:h=CalculateRebate(new Decimal(c*tt),w,b);s=CalculatePrice(new Decimal(c*tt),w,h);k=CalculateRebate(new Decimal(c*g),y,b);l=CalculatePrice(new Decimal(c*g),y,k);d=CalculateRebate(new Decimal(c*nt),p,b);a=CalculatePrice(new Decimal(c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:h=CalculateRebate(new Decimal(c*tt),w,b);s=CalculatePrice(new Decimal(c*tt),w,h);k=CalculateRebate(new Decimal(c*g),y,b);l=CalculatePrice(new Decimal(c*g),y,k);d=CalculateRebate(new Decimal(c*nt),p,b);a=CalculatePrice(new Decimal(c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:h=CalculateRebate(new Decimal(tt*it),w,b);s=CalculatePrice(new Decimal(tt*it),w,h);k=CalculateRebate(new Decimal(g*it),y,b);l=CalculatePrice(new Decimal(g*it),y,k);d=CalculateRebate(new Decimal(nt*it),p,b);a=CalculatePrice(new Decimal(nt*it),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:h=CalculateRebate(new Decimal(tt*it),w,b);s=CalculatePrice(new Decimal(tt*it),w,h);k=CalculateRebate(new Decimal(g*it),y,b);l=CalculatePrice(new Decimal(g*it),y,k);d=CalculateRebate(new Decimal(nt*it),p,b);a=CalculatePrice(new Decimal(nt*it),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:h=CalculateRebate(new Decimal(tt*(c+1)),w,b);s=CalculatePrice(new Decimal(tt*(c+1)),w,h);k=CalculateRebate(new Decimal(g*(c+1)),y,b);l=CalculatePrice(new Decimal(g*(c+1)),y,k);d=CalculateRebate(new Decimal(nt*(c+1)),p,b);a=CalculatePrice(new Decimal(nt*(c+1)),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:h=CalculateRebate(new Decimal(tt*(c+1)),w,b);s=CalculatePrice(new Decimal((c+1)*tt),w,h);k=CalculateRebate(new Decimal(g*(c+1)),y,b);l=CalculatePrice(new Decimal(g*(c+1)),y,k);d=CalculateRebate(new Decimal(nt*(c+1)),p,b);a=CalculatePrice(new Decimal(nt*(c+1)),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:h=CalculateRebate(new Decimal(24*c*tt),w,b);s=CalculatePrice(new Decimal(24*c*tt),w,h);k=CalculateRebate(new Decimal(24*c*g),y,b);l=CalculatePrice(new Decimal(24*c*g),y,k);d=CalculateRebate(new Decimal(24*c*nt),p,b);a=CalculatePrice(new Decimal(24*c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:h=CalculateRebate(new Decimal(24*c*tt),w,b);s=CalculatePrice(new Decimal(24*c*tt),w,h);k=CalculateRebate(new Decimal(24*c*g),y,b);l=CalculatePrice(new Decimal(24*c*g),y,k);d=CalculateRebate(new Decimal(24*c*nt),p,b);a=CalculatePrice(new Decimal(24*c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;default:ShowMessage.Info("false",!0,"","")}tt==0&&(u.setValue("ATOTAL_AMOUNT",0),u.setValue("GRAND_TOTAL",0));g==0&&u.setValue("CG1TOTAL_AMOUNT",0);nt==0&&u.setValue("CG2TOTAL_AMOUNT",0)}}catch(kt){this.setCalloutActive(!1);this.log.severe(kt.toString())}return i=r=u=f=e=o=null,""};l.prototype.fromchkdate=function(i,r,u,f,e,o){var s,l,a,h,k,d,v,ht,at,lt,st;if(e==null||e.toString()==""||(ht=t.getValueOfDateTime(e),ht==null||ht.equals(0)))return"";var et=t.getValueOfDateTime(u.getValue("ADATEFROM")),ot=t.getValueOfDateTime(u.getValue("ADATETO")),g=t.getValueOfInt(u.getValue("CG1NUM")),nt=t.getValueOfInt(u.getValue("CG2NUM")),y=t.getValueOfDecimal(u.getValue("CG1PRICE")),p=t.getValueOfDecimal(u.getValue("CG2PRICE"));try{if(et=t.getValueOfDateTime(u.getValue("ADATEFROM")),et.compareTo(ot)>0)u.setValue("CG1DATEFROM",et),u.setValue("CG2DATEFROM",et),at=et.addDays(1),u.setValue("ADATETO",at);else if(ot.compareTo(et)>0){var ct=et.subtract(ot),c=Utility.TimeUtil.getDaysBetween(et,ot),kt=ct.Milliseconds,ut=ct.Seconds,ft=ct.Minutes,rt,it,vt=c/30,pt=c%30,yt=c/7,wt=c%7;rt=pt==0?vt:vt+1;it=wt==0?yt:yt+1;lt=t.getValueOfDateTime(u.getValue("ADATEFROM"));u.setValue("CG1DATETO",ot);u.setValue("CG2DATETO",ot);u.setValue("CG1DATEFROM",lt);u.setValue("CG2DATEFROM",lt);st=u.getValue("AUOM_ID").toString();(st==""||st.Trim().Length==0)&&(st="0");var w=t.getValueOfDecimal(u.getValue("APRICE")),tt=t.getValueOfInt(u.getValue("ANUM")),b=t.getValueOfDecimal(u.getValue("AREBATE"));if(t.getValueOfInt(b)==0){h=n.Env.ZERO;switch(int.Parse(st)){case 1000003:s=w;l=y;a=p;l=y;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:s=CalculatePrice(new Decimal(tt),w,h);l=CalculatePrice(new Decimal(g),y,h);a=CalculatePrice(new Decimal(nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:s=CalculatePrice(new Decimal(tt),w,h);l=CalculatePrice(new Decimal(g),y,h);a=CalculatePrice(new Decimal(nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:s=CalculatePrice(new Decimal(c),w,h);l=CalculatePrice(new Decimal(c),y,h);a=CalculatePrice(new Decimal(c),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:s=CalculatePrice(new Decimal(rt),w,h);l=CalculatePrice(new Decimal(rt),y,h);a=CalculatePrice(new Decimal(rt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:s=CalculatePrice(new Decimal(it),w,h);l=CalculatePrice(new Decimal(it),y,h);a=CalculatePrice(new Decimal(it),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:s=CalculatePrice(new Decimal(c+1),w,h);l=CalculatePrice(new Decimal(c+1),y,h);a=CalculatePrice(new Decimal(c+1),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:s=CalculatePrice(new Decimal(24*c),w,h);l=CalculatePrice(new Decimal(24*c),y,h);a=CalculatePrice(new Decimal(24*c),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:s=CalculatePrice(new Decimal(ft),w,h);l=CalculatePrice(new Decimal(ft),y,h);a=CalculatePrice(new Decimal(ft),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:s=CalculatePrice(new Decimal(ut),w,h);l=CalculatePrice(new Decimal(ut),y,h);a=CalculatePrice(new Decimal(ut),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:s=CalculatePrice(new Decimal(c*tt),w,h);l=CalculatePrice(new Decimal(c*g),y,h);a=CalculatePrice(new Decimal(c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:s=CalculatePrice(new Decimal(c*tt),w,h);l=CalculatePrice(new Decimal(c*g),y,h);a=CalculatePrice(new Decimal(c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:s=CalculatePrice(new Decimal(tt*it),w,h);l=CalculatePrice(new Decimal(g*it),y,h);a=CalculatePrice(new Decimal(nt*it),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:s=CalculatePrice(new Decimal(tt*it),w,h);l=CalculatePrice(new Decimal(g*it),y,h);a=CalculatePrice(new Decimal(nt*it),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:s=CalculatePrice(new Decimal(tt*(c+1)),w,h);l=CalculatePrice(new Decimal(g*(c+1)),y,h);a=CalculatePrice(new Decimal(nt*(c+1)),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:s=CalculatePrice(new Decimal((c+1)*tt),w,h);l=CalculatePrice(new Decimal((c+1)*g),y,h);a=CalculatePrice(new Decimal((c+1)*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:s=CalculatePrice(new Decimal(24*c*tt),w,h);l=CalculatePrice(new Decimal(24*c*g),y,h);a=CalculatePrice(new Decimal(24*c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:s=CalculatePrice(new Decimal(24*c*tt),w,h);l=CalculatePrice(new Decimal(24*c*g),y,h);a=CalculatePrice(new Decimal(24*c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;default:ShowMessage.Info("false",!0,"","")}}else switch(int.Parse(st)){case 1000003:s=w;l=y;a=p;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:h=CalculateRebate(new Decimal(tt),w,b);s=CalculatePrice(new Decimal(tt),w,h);k=CalculateRebate(new Decimal(g),y,b);l=CalculatePrice(new Decimal(g),y,k);d=CalculateRebate(new Decimal(nt),p,b);a=CalculatePrice(new Decimal(nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:h=CalculateRebate(new Decimal(tt),w,b);s=CalculatePrice(new Decimal(tt),w,h);k=CalculateRebate(new Decimal(g),y,b);l=CalculatePrice(new Decimal(g),y,k);d=CalculateRebate(new Decimal(nt),p,b);a=CalculatePrice(new Decimal(nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:h=CalculateRebate(new Decimal(c),w,b);s=CalculatePrice(new Decimal(c),w,h);k=CalculateRebate(new Decimal(c),y,b);l=CalculatePrice(new Decimal(c),y,k);d=CalculateRebate(new Decimal(c),p,b);a=CalculatePrice(new Decimal(c),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:h=CalculateRebate(new Decimal(rt),w,b);s=CalculatePrice(new Decimal(rt),w,h);k=CalculateRebate(new Decimal(rt),y,b);l=CalculatePrice(new Decimal(rt),y,k);d=CalculateRebate(new Decimal(rt),p,b);a=CalculatePrice(new Decimal(rt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:h=CalculateRebate(new Decimal(it),w,b);s=CalculatePrice(new Decimal(it),w,h);k=CalculateRebate(new Decimal(it),y,b);l=CalculatePrice(new Decimal(it),y,k);d=CalculateRebate(new Decimal(it),p,b);a=CalculatePrice(new Decimal(it),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:h=CalculateRebate(new Decimal(c+1),w,b);s=CalculatePrice(new Decimal(c+1),w,h);k=CalculateRebate(new Decimal(c+1),y,b);l=CalculatePrice(new Decimal(c+1),y,k);d=CalculateRebate(new Decimal(c+1),p,b);a=CalculatePrice(new Decimal(c+1),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:h=CalculateRebate(new Decimal(24*c),w,b);s=CalculatePrice(new Decimal(24*c),w,h);k=CalculateRebate(new Decimal(24*c),y,b);l=CalculatePrice(new Decimal(24*c),y,k);d=CalculateRebate(new Decimal(24*c),p,b);a=CalculatePrice(new Decimal(24*c),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:h=CalculateRebate(new Decimal(ft),w,b);s=CalculatePrice(new Decimal(ft),w,h);k=CalculateRebate(new Decimal(ft),y,b);l=CalculatePrice(new Decimal(ft),y,k);d=CalculateRebate(new Decimal(ft),p,b);a=CalculatePrice(new Decimal(ft),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:h=CalculateRebate(new Decimal(ut),w,b);s=CalculatePrice(new Decimal(ut),w,h);k=CalculateRebate(new Decimal(ut),y,b);l=CalculatePrice(new Decimal(ut),y,k);d=CalculateRebate(new Decimal(ut),p,b);a=CalculatePrice(new Decimal(ut),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:h=CalculateRebate(new Decimal(c*tt),w,b);s=CalculatePrice(new Decimal(c*tt),w,h);k=CalculateRebate(new Decimal(c*g),y,b);l=CalculatePrice(new Decimal(c*g),y,k);d=CalculateRebate(new Decimal(c*nt),p,b);a=CalculatePrice(new Decimal(c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:h=CalculateRebate(new Decimal(c*tt),w,b);s=CalculatePrice(new Decimal(c*tt),w,h);k=CalculateRebate(new Decimal(c*g),y,b);l=CalculatePrice(new Decimal(c*g),y,k);d=CalculateRebate(new Decimal(c*nt),p,b);a=CalculatePrice(new Decimal(c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:h=CalculateRebate(new Decimal(tt*it),w,b);s=CalculatePrice(new Decimal(tt*it),w,h);k=CalculateRebate(new Decimal(g*it),y,b);l=CalculatePrice(new Decimal(g*it),y,k);d=CalculateRebate(new Decimal(nt*it),p,b);a=CalculatePrice(new Decimal(nt*it),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:h=CalculateRebate(new Decimal(tt*it),w,b);s=CalculatePrice(new Decimal(tt*it),w,h);k=CalculateRebate(new Decimal(g*it),y,b);l=CalculatePrice(new Decimal(g*it),y,k);d=CalculateRebate(new Decimal(nt*it),p,b);a=CalculatePrice(new Decimal(nt*it),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:h=CalculateRebate(new Decimal(tt*(c+1)),w,b);s=CalculatePrice(new Decimal(tt*(c+1)),w,h);k=CalculateRebate(new Decimal(g*(c+1)),y,b);l=CalculatePrice(new Decimal(g*(c+1)),y,k);d=CalculateRebate(new Decimal(nt*(c+1)),p,b);a=CalculatePrice(new Decimal(nt*(c+1)),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:h=CalculateRebate(new Decimal(tt*(c+1)),w,b);s=CalculatePrice(new Decimal((c+1)*tt),w,h);k=CalculateRebate(new Decimal(g*(c+1)),y,b);l=CalculatePrice(new Decimal(g*(c+1)),y,k);d=CalculateRebate(new Decimal(nt*(c+1)),p,b);a=CalculatePrice(new Decimal(nt*(c+1)),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:h=CalculateRebate(new Decimal(24*c*tt),w,b);s=CalculatePrice(new Decimal(24*c*tt),w,h);k=CalculateRebate(new Decimal(24*c*g),y,b);l=CalculatePrice(new Decimal(24*c*g),y,k);d=CalculateRebate(new Decimal(24*c*nt),p,b);a=CalculatePrice(new Decimal(24*c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:h=CalculateRebate(new Decimal(24*c*tt),w,b);s=CalculatePrice(new Decimal(24*c*tt),w,h);k=CalculateRebate(new Decimal(24*c*g),y,b);l=CalculatePrice(new Decimal(24*c*g),y,k);d=CalculateRebate(new Decimal(24*c*nt),p,b);a=CalculatePrice(new Decimal(24*c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;default:ShowMessage.Info("false",!0,"","")}tt==0&&(u.setValue("ATOTAL_AMOUNT",0),u.setValue("GRAND_TOTAL",0));g==0&&u.setValue("CG1TOTAL_AMOUNT",0);nt==0&&u.setValue("CG2TOTAL_AMOUNT",0)}}catch(bt){this.setCalloutActive(!1);this.log.severe(bt.toString())}return i=r=u=f=e=o=null,""};l.prototype.UOMSelected=function(i,r,u,f,e,o){var s,l,a,h,k,d,v,et;if(e==null||e.toString()==""||(et=t.getValueOfInt(e),et=t.getValueOfInt(u.getValue("AUOM_ID")),et==null))return"";u.setValue("CG1UOM_ID",et);u.setValue("CG2UOM_ID",et);var ct=u.getValue("AUOM_ID").toString(),p=t.getValueOfDecimal(u.getValue("APRICE")),g=t.getValueOfInt(u.getValue("ANUM")),b=t.getValueOfDecimal(u.getValue("AREBATE")),nt=t.getValueOfInt(u.getValue("CG1NUM")),tt=t.getValueOfInt(u.getValue("CG2NUM")),y=t.getValueOfDecimal(u.getValue("CG1PRICE")),w=t.getValueOfDecimal(u.getValue("CG2PRICE")),ot=t.getValueOfDateTime(u.getValue("ADATETO")),st=t.getValueOfDateTime(u.getValue("ADATEFROM")),ht=st.compareTo(ot)>0?st.Subtract(ot):ot.Subtract(st);var c=Utility.timeUtil.getDaysBetween(st,ot),pt=ht.Milliseconds,ut=ht.Seconds,ft=ht.Minutes,rt,it,lt=c/30,vt=c%30,at=c/7,yt=c%7;if(rt=vt==0?lt:lt+1,it=yt==0?at:at+1,t.getValueOfInt(b)==0){h=n.Env.ZERO;switch(int.Parse(ct)){case 1000003:s=p;l=y;a=w;l=y;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:s=CalculatePrice(new Decimal(g),p,h);l=CalculatePrice(new Decimal(nt),y,h);a=CalculatePrice(new Decimal(tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:s=CalculatePrice(new Decimal(g),p,h);l=CalculatePrice(new Decimal(nt),y,h);a=CalculatePrice(new Decimal(tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:s=CalculatePrice(new Decimal(c),p,h);l=CalculatePrice(new Decimal(c),y,h);a=CalculatePrice(new Decimal(c),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:s=CalculatePrice(new Decimal(rt),p,h);l=CalculatePrice(new Decimal(rt),y,h);a=CalculatePrice(new Decimal(rt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:s=CalculatePrice(new Decimal(it),p,h);l=CalculatePrice(new Decimal(it),y,h);a=CalculatePrice(new Decimal(it),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:s=CalculatePrice(new Decimal(c+1),p,h);l=CalculatePrice(new Decimal(c+1),y,h);a=CalculatePrice(new Decimal(c+1),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:s=CalculatePrice(new Decimal(24*c),p,h);l=CalculatePrice(new Decimal(24*c),y,h);a=CalculatePrice(new Decimal(24*c),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:s=CalculatePrice(new Decimal(ft),p,h);l=CalculatePrice(new Decimal(ft),y,h);a=CalculatePrice(new Decimal(ft),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:s=CalculatePrice(new Decimal(ut),p,h);l=CalculatePrice(new Decimal(ut),y,h);a=CalculatePrice(new Decimal(ut),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:s=CalculatePrice(new Decimal(c*g),p,h);l=CalculatePrice(new Decimal(c*nt),y,h);a=CalculatePrice(new Decimal(c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:s=CalculatePrice(new Decimal(c*g),p,h);l=CalculatePrice(new Decimal(c*nt),y,h);a=CalculatePrice(new Decimal(c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:s=CalculatePrice(new Decimal(g*it),p,h);l=CalculatePrice(new Decimal(nt*it),y,h);a=CalculatePrice(new Decimal(tt*it),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:s=CalculatePrice(new Decimal(g*it),p,h);l=CalculatePrice(new Decimal(nt*it),y,h);a=CalculatePrice(new Decimal(tt*it),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:s=CalculatePrice(new Decimal(g*(c+1)),p,h);l=CalculatePrice(new Decimal(nt*(c+1)),y,h);a=CalculatePrice(new Decimal(tt*(c+1)),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:s=CalculatePrice(new Decimal((c+1)*g),p,h);l=CalculatePrice(new Decimal((c+1)*nt),y,h);a=CalculatePrice(new Decimal((c+1)*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:s=CalculatePrice(new Decimal(24*c*g),p,h);l=CalculatePrice(new Decimal(24*c*nt),y,h);a=CalculatePrice(new Decimal(24*c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:s=CalculatePrice(new Decimal(24*c*g),p,h);l=CalculatePrice(new Decimal(24*c*nt),y,h);a=CalculatePrice(new Decimal(24*c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;default:ShowMessage.Info("false",!0,"","")}}else switch(int.Parse(ct)){case 1000003:s=p;l=y;a=w;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:h=CalculateRebate(new Decimal(g),p,b);s=CalculatePrice(new Decimal(g),p,h);k=CalculateRebate(new Decimal(nt),y,b);l=CalculatePrice(new Decimal(nt),y,k);d=CalculateRebate(new Decimal(tt),w,b);a=CalculatePrice(new Decimal(tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:h=CalculateRebate(new Decimal(g),p,b);s=CalculatePrice(new Decimal(g),p,h);k=CalculateRebate(new Decimal(nt),y,b);l=CalculatePrice(new Decimal(nt),y,k);d=CalculateRebate(new Decimal(tt),w,b);a=CalculatePrice(new Decimal(tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:h=CalculateRebate(new Decimal(c),p,b);s=CalculatePrice(new Decimal(c),p,h);k=CalculateRebate(new Decimal(c),y,b);l=CalculatePrice(new Decimal(c),y,k);d=CalculateRebate(new Decimal(c),w,b);a=CalculatePrice(new Decimal(c),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:h=CalculateRebate(new Decimal(rt),p,b);s=CalculatePrice(new Decimal(rt),p,h);k=CalculateRebate(new Decimal(rt),y,b);l=CalculatePrice(new Decimal(rt),y,k);d=CalculateRebate(new Decimal(rt),w,b);a=CalculatePrice(new Decimal(rt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:h=CalculateRebate(new Decimal(it),p,b);s=CalculatePrice(new Decimal(it),p,h);k=CalculateRebate(new Decimal(it),y,b);l=CalculatePrice(new Decimal(it),y,k);d=CalculateRebate(new Decimal(it),w,b);a=CalculatePrice(new Decimal(it),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:h=CalculateRebate(new Decimal(c+1),p,b);s=CalculatePrice(new Decimal(c+1),p,h);k=CalculateRebate(new Decimal(c+1),y,b);l=CalculatePrice(new Decimal(c+1),y,k);d=CalculateRebate(new Decimal(c+1),w,b);a=CalculatePrice(new Decimal(c+1),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:h=CalculateRebate(new Decimal(24*c),p,b);s=CalculatePrice(new Decimal(24*c),p,h);k=CalculateRebate(new Decimal(24*c),y,b);l=CalculatePrice(new Decimal(24*c),y,k);d=CalculateRebate(new Decimal(24*c),w,b);a=CalculatePrice(new Decimal(24*c),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:h=CalculateRebate(new Decimal(ft),p,b);s=CalculatePrice(new Decimal(ft),p,h);k=CalculateRebate(new Decimal(ft),y,b);l=CalculatePrice(new Decimal(ft),y,k);d=CalculateRebate(new Decimal(ft),w,b);a=CalculatePrice(new Decimal(ft),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:h=CalculateRebate(new Decimal(ut),p,b);s=CalculatePrice(new Decimal(ut),p,h);k=CalculateRebate(new Decimal(ut),y,b);l=CalculatePrice(new Decimal(ut),y,k);d=CalculateRebate(new Decimal(ut),w,b);a=CalculatePrice(new Decimal(ut),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:h=CalculateRebate(new Decimal(c*g),p,b);s=CalculatePrice(new Decimal(c*g),p,h);k=CalculateRebate(new Decimal(c*nt),y,b);l=CalculatePrice(new Decimal(c*nt),y,k);d=CalculateRebate(new Decimal(c*tt),w,b);a=CalculatePrice(new Decimal(c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:h=CalculateRebate(new Decimal(c*g),p,b);s=CalculatePrice(new Decimal(c*g),p,h);k=CalculateRebate(new Decimal(c*nt),y,b);l=CalculatePrice(new Decimal(c*nt),y,k);d=CalculateRebate(new Decimal(c*tt),w,b);a=CalculatePrice(new Decimal(c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:h=CalculateRebate(new Decimal(g*it),p,b);s=CalculatePrice(new Decimal(g*it),p,h);k=CalculateRebate(new Decimal(nt*it),y,b);l=CalculatePrice(new Decimal(nt*it),y,k);d=CalculateRebate(new Decimal(tt*it),w,b);a=CalculatePrice(new Decimal(tt*it),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:h=CalculateRebate(new Decimal(g*it),p,b);s=CalculatePrice(new Decimal(g*it),p,h);k=CalculateRebate(new Decimal(nt*it),y,b);l=CalculatePrice(new Decimal(nt*it),y,k);d=CalculateRebate(new Decimal(tt*it),w,b);a=CalculatePrice(new Decimal(tt*it),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:h=CalculateRebate(new Decimal(g*(c+1)),p,b);s=CalculatePrice(new Decimal(g*(c+1)),p,h);k=CalculateRebate(new Decimal(nt*(c+1)),y,b);l=CalculatePrice(new Decimal(nt*(c+1)),y,k);d=CalculateRebate(new Decimal(tt*(c+1)),w,b);a=CalculatePrice(new Decimal(tt*(c+1)),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:h=CalculateRebate(new Decimal(g*(c+1)),p,b);s=CalculatePrice(new Decimal((c+1)*g),p,h);k=CalculateRebate(new Decimal(nt*(c+1)),y,b);l=CalculatePrice(new Decimal(nt*(c+1)),y,k);d=CalculateRebate(new Decimal(tt*(c+1)),w,b);a=CalculatePrice(new Decimal(tt*(c+1)),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:h=CalculateRebate(new Decimal(24*c*g),p,b);s=CalculatePrice(new Decimal(24*c*g),p,h);k=CalculateRebate(new Decimal(24*c*nt),y,b);l=CalculatePrice(new Decimal(24*c*nt),y,k);d=CalculateRebate(new Decimal(24*c*tt),w,b);a=CalculatePrice(new Decimal(24*c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:h=CalculateRebate(new Decimal(24*c*g),p,b);s=CalculatePrice(new Decimal(24*c*g),p,h);k=CalculateRebate(new Decimal(24*c*nt),y,b);l=CalculatePrice(new Decimal(24*c*nt),y,k);d=CalculateRebate(new Decimal(24*c*tt),w,b);a=CalculatePrice(new Decimal(24*c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;default:ShowMessage.Info("false",!0,"","")}return g==0&&(u.setValue("ATOTAL_AMOUNT",0),u.setValue("GRAND_TOTAL",0)),nt==0&&u.setValue("CG1TOTAL_AMOUNT",0),tt==0&&u.setValue("CG2TOTAL_AMOUNT",0),i=r=u=f=e=o=null,""};l.prototype.AVALSelected=function(i,r,u,f,e,o){var s,l,a,h,k,d,v,et;if(e==null||e.toString()=="")return"";et=null;try{et=u.getValue("AUOM_ID").toString()}catch(yt){return this.setCalloutActive(!1),""}var p=t.getValueOfDecimal(u.getValue("APRICE")),b=t.getValueOfDecimal(u.getValue("AREBATE")),g=t.getValueOfInt(u.getValue("ANUM")),st=t.getValueOfDateTime(u.getValue("ADATETO")),nt=t.getValueOfInt(u.getValue("CG1NUM")),tt=t.getValueOfInt(u.getValue("CG2NUM")),y=t.getValueOfDecimal(u.getValue("CG1PRICE")),w=t.getValueOfDecimal(u.getValue("CG2PRICE")),ht=t.getValueOfDateTime(u.getValue("ADATEFROM")),ot=ht.Subtract(st),c=Utility.TimeUtil.getDaysBetween(ht,st),pt=ot.Milliseconds,ut=ot.Seconds,ft=ot.Minutes,rt,it,ct=c/30,at=c%30,lt=c/7,vt=c%7;if(rt=at==0?ct:ct+1,it=vt==0?lt:lt+1,t.getValueOfInt(b)==0){h=n.Env.ZERO;switch(int.Parse(et)){case 1000003:s=p;l=y;a=w;l=y;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:s=CalculatePrice(new Decimal(g),p,h);l=CalculatePrice(new Decimal(nt),y,h);a=CalculatePrice(new Decimal(tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:s=CalculatePrice(new Decimal(g),p,h);l=CalculatePrice(new Decimal(nt),y,h);a=CalculatePrice(new Decimal(tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:s=CalculatePrice(new Decimal(c),p,h);l=CalculatePrice(new Decimal(c),y,h);a=CalculatePrice(new Decimal(c),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:s=CalculatePrice(new Decimal(rt),p,h);l=CalculatePrice(new Decimal(rt),y,h);a=CalculatePrice(new Decimal(rt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:s=CalculatePrice(new Decimal(it),p,h);l=CalculatePrice(new Decimal(it),y,h);a=CalculatePrice(new Decimal(it),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:s=CalculatePrice(new Decimal(c+1),p,h);l=CalculatePrice(new Decimal(c+1),y,h);a=CalculatePrice(new Decimal(c+1),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:s=CalculatePrice(new Decimal(24*c),p,h);l=CalculatePrice(new Decimal(24*c),y,h);a=CalculatePrice(new Decimal(24*c),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:s=CalculatePrice(new Decimal(ft),p,h);l=CalculatePrice(new Decimal(ft),y,h);a=CalculatePrice(new Decimal(ft),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:s=CalculatePrice(new Decimal(ut),p,h);l=CalculatePrice(new Decimal(ut),y,h);a=CalculatePrice(new Decimal(ut),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:s=CalculatePrice(new Decimal(c*g),p,h);l=CalculatePrice(new Decimal(c*nt),y,h);a=CalculatePrice(new Decimal(c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:s=CalculatePrice(new Decimal(c*g),p,h);l=CalculatePrice(new Decimal(c*nt),y,h);a=CalculatePrice(new Decimal(c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:s=CalculatePrice(new Decimal(g*it),p,h);l=CalculatePrice(new Decimal(nt*it),y,h);a=CalculatePrice(new Decimal(tt*it),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:s=CalculatePrice(new Decimal(g*it),p,h);l=CalculatePrice(new Decimal(nt*it),y,h);a=CalculatePrice(new Decimal(tt*it),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:s=CalculatePrice(new Decimal(g*(c+1)),p,h);l=CalculatePrice(new Decimal(nt*(c+1)),y,h);a=CalculatePrice(new Decimal(tt*(c+1)),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:s=CalculatePrice(new Decimal((c+1)*g),p,h);l=CalculatePrice(new Decimal((c+1)*nt),y,h);a=CalculatePrice(new Decimal((c+1)*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:s=CalculatePrice(new Decimal(24*c*g),p,h);l=CalculatePrice(new Decimal(24*c*nt),y,h);a=CalculatePrice(new Decimal(24*c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:s=CalculatePrice(new Decimal(24*c*g),p,h);l=CalculatePrice(new Decimal(24*c*nt),y,h);a=CalculatePrice(new Decimal(24*c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;default:ShowMessage.Info("false",!0,"","")}}else switch(int.Parse(et)){case 1000003:s=p;l=y;a=w;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:h=CalculateRebate(new Decimal(g),p,b);s=CalculatePrice(new Decimal(g),p,h);k=CalculateRebate(new Decimal(nt),y,b);l=CalculatePrice(new Decimal(nt),y,k);d=CalculateRebate(new Decimal(tt),w,b);a=CalculatePrice(new Decimal(tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:h=CalculateRebate(new Decimal(g),p,b);s=CalculatePrice(new Decimal(g),p,h);k=CalculateRebate(new Decimal(nt),y,b);l=CalculatePrice(new Decimal(nt),y,k);d=CalculateRebate(new Decimal(tt),w,b);a=CalculatePrice(new Decimal(tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:h=CalculateRebate(new Decimal(c),p,b);s=CalculatePrice(new Decimal(c),p,h);k=CalculateRebate(new Decimal(c),y,b);l=CalculatePrice(new Decimal(c),y,k);d=CalculateRebate(new Decimal(c),w,b);a=CalculatePrice(new Decimal(c),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:h=CalculateRebate(new Decimal(rt),p,b);s=CalculatePrice(new Decimal(rt),p,h);k=CalculateRebate(new Decimal(rt),y,b);l=CalculatePrice(new Decimal(rt),y,k);d=CalculateRebate(new Decimal(rt),w,b);a=CalculatePrice(new Decimal(rt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:h=CalculateRebate(new Decimal(it),p,b);s=CalculatePrice(new Decimal(it),p,h);k=CalculateRebate(new Decimal(it),y,b);l=CalculatePrice(new Decimal(it),y,k);d=CalculateRebate(new Decimal(it),w,b);a=CalculatePrice(new Decimal(it),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:h=CalculateRebate(new Decimal(c+1),p,b);s=CalculatePrice(new Decimal(c+1),p,h);k=CalculateRebate(new Decimal(c+1),y,b);l=CalculatePrice(new Decimal(c+1),y,k);d=CalculateRebate(new Decimal(c+1),w,b);a=CalculatePrice(new Decimal(c+1),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:h=CalculateRebate(new Decimal(24*c),p,b);s=CalculatePrice(new Decimal(24*c),p,h);k=CalculateRebate(new Decimal(24*c),y,b);l=CalculatePrice(new Decimal(24*c),y,k);d=CalculateRebate(new Decimal(24*c),w,b);a=CalculatePrice(new Decimal(24*c),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:h=CalculateRebate(new Decimal(ft),p,b);s=CalculatePrice(new Decimal(ft),p,h);k=CalculateRebate(new Decimal(ft),y,b);l=CalculatePrice(new Decimal(ft),y,k);d=CalculateRebate(new Decimal(ft),w,b);a=CalculatePrice(new Decimal(ft),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:h=CalculateRebate(new Decimal(ut),p,b);s=CalculatePrice(new Decimal(ut),p,h);k=CalculateRebate(new Decimal(ut),y,b);l=CalculatePrice(new Decimal(ut),y,k);d=CalculateRebate(new Decimal(ut),w,b);a=CalculatePrice(new Decimal(ut),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:h=CalculateRebate(new Decimal(c*g),p,b);s=CalculatePrice(new Decimal(c*g),p,h);k=CalculateRebate(new Decimal(c*nt),y,b);l=CalculatePrice(new Decimal(c*nt),y,k);d=CalculateRebate(new Decimal(c*tt),w,b);a=CalculatePrice(new Decimal(c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:h=CalculateRebate(new Decimal(c*g),p,b);s=CalculatePrice(new Decimal(c*g),p,h);k=CalculateRebate(new Decimal(c*nt),y,b);l=CalculatePrice(new Decimal(c*nt),y,k);d=CalculateRebate(new Decimal(c*tt),w,b);a=CalculatePrice(new Decimal(c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:h=CalculateRebate(new Decimal(g*it),p,b);s=CalculatePrice(new Decimal(g*it),p,h);k=CalculateRebate(new Decimal(nt*it),y,b);l=CalculatePrice(new Decimal(nt*it),y,k);d=CalculateRebate(new Decimal(tt*it),w,b);a=CalculatePrice(new Decimal(tt*it),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:h=CalculateRebate(new Decimal(g*it),p,b);s=CalculatePrice(new Decimal(g*it),p,h);k=CalculateRebate(new Decimal(nt*it),y,b);l=CalculatePrice(new Decimal(nt*it),y,k);d=CalculateRebate(new Decimal(tt*it),w,b);a=CalculatePrice(new Decimal(tt*it),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:h=CalculateRebate(new Decimal(g*(c+1)),p,b);s=CalculatePrice(new Decimal(g*(c+1)),p,h);k=CalculateRebate(new Decimal(nt*(c+1)),y,b);l=CalculatePrice(new Decimal(nt*(c+1)),y,k);d=CalculateRebate(new Decimal(tt*(c+1)),w,b);a=CalculatePrice(new Decimal(tt*(c+1)),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:h=CalculateRebate(new Decimal(g*(c+1)),p,b);s=CalculatePrice(new Decimal((c+1)*g),p,h);k=CalculateRebate(new Decimal(nt*(c+1)),y,b);l=CalculatePrice(new Decimal(nt*(c+1)),y,k);d=CalculateRebate(new Decimal(tt*(c+1)),w,b);a=CalculatePrice(new Decimal(tt*(c+1)),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:h=CalculateRebate(new Decimal(24*c*g),p,b);s=CalculatePrice(new Decimal(24*c*g),p,h);k=CalculateRebate(new Decimal(24*c*nt),y,b);l=CalculatePrice(new Decimal(24*c*nt),y,k);d=CalculateRebate(new Decimal(24*c*tt),w,b);a=CalculatePrice(new Decimal(24*c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:h=CalculateRebate(new Decimal(24*c*g),p,b);s=CalculatePrice(new Decimal(24*c*g),p,h);k=CalculateRebate(new Decimal(24*c*nt),y,b);l=CalculatePrice(new Decimal(24*c*nt),y,k);d=CalculateRebate(new Decimal(24*c*tt),w,b);a=CalculatePrice(new Decimal(24*c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;default:ShowMessage.Info("false",!0,"","")}return g==0&&(u.setValue("ATOTAL_AMOUNT",0),u.setValue("GRAND_TOTAL",0)),nt==0&&u.setValue("CG1TOTAL_AMOUNT",0),tt==0&&u.setValue("CG2TOTAL_AMOUNT",0),i=r=u=f=e=o=null,""};n.Model.CalloutOfferServices=l;g.prototype.TypeSelection=function(n,i,r,u,f,e){if(f==null||f.toString()=="")return"";var o=t.getValueOfBoolean(f);return o==null?"":(o==!0?r.setValue("flag1",!0):r.setValue("flag1",!1),n=i=r=u=f=e=null,"")};g.prototype.RecordSort=function(n,i,r,u,f,e){if(f==null||f.toString()=="")return"";var o=t.getValueOfBoolean(f);return o==null?"":(o==!0?r.setValue("flag2",!0):r.setValue("flag2",!1),n=i=r=u=f=e=null,"")};g.prototype.EndDate=function(i,r,u,f,e,o){var s,h,c;if(e==null||e.toString()==""||(s=t.getValueOfDateTime(e),s==null||s.equals(0)))return"";h=t.getValueOfDateTime(e);c=t.getValueOfDateTime(u.getValue("DATE_FROM"));try{h=t.getValueOfDateTime(u.getValue("TILL_DATE"));h.compareTo(c)<0&&(n.ADialog.info("EndAndStartDate"),u.setValue("TILL_DATE",c))}catch(l){this.setCalloutActive(!1)}return i=r=u=f=e=o=null,""};g.prototype.StartDate=function(n,i,r,u,f,e){var s,o,h;if(f==null||f.toString()==""||(s=t.getValueOfDateTime(f),s==null||s.equals(0)))return"";o=t.getValueOfDateTime(r.getValue("DATE_FROM"));h=t.getValueOfDateTime(r.getValue("TILL_DATE"));try{o=t.getValueOfDateTime(r.getValue("DATE_FROM"));o.compareTo(h)>0&&r.setValue("TILL_DATE",o)}catch(c){this.setCalloutActive(!1)}return n=i=r=u=f=e=null,""};n.Model.CalloutCheckInOut=g;n.Utility.inheritPrototype(b,n.CalloutEngine);b.prototype.Product=function(i,r,u,f,e,o){var a,v,y,tt,p,s,d,c,g,l,nt;if(this.isCalloutActive())return"";a=0;v=i.getContext(r,"AttrCode");v!=null&&v!=""&&(y="SELECT M_AttributeSet_ID FROM M_Product WHERE M_Product_ID = "+t.getValueOfInt(e),tt=t.getValueOfInt(n.DB.executeScalar(y)),tt>0&&(y="SELECT M_AttributeSetInstance_ID FROM M_ProductAttributes WHERE UPC = '"+v+"' AND M_Product_ID = "+t.getValueOfInt(e),a=t.getValueOfInt(n.DB.executeScalar(y))));var w=t.getValueOfInt(u.getValue("M_InventoryLine_ID")),ot=t.getValueOfInt(u.getValue("M_Inventory_ID")),b=null,st=ot.toString();b=n.dataContext.getJSONRecord("MInventory/GetMInventory",st);var it=b.MovementDate,rt=b.AD_Org_ID,h=null,ht=w.toString();if(w!=null&&w!=0){p=null;p=n.dataContext.getJSONRecord("MInventoryLine/GetMInventoryLine",ht);var s=p.M_Product_ID,c=p.M_Locator_ID,k=t.getValueOfInt(u.getValue("M_Product_ID")),ut=t.getValueOfInt(u.getValue("M_Locator_ID")),ft=0;if(k!=s||ut!=c){this.setCalloutActive(!0);a>0&&u.setValue("M_AttributeSetInstance_ID",a);k==s?ft=t.getValueOfInt(u.getValue("M_AttributeSetInstance_ID")):u.setValue("M_AttributeSetInstance_ID",null);try{h=this.SetQtyBook(rt,ft,k,ut,t.getValueOfDate(it));u.setValue("QtyBook",h)}catch(et){return this.setCalloutActive(!1),this.log.severe(et.toString()),u.setValue("QtyBook",h)}}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""}if((s=0,d=t.getValueOfInt(u.getValue("M_Product_ID")),d!=null&&(s=d),s==0)||(c=0,g=t.getValueOfInt(u.getValue("M_Locator_ID")),g!=null&&(c=g),c==0))return"";this.setCalloutActive(!0);a>0&&u.setValue("M_AttributeSetInstance_ID",a);l=0;nt=t.getValueOfInt(u.getValue("M_AttributeSetInstance_ID"));nt!=null&&(l=nt);i.getContextAsInt(r,"M_Product_ID",!1)==s&&(l=i.getContextAsInt(r,"M_AttributeSetInstance_ID",!1),l!=0?u.setValue("M_AttributeSetInstance_ID",l):u.setValue("M_AttributeSetInstance_ID",null));try{h=this.SetQtyBook(rt,l,s,c,t.getValueOfDate(it));u.setValue("QtyBook",h)}catch(et){return this.setCalloutActive(!1),this.log.severe(et.toString()),u.setValue("QtyBook",h)}return this.log.info("M_Product_ID="+s+", M_Locator_ID="+c+", M_AttributeSetInstance_ID="+l+" - QtyBook="+h),this.setCalloutActive(!1),i=r=u=f=e=o=null,""};b.prototype.AttributeSetInstance=function(i,r,u,f,e,o){var s,v,l,y;if(this.isCalloutActive())return"";var nt=t.getValueOfInt(u.getValue("M_InventoryLine_ID")),w=t.getValueOfInt(u.getValue("M_Inventory_ID")),a=null,b=w.toString();a=n.dataContext.getJSONRecord("MInventory/GetMInventory",b);var k=a.MovementDate,d=a.AD_Org_ID,h=null,c=0,p=t.getValueOfInt(u.getValue("M_Product_ID"));if((p!=null&&(c=p),c==0)||(s=0,v=t.getValueOfInt(u.getValue("M_Locator_ID")),v!=null&&(s=v),s==0))return"";this.setCalloutActive(!0);l=0;y=t.getValueOfInt(u.getValue("M_AttributeSetInstance_ID"));y!=null&&(l=y);try{h=this.SetQtyBook(d,l,c,s,t.getValueOfDate(k));u.setValue("QtyBook",h)}catch(g){return this.setCalloutActive(!1),this.log.severe(g.toString()),u.setValue("QtyBook",h)}return this.log.info("M_Product_ID="+c+", M_Locator_ID="+s+", M_AttributeSetInstance_ID="+l+" - QtyBook="+h),this.setCalloutActive(!1),i=r=u=f=e=o=null,""};b.prototype.SetDiff=function(n,i,r,u,f,e){if(f==null||f.toString()=="")return"";var o=0,s=0,h=0;this.setCalloutActive(!0);try{u.getColumnName().equals("DifferenceQty")?(s=t.getValueOfDecimal(r.getValue("OpeningStock")),h=t.getValueOfDecimal(r.getValue("DifferenceQty")),o=s-h,r.setValue("AsOnDateCount",o)):u.getColumnName().equals("AsOnDateCount")&&(s=t.getValueOfDecimal(r.getValue("OpeningStock")),o=t.getValueOfDecimal(r.getValue("AsOnDateCount")),h=s-o,r.setValue("DifferenceQty",h))}catch(c){return this.setCalloutActive(!1),this.log.severe(c.toString()),c.message}return this.setCalloutActive(!1),n=i=r=u=f=e=null,""};b.prototype.SetQtyBook=function(i,r,u,f,e){var o=null,s="",h="",c=0,l="TO_DATE( '"+(Number(e.getMonth())+1)+"-"+e.getDate()+"-"+e.getFullYear()+"', 'MM-DD-YYYY')";return(s="SELECT COUNT(*) FROM M_Transaction WHERE movementdate = "+l+" AND  M_Product_ID = "+u+" AND M_Locator_ID = "+f+" AND M_AttributeSetInstance_ID = "+r,c=t.getValueOfInt(n.DB.executeScalar(s)),c>0?(h="SELECT currentqty FROM M_Transaction WHERE M_Transaction_ID = (SELECT MAX(M_Transaction_ID)   FROM M_Transaction  WHERE movementdate = (SELECT MAX(movementdate) FROM M_Transaction WHERE movementdate <= "+l+"  AND  M_Product_ID = "+u+" AND M_Locator_ID = "+f+" AND M_AttributeSetInstance_ID = "+r+") AND  M_Product_ID = "+u+" AND M_Locator_ID = "+f+" AND M_AttributeSetInstance_ID = "+r+") AND AD_Org_ID = "+i+" AND  M_Product_ID = "+u+" AND M_Locator_ID = "+f+" AND M_AttributeSetInstance_ID = "+r,o=t.getValueOfDecimal(n.DB.executeScalar(h))):(s="SELECT COUNT(*) FROM M_Transaction WHERE movementdate < "+l+" AND  M_Product_ID = "+u+" AND M_Locator_ID = "+f+" AND M_AttributeSetInstance_ID = "+r,c=t.getValueOfInt(n.DB.executeScalar(s)),c>0&&(h="SELECT currentqty FROM M_Transaction WHERE M_Transaction_ID = (SELECT MAX(M_Transaction_ID)   FROM M_Transaction  WHERE movementdate =  (SELECT MAX(movementdate) FROM M_Transaction WHERE movementdate < "+l+" AND  M_Product_ID = "+u+" AND M_Locator_ID = "+f+" AND M_AttributeSetInstance_ID = "+r+") AND  M_Product_ID = "+u+" AND M_Locator_ID = "+f+" AND M_AttributeSetInstance_ID = "+r+") AND AD_Org_ID = "+i+" AND  M_Product_ID = "+u+" AND M_Locator_ID = "+f+" AND M_AttributeSetInstance_ID = "+r,o=t.getValueOfDecimal(n.DB.executeScalar(h)))),o!=null)?o:0};n.Model.CalloutInventory=b;n.Utility.inheritPrototype(f,n.CalloutEngine);f.prototype.DocType=function(r,u,f,e,o,s){var c,a,h,l;if(o==null||o.toString()==""||(c=o,c==null||c==0))return"";a="SELECT d.HasCharges,'N',d.IsDocNoControlled,s.CurrentNext, d.DocBaseType FROM C_DocType d LEFT OUTER JOIN AD_Sequence s ON (d.DocNoSequence_ID=s.AD_Sequence_ID) WHERE C_DocType_ID="+c;h=null;try{h=n.DB.executeReader(a,null,null);h.read()&&(r.setContext(u,"HasCharges",h.get("hascharges")),h.get("isdocnocontrolled")=="Y"&&f.setValue("DocumentNo","<"+h.get("currentnext")+">"),l=t.getValueOfString(h.get("docbasetype")),r.setContext(u,"DocBaseType",l),l.startsWith("AP")?f.setValue("PaymentRule","S"):l.endsWith("C")&&f.setValue("PaymentRule","P"));h.close()}catch(v){return this.setCalloutActive(!1),h!=null&&h.close(),this.log.log(i.SEVERE,a,v),v.message}return r=u=f=e=o=s=null,""};f.prototype.BPartner=function(r,u,f,e,o,s){var l,w,a,c,v,tt,h,y,b,p,k,d,g,nt,rt,ut;if(o==null||o.toString()=="")return"";try{if(l=t.getValueOfInt(o),l==null||l==0)return"";w="SELECT p.AD_Language,p.C_PaymentTerm_ID, COALESCE(p.M_PriceList_ID,g.M_PriceList_ID) AS M_PriceList_ID, p.PaymentRule,p.POReference, p.SO_Description,p.IsDiscountPrinted,";y=t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='VA009_'  AND IsActive = 'Y'"));y>0&&(w+=" p.VA009_PaymentMethod_ID, ");w+=" p.SO_CreditLimit, p.SO_CreditLimit-p.SO_CreditUsed AS CreditAvailable, l.C_BPartner_Location_ID,c.AD_User_ID, COALESCE(p.PO_PriceList_ID,g.PO_PriceList_ID) AS PO_PriceList_ID, p.PaymentRulePO,p.PO_PaymentTerm_ID FROM C_BPartner p INNER JOIN C_BP_Group g ON (p.C_BP_Group_ID=g.C_BP_Group_ID) LEFT OUTER JOIN C_BPartner_Location l ON (p.C_BPartner_ID=l.C_BPartner_ID AND l.IsBillTo='Y' AND l.IsActive='Y') LEFT OUTER JOIN AD_User c ON (p.C_BPartner_ID=c.C_BPartner_ID) WHERE p.C_BPartner_ID="+l+" AND p.IsActive='Y'";a=r.isSOTrx();c=null;try{c=n.DB.executeReader(w,null,null);c.read()&&(v=t.getValueOfInt(c.get(a?"m_pricelist_id":"po_pricelist_id")),v>0?f.setValue("M_PriceList_ID",v):(tt=r.getContextAsInt("#M_PriceList_ID"),tt!=0&&f.setValue("M_PriceList_ID",tt)),h=t.getValueOfString(c.get(a?"paymentrule":"paymentrulepo")),h!=null&&h.length!=0&&(r.getContext("DocBaseType").toString().endsWith("C")?h="P":a&&(h.toString().equals("S")||h.toString().equals("U"))&&(h="P"),f.setValue("PaymentRule",h)),y=t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='VA009_'  AND IsActive = 'Y'")),y>0&&(b=t.getValueOfInt(c.get("VA009_PaymentMethod_ID")),b==0?f.setValue("VA009_PaymentMethod_ID",null):(f.setValue("VA009_PaymentMethod_ID",b),p=n.DB.executeScalar("SELECT VA009_PaymentBaseType FROM VA009_PaymentMethod WHERE VA009_PaymentMethod_ID="+b),p!="W"&&p!=null?(f.setValue("PaymentMethod",p),f.setValue("PaymentRule",p)):(f.setValue("PaymentMethod","T"),f.setValue("PaymentRule","T")))),v=t.getValueOfInt(c.get(a?"c_paymentterm_id":"po_paymentterm_id")),v>0&&f.setValue("C_PaymentTerm_ID",v),k=t.getValueOfInt(c.get("c_bpartner_location_id")),l.toString().equals(r.getContext("C_BPartner_ID"))&&(d=r.getContext("C_BPartner_Location_ID"),d&&d.toString().length>0&&(k=parseInt(d))),k==0?f.setValue("C_BPartner_Location_ID",null):f.setValue("C_BPartner_Location_ID",k),g=t.getValueOfInt(c.get("ad_user_id")),l.toString().equals(r.getContext("C_BPartner_ID"))&&(nt=r.getContext("AD_User_ID"),nt&&nt.toString().length>0&&(g=parseInt(nt))),g==0?f.setValue("AD_User_ID",null):f.setValue("AD_User_ID",g),a&&(rt=t.getValueOfDouble(c.get("so_creditlimit")),rt!=0&&(ut=t.getValueOfDouble(c.get("creditavailable")),ut<0&&n.ADialog.info("CreditLimitOver"))),h=t.getValueOfString(c.get("poreference")),h!=null&&h.length!=0?f.setValue("POReference",h):f.setValue("POReference",null),h=t.getValueOfString(c.get("so_description")),h!=null&&h.toString().trim().length!=0&&f.setValue("Description",h),h=t.getValueOfString(c.get("isdiscountprinted")),h!=null&&h.toString().trim().length!=0?f.setValue("IsDiscountPrinted",h):f.setValue("IsDiscountPrinted","N"));c.close()}catch(it){return this.setCalloutActive(!1),c!=null&&c.close(),this.log.log(i.SEVERE,"bPartner",it),it.message}finally{c!=null&&c.close()}}catch(it){this.setCalloutActive(!1);this.log.severe(it.toString())}return this.setCalloutActive(!1),r=u=f=e=o=s=null,""};f.prototype.PaymentTerm=function(t,i,r,u,f,e){var o,s,c,l,h,a;if(f==null||f.toString()=="")return"";try{if(o=f,s=t.getContextAsInt(i,"C_Invoice_ID",!1),o==null||o==0||s==0)return"";if(l=o.toString().concat(",",s.toString()),h=n.dataContext.getJSONRecord("MPaymentTerm/GetPaymentTerm",l),c=h.get("Get_ID"),a=h.get("Apply"),c==0)return"PaymentTerm not found";r.setValue("IsPayScheduleValid",a?"Y":"N")}catch(v){this.setCalloutActive(!1);this.log.severe(v.toString())}return t=i=r=u=f=e=null,""};f.prototype.Product=function(i,u,f,e,o,s){var l,w,k,c,ht,y,tt,ut,p,h;if(this.isCalloutActive()||o==null||o.toString()==""||(l=o,l==null||l==0))return"";this.setCalloutActive(!0);try{f.setValue("C_Charge_ID",null);i.getContextAsInt(u,"M_Product_ID",!1)==l&&i.getContextAsInt(u,"M_AttributeSetInstance_ID",!1)!=0?f.setValue("M_AttributeSetInstance_ID",i.getContextAsInt(u,"M_AttributeSetInstance_ID",!1)):f.setValue("M_AttributeSetInstance_ID",null);w=i.getWindowContext(u,"IsSOTrx",!0)=="Y";sql="SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='ED011_'";r=t.getValueOfInt(n.DB.executeScalar(sql));k=n.dataContext.getJSONRecord("MInvoice/GetInvoice",f.getValue("C_Invoice_ID").toString());c=0;r>0&&(sql="SELECT C_UOM_ID FROM M_Product_PO WHERE IsActive = 'Y' AND  C_BPartner_ID = "+t.getValueOfInt(k.C_BPartner_ID)+" AND M_Product_ID = "+l,c=t.getValueOfInt(n.DB.executeScalar(sql)),c>0&&w==!1?f.setValue("C_UOM_ID",c):(sql="SELECT C_UOM_ID FROM M_Product WHERE IsActive = 'Y' AND M_Product_ID = "+l,f.setValue("C_UOM_ID",t.getValueOfInt(n.DB.executeScalar(sql)))));var it=i.getContextAsInt(u,"C_BPartner_ID",!1),ft=f.getValue("QtyInvoiced"),d=i.getContextAsInt(u,"M_PriceList_ID",!1),et=i.getContextAsInt(u,"M_PriceList_Version_ID"),ot=i.getContextAsInt(u,"M_AttributeSetInstance_ID"),st=i.getContext("DateInvoiced"),a=t.getValueOfInt(f.getValue("C_UOM_ID")),g=l.toString().concat(",",it.toString(),",",ft.toString(),",",w,",",d.toString(),",",et.toString(),",",null,",",st.toString(),",",ot.toString(),",",a,",",r),v=null;if(v=n.dataContext.getJSONRecord("MProductPricing/GetProductPricing",g),ht=null,f.setValue("PriceList",v.PriceList),f.setValue("PriceLimit",v.PriceLimit),f.setValue("PriceActual",v.PriceActual),f.setValue("PriceEntered",v.PriceEntered),f.setValue("C_Currency_ID",t.getValueOfInt(v.C_Currency_ID)),r<=0&&f.setValue("C_UOM_ID",t.getValueOfInt(v.C_UOM_ID)),r>0&&c>0&&w==!1){var g=l.toString(),a=n.dataContext.getJSONRecord("MProduct/GetC_UOM_ID",g),d=t.getValueOfInt(k.M_PriceList_ID),nt=n.dataContext.getJSONRecord("MPriceListVersion/GetM_PriceList_Version_ID",d.toString()),rt=n.dataContext.getJSONRecord("MUOM/GetPrecision",a.toString()),b=n.dataContext.getJSONRecord("MBPartner/GetBPartner",it.toString());sql="SELECT PriceList , PriceStd , PriceLimit FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+nt+" AND ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL ) AND C_UOM_ID="+c;y=n.DB.executeDataSet(sql);y.getTables().length>0&&(y.getTables()[0].getRows().length>0?(tt=this.FlatDiscount(l,i.getAD_Client_ID(),t.getValueOfDecimal(y.getTables()[0].getRows()[0].getCell("PriceStd")),b.M_DiscountSchema_ID,t.getValueOfDecimal(b.FlatDiscount),t.getValueOfInt(f.getValue("QtyEntered"))),f.setValue("PriceList",t.getValueOfDecimal(y.getTables()[0].getRows()[0].getCell("PriceList"))),f.setValue("PriceLimit",t.getValueOfDecimal(y.getTables()[0].getRows()[0].getCell("PriceLimit"))),f.setValue("PriceActual",tt),f.setValue("PriceEntered",tt),sql="SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y' AND con.M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND con.C_UOM_ID = "+a+" AND con.C_UOM_To_ID = "+c,h=t.getValueOfDecimal(n.DB.executeScalar(sql)),h==0&&(sql="SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y' AND con.C_UOM_ID = "+a+" AND con.C_UOM_To_ID = "+c,h=t.getValueOfDecimal(n.DB.executeScalar(sql))),a==c&&h==0&&(h=1),f.setValue("QtyInvoiced",t.getValueOfDecimal(f.getValue("QtyEntered")).toFixed(rt)*h)):(sql="SELECT PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+nt+" AND M_AttributeSetInstance_ID = 0 AND C_UOM_ID="+a,ut=t.getValueOfDecimal(n.DB.executeScalar(sql)),sql="SELECT PriceStd FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+nt+" AND M_AttributeSetInstance_ID = 0 AND C_UOM_ID="+a,p=t.getValueOfDecimal(n.DB.executeScalar(sql)),p=this.FlatDiscount(l,i.getAD_Client_ID(),p,b.M_DiscountSchema_ID,t.getValueOfDecimal(b.FlatDiscount),t.getValueOfInt(f.getValue("QtyEntered"))),sql="SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y' AND con.M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND con.C_UOM_ID = "+a+" AND con.C_UOM_To_ID = "+c,h=t.getValueOfDecimal(n.DB.executeScalar(sql)),h==0&&(sql="SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y' AND con.C_UOM_ID = "+a+" AND con.C_UOM_To_ID = "+c,h=t.getValueOfDecimal(n.DB.executeScalar(sql))),f.setValue("PriceList",ut*h),f.setValue("PriceActual",p*h),f.setValue("PriceEntered",p*h),h==0&&(h=1),f.setValue("QtyInvoiced",t.getValueOfDecimal(f.getValue("QtyEntered")).toFixed(rt)*h)))}i.setContext(u,"EnforcePriceLimit",v.IsEnforcePriceLimit?"Y":"N");i.setContext(u,"DiscountSchema",v.IsDiscountSchema?"Y":"N")}catch(ct){this.setCalloutActive(!1);this.log.severe(ct.toString())}return this.setCalloutActive(!1),s=null,this.Tax(i,u,f,e,o)};f.prototype.FlatDiscount=function(i,r,u,f,e,o){var y=u,a="SELECT UNIQUE M_Product_Category_ID FROM M_Product WHERE IsActive='Y' AND M_Product_ID = "+i,p=t.getValueOfInt(n.DB.executeScalar(a)),l=!1,v,h,s,c;if(a="SELECT  DiscountType  FROM M_DiscountSchema WHERE M_DiscountSchema_ID = "+f+" AND IsActive='Y'  AND AD_Client_ID="+r,v=t.getValueOfString(n.DB.executeScalar(a)),v=="F")return l=!0,u-u*e/100;if(v=="B"){if(a="SELECT M_Product_Category_ID , M_Product_ID , BreakValue , IsBPartnerFlatDiscount , BreakDiscount FROM M_DiscountSchemaBreak WHERE M_DiscountSchema_ID = "+f+" AND M_Product_ID = "+i+" AND IsActive='Y'  AND AD_Client_ID="+r+"Order BY BreakValue DESC",h=n.DB.executeDataSet(a),h.getTables().length>0){for(s=0,c=0,s=0;s<h.getTables()[0].getRows().length;s++)if(!(o<t.getValueOfDecimal(h.getTables()[0].getRows()[s].getCell("BreakValue"))))if(t.getValueOfString(h.getTables()[0].getRows()[0].getCell("IsBPartnerFlatDiscount"))=="N"){l=!0;c=u-u*t.getValueOfDecimal(h.getTables()[0].getRows()[s].getCell("BreakDiscount"))/100;break}else{l=!0;c=u-u*e/100;break}if(l)return c}if(a="SELECT M_Product_Category_ID , M_Product_ID , BreakValue , IsBPartnerFlatDiscount , BreakDiscount FROM M_DiscountSchemaBreak WHERE  M_DiscountSchema_ID = "+f+" AND M_Product_Category_ID = "+p+" AND IsActive='Y'  AND AD_Client_ID="+r+"Order BY BreakValue DESC",h=n.DB.executeDataSet(a),h.getTables().length>0){for(s=0,c=0,s=0;s<h.getTables()[0].getRows().length;s++)if(!(o<t.getValueOfDecimal(h.getTables()[0].getRows()[s].getCell("BreakValue"))))if(t.getValueOfString(h.getTables()[0].getRows()[0].getCell("IsBPartnerFlatDiscount"))=="N"){l=!0;c=u-u*t.getValueOfDecimal(h.getTables()[0].getRows()[s].getCell("BreakDiscount"))/100;break}else{l=!0;c=u-u*e/100;break}if(l)return c}if(a="SELECT M_Product_Category_ID , M_Product_ID , BreakValue , IsBPartnerFlatDiscount , BreakDiscount FROM M_DiscountSchemaBreak WHERE  M_DiscountSchema_ID = "+f+" AND M_Product_Category_ID IS NULL AND m_product_id IS NULL  AND IsActive='Y'  AND AD_Client_ID="+r+"Order BY BreakValue DESC",h=n.DB.executeDataSet(a),h.getTables().length>0){for(s=0,c=0,s=0;s<h.getTables()[0].getRows().length;s++)if(!(o<t.getValueOfDecimal(h.getTables()[0].getRows()[s].getCell("BreakValue"))))if(t.getValueOfString(h.getTables()[0].getRows()[0].getCell("IsBPartnerFlatDiscount"))=="N"){l=!0;c=u-u*t.getValueOfDecimal(h.getTables()[0].getRows()[s].getCell("BreakDiscount"))/100;break}else{l=!0;c=u-u*e/100;break}if(l)return c}}return y};f.prototype.Charge=function(i,r,u,f,e,o){var s,h,c;if(e==null||e.toString()=="")return"";s=null;try{if(h=e,h==null||h==0)return"";if(u.getValue("M_Product_ID")!=null)return u.setValue("C_Charge_ID",null),"ChargeExclusively";u.setValue("M_AttributeSetInstance_ID",null);u.setValue("S_ResourceAssignment_ID",null);u.setValue("C_UOM_ID",100);i.setContext(r,"DiscountSchema","N");c="SELECT ChargeAmt FROM C_Charge WHERE C_Charge_ID="+h;s=n.DB.executeReader(c,null,null);s.read()&&(u.setValue("PriceEntered",t.getValueOfDecimal(s.get("chargeamt"))),u.setValue("PriceActual",t.getValueOfDecimal(s.get("chargeamt"))),u.setValue("PriceLimit",0),u.setValue("PriceList",0),u.setValue("Discount",0));s.close()}catch(l){return this.setCalloutActive(!1),s!=null&&s.close(),l.message}return o=null,this.Tax(i,r,u,f,e)};f.prototype.Tax=function(i,r,u,f,e,o){var k,c,l,y,rt,p,a,v,d,w,g,nt,tt,h,b;if(e==null||e.toString()=="")return"";k=f.getColumnName();try{var it="",s="",h="",ut=t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX IN ('VATAX_' )")),et=i.getWindowContext(r,"IsSOTrx",!0)=="Y";if(h=u.getValue("C_Invoice_ID").toString(),c=n.dataContext.getJSONRecord("MInvoice/GetInvoice",h),s="SELECT VATAX_TaxRule FROM AD_OrgInfo WHERE AD_Org_ID="+t.getValueOfInt(c.AD_Org_ID)+" AND IsActive ='Y' AND AD_Client_ID ="+i.getAD_Client_ID(),ut>0&&(it=t.getValueOfString(n.DB.executeScalar(s))),it=="T")if(l=0,s="SELECT Count(*) FROM AD_Column WHERE ColumnName = 'C_Tax_ID' AND AD_Table_ID = (SELECT AD_Table_ID FROM AD_Table WHERE TableName = 'C_TaxCategory')",t.getValueOfInt(n.DB.executeScalar(s))>0?(h=t.getValueOfInt(u.getValue("C_Invoice_ID")).toString()+","+t.getValueOfInt(u.getValue("M_Product_ID")).toString()+","+t.getValueOfInt(u.getValue("C_Charge_ID")).toString(),l=n.dataContext.getJSONRecord("MInvoice/GetTax",h)):(s="select vatax_taxtype_id from c_bpartner_location where c_bpartner_id ="+util.getvalueofint(c.c_bpartner_id)+" and isactive = 'Y'  and c_bpartner_location_id = "+util.getvalueofint(c.c_bpartner_location_id),y=t.getValueOfInt(n.DB.executeScalar(s)),y==0&&(s="select vatax_taxtype_id from c_bpartner where c_bpartner_id ="+util.getvalueofint(c.c_bpartner_id)+" and isactive = 'Y'",y=t.getValueOfInt(n.DB.executeScalar(s))),rt=vis.datacontext.getjsonrecord("MProduct/GetTaxCategory",e.tostring()),s="select c_tax_id from vatax_taxcatrate where c_taxcategory_id = "+rt+" and isactive ='Y' and vatax_taxtype_id ="+y,l=t.getValueOfInt(n.DB.executeScalar(s))),l>0)u.setValue("C_Tax_ID",l);else{if(t.getValueOfInt(u.getValue("M_Product_ID"))>0)return u.setValue("M_Product_ID",""),this.setCalloutActive(!1),n.ADialog.info("VATAX_DefineTax");if(t.getValueOfInt(u.getValue("C_Charge_ID"))>0)return u.setValue("C_Charge_ID",""),this.setCalloutActive(!1),n.ADialog.info("VATAX_DefineChargeTax")}else{if((p=0,p=k.toString()=="M_Product_ID"?e:i.getContextAsInt(r,"M_Product_ID"),a=0,a=k.toString()=="C_Charge_ID"?e:i.getContextAsInt(r,"C_Charge_ID"),this.log.fine("Product="+p+", C_Charge_ID="+a),p==0&&a==0)||(v=i.getContextAsInt(r,"C_BPartner_Location_ID"),v==0))return this.Amt(i,r,u,f,e);this.log.fine("Ship BP_Location="+v);d=v;this.log.fine("Bill BP_Location="+d);w=i.getContext("DateInvoiced");this.log.fine("Bill Date="+w);g=w;this.log.fine("Ship Date="+g);nt=i.getContextAsInt(r,"AD_Org_ID");this.log.fine("Org="+nt);tt=i.getContextAsInt("#M_Warehouse_ID");this.log.fine("Warehouse="+tt);h=a.toString().concat(",",w.toString(),g.toString(),",",nt.toString(),",",tt.toString(),",",d.toString(),",",v.toString(),",",i.getWindowContext(r,"IsSOTrx",!0).equals("Y"));b=t.getValueOfInt(n.dataContext.getJSONRecord("MTax/Get",h));this.log.info("Tax ID="+b);b==0||u.setValue("C_Tax_ID",b)}}catch(ft){this.setCalloutActive(!1);this.log.severe(ft.toString())}return o=null,this.Amt(i,r,u,f,e)};f.prototype.Amt=function(u,f,e,o,s,h){var st,ht,ft,c,v,rt,lt,p,wt,bt,at,et,y,nt,w,b,k,l,d,ut,ni,ct,kt;if(this.isCalloutActive()||s==null||s.toString()=="")return"";this.setCalloutActive(!0);try{this.log.log(i.WARNING,"amt - init");var tt=u.getContextAsInt(f,"C_UOM_ID"),g=u.getContextAsInt(f,"M_Product_ID"),yt=u.getContextAsInt(f,"M_PriceList_ID"),ti=yt.toString(),w;if(w=n.dataContext.getJSONRecord("MPriceList/GetPriceList",ti),st=w.StdPrecision,ht=e.getValue("QtyEntered"),ft=e.getValue("QtyInvoiced"),this.log.fine("QtyEntered="+ht+", Invoiced="+ft+", UOM="+tt),c=e.getValue("PriceEntered"),v=e.getValue("PriceActual"),rt=e.getValue("PriceLimit"),p=e.getValue("PriceList"),this.log.fine("PriceList="+p+", Limit="+rt+", Precision="+st),this.log.fine("PriceEntered="+c+", Actual="+v),o.getColumnName()=="QtyEntered"&&r>0){nt=e.getValue("C_Invoice_ID").toString();var et=n.dataContext.getJSONRecord("MInvoice/GetInvoice",nt),y=n.dataContext.getJSONRecord("MPriceListVersion/GetM_PriceList_Version_ID",et.M_PriceList_ID.toString()),pt=u.getContextAsInt(f,"C_BPartner_ID",!1),it=n.dataContext.getJSONRecord("MBPartner/GetBPartner",pt.toString());a=t.getValueOfInt(e.getValue("M_AttributeSetInstance_ID"))>0?"SELECT COUNT(*) FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(e.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+y+" AND  M_AttributeSetInstance_ID = "+t.getValueOfInt(e.getValue("M_AttributeSetInstance_ID"))+"  AND C_UOM_ID="+t.getValueOfInt(e.getValue("C_UOM_ID")):"SELECT COUNT(*) FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(e.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+y+" AND  ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL )   AND C_UOM_ID="+t.getValueOfInt(e.getValue("C_UOM_ID"));t.getValueOfInt(n.DB.executeScalar(a))>0?(a=t.getValueOfInt(e.getValue("M_AttributeSetInstance_ID"))>0?"SELECT PriceStd , PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(e.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+y+" AND  M_AttributeSetInstance_ID = "+t.getValueOfInt(e.getValue("M_AttributeSetInstance_ID"))+"  AND C_UOM_ID="+t.getValueOfInt(e.getValue("C_UOM_ID")):"SELECT PriceStd , PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(e.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+y+" AND  ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL )   AND C_UOM_ID="+t.getValueOfInt(e.getValue("C_UOM_ID")),l=n.DB.executeDataSet(a),l.getTables().length>0&&l.getTables()[0].getRows().length>0&&(c=this.FlatDiscount(g,u.getAD_Client_ID(),t.getValueOfDecimal(l.getTables()[0].getRows()[0].getCell("PriceStd")),it.M_DiscountSchema_ID,t.getValueOfDecimal(it.FlatDiscount),t.getValueOfInt(e.getValue("QtyEntered"))),p=t.getValueOfDecimal(l.getTables()[0].getRows()[0].getCell("PriceList")),e.setValue("PriceList",t.getValueOfDecimal(l.getTables()[0].getRows()[0].getCell("PriceList"))),e.setValue("PriceEntered",c),v=c,e.setValue("PriceActual",v))):(b=g.toString(),k=n.dataContext.getJSONRecord("MProduct/GetC_UOM_ID",b),a=t.getValueOfInt(e.getValue("M_AttributeSetInstance_ID"))>0?"SELECT PriceStd , PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(e.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+y+" AND  M_AttributeSetInstance_ID = "+t.getValueOfInt(e.getValue("M_AttributeSetInstance_ID"))+"  AND C_UOM_ID="+k:"SELECT PriceStd , PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(e.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+y+" AND  ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL )   AND C_UOM_ID="+k,l=n.DB.executeDataSet(a),l.getTables().length>0&&l.getTables()[0].getRows().length>0&&(c=this.FlatDiscount(g,u.getAD_Client_ID(),t.getValueOfDecimal(l.getTables()[0].getRows()[0].getCell("PriceStd")),it.M_DiscountSchema_ID,t.getValueOfDecimal(it.FlatDiscount),t.getValueOfInt(e.getValue("QtyEntered"))),p=t.getValueOfDecimal(l.getTables()[0].getRows()[0].getCell("PriceList"))),a="SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y'  AND con.M_Product_ID = "+t.getValueOfInt(e.getValue("M_Product_ID"))+" AND con.C_UOM_ID = "+k+" AND con.C_UOM_To_ID = "+tt,d=t.getValueOfDecimal(n.DB.executeScalar(a)),d==0&&(a="SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y' AND con.C_UOM_ID = "+k+" AND con.C_UOM_To_ID = "+tt,d=t.getValueOfDecimal(n.DB.executeScalar(a))),c=c*d,p=p*d,e.setValue("PriceList",p),e.setValue("PriceEntered",c),v=c,e.setValue("PriceActual",v))}if((o.getColumnName()=="QtyInvoiced"||o.getColumnName()=="QtyEntered"||o.getColumnName()=="M_Product_ID")&&!1==u.getContext("DiscountSchema")){if(wt=u.getContextAsInt(f,"C_BPartner_ID"),o.getColumnName()=="QtyEntered"&&(b=g.toString().concat(",",tt.toString(),",",ht.toString()),ft=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo",b)),ft==null&&(ft=ht),bt=u.getWindowContext(f,"IsSOTrx",!0)=="Y",at=e.getValue("DateInvoiced"),r=t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='ED011_'")),et=n.dataContext.getJSONRecord("MInvoice/GetInvoice",e.getValue("C_Invoice_ID").toString()),y=n.dataContext.getJSONRecord("MPriceListVersion/GetM_PriceList_Version_ID",et.M_PriceList_ID.toString()),nt=at==null?g.toString().concat(",",wt.toString(),",",ft.toString(),",",bt,",",yt.toString(),",",y.toString(),",",at,",",null,",",tt.toString(),",",r):g.toString().concat(",",wt.toString(),",",ft.toString(),",",bt,",",yt.toString(),",",y.toString(),",",at.toString(),",",null,",",tt.toString(),",",r),w=null,w=n.dataContext.getJSONRecord("MProductPricing/GetProductPricing",nt),r<=0)b=g.toString().concat(",",tt.toString(),",",v.toString()),c=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",b);else{nt=t.getValueOfInt(e.getValue("C_Invoice_ID")).toString();var et=n.dataContext.getJSONRecord("MInvoice/GetInvoice",nt),y=n.dataContext.getJSONRecord("MPriceListVersion/GetM_PriceList_Version_ID",et.M_PriceList_ID.toString()),pt=u.getContextAsInt(f,"C_BPartner_ID",!1),it=n.dataContext.getJSONRecord("MBPartner/GetBPartner",pt.toString());a=t.getValueOfInt(e.getValue("M_AttributeSetInstance_ID"))>0?"SELECT COUNT(*) FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(e.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+y+" AND  M_AttributeSetInstance_ID = "+t.getValueOfInt(e.getValue("M_AttributeSetInstance_ID"))+"  AND C_UOM_ID="+t.getValueOfInt(e.getValue("C_UOM_ID")):"SELECT COUNT(*) FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(e.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+y+" AND  ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL )   AND C_UOM_ID="+t.getValueOfInt(e.getValue("C_UOM_ID"));t.getValueOfInt(n.DB.executeScalar(a))>0?(a=t.getValueOfInt(e.getValue("M_AttributeSetInstance_ID"))>0?"SELECT PriceStd , PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(e.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+y+" AND  M_AttributeSetInstance_ID = "+t.getValueOfInt(e.getValue("M_AttributeSetInstance_ID"))+"  AND C_UOM_ID="+t.getValueOfInt(e.getValue("C_UOM_ID")):"SELECT PriceStd , PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(e.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+y+" AND  ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL )   AND C_UOM_ID="+t.getValueOfInt(e.getValue("C_UOM_ID")),l=n.DB.executeDataSet(a),l.getTables().length>0&&l.getTables()[0].getRows().length>0&&(c=this.FlatDiscount(g,u.getAD_Client_ID(),t.getValueOfDecimal(l.getTables()[0].getRows()[0].getCell("PriceStd")),it.M_DiscountSchema_ID,t.getValueOfDecimal(it.FlatDiscount),t.getValueOfInt(e.getValue("QtyEntered"))),p=t.getValueOfDecimal(l.getTables()[0].getRows()[0].getCell("PriceList")),e.setValue("PriceList",t.getValueOfDecimal(l.getTables()[0].getRows()[0].getCell("PriceList"))))):(b=g.toString(),k=n.dataContext.getJSONRecord("MProduct/GetC_UOM_ID",b),a=t.getValueOfInt(e.getValue("M_AttributeSetInstance_ID"))>0?"SELECT PriceStd , PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(e.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+y+" AND  M_AttributeSetInstance_ID = "+t.getValueOfInt(e.getValue("M_AttributeSetInstance_ID"))+"  AND C_UOM_ID="+k:"SELECT PriceStd , PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(e.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+y+" AND  ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL )   AND C_UOM_ID="+k,l=n.DB.executeDataSet(a),l.getTables().length>0&&l.getTables()[0].getRows().length>0&&(c=this.FlatDiscount(g,u.getAD_Client_ID(),t.getValueOfDecimal(l.getTables()[0].getRows()[0].getCell("PriceStd")),it.M_DiscountSchema_ID,t.getValueOfDecimal(it.FlatDiscount),t.getValueOfInt(e.getValue("QtyEntered"))),p=t.getValueOfDecimal(l.getTables()[0].getRows()[0].getCell("PriceList"))),a="SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y'  AND con.M_Product_ID = "+t.getValueOfInt(e.getValue("M_Product_ID"))+" AND con.C_UOM_ID = "+k+" AND con.C_UOM_To_ID = "+tt,d=t.getValueOfDecimal(n.DB.executeScalar(a)),d==0&&(a="SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y' AND con.C_UOM_ID = "+k+" AND con.C_UOM_To_ID = "+tt,d=t.getValueOfDecimal(n.DB.executeScalar(a))),c=c*d,v=c,p=p*d,e.setValue("PriceList",p))}c==null&&(c=w.PriceStd);this.log.fine("amt - QtyChanged -> PriceActual="+w.PriceStd+", PriceEntered="+c+", Discount="+w.Discount);v=r<=0?w.PriceStd:c;e.setValue("PriceActual",v);e.setValue("PriceEntered",c);u.setContext(f,"DiscountSchema",w.IsDiscountSchema?"Y":"N")}else o.getColumnName()=="PriceActual"?(v=s,c=v,this.log.fine("amt - PriceActual="+v+" -> PriceEntered="+c),e.setValue("PriceEntered",c)):o.getColumnName()=="PriceEntered"&&(c=s,v=c,v==null&&(v=c),this.log.fine("amt - PriceEntered="+c+" -> PriceActual="+v),e.setValue("PriceActual",v));var dt=!1,ot=u.getContext("EnforcePriceLimit"),vt=u.isSOTrx()&&ot!=null&&ot=="Y";if(ot==""){var nt=t.getValueOfInt(e.getValue("C_Invoice_ID")).toString(),gt=n.dataContext.getJSONRecord("MInvoice/GetInvoice",nt),a="SELECT EnforcePriceLimit FROM M_PriceList WHERE IsActive = 'Y' AND M_PriceList_ID = "+gt.M_PriceList_ID;ot=n.DB.executeScalar(a);vt=gt.IsSOTrx&&ot!=null&&ot=="Y";a="SELECT OverwritePriceLimit FROM AD_Role WHERE IsActive = 'Y' AND AD_Role_ID = "+u.getContext("#AD_Role_ID");dt=t.getValueOfBoolean(n.DB.executeScalar(a))}if(vt&&dt&&(vt=!1),vt&&t.getValueOfDouble(rt)!=0&&v.compareTo(rt)<0&&(v=rt,c=v,c==null&&(c=rt),this.log.fine("amt =(under) PriceEntered="+c+", Actual"+rt),e.setValue("PriceActual",rt),e.setValue("PriceEntered",c),n.ADialog.info("UnderLimitPrice"),t.getValueOfInt(p)!=0&&(lt=(p-v)/p*100,t.scale(lt)>2&&(lt=lt.toFixed(2)))),c=t.getValueOfDecimal(e.getValue("PriceEntered")),ut=ht*c,t.scale(ut)>st&&(ut=ut.toFixed(st)),this.log.info("amt = LineNetAmt="+ut),e.setValue("LineNetAmt",ut),ni="Y"==u.getWindowContext(f,"IsSOTrx",!0),!ni){if(ct=n.Env.ZERO,o.getColumnName()=="TaxAmt")ct=e.getValue("TaxAmt");else if(kt=e.getValue("C_Tax_ID"),kt!=null){var ii=kt,ri=this.IsTaxIncluded(f,u),nt=ii.toString().concat(",",ut.toString(),",",ri,",",st.toString()),w=null;ct=n.dataContext.getJSONRecord("MTax/CalculateTax",nt);e.setValue("TaxAmt",ct)}e.setValue("LineTotalAmt",t.getValueOfDecimal(ut)+ct)}}catch(ui){this.setCalloutActive(!1);this.log.severe(ui.toString())}return this.setCalloutActive(!1),u=f=e=o=s=h=null,""};f.prototype.IsTaxIncluded=function(t,i){var r=i.getContext("IsTaxIncluded"),u;try{if(r.toString().length==0){if(u=i.getContextAsInt(t,"M_PriceList_ID"),u==0)return!1;r=n.DB.executeScalar("SELECT IsTaxIncluded FROM M_PriceList WHERE M_PriceList_ID="+u,null,null).toString();r==null&&(r="N");i.setContext(t,"IsTaxIncluded",r)}}catch(f){this.setCalloutActive(!1);this.log.severe(f.toString())}return i=t=mTab=mField=value=oldValue=null,"Y"==r};f.prototype.Qty=function(u,f,e,o,s,h){var p,l,c,k,b,st,tt,ht,ft,g,et,it,d,rt,ct,lt,at,ut,w,v,nt,a,y;if(s==null||s.toString()==""||this.isCalloutActive()||s==null)return"";this.setCalloutActive(!0);try{if(p=u.getContextAsInt(f,"M_Product_ID"),this.log.log(i.WARNING,"qty - init - M_Product_ID="+p),p==0)c=e.getValue("QtyEntered"),e.setValue("QtyInvoiced",c);else if(o.getColumnName().toString().equals("C_UOM_ID"))a=t.getValueOfInt(s),c=e.getValue("QtyEntered"),st=u.getContextAsInt(f,"C_BPartner_ID",!1),tt=n.dataContext.getJSONRecord("MBPartner/GetBPartner",st.toString()),r=t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='ED011_'")),r>0?(w=t.getValueOfInt(e.getValue("C_Invoice_ID")).toString(),ht=n.dataContext.getJSONRecord("MInvoice/GetInvoice",w),ft=n.dataContext.getJSONRecord("MPriceListVersion/GetM_PriceList_Version_ID",ht.M_PriceList_ID.toString()),sql="SELECT PriceList , PriceStd , PriceLimit FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(e.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+ft+" AND  ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL )   AND C_UOM_ID="+a,g=n.DB.executeDataSet(sql),g.getTables().length>0&&(g.getTables()[0].getRows().length>0?(et=this.FlatDiscount(p,u.getAD_Client_ID(),t.getValueOfDecimal(g.getTables()[0].getRows()[0].getCell("PriceStd")),tt.M_DiscountSchema_ID,t.getValueOfDecimal(tt.FlatDiscount),t.getValueOfInt(e.getValue("QtyEntered"))),e.setValue("PriceList",t.getValueOfDecimal(g.getTables()[0].getRows()[0].getCell("PriceList"))),e.setValue("PriceLimit",t.getValueOfDecimal(g.getTables()[0].getRows()[0].getCell("PriceLimit"))),e.setValue("PriceActual",et),e.setValue("PriceEntered",et),paramStr=a.toString().concat(","),it=n.dataContext.getJSONRecord("MUOM/GetPrecision",paramStr),v=c.toFixed(t.getValueOfInt(it)),c!=v&&(this.log.fine("Corrected QtyEntered Scale UOM="+a+"; QtyEntered="+c+"->"+v),c=v,e.setValue("QtyEntered",c)),paramStr=p.toString().concat(",",a.toString(),",",c.toString()),d=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",paramStr),l=d,y=!1,l!=null&&(y=c!=l),l==null&&(y=!1,l=1),y?e.setValue("QtyInvoiced",l):e.setValue("QtyInvoiced",l*v),e.setValue("PriceActual",et),e.setValue("PriceList",t.getValueOfDecimal(g.getTables()[0].getRows()[0].getCell("PriceList")))):(paramStr=a.toString().concat(","),it=n.dataContext.getJSONRecord("MUOM/GetPrecision",paramStr),v=c.toFixed(t.getValueOfInt(it)),c!=v&&(this.log.fine("Corrected QtyEntered Scale UOM="+a+"; QtyEntered="+c+"->"+v),c=v,e.setValue("QtyEntered",c)),paramStr=p.toString().concat(",",a.toString(),",",c.toString()),d=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",paramStr),l=d,l==null&&(l=c),y=c!=l,k=t.getValueOfDecimal(e.getValue("PriceEntered")),paramStr=p.toString().concat(",",a.toString(),",",k.toString()),d=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",paramStr),b=d,b==null&&(b=k),this.log.fine("UOM="+a+", QtyEntered/PriceActual="+c+"/"+k+" -> "+y+" QtyInvoiced/PriceEntered="+l+"/"+b),u.setContext(f,"UOMConversion",y?"Y":"N"),e.setValue("QtyInvoiced",l),e.setValue("PriceEntered",b),paramStr=p.toString(),rt=n.dataContext.getJSONRecord("MProduct/GetC_UOM_ID",paramStr),sql="SELECT PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(e.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+ft+" AND ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL ) AND C_UOM_ID="+rt,ct=t.getValueOfDecimal(n.DB.executeScalar(sql)),sql="SELECT PriceStd FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(e.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+ft+" AND ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL ) AND C_UOM_ID="+rt,lt=t.getValueOfDecimal(n.DB.executeScalar(sql)),at=this.FlatDiscount(p,u.getAD_Client_ID(),lt,tt.M_DiscountSchema_ID,t.getValueOfDecimal(tt.FlatDiscount),t.getValueOfInt(e.getValue("QtyEntered"))),sql="SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y'  AND con.M_Product_ID = "+t.getValueOfInt(e.getValue("M_Product_ID"))+" AND con.C_UOM_ID = "+rt+" AND con.C_UOM_To_ID = "+a,ut=t.getValueOfDecimal(n.DB.executeScalar(sql)),ut==0&&(sql="SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y' AND con.C_UOM_ID = "+rt+" AND con.C_UOM_To_ID = "+a,ut=t.getValueOfDecimal(n.DB.executeScalar(sql))),e.setValue("PriceList",ct*ut),e.setValue("PriceActual",at*ut)))):(v=null,c!=null&&(w=a.toString(),nt=n.dataContext.getJSONRecord("MUOM/GetPrecision",w),v=c.toFixed(nt)),c!=v&&(this.log.fine("Corrected QtyEntered Scale UOM="+a+"; QtyEntered="+c+"->"+v),c=v,e.setValue("QtyEntered",c)),w=p.toString().concat(",",a.toString(),",",c.toString()),l=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",w),l==null&&(l=c),y=c!=l,k=e.getValue("PriceActual"),w=p.toString().concat(",",a.toString(),",",k.toString()),b=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",w),b==null&&(b=k),this.log.fine("qty - UOM="+a+", QtyEntered/PriceActual="+c+"/"+k+" -> "+y+" QtyInvoiced/PriceEntered="+l+"/"+b),u.setContext(f,"UOMConversion",y?"Y":"N"),e.setValue("QtyInvoiced",l),e.setValue("PriceEntered",b));else if(o.getColumnName().equals("QtyEntered"))a=u.getContextAsInt(f,"C_UOM_ID"),c=s,v=null,c!=null&&(nt=n.dataContext.getJSONRecord("MUOM/GetPrecision",a.toString()),v=c.toFixed(nt)),c!=v&&(this.log.fine("Corrected QtyEntered Scale UOM="+a+"; QtyEntered="+c+"->"+v),c=v,e.setValue("QtyEntered",c)),w=p.toString().concat(",",a.toString(),",",c.toString()),l=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",w),l==null&&(l=c),y=c!=l,this.log.fine("qty - UOM="+a+", QtyEntered="+c+" -> "+y+" QtyInvoiced="+l),u.setContext(f,"UOMConversion",y?"Y":"N"),e.setValue("QtyInvoiced",l);else if(o.getColumnName().equals("QtyInvoiced")){a=u.getContextAsInt(f,"C_UOM_ID");l=s;var w=p.toString(),nt=n.dataContext.getJSONRecord("MProduct/GetUOMPrecision",w),ot=null;l!=null&&(ot=l.toFixed(nt));l!=ot&&(this.log.fine("Corrected QtyInvoiced Scale "+l+"->"+ot),l=ot,e.setValue("QtyInvoiced",l));w=p.toString().concat(",",a.toString(),",",l.toString());c=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo",w);c==null&&(c=l);y=l!=c;this.log.fine("qty - UOM="+a+", QtyInvoiced="+l+" -> "+y+" QtyEntered="+c);u.setContext(f,"UOMConversion",y?"Y":"N");e.setValue("QtyEntered",c)}}catch(vt){this.setCalloutActive(!1);this.log.severe(vt.toString())}finally{this.setCalloutActive(!1)}return u=f=e=o=s=h=null,""};f.prototype.PriceList=function(r,u,f,e,o,s){var l="",h=null,c,a,v;try{if(o==null||o.toString()==""||(c=t.getValueOfInt(o.toString()),c==null||c==0))return"";l="SELECT pl.IsTaxIncluded,pl.EnforcePriceLimit,pl.C_Currency_ID,c.StdPrecision,plv.M_PriceList_Version_ID,plv.ValidFrom FROM M_PriceList pl,C_Currency c,M_PriceList_Version plv WHERE pl.C_Currency_ID=c.C_Currency_ID AND pl.M_PriceList_ID=plv.M_PriceList_ID AND pl.M_PriceList_ID="+c+"ORDER BY plv.ValidFrom DESC";h=n.DB.executeReader(l);h.read()&&(f.setValue("IsTaxIncluded",Boolean("Y".equals(h.get("istaxincluded")))),r.setContext(u,"EnforcePriceLimit",h.get("enforcepricelimit")),a=t.getValueOfInt(h.get("c_currency_id")),f.setValue("C_Currency_ID",a),v=t.getValueOfInt(h.get("m_pricelist_version_id")),r.setContext(u,"M_PriceList_Version_ID",v));h.close()}catch(y){return this.setCalloutActive(!1),h!=null&&h.close(),this.log.log(i.severe,l,y),y.message}return r=u=f=e=o=s=null,""};n.Model.CalloutInvoice=f;n.Utility.inheritPrototype(a,n.CalloutEngine);a.prototype.Date=function(n,t,i,r,u,f){return u==null||u.toString()==""?"":(i.setValue("DateAcct",u),this.SetDocumentNo(n,t,i),n=t=i=r=u=f=null,"")};a.prototype.BPartner=function(r,u,f,e,o,s){var l,c,p,a,w,v,b,g,nt;if(o==null||o.toString()==""||(l=t.getValueOfInt(o),l==null||l==0))return"";var k="SELECT p.AD_Language,p.C_PaymentTerm_ID, COALESCE(p.M_PriceList_ID,g.M_PriceList_ID) AS M_PriceList_ID, p.PaymentRule,p.POReference, p.SO_Description,p.IsDiscountPrinted, p.SO_CreditLimit, p.SO_CreditLimit-p.SO_CreditUsed AS CreditAvailable, l.C_BPartner_Location_ID,c.AD_User_ID, COALESCE(p.PO_PriceList_ID,g.PO_PriceList_ID) AS PO_PriceList_ID, p.PaymentRulePO,p.PO_PaymentTerm_ID FROM C_BPartner p INNER JOIN C_BP_Group g ON (p.C_BP_Group_ID=g.C_BP_Group_ID) LEFT OUTER JOIN C_BPartner_Location l ON (p.C_BPartner_ID=l.C_BPartner_ID AND l.IsBillTo='Y' AND l.IsActive='Y') LEFT OUTER JOIN AD_User c ON (p.C_BPartner_ID=c.C_BPartner_ID) WHERE p.C_BPartner_ID=@Param1 AND p.IsActive='Y'",y=r.isSOTrx(),d=[],h=null;try{d[0]=new n.DB.SqlParam("@Param1",l);h=n.DB.executeReader(k,d,null);h.read()&&(c=t.getValueOfString(h.get(y?"paymentrule":"paymentrulepo")),c!=null&&c.length!=0&&(r.getContext("DocBaseType").endsWith("C")?c="P":(this.isSOTrx&&c=="S"||c=="U")&&(c="P")),p=t.getValueOfInt(h.get(y?"c_paymentterm_id":"po_paymentterm_id")),p>0&&f.setValue("C_PaymentTerm_ID",p),a=t.getValueOfInt(h.get("c_bpartner_location_id")),l.toString().equals(r.getContext("C_BPartner_ID"))&&(w=r.getContext("C_BPartner_Location_ID"),w.toString().length>0&&(a=t.getValueOfInt(w))),a==0?f.setValue("C_BPartner_Location_ID",null):f.setValue("C_BPartner_Location_ID",t.getValueOfInt(a)),v=t.getValueOfInt(h.get("ad_user_id")),l.toString().equals(r.getContext("C_BPartner_ID"))&&(b=r.getContext("AD_User_ID"),b.toString().length>0&&(v=t.getValueOfInt(b))),v==0?f.setValue("AD_User_ID",null):f.setValue("AD_User_ID",t.getValueOfInt(v)),y&&(g=t.getValueOfDouble(h.get("so_creditlimit")),g!=0&&(nt=t.getValueOfDouble(h.get("creditavailable")),h==null&&nt<0&&n.ADialog.info("CreditLimitOver"))));h.close()}catch(tt){return this.setCalloutActive(!1),h!=null&&h.close(),this.log.log(i.severe,k,tt),tt.message}return this.SetDocumentNo(r,u,f),s=null,this.Tax(r,u,f,e,o)};a.prototype.DocType=function(n,t,i,r,u,f){return this.SetDocumentNo(n,t,i),n=t=i=r=u=f=null,""};a.prototype.SetDocumentNo=function(i,r,u,f,e,o){var w=i.getContextAsInt(r,"C_InvoiceBatch_ID"),b="SELECT COALESCE(MAX(C_InvoiceBatchLine_ID),0) FROM C_InvoiceBatchLine WHERE C_InvoiceBatch_ID="+w,l=n.DB.executeScalar(b),a,s,v,y,c,h,p;l!=0&&(a=l.toString(),s=null,s=n.dataContext.getJSONRecord("MInvoiceBatchLine/GetInvoiceBatchLine",a),v=i.getContextAsInt(r,"C_DocType_ID"),y=i.getContextAsInt(r,"C_BPartner_ID"),v!=s.C_DocType_ID||y!=s.C_BPartner_ID)&&(c=s.DocumentNo,c!=null)&&(h=0,h=t.getValueOfInt(c),h!=0)&&(p=t.getValueOfString(h+1),u.setValue("DocumentNo",p),i=r=u=f=e=o=null)};a.prototype.Charge=function(r,u,f,e,o,s){var c;if(o==null||o.toString()==""||(c=t.getValueOfInt(o),c==null||t.getValueOfInt(c)==0))return"";var l="SELECT ChargeAmt FROM C_Charge WHERE C_Charge_ID=@Param1",a=[],h=null;try{a[0]=new n.DB.SqlParam("@Param1",c);h=n.DB.executeReader(l,a,null);h.read()&&f.setValue("PriceEntered",t.getValueOfDecimal(h.get(0)));h.close()}catch(v){return this.setCalloutActive(!1),h!=null&&h.close(),this.log.log(i.severe,l,v),v.message}return s=null,this.Tax(r,u,f,e,o)};a.prototype.Tax=function(i,r,u,f,e){var p=f.getColumnName(),o,s,h,c,l,a,y,v;return e==null||e.toString()==""?"":(o=0,o=p.equals("C_Charge_ID")?t.getValueOfInt(e):i.getContextAsInt(r,"C_Charge_ID"),this.log.fine("C_Charge_ID="+o),o==0)?this.Amt(i,r,u,f,e):(s=i.getContextAsInt(r,"C_BPartner_Location_ID"),s==0)?this.Amt(i,r,u,f,e):(this.log.fine("BP_Location="+s),h=t.getValueOfDate(i.getContext("DateInvoiced")),this.log.fine("Bill Date="+h),c=h,this.log.fine("Ship Date="+c),l=i.getContextAsInt(r,"AD_Org_ID"),this.log.fine("Org="+l),a=i.getContextAsInt("#M_Warehouse_ID"),this.log.fine("Warehouse="+a),y=o.toString().concat(",",h.toString(),c.toString(),",",l.toString(),",",a.toString(),",",s.toString(),",",s.toString(),",",i.getWindowContext(r,"IsSOTrx",!0).equals("Y")),v=n.dataContext.getJSONRecord("MTax/Get",y),v==0||u.setValue("C_Tax_ID",t.getValueOfInt(v)),this.Amt(i,r,u,f,e))};a.prototype.Amt=function(i,r,u,f,e,o){var s,v,h,y;if(this.isCalloutActive()||e==null||e.toString()=="")return"";this.setCalloutActive(!0);var a=i.getStdPrecision(),c=t.getValueOfDecimal(u.getValue("QtyEntered")),l=t.getValueOfDecimal(u.getValue("PriceEntered"));if(this.log.fine("QtyEntered="+c+", PriceEntered="+l),c==null&&(c=n.Env.ZERO),l==null&&(l=n.Env.ZERO),s=c*l,t.scale(s)>a&&(s=s.toFixed(a)),v="Y"==i.getContext("IsTaxIncluded"),h=null,f.getColumnName().equals("TaxAmt"))h=u.getValue("TaxAmt");else if(y=u.getValue("C_Tax_ID"),y!=null){var p=t.getValueOfInt(y),w=p.toString().concat(",",s.toString(),",",v.toString(),",",a.toString());h=n.dataContext.getJSONRecord("MTax/CalculateTax",w);u.setValue("TaxAmt",h)}return v?(u.setValue("LineTotalAmt",s),u.setValue("LineNetAmt",t.getValueOfDecimal(s)*t.getValueOfDecimal(h))):(u.setValue("LineNetAmt",s),u.setValue("LineTotalAmt",t.getValueOfDecimal(s)+t.getValueOfDecimal(h))),this.setCalloutActive(!1),i=r=u=f=e=o=null,""};n.Model.CalloutInvoiceBatch=a;n.Utility.inheritPrototype(ti,n.CalloutEngine);ti.prototype.Product=function(n,t,i,r,u,f){if(u==null||u.toString()=="")return"";var e=u;return e==null||e==0?"":(n.getContextAsInt(t,"M_Product_ID")==e&&n.getContextAsInt(t,"M_AttributeSetInstance_ID")!=0?i.setValue("M_AttributeSetInstance_ID",n.getContextAsInt(t,"M_AttributeSetInstance_ID")):i.setValue("M_AttributeSetInstance_ID",null),n=t=i=r=u=f=null,"")};n.Model.CalloutMovement=ti;n.Utility.inheritPrototype(ii,n.CalloutEngine);ii.prototype.Objectchk=function(i,r,u,f,o,s){var y,a,v,c,w,h,p,l;if(o==null||o.toString()==""||o==null||(y=t.getValueOfInt(u.getValue("FO_OBJECT_DATA_ID")),c=t.getValueOfDateTime(u.getValue("TODAYDATE")),y==null))return"";w="select FO_RES_ACCOMODATION_ID,DATE_FROM,TILL_DATE from FO_RES_ACCOMODATION where FO_OBJECT_DATA_ID=@FO_OBJ_DATA_ID";h=null;try{for(p=[],p[0]=new n.DB.SqlParam("@FO_OBJ_DATA_ID",y),h=n.DB.executeReader(w,p,null);h.read();){if((a=t.getValueOfDateTime(h[1]),v=t.getValueOfDateTime(h[2]),l=a,c.compareTo(v)>0)||c.compareTo(a)<0)return u.setValue("RES_STATUS",!1),"";if(c.compareTo(a)>0&&c.compareTo(v)<0)while(!(l.compareTo(v)==0))c.compareTo(l)==0&&u.setValue("RES_STATUS",!0),l=l.AddDays(1)}h.close()}catch(b){this.setCalloutActive(!1);h!=null&&h.close();this.log.severe(e.toString())}finally{h!=null&&h.close()}return i=r=u=f=o=s=null,""};n.Model.CalloutObjectData=ii;n.Utility.inheritPrototype(ht,n.CalloutEngine);ht.prototype.Datechk=function(i,r,u,f,e,o){var c,v,y,p,h,w;if(e==null||e.toString()==""||(c=t.getValueOfDateTime(e),c==null||c==0))return"";var b=u.getValue("AD_ORG_ID"),l=0,k="select  DAYSPAYABLE2 from FO_SETTINGS where AD_ORG_ID="+b,s=null;try{for(s=n.DB.executeReader(k,null,null);s.read();)l=t.getValueOfInt(s[0].toString());s.close()}catch(a){this.setCalloutActive(!1);s!=null&&s.close();this.log.severe(a.toString())}v=t.getValueOfDateTime(u.getValue("DATE1"));y=v.AddDays(l);u.setValue("DATE2",y);h=100;w="select max(OFFERNO)from FO_OFFER";try{for(s=n.DB.executeReader(w,null,null);s.read();)h=t.getValueOfInt(s[0].toString());s.close()}catch(a){this.setCalloutActive(!1);s!=null&&s.close();this.log.severe(a.toString())}finally{s!=null&&s.close()}return p=h==null|h==0?100:h+1,u.setValue("OFFERNO",p),i=r=u=f=e=o=null,""};ht.prototype.guestpricelist=function(i,r,u,f,e,o){var h;if(e==null||(h=t.getValueOfInt(e),h==null||h==0))return"";var l="select FO_PRICE_LIST_ID from FO_ADDRESS_PRICE where FO_ADDRESS_ID="+h,c=0,s=null;try{for(s=n.DB.executeReader(l,null,null);s.read();)c=t.getValueOfInt(s[0]);s.close()}catch(a){this.setCalloutActive(!1);s!=null&&s.close();this.log.severe(a.toString())}finally{s!=null&&s.close()}return u.setValue("FO_PRICE_LIST_ID",c),i=r=u=f=e=o=null,""};n.Model.CalloutOffer=ht;n.Utility.inheritPrototype(nt,n.CalloutEngine);nt.prototype.Period=function(r,u,f,o,s,h){var y,w,a,v;if(this.isCalloutActive()||s==null||s.toString()=="")return"";if(y=o.getColumnName(),this.setCalloutActive(!0),w=r.getContextAsInt(u,"AD_Client_ID",!1),a=new Date,a=y=="DateAcct"?s:f.getValue("DateAcct"),v=0,y=="C_Period_ID"&&(v=t.getValueOfInt(s)),y=="DateDoc")f.setValue("DateAcct",s);else if(y=="DateAcct"){var p="SELECT C_Period_ID FROM C_Period WHERE C_Year_ID IN \t(SELECT C_Year_ID FROM C_Year WHERE C_Calendar_ID =  (SELECT C_Calendar_ID FROM AD_ClientInfo WHERE AD_Client_ID=@param1)) AND @param2 BETWEEN StartDate AND EndDate AND PeriodType='S'",l=[],c=null;try{l[0]=new n.DB.SqlParam("@param1",w);l[1]=new n.DB.SqlParam("@param2",a);l[1].setIsDate(!0);c=n.DB.executeReader(p,l,null);c.read()&&(v=t.getValueOfInt(c.get(0)));c.close()}catch(k){return c!=null&&c.close(),this.log.log(i.SEVERE,p,e),this.setCalloutActive(!1),k.message}v!=0&&f.setValue("C_Period_ID",t.getValueOfInt(v))}else{var p="SELECT PeriodType, StartDate, EndDate FROM C_Period WHERE C_Period_ID=@param",l=[],c=null;try{if(l[0]=new n.DB.SqlParam("@param",v),c=n.DB.executeReader(p,l,null),c.read()){var d=c.get("periodtype"),g=c.get("startdate"),b=c.get("enddate");d=="S"&&(a==null||a<g||a>b)&&f.setValue("DateAcct",b)}c.close()}catch(k){return c!=null&&c.close(),this.log.log(i.SEVERE,p,e),this.setCalloutActive(!1),e.message}}return this.setCalloutActive(!1),r=u=f=o=s=h=null,""};nt.prototype.Rate=function(r,u,f,o,s,h){var a;if(s==null||s.toString()=="")return"";try{var v=t.getValueOfInt(f.getValue("C_Currency_ID")),y=t.getValueOfInt(v),p=t.getValueOfInt(f.getValue("C_ConversionType_ID")),w=t.getValueOfInt(p),l=f.getValue("DateAcct");l==null&&(a=new Date,l=a.toGMTString());var b=t.getValueOfInt(r.getContextAsInt(u,"C_AcctSchema_ID",!1)),k=b,d=n.dataContext.getJSONRecord("MAcctSchema/GetAcctSchema",k),g=t.getValueOfInt(r.getContextAsInt(u,"AD_Client_ID",!1)),nt=t.getValueOfInt(r.getContextAsInt(u,"AD_Org_ID",!1)),tt=y+","+d.C_Currency_ID+","+l+","+w+","+g+","+nt,c=n.dataContext.getJSONRecord("MConversionRate/GetRate",tt);this.log.fine("rate = "+c);c==null&&(c=0);f.setValue("CurrencyRate",c)}catch(it){return this.log.log(i.SEVERE,sql,e),this.setCalloutActive(!1),e.message}return r=u=f=o=s=h=null,""};nt.prototype.Amt=function(i,r,u,f,e,o){var h,c,l,a;if(e==null||e.toString()==""||this.isCalloutActive())return"";this.setCalloutActive(!0);var y=t.getValueOfInt(i.getContextAsInt(r,"C_AcctSchema_ID")),p=y.toString(),w=n.dataContext.getJSONRecord("MAcctSchema/GetAcctSchema",p),v=w.StdPrecision,s=u.getValue("CurrencyRate");return s==null&&(s=1,u.setValue("CurrencyRate",s)),h=u.getValue("AmtSourceDr"),h==null&&(h=0),c=u.getValue("AmtSourceCr"),c==null&&(c=0),l=h*s,l.toFixed(v),u.setValue("AmtAcctDr",l),a=c*s,a.toFixed(v),u.setValue("AmtAcctCr",a),this.setCalloutActive(!1),i=r=u=f=e=o=null,""};n.Model.CalloutGLJournal=nt;n.Utility.inheritPrototype(ri,n.CalloutEngine);ri.prototype.Product=function(n,i,r,u,f,e){if(f==null||f.toString()=="")return"";var o=f;return o==null||o==0?"":(n.getContextAsInt(i,"M_Product_ID")==o&&n.getContextAsInt(i,"M_AttributeSetInstance_ID")!=0?r.setValue("M_AttributeSetInstance_ID",t.getValueOfInt(n.getContextAsInt(i,"M_AttributeSetInstance_ID"))):r.setValue("M_AttributeSetInstance_ID",null),n=i=r=u=f=e=null,"")};n.Model.CalloutProduction=ri;n.Utility.inheritPrototype(tt,n.CalloutEngine);tt.prototype.CopyMail=function(r,u,f,e,o,s){var v=e.getColumnName(),c;if(this.log.info(v+"="+o),o==null||o.toString()=="")return"";var y=t.getValueOfInt(o),l="SELECT MailHeader, MailText FROM R_MailText WHERE R_MailText_ID=@Param1",a=[],h=null;try{a[0]=new n.DB.SqlParam("@Param1",t.getValueOfInt(y));h=n.DB.executeReader(l,a,null);h.read()&&(c=h.get("mailtext"),c=n.Env.parseContext(r,u,c,!1,!0),f.setValue("Result",c));h.close()}catch(p){this.setCalloutActive(!1);h!=null&&h.close();this.log.log(i.SEVERE,l,p)}return r=u=f=e=o=s=null,""};tt.prototype.CopyResponse=function(r,u,f,e,o,s){var v=e.getColumnName(),c;if(this.log.info(v+"="+o),o==null||o.toString()=="")return"";var y=t.getValueOfInt(o),l="SELECT Name, ResponseText FROM R_StandardResponse WHERE R_StandardResponse_ID=@Param1",a=[],h=null;try{a[0]=new n.DB.SqlParam("@Param1",t.getValueOfInt(y));h=n.DB.executeReader(l,a,null);h.read()&&(c=h.get("responsetext"),c=n.Env.parseContext(r,u,c,!1,!0),f.setValue("Result",c));h.close()}catch(p){this.setCalloutActive(!1);h!=null&&h.close();this.log.log(i.SEVERE,l,p)}return r=u=f=e=o=s=null,""};tt.prototype.Type=function(i,r,u,f,e,o){var l=f.getColumnName(),s,c,h;return(this.log.info(l+"="+e),u.setValue("R_Status_ID",null),e==null||e.toString()=="")?"":(s=t.getValueOfInt(e),s==0)?"":(c=s.toString(),h=n.dataContext.getJSONRecord("MRequestType/GetDefaultR_Status_ID",c),h!=0&&u.setValue("R_Status_ID",t.getValueOfInt(h)),i=r=u=f=e=o=null,"")};n.Model.CalloutRequest=tt;n.Utility.inheritPrototype(ct,n.CalloutEngine);ct.prototype.Product=function(i,r,u,f,e,o){var s,g,h,c,a;try{if(e==null||e.toString()==""||(s=e,s==null||s==0))return"";var v=i.getContextAsInt(r,"C_BPartner_ID"),y=u.getValue("Qty"),p=!1,w=i.getContextAsInt(r,"M_PriceList_ID"),b=i.getContextAsInt(r,"M_PriceList_Version_ID"),k=u.getValue("DateRequired"),c="SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='ED011_'",d=t.getValueOfInt(n.DB.executeScalar(c)),l;d>0?(g=n.dataContext.getJSONRecord("MProduct/GetC_UOM_ID",s),l=s.toString().concat(",",v,",",y,",",p,",",w,",",b,",",k,",",null,",",g,",",d)):l=s.toString().concat(",",v,",",y,",",p,",",w,",",b,",",k,",",null);h=null;h=n.dataContext.getJSONRecord("MProductPricing/GetProductPricing",l);u.setValue("PriceActual",h.PriceActual);i.setContext(r,"EnforcePriceLimit",h.EnforcePriceLimit?"Y":"N");i.setContext(r,"DiscountSchema",h.DiscountSchema?"Y":"N");c="SELECT C_OrderLine_ID FROM C_OrderLine WHERE C_Order_ID = (SELECT C_Order_ID  FROM C_Order  WHERE DocumentNo= (SELECT DocumentNo FROM M_Requisition WHERE M_Requisition.M_Requisition_id = "+u.getValue("M_Requisition_id")+") AND AD_Client_ID ="+i.getAD_Client_ID()+") AND M_Product_ID="+e;a=t.getValueOfInt(n.DB.executeScalar(c));a>0&&u.setValue("C_OrderLine_ID",a)}catch(nt){return this.setCalloutActive(!1),nt.message}return i=r=u=f=e=o=null,""};ct.prototype.Amt=function(i,r,u,f,e,o){var s;if(e==null||e.toString()==""||this.isCalloutActive()||e==null)return"";try{if(this.setCalloutActive(!0),f.getColumnName()=="Qty"&&"Y"==i.getContext("DiscountSchema")){var v=i.getContextAsInt(r,"M_Product_ID"),y=i.getContextAsInt(r,"C_BPartner_ID"),p=e,w=i.getContextAsInt(r,"M_PriceList_ID"),b=i.getContextAsInt(r,"M_PriceList_Version_ID"),k=u.getValue("DateInvoiced"),d=v.concat(",",y,",",p,",",!1,",",w,",",b,",",k,",",null),c=null;c=n.dataContext.getJSONRecord("MProductPricing/GetProductPricing",d);u.setValue("PriceActual",c.PriceActual)}var h=i.getStdPrecision(),l=u.getValue("Qty"),a=u.getValue("PriceActual");this.log.fine("amt - Qty="+l+", Price="+a+", Precision="+h);s=l*a;t.scale(s)>h&&(s=s.toFixed(h));u.setValue("LineNetAmt",s);this.log.info("amt - LineNetAmt="+s)}catch(g){this.setCalloutActive(!1);this.log.saveError("CalloutRequisation",g)}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};n.Model.CalloutRequisition=ct;n.Utility.inheritPrototype(lt,n.CalloutEngine);lt.prototype.PayAmt=function(n,i,r,u,f,e){var o,h,s;if(this.isCalloutActive()||f==null||f==""||(o=t.getValueOfInt(r.getValue("C_Invoice_ID")),o==null)||(h=o,h==0))return"";var c=t.getValueOfDecimal(r.getValue("OpenAmt")),l=t.getValueOfDecimal(r.getValue("PayAmt")),a=t.getValueOfDecimal(r.getValue("DiscountAmt"));return this.setCalloutActive(!0),s=c-l-a,this.log.fine(" - OpenAmt="+c+" - PayAmt="+l+", Discount="+a+", Difference="+s),r.setValue("DifferenceAmt",s),this.setCalloutActive(!1),n=i=r=u=f=e=null,""};lt.prototype.Invoice=function(r,u,f,e,o,s){var c,a,p;if(this.isCalloutActive()||o==null||o==""||(c=t.getValueOfInt(o),c==0))return"";a=r.getContextAsInt(u,"C_BankAccount_ID");p=r.getContext("PayDate");this.setCalloutActive(!0);var l=n.Env.ZERO,v=n.Env.ZERO,w="SELECT currencyConvert(invoiceOpen(i.C_Invoice_ID, 0), i.C_Currency_ID,ba.C_Currency_ID, i.DateInvoiced, i.C_ConversionType_ID, i.AD_Client_ID, i.AD_Org_ID) as OpenAmt, paymentTermDiscount(i.GrandTotal,i.C_Currency_ID,i.C_PaymentTerm_ID,i.DateInvoiced,'"+p+"') As DiscountAmt, i.IsSOTrx FROM C_Invoice_v i, C_BankAccount ba WHERE i.C_Invoice_ID=@Param2 AND ba.C_BankAccount_ID=@Param3",y=[],h=null;try{y[0]=new n.DB.SqlParam("@Param2",c);y[1]=new n.DB.SqlParam("@Param3",a);h=n.DB.executeReader(w,y,null);h.read()&&(l=h.get("openamt"),v=h.get("discountamt"),IsSOTrx="Y"==h.get("issotrx"));h.close()}catch(b){this.setCalloutActive(!1);h!=null&&h.close();this.log.log(i.SEVERE,w,b)}return this.log.fine(" - OpenAmt="+l+" (Invoice="+c+",BankAcct="+a+")"),f.setValue("OpenAmt",l),f.setValue("PayAmt",l-v),f.setValue("DiscountAmt",v),f.setValue("DifferenceAmt",n.Env.ZERO),f.setValue("IsSOTrx","N"),this.setCalloutActive(!1),r=u=f=e=o=s=null,""};n.Model.CalloutPaySelection=lt;n.Utility.inheritPrototype(it,n.CalloutEngine);it.prototype.EndDate=function(i,r,u,f,e,o){if(e==null||e.toString()=="")return"";var h=new Date(u.getValue("StartDate")),c=t.getValueOfInt(u.getValue("C_Frequency_ID")),l="Select NoOfMonths from C_Frequency where C_Frequency_ID="+c,v=t.getValueOfInt(n.DB.executeScalar(l,null,null)),a=t.getValueOfInt(u.getValue("NoofCycle")),s=h.getDate()+"/"+(h.getMonth()+months*a)+"/"+h.getFullYear();return s=s<=0?new Date:new Date(s),s=s.toISOString(),u.setValue("EndDate",s),i=r=u=f=e=o=null,""};it.prototype.Qty=function(n,i,r,u,f,e){if(f==null||f.toString()=="")return"";var s=t.getValueOfDecimal(f),h=t.getValueOfDecimal(r.getValue("QtyPerCycle")),o=s*h;return r.setValue("QtyEntered",o),r.setValue("QtyOrdered",o),n=i=r=u=f=e=null,""};it.prototype.QtyPerCycle=function(n,i,r,u,f,e){if(f==null||f.toString()=="")return"";var s=t.getValueOfDecimal(f),h=t.getValueOfDecimal(r.getValue("NoofCycle")),o=h*s;return r.setValue("QtyEntered",o),r.setValue("QtyOrdered",o),n=i=r=u=f=e=null,""};n.Model.CalloutOrderLine=it;n.Utility.inheritPrototype(ui,n.CalloutEngine);ui.prototype.Orderline=function(i,r,u,f,e,o){if(e==null||e.toString()==""||t.getValueOfInt(e)==0||this.isCalloutActive())return"";try{this.setCalloutActive(!0);var h=t.getValueOfInt(e),s=n.dataContext.getJSONRecord("MOrderLine/GetOrderLine",h);u.setValue("M_Product_ID",s.M_Product_ID);u.setValue("Qty",s.Qty);u.setValue("C_UOM_ID",s.C_UOM_ID);u.setValue("C_BPartner_ID",s.C_BPartner_ID);u.setValue("PlannedHours",s.PlannedHours);this.setCalloutActive(!1)}catch(c){this.setCalloutActive(!1)}return i=r=u=f=e=o=null,""};n.Model.CalloutOrderlineRecording=ui;n.Utility.inheritPrototype(fi,n.CalloutEngine);fi.prototype.Currency=function(i,r,u,f,e,o){var s,h;if(e==null||e.toString()=="")return"";s="";try{s="select C_Currency_id from m_pricelist where m_pricelist_ID = "+t.getValueOfInt(e);h=t.getValueOfInt(n.DB.executeScalar(s,null,null));u.setValue("C_Currency_ID",h)}catch(c){this.setCalloutActive(!1)}return i=r=u=f=e=o=null,""};n.Model.CalloutCurrency=fi;n.Utility.inheritPrototype(ei,n.CalloutEngine);ei.prototype.Qty=function(i,r,u,f,e,o){var v,y;if(this.isCalloutActive()||e==null||e.toString()=="")return"";var h=t.getValueOfDecimal(u.getValue("PriceActual")),c=t.getValueOfDecimal(e),l=0,a=n.Env.ZERO,s=n.Env.ZERO;return u.setValue("LineNetAmt",h*c),l=t.getValueOfInt(u.getValue("C_Tax_ID")),v="select rate from c_tax WHERE c_tax_id="+l+"",a=t.getValueOfDecimal(n.DB.executeScalar(v,null,null)),y=t.getValueOfDecimal(u.getValue("LineNetAmt")),s=t.getValueOfDecimal(t.getValueOfDecimal(y)*t.getValueOfDecimal(a)/100),s=s.toFixed(2),u.setValue("taxamt",s),u.setValue("GrandTotal",h*c+t.getValueOfDecimal(u.getValue("TaxAmt"))),i=r=u=f=e=o=null,""};n.Model.CalloutContractQty=ei;n.Utility.inheritPrototype(oi,n.CalloutEngine);oi.prototype.ContractProduct=function(n,i,r,u,f,e){if(f==null||f.toString()==""||t.getValueOfInt(f)==0)return"";var o=t.getValueOfInt(r.getValue("M_Proudct_ID"));return o!=0&&t.getValueOfBool(f)&&(r.setValue("PriceList",0),r.setValue("PriceLimit",0),r.setValue("PriceActual",0),r.setValue("PriceEntered",0)),n=i=r=u=f=e=null,""};n.Model.CalloutContractProduct=oi;n.Utility.inheritPrototype(v,n.CalloutEngine);v.prototype.InvoiceCount=function(i,r,u,f,e,o){if(e==null||e.toString()==""||t.getValueOfInt(e)==0)return"";var s=t.getValueOfDateTime(u.getValue("StartDate")),h=u.getValue("EndDate"),c=t.getValueOfInt(u.getValue("C_Frequency_ID")),l="Select NoOfDays from C_Frequency where C_Frequency_ID="+c,a=t.getValueOfInt(n.DB.executeScalar(l,null,null)),v=(h-s).Days,y=v/a;return u.setValue("TotalInvoice",y),i=r=u=f=e=o=null,""};v.prototype.EndDate=function(i,r,u,f,e,o){var s=new Date(u.getValue("StartDate")),c=t.getValueOfInt(u.getValue("C_Frequency_ID")),l="Select NoOfMonths from C_Frequency where C_Frequency_ID="+c,a=t.getValueOfInt(n.DB.executeScalar(l,null,null)),v=t.getValueOfInt(u.getValue("TotalInvoice")),h=s.getDate()+"/"+(s.getMonth()+a*v)+"/"+s.getFullYear();return u.setValue("EndDate",h),h=new Date(h),h=h.toISOString(),s=s.toISOString(),h<s&&u.setValue("EndDate",s),i=r=u=f=e=o=null,""};v.prototype.BillStartDate=function(t,i,r,u,f,e){if(f==null||f.toString()=="")return"";var o=new Date(r.getValue("StartDate")),s=new Date(r.getValue("BillStartDate"));return s.toISOString()<o.toISOString()&&(n.ADialog.info("StartDateShouldBeLessThanBillStartDate"),r.setValue("BillStartDate",r.getValue("StartDate"))),t=i=r=u=f=e=null,""};v.prototype.StartDate=function(i,r,u,f,e,o){if(e==null||e.toString()=="")return"";var h=new Date(u.getValue("StartDate")),c=t.getValueOfInt(u.getValue("C_Frequency_ID")),l="Select NoOfDays from C_Frequency where C_Frequency_ID="+c,a=t.getValueOfInt(n.DB.executeScalar(l,null,null)),v=t.getValueOfInt(u.getValue("TotalInvoice")),y=v*a,s=new Date(h.setDate(h.getDay()+t.getValueOfDouble(y)));return s=s.toISOString(),u.setValue("EndDate",s),i=r=u=f=e=o=null,""};v.prototype.StartDateChange=function(i,r,u,f,e,o){if(e==null||e.toString()=="")return"";var c=t.getValueOfInt(u.getValue("C_Frequency_ID")),l="Select NoOfMonths from C_Frequency where C_Frequency_ID="+c,a=t.getValueOfInt(n.DB.executeScalar(l,null,null)),v=t.getValueOfInt(u.getValue("TotalInvoice")),s=new Date(e),h=s.setDate(s.getMonth()+a*v);return h=new Date(s.setDate(s.getDay()-1)),u.setValue("EndDate",h.toISOString()),h<s&&u.setValue("EndDate",s),u.setValue("BillStartDate",u.getValue("StartDate")),i=r=u=f=e=o=null,""};n.Model.CalloutContract=v;n.Utility.inheritPrototype(at,n.CalloutEngine);at.prototype.product=function(n,t,i,r,u,f){return i.setValue("Help",i.getValue("Name")),n=t=i=r=u=f=null,""};at.prototype.product2=function(n,t,i,r,u,f){return i.setValue("Description",i.getValue("Help")),n=t=i=r=u=f=null,""};n.Model.copyname=at;n.Utility.inheritPrototype(si,n.CalloutEngine);si.prototype.IsInternal=function(i,r,u,f,e,o){if(e==null||e.toString()==""||this.isCalloutActive())return"";try{this.setCalloutActive(!0);var h="select ProfileType from S_Resource where AD_User_ID = "+t.getValueOfInt(e),s=t.getValueOfString(n.DB.executeScalar(h,null,null));s!=""&&(s.toUpper()=="I"?u.setValue("IsInternal",!0):s.toUpper()=="E"&&u.setValue("IsInternal",!1));this.setCalloutActive(!1)}catch(c){this.setCalloutActive(!1)}return i=r=u=f=e=o=null,""};n.Model.CalloutUserTimeRec=si;n.Utility.inheritPrototype(vt,n.CalloutEngine);vt.prototype.Product=function(r,u,f,o,s,h){var w=s,v,b,k,a,p;if(w==null||t.getValueOfInt(w)==0)return"";this.setCalloutActive(!0);var l=null,d=r.getContext(u,"DateExpense"),y=null,c=null;try{for(v=!0,y="SELECT bomPriceStd(p.M_Product_ID,pv.M_PriceList_Version_ID) AS PriceStd,bomPriceList(p.M_Product_ID,pv.M_PriceList_Version_ID) AS PriceList,bomPriceLimit(p.M_Product_ID,pv.M_PriceList_Version_ID) AS PriceLimit,p.C_UOM_ID,pv.ValidFrom,pl.C_Currency_ID FROM M_Product p, M_ProductPrice pp, M_PriceList pl, M_PriceList_Version pv WHERE p.M_Product_ID=pp.M_Product_ID AND pp.M_PriceList_Version_ID=pv.M_PriceList_Version_ID AND pv.M_PriceList_ID=pl.M_PriceList_ID AND pv.IsActive='Y' AND p.M_Product_ID=@param1 AND pl.M_PriceList_ID=@param2 ORDER BY pv.ValidFrom DESC",b=[],b[0]=new n.DB.SqlParam("@param1",t.getValueOfInt(w)),b[1]=new n.DB.SqlParam("@param2",r.getContextAsInt(u,"M_PriceList_ID")),c=n.DB.executeReader(y,b,null);c.read()&&v;)a=c.get("validfrom"),a!=null&&d<a||(v=!1,l=t.getValueOfDecimal(c.get("pricestd")),l==null&&(l=t.getValueOfDecimal(c.get("pricelist"))),l==null&&(l=t.getValueOfDecimal(c.get("pricelimit"))),p=t.getValueOfInt(c.get("c_currency_id")),c==null||f.setValue("C_Currency_ID",p));if(c.close(),v){for(y="SELECT bomPriceStd(p.M_Product_ID,pv.M_PriceList_Version_ID) AS PriceStd,bomPriceList(p.M_Product_ID,pv.M_PriceList_Version_ID) AS PriceList,bomPriceLimit(p.M_Product_ID,pv.M_PriceList_Version_ID) AS PriceLimit,p.C_UOM_ID,pv.ValidFrom,pl.C_Currency_ID FROM M_Product p, M_ProductPrice pp, M_PriceList pl, M_PriceList bpl, M_PriceList_Version pv WHERE p.M_Product_ID=pp.M_Product_ID AND pp.M_PriceList_Version_ID=pv.M_PriceList_Version_ID AND pv.M_PriceList_ID=bpl.M_PriceList_ID AND pv.IsActive='Y' AND bpl.M_PriceList_ID=pl.BasePriceList_ID AND p.M_Product_ID=@param1 AND pl.M_PriceList_ID=@param2 ORDER BY pv.ValidFrom DESC",k=[],k[0]=new n.DB.SqlParam("@param1",t.getValueOfInt(w)),k[1]=new n.DB.SqlParam("@param2",r.getContextAsInt(u,"M_PriceList_ID")),c=n.DB.executeReader(y,k,null);c.read()&&v;)a=c.get("validfrom"),a!=null&&d<a||(v=!1,l=t.getValueOfDecimal(c.get("pricestd")),l==null&&(l=t.getValueOfDecimal(c.get("pricelist"))),l==null&&(l=t.getValueOfDecimal(c.get("pricelimit"))),p=t.getValueOfInt(c.get("c_currency_id")),c==null||f.setValue("C_Currency_ID",p));c.close()}}catch(g){return c!=null&&c.close(),this.log.log(i.SEVERE,y,g),this.setCalloutActive(!1),e.message}return this.setCalloutActive(!1),l==null&&(l=n.Env.ZERO),f.setValue("ExpenseAmt",l),r=u=f=o=s=h=null,""};vt.prototype.Amount=function(i,r,u,f,e,o){var s;if(this.isCalloutActive())return"";this.setCalloutActive(!0);var c=u.getValue("ExpenseAmt"),h=u.getValue("C_Currency_ID"),l=i.getContextAsInt(r,"$C_Currency_ID"),p=i.getContext(r,"DateExpense");if(this.log.fine("Amt="+c+", C_Currency_ID="+h),s=c.toString(),!s.equals(n.Env.ZERO)&&l!=t.getValueOfInt(h)){var a=i.getContextAsInt(r,"AD_Client_ID"),v=i.getContextAsInt(r,"AD_Org_ID"),y=s.toString()+","+h.toString()+","+l.toString()+","+a.toString()+","+v.toString();s=n.dataContext.getJSONRecord("MConversionRate/Convert",y)}return u.setValue("ConvertedAmt",s),this.log.fine("= ConvertedAmt="+s),this.setCalloutActive(!1),i=r=u=f=e=o=null,""};n.Model.CalloutTimeExpense=vt;n.Utility.inheritPrototype(yt,n.CalloutEngine);yt.prototype.ProductInfo=function(i,r,u,f,e,o){var c,l,s,a,h;return e==null||e.toString()==""||t.getValueOfInt(e)==0?"":(c=e,c==null||c==0)?"":(l=i.getContextAsInt(r,"M_PriceList_ID"),l!=0?(s="Select M_PriceList_Version_ID from M_ProductPrice where M_Product_id="+t.getValueOfInt(e)+" and M_PriceList_Version_ID in (select m_pricelist_version_id from m_pricelist_version where m_pricelist_id = "+l+" and isactive='Y')",a=t.getValueOfInt(n.DB.executeScalar(s,null,null)),a!=0&&(s="Select PriceStd from M_ProductPrice where M_PriceList_Version_ID="+a+" and M_Product_id="+t.getValueOfInt(e),h=t.getValueOfDecimal(n.DB.executeScalar(s,null,null)),u.setValue("PriceStd",h),u.setValue("UnitPrice",h),u.setValue("PriceStd",h*t.getValueOfDecimal(u.getValue("QtyEntered"))))):n.ADialog.info("PriceLisetNotFound"),i=r=u=f=e=o=null,"")};yt.prototype.CalculatePrice=function(n,i,r,u,f,e){if(f==null||f.toString()==""||t.getValueOfInt(f)<=0)return"";var o=t.getValueOfDecimal(r.getValue("UnitPrice"))*t.getValueOfDecimal(r.getValue("QtyEntered"));return r.setValue("PriceStd",o),n=i=r=u=f=e=null,""};n.Model.CalloutTeamForcast=yt;n.Utility.inheritPrototype(pt,n.CalloutEngine);pt.prototype.TaxID=function(i,r,u,f,e,o){var c,h,s;if(e==null||e.toString()==""||t.getValueOfInt(e)==0||this.isCalloutActive())return"";try{this.setCalloutActive(!0);c="select Rate from C_Tax where C_Tax_ID = "+t.getValueOfInt(e);h=t.getValueOfDecimal(n.DB.executeScalar(c,null,null));h!=0?(s=t.getValueOfDecimal(u.getValue("ApprovedExpenseAmt"))*h/100,s=s.toFixed(2),u.setValue("TaxAmt",s)):u.setValue("TaxAmt",n.Env.ZERO);this.setCalloutActive(!1)}catch(l){this.setCalloutActive(!1)}return i=r=u=f=e=o=null,""};pt.prototype.ExpenseAmt=function(i,r,u,f,e,o){var c,h,s;if(e==null||e.toString()==""||t.getValueOfInt(e)==0||this.isCalloutActive())return"";try{this.setCalloutActive(!0);c="select Rate from C_Tax where C_Tax_ID = "+t.getValueOfInt(u.getValue("C_Tax_ID"));h=t.getValueOfDecimal(n.DB.executeScalar(c,null,null));h!=0?(s=t.getValueOfDecimal(e)*h/100,s=s.toFixed(2),u.setValue("TaxAmt",s)):u.setValue("TaxAmt",n.Env.ZERO);this.setCalloutActive(!1)}catch(l){this.setCalloutActive(!1)}return i=r=u=f=e=o=null,""};n.Model.CalloutTaxAmt=pt;n.Utility.inheritPrototype(hi,n.CalloutEngine);hi.prototype.Tax=function(i,r,u,f,e,o){var a,h;if(e==null||e.toString()=="")return"";var c=0,l=n.Env.ZERO,s=n.Env.ZERO;return c=t.getValueOfInt(u.getValue("C_Tax_ID")),a="select rate from c_tax WHERE c_tax_id="+c+"",l=t.getValueOfDecimal(n.DB.executeScalar(a,null,null)),h=t.getValueOfDecimal(u.getValue("LineNetAmt")),s=t.getValueOfDecimal(t.getValueOfDecimal(h)*t.getValueOfDecimal(l)/100),s=s.toFixed(2),u.setValue("GrandTotal",s+h),u.setValue("taxamt",s),i=r=u=f=e=o=null,""};n.Model.CalloutTax=hi;n.Utility.inheritPrototype(ci,n.CalloutEngine);ci.prototype.SetBP=function(n,i,r,u,f,e){if(f==null||f.toString()==""||t.getValueOfInt(f)==0||this.isCalloutActive())return"";try{this.setCalloutActive(!0);r.setValue("C_BPartner_ID",t.getValueOfInt(f));this.setCalloutActive(!1)}catch(o){this.setCalloutActive(!1)}return n=i=r=u=f=e=null,""};n.Model.CalloutSetBP=ci;n.Utility.inheritPrototype(li,n.CalloutEngine);li.prototype.Charge=function(t,i,r,u,f,e){if(f==null||f.toString()=="")return"";var o=r.getValue("C_Charge_ID").toString(),s=n.dataContext.getJSONRecord("MCharge/GetCharge",o);return r.setValue("PlannedQty",1),r.setValue("PlannedPrice",s),t=i=r=u=f=e=null,""};n.Model.CalloutProjectLine=li;n.Utility.inheritPrototype(ai,n.CalloutEngine);ai.prototype.ProductInfo=function(i,r,u,f,e,o){var c,w,y;if(e==null||e.toString()=="")return"";var p=t.getValueOfInt(u.getValue("C_ProjectTask_ID")),l="select c_project_id from C_ProjectPhase where C_ProjectPhase_id in(select C_ProjectPhase_id from C_ProjectTask where C_ProjectTask_id="+p+")",h=t.getValueOfInt(n.DB.executeScalar(l,null,null));p==0&&(l="select c_project_id from C_ProjectPhase where C_ProjectPhase_id in("+u.getValue("C_ProjectPhase_ID")+" )",h=t.getValueOfInt(n.DB.executeScalar(l,null,null)),h==0&&(h=t.getValueOfInt(u.getValue("C_Project_ID"))));var b=h.toString(),k=n.dataContext.getJSONRecord("MProject/GetProjectDetail",b),a=t.getValueOfInt(k.M_PriceList_Version_ID),s="Select PriceList from M_ProductPrice where M_PriceList_Version_ID="+a+" and M_Product_id="+t.getValueOfInt(e),v=t.getValueOfDecimal(n.DB.executeScalar(s,null,null));u.setValue("PriceList",v);s="Select PriceStd from M_ProductPrice where M_PriceList_Version_ID="+a+" and M_Product_id="+t.getValueOfInt(e);c=t.getValueOfDecimal(n.DB.executeScalar(s,null,null));u.setValue("PlannedPrice",c);u.setValue("PlannedQty",1);s="Select PriceLimit from M_ProductPrice where M_PriceList_Version_ID="+a+" and M_Product_id="+t.getValueOfInt(e);w=t.getValueOfDecimal(n.DB.executeScalar(s,null,null));try{if(y=(v-c)*100/v,isNaN(y))return this.setCalloutActive(!1),"PriceListNotSelected"}catch(d){return this.setCalloutActive(!1),"PriceListNotSelected"}return u.setValue("Discount",y.toFixed(2)),u.setValue("PlannedMarginAmt",c-w),i=r=u=f=e=o=null,""};n.Model.CalloutProductToOpportunity=ai;n.Utility.inheritPrototype(vi,n.CalloutEngine);vi.prototype.PriceList=function(i,r,u,f,e,o){var s,h,c;if(e==null||e.toString()=="")return"";s="";try{s="select M_PriceList_ID from M_PriceList_Version where M_PriceList_Version_ID = "+t.getValueOfInt(e);h=t.getValueOfInt(n.DB.executeScalar(s,null,null));h!=0&&(u.setValue("M_PriceList_ID",h),s="select C_Currency_id from m_pricelist where m_pricelist_ID = "+h,c=t.getValueOfInt(n.DB.executeScalar(s,null,null)),c!=0?u.setValue("C_Currency_ID",c):n.ADialog.info("CurrencyNotDefinedForThePriceList"))}catch(l){this.setCalloutActive(!1);this.log.saveError(s,s)}return i=r=u=f=e=o=null,""};n.Model.CalloutPriceListOpp=vi;n.Utility.inheritPrototype(s,n.CalloutEngine);s.prototype.Order=function(i,r,u,f,e,o){var h,c,s,l;if(e==null||e.toString()=="")return"";try{if((h=t.getValueOfInt(e.toString()),h==null||h==0)||this.isCalloutActive())return"";c=h.toString();s=n.dataContext.getJSONRecord("MOrder/GetOrder",c);t.getValueOfInt(s.ID)!=0&&(u.setValue("DateOrdered",s.DateOrdered),u.setValue("POReference",s.POReference),u.setValue("AD_Org_ID",t.getValueOfInt(s.AD_Org_ID)),u.setValue("DeliveryRule",s.DeliveryRule),u.setValue("DeliveryViaRule",s.DeliveryViaRule),u.setValue("M_Shipper_ID",t.getValueOfInt(s.M_Shipper_ID)),u.setValue("FreightCostRule",s.FreightCostRule),u.setValue("FreightAmt",s.FreightAmt),u.setValue("C_BPartner_ID",t.getValueOfInt(s.C_BPartner_ID)),u.setValue("C_BPartner_Location_ID",t.getValueOfInt(s.C_BPartner_Location_ID)),u.setValue("AD_OrgTrx_ID",t.getValueOfInt(s.AD_OrgTrx_ID)),u.setValue("C_Activity_ID",t.getValueOfInt(s.C_Activity_ID)),u.setValue("C_Campaign_ID",t.getValueOfInt(s.C_Campaign_ID)),u.setValue("C_Project_ID",t.getValueOfInt(s.C_Project_ID)),u.setValue("User1_ID",t.getValueOfInt(s.User1_ID)),u.setValue("User2_ID",t.getValueOfInt(s.User2_ID)),u.setValue("M_Warehouse_ID",t.getValueOfInt(s.M_Warehouse_ID)),l=u.getValue("IsReturnTrx"),l&&(u.setValue("Orig_Order_ID",s.Orig_Order_ID),u.setValue("Orig_InOut_ID",s.Orig_InOut_ID)))}catch(a){this.setCalloutActive(!1);this.log.severe(a.toString())}return i=r=u=f=e=o=null,""};s.prototype.DocType=function(r,u,f,e,o,s){var c,v,h,l,a;if(o==null||o.toString()==""||(c=t.getValueOfInt(o.toString()),c==null||c==0))return"";v="SELECT d.docBaseType, d.IsDocNoControlled, s.CurrentNext, d.IsReturnTrx FROM C_DocType d, AD_Sequence s WHERE C_DocType_ID="+c+" AND d.DocNoSequence_ID=s.AD_Sequence_ID(+)";h=null;try{r.setContext(u,"C_DocTypeTarget_ID",c);h=n.DB.executeReader(v,null,null);h.read()&&(l=h.get("docbasetype"),a=h.get("isreturntrx")=="Y",l.equals("MMS")&&!a?f.setValue("MovementType","C-"):l.equals("MMS")&&a?f.setValue("MovementType","C+"):l.equals("MMR")&&!a?f.setValue("MovementType","V+"):l.equals("MMR")&&a&&f.setValue("MovementType","V-"),h.get("isdocnocontrolled")=="Y"&&f.setValue("DocumentNo","<"+h.get("currentnext")+">"));h.close()}catch(y){return this.setCalloutActive(!1),h!=null&&(h.close(),h=null),this.log.log(i.SEVERE,v,y),y.message}return r=u=f=e=o=s=null,""};s.prototype.BPartner=function(r,u,f,o,s,h){var v="",c=null,a,y,p,l,w;if(s==null||s.toString()=="")return"";try{if(a=t.getValueOfInt(s.toString()),a==null||a==0)return"";y=f.getValue("IsReturnTrx");p=f.getValue("C_Order_ID");v="SELECT p.AD_Language, p.POReference,SO_CreditLimit, p.SO_CreditLimit-p.SO_CreditUsed AS CreditAvailable,l.C_BPartner_Location_ID, c.AD_User_ID , p.SOCreditStatus FROM C_BPartner p LEFT OUTER JOIN C_BPartner_Location l ON (p.C_BPartner_ID=l.C_BPartner_ID) LEFT OUTER JOIN AD_User c ON (p.C_BPartner_ID=c.C_BPartner_ID) WHERE p.C_BPartner_ID="+a;c=n.DB.executeReader(v,null,null);c.read()&&(l=t.getValueOfInt(c.get("c_bpartner_location_id")),p==null&&(l==0?f.setValue("C_BPartner_Location_ID",null):f.setValue("C_BPartner_Location_ID",l)),l=t.getValueOfInt(c.get("ad_user_id")),l==0?f.setValue("AD_User_ID",null):f.setValue("AD_User_ID",l),y||(w=t.getValueOfDouble(c.get("creditavailable")),c.get("socreditStatus").equals("X")||w<0&&n.ADialog.info("CreditLimitOver")));c.close()}catch(b){return this.setCalloutActive(!1),c!=null&&(c.close(),c=null),this.log.log(i.SEVERE,v,e),e.message}return r=u=f=o=s=h=null,""};s.prototype.Warehouse=function(r,u,f,e,o,s){var l,a,h,c,v;if(o==null||o.toString()==""||this.isCalloutActive()||(l=t.getValueOfInt(o),l==null||l==0))return"";this.setCalloutActive(!0);a="SELECT w.AD_Org_ID, l.M_Locator_ID FROM M_Warehouse w LEFT OUTER JOIN M_Locator l ON (l.M_Warehouse_ID=w.M_Warehouse_ID AND l.IsDefault='Y') WHERE w.M_Warehouse_ID="+l;h=null;try{h=n.DB.executeReader(a,null,null);h.read()&&(c=t.getValueOfInt(h.get("ad_org_id")),v=r.getContextAsInt(u,"AD_Org_ID"),v!=c&&f.setValue("AD_Org_ID",c),c=t.getValueOfInt(h.get("m_locator_id")),c==0?r.setContext(u,0,"M_Locator_ID",null):(this.log.config("M_Locator_ID="+c),r.setContext(u,"M_Locator_ID",c)));h.close()}catch(y){return this.setCalloutActive(!1),h!=null&&(h.close(),h=null),this.log.log(i.SEVERE,a,y),this.setCalloutActive(!1),y.message}return this.setCalloutActive(!1),r=u=f=e=o=s=null,""};s.prototype.OrderLine=function(i,r,u,f,e,o){var c,s,a,l,h,v;if(e==null||e.toString()=="")return"";if(this.setCalloutActive(!0),c=t.getValueOfInt(e.toString()),c==null||c==0)return this.setCalloutActive(!1),"";try{h=c.toString();s=n.dataContext.getJSONRecord("MOrderLine/GetOrderLine",h);t.getValueOfInt(s.GetID)!=0&&(u.setValue("M_Product_ID",t.getValueOfInt(s.M_Product_ID)),u.setValue("M_AttributeSetInstance_ID",t.getValueOfInt(s.M_AttributeSetInstance_ID)),u.setValue("C_UOM_ID",t.getValueOfInt(s.C_UOM_ID)),a=t.getValueOfDecimal(s.QtyOrdered)-t.getValueOfDecimal(s.QtyDelivered),u.setValue("MovementQty",a),l=a,t.getValueOfDecimal(s.QtyEntered).toString().compareTo(t.getValueOfDecimal(s.QtyOrdered))!=t.getValueOfDecimal(s.QtyOrdered)&&(l=l*t.getValueOfDecimal(s.QtyEntered)/t.getValueOfDecimal(s.QtyOrdered).toFixed(12)),u.setValue("QtyEntered",l),u.setValue("C_Activity_ID",t.getValueOfInt(s.C_Activity_ID)),u.setValue("C_Campaign_ID",t.getValueOfInt(s.C_Campaign_ID)),u.setValue("C_Project_ID",t.getValueOfInt(s.C_Project_ID)),u.setValue("C_ProjectPhase_ID",t.getValueOfInt(s.C_ProjectPhase_ID)),u.setValue("C_ProjectTask_ID",t.getValueOfInt(s.C_ProjectTask_ID)),u.setValue("AD_OrgTrx_ID",t.getValueOfInt(s.AD_OrgTrx_ID)),u.setValue("User1_ID",t.getValueOfInt(s.User1_ID)),u.setValue("User2_ID",t.getValueOfInt(s.User2_ID)),t.getValueOfBoolean(s.IsReturnTrx)&&(u.setValue("Orig_OrderLine_ID",t.getValueOfInt(s.Orig_OrderLine_ID)),h=s.Orig_InOutLine_ID,v=n.dataContext.getJSONRecord("MInOutLine/GetMInOutLine",h),u.setValue("M_Locator_ID",v.M_Locator_ID)))}catch(y){this.setCalloutActive(!1);this.log.severe(y.toString())}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};s.prototype.Product=function(i,r,u,f,e,o){var s,d,v,y,h,p,l,w;if(this.isCalloutActive()||e==null||e.toString()==""||(s=t.getValueOfInt(e),s==0))return"";this.setCalloutActive(!0);try{if(d=0,i.getContextAsInt(r,"M_Product_ID")==s&&i.getContextAsInt(r,"M_AttributeSetInstance_ID")!=0?u.setValue("M_AttributeSetInstance_ID",t.getValueOfInt(i.getContextAsInt(r,"M_AttributeSetInstance_ID").toString())):u.setValue("M_AttributeSetInstance_ID",null),v=i.getWindowContext(r,"IsSOTrx",!0)=="Y",v)return this.setCalloutActive(!1),"";y=s.toString();h=n.dataContext.getJSONRecord("MProduct/GetC_UOM_ID",y);u.setValue("C_UOM_ID",h);p=t.getValueOfDecimal(u.getValue("QtyEntered"));u.setValue("MovementQty",p);var g="SELECT C_BPartner_ID FROM M_InOut WHERE M_InOut_ID = "+t.getValueOfInt(u.getValue("M_InOut_ID")),nt=t.getValueOfInt(n.DB.executeScalar(g)),tt="SELECT vdr.C_UOM_ID FROM M_Product p LEFT JOIN M_Product_Po vdr ON p.M_Product_ID= vdr.M_Product_ID WHERE p.M_Product_ID="+s+" AND vdr.C_BPartner_ID = "+nt,c=t.getValueOfInt(n.DB.executeScalar(tt));if(h!=0&&(h!=c&&c!=0?(l=t.getValueOfDecimal(n.DB.executeScalar("SELECT trunc(multiplyrate,4) FROM C_UOM_Conversion WHERE C_UOM_ID = "+h+" AND C_UOM_To_ID = "+c+" AND M_Product_ID= "+s+" AND IsActive='Y'")),l>0?u.setValue("QtyEntered",t.getValueOfInt(u.getValue("QtyEntered"))*l):(w=t.getValueOfDecimal(n.DB.executeScalar("SELECT trunc(multiplyrate,4) FROM C_UOM_Conversion WHERE C_UOM_ID = "+h+" AND C_UOM_To_ID = "+c+" AND IsActive='Y'")),w>0&&u.setValue("QtyEntered",t.getValueOfInt(u.getValue("QtyEntered"))*l)),u.setValue("C_UOM_ID",c)):u.setValue("C_UOM_ID",h)),window.BTR002&&v){for(var b=0,k=0,it=i.getContextAsInt(r,"M_Warehouse_ID"),rt="SELECT loc.M_Warehouse_ID FROM M_Product p INNER JOIN M_Locator loc ON p.M_Locator_ID= loc.M_Locator_ID WHERE p.M_Product_ID="+s,a=n.DB.executeReader(rt);a.read();)b=t.getValueOfInt(a.get("m_warehouse_id")),k=t.getValueOfInt(a.get("m_locator_id"));a.close();it==b&&u.setValue("M_Locator_ID",k)}}catch(ut){this.setCalloutActive(!1);this.log.severe(ut.toString())}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};s.prototype.Qty=function(r,u,f,e,o,s){var y,c,h,p,a,b,v,nt,tt,k,d,l;if(this.isCalloutActive()||o==null||o.toString()=="")return"";this.setCalloutActive(!0);try{if(y=r.getContextAsInt(u,"M_Product_ID"),this.log.log(i.WARNING,"qty - init - M_Product_ID="+y),y==0)h=t.getValueOfDecimal(f.getValue("QtyEntered")),f.setValue("MovementQty",h);else if(e.getColumnName().toString().equals("C_UOM_ID")){l=o;h=t.getValueOfDecimal(f.getValue("QtyEntered"));var a=l.toString(),w=n.dataContext.getJSONRecord("MUOM/GetPrecision",a),p=h.toFixed(w);h.toString().compareTo(p)!=0&&(this.log.fine("Corrected qtyEntered Scale UOM="+l+"; qtyEntered="+h+"->"+p),h=p,f.setValue("QtyEntered",h));a=y.toString().concat(",",l.toString(),",",h.toString());c=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a);c==null&&(c=h);v=h.compareTo(c)!=0;this.log.fine("UOM="+l+", qtyEntered="+h+" -> "+v+" movementQty="+c);r.setContext(u,"UOMConversion",v?"Y":"N");f.setValue("MovementQty",c)}else r.getContextAsInt(u,"C_UOM_ID")==0?(h=t.getValueOfDecimal(f.getValue("QtyEntered")),f.setValue("MovementQty",h)):e.getColumnName().toString().equals("QtyEntered")?(l=r.getContextAsInt(u,"C_UOM_ID"),h=t.getValueOfDecimal(o),p=h.toPrecision(w),h.compareTo(p)!=0&&(this.log.fine("Corrected qtyEntered Scale UOM="+l+"; qtyEntered="+h+"->"+p),h=p,f.setValue("QtyEntered",h)),a=y.toString().concat(",",l.toString(),",",h.toString()),c=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a),c==null&&(c=h),v=h.compareTo(c)!=0,this.log.fine("UOM="+l+", qtyEntered="+h+" -> "+v+" movementQty="+c),r.setContext(u,"UOMConversion",v?"Y":"N"),f.setValue("MovementQty",c)):e.getColumnName().toString().equals("MovementQty")&&(l=r.getContextAsInt(u,"C_UOM_ID"),c=t.getValueOfDecimal(o),a=y.toString(),w=n.dataContext.getJSONRecord("MProduct/GetUOMPrecision",a),b=c.toPrecision(w),c.compareTo(b)!=0&&(this.log.fine("Corrected movementQty "+c+"->"+b),c=b,f.setValue("MovementQty",c)),a=y.toString().concat(",",l.toString(),",",c.toString()),h=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo",a),h==null&&(h=c),v=c.compareTo(h)!=0,this.log.fine("UOM="+l+", movementQty="+c+" -> "+v+" qtyEntered="+h),r.setContext(u,"UOMConversion",v?"Y":"N"),f.setValue("QtyEntered",h));if(nt="Y".equals(r.getContext("IsReturnTrx")),y!=0&&nt&&(tt=t.getValueOfInt(f.getValue("C_OrderLine_ID")),a=tt.toString(),k=n.dataContext.getJSONRecord("MOrderLine/GetOrderLine",a),k.Get_ID()!=0&&(d=k.tOrig_InOutLine_ID,d!=0))){var a=d.toString(),it=n.dataContext.getJSONRecord("MInOutLine/GetMInOutLine",a),g=it.MovementQty;c=t.getValueOfDecimal(f.getValue("MovementQty"));g.toString().compareTo(c)<0&&(r.getWindowContext(u,"IsSOTrx",!0)=="Y"?n.ADialog.info("QtyShippedAndReturned"):n.ADialog.info("QtyRecievedAndReturnd"),f.setValue("MovementQty",g),c=g,l=r.getContextAsInt(u,"C_UOM_ID"),a=y.toString().concat(",",l.toString(),",",c.toString()),h=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo",a),h==null&&(h=c),f.setValue("QtyEntered",h),f.setValue("MovementQty",c),this.log.fine("qtyEntered : "+h.toString()+"movementQty : "+c.toString()))}}catch(rt){this.setCalloutActive(!1);this.log.severe(rt.toString())}return this.setCalloutActive(!1),r=u=f=e=o=s=null,""};s.prototype.Asi=function(n,i,r,u,f,e){var o,h,s;if(this.isCalloutActive()||f==null||f.toString()==""||(o=t.getValueOfInt(f),o==null||o==0))return"";this.setCalloutActive(!0);try{var c=n.getContextAsInt(i,"M_Product_ID"),l=n.getContextAsInt(i,"M_Warehouse_ID"),a=n.getContextAsInt(i,"M_Locator_ID");this.log.fine("M_Product_ID="+c+", M_ASI_ID="+o+" - M_Warehouse_ID="+l+", M_Locator_ID="+a);h=n.getContextAsInt(i,"M_AttributeSetInstance_ID");o==h&&(s=n.getContextAsInt(i,"M_Locator_ID"),s!=0&&(this.log.fine("Selected M_Locator_ID="+s),r.setValue("M_Locator_ID",s)))}catch(v){this.setCalloutActive(!1);this.log.severe(ex.toString())}return this.setCalloutActive(!1),n=i=r=u=f=e=null,""};n.Model.CalloutInOut=s;n.Utility.inheritPrototype(wt,n.CalloutEngine);wt.prototype.Invoice=function(r,u,f,e,o,s){var c,y,l,a;if(o==null||o.toString()==""||(c=t.getValueOfInt(o),this.isCalloutActive()||c==null||c==0))return"";var b=r.getContextAsInt(u,"C_Payment_ID"),k=b.toString(),v=null;if(v=n.dataContext.getJSONRecord("MPayment/GetPayment",k),v.C_Charge_ID!=0||v.C_Invoice_ID!=0||v.C_Order_ID!=0)return n.Msg.getMsg("PaymentIsAllocated");this.setCalloutActive(!0);f.setValue("DiscountAmt",n.Env.ZERO);f.setValue("WriteOffAmt",n.Env.ZERO);f.setValue("OverUnderAmt",n.Env.ZERO);y=0;r.getContextAsInt(u,"C_Invoice_ID")==c&&r.getContextAsInt(u,"C_InvoicePaySchedule_ID")!=0&&(y=r.getContextAsInt(u,"C_InvoicePaySchedule_ID"));var d=t.getValueOfDate(r.getContextAsTime(u,"DateTrx")),p="SELECT C_BPartner_ID,C_Currency_ID, invoiceOpen(C_Invoice_ID, "+y+") as invoiceOpen , invoiceDiscount(C_Invoice_ID,"+n.DB.to_date(d,!0)+","+y+") as invoiceDiscount , IsSOTrx FROM C_Invoice WHERE C_Invoice_ID="+c,h=null;try{h=n.DB.executeReader(p,null,null);h.read()&&(l=h.get("invoiceopen"),l==null&&(l=n.Env.ZERO),a=h.get("invoicediscount"),a==null&&(a=n.Env.ZERO),f.setValue("InvoiceAmt",l),f.setValue("Amount",l-a),f.setValue("DiscountAmt",a),r.setContext(u,"C_Invoice_ID",c.toString()),f.setValue("C_Invoice_ID",c));h.close()}catch(w){return h!=null&&(h.close(),h=null),this.log.log(i.SEVERE,p,w),this.setCalloutActive(!1),w.message}return this.setCalloutActive(!1),r=u=f=e=o=s=null,""};wt.prototype.Amounts=function(n,i,r,u,f,e){var a,v;if(this.isCalloutActive()||(a=n.getContextAsInt(i,"C_Invoice_ID"),a==0))return"";this.setCalloutActive(!0);var o=t.getValueOfDecimal(r.getValue("Amount")),h=t.getValueOfDecimal(r.getValue("DiscountAmt")),s=t.getValueOfDecimal(r.getValue("WriteOffAmt")),c=t.getValueOfDecimal(r.getValue("OverUnderAmt")),l=t.getValueOfDecimal(r.getValue("InvoiceAmt"));return log.fine("Amt="+o+", Discount="+h+", WriteOff="+s+", OverUnder="+c+", Invoice="+l),v=u.getColumnName(),v=="Amount"?(s=l-o-h-c,r.setValue("WriteOffAmt",s)):(o=l-h-s-c,r.setValue("Amount",o)),this.setCalloutActive(!1),n=i=r=u=f=e=null,""};n.Model.CalloutPaymentAllocate=wt;n.Utility.inheritPrototype(y,n.CalloutEngine);y.prototype.Invoice=function(r,u,f,o,s){var c,a,it,tt,w,p;if(s==null||s.toString()==""||(c=t.getValueOfInt(s.toString()),this.isCalloutActive()||c==null||c==0))return"";this.setCalloutActive(!0);f.setValue("C_Order_ID",null);f.setValue("C_Charge_ID",null);f.setValue("IsPrepayment",!1);f.setValue("DiscountAmt",n.Env.ZERO);f.setValue("WriteOffAmt",n.Env.ZERO);f.setValue("IsOverUnderPayment",!1);f.setValue("OverUnderAmt",n.Env.ZERO);var v=0,k=0,d=0,g="SELECT * FROM   (SELECT ips.C_InvoicePaySchedule_ID,  ips.DueAmt  FROM C_Invoice i  INNER JOIN C_InvoicePaySchedule ips  ON (i.C_Invoice_ID        =ips.C_Invoice_ID)  WHERE i.IsPayScheduleValid='Y'  AND ips.IsValid           ='Y'  AND ips.isactive          ='Y'  AND i.C_Invoice_ID    = "+c+"  AND ips.C_InvoicePaySchedule_ID NOT IN(SELECT NVL(C_InvoicePaySchedule_ID,0) FROM C_InvoicePaySchedule WHERE c_payment_id IN(SELECT NVL(c_payment_id,0) FROM C_InvoicePaySchedule) union  SELECT NVL(C_InvoicePaySchedule_id,0) FROM C_InvoicePaySchedule  WHERE c_cashline_id IN(SELECT NVL(c_cashline_id,0) FROM C_InvoicePaySchedule ))  ORDER BY ips.duedate ASC  ) WHERE rownum=1",l=null;try{l=n.DB.executeReader(g,null,null);l.read()&&(v=t.getValueOfInt(l.get("c_invoicepayschedule_id")),k=t.getValueOfDecimal(l.get("dueamt")),f.setValue("C_InvoicePaySchedule_ID",v),f.setValue("PayAmt",k),d=1);l.close()}catch(b){return l!=null&&l.close(),this.log.log(i.SEVERE,g,e),b.toString()}r.getContextAsInt(u,"C_Invoice_ID")==c&&r.getContextAsInt(u,"C_InvoicePaySchedule_ID")!=0&&(v=r.getContextAsInt(u,"C_InvoicePaySchedule_ID"));a=new Date(f.getValue("DateTrx"));a==null&&(a=new Date);it="TO_DATE( '"+a.getMonth()+"-"+a.getDate()+"-"+a.getFullYear()+"', 'MM-DD-YYYY')";var nt="SELECT C_BPartner_ID,C_Currency_ID, invoiceOpen(C_Invoice_ID, @param1) as invoiceOpen , invoiceDiscount(C_Invoice_ID,@param2,@param3) as invoiceDiscount, IsSOTrx FROM C_Invoice WHERE C_Invoice_ID=@param4",h=null,y=[];try{y[0]=new n.DB.SqlParam("@param1",v);y[1]=new n.DB.SqlParam("@param2",a);y[1].setIsDate(!0);y[2]=new n.DB.SqlParam("@param3",v);y[3]=new n.DB.SqlParam("@param4",c);h=n.DB.executeReader(nt,y,null);h.read()&&(f.setValue("C_BPartner_ID",t.getValueOfInt(h.get("c_bpartner_id"))),tt=t.getValueOfInt(h.get("c_currency_id")),f.setValue("C_Currency_ID",tt),w=t.getValueOfDecimal(h.get("invoiceopen")),w==null&&(w=n.Env.ZERO),p=t.getValueOfDecimal(h.get("invoicediscount")),p==null&&(p=n.Env.ZERO),d==0&&f.setValue("PayAmt",w-p),f.setValue("C_InvoicePaySchedule_ID",v),f.setValue("DiscountAmt",p),r.setContext(u,"C_Invoice_ID",c.toString()));h.close()}catch(b){return h!=null&&(h.close(),h=null),this.log.log(i.SEVERE,nt,b),this.setCalloutActive(!1),b.message}return this.setCalloutActive(!1),this.DocType(r,u,f,o,s)};y.prototype.Order=function(r,u,f,e,o){var h,l,y,c;if(o==null||o.toString()==""||(h=o,this.isCalloutActive()||h==null||h==0))return"";this.setCalloutActive(!0);f.setValue("C_Invoice_ID",null);f.setValue("C_Charge_ID",null);f.setValue("IsPrepayment",!0);f.setValue("DiscountAmt",n.Env.ZERO);f.setValue("WriteOffAmt",n.Env.ZERO);f.setValue("IsOverUnderPayment",!1);f.setValue("OverUnderAmt",n.Env.ZERO);l=f.getValue("DateTrx");l==null&&(l=new Date);var a="SELECT C_BPartner_ID,C_Currency_ID, GrandTotal FROM C_Order WHERE C_Order_ID=@param1",s=null,v=[];try{v[0]=new n.DB.SqlParam("@param1",h);s=n.DB.executeReader(a,v,null);s.read()&&(f.setValue("C_BPartner_ID",t.getValueOfInt(s.get("c_bpartner_id"))),y=t.getValueOfInt(s.get("c_currency_id")),f.setValue("C_Currency_ID",y),c=t.getValueOfDecimal(s.get("grandtotal")),c==null&&(c=n.Env.ZERO),f.setValue("PayAmt",c));s.close()}catch(p){return s!=null&&(s.close(),s=null),this.log.log(i.SEVERE,a,p),this.setCalloutActive(!1),p.message}return this.setCalloutActive(!1),this.DocType(r,u,f,e,o)};y.prototype.Charge=function(t,i,r,u,f){if(f==null||f.toString()=="")return""};y.prototype.DocType=function(i,r,u,f,e,o){var s=i.getContextAsInt(r,"C_Invoice_ID"),y=i.getContextAsInt(r,"C_Order_ID"),h=i.getContextAsInt(r,"C_DocType_ID"),v;this.log.fine("Payment_DocType - C_Invoice_ID="+s+", C_DocType_ID="+h);var c=h.toString(),a=n.dataContext.getJSONRecord("MDocType/GetDocType",c),l=t.getValueOfBoolean(a.IsSOTrx);return(h!=0&&i.setContext("IsSOTrx",l?"Y":"N"),s!=0&&(c=s.toString(),v=n.dataContext.getJSONRecord("MInvoice/GetInvoice",c),a!=null&&t.getValueOfBoolean(v.IsSOTrx)!=l))?"PaymentDocTypeInvoiceInconsistent":y!=0&&!l?"PaymentDocTypeInvoiceInconsistent":(i=r=u=f=e=o=null,"")};y.prototype.Amounts=function(r,u,f,e,o,s){var p,ut,k,it,rt,ct;if(this.isCalloutActive()||(p=r.getContextAsInt(u,"C_Invoice_ID"),r.getContextAsInt(u,"C_Payment_ID")==0&&r.getContextAsInt(u,"C_BPartner_ID")==0&&p==0)||(ut=f.getValue("C_Currency_ID"),ut==null))return"";this.setCalloutActive(!0);k=e.getColumnName();it=0;r.getContextAsInt(u,"C_Invoice_ID")==p&&r.getContextAsInt(u,"C_InvoicePaySchedule_ID")!=0&&(it=r.getContextAsInt(u,"C_InvoicePaySchedule_ID"));var l=n.Env.ZERO,h=n.Env.ZERO,w=0;if(p!=0){rt=f.getValue("DateTrx");rt==null&&(rt=new Date);var et="SELECT C_BPartner_ID,C_Currency_ID, invoiceOpen(C_Invoice_ID, @param1) as invoiceOpen, invoiceDiscount(C_Invoice_ID,@param2,@param3) as invoiceDiscount, IsSOTrx FROM C_Invoice WHERE C_Invoice_ID=@param4",y=null,d=[];try{d[0]=new n.DB.SqlParam("@param1",it);d[1]=new n.DB.SqlParam("@param2",rt);d[1].setIsDate(!0);d[2]=new n.DB.SqlParam("@param3",it);d[3]=new n.DB.SqlParam("@param4",p);y=n.DB.executeReader(et,d,null);y.read()&&(w=t.getValueOfInt(y.get("c_currency_id")),l=t.getValueOfDecimal(y.get("invoiceopen")),l==null&&(l=n.Env.ZERO),h=t.getValueOfDecimal(y.get("invoicediscount")));y.close()}catch(ot){return y!=null&&y.close(),this.log.log(i.SEVERE,et,ot),this.setCalloutActive(!1),ot.message}}this.log.fine("Open="+l+" Discount= "+h+", C_Invoice_ID="+p+", C_Currency_ID="+w);var b=t.getValueOfDecimal(f.getValue("PayAmt")==null?n.Env.ZERO:f.getValue("PayAmt")),a=t.getValueOfDecimal(f.getValue("WriteOffAmt")==null?n.Env.ZERO:f.getValue("WriteOffAmt")),c=t.getValueOfDecimal(f.getValue("OverUnderAmt")==null?n.Env.ZERO:f.getValue("OverUnderAmt")),g=t.getValueOfDecimal(f.getValue("DiscountAmt")==null?n.Env.ZERO:f.getValue("DiscountAmt"));this.log.fine("Pay="+b+", Discount="+g+", WriteOff="+a+", OverUnderAmt="+c);var nt=t.getValueOfInt(ut),lt=nt.toString(),tt=n.dataContext.getJSONRecord("MCurrency/GetCurrency",lt),st=f.getValue("DateTrx"),ft=0,ht=t.getValueOfInt(f.getValue("C_ConversionType_ID"));ht!=null&&(ft=ht);var at=r.getContextAsInt(u,"AD_Client_ID"),vt=r.getContextAsInt(u,"AD_Org_ID"),v=n.Env.ONE;if(nt>0&&w>0&&nt!=w||k=="C_Currency_ID"||k=="C_ConversionType_ID"){if(this.log.fine("InvCurrency="+w+", PayCurrency="+nt+", Date="+st+", Type="+ft),ct=w+","+nt+","+st+","+ft+","+at+","+vt,v=n.dataContext.getJSONRecord("MConversionRate/GetRate",ct),v==null||v.toString()==0)return(this.setCalloutActive(!1),w==0)?"":"NoCurrencyConversion";l=(l*v).toFixed(tt.StdPrecision);h=(h*v).toFixed(tt.StdPrecision);this.log.fine("Rate="+v+", InvoiceOpenAmt="+l+", DiscountAmt="+h)}return k=="C_Currency_ID"||k=="C_ConversionType_ID"?(a=(a*v).toFixed(tt.StdPrecision),f.setValue("WriteOffAmt",a),c=(c*v).toFixed(tt.StdPrecision),f.setValue("OverUnderAmt",c),g=(g*v).toFixed(tt.StdPrecision),f.setValue("DiscountAmt",g),b=l-h-a-c,f.setValue("PayAmt",b)):p==0?(n.Env.ZERO!=h&&f.setValue("DiscountAmt",n.Env.ZERO),n.Env.ZERO!=a&&f.setValue("WriteOffAmt",n.Env.ZERO),n.Env.ZERO!=c&&f.setValue("OverUnderAmt",n.Env.ZERO)):k=="PayAmt"?(c=l-b-h-a,n.Env.ZERO.compareTo(c)>0&&(h=Math.abs(a).compareTo(h)<=0?h+c:n.Env.ZERO,c=l-b-h-a),f.setValue("DiscountAmt",h),f.setValue("OverUnderAmt",c)):(h=g,b=l-h-a-c,f.setValue("PayAmt",b),f.setValue("DiscountAmt",h)),this.setCalloutActive(!1),r=u=f=e=o=s=null,""};n.Model.CalloutPayment=y;n.Utility.inheritPrototype(p,n.CalloutEngine);p.prototype.DocType=function(r,u,f,o,s,h){var ot="O",st="S",ot="O",st="S",ut="F",nt="PR",b="WR",y="",d,g,w,tt,it,a,ft,l,p,c,et;try{if(s==null||s.toString()==""||(d=s,d==null||d==0))return"";if(g=f.getValue("DocumentNo"),w=g==null,!w&&g.toString().startsWith("<")&&g.toString().endsWith(">")&&(w=!0),tt=f.getValue("C_DocType_ID"),y="SELECT d.DocSubTypeSO,d.HasCharges,'N',d.IsDocNoControlled,s.CurrentNext,s.CurrentNextSys,s.AD_Sequence_ID,d.IsSOTrx, d.IsReturnTrx FROM C_DocType d LEFT OUTER JOIN AD_Sequence s ON (d.DocNoSequence_ID=s.AD_Sequence_ID) WHERE C_DocType_ID=",it=0,a=null,w||tt==0)y=y+d,a=n.DB.executeDataset(y,null);else for(y=y+tt,a=n.DB.executeDataset(y,null),l=0;l<a.getTables()[0].rows.count;l++)it=t.getValueOfInt(a.getRows()[l].getCell("AD_Sequence_ID"));var v="",k=!0,rt=!1;for(l=0;l<a.getTables()[0].rows.count;l++)if(v=t.getValueOfString(a.getRows()[l].getCell("DocSubTypeSO")),v==null&&(v="--"),r.setContext(u,"OrderType",v),v.toString().equals("SO")||f.setValue("IsDropShip","N"),"N".toString().equals(t.getValueOfString(a.getRows()[l].getCell("IsSOTrx")))&&(k=!1),rt="Y".toString().equals(t.getValueOfString(a.getRows()[l].getCell("IsReturnTrx"))),rt?v.toString().equals(b)?f.setValue("DeliveryRule",ut):f.setValue("DeliveryRule","M"):(v.toString().equals(b)?f.setValue("DeliveryRule",ut):v.toString().equals(nt)?f.setValue("DeliveryRule","R"):f.setValue("DeliveryRule","A"),v.toString().equals(b)||v.toString().equals(nt)||v.toString().equals("WI")?f.setValue("InvoiceRule","I"):f.setValue("InvoiceRule","D"),v.toString().equals(b)?f.setValue("PaymentRule",PAYMENTRULE_Cash):f.setValue("PaymentRule",PAYMENTRULE_OnCredit),r.setContext(u,"HasCharges",t.getValueOfString(a.getRows()[l].getCell("HasCharges")))),p[3].toString().equals("Y")&&(w||it==t.getValueOfInt(a.getRows()[l].getCell("AD_Sequence_ID"))||(w=!0),w))try{f.setValue("DocumentNo","<"+t.getValueOfString(a.getRows()[l].getCell("CurrentNext"))+">")}catch(ht){this.setCalloutActive(!1)}if(rt)return"";if(!v.toString().equals(b)&&!v.toString().equals(nt))for(ft=r.getContextAsInt(u,"C_BPartner_ID"),y="SELECT PaymentRule,C_PaymentTerm_ID,InvoiceRule,DeliveryRule,FreightCostRule,DeliveryViaRule, PaymentRulePO,PO_PaymentTerm_ID FROM C_BPartner WHERE C_BPartner_ID="+ft,a=n.DB.executeDataset(y,null),l=0;l<a.getTables()[0].rows.count;l++)p=a.getTables()[0].rows[l],c=t.getValueOfString(p.get(k?"paymentrule":"paymentrulepo")),c!=null&&c.toString().length!=0&&(k&&(c.toString().equals("B")||c.toString().equals("S")||c.toString().equals("U"))&&(c="P"),!k&&c.toString().equals("B")&&(c="P"),f.setValue("PaymentRule",c)),et=t.getValueOfInt(p.get(k?"c_paymentterm_id":"po_paymentterm_id")),p!=null&&f.setValue("C_PaymentTerm_ID",et),c=p[2].toString(),c!=null&&c.length!=0&&f.setValue("InvoiceRule",c),c=p[3].toString(),c!=null&&c.length!=0&&f.setValue("DeliveryRule",c),c=p[4].toString(),c!=null&&c.length!=0&&f.setValue("FreightCostRule",c),c=p[5].toString(),c!=null&&c.length!=0&&f.setValue("DeliveryViaRule",c)}catch(ht){return this.setCalloutActive(!1),this.log.log(i.SEVERE,y,ht),e.message}return r=u=f=o=s=h=null,""};p.prototype.BPartner=function(r,u,f,o,s,h){var ot="O",st="S",ot="O",st="S",k="",a,ut,v,d,b,l,y,g,nt,p,tt,w,it,ft,et,c,rt;try{if(s==null||s.toString()==""||(a=0,s!=null&&(a=t.getValueOfInt(s.toString())),a==0)||(ut=f.getValue("IsReturnTrx"),ut))return"";for(this.setCalloutActive(!0),k="SELECT p.AD_Language,p.C_PaymentTerm_ID, COALESCE(p.M_PriceList_ID,g.M_PriceList_ID) AS M_PriceList_ID, p.PaymentRule,p.POReference, p.SO_Description,p.IsDiscountPrinted, p.InvoiceRule,p.DeliveryRule,p.FreightCostRule,DeliveryViaRule, p.SO_CreditLimit, p.SO_CreditLimit-p.SO_CreditUsed AS CreditAvailable, lship.C_BPartner_Location_ID,c.AD_User_ID, COALESCE(p.PO_PriceList_ID,g.PO_PriceList_ID) AS PO_PriceList_ID, p.PaymentRulePO,p.PO_PaymentTerm_ID, lbill.C_BPartner_Location_ID AS Bill_Location_ID, p.SOCreditStatus, lbill.IsShipTo FROM C_BPartner p INNER JOIN C_BP_Group g ON (p.C_BP_Group_ID=g.C_BP_Group_ID) LEFT OUTER JOIN C_BPartner_Location lbill ON (p.C_BPartner_ID=lbill.C_BPartner_ID AND lbill.IsBillTo='Y' AND lbill.IsActive='Y') LEFT OUTER JOIN C_BPartner_Location lship ON (p.C_BPartner_ID=lship.C_BPartner_ID AND lship.IsShipTo='Y' AND lship.IsActive='Y') LEFT OUTER JOIN AD_User c ON (p.C_BPartner_ID=c.C_BPartner_ID) WHERE p.C_BPartner_ID="+a+" AND p.IsActive='Y'",v=r.getWindowContext(u,"IsSOTrx",!0)=="Y",d=n.DB.executeDataset(k,null),b=0;b<d.getTables()[0].rows.count;b++)l=d.getTables()[0].rows[b],y=t.getValueOfInt(l.get(v?"m_pricelist_id":"po_pricelist_id")),l!=null&&y!=0?f.setValue("M_PriceList_ID",y):(g=r.getContextAsInt("#M_PriceList_ID"),g!=0&&f.setValue("M_PriceList_ID",g)),f.setValue("Bill_BPartner_ID",a),nt=t.getValueOfInt(l.get("bill_location_id")),nt==0?f.setValue("Bill_Location_ID",null):f.setValue("Bill_Location_ID",nt),p=t.getValueOfInt(l.get("c_bpartner_location_id")),a.toString().equals(r.getContext("C_BPartner_ID"))&&(tt=r.getContext("C_BPartner_Location_ID"),tt.toString().length>0&&(p=int.Parse(tt))),p==0?f.setValue("C_BPartner_Location_ID",null):(f.setValue("C_BPartner_Location_ID",p),"Y".toString().equals(t.getValueOfString(l.get("isshipto")))&&f.setValue("Bill_Location_ID",p)),w=t.getValueOfInt(l.get("ad_user_id").toString()),a.toString().toString().equals(r.getContext("C_BPartner_ID"))&&(it=r.getContext("AD_User_ID"),it.toString().length>0&&(w=t.getValueOfInt(it))),w==0?f.setValue("AD_User_ID",null):(f.setValue("AD_User_ID",w),f.setValue("Bill_User_ID",w)),v&&(ft=t.getValueOfDouble(l.get("so_creditlimit")),ft!=0&&(et=t.getValueOfDouble(l.get("creditavailable")),l!=null&&et<0)),c=l.get("poreference").toString(),c!=null&&c.toString().length!=0&&f.setValue("POReference",c),c=t.getValueOfString(l.get("so_description")),c!=null&&c.toString().trim().length!=0&&f.setValue("Description",c),c=t.getValueOfString(l.get("isdiscountprinted")),c!=null&&c.toString().length!=0?f.setValue("IsDiscountPrinted",c):f.setValue("IsDiscountPrinted","N"),rt=r.getContext("OrderType"),f.setValue("InvoiceRule","D"),f.setValue("DeliveryRule","A"),f.setValue("PaymentRule",PAYMENTRULE_OnCredit),rt.toString().equals("PR")?(f.setValue("InvoiceRule","I"),f.setValue("DeliveryRule","R")):rt.toString().equals(MOrder.DocSubTypeSO_POS)?f.setValue("PaymentRule",PAYMENTRULE_Cash):(c=l[v?"PaymentRule":"PaymentRulePO"].toString(),c!=null&&c.length!=0&&(c.toString().equals("B")&&(c="P"),v&&(c.toString().equals("S")||c.toString().equals("U"))&&(c="P"),f.setValue("PaymentRule",c)),y=t.getValueOfInt(l.get(v?"c_paymentterm_id":"po_paymentterm_id")),l!=null&&y!=0&&f.setValue("C_PaymentTerm_ID",y),c=t.getValueOfString(l.get("invoicerule")),c!=null&&c.length!=0&&f.setValue("InvoiceRule",c),c=t.getValueOfString(l.get("deliveryrule")),c!=null&&c.length!=0&&f.setValue("DeliveryRule",c),c=t.getValueOfString(l.get("freightcostrule")),c!=null&&c.length!=0&&f.setValue("FreightCostRule",c),c=t.getValueOfString(l.get("deliveryviarule")),c!=null&&c.length!=0&&f.setValue("DeliveryViaRule",c))}catch(ht){return this.log.log(i.SEVERE,k,ht),this.setCalloutActive(!1),e.message}return this.setCalloutActive(!1),r=u=f=o=s=h=null,""};p.prototype.Product=function(i,r,u,f,e){var h,y,c,p,a,v,d;if(e==null||e.toString()=="")return"";try{if((h=e,h==null||h==0)||(y="Y".toString().equals(i.getContext("IsReturnTrx")),y))return"";this.setCalloutActive(!0);o&&this.log.warning("init");u.setValue("C_Charge_ID",null);i.getContextAsInt(r,"M_Product_ID")==h&&i.getContextAsInt(r,"M_AttributeSetInstance_ID")!=0?u.setValue("M_AttributeSetInstance_ID",t.getValueOfInt(i.getContextAsInt(r,"M_AttributeSetInstance_ID"))):u.setValue("M_AttributeSetInstance_ID",null);var g=i.getContextAsInt(r,"C_BPartner_ID"),nt=t.getValueOfDecimal(u.getValue("QtyEntered")),tt=i.getWindowContext(r,"IsSOTrx",!0)=="Y",it=i.getContextAsInt(r,"M_PriceList_ID"),rt=i.getContextAsInt(r,"M_PriceList_Version_ID"),ut=u.getValue("DateOrdered"),c=h.toString().concat(",",g.toString(),",",nt.toString(),",",tt,",",it.toString(),",",rt.toString(),",",null,",",null,",",null),s=null;if(s=n.dataContext.getJSONRecord("MProductPricing/GetProductPricing",c),u.setValue("PriceList",s.PriceList),u.setValue("PriceLimit",s.PriceLimit),u.setValue("PriceActual",s.PriceActual),u.setValue("PriceEntered",s.PriceEntered),u.setValue("C_Currency_ID",t.getValueOfInt(s.C_Currency_ID)),u.setValue("Discount",s.Discount),u.setValue("C_UOM_ID",t.getValueOfInt(s.C_UOM_ID)),u.setValue("QtyOrdered",u.getValue("QtyEntered")),i.setContext(r,"EnforcePriceLimit",s.IsEnforcePriceLimit?"Y":"N"),i.setContext(r,"DiscountSchema",s.IsDiscountSchema?"Y":"N"),i.getWindowContext(r,"IsSOTrx",!0)=="Y"&&(c=h.toString()+",0",p=n.dataContext.getJSONRecord("MProduct/GetProduct",c),p)){var w=t.getValueOfDecimal(u.getValue("QtyEntered")),b=i.getContextAsInt(r,"M_Warehouse_ID"),k=i.getContextAsInt(r,"M_AttributeSetInstance_ID"),c=b+","+h+","+k,l=n.dataContext.getJSONRecord("MStorage/GetQtyAvailable",c);l==null&&(l=n.Env.ZERO);l==0||l.toString().compareTo(w)<0||(a=0,u.getValue("C_OrderLine_ID")!=null&&(a=t.getValueOfInt(u.getValue("C_OrderLine_ID"))),a==null&&(a=0),c=b.toString()+","+h.toString()+","+k.toString()+","+a.toString(),v=t.getValueOfDecimal(n.dataContext.getJSONRecord("MOrderLine/GetNotReserved",c)),v==null&&(v=n.Env.ZERO),d=l-v,d.toString().compareTo(w)<0)}this.setCalloutActive(!1);o&&this.log.warning("fini")}catch(ft){this.setCalloutActive(!1)}return this.Tax(i,r,u,f,e)};p.prototype.Tax=function(i,r,u,f,e){var o=0,s=n.Env.ZERO,h=n.Env.ZERO,a="",c,l;return o=t.getValueOfInt(u.getValue("C_Tax_ID")),c="select rate from c_tax WHERE c_tax_id="+o+"",s=t.getValueOfDecimal(n.DB.executeScalar(c,null,null)),a=this.Amt(i,r,u,f,e),l=t.getValueOfDecimal(u.getValue("LineNetAmt")),h=t.getValueOfDecimal(t.getValueOfDecimal(l)*t.getValueOfDecimal(s)/100),u.setValue("taxamt",h),this.Amt(i,r,u,f,e)};p.prototype.Amt=function(i,r,u,f,e,s){var it,a,d;if(this.isCalloutActive()||e==null||e.toString()=="")return"";this.setCalloutActive(!0);try{o&&this.log.warning("init");var b=i.getContextAsInt(r,"C_UOM_ID"),k=i.getContextAsInt(r,"M_Product_ID"),tt=i.getContextAsInt(r,"M_PriceList_ID"),ut=tt.toString(),v=n.dataContext.getJSONRecord("MPriceList/GetPriceList",ut),g=t.getValueOfInt(v[g]),y,h,c,p,l,w;if(y=t.getValueOfDecimal(u.getValue("QtyEntered")),y=t.getValueOfDecimal(u.getValue("QtyEntered")),this.log.fine("QtyEntered="+y+", Ordered="+y+", UOM="+b),h=t.getValueOfDecimal(u.getValue("PriceEntered")),c=t.getValueOfDecimal(u.getValue("PriceActual")),l=t.getValueOfDecimal(u.getValue("Discount")),p=t.getValueOfDecimal(u.getValue("PriceLimit")),w=t.getValueOfDecimal(u.getValue("PriceList")),this.log.fine("PriceList="+w+", Limit="+p+", Precision="+g),this.log.fine("PriceEntered="+h+", Actual="+c+", Discount="+l),(f.getColumnName().toString().equals("QtyEntered")||f.getColumnName().toString().equals("QtyEntered")||f.getColumnName().toString().equals("M_Product_ID"))&&!"N".toString().equals(i.getContext("DiscountSchema"))){it=i.getContextAsInt(r,"C_BPartner_ID");f.getColumnName().toString().equals("QtyEntered")&&(a=k.toString()+","+b.toString()+","+y.toString(),y=t.getValueOfDecimal(n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo",a)));y==null;var ft=i.getWindowContext(r,"IsSOTrx",!0)=="Y",et=i.getContextAsInt(r,"M_PriceList_Version_ID"),a=k.toString().concat(",",it.toString(),",",y.toString(),",",ft,",",tt.toString(),",",et.toString(),",",null,",",null,",",null),v=null;v=n.dataContext.getJSONRecord("MProductPricing/GetProductPricing",a);a=k.toString()+","+b.toString()+","+v.PriceStd.toString();h=t.getValueOfDecimal(n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a));h==null&&(h=v.PriceStd);this.log.fine("QtyChanged -> PriceActual="+v.PriceStd+", PriceEntered="+h+", Discount="+v.Discount);c=v.PriceStd;u.setValue("PriceActual",v.PriceActual);u.setValue("Discount",v.Discount);u.setValue("PriceEntered",v.PriceEntered);i.setContext(r,"DiscountSchema",v.IsDiscountSchema?"Y":"N")}else f.getColumnName().toString().equals("PriceActual")?(c=t.getValueOfDecimal(e),a=k.toString()+","+b.toString()+","+c.toString(),h=t.getValueOfDecimal(n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a)),h==null&&(h=c),this.log.fine("PriceActual="+c+" -> PriceEntered="+h),u.setValue("PriceEntered",h)):f.getColumnName().toString().equals("PriceEntered")&&(h=t.getValueOfDecimal(e),a=k.toString()+","+b.toString()+","+h.toString(),c=t.getValueOfDecimal(n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo",a)),c==null&&(c=h),this.log.fine("PriceEntered="+h+" -> PriceActual="+c),u.setValue("PriceActual",c));f.getColumnName().toString().equals("Discount")?(c=t.getValueOfDecimal((100-t.getValueOfDouble(l))/100*t.getValueOfDouble(w)),t.scale(c)>g&&(c=c.toFixed(g)),a=k.toString()+","+b.toString()+","+c.toString(),h=t.getValueOfDecimal(n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a)),h==null&&(h=c),u.setValue("PriceActual",c),u.setValue("PriceEntered",h)):(l=w==0?n.Env.ZERO:t.getValueOfDecimal((w-c)/w*100),t.scale(l)>2&&(l=l.toFixed(2)),u.setValue("Discount",l));this.log.fine("PriceEntered="+h+", Actual="+c+", Discount="+l);var rt=i.getContext("EnforcePriceLimit"),nt=i.getWindowContext(r,"IsSOTrx",!0)=="Y"&&rt!=null&&rt.toString().equals("Y"),ot="Y".toString().equals(i.getContext("IsReturnTrx"));nt&&(n.MRole.getDefault().IsOverwritePriceLimit()||ot)&&(nt=!1);nt&&t.getValueOfDouble(p)!=0&&c.toString().compare(p)<0&&(c=p,a=k.toString()+","+b.toString()+","+p.toString(),h=t.getValueOfDecimal(n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a)),h==null&&(h=p),this.log.fine("(under) PriceEntered="+h+", Actual"+p),u.setValue("PriceActual",p),u.setValue("PriceEntered",h),n.ADialog.info("UnderLimitPrice"),w!=0&&(l=t.getValueOfDecimal((w-c)/w*100),t.scale(l)>2&&(l=l.toFixed(2)),u.setValue("Discount",l)));d=y*c;t.scale(d)>g&&(d=d.toFixed(g));this.log.info("LineNetAmt="+d);u.setValue("LineNetAmt",d);u.setValue("GrandTotal",t.getValueOfDecimal(u.getValue("TaxAmt"))+d)}catch(st){}return this.setCalloutActive(!1),i=r=u=f=e=s=null,""};n.Model.CalloutOrderContract=p;n.Utility.inheritPrototype(rt,n.CalloutEngine);rt.prototype.CalculationSelection=function(n,t,i,r,u){return this.isCalloutActive()||u==null||u.toString()==""||u==!1?"":(this.setCalloutActive(!0),r.getColumnName()=="IsSum"?(i.setValue("IsMaximum",!1),i.setValue("IsCount",!1),i.setValue("IsMinimum",!1)):r.getColumnName()=="IsMaximum"?(i.setValue("IsSum",!1),i.setValue("IsMinimum",!1),i.setValue("IsCount",!1)):r.getColumnName()=="IsCount"?(i.setValue("IsMaximum",!1),i.setValue("IsSum",!1),i.setValue("IsMinimum",!1)):r.getColumnName()=="IsMinimum"&&(i.setValue("IsSum",!1),i.setValue("IsCount",!1),i.setValue("IsMaximum",!1)),this.setCalloutActive(!1),"")};rt.prototype.UpdateKPITableInContext=function(n,t,i,r,u){return this.isCalloutActive()||u==null||u.toString()==""?"":(this.setCalloutActive(!0),u==!0?n.setContext(t,"AD_Table_ID",-1):n.setContext(t,"TableView_ID",-1),this.setCalloutActive(!1),"")};rt.prototype.UpdateTabIDContext=function(n,t,i,r,u){return this.isCalloutActive()?"":(this.setCalloutActive(!0),u<1||u==null||u.toString()==""?n.setContext(t,"AD_Tab_ID",-1):n.setContext(t,"AD_Tab_ID",u),this.setCalloutActive(!1),"")};n.Model.CalloutKPI=rt;n.Utility.inheritPrototype(k,n.CalloutEngine);k.prototype.UpdateTableInContext=function(n,t,i,r,u){return this.isCalloutActive()?"":(this.setCalloutActive(!0),u==!0?n.setContext(t,"AD_Table_ID",-1):n.setContext(t,"TableView_ID",-1),this.setCalloutActive(!1),"")};k.prototype.UpdateTabIDContext=function(n,t,i,r,u){return this.isCalloutActive()?"":(this.setCalloutActive(!0),u<1||u==null||u.toString()==""?n.setContext(t,"AD_Tab_ID",-1):(n.setContext(t,"AD_Tab_ID",u),n.setContext(t,"TableView_ID",-1)),this.setCalloutActive(!1),"")};k.prototype.UpdateTableViewIDOnTableContext=function(n,t,i,r,u){return this.isCalloutActive()||u==null||u.toString()==""?"":(this.setCalloutActive(!0),u>0&&n.setContext(t,"TableView_ID",-1),this.setCalloutActive(!1),"")};k.prototype.SelectFunctionOnDashboard=function(n,i,r,u,f){if(this.isCalloutActive()||f==null||f.toString()==""||f==!1)return"";this.setCalloutActive(!0);var e=t.getValueOfBoolean(f);return u.getColumnName()=="IsSum"?(r.setValue("IsAvg",!1),r.setValue("IsCount",!1),r.setValue("IsNone",!1)):u.getColumnName()=="IsAvg"?(r.setValue("IsSum",!1),r.setValue("IsCount",!1),r.setValue("IsNone",!1)):u.getColumnName()=="IsCount"?(r.setValue("IsSum",!1),r.setValue("IsAvg",!1),r.setValue("IsNone",!1)):u.getColumnName()=="IsNone"&&(r.setValue("IsSum",!1),r.setValue("IsCount",!1),r.setValue("IsAvg",!1)),this.setCalloutActive(!1),""};n.Model.CalloutDashboard=k;n.Utility.inheritPrototype(ut,n.CalloutEngine);ut.prototype.UpdateTabIDContext=function(n,t,i,r,u){return this.isCalloutActive()?"":(this.setCalloutActive(!0),u<1||u==null||u.toString()==""?n.setContext(t,"AD_Tab_ID",-1):n.setContext(t,"AD_Tab_ID",u),this.setCalloutActive(!1),"")};ut.prototype.GroupByChecked=function(t,i,r,u,f){if(this.isCalloutActive()||f==null)return"";this.setCalloutActive(!0);var e="UPDATE RC_ViewColumn SET IsGroupBy='N' WHERE RC_View_ID="+r.getValue("RC_View_ID")+" AND RC_ViewColumn_ID NOT IN("+r.getValue("RC_ViewColumn_ID")+")",o=n.DB.executeQuery(e);return this.setCalloutActive(!1),""};ut.prototype.IsViewChecked=function(n,t,i,r,u){return this.isCalloutActive()||u==null?"":(this.setCalloutActive(!0),u?(i.setValue("AD_Tab_ID",-1),i.setValue("AD_Table_ID",-1)):i.setValue("TableView_ID",-1),this.setCalloutActive(!1),"")};n.Model.CalloutDashboardView=ut;n.Utility.inheritPrototype(yi,n.CalloutEngine);yi.prototype.StatisticGroup=function(n,t,i,r,u){return u==null||u.toString()==""?"":(i.setValue("FO_STATISTICSUBGROUP_ID",0),"")};n.Model.CalloutService=yi;n.Utility.inheritPrototype(bt,n.CalloutEngine);bt.prototype.SetReadnly=function(n,i,r,u,f){return f==null||f.toString()==""||f.toString()=="E"?(this.setCalloutActive(!1),f!=null&&f.toString()=="E"&&(r.getField("VSS_PAYMENTTYPE").setReadOnly(!0),r.setValue("VSS_PAYMENTTYPE","P")),""):(this.setCalloutActive(!0),t.getValueOfString(r.getValue("CashType"))=="A"||t.getValueOfString(r.getValue("CashType"))=="E"?(r.setValue("VSS_PAYMENTTYPE","P"),r.getField("VSS_PAYMENTTYPE").setReadOnly(!0)):t.getValueOfString(r.getValue("CashType"))=="F"||t.getValueOfString(r.getValue("CashType"))=="R"?(r.setValue("VSS_PAYMENTTYPE","R"),r.getField("VSS_PAYMENTTYPE").setReadOnly(!0)):t.getValueOfString(r.getValue("CashType"))=="I"?r.getField("VSS_PAYMENTTYPE").setReadOnly(!0):r.getField("VSS_PAYMENTTYPE").setReadOnly(!1),t.getValueOfString(r.getValue("VSS_PAYMENTTYPE"))=="P"?t.getValueOfDecimal(r.getValue("amount"))>0&&r.setValue("Amount",0-t.getValueOfDecimal(r.getValue("amount"))):t.getValueOfString(r.getValue("VSS_PAYMENTTYPE"))=="R"&&t.getValueOfDecimal(r.getValue("amount"))<0&&r.setValue("Amount",0-t.getValueOfDecimal(r.getValue("amount"))),this.setCalloutActive(!1),"")};bt.prototype.SetAmountValue=function(n,i,r,u,f){return f==null||f.toString()==""?(r.getField("VSS_PAYMENTTYPE").setReadOnly(!1),this.setCalloutActive(!1),""):(this.setCalloutActive(!0),t.getValueOfString(r.getValue("VSS_PAYMENTTYPE"))=="P"?t.getValueOfDecimal(r.getValue("amount"))>0&&r.setValue("Amount",0-t.getValueOfDecimal(r.getValue("amount"))):t.getValueOfString(r.getValue("VSS_PAYMENTTYPE"))=="R"&&t.getValueOfDecimal(r.getValue("amount"))<0&&r.setValue("Amount",0-t.getValueOfDecimal(r.getValue("amount"))),this.setCalloutActive(!1),"")};n.Model.CalloutSetReadOnly=bt;n.Utility.inheritPrototype(pi,n.CalloutEngine);pi.prototype.SetContract=function(t,i,r,u,f){if(this.isCalloutActive()||f==null||f.toString()=="")return"";this.setCalloutActive(!0);try{var e=t.getContextAsInt(i,"M_Product_ID"),o=e.toString().concat(","),s=n.dataContext.getJSONRecord("MProduct/GetProductType",o);s=="S"?r.getField("IsContract").setReadOnly(!1):(r.getValue("IsContract",!1),r.getField("IsContract").setReadOnly(!0))}catch(h){this.log.severe(h.toString())}return this.setCalloutActive(!1),""};n.Model.CalloutSetContract=pi;n.Utility.inheritPrototype(kt,n.CalloutEngine);kt.prototype.WorkflowType=function(i,r,u,f,e){var s,o;if(e==null||e.toString()=="")return"";if(this.setCalloutActive(!0),s=t.getValueOfString(e.toString()),s=="R"){if(o=t.getValueOfInt(n.DB.executeScalar("SELECT AD_Table_ID FROM AD_Table WHERE IsActive='Y' AND TableName= 'VADMS_MetaData'")),o==0)return n.ADialog.info("No_VADMS",null,"",""),n.Msg.getMsg("No_VADMS");u.setValue("AD_Table_ID",o)}return this.setCalloutActive(!1),""};kt.prototype.SetSelectedColumn=function(i,r,u,f,e){return e==null||e.toString()==""?"":(this.setCalloutActive(!0),t.getValueOfString(n.DB.executeScalar("SELECT ColumnName FROM AD_Column WHERE AD_Column_ID="+e)).toLower()=="C_GenAttributeSetInstance_ID".toLower()?i.setContext(r,"IsGenericAttribute","Y"):i.setContext(r,"IsGenericAttribute","N"),this.setCalloutActive(!1),"")};n.Model.CallOutWorkflow=kt;n.Utility.inheritPrototype(wi,n.CalloutEngine);wi.prototype.GetPaymentNote=function(i,r,u,f,e){if(e==null||e.toString()==""||e==""||this.isCalloutActive())return"";this.setCalloutActive(!0);var o=t.getValueOfString(n.DB.executeScalar("select documentnote from c_paymentterm where c_paymentterm_id="+e));return o!=null&&u.setValue("description",o),this.setCalloutActive(!1),""};n.Model.CalloutSalesQuotation=wi;n.Utility.inheritPrototype(bi,n.CalloutEngine);bi.prototype.SetDate=function(n,i,r,u,f){if(f==null||f.toString()=="")return"";if(r.getValue("StartDate")==null||r.getValue("NoofCycle")==null)return this.setCalloutActive(!1),"";try{this.setCalloutActive(!0);var o=new Date(r.getValue("StartDate")),e=o.setMonth(o.getMonth()+t.getValueOfInt(r.getValue("NoofCycle")));e=e<=0?new Date:new Date(e);e=e.toISOString();r.setValue("EndDate",e);this.setCalloutActive(!1)}catch(s){}return""};n.Model.CalloutSetDate=bi;n.Utility.inheritPrototype(ki,n.CalloutEngine);ki.prototype.DisplayButton=function(i,r,u,f,e){if(e==null||e.toString()=="")return"";if(t.getValueOfInt(u.getValue("C_DocTypeTarget_ID"))!=0){var s="select dc.DocSubTypeSO from c_doctype dc inner join c_docbasetype db on(dc.DocBaseType=db.DocBaseType)where c_doctype_id="+t.getValueOfInt(u.getValue("C_DocTypeTarget_ID"))+" and db.DocBaseType='SOO' and dc.DocSubTypeSO in ('WR','WI')",o=t.getValueOfString(n.DB.executeScalar(s,null,null));o=="WR"||o=="WI"?u.setValue("InvoicePrint","Y"):u.setValue("InvoicePrint","N")}else return this.setCalloutActive(!1),"";return this.setCalloutActive(!1),""};n.Model.CalloutDisplayButton=ki;n.Utility.inheritPrototype(di,n.CalloutEngine);di.prototype.SetQty=function(n,i,r,u,f){if(this.isCalloutActive()||f==null||f.toString()=="")return"";if(this.setCalloutActive(!0),t.getValueOfDecimal(r.getValue("TargetQty"))<t.getValueOfDecimal(r.getValue("ConfirmedQty")))return r.setValue("ConfirmedQty",t.getValueOfDecimal(r.getValue("TargetQty"))),r.setValue("DifferenceQty",0),r.setValue("ScrappedQty",0),this.setCalloutActive(!1),"";if(u.getColumnName()=="ConfirmedQty"){if(t.getValueOfDecimal(r.getValue("ConfirmedQty"))<0)return r.setValue("ConfirmedQty",t.getValueOfDecimal(r.getValue("TargetQty"))),r.setValue("DifferenceQty",0),r.setValue("ScrappedQty",0),this.setCalloutActive(!1),"";r.setValue("ScrappedQty",0);r.setValue("DifferenceQty",t.getValueOfDecimal(r.getValue("TargetQty"))-(t.getValueOfDecimal(r.getValue("ConfirmedQty"))+t.getValueOfDecimal(r.getValue("ScrappedQty"))))}else if(u.getColumnName()=="DifferenceQty"){if(t.getValueOfDecimal(r.getValue("TargetQty"))<t.getValueOfDecimal(r.getValue("ConfirmedQty"))+t.getValueOfDecimal(r.getValue("DifferenceQty")))return r.setValue("ConfirmedQty",t.getValueOfDecimal(r.getValue("TargetQty"))),r.setValue("DifferenceQty",0),r.setValue("ScrappedQty",0),this.setCalloutActive(!1),"";r.setValue("ScrappedQty",t.getValueOfDecimal(r.getValue("TargetQty"))-(t.getValueOfDecimal(r.getValue("ConfirmedQty"))+t.getValueOfDecimal(r.getValue("DifferenceQty"))))}else if(u.getColumnName()=="ScrappedQty"){if(t.getValueOfDecimal(r.getValue("ScrappedQty"))<0||t.getValueOfDecimal(r.getValue("TargetQty"))<t.getValueOfDecimal(r.getValue("ConfirmedQty"))+t.getValueOfDecimal(r.getValue("ScrappedQty")))return r.setValue("ConfirmedQty",t.getValueOfDecimal(r.getValue("TargetQty"))),r.setValue("DifferenceQty",0),r.setValue("ScrappedQty",0),this.setCalloutActive(!1),"";r.setValue("DifferenceQty",t.getValueOfDecimal(r.getValue("TargetQty"))-(t.getValueOfDecimal(r.getValue("ConfirmedQty"))+t.getValueOfDecimal(r.getValue("ScrappedQty"))))}return this.setCalloutActive(!1),""};n.Model.CalloutMoveConfirmLine=di;n.Utility.inheritPrototype(gi,n.CalloutEngine);gi.prototype.SetSalesQuotation=function(n,i,r,u,f){if(this.isCalloutActive()||f==null||f.toString()=="")return"";try{this.setCalloutActive(!0);t.getValueOfString(r.getValue("DocSubTypeSO"))=="OB"||t.getValueOfString(r.getValue("DocSubTypeSO"))=="ON"?r.setValue("IsSalesQuotation",!0):r.setValue("IsSalesQuotation",!1)}catch(e){return this.setCalloutActive(!1),e}return this.setCalloutActive(!1),""};n.Model.CalloutDocumentType=gi;n.Utility.inheritPrototype(nr,n.CalloutEngine);nr.prototype.SetAddress=function(t,i,r,u,f){var l,s,e,o,h,c;if(this.isCalloutActive()||f==null||f.toString()=="")return"";try{if(this.setCalloutActive(!0),u.getColumnName()=="C_BPartner_ID")for(l="SELECT au.ad_user_id,  cl.c_bpartner_location_id FROM c_bpartner cp  INNER JOIN c_bpartner_location cl ON cl.c_bpartner_id=cp.c_bpartner_id INNER JOIN Ad_User au ON au.c_bpartner_id   =cp.c_bpartner_id WHERE cp.c_bpartner_id= "+n.Utility.Util.getValueOfString(r.getValue("C_BPartner_ID"))+" AND cp.isactive       ='Y'  ORDER BY cp.created",s=n.DB.executeDataSet(l,null),e=0;e<s.tables[0].rows.length;e++)o=s.tables[0].rows[e],o!=null&&(h=n.Utility.Util.getValueOfInt(o.getCell("C_BPartner_Location_ID")),h==0?r.setValue("C_BPartner_Location_ID",null):r.setValue("C_BPartner_Location_ID",h),c=n.Utility.Util.getValueOfInt(o.getCell("AD_User_ID")),c==0?r.setValue("AD_User_ID",null):r.setValue("AD_User_ID",c))}catch(a){return this.setCalloutActive(!1),a}return this.setCalloutActive(!1),""};n.Model.CalloutProjectCBPartner=nr;n.Utility.inheritPrototype(tr,n.CalloutEngine);tr.prototype.SetPaymentType=function(n,t,i,r,u){if(this.isCalloutActive()||u==null||u.toString()=="")return"";try{if(this.setCalloutActive(!0),r.getColumnName()=="PaymentRule")if(i.getValue("PaymentRule")==null)i.setValue("PaymentMethod",null);else{var f=i.getValue("PaymentRule");i.setValue("PaymentMethod",f)}}catch(e){return this.setCalloutActive(!1),e}return this.setCalloutActive(!1),""};n.Model.CalloutPaymentTypeSO=tr;n.Utility.inheritPrototype(ir,n.CalloutEngine);ir.prototype.DateRequired=function(t,i,r,u,f,e){if(this.isCalloutActive()||f==null||f.toString()=="")return"";this.setCalloutActive(!0);try{var s,o;s=new Date(r.getValue("DateContract"));o=new Date(r.getValue("DateFinish"));o.toISOString()<s.toISOString()&&(r.setValue("DateFinish",""),this.setCalloutActive(!1),n.ADialog.info("DateInvalid",null,"",""));this.log.fine("DateFinish="+o)}catch(h){return n.ADialog.info("DateError"+h,null,"",""),this.setCalloutActive(!1),h}return this.setCalloutActive(!1),t=i=r=u=f=e=null,""};n.Model.CalloutMCampaign=ir;n.Utility.inheritPrototype(dt,n.CalloutEngine);dt.prototype.DateRequired=function(t,i,r,u,f,e){if(this.isCalloutActive()||f==null||f.toString()=="")return"";this.setCalloutActive(!0);try{var s,o;s=new Date(r.getValue("StartDate"));o=new Date(r.getValue("CloseDate"));o.toISOString()<s.toISOString()&&(r.setValue("CloseDate",""),this.setCalloutActive(!1),n.ADialog.info("CloseDateInvalid",null,"",""));this.log.fine("CloseDate="+o)}catch(h){return n.ADialog.info("error in Date"+h,null,"",""),this.setCalloutActive(!1),h}return this.setCalloutActive(!1),t=i=r=u=f=e=null,""};dt.prototype.PlanDateRequired=function(t,i,r,u,f,e){if(this.isCalloutActive()||f==null||f.toString()=="")return"";this.setCalloutActive(!0);try{var s,o;s=new Date(r.getValue("DateStartPlan"));o=new Date(r.getValue("DateCompletePlan"));o.toISOString()<s.toISOString()&&(r.setValue("DateCompletePlan",""),this.setCalloutActive(!1),n.ADialog.info("CmpDateInvalid",null,"",""));this.log.fine("DateCompletePlan="+o)}catch(h){return n.ADialog.info("error in Date"+h,null,"",""),this.setCalloutActive(!1),h}return this.setCalloutActive(!1),t=i=r=u=f=e=null,""};n.Model.CalloutMRequest=dt;n.Utility.inheritPrototype(ft,n.CalloutEngine);ft.prototype.GenerateMenuItemExportID=function(n,t,i,r,u){var f,e,o;return u==null||u.toString()==""?"":(f=n.getContext(t,"Prefix"),i.getValue("MenuItemExport_ID")==null&&i.getValue("IsMenuItem").toString()=="true"&&(e=new Date,o=f+e.getTime(),i.setValue("MenuItemExport_ID",o)),this.setCalloutActive(!1),"")};ft.prototype.GenerateVersionID=function(n,t,i,r,u){if(u==null||u.toString()=="")return"";var f=n.getContext(t,"VersionNo"),e=f.replace(".","");return i.setValue("VersionID",e),this.setCalloutActive(!1),""};ft.prototype.CheckBoxValidation=function(n,i,r,u,f){var o,e;return f==null||f.toString()==""?"":(o=t.getValueOfBool(f),o==!0&&(e=u.getColumnName(),e=="IsProfessionalFree"?(r.setValue("IsProfessionalPaid",!1),r.setValue("IsFree",!1),r.setValue("IsPaid",!1)):e=="IsProfessionalPaid"?(r.setValue("IsProfessionalFree",!1),r.setValue("IsFree",!1),r.setValue("IsPaid",!1)):e=="IsFree"?(r.setValue("IsProfessionalPaid",!1),r.setValue("IsProfessionalFree",!1),r.setValue("IsPaid",!1)):e=="IsPaid"&&(r.setValue("IsProfessionalPaid",!1),r.setValue("IsFree",!1),r.setValue("IsProfessionalFree",!1))),this.setCalloutActive(!1),"")};n.Model.CalloutModuleMgmt=ft;n.Utility.inheritPrototype(rr,n.CalloutEngine);rr.prototype.SetUOM=function(i,r,u,f,e,o){if(this.isCalloutActive()||e==null||e.toString()=="")return"";this.setCalloutActive(!0);try{if(t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='ED011_' "))>0){var s=t.getValueOfInt(e),h=t.getValueOfInt(n.DB.executeScalar("SELECT C_UOM_ID FROM M_Product WHERE IsActive = 'Y' AND M_PRoduct_ID = "+s));u.setValue("C_UOM_ID",h)}}catch(c){this.setCalloutActive(!1);this.log.severe(c.toString())}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};n.Model.CalloutPriclistUOM=rr;n.Utility.inheritPrototype(et,n.CalloutEngine);et.prototype.PaymentTaxAmount=function(i,r,u,f,e,o){var s,h;if(this.isCalloutActive()||e==null||e.toString()=="")return"";this.setCalloutActive(!0);try{if(f.getColumnName()=="C_Tax_ID")if(t.getValueOfDecimal(u.getValue("PayAmt"))>0)if(s=t.getValueOfDecimal(n.DB.executeScalar("Select Rate From C_Tax Where C_Tax_ID="+t.getValueOfInt(e)+" AND IsActive='Y'")),s>0)h=t.getValueOfDecimal(t.getValueOfDecimal(u.getValue("PayAmt"))-t.getValueOfDecimal(u.getValue("PayAmt"))/(s/100+1)),u.setValue("TaxAmount",h);else return u.setValue("TaxAmount",0),this.setCalloutActive(!1),"";else return this.setCalloutActive(!1),"";else if(t.getValueOfInt(u.getValue("C_Tax_ID"))>0)if(s=t.getValueOfDecimal(n.DB.executeScalar("Select Rate From C_Tax Where C_Tax_ID="+t.getValueOfInt(u.getValue("C_Tax_ID"))+" AND IsActive='Y'")),s>0)h=t.getValueOfDecimal(t.getValueOfDecimal(u.getValue("PayAmt"))-t.getValueOfDecimal(u.getValue("PayAmt"))/(s/100+1)),u.setValue("TaxAmount",h);else return u.setValue("TaxAmount",0),this.setCalloutActive(!1),"";else return this.setCalloutActive(!1),""}catch(c){this.setCalloutActive(!1);this.log.severe(c.toString())}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};et.prototype.CashLineTaxAmount=function(i,r,u,f,e,o){var s,h;if(this.isCalloutActive()||e==null||e.toString()=="")return"";this.setCalloutActive(!0);try{if(f.getColumnName()=="C_Tax_ID")if(t.getValueOfDecimal(u.getValue("Amount"))!=0)if(s=t.getValueOfDecimal(n.DB.executeScalar("Select Rate From C_Tax Where C_Tax_ID="+t.getValueOfInt(e)+" AND IsActive='Y'")),s>0)h=t.getValueOfDecimal(t.getValueOfDecimal(u.getValue("Amount"))-t.getValueOfDecimal(u.getValue("Amount"))/(s/100+1)),u.setValue("TaxAmt",h);else return u.setValue("TaxAmt",0),this.setCalloutActive(!1),"";else return this.setCalloutActive(!1),"";else if(t.getValueOfInt(u.getValue("C_Tax_ID"))>0)if(s=t.getValueOfDecimal(n.DB.executeScalar("Select Rate From C_Tax Where C_Tax_ID="+t.getValueOfInt(u.getValue("C_Tax_ID"))+" AND IsActive='Y'")),s>0)h=t.getValueOfDecimal(t.getValueOfDecimal(u.getValue("Amount"))-t.getValueOfDecimal(u.getValue("Amount"))/(s/100+1)),u.setValue("TaxAmt",h);else return u.setValue("TaxAmt",0),this.setCalloutActive(!1),"";else return this.setCalloutActive(!1),""}catch(c){this.setCalloutActive(!1);this.log.severe(c.toString())}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};et.prototype.BankStatementLineTaxAmount=function(i,r,u,f,e,o){var s,h;if(this.isCalloutActive()||e==null||e.toString()=="")return"";this.setCalloutActive(!0);try{if(f.getColumnName()=="C_Tax_ID")if(t.getValueOfDecimal(u.getValue("ChargeAmt"))!=0)if(s=t.getValueOfDecimal(n.DB.executeScalar("Select Rate From C_Tax Where C_Tax_ID="+t.getValueOfInt(e)+" AND IsActive='Y'")),s>0)h=t.getValueOfDecimal(t.getValueOfDecimal(u.getValue("ChargeAmt"))-t.getValueOfDecimal(u.getValue("ChargeAmt"))/(s/100+1)),u.setValue("TaxAmt",h);else return u.setValue("TaxAmt",0),this.setCalloutActive(!1),i=r=u=f=e=o=null,"";else return this.setCalloutActive(!1),i=r=u=f=e=o=null,"";else if(t.getValueOfInt(u.getValue("C_Tax_ID"))>0)if(s=t.getValueOfDecimal(n.DB.executeScalar("Select Rate From C_Tax Where C_Tax_ID="+t.getValueOfInt(u.getValue("C_Tax_ID"))+" AND IsActive='Y'")),s>0)h=t.getValueOfDecimal(t.getValueOfDecimal(u.getValue("ChargeAmt"))-t.getValueOfDecimal(u.getValue("ChargeAmt"))/(s/100+1)),u.setValue("TaxAmt",h);else return u.setValue("TaxAmt",0),this.setCalloutActive(!1),i=r=u=f=e=o=null,"";else return this.setCalloutActive(!1),i=r=u=f=e=o=null,""}catch(c){this.setCalloutActive(!1);this.log.severe(c.toString())}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};n.Model.CalloutTaxAmount=et}(VIS,jQuery),function(n,t){function i(){function yi(n){fi=n;pi()}function v(){var u=t(window).width(),e=t(".row.scrollerHorizontal > div").length,h;e=e-1;t(".scrollerHorizontal").width(u);var l=u/e-20,i=parseInt(l),o={};if(n.Application.isRTL&&(t("#welcomeScreen").css({right:"0",left:"auto"}),t(".vis-welcomeScreenFeeds > .row").css("margin-right","0px")),u>=1366&&(t("#workflowActivity").css("display")=="none"?(t("#welcomeScreen").width(i),o=n.Application.isRTL?{width:i,right:i+20}:{width:i,left:i+20},t("#fllupsScreen").animate(o,200,function(){}),o=n.Application.isRTL?{width:i,right:i*2+40}:{width:i,left:i*2+40},t("#favLinks").animate(o,200,function(){})):t("#workflowActivity").css("display")=="block"&&(h=u+i+20,t(".scrollerHorizontal").width(h),et.scroll(),t("#welcomeScreen").width(i),o=n.Application.isRTL?{width:i,right:i+20}:{width:i,left:i+20},t("#workflowActivity").animate(o,200,function(){yt.scroll()}),o=n.Application.isRTL?{width:i,right:i*2+40}:{width:i,left:i*2+40},t("#fllupsScreen").animate(o,200,function(){}),o=n.Application.isRTL?{width:i,right:i*3+60}:{width:i,left:i*3+60},t("#favLinks").animate(o,200,function(){})),t("#vis_userDate").show()),u>1024&&u<1366)t("#workflowActivity").css("display")=="none"?(n.Application.isRTL?(t("#fllupsScreen").css("right",i+20),t("#favLinks").css("right",i*2+40)):(t("#fllupsScreen").css("left",i+20),t("#favLinks").css("left",i*2+40)),t("#welcomeScreen,#fllupsScreen,#favLinks").width(i)):t("#workflowActivity").css("display")=="block"&&(h=u+i+20,t(".scrollerHorizontal").width(h),et.scroll(),t("#welcomeScreen,#fllupsScreen,#favLinks,#workflowActivity").width(i),n.Application.isRTL?(t("#workflowActivity").css("right",i+20),t("#fllupsScreen").css("right",i*2+40),t("#favLinks").css("right",i*3+60)):(t("#workflowActivity").css("left",i+20),t("#fllupsScreen").css("left",i*2+40),t("#favLinks").css("left",i*3+60))),t("#vis_userDate").show();else if(u>=1e3&&u<=1024){if(t("#workflowActivity").css("display")=="none"){var s=u/2,r=parseInt(s),c=r*e;t(".scrollerHorizontal").width(c);n.Application.isRTL?(t("#fllupsScreen").css("right",r),t("#favLinks").css("right",r*2)):(t("#fllupsScreen").css("left",r),t("#favLinks").css("left",r*2));t("#welcomeScreen,#fllupsScreen,#favLinks").width(r-20)}else if(t("#workflowActivity").css("display")=="block"){e=e+1;var s=u/2,r=parseInt(s),c=r*e;t(".scrollerHorizontal").width(c);et.scroll();t("#welcomeScreen,#fllupsScreen,#favLinks,#workflowActivity").width(r-20);n.Application.isRTL?(t("#workflowActivity").css("right",r),t("#fllupsScreen").css("right",r*2),t("#favLinks").css("right",r*3)):(t("#workflowActivity").css("left",r),t("#fllupsScreen").css("left",r*2),t("#favLinks").css("left",r*3))}t("#vis_userDate").show()}else if(u<1e3){if(t("#workflowActivity").css("display")=="none"){var s=u*e,r=parseInt(s),f=u;t(".scrollerHorizontal").width(r);n.Application.isRTL?(t("#fllupsScreen").css("right",f),t("#favLinks").css("right",f*2)):(t("#fllupsScreen").css("left",f),t("#favLinks").css("left",f*2));t("#welcomeScreen,#fllupsScreen,#favLinks").width(f-20)}else if(t("#workflowActivity").css("display")=="block"){e=e+1;var s=u*e,r=parseInt(s),f=u;t(".scrollerHorizontal").width(r);et.scroll();t("#welcomeScreen,#fllupsScreen,#favLinks,#workflowActivity").width(f-20);n.Application.isRTL?(t("#workflowActivity").css("right",f),t("#fllupsScreen").css("right",f*2),t("#favLinks").css("right",f*3)):(t("#workflowActivity").css("left",f),t("#fllupsScreen").css("left",f*2),t("#favLinks").css("left",f*3))}t("#vis_userDate").hide()}}function pi(){fi.load(n.Application.contextUrl+"Home/Home",function(){function ur(i,r,u){ir.show();tr=!0;var f=n.Application.contextUrl+"Home/GetJSONFllups";t.ajax({url:f,data:{fllPageSize:i,fllPage:r,isRef:u},type:"GET",cache:!1,datatype:"json",success:function(i){var r=JSON.parse(i),f=0,o="",s="",h="",a,c,l,e;if(r.lstFollowups.length>0){u&&wi.text(r.FllCnt);for(a in r.lstFollowups){if(c=r.lstFollowups[f].ChatID+"-"+r.lstFollowups[f].RecordID+"-"+r.lstFollowups[f].SubscriberID+"-"+r.lstFollowups[f].TableID+"-"+r.lstFollowups[f].WinID+"-"+r.lstFollowups[f].TableName,r.lstFollowups[f].Cdate!=null&&r.lstFollowups[f].Cdate!=""&&(l=new Date(r.lstFollowups[f].Cdate),h=Globalize.format(l,"F",Globalize.cultureSelector)),r.lstFollowups[f].AD_Image_ID==0)s="<img  style='cursor:pointer;'  data-fll='UID' data-UID='"+r.lstFollowups[f].AD_User_ID+"' alt='"+n.Msg.getMsg("userImage")+"' title='"+n.Msg.getMsg("UserImage")+"' class='userAvatar-Feeds' src='"+n.Application.contextUrl+"Areas/VIS/Images/home/defaultUser46X46.png '/>";else for(e in r.lstUserImg)if(r.lstUserImg[e].AD_Image_ID==r.lstFollowups[f].AD_Image_ID){s=r.lstUserImg[e].UserImg!="NoRecordFound"&&r.lstUserImg[e].UserImg!="FileDoesn'tExist"&&r.lstUserImg[e].UserImg!=null?"<img  style='cursor:pointer;'   data-fll='UID' data-UID='"+r.lstFollowups[f].AD_User_ID+"' alt='"+n.Msg.getMsg("UserImage")+"' title='"+n.Msg.getMsg("UserImage")+"' class='userAvatar-Feeds' src='"+n.Application.contextUrl+r.lstUserImg[e].UserImg+"?"+new Date(t.now()).getSeconds()+"'/>":"<img  style='cursor:pointer;'  data-fll='UID' data-UID='"+r.lstFollowups[f].AD_User_ID+"' alt='"+n.Msg.getMsg("UserImage")+"' title='"+n.Msg.getMsg("UserImage")+"' class='userAvatar-Feeds' src='"+n.Application.contextUrl+"Areas/VIS/Images/home/defaultUser46X46.png '/>";break}o+="<div id="+c+" data-fll='divfllups' class='vis-feedContainer'><div class='vis-feedTitleBar'><h3> "+r.lstFollowups[f].WinName+" : "+r.lstFollowups[f].Identifier+" <\/h3><div class='vis-feedTitleBar-buttons'><ul><li> <a href='javascript:void(0)'  data-fll='azoomfllups'  title='"+n.Msg.getMsg("ViewFollowups")+"' class='vis-feedIcons vis-icon-viewFeed'>"+n.Msg.getMsg("ViewFollowups")+"<\/a><\/li><li> <a href='javascript:void(0)'  data-fll='asubscribefllups'  title='"+n.Msg.getMsg("UnsubscribeFollowups")+"' class='vis-feedIcons vis-icon-unsubscribeFeed'>"+n.Msg.getMsg("UnsubscribeFollowups")+" <\/a><\/li><\/ul> <\/div><\/div><div id='divfllcmntdata"+r.lstFollowups[f].ChatID+"' data-fll='fll-cmnt' class='vis-feedDetails'><div class='vis-feedDetails-cmnt' data-fll='fll-cmnt'>"+s+"<p> <strong data-fll='UID' data-UID='"+r.lstFollowups[f].AD_User_ID+"'>";o+=r.lstFollowups[f].AD_User_ID==n.Env.getCtx().getAD_User_ID()?n.Msg.getMsg("Me")+" <\/strong> <br />":r.lstFollowups[f].Name+"<\/strong> <br />";o+=n.Utility.encodeText(r.lstFollowups[f].ChatData)+"<\/p><p class='vis-feedDateTime'>"+h+"<\/p><\/div><\/div><a id='divfllvm_"+r.lstFollowups[f].ChatID+"'  data-fll='viewmorefllupscmnt' href='javascript:void(0)' class='vis-viewMoreComments'><span class='vis-feedIcons vis-icon-viewMoreComments'><\/span>"+n.Msg.getMsg("ViewMoreComments")+"...<\/a><a id='divfllvl_"+r.lstFollowups[f].ChatID+"' style='display:none;'  data-fll='viewlessfllupscmnt' href='javascript:void(0)' class='vis-viewMoreComments'><span class='vis-feedIcons vis-icon-viewMoreComments'><\/span>"+n.Msg.getMsg("ViewLessComments")+"...<\/a> <div class='clearfix'><\/div> <div id="+r.lstFollowups[f].ChatID+" class='vis-feedMessage'> <input id='txtFllCmnt"+r.lstFollowups[f].ChatID+"' data-fll='txtcmntfll' placeholder='"+n.Msg.getMsg("TypeMessage")+"' type='text' value='' /> <span  id='btnFllCmnt"+r.lstFollowups[f].ChatID+"' data-fll='btncmntfll' title='"+n.Msg.getMsg("PostMessage")+"'  class='vis-feedIcons vis-icon-message' ><\/span> <div class='clearfix'><\/div> <\/div><\/div> ";f++}rt.append(o)}else lr==!1&&(n.Application.isRTL?rt.append("<p style='margin-top: 200px;text-align: center '>"+n.Msg.getMsg("NoRecordFound")+"!!!<\/p>"):rt.append("<p style='margin-top: 200px;text-align: center '>"+n.Msg.getMsg("NoRecordFound")+"!!!<\/p>"));tr=!1;ir.hide()},error:function(){}})}function ar(i,r,u){var f=n.Application.contextUrl+"Home/GetJSONFllupsCmnt/";t.ajax({url:f,data:{FllupsID:i,fllCmntPageSize:r,fllCmntPage:u},type:"GET",cache:!1,datatype:"json",success:function(i){var r=JSON.parse(i),u=0,e="",c="",a=r.lstFollowups[u].ChatID,s="",o,l,f,h;for(o in r.lstFollowups){if(r.lstFollowups[o].Cdate!=null&&r.lstFollowups[o].Cdate!=""&&(l=new Date(r.lstFollowups[o].Cdate),c=Globalize.format(l,"F",Globalize.cultureSelector)),r.lstFollowups[u].AD_Image_ID==0)s="<img  style='cursor:pointer;'  data-fll='UID' data-UID='"+r.lstFollowups[u].AD_User_ID+"'  alt='"+n.Msg.getMsg("UserImage")+"'  title='"+n.Msg.getMsg("UserImage")+"' class='userAvatar-Feeds' src='"+n.Application.contextUrl+"Areas/VIS/Images/home/defaultUser46X46.png'/>";else for(f in r.lstUserImg)if(r.lstUserImg[f].AD_Image_ID==r.lstFollowups[u].AD_Image_ID){s=r.lstUserImg[f].UserImg!="NoRecordFound"&&r.lstUserImg[f].UserImg!="FileDoesn'tExist"&&r.lstUserImg[f].UserImg!=null?"<img style='cursor:pointer;'  data-fll='UID' data-UID='"+r.lstFollowups[u].AD_User_ID+"' alt='"+n.Msg.getMsg("UserImage")+"'  title='"+n.Msg.getMsg("UserImage")+"'  class='userAvatar-Feeds' src='"+r.lstUserImg[f].UserImg+"?"+new Date(t.now()).getSeconds()+"'/>":"<img  style='cursor:pointer;'  data-fll='UID' data-UID='"+r.lstFollowups[u].AD_User_ID+"'  alt='"+n.Msg.getMsg("UserImage")+"'  title='"+n.Msg.getMsg("UserImage")+"'  class='userAvatar-Feeds' src='"+n.Application.contextUrl+"Areas/VIS/Images/home/defaultUser46X46.png'/>";break}e+="<div class='vis-feedDetails-cmnt'  data-fll='fll-cmnt'>"+s+"<p> <strong  data-fll='UID' data-UID='"+r.lstFollowups[u].AD_User_ID+"'>";e+=r.lstFollowups[u].AD_User_ID==n.Env.getCtx().getAD_User_ID()?n.Msg.getMsg("Me")+" <\/strong> <br />":r.lstFollowups[u].Name+"<\/strong> <br />";e+=n.Utility.encodeText(r.lstFollowups[u].ChatData)+"<\/p><p class='vis-feedDateTime'>"+c+"<\/p><\/div>";u++}h=t("#divfllcmntdata"+a);h.html("");h.append(e)},error:function(){console.log("Error")}})}function fr(i,r){var u=n.Application.contextUrl+"Home/PostFllupsCmnt/";t.ajax({url:u,data:{fllChatID:yi,fllSubscriberID:nr,cmntTxt:i},type:"POST",cache:!1,datatype:"json",success:function(u){var s=new Date,h=Globalize.format(s,"F",Globalize.cultureSelector),f=u,c=n.context.getContext("##AD_User_Name"),e="",o;e=f!==null?f!="NoRecordFound"&&f!="FileDoesn'tExist"?"<img  style='cursor:pointer;'   data-fll='UID' data-UID='"+n.Env.getCtx().getAD_User_ID()+"'  alt='"+n.Msg.getMsg("UserImage")+"'  class='userAvatar-Feeds' src='"+f+"?"+new Date(t.now()).getSeconds()+"' />":"<img  style='cursor:pointer;'   data-fll='UID' data-UID='"+n.Env.getCtx().getAD_User_ID()+"' alt='"+n.Msg.getMsg("UserImage")+"'   class='userAvatar-Feeds' src='"+n.Application.contextUrl+"Areas/VIS/Images/home/defaultUser46X46.PNG '/>":"<img  style='cursor:pointer;'   data-fll='UID' data-UID='"+n.Env.getCtx().getAD_User_ID()+"' alt='"+n.Msg.getMsg("UserImage")+"'   class='userAvatar-Feeds' src='"+n.Application.contextUrl+"Areas/VIS/Images/home/defaultUser46X46.PNG '/>";o="<div class='vis-feedDetails-cmnt' data-fll='fll-cmnt'>"+e+"<p> <strong  data-fll='UID' data-UID='"+n.Env.getCtx().getAD_User_ID()+"'>"+n.Msg.getMsg("Me")+"<\/strong><br />"+n.Utility.encodeText(i)+"<\/p><p class='vis-feedDateTime'>"+h+"<\/p><\/div>";r.append(o)},error:function(){console.log("Error")}})}ft=!1;ht=!1;b=!1;f=!1;l=t("#sAlrtTxtType");h=t("#hAlrtTxtTypeCount");w=t("#ulHomeTabMenu");pt=t("#divTabMenuDataLoder");c=t("#spanWelcomeTabtopHdr");et=t("#dataContainer");rt=t("#fllupsList");yt=t("#workflowActivityData");ci=t("#userLinks-List");li=t("#userFavs-List");a=t("#hlnkTabDataRef");i=t("#welcomeScreenFeedsList");ai=t("#favLinks");r=1;y=t("#workflowActivity");wt=t("#divTabMenuDataLoder");ct=t("#workflowActivityDetails");ut=t("#hWelcomeScreenSwapHdr");p=t("#sNewNts");tt=t("#divNoticeCount");it=t("#divRequestCount");bt=t("#divNotesCount");kt=t("#divAptCount");ti=t("#divKPI");e=10;u=0;o=0;s=0;v();t(window).resize(v);t("div.vis-workflowActivityTitleBar-buttons ul li .vis-icon-check").on(n.Events.onTouchStartOrClick,function(){t("#workflowActivity").hide();t(".vis-activityContainer").removeClass("vis-activeFeed");v();et.scroll()});t("#btnWFAClose").on(n.Events.onTouchStartOrClick,function(){t("#workflowActivity").hide();t(".vis-activityContainer").removeClass("vis-activeFeed");v();et.scroll()});n.changeUserImage();t("#userFav-Tab").click(function(){t("#userLinks div").removeClass("row userLinks_activeTab");t("#userLinks div").addClass("row userLinks_inactiveTab");t("#userFavs div").removeClass("row userFavs_inactiveTab");t("#userFavs div").addClass("row userFavs_activeTab");t("#userLinks-List").hide("fast");t("#userFavs-List").show("fast",function(){setTimeout(function(){},0)})});t("#userLinks-Tab").click(function(){t("#userFavs div").removeClass("row userFavs_activeTab");t("#userFavs div").addClass("row userFavs_inactiveTab");t("#userLinks div").removeClass("row userLinks_inactiveTab");t("#userLinks div").addClass("row userLinks_activeTab");t("#userFavs-List").hide("fast");t("#userLinks-List").show("fast",function(){setTimeout(function(){},0)})});n.shortcutMgr.init(t("#userLinks-List"),t("#userFavs-List"));t(".vis-welcomeScreenFeeds").hide();t(".vis-icon-userfeeds").off("click");t(".vis-icon-userfeeds").on("click",function(){t(".vis-welcomeScreen-Data").hide("slow");t(".vis-welcomeScreenFeeds").show("fast",function(){setTimeout(function(){i.scroll()},0)})});t(".vis-welcomeScreenTab-notificationBubbles").on("click",function(){return!1});a.on("click",function(){if(f=!0,ft==!1&&r!=ei)if(r==lt)k=0,e=d,u=g,s=0,nt(),ri();else if(r==ii)y.hide(),v(),p.hide(),l.empty(),l.append(n.Msg.getMsg("WorkflowActivities")),h.empty(),h.append(t("#divfActivity").html()),ut.empty(),ut.append(n.Msg.getMsg("Activitiy")),nt(),k=0,e=d,u=g,s=0,ot==null&&(ot=new n.wfActivity(i,ct,yt,i)),ot.Load(!0);else if(r==st)k=0,e=d,u=g,s=0,nt(),ui();else if(r==dt)k=0,e=d,u=g,s=0,WSP.wspHomeMgr.viewWSPHome(dt,f);else if(r==gt)k=0,e=d,u=g,s=0,WSP.wspHomeMgr.viewWSPHome(gt,f);else{if(r==oi)return;r==at?(k=0,e=d,u=g,s=0,nt(),WSP.wspHomeMgr.viewWSPHome(at,f)):r==vt?(k=0,e=d,u=g,s=0,nt(),WSP.wspHomeMgr.viewWSPHome(vt,f)):r==si&&(y.hide(),v(),k=0,e=d,u=g,s=0,nt(),VADB.Apps.KpiHomeScreen(i,wt,p,y,ct,ut,ti))}});i.on("click",function(i){var s=t(i.target).data("vishomercrd"),f;if(r==st){if(i.target.tagName==="SPAN"&&s==="more"){if(t(i.target.parentNode.parentNode).data("vishomercrd")=="more-details"){var o=i.target.parentNode.parentNode.id,h=t("#snoticetitle_"+o),c=t("#snoticedesc_"+o),l=t("#snoticemore_"+o);l.hide();h.hide();c.show();t("#snoticeless_"+o).show()}}else if(t(i.target.parentNode.parentNode).data("vishomercrd")=="more-details"){var o=i.target.parentNode.parentNode.id,h=t("#snoticetitle_"+o),c=t("#snoticedesc_"+o),l=t("#snoticemore_"+o);l.show();h.show();c.hide();t("#snoticeless_"+o).hide()}if(s==="view"){var f=i.target.id,u=f.toString().split("|"),a=u[0],v=u[1],y=u[2],k=u[3],e=new n.Query;e.addRestriction(v+"_ID",n.Query.prototype.EQUAL,a);n.viewManager.startWindow(y,e)}else if(s==="liview"){var f=i.target.firstChild.id,u=f.toString().split("|"),a=u[0],v=u[1],y=u[2],k=u[3],e=new n.Query;e.addRestriction(v+"_ID",n.Query.prototype.EQUAL,a);n.viewManager.startWindow(y,e)}else s==="approve"?(f=i.target.id,hi(f,!0)):s==="liapprove"&&(f=i.target.firstChild.id,hi(f,!0))}else if(r==lt)if(s==="view"){var f=i.target.id,u=f.toString().split("|"),p=u[0],w=u[1],b=u[2],e=new n.Query;e.addRestriction(w+"_ID",n.Query.prototype.EQUAL,p);n.viewManager.startWindow(b,e)}else if(s==="liview"){var f=i.target.firstChild.id,u=f.toString().split("|"),p=u[0],w=u[1],b=u[2],e=new n.Query;e.addRestriction(w+"_ID",n.Query.prototype.EQUAL,p);n.viewManager.startWindow(b,e)}});i.bind("scroll",function(){if(t(this).scrollTop()+t(this).innerHeight()>=this.scrollHeight)if(b=!0,f=!1,r==ii)if(o=parseInt(t("#divfActivity").html()),s=u*e,s<=o&&ot!=null)u+=1,ot.AppendRecord(u,e);else return;else if(r==st)if(o=parseInt(tt.text()),s=u*e,u+=1,s<=o)ui();else return;else if(r==lt)if(o=parseInt(it.text()),s=u*e,u+=1,s<=o)ri();else return;else if(r==at)if(o=parseInt(kt.text()),s=u*e,u+=1,s<=o)WSP.wspHomeMgr.doScrollWSPHome(at,u,e);else return;else if(r==vt)if(o=parseInt(bt.text()),s=u*e,s<=o)u+=1,WSP.wspHomeMgr.doScrollWSPHome(vt,u,e);else return});var er=t("#hlnkFllupsRef"),wi=t("#follupsCount"),ir=t("#divFllMainLoder"),pi="",or="",fi="",sr=0,bi=10,ki=1,gi=0,rr=0,hr=10,cr=0,yi=0,nr=0,lr=!1,di=!1,tr=!1;rt.on("click",function(i){var f=t(i.target).data("fll"),u,e,o,c,s,r,h,l,a;if(f==="viewmorefllupscmnt")fi=i.target.parentNode.id,yi=0,nr=0,yi=i.target.parentNode.children[3].id,ar(fi,hr,cr),u=i.target.id,e=u.split("_"),t("#divfllvl_"+e[1]).show(),t("#"+u).hide();else if(f==="viewlessfllupscmnt")fi=i.target.parentNode.id,yi=0,nr=0,yi=i.target.parentNode.children[3].id,u=i.target.id,e=u.split("_"),t("#divfllvm_"+e[1]).show(),o=t("#divfllcmntdata"+e[1]),c=o.find("div:last-child"),o.empty(),o.html(c),t("#"+u).hide();else if(f==="azoomfllups")fi=i.target.parentNode.parentNode.parentNode.parentNode.parentNode.id,r=fi.toString().split("-"),s=new n.Query,s.addRestriction(r[5]+"_ID",n.Query.prototype.EQUAL,r[1]),n.viewManager.startWindow(r[4],s);else if(f==="asubscribefllups")fi=i.target.parentNode.parentNode.parentNode.parentNode.parentNode.id,r=fi.toString().split("-"),t.ajax({url:n.Application.contextUrl+"Subscribe/UnSubscribe",type:"GET",dataType:"Json",data:{AD_Window_ID:r[4],Record_ID:r[1],AD_Table_ID:r[3]},success:function(i){if(i==!1)alert(n.Msg.getMsg("UnSubscription Failed"));else{t("#"+fi).animate({width:"100%",height:"132px","margin-top":"-132px"},700,function(){t("#"+fi).remove()});var r=wi.text();wi.text(r-1)}}});else if(f==="btncmntfll")yi=i.target.parentNode.id,FllupsData=t("#"+i.target.parentNode.parentNode.children[1].id),pi=t("#"+i.target.previousElementSibling.id),or=t("#"+i.target.id),h=t(pi).val(),h!==""&&(l=new Date,a=Globalize.format(l,"F",Globalize.cultureSelector),fr(h,FllupsData),t(pi).val(""));else if(f=="UID"){var v=t(i.target).data("uid"),y=n.Env.getWindowNo(),p=new n.ContactInfo(v,y);p.show()}});rt.on("keydown",function(n){var u=t(n.target).data("fll"),i,r;u==="txtcmntfll"&&(fi=n.target.parentNode.parentNode.id,yi=n.target.parentNode.id,FllupsData=t("#"+n.target.parentNode.parentNode.children[1].id),pi=t("#"+n.target.id),i=t(pi).val(),i!==""&&i!==null&&(r=n.charCode||n.keyCode,r===vi&&(fr(i,FllupsData),t(pi).val(""))))});rt.bind("scroll",function(){if(t(this).scrollTop()+t(this).innerHeight()>=this.scrollHeight&&(di=!1,gi=wi.text(),gi>bi))if(rr=ki*bi,ki+=1,rr<=gi)ur(bi,ki,di);else return});er.on("click",function(){tr==!1&&(bi=10,ki=1,sr=wi.text(),di=!0,rt.empty(),ur(bi,ki,di))});w.off("click");ni();window.WSP?(ht=!0,WSP.wspHomeMgr.initWSPHome(i,w,ct,yt,y,wt,ut,p,l,h,kt,bt)):console.log("PleaseInstallWSPModule")})}function wi(){return{activeTabType:r}}function ri(){pt.show();ft=!0;t.ajax({url:n.Application.contextUrl+"Home/GetJSONHomeRequest",data:{pagesize:e,page:u,isTabDataRef:f},type:"GET",datatype:"json",cache:!1,success:function(t){var u=JSON.parse(t.data),v="",e,p,a,y,s,c,l;if(u.length>0){r==lt&&f&&(o=parseInt(t.count),it.empty(),it.show(),h.empty(),it.text(t.count),h.text(t.count));for(e in u)p="",(u[e].StartDate!=null||u[e].StartDate!="")&&(s=new Date(u[e].StartDate),p=Globalize.format(s,"d",Globalize.cultureSelector)),a="",u[e].NextActionDate!=null?(s=new Date(u[e].NextActionDate),a=Globalize.format(s,"d",Globalize.cultureSelector)):a="&nbsp;-----------",y="",(u[e].CreatedDate!=null||u[e].CreatedDate!="")&&(s=new Date(u[e].CreatedDate),y=Globalize.format(s,"F",Globalize.cultureSelector)),c=u[e].Summary,c.length>80&&(c=c.substr(0,80)+"..."),l=u[e].CaseType,l.length>30&&(l=l.substr(0,30)+"..."),v+="<div class='vis-activityContainer'><div class='vis-feedTitleBar'><h3>#"+u[e].DocumentNo+"<\/h3><div class='vis-feedTitleBar-buttons'><ul><li style='color:#999999; padding-top:10px; font-size:14px;'>"+u[e].Name+"<\/li><li data-vishomercrd='liview'><a href='javascript:void(0)' data-vishomercrd='view' id="+u[e].R_Request_ID+"|"+u[e].TableName+"|"+u[e].AD_Window_ID+"  title='"+n.Msg.getMsg("View")+"' class='vis-feedIcons vis-icon-viewFeed'> title='"+n.Msg.getMsg("View")+"'<\/a><\/li><\/ul><\/div><\/div><div  class='vis-feedDetails' style='margin: -5px 0px 0px 0px; width:100%;'><div class='vis-table-request'><ul><li><span>"+n.Msg.getMsg("Priority")+":<\/span><br>"+u[e].Priority+"<\/li><li><span>"+n.Msg.getMsg("Status")+":<\/span><br>"+u[e].Status+"<\/li><li><span>"+n.Msg.getMsg("NextActionDate")+":<\/span><br>"+a+"<\/li><\/ul><\/div><p class='vis-maintain-customer-p'><strong>"+n.Utility.encodeText(l)+" <\/strong><br /><span>"+n.Msg.getMsg("Message")+":<\/span><br>"+n.Utility.encodeText(c)+"<\/p><p class='vis-feedDateTime'  style=' width: 69%; margin-right: 10px;'>"+y+"<\/p><\/div><\/div>"}else i.find(".vis-table-request").length==0&&b==!1&&(v=n.Application.isRTL?"<p style=' margin-top:200px;text-align: center'>"+n.Msg.getMsg("NoRecordFound")+"<\/p>":"<p style=' margin-top:200px;text-align: center'>"+n.Msg.getMsg("NoRecordFound")+"<\/p>",it.empty(),h.empty(),it.text(0),it.hide(),h.text(0));ft=!1;ni();r==lt&&i.append(v);pt.hide()}})}function ui(){ft=!0;pt.show();t.ajax({url:n.Application.contextUrl+"Home/GetJSONHomeNotice",data:{pagesize:e,page:u,isTabDataRef:f},type:"GET",datatype:"json",success:function(t){var u=JSON.parse(t.data),s="",l=null,e,a,c,v;if(u.length>0){r==st&&f&&(o=parseInt(t.count),tt.empty(),tt.show(),h.empty(),tt.text(t.count),h.text(t.count));for(e in u)u[e].CDate!=null&&u[e].CDate!=""&&(a=new Date(u[e].CDate),l=Globalize.format(a,"F",Globalize.cultureSelector)),c="",v=u[e].Description,c=v.length<=100?"<p><strong style='color:#666666' data-vishomercrd='title' id='"+u[e].AD_Note_ID+"'>"+n.Utility.encodeText(u[e].Title)+"<\/strong><\/p>":"<p><strong  id='snoticetitle_"+u[e].AD_Note_ID+"'  style='color:#666666;' >"+n.Utility.encodeText(u[e].Title)+"...<\/strong><strong id='snoticedesc_"+u[e].AD_Note_ID+"' style='display:none; color:#666666;'>"+n.Utility.encodeText(u[e].Description)+"...<\/strong> <span id='snoticemore_"+u[e].AD_Note_ID+"' data-vishomercrd='more' style='color:gray; float:right;'>"+n.Msg.getMsg("more")+"<\/span><span id='snoticeless_"+u[e].AD_Note_ID+"' data-vishomercrd='less' style='display:none; color:gray; float:right;'>"+n.Msg.getMsg("less")+"<\/span><\/p>",s+="<div data-vishomercrd='view-recrd-cntainer' id='divrecdcntnr_"+u[e].AD_Note_ID+"' class='vis-activityContainer'> <div class='vis-feedTitleBar'><h3 style='color:#1b95d7;'>"+n.Utility.encodeText(u[e].MsgType)+"<\/h3> <div class='vis-feedTitleBar-buttons'>  <ul><li data-vishomercrd='liapprove'><a href='javascript:void(0)' data-vishomercrd='approve'  id="+u[e].AD_Note_ID+"  title='"+n.Msg.getMsg("Approve")+"' class='vis-feedIcons vis-icon-check'> title='"+n.Msg.getMsg("Approve")+"'<\/a><\/li><li data-vishomercrd='liview'><a href='javascript:void(0)' data-vishomercrd='view' id="+u[e].AD_Note_ID+"|"+u[e].TableName+"|"+u[e].AD_Window_ID+"|"+u[e].Record_ID+" title='"+n.Msg.getMsg("View")+"'  class='vis-feedIcons vis-icon-viewFeed'>title='"+n.Msg.getMsg("View")+"'<\/a><\/li><\/ul>  <\/div><\/div><div data-vishomercrd='more-details' id="+u[e].AD_Note_ID+" class='vis-feedDetails'>"+c+" <p class='vis-feedDateTime'>"+n.Utility.encodeText(l)+"<\/p> <\/div> <\/div>"}else i.find(".vis-feedTitleBar").length==0&&(s=n.Application.isRTL?"<p style=' margin-top:200px;text-align: center'>"+n.Msg.getMsg("NoRecordFound")+"<\/p>":"<p style=' margin-top:200px;text-align: center'>"+n.Msg.getMsg("NoRecordFound")+"<\/p>",r==st&&(tt.empty(),h.empty(),tt.hide(),tt.text(t.count),h.text(t.count)));ft=!1;ni();pt.hide();r==st&&i.append(s)}})}function hi(i,r){t.ajax({url:n.Application.contextUrl+"Home/ApproveNotice",data:{Ad_Note_ID:i,isAcknowldge:r},type:"POST",datatype:"json",success:function(n){var r=JSON.parse(n);t("#divrecdcntnr_"+i).animate({width:"0px",height:"132px","margin-left":"800px"},700,"",function(){t("#divrecdcntnr_"+i).remove()})}})}function ni(){w.off("click");w.on("click",function(rt){var et,pt;a.show();i.css({"margin-left":"auto","margin-top":"auto"});t(".vis-welcomeScreenTabMenu li").removeClass("vis-activeTab");rt.target.nodeName=="LI"?t(rt.target).addClass("vis-activeTab"):rt.target.nodeName=="A"&&t(rt.target.parentNode).addClass("vis-activeTab");et=t(rt.target).data("vishome");et==="userprofile"?(c.show(),c.css("background-position","0px 0px"),r=ei,b=!1,f=!0,t("li .vis-welcomeScreenTab-notificationBubbles").removeClass("blank").addClass("vis-feedsAlert"),t("li:first-child .vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"),t("li:last-child .vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"),t(".vis-welcomeScreenContainer > div").fadeOut("fast"),t(".vis-welcomeScreen-Data").fadeIn("fast"),p.hide(),y.hide(),v()):et==="KPI"?(t(".vis-welcomeScreen-Data").hide("fast"),t(".vis-welcomeScreenFeeds").fadeIn("fast",function(){setTimeout(function(){},0)}),l.html(""),c.show(),l.html(n.Msg.getMsg("KPI")),c.css("background-position","0px -537px"),window.VADB&&window.VADB!=null&&VADB.Apps.KpiHomeScreen!=undefined?(i.css({"text-align":"auto"}),r=si,b=!1,f=!0,t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"),a.css("margin-right","17px"),w.off("click"),VADB.Apps.KpiHomeScreen(i,wt,p,y,ct,ut,ti),y.hide(),v(),p.show()):(a.hide(),i.html(n.Msg.getMsg("PleaseInstallVADashboard")),n.Application.isRTL?i.css({"text-align":"center","margin-top":"200px"}):i.css({"text-align":"center","margin-top":"200px"}))):et==="workflow"?(c.show(),w.off("click"),i.css("overflow-y","auto"),r=ii,b=!1,f=!0,a.css("margin-right","17px"),c.css("background-position","0px -76px"),t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"),t(".vis-welcomeScreen-Data").hide("slow"),t(".vis-welcomeScreenFeeds").fadeIn("fast",function(){setTimeout(function(){},0)}),y.hide(),v(),p.hide(),l.empty(),l.append(n.Msg.getMsg("WorkflowActivities")),h.empty(),h.append(t("#divfActivity").html()),ut.empty(),ut.append(n.Msg.getMsg("Activitiy")),nt(),k=0,e=d,u=g,s=0,ot=new n.wfActivity(i,ct,yt,i),ot.Load(!1)):et==="notice"?(c.show(),w.off("click"),r=st,b=!1,f=!0,a.css("margin-right","17px"),i.css("overflow-y","auto"),c.css("background-position","0px -143px"),t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"),t(".vis-welcomeScreen-Data").hide("slow"),t(".vis-welcomeScreenFeeds").fadeIn("fast",function(){setTimeout(function(){},0)}),l.html(n.Msg.getMsg("Notice")),p.hide(),o=parseInt(tt.text()),tt.text(o),h.text(o),ft==!1&&(k=0,e=10,u=1,s=0,nt(),ui()),y.hide(),v()):et==="mytask"?(t(".vis-welcomeScreen-Data").hide("slow"),t(".vis-welcomeScreenFeeds").fadeIn("fast",function(){setTimeout(function(){},0)}),l.html(""),l.html(n.Msg.getMsg("MyTask")),c.css("background-position","0px -406px"),ht?(i.css({"text-align":"auto"}),w.off("click"),c.show(),r=dt,b=!1,f=!1,i.css("overflow-y","hidden"),t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"),p.show(),h.html(t("#divMyTaskCount").html()),a.css("margin-right","17px"),WSP.wspHomeMgr.viewWSPHome(dt,f),y.hide(),v()):(a.hide(),i.html(n.Msg.getMsg("PleaseInstallWSPModule")),n.Application.isRTL?i.css({"text-align":"center","margin-top":"200px"}):i.css({"text-align":"center","margin-top":"200px"}))):et==="taskassignbyme"?(t(".vis-welcomeScreen-Data").hide("slow"),t(".vis-welcomeScreenFeeds").fadeIn("fast",function(){setTimeout(function(){},0)}),l.html(""),l.html(n.Msg.getMsg("TaskAssignByMe")),c.css("background-position","0px -340px"),ht?(i.css({"text-align":"auto"}),c.show(),w.off("click"),b=!1,f=!1,r=gt,i.css("overflow-y","hidden"),t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"),p.show(),h.html(parseInt(t("#divTaskAssignBymeCount").html())),a.css("margin-right","17px"),WSP.wspHomeMgr.viewWSPHome(gt,f),y.hide(),v()):(a.hide(),i.html(n.Msg.getMsg("PleaseInstallWSPModule")),n.Application.isRTL?i.css({"text-align":"center","margin-top":"200px"}):i.css({"text-align":"center","margin-top":"200px"}))):et==="documentrecive"?(c.show(),a.css("margin-right","17px"),a.hide(),r=oi,b=!1,f=!0,y.hide(),v(),i.css("overflow-y","auto"),l.html(n.Msg.getMsg("Documents")),o=0,h.html(o),c.css("background-position-y","-603px"),t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"),t(".vis-welcomeScreen-Data").hide("slow"),t(".vis-welcomeScreenFeeds").fadeIn("fast",function(){setTimeout(function(){},0)}),nt(),pt="<p style=' margin-top:200px;text-align:center'>"+n.Msg.getMsg("PleaseInstallDMSModule")+"<\/p>",i.html(pt),p.hide()):et==="request"?(c.show(),w.off("click"),r=lt,b=!1,f=!0,i.css("overflow-y","auto"),c.css("background-position","0px -209px"),t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"),t(".vis-welcomeScreen-Data").hide("slow"),t(".vis-welcomeScreenFeeds").fadeIn("fast",function(){setTimeout(function(){},0)}),p.hide(),a.css("margin-right","17px"),l.html(n.Msg.getMsg("Requests")),o=parseInt(it.text()),h.html(o),ft==!1&&(k=0,e=d,u=g,s=0,nt(),ri()),y.hide(),v()):et==="appointments"?(t(".vis-welcomeScreen-Data").hide("slow"),t(".vis-welcomeScreenFeeds").fadeIn("fast",function(){setTimeout(function(){},0)}),l.html(""),l.html(n.Msg.getMsg("Appointment")),c.css("background-position","0px -275px"),ht?(i.css({"text-align":"auto"}),w.off("click"),c.show(),r=at,b=!1,f=!0,a.css("margin-right","17px"),i.css("overflow-y","auto"),t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"),p.hide(),o=parseInt(kt.text()),h.html(o),k=0,e=d,u=g,s=0,WSP.wspHomeMgr.viewWSPHome(at,f),y.hide(),v()):(a.hide(),i.html(n.Msg.getMsg("PleaseInstallWSPModule")),n.Application.isRTL?i.css({"text-align":"center","margin-top":"200px"}):i.css({"text-align":"center","margin-top":"200px"}))):et==="notes"&&(t(".vis-welcomeScreen-Data").hide("slow"),t(".vis-welcomeScreenFeeds").fadeIn("fast",function(){setTimeout(function(){},0)}),l.html(""),l.html(n.Msg.getMsg("MyNotes")),c.css("background-position","0px -473px"),ht?(i.css({"text-align":"auto"}),w.off("click"),r=vt,c.show(),b=!1,f=!0,a.css("margin-right","17px"),i.css("overflow-y","auto"),t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"),p.show(),o=parseInt(bt.text()),h.html(o),k=0,e=d,u=g,s=0,nt(),WSP.wspHomeMgr.viewWSPHome(vt,f),y.hide(),v()):(a.hide(),i.html(n.Msg.getMsg("PleaseInstallWSPModule")),n.Application.isRTL?i.css({"text-align":"center","margin-top":"200px"}):i.css({"text-align":"center","margin-top":"200px"})))})}function nt(){i.children().length>0&&i.children().remove();i.empty()}var fi=null,et=null,rt=null,yt=null,ci=null,li=null,i=null,a=null,ai=null,r=null,y=null,ht=null,wt=null,ct=null,ut=null,ot=null,ft=null,f=null,w=null,pt=null,tt=null,it=null,bt=null,kt=null,ti=null,l=null,h=null,c=null,vi=13,ei=1,lt=2,ii=3,at=4,dt=5,gt=6,oi=7,st=8,vt=9,si=10,d=10,g=1,b=null,k=null,e=null,u=null,o=null,s=null,p=null;return t(".vis-icon-Info-Home").click(function(){n.InfoMenu.show(t(this))}),{initHome:yi,adjustDivSize:v,BindMenuClick:ni,getActiveTab:wi}}n.HomeMgr=i()}(VIS,jQuery),function(n,t){function i(){function e(){i=t("#vis-textStatus");t.ajax({url:n.Application.contextUrl+"Home/SaveStatus",dataType:"json",type:"POST",async:!1,data:{status:i.val()},success:function(n){JSON.parse(n).length>0?(i.css("visibility","hidden"),f.css("visibility","hidden"),u.css("visibility","hidden"),r.css("visibility","visible"),r.text(JSON.parse(n))):(i.css("visibility","visible"),f.css("visibility","hidden"),u.css("visibility","hidden"),r.css("visibility","visible"),r.text(JSON.parse(n)))}})}var i=t("#vis-textStatus"),u=t("#vis-img-OKStatus"),f=t("#vis-img-CancelStatus"),r=t("#vis-labelStatus");t("#vis-file-input").change(function(){if(document.getElementById("vis-file-input").files[0]!=null){var i=new XMLHttpRequest,r=new FormData;r.append("file",document.getElementById("vis-file-input").files[0]);i.open("POST",n.Application.contextUrl+"Home/SaveImageAsByte",!0);i.send(r);i.addEventListener("load",function(n){var i=n.target.response,r=JSON.parse(i),u=JSON.parse(r);t("#imgUsrImage").attr("src","data:image/jpg;base64,"+u)},!1)}});u.on("click",function(){e()});f.on("click",function(){i.css("visibility","hidden");f.css("visibility","hidden");u.css("visibility","hidden");r.css("visibility","visible")});i.on("focus",function(){f.css("visibility","visible");u.css("visibility","visible")});i.on("keypress",function(n){var t=n.keyCode||n.which;t==13&&e()});i.on("blur",function(){});r.on("click",function(){r.css("visibility","hidden");i.css("visibility","visible");i.val(r.text());i.focus()})}n.changeUserImage=i}(VIS,jQuery),function(n,t){function r(){function o(t,i){f=t;r=f.find("#vis_linkScroll");n.favMgr.init(i);s();h()}function s(){n.dataContext.getJSONData(n.Application.contextUrl+"Home/GetShortcutItems",null,function(t){var i,f,e;for(u=t,i=null,f='<ul class="vis-userLinks-ListMenu">',e=0;e<t.length;e++)i=t[e],f+='<li data-index="'+e+'" ><a data-index="'+e+'" href="javascript:void(0)"><img data-index="'+e+'" style="width: 54px;height: 63px;margin-bottom: 10px;margin-right: auto;margin-left: auto;display:block;" src="',i.HasImage&&(f+=i.IsImageByteArray?"data:image/*;base64,"+i.IconBytes:n.Application.contextUrl+i.IconUrl),f+='" />',f+=i.ShortcutName+"<\/a><\/li>";f+="<\/ul>";r.empty();r.html(f);c(t.length)})}function h(){r.on("click",function(r){var o=t(r.target).data("index"),f,h,s,a,l,c;if((o||o=="0")&&o<u.length)if(f=u[o],f.HasChild)h=new i(f.KeyID),h.show(),h=null;else if(f.Url||f.Url.length>0)n.Env.startBrowser(f.Url);else if(f.SpecialAction&&f.SpecialAction.length>0){s=f.SpecialAction;a=f.ActionName;try{l=n.Utility.getFunctionByName(s,window);c=new l;c.show();c=null}catch(r){return e.log(n.Logging.Level.WARNING,"Class="+s+", Action Class Name="+s,r),!1}}else{if(f.Action==null||f.Action.length<=0||f.ActionID<1)return;n.viewManager.startAction(f.Action,f.ActionID)}})}function c(i){var r=t("#userLinks-Tab");r.empty();r.append(t("<span class='vis-linksIcons vis-icon-link'>"));r.append(n.Msg.getMsg("Links")+" - ");r.append(t("<strong>").append(i));r=null}var f,r,u=null,e=n.Logging.VLogger.getVLogger("ShortCut");return{init:o}}function i(i){function s(){n.dataContext.getJSONData(n.Application.contextUrl+"Home/GetSettingItems",{AD_Shortcut_ID:i},function(t){var i,r,e;for(u=t,i=null,r='<ul class="vis-userLinks-ListMenu">',e=0;e<t.length;e++)i=t[e],r+='<li data-index="'+e+'" ><a data-index="'+e+'" href="javascript:void(0)"><img data-index="'+e+'" style="width: 54px;margin-bottom: 10px;height: 63px;display:block;" src="',i.HasImage&&(r+=i.IsImageByteArray?"data:image/*;base64,"+i.IconBytes:n.Application.contextUrl+i.IconUrl),r+='" />',r+=i.ShortcutName+"<\/a><\/li>";r+="<\/ul>";f.empty();f.html(r);h()})}function h(){f.on("click",function(i){var e=t(i.target).data("index"),f,s,l,c,h;if((e||e=="0")&&e<u.length){if(f=u[e],f.HasChild)alert("setting Dialog");else if(f.Url||f.Url.length>0)n.Env.startBrowser(f.Url);else if(f.SpecialAction&&f.SpecialAction.length>0){s=f.SpecialAction;l=f.ActionName;try{c=n.Utility.getFunctionByName(s,window);h=new c;h.show();h=null}catch(i){return o.log(n.Logging.Level.WARNING,"Class="+s+", Action Class Name="+s,i),!1}}else{if(f.Action==null||f.Action.length<=0||f.ActionID<1)return;n.viewManager.startAction(f.Action,f.ActionID)}r.close()}})}var e=t("<div>"),f=t('<div  class="scrollerVertical" style="width:auto">').html('<div class="vis-apanel-busy" style="height:280px;position:static"> <\/div>'),o=n.Logging.VLogger.getVLogger("SettingDialog"),r,u;e.append(f);r=null;u=null;this.show=function(){r=new n.ChildDialog;r.setWidth(540);r.setHeight(400);r.setTitle(n.Msg.getMsg("Setting"));r.setContent(e);r.show()};this.disposeComponent=function(){f.off("click");f.remove();u&&(u.length=0);u=null;this.show=null;e=null;r&&r.dispose()};s()}i.prototype.dispose=function(){this.disposeComponent()};n.shortcutMgr=r()}(VIS,jQuery),function(n,t){var i=n.historyMgr||{},r;"replaceState"in history?i.replaceHash=function(n){(""+n).charAt(0)!=="#"&&(n="#"+n);history.replaceState("","",n)}:(r=location.hash,i.replaceHash=function(n){location.hash!==r&&history.back();location.hash=n});i.updateHistory=function(n){i.replaceHash(n)};i.restoreHistory=function(){var n=i.geHashtLocation();t.viewManager.restoreActions(n)};i.geHashtLocation=function(){var n=location.hash;return n.length>1?n.substring(1):""};n.historyMgr=i}(window,VIS);var CryptoJS=CryptoJS||function(n,t){var u={},f=u.lib={},o=function(){},i=f.Base={extend:function(n){o.prototype=this;var t=new o;return n&&t.mixIn(n),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var n=this.extend();return n.init.apply(n,arguments),n},init:function(){},mixIn:function(n){for(var t in n)n.hasOwnProperty(t)&&(this[t]=n[t]);n.hasOwnProperty("toString")&&(this.toString=n.toString)},clone:function(){return this.init.prototype.extend(this)}},r=f.WordArray=i.extend({init:function(n,i){n=this.words=n||[];this.sigBytes=i!=t?i:4*n.length},toString:function(n){return(n||l).stringify(this)},concat:function(n){var i=this.words,r=n.words,u=this.sigBytes,t;if(n=n.sigBytes,this.clamp(),u%4)for(t=0;t<n;t++)i[u+t>>>2]|=(r[t>>>2]>>>24-8*(t%4)&255)<<24-8*((u+t)%4);else if(65535<r.length)for(t=0;t<n;t+=4)i[u+t>>>2]=r[t>>>2];else i.push.apply(i,r);return this.sigBytes+=n,this},clamp:function(){var i=this.words,t=this.sigBytes;i[t>>>2]&=4294967295<<32-8*(t%4);i.length=n.ceil(t/4)},clone:function(){var n=i.clone.call(this);return n.words=this.words.slice(0),n},random:function(t){for(var i=[],u=0;u<t;u+=4)i.push(4294967296*n.random()|0);return new r.init(i,t)}}),e=u.enc={},l=e.Hex={stringify:function(n){var u=n.words,i,t,r;for(n=n.sigBytes,i=[],t=0;t<n;t++)r=u[t>>>2]>>>24-8*(t%4)&255,i.push((r>>>4).toString(16)),i.push((r&15).toString(16));return i.join("")},parse:function(n){for(var i=n.length,u=[],t=0;t<i;t+=2)u[t>>>3]|=parseInt(n.substr(t,2),16)<<24-4*(t%8);return new r.init(u,i/2)}},s=e.Latin1={stringify:function(n){var r=n.words,i,t;for(n=n.sigBytes,i=[],t=0;t<n;t++)i.push(String.fromCharCode(r[t>>>2]>>>24-8*(t%4)&255));return i.join("")},parse:function(n){for(var i=n.length,u=[],t=0;t<i;t++)u[t>>>2]|=(n.charCodeAt(t)&255)<<24-8*(t%4);return new r.init(u,i)}},a=e.Utf8={stringify:function(n){try{return decodeURIComponent(escape(s.stringify(n)))}catch(t){throw Error("Malformed UTF-8 data");}},parse:function(n){return s.parse(unescape(encodeURIComponent(n)))}},h=f.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new r.init;this._nDataBytes=0},_append:function(n){"string"==typeof n&&(n=a.parse(n));this._data.concat(n);this._nDataBytes+=n.sigBytes},_process:function(t){var e=this._data,s=e.words,u=e.sigBytes,o=this.blockSize,f=u/(4*o),f=t?n.ceil(f):n.max((f|0)-this._minBufferSize,0),i;if(t=f*o,u=n.min(4*t,u),t){for(i=0;i<t;i+=o)this._doProcessBlock(s,i);i=s.splice(0,t);e.sigBytes-=u}return new r.init(i,u)},clone:function(){var n=i.clone.call(this);return n._data=this._data.clone(),n},_minBufferSize:0}),c;return f.Hasher=h.extend({cfg:i.extend(),init:function(n){this.cfg=this.cfg.extend(n);this.reset()},reset:function(){h.reset.call(this);this._doReset()},update:function(n){return this._append(n),this._process(),this},finalize:function(n){return n&&this._append(n),this._doFinalize()},blockSize:16,_createHelper:function(n){return function(t,i){return new n.init(i).finalize(t)}},_createHmacHelper:function(n){return function(t,i){return new c.HMAC.init(n,i).finalize(t)}}}),c=u.algo={},u}(Math);(function(){var n=CryptoJS,t=n.lib.WordArray;n.enc.Base64={stringify:function(n){var i=n.words,u=n.sigBytes,f=this._map,t,e,r;for(n.clamp(),n=[],t=0;t<u;t+=3)for(e=(i[t>>>2]>>>24-8*(t%4)&255)<<16|(i[t+1>>>2]>>>24-8*((t+1)%4)&255)<<8|i[t+2>>>2]>>>24-8*((t+2)%4)&255,r=0;4>r&&t+.75*r<u;r++)n.push(f.charAt(e>>>6*(3-r)&63));if(i=f.charAt(64))for(;n.length%4;)n.push(i);return n.join("")},parse:function(n){var e=n.length,f=this._map,i=f.charAt(64),o,s;i&&(i=n.indexOf(i),-1!=i&&(e=i));for(var i=[],u=0,r=0;r<e;r++)r%4&&(o=f.indexOf(n.charAt(r-1))<<2*(r%4),s=f.indexOf(n.charAt(r))>>>6-2*(r%4),i[u>>>2]|=(o|s)<<24-8*(u%4),u++);return t.create(i,u)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})(),function(n){function i(n,t,i,r,u,f,e){return n=n+(t&i|~t&r)+u+e,(n<<f|n>>>32-f)+t}function r(n,t,i,r,u,f,e){return n=n+(t&r|i&~r)+u+e,(n<<f|n>>>32-f)+t}function u(n,t,i,r,u,f,e){return n=n+(t^i^r)+u+e,(n<<f|n>>>32-f)+t}function f(n,t,i,r,u,f,e){return n=n+(i^(t|~r))+u+e,(n<<f|n>>>32-f)+t}for(var o=CryptoJS,e=o.lib,c=e.WordArray,s=e.Hasher,e=o.algo,t=[],h=0;64>h;h++)t[h]=4294967296*n.abs(n.sin(h+1))|0;e=e.MD5=s.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(n,e){for(var v,a,l=0;16>l;l++)v=e+l,a=n[v],n[v]=(a<<8|a>>>24)&16711935|(a<<24|a>>>8)&4278255360;var l=this._hash.words,v=n[e+0],a=n[e+1],y=n[e+2],p=n[e+3],w=n[e+4],b=n[e+5],k=n[e+6],d=n[e+7],g=n[e+8],nt=n[e+9],tt=n[e+10],it=n[e+11],rt=n[e+12],ut=n[e+13],ft=n[e+14],et=n[e+15],o=l[0],s=l[1],h=l[2],c=l[3],o=i(o,s,h,c,v,7,t[0]),c=i(c,o,s,h,a,12,t[1]),h=i(h,c,o,s,y,17,t[2]),s=i(s,h,c,o,p,22,t[3]),o=i(o,s,h,c,w,7,t[4]),c=i(c,o,s,h,b,12,t[5]),h=i(h,c,o,s,k,17,t[6]),s=i(s,h,c,o,d,22,t[7]),o=i(o,s,h,c,g,7,t[8]),c=i(c,o,s,h,nt,12,t[9]),h=i(h,c,o,s,tt,17,t[10]),s=i(s,h,c,o,it,22,t[11]),o=i(o,s,h,c,rt,7,t[12]),c=i(c,o,s,h,ut,12,t[13]),h=i(h,c,o,s,ft,17,t[14]),s=i(s,h,c,o,et,22,t[15]),o=r(o,s,h,c,a,5,t[16]),c=r(c,o,s,h,k,9,t[17]),h=r(h,c,o,s,it,14,t[18]),s=r(s,h,c,o,v,20,t[19]),o=r(o,s,h,c,b,5,t[20]),c=r(c,o,s,h,tt,9,t[21]),h=r(h,c,o,s,et,14,t[22]),s=r(s,h,c,o,w,20,t[23]),o=r(o,s,h,c,nt,5,t[24]),c=r(c,o,s,h,ft,9,t[25]),h=r(h,c,o,s,p,14,t[26]),s=r(s,h,c,o,g,20,t[27]),o=r(o,s,h,c,ut,5,t[28]),c=r(c,o,s,h,y,9,t[29]),h=r(h,c,o,s,d,14,t[30]),s=r(s,h,c,o,rt,20,t[31]),o=u(o,s,h,c,b,4,t[32]),c=u(c,o,s,h,g,11,t[33]),h=u(h,c,o,s,it,16,t[34]),s=u(s,h,c,o,ft,23,t[35]),o=u(o,s,h,c,a,4,t[36]),c=u(c,o,s,h,w,11,t[37]),h=u(h,c,o,s,d,16,t[38]),s=u(s,h,c,o,tt,23,t[39]),o=u(o,s,h,c,ut,4,t[40]),c=u(c,o,s,h,v,11,t[41]),h=u(h,c,o,s,p,16,t[42]),s=u(s,h,c,o,k,23,t[43]),o=u(o,s,h,c,nt,4,t[44]),c=u(c,o,s,h,rt,11,t[45]),h=u(h,c,o,s,et,16,t[46]),s=u(s,h,c,o,y,23,t[47]),o=f(o,s,h,c,v,6,t[48]),c=f(c,o,s,h,d,10,t[49]),h=f(h,c,o,s,ft,15,t[50]),s=f(s,h,c,o,b,21,t[51]),o=f(o,s,h,c,rt,6,t[52]),c=f(c,o,s,h,p,10,t[53]),h=f(h,c,o,s,tt,15,t[54]),s=f(s,h,c,o,a,21,t[55]),o=f(o,s,h,c,g,6,t[56]),c=f(c,o,s,h,et,10,t[57]),h=f(h,c,o,s,k,15,t[58]),s=f(s,h,c,o,ut,21,t[59]),o=f(o,s,h,c,w,6,t[60]),c=f(c,o,s,h,it,10,t[61]),h=f(h,c,o,s,y,15,t[62]),s=f(s,h,c,o,nt,21,t[63]);l[0]=l[0]+o|0;l[1]=l[1]+s|0;l[2]=l[2]+h|0;l[3]=l[3]+c|0},_doFinalize:function(){var u=this._data,r=u.words,t=8*this._nDataBytes,i=8*u.sigBytes,f;for(r[i>>>5]|=128<<24-i%32,f=n.floor(t/4294967296),r[(i+64>>>9<<4)+15]=(f<<8|f>>>24)&16711935|(f<<24|f>>>8)&4278255360,r[(i+64>>>9<<4)+14]=(t<<8|t>>>24)&16711935|(t<<24|t>>>8)&4278255360,u.sigBytes=4*(r.length+1),this._process(),u=this._hash,r=u.words,t=0;4>t;t++)i=r[t],r[t]=(i<<8|i>>>24)&16711935|(i<<24|i>>>8)&4278255360;return u},clone:function(){var n=s.clone.call(this);return n._hash=this._hash.clone(),n}});o.MD5=s._createHelper(e);o.HmacMD5=s._createHmacHelper(e)}(Math),function(){var t=CryptoJS,n=t.lib,i=n.Base,r=n.WordArray,n=t.algo,u=n.EvpKDF=i.extend({cfg:i.extend({keySize:4,hasher:n.MD5,iterations:1}),init:function(n){this.cfg=this.cfg.extend(n)},compute:function(n,t){for(var i,o,u=this.cfg,f=u.hasher.create(),e=r.create(),h=e.words,s=u.keySize,u=u.iterations;h.length<s;){for(i&&f.update(i),i=f.update(n).finalize(t),f.reset(),o=1;o<u;o++)i=f.finalize(i),f.reset();e.concat(i)}return e.sigBytes=4*s,e}});t.EvpKDF=function(n,t,i){return u.create(i).compute(n,t)}}();CryptoJS.lib.Cipher||function(n){var i=CryptoJS,t=i.lib,f=t.Base,e=t.WordArray,c=t.BufferedBlockAlgorithm,l=i.enc.Base64,y=i.algo.EvpKDF,s=t.Cipher=c.extend({cfg:f.extend(),createEncryptor:function(n,t){return this.create(this._ENC_XFORM_MODE,n,t)},createDecryptor:function(n,t){return this.create(this._DEC_XFORM_MODE,n,t)},init:function(n,t,i){this.cfg=this.cfg.extend(i);this._xformMode=n;this._key=t;this.reset()},reset:function(){c.reset.call(this);this._doReset()},process:function(n){return this._append(n),this._process()},finalize:function(n){return n&&this._append(n),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(n){return{encrypt:function(t,i,r){return("string"==typeof i?v:u).encrypt(n,t,i,r)},decrypt:function(t,i,r){return("string"==typeof i?v:u).decrypt(n,t,i,r)}}}});t.StreamCipher=s.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var o=i.mode={},a=function(t,i,r){var f=this._iv,u;for(f?this._iv=n:f=this._prevBlock,u=0;u<r;u++)t[i+u]^=f[u]},r=(t.BlockCipherMode=f.extend({createEncryptor:function(n,t){return this.Encryptor.create(n,t)},createDecryptor:function(n,t){return this.Decryptor.create(n,t)},init:function(n,t){this._cipher=n;this._iv=t}})).extend();r.Encryptor=r.extend({processBlock:function(n,t){var i=this._cipher,r=i.blockSize;a.call(this,n,t,r);i.encryptBlock(n,t);this._prevBlock=n.slice(t,t+r)}});r.Decryptor=r.extend({processBlock:function(n,t){var i=this._cipher,r=i.blockSize,u=n.slice(t,t+r);i.decryptBlock(n,t);a.call(this,n,t,r);this._prevBlock=u}});o=o.CBC=r;r=(i.pad={}).Pkcs7={pad:function(n,t){for(var i=4*t,i=i-n.sigBytes%i,f=i<<24|i<<16|i<<8|i,r=[],u=0;u<i;u+=4)r.push(f);i=e.create(r,i);n.concat(i)},unpad:function(n){n.sigBytes-=n.words[n.sigBytes-1>>>2]&255}};t.BlockCipher=s.extend({cfg:s.cfg.extend({mode:o,padding:r}),reset:function(){var t;s.reset.call(this);var n=this.cfg,i=n.iv,n=n.mode;this._xformMode==this._ENC_XFORM_MODE?t=n.createEncryptor:(t=n.createDecryptor,this._minBufferSize=1);this._mode=t.call(n,this,i&&i.words)},_doProcessBlock:function(n,t){this._mode.processBlock(n,t)},_doFinalize:function(){var t=this.cfg.padding,n;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),n=this._process(!0)):(n=this._process(!0),t.unpad(n)),n},blockSize:4});var h=t.CipherParams=f.extend({init:function(n){this.mixIn(n)},toString:function(n){return(n||this.formatter).stringify(this)}}),o=(i.format={}).OpenSSL={stringify:function(n){var t=n.ciphertext;return n=n.salt,(n?e.create([1398893684,1701076831]).concat(n).concat(t):t).toString(l)},parse:function(n){var t,i;return n=l.parse(n),t=n.words,1398893684==t[0]&&1701076831==t[1]&&(i=e.create(t.slice(2,4)),t.splice(0,4),n.sigBytes-=16),h.create({ciphertext:n,salt:i})}},u=t.SerializableCipher=f.extend({cfg:f.extend({format:o}),encrypt:function(n,t,i,r){r=this.cfg.extend(r);var u=n.createEncryptor(i,r);return t=u.finalize(t),u=u.cfg,h.create({ciphertext:t,key:i,iv:u.iv,algorithm:n,mode:u.mode,padding:u.padding,blockSize:n.blockSize,formatter:r.format})},decrypt:function(n,t,i,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),n.createDecryptor(i,r).finalize(t.ciphertext)},_parse:function(n,t){return"string"==typeof n?t.parse(n,this):n}}),i=(i.kdf={}).OpenSSL={execute:function(n,t,i,r){return r||(r=e.random(8)),n=y.create({keySize:t+i}).compute(n,r),i=e.create(n.words.slice(t),4*i),n.sigBytes=4*t,h.create({key:n,iv:i,salt:r})}},v=t.PasswordBasedCipher=u.extend({cfg:u.cfg.extend({kdf:i}),encrypt:function(n,t,i,r){return r=this.cfg.extend(r),i=r.kdf.execute(i,n.keySize,n.ivSize),r.iv=i.iv,n=u.encrypt.call(this,n,t,i.key,r),n.mixIn(i),n},decrypt:function(n,t,i,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),i=r.kdf.execute(i,n.keySize,n.ivSize,t.salt),r.iv=i.iv,u.decrypt.call(this,n,t,i.key,r)}})}(),function(){for(var i,tt,h=CryptoJS,y=h.lib.BlockCipher,o=h.algo,t=[],p=[],w=[],b=[],k=[],d=[],c=[],l=[],a=[],v=[],u=[],f=0;256>f;f++)u[f]=128>f?f<<1:f<<1^283;for(var r=0,e=0,f=0;256>f;f++){i=e^e<<1^e<<2^e<<3^e<<4;i=i>>>8^i&255^99;t[r]=i;p[i]=r;var s=u[r],g=u[s],nt=u[g],n=257*u[i]^16843008*i;w[r]=n<<24|n>>>8;b[r]=n<<16|n>>>16;k[r]=n<<8|n>>>24;d[r]=n;n=16843009*nt^65537*g^257*s^16843008*r;c[i]=n<<24|n>>>8;l[i]=n<<16|n>>>16;a[i]=n<<8|n>>>24;v[i]=n;r?(r=s^u[u[u[nt^s]]],e^=u[u[e]]):r=e=1}tt=[0,1,2,4,8,16,32,64,128,27,54];o=o.AES=y.extend({_doReset:function(){for(var n,u=this._key,e=u.words,r=u.sigBytes/4,u=4*((this._nRounds=r+6)+1),f=this._keySchedule=[],i=0;i<u;i++)i<r?f[i]=e[i]:(n=f[i-1],i%r?6<r&&4==i%r&&(n=t[n>>>24]<<24|t[n>>>16&255]<<16|t[n>>>8&255]<<8|t[n&255]):(n=n<<8|n>>>24,n=t[n>>>24]<<24|t[n>>>16&255]<<16|t[n>>>8&255]<<8|t[n&255],n^=tt[i/r|0]<<24),f[i]=f[i-r]^n);for(e=this._invKeySchedule=[],r=0;r<u;r++)i=u-r,n=r%4?f[i]:f[i-4],e[r]=4>r||4>=i?n:c[t[n>>>24]]^l[t[n>>>16&255]]^a[t[n>>>8&255]]^v[t[n&255]]},encryptBlock:function(n,i){this._doCryptBlock(n,i,this._keySchedule,w,b,k,d,t)},decryptBlock:function(n,t){var i=n[t+1];n[t+1]=n[t+3];n[t+3]=i;this._doCryptBlock(n,t,this._invKeySchedule,c,l,a,v,p);i=n[t+1];n[t+1]=n[t+3];n[t+3]=i},_doCryptBlock:function(n,t,i,r,u,f,e,o){for(var b=this._nRounds,h=n[t]^i[0],c=n[t+1]^i[1],l=n[t+2]^i[2],s=n[t+3]^i[3],a=4,w=1;w<b;w++)var v=r[h>>>24]^u[c>>>16&255]^f[l>>>8&255]^e[s&255]^i[a++],y=r[c>>>24]^u[l>>>16&255]^f[s>>>8&255]^e[h&255]^i[a++],p=r[l>>>24]^u[s>>>16&255]^f[h>>>8&255]^e[c&255]^i[a++],s=r[s>>>24]^u[h>>>16&255]^f[c>>>8&255]^e[l&255]^i[a++],h=v,c=y,l=p;v=(o[h>>>24]<<24|o[c>>>16&255]<<16|o[l>>>8&255]<<8|o[s&255])^i[a++];y=(o[c>>>24]<<24|o[l>>>16&255]<<16|o[s>>>8&255]<<8|o[h&255])^i[a++];p=(o[l>>>24]<<24|o[s>>>16&255]<<16|o[h>>>8&255]<<8|o[c&255])^i[a++];s=(o[s>>>24]<<24|o[h>>>16&255]<<16|o[c>>>8&255]<<8|o[l&255])^i[a++];n[t]=v;n[t+1]=y;n[t+2]=p;n[t+3]=s},keySize:8});h.AES=y._createHelper(o)}(),function(n,t){var i=t.enc.Utf8.parse(n.context.getContext("#key")),r=t.enc.Utf8.parse(n.context.getContext("#key"));n.secureEngine={encrypt:function(n){var u="";return(n||n===0)&&(u=t.AES.encrypt(t.enc.Utf8.parse(n.toString()),i,{keySize:16,iv:r,mode:t.mode.CBC,padding:t.pad.Pkcs7})),u.toString()},decrypt:function(n){var u="";return(n||n.length>12)&&(u=t.AES.decrypt(n,i,{keySize:16,iv:r,mode:t.mode.CBC,padding:t.pad.Pkcs7})),u.toString(t.enc.Utf8)},isEncrypted:function(n){if(n||n.length>12)return!0}}}(VIS,CryptoJS),function(n,t){function i(i){this.frame;this.windowNo;var hi=null,gi=null,ci=null,tt=null,st=null,ht=null,ct=null,nr=null,w=null,lt=null,li=null,yr=null,it=null,at=null,b=null,vt=null,rt=null,tr=null,ir=null,k=null,yt=null,pt=null,ut=null,ft=null,et=null,rr=null,ai=null,vi=this,pr=null,yi=null,wt=null,bt=null,ur=null,fr=null,er=null,or=null,pi=null,wi=null,sr=null,hr=null,cr=null,wr=null,c=null,s=null,br=null,kr=null,kt=null,dr=null,dt=null,d=null,gt=null,f=null,bi=null,ni=!1,gr=null,ti=null,y=null,g=null,e=null,ot=null,ii=!1,nu=null,ri=null,nt=null,u=null,ui=!1,fi=null,ei=null,oi=null,ki=null,di=null,u=null,tu=null,l=null,a=null,h=null,p=null,v=null,o=t("<div>"),si=t("<div class='vis-apanel-busy'>"),r=n.Env.getWindowNo();this.log=n.Logging.VLogger.getVLogger("UserPreference");this.load=function(){o.load(n.Application.contextUrl+"UserPreference/Index/?windowno="+r+"&adUserId="+n.context.getAD_User_ID(),function(){si[0].style.visibility="visible";vi.init(o);var n=o.find("#content_"+r);n!=null;si[0].style.visibility="hidden"})};this.init=function(si){function ye(){t.ajax({type:"POST",async:!1,url:n.Application.contextUrl+"UserPreference/GetSavedDetail",dataType:"json",data:{isTask:!0},success:function(t){ii=!1;ni=!1;ui=!1;var i=JSON.parse(t);i.IsSyncInBackground=="false"?(gt.prop("checked",!1),bi=!1):(gt.prop("checked",!0),bi=!0);i.IsCalSyncInBackground=="false"?(g.prop("checked",!1),ot=!1):(g.prop("checked",!0),ot=!0);d.val(i.TaskAuthCode);d.val().length>0&&(dt.html(n.Msg.getMsg("RemoveLink")),ni=!0);y.val(i.CalendarAuthCode);y.val().length>0&&(ti.html(n.Msg.getMsg("RemoveLink")),ii=!0);nt.val(i.ContactAuthCode);nt.val().length>0&&(ri.html(n.Msg.getMsg("RemoveLink")),ui=!0)}})}function pu(i,r){t.ajax({type:"POST",async:!1,url:n.Application.contextUrl+"UserPreference/GetGmailAuthorizationCode",dataType:"json",data:{isTask:i,isContact:r},success:function(n){var t=JSON.parse(n);t!=null&&t.length>0&&window.open(t)}})}function wu(i,r,o,s,h){t.ajax({type:"POST",async:!1,url:n.Application.contextUrl+"UserPreference/SaveGmailAccountSettings",dataType:"json",data:{authCodes:o,isTask:i,isSyncInBackground:r,isRemoveLink:s,isContact:h},success:function(t){var r=JSON.parse(t);i?r.toString()=="false"?(f.css("color","red"),f.text(n.Msg.getMsg("RecordNotSaved")),f.show()):r.toString()=="true"?(f.css("color","green"),f.text(n.Msg.getMsg("RecordSaved")),s?(d.val(""),dt.html(n.Msg.getMsg("Save")),gt.prop("checked",!1),ni=!1,d.removeAttr("disabled"),f.text(n.Msg.getMsg("LinkRemoved"))):(dt.html(n.Msg.getMsg("RemoveLink")),d.attr("disabled",!0),ni=!0),f.show()):window.open(r):h?r.toString()=="false"?(u.css("color","red"),u.text(n.Msg.getMsg("RecordNotSaved")),u.show()):r.toString()=="true"?(u.css("color","green"),u.text(n.Msg.getMsg("RecordSaved")),s?(nt.val(""),ri.html(n.Msg.getMsg("Save")),ui=!1,nt.removeAttr("disabled"),u.text(n.Msg.getMsg("LinkRemoved"))):(ri.html(n.Msg.getMsg("RemoveLink")),nt.attr("disabled",!0),ui=!0),u.show()):window.open(r):r.toString()=="false"?(e.css("color","red"),e.text(n.Msg.getMsg("RecordNotSaved")),e.show()):r.toString()=="true"?(e.css("color","green"),e.text(n.Msg.getMsg("RecordSaved")),s?(y.val(""),ti.html(n.Msg.getMsg("Save")),g.prop("checked",!1),ii=!1,y.removeAttr("disabled"),e.text(n.Msg.getMsg("LinkRemoved"))):(ti.html(n.Msg.getMsg("RemoveLink")),y.attr("disabled",!0),ii=!0),e.show()):window.open(r)}})}function to(){ro();oi!=null&&oi.append(lu);io()}function io(){var i=n.Application.contextUrl+"WSP/ContactSettings/GetSavedDetail";t.ajax({type:"GET",async:!1,url:i,dataType:"json",success:function(n){var t=JSON.parse(n),i;fi.val(t.Username);ei.val(t.Password);t.Role!=""&&oi.val(t.Role);i=t.IsUpdate;i.toString().toLowerCase()=="false"?(ki.prop("checked",!1),di=!1):(ki.prop("checked",!0),di=!0)}})}function ro(){var i=n.Application.contextUrl+"WSP/ContactSettings/GetRole";t.ajax({type:"GET",async:!1,url:i,dataType:"json",success:function(t){var r=JSON.parse(t),i;for(lu+="<option value='-1'  selected='selected'>"+n.Msg.getMsg("SelectRole")+"<\/option>",i=0;i<r.length;i++)lu+="<option value='"+r[i].RoleID+"'>"+r[i].RoleName+"<\/option>"}})}function uo(i,r,f,e){var o=n.Application.contextUrl+"WSP/ContactSettings/SaveGmailContactSettings";t.ajax({type:"POST",async:!1,url:o,dataType:"json",data:{username:i,password:r,role_ID:f,isUpdateExisting:e},success:function(t){var i=JSON.parse(t);i.toString()=="false"?(u.css("color","red"),u.text(n.Msg.getMsg("RecordNotSaved")),u.show()):(u.css("color","green"),u.text(n.Msg.getMsg("RecordSaved")),u.show())}})}function pe(){var r,u,t,i,f;n.Env.getCtx().setContext("AutoCommit",hi.prop("checked")?"Y":"N");n.Ini.setValueToLocalStorage(n.IniConstants.P_A_NEW,ht.prop("checked")?"Y":"N");n.Env.getCtx().setContext("AutoNew",ht.prop("checked")?"Y":"N");n.Ini.setValueToLocalStorage(n.IniConstants.P_TRACEFILE,lt.prop("checked")?"Y":"N");r=w.find("option:selected").val();u=n.Logging.Level.prototype.getLevel(r);n.Logging.VLogMgt.setLevel(u);n.Ini.setValueToLocalStorage(n.IniConstants.P_TRACELEVEL,w.find("option:selected").val());t=it[0].selectedIndex;n.Ini.setValueToLocalStorage(n.IniConstants.CO_SHOWLEVEL,t<0?0:t);n.Env.getCtx().setContext("#ClientOrgLevel",t<0?0:t);n.Ini.setValueToLocalStorage(n.IniConstants.W_PAGESIZE,b.find("option:selected").val());n.Env.getCtx().setContext("#ShowWorkSpacePageSize",b.find("option:selected").val());i=rt.find("option:selected").val();n.Ini.setValueToLocalStorage(n.IniConstants.WIN_PAGESIZE,i);n.Env.setWINDOW_PAGE_SIZE(i);n.Ini.setValueToLocalStorage(n.IniConstants.P_Show_Mini_Grid,at.prop("checked")?"Y":"N");n.Env.getCtx().setContext("#ShowMiniGrid",at.prop("checked")?"Y":"N");n.Ini.setValueToLocalStorage(n.IniConstants.P_Print_Native_Digits,vt.prop("checked")?"Y":"N");n.Env.getCtx().setContext("#PrintNativeDigits",vt.prop("checked")?"Y":"N");n.Ini.setValueToLocalStorage(n.IniConstants.P_A_LOGIN,ci.prop("checked")?"Y":"N");n.Ini.setValueToLocalStorage(n.IniConstants.P_STORE_PWD,gi.prop("checked")?"Y":"N");n.Env.getCtx().setContext("#ShowAcct",st.prop("checked")?"Y":"N");n.Env.getCtx().setContext("#ShowTrl",tt.prop("checked")?"Y":"N");n.Env.getCtx().setContext("#ShowAdvanced",ct.prop("checked")?"Y":"N");n.Ini.setValueToLocalStorage(n.IniConstants.P_CACHE_WINDOW,nr.prop("checked")?"Y":"N");n.Ini.setValueToLocalStorage(n.IniConstants.P_TRACEFILE,lt.prop("checked")?"Y":"N");f=eo({IsAutoCommit:hi.prop("checked")?"Y":"N",IsShowAcct:st.prop("checked")?"Y":"N",IsShowTrl:tt.prop("checked")?"Y":"N",IsShowAdvanced:ct.prop("checked")?"Y":"N"})}function bu(n){for(var e=n.length,f="",u,r,i=0;i<e;i+=1){for(f+="<tr>",u=0;u<n[i].length;u+=1)r=n[i][u],f+=u==0?i%2?"<td class='VIS_Pref_table-row2'>"+r+"<\/td>":"<td class='VIS_Pref_table-row1' style='border-left: 1px solid #ECECEC;'>"+r+"<\/td>":u==n[i].length-1?i%2?"<td class='VIS_Pref_table-row2'>"+r+"<\/td>":"<td class='VIS_Pref_table-row1'>"+r+"<\/td>":i%2?"<td class='VIS_Pref_table-row2'>"+r+"<\/td>":"<td class='VIS_Pref_table-row1'>"+r+"<\/td>";f+=" <\/tr>"}ut.find("tbody > tr").eq(0).after(t.parseHTML(f));ou=null;f=null}function fo(){st.prop("checked",n.Env.getCtx().ctx["#ShowAcct"]=="Y"?!0:!1);tt.prop("checked",n.Env.getCtx().ctx["#ShowTrl"]=="Y"?!0:!1);ct.prop("checked",n.Env.getCtx().ctx["#ShowAdvanced"]=="Y"?!0:!1)}function eo(i){var r=null;t.ajax({url:n.Application.contextUrl+"UserPreference/SavePrefrence",type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:JSON.stringify({pref:i})}).done(function(n){r=n;o.dialog("close")})}var ku,du,gu,nf,tf,rf,uf,ff,ef,of,sf,hf,cf,lf,af,vf,yf,pf,wf,bf,kf,df,gf,ne,te,ie,re,ue,fe,ee,su,oe,se,he,ce,le,ae,ve,vu,fu,uu,vi,cu,eu,yu,lu;hi=si.find("#chkAutoCommit_"+r);gi=si.find("#chkStorePassword_"+r);ci=si.find("#chkAutoLogin_"+r);tt=si.find("#chkShowTranslationTab_"+r);st=si.find("#chkShowAccountingTab_"+r);ht=si.find("#chkAutoNewRecord_"+r);ct=si.find("#chkShowAdvancedTab_"+r);nr=si.find("#chkCacheWindows_"+r);w=si.find("#cmbTraceLevel_"+r);lt=si.find("#chkTraceFile_"+r);li=si.find("#dt_Date_"+r);yr=si.find("#chkDictionaryMaintain_"+r);it=si.find("#cmbClientOrg_"+r);at=si.find("#chkShowMiniGrid_"+r);b=si.find("#cmbPageSize_"+r);vt=si.find("#chkNativeDigit_"+r);rt=si.find("#cmbWindowPageSize_"+r);tr=si.find("#lblVariableName_"+r);ir=si.find("#lblVariableValue_"+r);ft=si.find("#btnOk_"+r);et=si.find("#btnCancel_"+r);rr=si.find("#btnRole_"+r);ai=si.find("#contextlst_"+r);ut=si.find("#prefErrortbl_"+r);ft.hide();et.hide();pr=si.find("#btnChangePws_"+r);yi=si.find("#txtCurrentPws_"+r);wt=si.find("#txtNewPws_"+r);bt=si.find("#txtConformPws_"+r);ur=si.find("#chkIsEmail_"+r);fr=si.find("#chkIsNotice_"+r);er=si.find("#chkIsSMS_"+r);or=si.find("#chkIsFax_"+r);pi=si.find("#txtUserName_"+r);wi=si.find("#txtPws_"+r);sr=si.find("#btnEmailConfig_"+r);hr=si.find("#btnSubstitute_"+r);cr=si.find("#btnSaveChanges_"+r);wr=si.find("#btnSaveChangePassword_"+r);kr=si.find("#lblPrefSave_"+r);br=si.find("#btnSave_"+r);dr=si.find("#vbtnGmailAuth_"+r);dt=si.find("#vbtnSyncGmailTask_"+r);d=si.find("#txtAuthCode_"+r);gt=si.find("#chkIsSyncBackground_"+r);f=si.find("#lblTaskSettingMessage_"+r);f.hide();gr=si.find("#vbtnGmailCalAuth_"+r);ti=si.find("#vbtnSyncGmailCalendar_"+r);y=si.find("#txtCalAuthCode_"+r);g=si.find("#chkCalIsSyncBackground_"+r);e=si.find("#lblCalendarSettingMessage_"+r);e.hide();ye();nu=si.find("#vbtnGmailContactAuth_"+r);ri=si.find("#vbtnSyncGmailContact_"+r);nt=si.find("#txtContactAuthCode_"+r);u=si.find("#lblContactSettingMessage_"+r);u.hide();ye();fi=si.find("#txtGmailUserName_"+r);ei=si.find("#txtGmailPassword_"+r);oi=si.find("#cmbSettingRole_"+r);ki=si.find("#chkbxUpdateExisting_"+r);tu=si.find("#vbtnSyncGmailContact_"+r);u=si.find("#lblContactSettingMessage_"+r);u.hide();to();l=si.find("#cmbRole_"+r);l.on("change",function(){lr()});a=si.find("#cmbClient_"+r);a.on("change",function(){ar()});h=si.find("#cmbOrg_"+r);h.on("change",function(){vr()});p=si.find("#cmbWareHouse_"+r);v={};ru();iu();var we=si.find("#lblUserSetMenu_"+r),be=si.find("#lblPreferenceMenu_"+r),ke=si.find("#lblContextMenu_"+r),de=si.find("#lblErrorMenu_"+r);if(we.text(n.Msg.getMsg("UserSetting")),be.text(n.Msg.getMsg("Preference")),ke.text(n.Msg.getMsg("Context")),de.text(n.Msg.getMsg("PreferenceError")),ku=si.find("#lblchangePwsHeader_"+r),ku.text(n.Msg.getMsg("ChangePassword")),du=si.find("#lblAutoMatic_"+r),du.text(n.Msg.getMsg("AutoCommit")),gu=si.find("#imgAutoMatic_"+r),gu.text(n.Msg.getMsg("AutoCommit",!0)),nf=si.find("#lblTranslation_"+r),nf.text(n.Msg.getMsg("ShowTranslationTab")),tf=si.find("#imgTranslation_"+r),tf.text(n.Msg.getMsg("ShowTranslationTab")),rf=si.find("#lblShowAccounting_"+r),rf.text(n.Msg.getMsg("ShowAcctTab")),uf=si.find("#imgShowAccounting_"+r),uf.text(n.Msg.getMsg("ShowAcctTab")),ff=si.find("#lblAutoNewRecord_"+r),ff.text(n.Msg.getMsg("AutoNew")),ef=si.find("#imgAutoNewRecord_"+r),ef.text(n.Msg.getMsg("AutoNew")),of=si.find("#lblShowAdvanced_"+r),of.text(n.Msg.getMsg("ShowAdvancedTab")),sf=si.find("#imgShowAdvanced_"+r),sf.text(n.Msg.getMsg("ShowAdvancedTab")),hf=si.find("#lblCacheWindows_"+r),hf.text(n.Msg.getMsg("CacheWindow")),cf=si.find("#imgCacheWindows_"+r),cf.text(n.Msg.getMsg("CacheWindow")),lf=si.find("#vlblClientOrg_"+r),lf.text(n.Msg.getMsg("Show")),af=si.find("#imgClientOrg_"+r),af.text(n.Msg.getMsg("ClientOrg")),vf=si.find("#lblWindowPageSize_"+r),vf.text(n.Msg.getMsg("WindowPageSize")),yf=si.find("#imgWindowPageSize_"+r),yf.text(n.Msg.getMsg("WindowPageSize")),pf=si.find("#lblAutoLogin_"+r),pf.text(n.Msg.getMsg("AutoLogin")),wf=si.find("#imgAutoLogin_"+r),wf.text(n.Msg.getMsg("AutoLogin")),bf=si.find("#lblStorePassword_"+r),bf.text(n.Msg.getMsg("StorePassword")),kf=si.find("#imgStorePassword_"+r),kf.text(n.Msg.getMsg("StorePassword")),df=si.find("#lblTraceLevel_"+r),df.text(n.Msg.getMsg("TraceLevel")),gf=si.find("#imgTraceLevel_"+r),gf.text(n.Msg.getMsg("TraceLevel")),ne=si.find("#lblTraceFile_"+r),ne.text(n.Msg.getMsg("TraceFile")),te=si.find("#imgTraceFile_"+r),te.text(n.Msg.getMsg("TraceFile")),ie=si.find("#lblNativeDigit_"+r),ie.text(n.Msg.getMsg("PrintNativeDigits")),re=si.find("#imgNativeDigit_"+r),re.text(n.Msg.getMsg("PrintNativeDigits")),ue=si.find("#vlblDateText_"+r),ue.text(n.Msg.getMsg("Date")),fe=si.find("#imgDateText_"+r),fe.text(n.Msg.getMsg("Date")),su=si.find("#vlblPageSize_"+r),su.text(n.Msg.getMsg("Pagesize")),ee=si.find("#imgPageSize_"+r),ee.text(n.Msg.getMsg("Pagesize")),su=si.find("#vlblPageSize_"+r),su.text(n.Msg.getMsg("Pagesize")),oe=si.find("#lblContext_"+r),oe.text(n.Msg.getMsg("Context")),c=si.find("#lblRecordSave_"+r),s=si.find("#lblChangePasswordMessage_"+r),c.hide(),kr.hide(),s.hide(),se=si.find("#pchangePws_"+r),se.text(n.Msg.getMsg("PPasswordInfo")),he=si.find("#pNotification_"+r),he.text(n.Msg.getMsg("PNotificationInfo")),ce=si.find("#pEmailConfig_"+r),ce.text(n.Msg.getMsg("PEmailConfigInfo")),le=si.find("#pSubstitute_"+r),le.text(n.Msg.getMsg("PSubstituteInfo")),ae=si.find("#pContext_"+r),ae.text(n.Msg.getMsg("PContextInfo")),ve=si.find("#pError_"+r),ve.text(n.Msg.getMsg("PErrorInfo")),w!=null){var au=[n.Logging.Level.OFF.getIntValue(),n.Logging.Level.SEVERE.getIntValue(),n.Logging.Level.WARNING.getIntValue(),n.Logging.Level.INFO.getIntValue(),n.Logging.Level.CONFIG.getIntValue(),n.Logging.Level.FINE.getIntValue(),n.Logging.Level.FINER.getIntValue(),n.Logging.Level.FINEST.getIntValue(),n.Logging.Level.ALL.getIntValue()],ge=[n.Logging.Level.OFF.getName(),n.Logging.Level.SEVERE.getName(),n.Logging.Level.WARNING.getName(),n.Logging.Level.INFO.getName(),n.Logging.Level.CONFIG.getName(),n.Logging.Level.FINE.getName(),n.Logging.Level.FINER.getName(),n.Logging.Level.FINEST.getName(),n.Logging.Level.ALL.getName()],uu=0;for(vi=0;vi<au.length;vi++)w.append(" <option value="+au[vi]+">"+ge[vi]+"<\/option>"),n.Ini.getLocalStorage(n.IniConstants.P_TRACELEVEL)==au[vi]&&(uu=vi);w.prop("selectedIndex",uu)}if(it!=null){for(vu=[n.Msg.getMsg("Client+Org"),n.Msg.getMsg("Client"),n.Msg.getMsg("Org"),n.Msg.getMsg("None")],uu=0,vi=0;vi<vu.length;vi++)it.append("<option>"+vu[vi]+"<\/option>"),n.Ini.getLocalStorage(n.IniConstants.CO_SHOWLEVEL)==vi&&(uu=vi);it.prop("selectedIndex",uu)}if(b!=null){for(fu=[5,6,7,8,9,10],uu=0,vi=0;vi<fu.length;vi++)b.append("<option>"+fu[vi]+"<\/option>"),n.Ini.getLocalStorage(n.IniConstants.W_PAGESIZE)==fu[vi]&&(uu=vi);b.prop("selectedIndex",uu)}if(rt!=null){for(fu=[50,100,500],uu=0,vi=0;vi<fu.length;vi++)rt.append("<option>"+fu[vi]+"<\/option>"),n.Ini.getLocalStorage(n.IniConstants.WIN_PAGESIZE)==fu[vi]&&(uu=vi);rt.prop("selectedIndex",uu)}if(ai!=null){var ou=n.context.getEntireCtx(),hu=[],vi=0,no=Object.keys(ou).length;for(cu=0;cu<no;cu+=1)hu[vi++]=' <li class="VIS_Pref_li-err" ><span >',hu[vi++]=Object.keys(ou)[cu]+" == "+ou[Object.keys(ou)[cu]],hu[vi++]="<\/span><\/li>";ai.append(hu.join(""));ou=null;hu=null}k=si.find("#vchkErrorOnly_"+r);yt=si.find("#vbtnReset_"+r);pt=si.find("#vbtnSaveToFile_"+r);k.prop("checked",!0);ut!=null&&(eu=n.Logging.VLogErrorBuffer.get(!0).getLogData(k.prop("checked")),kt=eu,bu(eu));pt.on("click",function(){var i,n,r,u;if(eu=kt,eu.length>0){for(i="",n=0;n<eu.length;n++)i+=eu[n]+"\n";r=(new Date).toISOString().slice(0,19).replace(/-/g,"");u="data:text/csv;base64,"+window.btoa(i);t(this).attr("href",u).attr("download","file-"+r+".csv")}});fo();hi.prop("checked",n.Env.getCtx().isAutoCommit());ht.prop("checked",n.Env.getCtx().isAutoNew());ci.prop("checked",n.Ini.getLocalStorage(n.IniConstants.P_A_LOGIN)=="N"?!1:!0);gi.prop("checked",n.Ini.getLocalStorage(n.IniConstants.P_STORE_PWD)=="N"?!1:!0);at.prop("checked",n.Ini.getLocalStorage(n.IniConstants.P_Show_Mini_Grid)=="N"?!1:!0);vt.prop("checked",n.Ini.getLocalStorage(n.IniConstants.P_Print_Native_Digits)=="N"?!1:!0);nr.prop("checked",n.Ini.getLocalStorage(n.IniConstants.P_CACHE_WINDOW)=="N"?!1:!0);lt.prop("checked",n.Ini.getLocalStorage(n.IniConstants.P_TRACEFILE)=="N"?!1:!0);yu=new Date(Number(n.Env.getCtx().ctx["#Date"]));yu!=null&&li.val(Globalize.format(yu,"yyyy-MM-dd"));ai.on("click","li",function(){var n=t(this).text().split("==")[0],i=t(this).text().split("==")[1];tr.text(n.toString());ir.text(i.toString())});t(".VIS_Pref_meni li").on("click",function(){t(".VIS_Pref_menu li").removeClass("active");t(this).addClass("active")});yt.on("click",function(){var t=n.Logging.VLogErrorBuffer.get(!0).resetBuffer(k.prop("checked"));kt=t;t!=null?bu(t):ut.find("tr:gt(0)").remove()});t(".VIS_Pref_btn-pass-click").on("click",function(){t(".VIS_Pref_new-password").css("display","block");t(".VIS_Pref_Save").css("display","block")});t(".VIS_Pref_close-btn").click(function(){t(".VIS_Pref_new-password").css("display","none");t(".VIS_Pref_Save").css("display","none")});t(".VIS_Pref_link-1").click(function(){t(".VIS_Pref_content-right").css("display","block");t(".VIS_Pref_content-right-2").css("display","none");t(".VIS_Pref_content-right-3").css("display","none");t(".VIS_Pref_content-right-4").css("display","none");t(".VIS_Pref_content-right-5").css("display","none")});t(".VIS_Pref_link-2").click(function(){t(".VIS_Pref_content-right").css("display","none");t(".VIS_Pref_content-right-2").css("display","block");t(".VIS_Pref_content-right-3").css("display","none");t(".VIS_Pref_content-right-4").css("display","none");t(".VIS_Pref_content-right-5").css("display","none")});t(".VIS_Pref_link-3").click(function(){t(".VIS_Pref_content-right").css("display","none");t(".VIS_Pref_content-right-2").css("display","none");t(".VIS_Pref_content-right-3").css("display","block");t(".VIS_Pref_content-right-4").css("display","none");t(".VIS_Pref_content-right-5").css("display","none")});t(".VIS_Pref_link-4").click(function(){t(".VIS_Pref_content-right").css("display","none");t(".VIS_Pref_content-right-2").css("display","none");t(".VIS_Pref_content-right-3").css("display","none");t(".VIS_Pref_content-right-4").css("display","block");t(".VIS_Pref_content-right-5").css("display","none")});t(".VIS_Pref_link-5").click(function(){window.WSP?(t(".VIS_Pref_content-right").css("display","none"),t(".VIS_Pref_content-right-2").css("display","none"),t(".VIS_Pref_content-right-3").css("display","none"),t(".VIS_Pref_content-right-4").css("display","none"),t(".VIS_Pref_content-right-5").css("display","block")):alert("please download WSP !!!")});i&&t(".VIS_Pref_link-5").trigger("click");br.on("click",function(){pe()});ft.on("click",function(){pe()});et.on("click",function(){o.dialog("close")});k.on("click",function(){var t=null;ut.find("tr").slice(1,-1).remove();t=n.Logging.VLogErrorBuffer.get(!0).getLogData(k.prop("checked"));kt=t;t!=null&&bu(t)});rr.on("click",function(){var t=n.MRole.toStringX(n.Env.getCtx())});wr.on("click",function(){var r=yi.val(),i=wt.val(),u=bt.val(),f=pi.val(),e=wi.val();if((!(r.length<=0)||!(i.length<=0)||!(u.length<=0))&&(!(r.length>0)||!(i.length>0)||!(u.length>0))){s.css("color","red");s.text(n.Msg.getMsg("mandatoryFields"));return}if(i!=u){s.css("color","red");s.text(n.Msg.getMsg("samePassword"));return}t.ajax({type:"POST",async:!1,url:n.Application.contextUrl+"UserPreference/SaveChangePassword",dataType:"json",data:{AD_User_ID:n.context.getAD_User_ID(),currentPws:r,newPws:i},success:function(n){returnValue=n.result;s.show();returnValue=="OK"?s.css("color","green"):s.css("color","red");s.text(returnValue)}})});cr.on("click",function(){var i=yi.val(),r=wt.val(),u=bt.val(),v=pi.val(),y=wi.val();if((!(i.length<=0)||!(r.length<=0)||!(u.length<=0))&&(!(i.length>0)||!(r.length>0)||!(u.length>0))){c.text(n.Msg.getMsg("mandatoryFields"));return}if(wt.text().localeCompare(bt.text())==-1){c.text(n.Msg.getMsg("samePassword"));return}var e=l.val(),o=a.val(),s=h.val(),f=p.val();if(e==undefined||o==undefined||s==undefined){c.text(n.Msg.getMsg("VIS_FillLogin"));return}f==undefined&&(f=0);t.ajax({type:"POST",async:!1,url:n.Application.contextUrl+"UserPreference/SaveUserSettings",dataType:"json",data:{AD_User_ID:n.context.getAD_User_ID(),currentPws:i,newPws:r,conformPws:u,chkEmail:ur.prop("checked"),chkNotice:fr.prop("checked"),chkSMS:er.prop("checked"),chkFax:or.prop("checked"),emailUserName:v,emailPws:y,AD_Role_ID:e,AD_Client_ID:o,AD_Org_ID:s,M_Warehouse_ID:f},success:function(n){returnValue=n.result;c.show();c.css("color","green");c.text(returnValue.Msg);returnValue.IsSaved||c.css("color","red")}})});sr.on("click",function(){var u="select ad_window_id from ad_window where name='Mail Configuration'",i=0,t,r;try{t=n.DB.executeDataReader(u);t.read()&&(i=t.getInt(0));t.dispose();i>0&&(r=new n.Query,r.addRestriction("AD_User_ID",n.Query.prototype.EQUAL,n.context.getAD_User_ID()),n.viewManager.startWindow(i,r))}catch(f){this.log.log(n.Logging.Level.SEVERE,u,f)}o.dialog("close")});hr.on("click",function(){var u="select ad_window_id from ad_window where name='User Substitute'",i=0,t,r;try{t=n.DB.executeDataReader(u);t.read()&&(i=t.getInt(0));t.dispose();i>0&&(r=new n.Query,r.addRestriction("AD_User_ID",n.Query.prototype.EQUAL,n.context.getAD_User_ID()),n.viewManager.startWindow(i,r))}catch(f){this.log.log(n.Logging.Level.SEVERE,u,f)}o.dialog("close")});dr.on("click",function(){pu(!0,!1)});dt.on("click",function(){f.css("color","gray");f.text(n.Msg.getMsg("PleaseWait"));f.show();window.setTimeout(function(){wu(!0,bi,d.val(),ni,!1)},500)});gt.on("click",function(n){bi=n.originalEvent.target.checked});nu.on("click",function(){pu(!1,!0)});ri.on("click",function(){u.css("color","gray");u.text(n.Msg.getMsg("PleaseWait"));u.show();window.setTimeout(function(){wu(!1,!1,nt.val(),ui,!0)},500)});gr.on("click",function(){pu(!1,!1)});ti.on("click",function(){e.css("color","gray");e.text(n.Msg.getMsg("PleaseWait"));e.show();window.setTimeout(function(){wu(!1,ot,y.val(),ii,!1)},500)});g.on("click",function(n){ot=n.originalEvent.target.checked});ki.on("click",function(n){di=n.originalEvent.target.checked});tu.on("click",function(){fi.val()!=""&&fi.val().length!=0&&ei.val()!=""&&ei.val().length!=0&&(u.css("color","gray"),u.text(n.Msg.getMsg("PleaseWait")),u.show(),window.setTimeout(function(){uo(fi.val(),ei.val(),oi.val(),di)},500))});lu=null};var ru=function(){t.ajax({url:n.Application.contextUrl+"UserPreference/GetDefaultLogin",dataType:"json",async:!1,data:{AD_User_ID:n.context.getAD_User_ID()},success:function(n){var t=JSON.parse(n);v.AD_Role_ID=t.AD_Role_ID;v.AD_Client_ID=t.AD_Client_ID;v.AD_Org_ID=t.AD_Org_ID;v.M_Warehouse_ID=t.M_Warehouse_ID}})},iu=function(){var i="SELECT  r.Name,r.AD_Role_ID FROM AD_User u INNER JOIN AD_User_Roles ur ON (u.AD_User_ID=ur.AD_User_ID AND ur.IsActive='Y') INNER JOIN AD_Role r ON (ur.AD_Role_ID=r.AD_Role_ID AND r.IsActive='Y')  WHERE  u.AD_User_ID="+n.context.getAD_User_ID()+" AND u.IsActive='Y'  AND u.IsLoginUser='Y'  AND EXISTS (SELECT * FROM AD_Client c WHERE u.AD_Client_ID=c.AD_Client_ID AND c.IsActive='Y') AND EXISTS (SELECT * FROM AD_Client c WHERE r.AD_Client_ID=c.AD_Client_ID AND c.IsActive='Y') ORDER BY r.Name";t.ajax({url:n.Application.contextUrl+"UserPreference/GetLoginData",dataType:"json",data:{sql:i},success:function(n){var t=JSON.parse(n),i="",r;for(r in t)i+="<option value="+t[r].RecKey+">"+t[r].Name+"<\/option>";l.append(i);l.val(v.AD_Role_ID);i=null;t=null;lr()}})},lr=function(){var i=l.val(),r;(a.empty(),h.empty(),p.empty(),i!=undefined)&&(r="SELECT c.Name,r.AD_Client_ID FROM AD_Role r INNER JOIN AD_Client c ON (c.AD_Client_ID=r.AD_Client_ID) WHERE r.AD_Role_ID="+i,i=null,t.ajax({url:n.Application.contextUrl+"UserPreference/GetLoginData",dataType:"json",data:{sql:r},success:function(n){var t=JSON.parse(n),i="",u;for(u in t)i+="<option value="+t[u].RecKey+">"+t[u].Name+"<\/option>";a.append(i);a.val(v.AD_Client_ID);i=null;t=null;r=null;ar()}}))},ar=function(){var i=l.val(),r=a.val(),u;(h.empty(),p.empty(),i!=undefined&&r!=undefined)&&(u="SELECT o.Name,o.AD_Org_ID FROM AD_Role r, AD_Client c INNER JOIN AD_Org o ON (c.AD_Client_ID=o.AD_Client_ID OR o.AD_Org_ID=0) WHERE r.AD_Role_ID='"+i+"' AND c.AD_Client_ID='"+r+"' AND o.IsActive='Y' AND o.IsSummary='N' AND (r.IsAccessAllOrgs='Y' OR (r.IsUseUserOrgAccess='N' AND o.AD_Org_ID IN (SELECT AD_Org_ID FROM AD_Role_OrgAccess ra WHERE ra.AD_Role_ID=r.AD_Role_ID AND ra.IsActive='Y')) OR (r.IsUseUserOrgAccess='Y' AND o.AD_Org_ID IN (SELECT AD_Org_ID FROM AD_User_OrgAccess ua WHERE ua.AD_User_ID='"+n.context.getAD_User_ID()+"' AND ua.IsActive='Y'))) ORDER BY o.Name",i=null,r=null,t.ajax({url:n.Application.contextUrl+"UserPreference/GetLoginData",dataType:"json",data:{sql:u},success:function(n){var t=JSON.parse(n),i="",r;for(r in t)i+="<option value="+t[r].RecKey+">"+t[r].Name+"<\/option>";h.append(i);h.val(v.AD_Org_ID);i=null;t=null;u=null;vr()}}))},vr=function(){var i=h.val(),r;(p.empty(),i!=undefined)&&(r="SELECT Name,M_Warehouse_ID  FROM M_Warehouse WHERE AD_Org_ID="+i+" AND IsActive='Y' ORDER BY Name",i=null,t.ajax({url:n.Application.contextUrl+"UserPreference/GetLoginData",dataType:"json",data:{sql:r},success:function(n){var t=JSON.parse(n),i="",u;for(u in t)i+="<option value="+t[u].RecKey+">"+t[u].Name+"<\/option>";p.append(i);p.val(v.M_Warehouse_ID);i=null;t=null;r=null}}))};this.showDialog=function(){var i=t(window).width()-150,r=t(window).height()-40;si.height(r);si.width(i);o.append(si);o.dialog({modal:!1,title:n.Msg.getMsg("Preference"),width:i,height:r,position:{at:"center top",of:window},close:function(){vi.dispose();o.dialog("destroy");t("#ui-datepicker-div").remove();o=null;vi=null}})};this.show=function(){this.load();this.showDialog()};this.disposeComponent=function(){vi=null;ft&&ft.off("click");et&&et.off("click");yt&&yt.off("click");pt&&pt.off("click");ci=null;tt=null;st=null;ht=null;ct=null;lt=null;w=null;kt=null;yr=null;it=null;at=null;b=null;vt=null;rt=null;tr=null;ir=null;tt=null;k=null;yt=null;pt=null;ut=null;rr=null;ft=null;et=null;pr=null;yi=null;wt=null;bt=null;ur=null;fr=null;er=null;or=null;pi=null;wi=null;sr=null;hr=null;cr=null;lblUserSetMenu=null;lblPreferenceMenu=null;lblContextMenu=null;lblErrorMenu=null;lblchangePwsHeader=null;lblAutoMatic=null;imgAutoMatic=null;lblTranslation=null;imgTranslation=null;lblShowAccounting=null;imgShowAccounting=null;lblAutoNewRecord=null;imgAutoNewRecord=null;lblShowAdvanced=null;imgShowAdvanced=null;lblCacheWindows=null;imgCacheWindows=null;vlblClientOrg=null;imgClientOrg=null;lblWindowPageSize=null;imgWindowPageSize=null;lblAutoLogin=null;imgAutoLogin=null;lblStorePassword=null;imgStorePassword=null;lblTraceLevel=null;imgTraceLevel=null;lblTraceFile=null;imgTraceFile=null;lblNativeDigit=null;imgNativeDigit=null;vlblDateText=null;imgDateText=null;vlblPageSize=null;imgPageSize=null;vlblPageSize=null;lblContext=null;li.datepicker("destroy");li=null;l.off("change");a.off("change");h.off("change");l=null;a=null;h=null;p=null;iu=null;ar=null;lr=null;vr=null;this.disposeComponent=null}}n.Framework=n.Framework||{};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Framework.UserPreference=i}(VIS,jQuery),function(n,t){function i(i,r){var e=this,u=t("<div>"),o=t("<div class='vis-apanel-busy'>"),f=n.Env.getWindowNo(),s=null,h=null;this.onClose=null;var k=null,v=null,c=null,l=null,b=null,w=null,y=!1,p=null,a=null,d=function(){u.load(n.Application.contextUrl+"VImageForm/Index/?windowno="+f+"&ad_image_id="+i,function(){o[0].style.visibility="visible";g(u);o[0].style.visibility="hidden"})},g=function(t){s=u.find("#btnOk_"+f);h=u.find("#btnCancel_"+f);n.Application.isRTL&&(s.css("margin-right","-128px"),h.css("margin-right","55px"));v=t.find("#fileUpload_"+f);c=t.find("#holderDiv_"+f);l=t.find("#imgUsrImage_"+f);c.css("width",p-48);a>180&&c.css("height",a-180);r>0?l.hide():l[0].width>300&&c.css("overflow","auto");b=t.find("#lblfileUpload_"+f);w=t.find("#chkDataBaseSave_"+f);v.on("change",function(){l.show();var t=v[0].files[0],n=new FileReader;return n.onload=function(n){l.removeAttr("src").attr("src",n.target.result);c.css("overflow","auto")},n.readAsDataURL(t),y=!0,n=null,t=null,!1});s.on("click",function(){if(y){var r=new XMLHttpRequest,t=new FormData;t.append("file",v[0].files[0]);t.append("isDatabaseSave",w.prop("checked"));t.append("ad_image_id",i);r.open("POST",n.Application.contextUrl+"VImageForm/SaveImage",!0);r.send(t);r.addEventListener("load",function(n){var i=n.target.response,f;if(i=JSON.parse(i),f=i.result,e.onClose)e.onClose(f,y);r=null;t=null;u.dialog("close")},!1)}else{if(e.onClose)e.onClose(i,y);u.dialog("close")}});h.on("click",function(){u.dialog("close")})};this.showDialog=function(){d();p=t(window).width()-150;a=t(window).height()-40;o.height(a);o.width(p);u.append(o);u.dialog({modal:!0,title:n.Msg.getMsg("ImageDialog"),width:p,height:a,position:{at:"center top",of:window},close:function(){e.dispose();e=null;u.dialog("destroy");u=null}})};this.disposeComponent=function(){e=null;s&&s.off("click");h&&h.off("click");o=null;f=null;s=null;h=null;k=null;v=null;c=null;l=null;b=null;w=null;y=!1;p=null;a=null;this.disposeComponent=null}}i.prototype.dispose=function(){this.disposeComponent()};n.VImageForm=i}(VIS,jQuery),function(n,t){function i(i){function f(){var e,s,f,h,o;for(r=t("<div><\/div>"),e="<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>",e+=n.Application.isRTL?"<html dir='rtl' xmlns='http://www.w3.org/1999/xhtml'>":"<html xmlns='http://www.w3.org/1999/xhtml'>",e+="<head><script type='text/javascript' language='javascript'> document.onkeydown = function(){ if((window.event && window.event .keyCode == 116)||(window.event && window.event .keyCode == 78)) { window.event.keyCode = 505; }if(window.event && window.event .keyCode == 505){ return false; } }<\/script> <meta http-equiv='Content-Type' content='text/html; charset=utf-8' /><title>Help &amp; Support "+i.vo.Name+"<\/title><style type='text/css'><!--body {margin-left: 0px;margin-top: 0px;margin-right: 0px;margin-bottom: 0px;font-family:verdana;font-size:12px;color:#000000;}.hed1{font-family:verdana;font-weight:bold;font-size:12px;color:#000000;}.border{border:1px solid #c6daf3;}.border-1{border:1px solid #aac7e7;background-color:#e9e8e8;}.border-2{border:1px solid #aac7e7;}.border-bottom{border-bottom:1px solid #c6daf3;}.border-top-none{border-bottom:1px solid #c6daf3;border-right:1px solid #c6daf3;border-left:1px solid #c6daf3;}.red{font-size:12px;color:#FF0000;font-weight:bold;}.white{font-size:16px;color:#FFffff;font-weight:bold;}.black{font-size:16px;color:#000000;font-weight:bold;}.blue{color:#5490fa;font-weight:bold;}.orange{color:#f2b227;font-weight:bold;}.pad{padding:5px;}a{color:#5490fa;\t}a:hover{color:#000000;\ttext-decoration:none;}--><\/style><\/head><body oncontextmenu='return false;'>",e=e+"<table width='100%' border='0' align='center' cellpadding='0' cellspacing='0' class='border'><tr><td><table width='100%' border='0' align='center' cellpadding='0' cellspacing='0' bgcolor='#c6daf3' class='border-bottom'><tr><td width='100%' class='hed1' height='29'>Vienna Solutions<\/td><\/tr><\/table><\/td><\/tr><tr><td>&nbsp;<\/td>",e=e+"<\/tr><tr><td><table width='98%' border='0' align='center' cellpadding='0' cellspacing='0' class='border'><tr><td><table width='99%' border='0' align='center' cellpadding='0' cellspacing='0'><tr><td class='red'>&nbsp;<\/td><\/tr><tr><td class='red'>Window: "+i.vo.Name+"<\/td><\/tr><tr><td>&nbsp;<\/td><\/tr><tr><td>"+i.vo.Description+"<\/td><\/tr><tr><td>&nbsp;<\/td><\/tr><tr><td>"+i.vo.Help+"<\/td><\/tr><tr><td>&nbsp;<\/td><\/tr><tr><td>",s="",f=0;f<i.tabs.length;f++)s==""?s="<a href='#"+i.tabs[f].vo.Name+""+f+"'>"+i.tabs[f].vo.Name+"<\/a>":s+=" -&gt; <a href='#"+i.tabs[f].vo.Name+""+f+"'>"+i.tabs[f].vo.Name+"<\/a> ";for(e=e+s,e=e+"<\/td><\/tr><tr><td>&nbsp;<\/td><\/tr><\/table><\/td><\/tr><\/table><\/td><\/tr><tr><td>&nbsp;<\/td><\/tr>",e=e+"<tr><td><table width='98%' border='0' align='center' cellpadding='0' cellspacing='0' class='border'>",f=0;f<i.tabs.length;f++){for(e=e+"<tr><td><table width='99%' border='0' align='center' cellpadding='0' cellspacing='0'><tr><td class='black' style='padding-top:5px;' ><table width='100%' border='0' align='center' cellpadding='0' cellspacing='0'><tr><td width='340' height='5' bgcolor='#f9b31c'><\/td><td width='4'><\/td><td width='624' bgcolor='#f9b31c'><\/td><\/tr><tr><td height='35' bgcolor='#FFFFFF' class='border-top-none' style='padding-left:10px;'>Tab:"+i.tabs[f].vo.Name+"<a name='"+i.tabs[f].vo.Name+""+f+"'><\/a> <\/td><td ><\/td><td bgcolor='#FFFFFF' class='border-top-none' style='padding-left:10px;'>"+i.tabs[f].vo.Description,"NaN<\/tr><\/table><\/td><\/tr><tr><td >&nbsp;<\/td><\/tr><tr><td><table width='100%' border='0' align='center' cellpadding='0' cellspacing='0' class='border-2'><tr><td style='padding:10px; text-align:justify'><span class='red'>"+i.tabs[f].vo.Help,"NaN<br />",h="",o=0;o<i.tabs[f].gTab._gridTable.m_fields.length;o++)h==""?h="<a href='#"+i.tabs[f].vo.Name+""+f+""+i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header+""+o+"'>"+i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header+"<\/a>":h+=" | <a href='#"+i.tabs[f].vo.Name+""+f+""+i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header+""+o+"'>"+i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header+"<\/a>";for(e=e+h,e=e+" <\/tr><\/table><\/td><\/tr><tr><td>&nbsp;<\/td><\/tr>",o=0;o<i.tabs[f].gTab._gridTable.m_fields.length;o++)i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header!=""&&(e=e+"<tr><td><table width='100%' border='0' align='center' cellpadding='0' cellspacing='0' class='border-1'><tr><td style='padding:10px; text-align:justify'><span class='blue'>Field: "+i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header+"<\/span><a name='"+i.tabs[f].vo.Name+""+f+""+i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header+""+o+"'><\/a><br /><br />"+i.tabs[f].gTab._gridTable.m_fields[o]._vo.Description+"<br /><br />"+i.tabs[f].gTab._gridTable.m_fields[o]._vo.Help+" <\/td><\/tr><\/table><\/td><\/tr><tr><td>&nbsp;<\/td><\/tr>");e=e+"<\/table><\/td><\/tr>"}e=e+"<\/table><\/td><\/tr><\/table><\/body><\/html>";r.append(jQuery.parseHTML(e));u=e}function e(){var n=window.open();n.document.open();n.document.write(u)}var r,u="";f();e()}n.Apps.help=i}(VIS,jQuery),function(n,t){t.IniConstants={log:t.Logging.VLogger.getVLogger(" VIS.Ini"),ENV_PREFIX:"env.",VIENNA_HOME:"VIENNA_HOME",VIENNA_PROPERTY_FILE:"vienna.properties",VIENNA_ENV_FILE:"viennaEnv.properties",P_UID:"ApplicationUserID",DEFAULT_UID:"UserPwd",P_PWD:"ApplicationPassword",DEFAULT_PWD:"UserPwd",P_STORE_PWD:"StorePassword",DEFAULT_STORE_PWD:!0,P_TRACELEVEL:"TraceLevel",DEFAULT_TRACELEVEL:"WARNING",P_TRACEFILE:"TraceFile",DEFAULT_TRACEFILE:!1,P_INI:"FileNameINI",DEFAULT_INI:"",P_CONNECTION:"Connection",DEFAULT_CONNECTION:"",P_A_LOGIN:"AutoLogin",DEFAULT_A_LOGIN:!1,P_A_NEW:"AutoNew",DEFAULT_A_NEW:!0,P_VIENNASYS:"ViennaSys",DEFAULT_VIENNASYS:!1,P_CACHE_WINDOW:"CacheWindow",DEFAULT_CACHE_WINDOW:!1,P_TEMP_DIR:"TempDir",DEFAULT_TEMP_DIR:"",P_ROLE:"Role",DEFAULT_ROLE:"",P_CLIENT:"Client",DEFAULT_CLIENT:"",P_ORG:"Organization",DEFAULT_ORG:"",P_WAREHOUSE:"Warehouse",DEFAULT_WAREHOUSE:"",P_TODAY:"CDate264",DEFAULT_TODAY:Date.now,P_PRINTPREVIEW:"PrintPreview",DEFAULT_PRINTPREVIEW:!0,P_WARNING:"Warning",DEFAULT_WARNING:"Do_not_change_any_of_the_data_as_they_will_have_undocumented_side_effects.",P_PRINTER:"Printer",DEFAULT_PRINTER:"",P_DBUSED:"dbused",DEFAULT_DBUSED:"",P_DB_NAME:"dbname",DEFAULT_DB_NAME:"",P_DBUSER_ID:"dbuserid",DEFAULT_DBUSER_ID:"",P_DBPWD:"dbpwd",DEFAULT_DB_PWD:"",P_DB_PORT:"dbport",DEFAULT_DB_PORT:"",P_DB_HOST:"dbhost",DEFAULT_DB_HOST:"",CO_SHOWLEVEL:"ClientOrgLevel",DEFAULT_CO_SHOWLEVEL:"2",W_PAGESIZE:"WorkSpacePageSize",DEFAULT_W_PAGESIZE:"5",WIN_PAGESIZE:"WindowPageSize",DEFAULT_WIN_PAGESIZE:"50",P_Show_Mini_Grid:"ShowMiniGrid",DEFAULT_MiniGrid_Status:!1,P_Print_Native_Digits:"PrintNativeDigits",DEFAULT_Native_Digits_Status:!0,P_WELCOME_SCREEN:"HideWelcomeScreen",DEFAULT_SCREEN_STATUS:!1,P_APP_TYPE:"AppType",DEFAULT_APP_TYPE:"VServer",P_APP_HOST:"AppHost",DEFAULT_APP_HOST:"localhost",P_APP_PORT:"AppPort",DEFAULT_APP_PORT:"2090",_VIENNASYS:"VFramworkSys",_XML_DOC_PATH:"appconn.xml",_XML_ROOT:"//connectionvar"};t.Ini=function(){function n(n,t){localStorage.setItem(n,t)}function i(n){return localStorage.getItem(n)}function r(){localStorage.clear()}function u(n){localStorage.removeItem(n)}function f(){return localStorage.getItem(t.IniConstants.P_CACHE_WINDOW)=="Y"}function e(){return t.Ini.getLocalStorage(t.IniConstants.P_TRACELEVEL)!=null?t.Logging.Level.prototype.getLevel(t.Ini.getLocalStorage(t.IniConstants.P_TRACELEVEL)):t.Logging.Level.INFO}function o(){for(var i=[t.IniConstants.P_A_NEW,t.IniConstants.P_TRACEFILE,t.IniConstants.P_TRACELEVEL,t.IniConstants.CO_SHOWLEVEL,t.IniConstants.W_PAGESIZE,t.IniConstants.WIN_PAGESIZE,t.IniConstants.P_Show_Mini_Grid,t.IniConstants.P_Print_Native_Digits,t.IniConstants.P_A_LOGIN,t.IniConstants.P_STORE_PWD,t.IniConstants.P_CACHE_WINDOW,t.IniConstants.P_PRINTPREVIEW,t.IniConstants.P_TRACEFILE],r={},n=0;n<i.length;n++)i[n]=="AutoNew"?t.context.setContext(i[n],t.Ini.getLocalStorage(i[n])==null?"Y":t.Ini.getLocalStorage(i[n])):t.context.setContext("#"+i[n],t.Ini.getLocalStorage(i[n])),r[i[n]]=t.Ini.getLocalStorage(i[n]);r["#TimezoneOffset"]=(new Date).getTimezoneOffset().toString();t.dataContext.updateClientCtx(r)}return{setValueToLocalStorage:n,getLocalStorage:i,clearLocalStorage:r,removeLocalStorageItem:u,updateLocalContextFromIni:o,getIsCacheWindow:f,getTraceLevel:e}}()}(jQuery,VIS),function(n,t){function i(i){function g(n){tt.css("display",n?"block":"none")}this.onClose=null;var v=i,w=this,r=t("<div style='position:relative;'>"),tt=t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>"),u=n.Env.getWindowNo(),it=null,b=null,o=null,s=null,h=null,c=null,e=null,y=null,l=null,a=null,k=null,nt=null,p=null,d=null,ut=null,rt=null,f=!1;this.load=function(){r.load(n.Application.contextUrl+"Location/Locations/?windowno="+u+"&locationId="+v,function(){r.append(tt);g(!0);w.init();g(!1)})};this.init=function(){function ut(i){var u=null;t.ajax({url:n.Application.contextUrl+"Location/SaveLocation",type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:JSON.stringify({pref:i})}).done(function(n){if(u=n,v=u.locationid,rt=u.locaddress,this.location=v,g(!1),w.onClose)w.onClose(v,f);r.dialog("close");f=null})}var tt,i;p=r.find("#btnOk_"+u);d=r.find("#btnCancel_"+u);it=r.find("#lstLocation_"+u);b=r.find("#txtCountry_"+u);o=r.find("#txtAddress1_"+u);s=r.find("#txtAddress2_"+u);h=r.find("#txtAddress3_"+u);c=r.find("#txtAddress4_"+u);n.Application.isRTL&&(p.removeClass("pull-left"),p.addClass("pull-right"),r.find("Sup").css("float","right"),t(r.find(".cat2 a")[0]).removeClass("pull-right"),t(r.find(".cat2 a")[0]).addClass("pull-left"),t(r.find(".cat3 a")[0]).removeClass("pull-right"),t(r.find(".cat3 a")[0]).addClass("pull-left"),t(r.find(".cat2 a")[0]).css("margin-left","10px"),t(r.find(".cat3 a")[0]).css("margin-left","10px"));o.val()&&o.val(o.val());s.val()&&s.val(s.val());h.val()&&(tt=t("#aCollection"),i=t(".cat"+t(tt).attr("data-prod-cat")),i?i.length>0&&i.toggle():t(".cat"+t(tt).attr("data-prod-close")).hide(),h.val(h.val()));c.val()&&(tt=r.find(".cat3").find("a")[0],i=t(".cat"+t(tt).attr("data-prod-cat")),i?i.length>0&&i.toggle():t(".cat"+t(tt).attr("data-prod-close")).hide(),c.val(c.val()));e=r.find("#txtCity_"+u);e.val()&&e.val(e.val());y=r.find("#txtState_"+u);l=r.find("#txtZipCode_"+u);l.val()&&l.val(l.val());a=r.find("#countryhdn_"+u).val();k=r.find("#Statehdn_"+u).val();b.autocomplete({source:function(i,r){i.term.trim().length!=0&&t.ajax({url:n.Application.contextUrl+"Location/GetCountry",dataType:"json",data:{style:"full",name_startsWith:i.term},success:function(n){r(t.map(n.result,function(n){return{label:n.Name,value:n.Name,id:n.Key}}))}})},minLength:1,select:function(n,t){a=t.item.id},open:function(){t(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){t(this).removeClass("ui-corner-top").addClass("ui-corner-all");y.val("");e.val("");k=0;nt=0;Number(a)>0&&(f=!0)}});y.autocomplete({source:function(i,r){i.term.trim().length!=0&&t.ajax({url:n.Application.contextUrl+"Location/GetStates",dataType:"json",data:{style:"full",name_startsWith:i.term,countryId:a},success:function(n){r(t.map(n.result,function(n){return{label:n.Name,value:n.Name,id:n.Key}}))}})},minLength:1,select:function(n,t){k=t.item.id},open:function(){t(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){t(this).removeClass("ui-corner-top").addClass("ui-corner-all")}});it.autocomplete({source:function(i,r){i.term.trim().length!=0&&t.ajax({url:n.Application.contextUrl+"Location/GetAddresses",dataType:"json",data:{style:"full",name_startsWith:i.term},success:function(n){r(t.map(n.result,function(n){return{label:n.ADDRESS,value:n.ADDRESS,C_COUNTRY_ID:n.C_COUNTRY_ID,C_LOCATION_ID:n.C_LOCATION_ID,C_REGION_ID:n.C_REGION_ID,COUNTRYNAME:n.COUNTRYNAME,ADDRESS1:n.ADDRESS1,ADDRESS2:n.ADDRESS2,ADDRESS3:n.ADDRESS3,ADDRESS4:n.ADDRESS4,CITYNAME:n.CITYNAME,STATENAME:n.STATENAME,ZIPCODE:n.ZIPCODE}}))}})},minLength:1,select:function(n,t){b.val(t.item.COUNTRYNAME);o.val(t.item.ADDRESS1);s.val(t.item.ADDRESS2);h.val(t.item.ADDRESS3);c.val(t.item.ADDRESS4);e.val(t.item.CITYNAME);y.val(t.item.STATENAME);l.val(t.item.ZIPCODE);f=!0;k=t.item.C_REGION_ID;v=0;nt=0;a=t.item.C_COUNTRY_ID},open:function(){t(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){t(this).removeClass("ui-corner-top").addClass("ui-corner-all")}});p.on("click",function(){if(g(!0),Number(a)<=0){n.ADialog.warn("SelectCountry",!0,null);g(!1);return}var t={countryName:b.val(),addvalue1:o.val(),addvalue2:s.val(),addvalue3:h.val(),addvalue4:c.val(),cityValue:e.val(),stateValue:y.val(),zipValue:l.val(),clocationId:v,countryId:a,stateId:k,cityId:nt},i=ut(t)});d.on("click",function(){r.dialog("close")});t(".VIS-Location-toggler").click(function(n){n.preventDefault();var i=t(".cat"+t(this).attr("data-prod-cat"));i?i.length>0&&i.toggle():t(".cat"+t(this).attr("data-prod-close")).hide()});b.bind("change",function(){f=!0});o.bind("change",function(){f=!0});s.bind("change",function(){f=!0});h.bind("change",function(){f=!0});c.bind("change",function(){f=!0});e.bind("change",function(){f=!0});y.bind("change",function(){f=!0});l.bind("change",function(){f=!0})};this.showDialog=function(){r.append(tt);r.dialog({modal:!0,resizable:!1,title:n.Msg.getMsg("Location"),width:620,position:{at:"center top",of:window},close:function(){w.dispose();w=null;r.dialog("destroy");r=null}})};this.disposeComponent=function(){w=null;p&&p.off("click");d&&d.off("click");v=0;it=null;b=null;o=null;s=null;h=null;c=null;e=null;y=null;l=null;a=null;k=null;nt=null;p=null;d=null;ut=null;rt=null;this.disposeComponent=null}}i.prototype.dispose=function(){this.disposeComponent()};n.LocationForm=i}(VIS,jQuery),function(n,t){function i(i,r,u,f,e,o){function vt(){function vt(){var n=nt.prop("checked");n?(it.hide(),rt.show(),l.removeClass("vis-gc-vpanel-table-readOnly"),a.removeClass("vis-gc-vpanel-table-readOnly"),v.removeClass("vis-gc-vpanel-table-readOnly"),y.removeClass("vis-gc-vpanel-table-readOnly"),c.removeClass("vis-gc-vpanel-table-readOnly"),c.removeAttr("disabled")):(rt.hide(),it.show(),l.addClass("vis-gc-vpanel-table-readOnly"),a.addClass("vis-gc-vpanel-table-readOnly"),v.addClass("vis-gc-vpanel-table-readOnly"),y.addClass("vis-gc-vpanel-table-readOnly"),c.addClass("vis-gc-vpanel-table-readOnly"),c.attr("disabled",!0));l.attr("readonly",!n);a.attr("readonly",!n);v.attr("readonly",!n);y.attr("readonly",!n)}function r(){var n=c.find("option:selected").text()+" "+g+" "+l.val()+" "+g+" "+a.val()+" "+g+" "+v.val();y.val(n)}function pt(){w.on("click",function(){if(yt(),k.onClose)k.onClose(u);s.dialog("close")});b.on("click",function(){s.dialog("close")});nt.change(function(){vt()});ut.change(function(){});l.change(function(){r()});a.change(function(){r()});v.change(function(){r()});c.change(function(){r()});d.change(function(){at(i)})}var e,o,lt,i,t;for(w=s.find("#btnOk_"+h),b=s.find("#btnCancel_"+h),d=s.find("#cmbLocator_"+h),nt=s.find("#chkCreateNew_"+h),ut=s.find("#txtWarehouseInfo_"+h),c=s.find("#cmbWarehouse_"+h),l=s.find("#txtX_"+h),a=s.find("#txtY_"+h),v=s.find("#txtZ_"+h),y=s.find("#txtValue_"+h),tt=s.find("#divchkCreateNew_"+h),it=s.find("#divWarehouseInfo_"+h),rt=s.find("#divWarehouse_"+h),et=s.find("#lblX_"+h),ot=s.find("#lblY_"+h),st=s.find("#lblZ_"+h),ht=s.find("#lblValue_"+h),ct=s.find("#lblWarehouse_"+h),n.Application.isRTL&&(w.css("margin-right","-132px"),b.css("margin-right","55px"),tt.children(0).css("float","left")),p.refresh(),p.fillCombobox(f,!0,!0,!1),e=0,t=0;t<p.data.length;t++)d.append(" <option value="+p.data[t].Key+">"+p.data[t].Name+"<\/option>"),u==p.data[t].Key&&(e=t);for(d.prop("selectedIndex",e),o="SELECT M_Warehouse_ID, Name FROM M_Warehouse",ft!=0&&(o+=" WHERE M_Warehouse_ID="+ft),lt=n.MRole.addAccessSQL(o,"M_Warehouse",n.MRole.SQL_NOTQUALIFIED,n.MRole.SQL_RO)+" ORDER BY 2",i=n.DB.executeDataSet(lt),t=0;t<i.tables[0].rows.length;t++)c.append(" <option value="+i.tables[0].getRow(t).getCell(0)+">"+i.tables[0].getRow(t).getCell(1)+"<\/option>");c.prop("selectedIndex",0);at(i);p.getIsOnlyOutgoing()&&tt.hide();vt();pt()}function yt(){var i;if(nt.prop("checked")){i="";y.val().trim().length==0&&(i+=ht.val()+" - ");l.val().trim().length==0&&(i+=et.val()+" - ");a.val().trim().length==0&&(i+=ot.val()+" - ");v.val().trim().length==0&&(i+=st.val()+" - ");var f=ct.val(),o=y.val(),s=l.val(),h=a.val(),w=v.val(),r=c.find("option:selected").val();e==0&&(i+=f+" - ");r!=0&&e!=r&&(e=r);i.length!=0?n.ADialog.error("FillMandatory",!0,i.substring(0,i.length-3)):t.ajax({url:n.Application.contextUrl+"Locator/Save",dataType:"json",async:!1,data:{warehouseId:e,tValue:o,tX:s,tY:h,tZ:w},success:function(n){returnValue=n.locatorId;u=returnValue;p.refresh()}})}else k.change=!0}function at(t){var s,f;u=d.find("option:selected").val();var r="",o="",h="SELECT  w.name,l.x,l.y,l.z,l.value, w.M_Warehouse_ID,w.Value wValue,w.separator from m_warehouse w inner join M_Locator l on w.m_warehouse_id=l.M_Warehouse_ID and l.m_locator_id="+u,i=n.DB.executeDataSet(h);for(i.tables[0].rows.length>0&&(ut.val(i.tables[0].getRow(0).getCell("name")),l.val(i.tables[0].getRow(0).getCell("x")),a.val(i.tables[0].getRow(0).getCell("y")),v.val(i.tables[0].getRow(0).getCell("z")),y.val(i.tables[0].getRow(0).getCell("value")),e=i.tables[0].getRow(0).getCell("M_Warehouse_ID"),o=i.tables[0].getRow(0).getCell("wValue"),r=i.tables[0].getRow(0).getCell("separator")),g=r,s=o+" "+r+" "+l.val()+" "+r+" "+a.val()+" "+r+" "+v.val(),y.val(s),f=0;f<t.tables[0].rows.length;f++)if(e==t.tables[0].getRow(0).getCell(0)){c.prop("selectedIndex",f);break}}this.onClose=null;this.change=!1;var s=t("<div style='position:relative;'>"),lt=t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>"),w=null,b=null,k=this,g=null,i=i,u=u,f=f,ft=e,e=0,h=o,p=r,d=null,nt=null,tt=null,it=null,rt=null,ut=null,c=null,l=null,a=null,v=null,y=null,et=null,ot=null,st=null,ht=null,ct=null;setBusy=function(n){lt.css("display",n?"block":"none")};this.load=function(){s.load(n.Application.contextUrl+"Locator/Index/?windowno="+h+"&locatorId="+u,function(){setBusy(!0);vt();setBusy(!1)})};this.showDialog=function(){s.append(lt);s.dialog({modal:!0,resizable:!1,title:n.Msg.translate(n.Env.getCtx(),"Locator"),width:510,position:{at:"center top",of:window},close:function(){k.dispose();k=null;s.dialog("destroy");s=null}})};this.disposeComponent=function(){w&&w.off("click");b&&b.off("click");w=null;b=null;k=null;i=null;u=null;f=null;ft=null;e=null;h=null;p=null;tt=null;it=null;rt=null;d=null;nt=null;ut=null;c=null;l=null;a=null;v=null;y=null;et=null;ot=null;st=null;ht=null;ct=null;this.disposeComponent=null;this.load=null;g=null}}i.prototype.dispose=function(){this.disposeComponent()};n.LocatorForm=i}(VIS,jQuery),function(n,t){function i(i,r,u){function o(n){s.css("display",n?"block":"none")}if(i==null)return null;var e=this,f=t("<div style='position:relative;'>"),s=t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>");if(this.Okbtn=null,this.cancelbtn=null,this.deletebtn=null,this.txtAttribute=null,this.lblAttribute=null,this.txtSearchKey=null,this.lblValue=null,this.lblAttribute=null,this.lblValueText=null,this.lblLevelText=null,this.chkTenant=null,this.chkOrg=null,this.chkUser=null,this.chkWindow=null,this.lblMsg=null,this.userchk=null,this.tenantchk=null,this.windowchk=null,this.orgchk=null,this.aValue=null,this.aDisplayValue=null,r!=null&&(this.aValue=r,typeof r==Boolean&&(this.aValue=r?"Y":"N"),this.aDisplayValue=u==null?this.aValue:u),this.AD_Window_ID=i.getAD_Window_ID(),this.aAttribute=i.getColumnName(),this.aDisplayAttribute=i.getHeader(),this.aDisplayType=i.getDisplayType(),this.AD_Reference_ID=0,this.windowNum=i.getWindowNo(),"Value".equals(this.aAttribute)||"DocumentNo".equals(this.aAttribute))return null;this.AD_Client_ID=n.context.getAD_Client_ID();this.AD_Org_ID=n.context.getWindowContext(this.windowNum,"AD_Org_ID",!0);this.AD_User_ID=n.context.getAD_User_ID();this.role=n.MRole.getDefault();this.load=function(){f.load(n.Application.contextUrl+"ValuePreference/Index/?windowno="+this.windowNum,function(){f.append(s);o(!0);e.init(f);o(!1)})};this.init=function(){this.lblAttributeText=f.find("#vlblAttributeText_"+this.windowNum);this.lblValueText=f.find("#vlblValueText_"+this.windowNum);this.lblLevelText=f.find("#vlblLevelText_"+this.windowNum);this.deletebtn=f.find("#btnDelete_"+this.windowNum);this.txtAttribute=f.find("#vtxtAttribute_"+this.windowNum);this.txtSearchKey=f.find("#vtxtSearchKey_"+this.windowNum);this.chkTenant=f.find("#vchkTenant_"+this.windowNum);this.chkOrg=f.find("#vchkOrg_"+this.windowNum);this.chkUser=f.find("#vchkUser_"+this.windowNum);this.chkWindow=f.find("#vchkWindow_"+this.windowNum);this.lblMsg=f.find("#vlblMsg_"+this.windowNum);this.lblAttribute=f.find("#vlblAttribute_"+this.windowNum);this.lblValue=f.find("#vlblValue_"+this.windowNum);this.Okbtn=f.find("#btnOK_"+this.windowNum);this.cancelbtn=f.find("#btnCancel_"+this.windowNum);n.Application.isRTL?(this.Okbtn.css("margin-right","-128px"),this.cancelbtn.css("margin-right","55px"),this.lblAttributeText.css("text-align","right"),this.lblValueText.css("text-align","right"),this.lblLevelText.css("text-align","right"),this.chkOrg.css("margin-right","0px"),this.chkTenant.css("margin-right","37px"),this.chkUser.css("margin-right","72px"),this.chkWindow.css("margin-right","72px"),f.find("#divMsg_"+this.windowNum).css("text-align","right")):(this.chkUser.css("margin-left","83px"),this.chkWindow.css("margin-left","45px"));this.txtAttribute.val(this.aDisplayAttribute==null?"":this.aDisplayAttribute);this.lblAttribute.text(this.aAttribute==null?"":this.aAttribute);this.txtSearchKey.val(this.aDisplayValue==null?"":n.Utility.decodeText(this.aDisplayValue));this.lblValue.text(this.aValue);this.lblAttributeText.text(n.Msg.getMsg("Attribute"));this.lblValueText.text(n.Msg.getMsg("SearchKey"));this.lblLevelText.text(n.Msg.getMsg("ValuePreferenceSetFor"));this.chkTenant.next("label").text(n.Msg.getMsg("Tenant"));this.chkOrg.next("label").text(n.Msg.getMsg("Org"));this.chkUser.next("label").text(n.Msg.getMsg("UserContact"));this.chkWindow.next("label").text(n.Msg.getMsg("Window"));this.chkTenant.prop("disabled",!0);this.chkTenant.prop("checked",!0);this.chkUser.prop("checked",!0);this.chkWindow.prop("checked",!0);n.MRole.PREFERENCETYPE_Client.equals(n.MRole.getPreferenceType())||(this.chkOrg.prop("disabled",!0),this.chkOrg.prop("checked",!0));n.MRole.PREFERENCETYPE_Client.equals(n.MRole.getPreferenceType())||n.MRole.PREFERENCETYPE_Organization.equals(n.MRole.getPreferenceType())||(this.chkUser.prop("disabled",!0),this.chkUser.prop("checked",!0));this.setExplanation();this.Okbtn.on("click",function(){o(!0);e.save();o(!1);f.dialog("close")});this.cancelbtn.on("click",function(){f.dialog("close")});this.deletebtn.on("click",function(){e.delete();f.dialog("close")});t("[id^=vch]").click(function(){e.setExplanation()})};this.showDialog=function(){f.append(s);o(!0);setTimeout(this.load(),5);f.dialog({modal:!0,title:n.Msg.getMsg("ValuePreference"),width:530,position:{at:"center top",of:window},close:function(){e.dispose();f.dialog("destroy");f=null}})};this.disposeComponent=function(){this.Okbtn&&this.Okbtn.off("click");this.cancelbtn&&this.cancelbtn.off("click");this.deletebtn&&this.deletebtn.off("click");t("[id^=vch]")&&t("[id^=vch]").off("click");this.Okbtn=null;this.cancelbtn=null;this.deletebtn=null;s=null;e=null;this.disposeComponent=null}}i.prototype.setExplanation=function(){var t="For ";this.chkTenant.prop("checked")&&this.chkOrg.prop("checked")?t+="this Client and Organization":this.chkTenant.prop("checked")&&!this.chkOrg.prop("checked")?t+="all Organizations of this Client":!this.chkTenant.prop("checked")&&this.chkOrg.prop("checked")?(this.chkOrg.prop("checked",!1),t+="entire System"):t+="entire System";t+=this.chkUser.prop("checked")?", this User":", all Users";t+=this.chkWindow.prop("checked")?" and this Window":" and all Windows";n.Env.isBaseLanguage()&&this.lblMsg.text(t.toString());this.orgchk=this.chkOrg.prop("checked");this.userchk=this.chkUser.prop("checked");this.windowchk=this.chkWindow.prop("checked");this.tenantchk=this.chkTenant.prop("checked")};i.prototype.getADPreferenceID=function(){var t="SELECT AD_Preference_ID FROM AD_Preference WHERE ",u=this.tenantchk?this.AD_Client_ID:0,i,r;return t+="AD_Client_ID="+u,u=this.orgchk?this.AD_Org_ID:0,t+=" AND AD_Org_ID="+u,t+=this.userchk?" AND AD_User_ID="+this.AD_User_ID:" AND AD_User_ID IS NULL",t+=this.windowchk?" AND AD_Window_ID="+this.AD_Window_ID:" AND AD_Window_ID IS NULL",t+=" AND Attribute='"+this.aAttribute+"'",i=0,r=n.DB.executeDataSet(t.toString()),r!=null&&r.tables[0].rows.length>0&&(i=r.tables[0].rows[0].getCell("ad_preference_id")),i<0&&(i=0),i};i.prototype.delete=function(){var i=!1,r=this.getADPreferenceID(),u=this;return r>0?t.ajax({url:n.Application.contextUrl+"ValuePreference/Delete",dataType:"json",data:{preferenceId:r},success:function(t){i=t.result;i&&(n.Env.getCtx().setContext(u.getContextKey(),null),n.ADialog.info("ValuePreferenceDeleted",!0,"",null))}}):n.ADialog.warn("ValuePreferenceNotFound",!0,"",null),i};i.prototype.save=function(){if(this.aValue==null)if(n.DisplayType.IsLookup(this.displayType))this.aValue="-1";else if(n.DisplayType.IsDate(this.displayType))this.aValue=" ";else return n.ADialog.warn("ValuePreferenceNotInserted",!0,"",null),!1;else if(this.aValue.toString().indexOf("@")!=-1)return!1;var i=!1,u=this.getADPreferenceID(),r=this;return t.ajax({url:n.Application.contextUrl+"ValuePreference/Save",dataType:"json",data:{preferenceId:u,clientId:this.tenantchk?this.AD_Client_ID:0,orgId:this.orgchk?this.AD_Org_ID:0,chkWindow:this.windowchk,AD_Window_ID:this.AD_Window_ID,chkUser:this.userchk,attribute:this.aAttribute,userId:this.AD_User_ID,value:this.aValue},success:function(t){i=t.result;i?(n.Env.getCtx().setContext(r.getContextKey(),r.aValue),n.ADialog.info("ValuePreferenceInserted",!0,"",null)):n.ADialog.warn("ValuePreferenceNotInserted",!0,"",null)}}),i};i.prototype.getContextKey=function(){return this.windowchk?"P"+this.AD_Window_ID+"|"+this.aAttribute:"P|"+this.aAttribute};i.prototype.dispose=function(){this.disposeComponent()};n.ValuePreference=i}(VIS,jQuery),function(n,t){function i(i,r,u,f,e,o,s){function ri(){t.ajax({url:n.Application.contextUrl+"PAttributes/Load",dataType:"json",async:!1,data:{mAttributeSetInstanceId:b,mProductId:p,productWindow:nt,windowNo:c,AD_Column_ID:o,window_ID:lt,IsSOTrx:wt,IsInternalUse:bt},success:function(t){if(returnValue=t.result,returnValue.Error!=null){n.ADialog.error(returnValue.Error,null,null,null);d.hasAttribute=!1;return}h.html(returnValue.tableStucture);h.append(at);returnValue.ControlList&&(l=returnValue.ControlList.split(","));ti=returnValue.MAttributeSetID}})}function ui(t){var i,r;if(v.val(""),k.val(""),w.val(Globalize.format(new Date,"yyyy-MM-dd")),t=jQuery.parseJSON(t),t.result!=null)for(i in t.result)if(l){r=h.find("#"+l[i]);l[i].toString().contains("cmb")?r.val(n.Utility.Util.getValueOfInt(t.result[i])):r.val(t.result[i]);continue}v!=null&&t.lot!=""?v.val(t.lot):k!=null&&t.serial!=""&&k.val(t.serial);w!=null&&t.gdate!=""&&w.val(Globalize.format(new Date(t.gdate),"yyyy-MM-dd"))}function fi(){var t=!0,i=!0,r,u,f,e;if(ft.prop("checked")){if(r=v.val(),t=!1,u="select count(*) from ad_column where columnname = 'UniqueLot' and ad_table_id = (select ad_table_id from ad_table where tablename = 'M_AttributeSet')",f=n.DB.executeScalar(u),f>0&&(e=si(r),e))return t=!0,n.ADialog.Info("LotNoExists",null,null,null),!1;t||(i=kt())}return t&&(i=kt()),i}function kt(){var e=!0,f=[],u,i;if(l)for(u=0;u<l.length;u++)if(i=h.find("#"+l[u]),l[u].toString().contains("cmb"))i.find("option:selected").length>0?f.push({Key:Number(i.find("option:selected").val()),Name:i.find("option:selected").text()}):f.push({Key:0,Name:i.val()});else{if(i.attr("class").contains("vis-gc-vpanel-table-mandatory")&&i.val().trim().length==0)return n.ADialog.warn("FillMandatoryFields",!0,null),e=!1;i.attr("type")=="number"&&(i.val().contains(".")||i.val(i.val().concat(".0")));f.push({Key:0,Name:i.val()})}return t.ajax({url:n.Application.contextUrl+"PAttributes/Save",type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",async:!1,data:JSON.stringify({windowNoParent:a,strLotString:v.val(),strSerNo:k.val(),dtGuaranteeDate:w.val(),strAttrCode:st.val(),productWindow:nt,mAttributeSetInstanceId:b,mProductId:r,windowNo:c,lst:f}),success:function(t){if(returnValue=t.result,returnValue)if(returnValue.Error!=null)alert(returnValue.Error),e=!1;else if(n.Env.getCtx().setContext(a,"AttrCode",returnValue.attrCode),d.onClose)d.onClose(returnValue.M_AttributeSetInstance_ID,returnValue.M_AttributeSetInstanceName,g)},error:function(n,t){console.log(t);returnValue}}),e}function ei(){var i,o,r;d.log.config("");i=0;a!=-1&&(i=window.DTD001&&lt==170?n.Env.getCtx().getContextAsInt(a,"DTD001_MWarehouseSource_ID"):n.Env.getCtx().getContextAsInt(a,"M_Warehouse_ID"));var u="",f="SELECT p.Name, w.Name FROM M_Product p, M_Warehouse w WHERE p.M_Product_ID="+p+" AND w.M_Warehouse_ID="+i,t=null;try{t=n.DB.executeReader(f,null);t.read()&&(u=t.getString(0)+" - "+t.getString(1));t.close();t=null}catch(e){t!=null&&t.close();this.log.Log(Level.SEVERE,f,e)}o=-1;r=new n.PAttributeInstance(u,i,g,p,ct);r.showDialog();r.onClose=function(n,t,i){if(n!=-1&&(b=n,ht=t,g=i,yt=!0,d.onClose)){d.onClose(b,ht,g);h.dialog("close")}};r=null}function oi(){var n=ft.prop("checked"),t,i;if(v&&(v.attr("readOnly",!n),n?v.removeClass("vis-gc-vpanel-table-readOnly"):v.addClass("vis-gc-vpanel-table-readOnly")),y&&(n?(y.removeClass("vis-gc-vpanel-table-readOnly"),y.removeAttr("disabled")):(y.attr("disabled",!0),y.addClass("vis-gc-vpanel-table-readOnly"))),rt&&(n?rt.removeAttr("disabled"):rt.attr("disabled",!0)),k&&(k.attr("readOnly",!n),n?k.removeClass("vis-gc-vpanel-table-readOnly"):k.addClass("vis-gc-vpanel-table-readOnly")),ut&&(n?ut.removeAttr("disabled"):ut.attr("disabled",!0)),w&&(w.prop("disable",n),n?(w.removeClass("vis-gc-vpanel-table-readOnly"),w.removeAttr("disabled")):(w.addClass("vis-gc-vpanel-table-readOnly"),w.attr("disabled",!0))),l)for(t=0;t<l.length;t++)i=h.find("#"+l[t]),i.attr("readOnly",!n),n?i.removeClass("vis-gc-vpanel-table-readOnly"):i.addClass("vis-gc-vpanel-table-readOnly")}function si(t){var u="",o=!1,r=null,s,h;try{u="SELECT COUNT(*) FROM M_Storage s INNER JOIN M_Locator l ON (l.M_Locator_ID = s.M_Locator_ID)  inner join M_warehouse w ON (w.M_warehouse_ID = l.M_Warehouse_ID) WHERE AD_Client_ID = "+n.context.getAD_Client_ID();var i="",c=n.Env.getCtx().getContextAsInt(a,"AD_Org_ID"),l="SELECT IsOrganization, IsProduct, IsWarehouse FROM M_AttributeSet aSet INNER JOIN M_Product mp on mp.M_AttributeSet_ID = aset.M_AttributeSet_ID WHERE mp.M_Product_ID = "+p;if(r=n.DB.executeReader(l,null),r.read()){if(r.getString(0).toUpper()=="Y"&&(i=i.concat(" OR s.AD_Org_ID = "+c)),r.getString(1).toUpper()=="Y"&&(i=i.concat(" OR s.M_Product_ID = "+p)),r.getString(2).toUpper()=="Y"){var e=0,v="SELECT TableName FROM AD_Table WHERE AD_Table_ID = "+n.Env.getCtx().getContext(a,"BaseTable_ID"),f=n.DB.executeReader(v,null);f.read()?(f.getString(0).toUpper()=="M_MOVEMENT"&&(s="SELECT wh.M_Warehouse_ID FROM M_Warehouse wh INNER JOIN M_Locator l ON (wh.M_Warehouse_ID = l.M_Warehouse_ID)  WHERE l.M_Locator_ID = "+n.Env.getCtx().getContext(a,"M_LocatorTo_ID"),e=n.DB.executeScalar(s,null)),f.close(),f=null):e=n.Env.getCtx().getContextAsInt(a,"M_Warehouse_ID");i=i.concat(" OR w.M_Warehouse_ID = "+e)}i.length>0&&(i=i.Remove(0,3),u=u+" AND ("+i.toString(),u=u+") AND s.M_AttributeSetInstance_ID IN (SELECT M_AttributeSetInstance_ID FROM M_AttributeSetInstance WHERE Lot = '"+t+"')")}r.close();r=null;h=n.DB.executeScalar(u);h>0&&(o=!0)}catch(y){r!=null&&r.close()}return o}function hi(n){y.append(new Option(n.Name,n.Key,!0,!0));y.change()}function ci(){if(y!=null&&y.change(function(){var n=y.find("option:selected").val(),t=y.find("option:selected").text();n!=null&&n!=-1?(v.val(t),v.attr("readOnly",!0),v.addClass("vis-gc-vpanel-table-readOnly"),dt=n):(v.attr("readOnly",!1),v.removeClass("vis-gc-vpanel-table-readOnly"))}),ft!=null&&ft.change(function(){oi()}),st!=null)st.on("keydown",function(i){(i.keyCode==13||i.keyCode==9)&&t.ajax({url:n.Application.contextUrl+"PAttributes/GetAttribute",dataType:"json",async:!1,data:{mAttributeSetInstanceId:b,mProductId:p,productWindow:nt,windowNo:c,AD_Column_ID:o,attrcode:st.val()},success:function(n){returnValue=n;returnValue!=null&&ui(returnValue)}})});if(tt!=null)tt.on("click",function(){et(!0);fi()&&h.dialog("close");et(!1)});if(it!=null)it.on("click",function(){h.dialog("close")});if(ot!=null){et(!0);ot.on("click",function(){ei()});et(!1)}if(rt!=null)rt.on("click",function(){t.ajax({url:n.Application.contextUrl+"PAttributes/CreateLot",dataType:"json",async:!1,data:{mAttributeSetInstanceId:b,mProductId:p},success:function(n){returnValue=n.result;hi(returnValue)}})});if(ut!=null)ut.on("click",function(){t.ajax({url:n.Application.contextUrl+"PAttributes/GetSerNo",dataType:"json",async:!1,data:{mAttributeSetInstanceId:b,mProductId:p},success:function(n){returnValue=n.result;k.val(returnValue)}})});l}function et(n){at.css("display",n?"block":"none")}this.onClose=null;var d=this,h=t("<div style='position:relative'>"),at=t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>"),c=n.Env.getWindowNo(),b=null,g=null,ht=null,p=null,ct=null,vt=null,a=null,dt=null,nt=!1,yt=!1,gt=40,ni={},l=null,ti=null,pt="",lt=0,wt=!1,bt=!1;if(this.log=n.Logging.VLogger.getVLogger("PAttributesForm"),this.log.config("M_AttributeSetInstance_ID="+i+", M_Product_ID="+r+", C_BPartner_ID="+f+", ProductW="+nt+", Column="+o),b=i,p=r,ct=f,nt=e,vt=o,a=s,g=u,a!=-1&&(pt="SELECT AD_Window_ID FROM AD_Tab WHERE AD_Tab_ID = "+n.Utility.Util.getValueOfInt(n.context.getWindowTabContext(a,0,"AD_Tab_ID")),lt=n.Utility.Util.getValueOfInt(n.DB.executeScalar(pt,null,null)),wt=n.context.isSOTrx(a),bt=n.context.getWindowTabContext(a,0,"IsInternalUse")),p!=0){this.hasAttribute=!0;ri();var tt=h.find("#btnOk_"+c),it=h.find("#btnCancel_"+c),ot=h.find("#btnSelect_"+c),rt=h.find("#btnLot_"+c),ut=h.find("#btnSerNo_"+c),y=h.find("#cmbLot_"+c),ft=h.find("#chkNewEdit_"+c),ii=h.find("#txtDescription_"+c),v=h.find("#txtLotString_"+c),k=h.find("#txtSerNo_"+c),w=h.find("#dtpicGuaranteeDate_"+c),st=h.find("#txtAttrCode_"+c);ot.children(0).attr("src",n.Application.contextUrl+"Areas/VIS/Images/base/Locator10.png");n.Application.isRTL&&(tt.css("margin-right","-138px"),it.css("margin-right","55px"));!nt;ci();this.showDialog=function(){if(h.dialog({modal:!0,title:n.Msg.translate(n.Env.getCtx(),"M_AttributeSetInstance_ID"),width:490,close:function(){d.dispose();d=null;h.dialog("destroy");h=null}}),l&&i==0)for(var t=0;t<l.length;t++)l[t].toString().contains("cmb")&&h.find("#"+l[t]).prop("selectedIndex",-1);et(!1)};this.disposeComponent=function(){tt&&tt.off("click");it&&it.off("click");n.Env.clearWinContext(n.Env.getCtx(),c);n.Env.getCtx().setContext(n.Env.WINDOW_INFO,n.Env.TAB_INFO,"M_AttributeSetInstance_ID",b);n.Env.getCtx().setContext(n.Env.WINDOW_INFO,n.Env.TAB_INFO,"M_Locator_ID",g);g=null;ht=null;p=null;ct=null;vt=null;a=null;nt=null;yt=null;gt=0;ni=null;tt=null;it=null;ot=null;rt=null;ut=null;y=null;ft=null;ii=null;v=null;k=null;w=null;d=null;c=null;b=null;this.disposeComponent=null}}}i.prototype.dispose=function(){this.disposeComponent()};n.PAttributesForm=i}(VIS,jQuery),function(n,t){function i(i,r,u,f,e){function ct(t){var f;if(o.log.config("C_BPartner_ID="+t),t!=0){var u=0,r=0,e="SELECT bp.ShelfLifeMinPct, bpp.ShelfLifeMinPct, bpp.ShelfLifeMinDays FROM C_BPartner bp  LEFT OUTER JOIN C_BPartner_Product bpp ON (bp.C_BPartner_ID=bpp.C_BPartner_ID AND bpp.M_Product_ID="+g+") WHERE bp.C_BPartner_ID="+t,i=null;try{i=n.DB.executeReader(e,null);i.read()&&(u=i.getInt(0),f=i.getInt(1),f>0&&(r=f),r=i.getInt(2));i.close();i=null}catch(h){i!=null&&i.close();this.log.Log(Level.SEVERE,e,h)}u>0&&(w=" AND COALESCE(TRUNC((daysBetween(TRUNC(asi.GuaranteeDate,'DD'),TRUNC(SysDate,'DD'))/p.GuaranteeDays)*100),0)>="+u,o.log.config("PAttributeInstance.dynInit - ShelfLifeMinPct="+u));r>0&&(w+=" AND COALESCE(daysBetween(TRUNC(asi.GuaranteeDate,'DD'),TRUNC(SysDate,'DD')),0)>="+r,o.log.config("PAttributeInstance.dynInit - ShelfLifeMinDays="+r))}c=lt(et,ot,!1,"s")+" ORDER BY asi.GuaranteeDate, s.QtyOnHand";it();k.append(b);tt.append(l).append(s);a.append(rt).append(k).append(nt).append(tt);vt()}function lt(t,i,r,u){var f="SELECT s.M_AttributeSetInstance_ID, asi.Description, asi.Lot, asi.SerNo, asi.GuaranteeDate, l.Value,s.M_Locator_ID, s.QtyOnHand, s.QtyReserved, s.QtyOrdered, (daysBetween(TRUNC(asi.GuaranteeDate,'DD'),TRUNC(SysDate,'DD'))-p.GuaranteeDaysMin) as ShelfLifeDays, daysBetween(TRUNC(asi.GuaranteeDate,'DD'),TRUNC(SysDate,'DD')) as GoodForDays, CASE WHEN p.GuaranteeDays > 0 THEN  ROUND(daysBetween(TRUNC(asi.GuaranteeDate,'DD'),TRUNC(SysDate,'DD'))/p.GuaranteeDays*100,12) ELSE 0 END as ShelfLifeRemainingPct",e;return(f=f.concat(" FROM ").concat(t),f=f.concat(" WHERE ").concat(i),d!=0&&(f=f.concat(" AND w.M_Warehouse_ID = "+d)),t.length==0)?f.toString():(o.log.finest(e),n.MRole.getDefault().addAccessSQL(f,u,n.MRole.SQL_FULLYQUALIFIED,n.MRole.SQL_RO))}function it(){var u,i,f,t;c==null&&(c="");var e=[],r=c,s=c.lastIndexOf(" ORDER BY ");b.prop("checked")||(r=c.substring(0,s)+st,w.length>0&&(r+=w),r+=c.substring(s));o.log.finest(r);try{for(u=[],u[0]=new n.DB.SqlParam("@M_Product_ID",g),i=n.DB.executeReader(r,u),f=1;i.read();)t={},t.M_AttributeSetInstance_ID=i.getInt("M_AttributeSetInstance_ID"),t.Description=i.getString("Description"),t.Lot=i.getString("Lot"),t.SerNo=i.getString("SerNo"),t.GuaranteeDate=i.getString("GuaranteeDate"),t.Value=i.getString("Value"),t.QtyReserved=i.getString("QtyReserved"),t.QtyOrdered=i.getString("QtyOrdered"),t.QtyOnHand=i.getString("QtyOnHand"),t.GoodForDays=i.getString("GoodForDays"),t.ShelfLifeDays=i.getString("ShelfLifeDays"),t.ShelfLifeRemainingPct=i.getString("ShelfLifeRemainingPct"),t.M_Locator_ID=i.getString("M_Locator_ID"),t.recid=f,f++,e.push(t);ht()}catch(h){}at(e)}function at(i){o.dGrid!=null&&(o.dGrid.destroy(),o.dGrid=null);o.arrListColumns.length==0&&(o.arrListColumns.push({field:"Description",caption:n.Msg.translate(n.Env.getCtx(),"Description"),sortable:!0,size:"16%",min:150,hidden:!1}),o.arrListColumns.push({field:"Lot",caption:n.Msg.translate(n.Env.getCtx(),"Lot"),sortable:!0,size:"16%",min:150,hidden:!1}),o.arrListColumns.push({field:"SerNo",caption:n.Msg.getElement(n.Env.getCtx(),"SerNo"),sortable:!0,size:"16%",min:150,hidden:!1}),o.arrListColumns.push({field:"GuaranteeDate",caption:n.Msg.getElement(n.Env.getCtx(),"GuaranteeDate"),sortable:!0,size:"16%",min:150,hidden:!1,render:"date"}),o.arrListColumns.push({field:"Value",caption:n.Msg.getElement(n.Env.getCtx(),"M_Locator_ID"),sortable:!0,size:"16%",min:150,hidden:!1}),o.arrListColumns.push({field:"QtyReserved",caption:n.Msg.getElement(n.Env.getCtx(),"QtyReserved"),sortable:!0,size:"20%",min:150,hidden:!1}),o.arrListColumns.push({field:"QtyOrdered",caption:n.Msg.getElement(n.Env.getCtx(),"QtyOrdered"),sortable:!0,size:"20%",min:150,hidden:!1}),o.arrListColumns.push({field:"QtyOnHand",caption:n.Msg.getElement(n.Env.getCtx(),"QtyOnHand"),sortable:!0,size:"20%",min:150,hidden:!1}),o.arrListColumns.push({field:"GoodForDays",caption:n.Msg.getElement(n.Env.getCtx(),"GoodForDays"),sortable:!0,size:"20%",min:150,hidden:!1}),o.arrListColumns.push({field:"ShelfLifeDays",caption:n.Msg.getElement(n.Env.getCtx(),"ShelfLifeDays"),sortable:!0,size:"20%",min:150,hidden:!1}),o.arrListColumns.push({field:"ShelfLifeRemainingPct",caption:n.Msg.getElement(n.Env.getCtx(),"ShelfLifeRemainingPct"),sortable:!0,size:"20%",min:150,hidden:!1}),o.arrListColumns.push({field:"M_Locator_ID",caption:n.Msg.getElement(n.Env.getCtx(),"M_Locator_ID"),sortable:!0,size:"16%",min:150,hidden:!0}),o.arrListColumns.push({field:"M_AttributeSetInstance_ID",caption:n.Msg.translate(n.Env.getCtx(),"ID"),sortable:!0,size:"16%",min:150,hidden:!0}));setTimeout(10);w2utils.encodeTags(i);o.dGrid=t(nt).w2grid({name:"gridPinstance"+h,recordHeight:30,columns:o.arrListColumns,records:i,onClick:function(){o.dGrid.records.length>0&&s.removeAttr("disabled")}})}function ht(){var n=-1,t=n!=-1,i;o.dGrid!=null&&(n=Number(o.dGrid.getSelection().toString()),y=-1,p=null,v=0,t=n!=-1,t&&n>0&&(i=o.dGrid.get(n).M_AttributeSetInstance_ID,i>0&&(y=i,p=o.dGrid.get(n).Description,v=o.dGrid.get(n).M_Locator_ID)));s.attr("disabled",!0);t&&s.removeAttr("disabled");o.log.fine("M_AttributeSetInstance_ID="+y+" - "+p+"; M_Locator_ID="+v)}function vt(){if(s!=null)s.on(n.Events.onTouchStartOrClick,function(){if(ht(),o.onClose)o.onClose(y,p,v);a.dialog("close")});if(l!=null)l.on(n.Events.onTouchStartOrClick,function(){a.dialog("close")});b!=null&&b.change(function(){it()})}var o=this;this.onClose=null;var a=t("<div>"),rt=t("<div class='vis-apanel-busy'>"),d=r,v=u,g=f,ut=e,ft=i;this.arrListColumns=[];this.dGrid=null;var y=-1,p=null,c="",et="M_Storage s INNER JOIN M_Locator l ON (s.M_Locator_ID=l.M_Locator_ID) INNER JOIN M_Warehouse w ON (l.M_Warehouse_ID=w.M_Warehouse_ID) INNER JOIN M_Product p ON (s.M_Product_ID=p.M_Product_ID) LEFT OUTER JOIN M_AttributeSetInstance asi ON (s.M_AttributeSetInstance_ID=asi.M_AttributeSetInstance_ID)",ot=" s.M_Product_ID=@M_Product_ID AND s.M_AttributeSetInstance_ID != 0",st=" AND (s.QtyOnHand<>0 OR s.QtyReserved<>0 OR s.QtyOrdered<>0)",w="";this.log=n.Logging.VLogger.getVLogger("PAttributeInstance");var h=n.Env.getWindowNo(),b=t("<input id='chkShowAll_"+h+"' type='checkbox' ><span><label id='lblShowAll_"+h+"' class='VIS_Pref_Label_Font'>"+n.Msg.getMsg("ShowAll")+"<\/label><\/span>"),s=t("<input id='btnOk_"+h+"' class='VIS_Pref_btn-2' style='margin-bottom: 1px; margin-top: 5px; float: right; margin-right: 15px ;' type='button' value='"+n.Msg.getMsg("OK")+"'>"),l=t("<input id='btnCancel_"+h+"' class='VIS_Pref_btn-2' style='margin-bottom: 1px; margin-top: 5px; float: right;margin-right: 0px;' type='button' value='"+n.Msg.getMsg("Cancel")+"'>"),k=t("<div id='topdiv_"+h+"' style='float: left; width: 100%; height: 10%; text-align: right;'>"),nt=t("<div id='middeldiv_"+h+"' style='float: left; width: 100%; height: 244px;'>"),tt=t("<div id='bottomdiv_"+h+"' style='float: left; width: 100%; height: 14%;'>");n.Application.isRTL&&(k.css("text-align","left"),s.css("margin-right","-130px"),l.css("margin-right","55px"));this.showDialog=function(){a.dialog({modal:!0,title:n.Msg.translate(n.Env.getCtx(),ft),width:540,height:400,resizable:!1,close:function(){o.dispose();o=null;a.dialog("destroy");a=null}});it()};this.disposeComponent=function(){s&&s.off("click");l&&l.off("click");s=null;l=null;h=null;this.onClose=null;rt=null;d=null;v=null;g=null;ut=null;ft=null;this.arrListColumns=null;this.dGrid=null;et=null;ot=null;st=null;w=null;this.log=null;b=null;k=null;nt=null;tt=null;y=null;p=null;c=null;this.disposeComponent=null};ct(ut)}i.prototype.dispose=function(){this.disposeComponent()};n.PAttributeInstance=i}(VIS,jQuery),function(n,t){function i(i,r,u,f,e,o){function rt(){t.ajax({url:n.Application.contextUrl+"GenralAttribute/Load",dataType:"json",async:!1,data:{mAttributeSetInstanceId:v,vadms_AttributeSet_ID:p,windowNo:h},success:function(t){if(returnValue=t.result,n.Env.getCtx().setContext(h,"C_GenAttributeSet_ID",p),returnValue.Error!=null){n.ADialog.error(returnValue.Error,null,null,null);return}s.html(returnValue.tableStucture);a=returnValue.ControlList.split(",")}})}function ut(){for(var u=[],r,i=0;i<a.length;i++)r=s.find("#"+a[i]),a[i].toString().contains("cmb")?u.push({Key:Number(r.find("option:selected").val()),Name:r.find("option:selected").text()}):u.push({Key:0,Name:n.Utility.decodeText(r.val())});t.ajax({url:n.Application.contextUrl+"GenralAttribute/Save",type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",async:!1,data:JSON.stringify({windowNoParent:w,mAttributeSetInstanceId:v,vadms_AttributeSet_ID:p,windowNo:h,lst:u}),success:function(n){if(returnValue=n.result,l.onClose)l.onClose(returnValue.M_AttributeSetInstance_ID,returnValue.M_AttributeSetInstanceName)}})}function ft(){for(var u=[],r,i=0;i<a.length;i++)r=s.find("#"+a[i]),a[i].toString().contains("cmb")?u.push({Key:Number(r.find("option:selected").val()),Name:r.find("option:selected").text()}):u.push({Key:0,Name:r.val()});t.ajax({url:n.Application.contextUrl+"GenralAttribute/SearchValues",type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",async:!1,data:JSON.stringify({windowNoParent:Number(w),mAttributeSetInstanceId:v,vadms_AttributeSet_ID:p,windowNo:h,lst:u}),success:function(n){if(returnValue=n.result,l.onClose){returnValue.M_AttributeSetInstanceName==null&&(returnValue.M_AttributeSetInstanceName=returnValue.Description);l.onClose(returnValue.M_AttributeSetInstance_ID,returnValue.M_AttributeSetInstanceName,returnValue.GenSetInstance)}}})}var l,s;this.onClose=null;l=this;s=t("<div>");this.log=n.Logging.VLogger.getVLogger("GenralAttributeForm");var h=n.Env.getWindowNo(),v=null,k=null,d=null,w=u,p=0,g=!1,nt=40,tt=o,it={},b=!1,c=null,y=null,a=null;this.log.config("C_GenAttributeSetInstance_ID="+i);v=i;p=r;tt=o;b=f;rt();c=s.find("#btnOk_"+h);y=s.find("#btnCancel_"+h);e?(c.attr("disabled",!1),c.css("opacity","1")):(c.attr("disabled",!0),c.css("opacity","0.6"));n.Application.isRTL&&(c.css("margin-right","-132px"),y.css("margin-right","55px"));this.btnSelect=s.find("#btnSelect_"+h);this.txtDescription=s.find("#txtDescription_"+h);c.on("click",function(){b?ft():ut();s.dialog("close")});y.on("click",function(){s.dialog("close")});this.showDialog=function(){s.dialog({modal:!0,title:n.Msg.translate(n.Env.getCtx(),"C_GenAttributeSetInstance_ID"),width:400,close:function(){l.dispose();l=null;s.dialog("destroy");s=null}})};this.disposeComponent=function(){c&&c.off("click");y&&y.off("click");n.Env.clearWinContext(n.Env.getCtx(),h);n.Env.getCtx().setContext(n.Env.WINDOW_INFO,n.Env.TAB_INFO,"M_AttributeSetInstance_ID",v);c=null;y=null;mLocatorId=null;k=null;mProductId=null;d=null;adColumnId=null;w=null;productWindow=null;g=null;nt=0;it=null;l=null;h=null;v=null;this.disposeComponent=null}}i.prototype.dispose=function(){this.disposeComponent()};n.GenralAttributeForm=i}(VIS,jQuery),function(n,t){function i(i,r,u){this.onClose=null;var ct=t("<div style='position:relative;'>"),wt=t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>"),o=this,ki=i,bt=r,it=u,e=n.Env.getWindowNo(),di=null,dt=new n.Controls.VLabel,s=null,ft=null,tt=null,c=null,l=null,h=null,a=null,v=null,y=null,p=null,w=null,b=null,k=null,d=null,g=null,nt=null;this.log=n.Logging.VLogger.getVLogger("AccountForm");this.log.config("C_AcctSchema_ID="+it+", C_ValidCombination_ID="+bt.C_ValidCombination_ID);var ir=181,gt="AC",ni="AY",ti="BP",ii="LF",ri="LT",ui="MC",fi="OO",ei="OT",oi="PJ",si="PR",hi="SA",ci="SR",li="U1",ai="U2",rr="X1",ur="X2",at=t("<table>");at.css("width","100%");var et=t("<tr>"),st=null,ht=null,vt=null,yt=null,pt=null,vi=null,yi=null,gi=null,nr=null,pi=null,tr=null,rt=null,fr=!1,wi=null,lt=null,f=null,bi=null,kt=null,ut=null,ot=null;this.load=function(){ct.load(n.Application.contextUrl+"AccountForm/Index/?windowno="+e,function(){o.setBusy(!0);o.init(ct);o.setBusy(!1)})};this.setBusy=function(n){wt.css("display",n?"block":"none")};this.init=function(i){function ki(){n.Env.getCtx().setContext(e,"C_AcctSchema_ID",it);t.ajax({url:n.Application.contextUrl+"AccountForm/LoadControls",dataType:"json",data:{windowNo:e,C_AcctSchema_ID:it},success:function(n){returnValue=n.result;di(returnValue);ot=returnValue}})}function di(i){n.AEnv.getGridWindow(e,153,function(r){var wt,vt,dt,yt,pt,ht,ot,st,et,ct;if(r.error!=null){n.ADialog.error(r.error);self.dispose();self=null;return}if(wt=t.parseJSON(r.result),n.context.setContextOfWindow(t.parseJSON(r.wCtx),e),vt=new n.GridWindow(wt),vt!=null){for(f=vt.getTabs()[0],f.getField("Alias").setDisplayLength(15),f.getField("Combination").setDisplayLength(15),f.getField("AD_Client_ID").setDisplayed(!1),f.getField("C_AcctSchema_ID").setDisplayed(!1),f.getField("IsActive").setDisplayed(!1),f.getField("IsFullyQualified").setDisplayed(!1),ht=0;ht<f.getFieldCount();ht++)et=f.getField(ht),et.getIsDisplayed(!0)||et.setDisplayed(!1);for(dt=e+"_"+it,rt=new n.GridController(!1,!1,dt),rt.initGrid(!0,e,o,f),rt.setVisible(!0),window.innerHeight>700?rt.sizeChanged(window.innerHeight-230,window.innerWidth):rt.sizeChanged(window.innerHeight-215,window.innerWidth),pi.append(rt.getRoot()),rt.activate(),i.IsHasAlies&&(yt=f.getField("Alias"),s=n.VControlFactory.getControl(f,yt,!1),u(yt,s,!1)),pt=f.getField("Combination"),ft=n.VControlFactory.getControl(f,pt,!1),u(pt,ft,!1),ht=0;ht<i.Elements.length;ht++)ot=returnValue.Elements[ht].Type,st=returnValue.Elements[ht].IsMandatory,ot.equals(fi)?(et=f.getField("AD_Org_ID"),tt=n.VControlFactory.getControl(f,et,!1),u(et,tt,st)):ot.equals(gt)?(et=f.getField("Account_ID"),c=n.VControlFactory.getControl(f,et,!1),c.setValue(it),u(et,c,st)):ot.equals(hi)?(et=f.getField("C_SubAcct_ID"),l=n.VControlFactory.getControl(f,et,!1),u(et,l,st)):ot.equals(si)?(et=f.getField("M_Product_ID"),h=n.VControlFactory.getControl(f,et,!1),h.getBtn(),u(et,h,st)):ot.equals(ti)?(et=f.getField("C_BPartner_ID"),a=n.VControlFactory.getControl(f,et,!1),u(et,a,st)):ot.equals(ui)?(et=f.getField("C_Campaign_ID"),v=n.VControlFactory.getControl(f,et,!1),u(et,v,st)):ot.equals(ii)?(et=f.getField("C_LocFrom_ID"),y=n.VControlFactory.getControl(f,et,!1),u(et,y,st)):ot.equals(ri)?(et=f.getField("C_LocTo_ID"),p=n.VControlFactory.getControl(f,et,!1),u(et,p,st)):ot.equals(oi)?(et=f.getField("C_Project_ID"),w=n.VControlFactory.getControl(f,et,!1),u(et,w,st)):ot.equals(ci)?(et=f.getField("C_SalesRegion_ID"),b=n.VControlFactory.getControl(f,et,!1),u(et,b,st)):ot.equals(ei)?(et=f.getField("AD_OrgTrx_ID"),k=n.VControlFactory.getControl(f,et,!1),u(et,k,st)):ot.equals(ni)?(et=f.getField("C_Activity_ID"),d=n.VControlFactory.getControl(f,et,!1),u(et,d,st)):ot.equals(li)?(et=f.getField("User1_ID"),g=n.VControlFactory.getControl(f,et,!1),u(et,g,st)):ot.equals(ai)&&(et=f.getField("User2_ID"),nt=n.VControlFactory.getControl(f,et,!1),u(et,nt,st));ut.css("display","none");yi.html(at);lt=new n.Query;lt.addRestriction("C_AcctSchema_ID",n.Query.prototype.EQUAL,it);lt.addRestriction("IsFullyQualified",n.Query.prototype.EQUAL,"Y");bt.C_ValidCombination_ID==0?f.setQuery(n.Query.prototype.getEqualQuery("1","2")):(ct=new n.Query,ct.addRestriction("C_AcctSchema_ID",n.Query.prototype.EQUAL,it),ct.addRestriction("C_ValidCombination_ID",n.Query.prototype.EQUAL,bt.C_ValidCombination_ID),f.setQuery(ct));rt.query(0,0,!1);bi.val(i.Description);kt.val("?")}})}function u(i,r,u){var h,s,e,f;o.log.fine("Field="+i);et=t("<tr>");at.append(et);h=n.VControlFactory.getLabel(i);r.setReadOnly(!1);r.setMandatory(u);i.setPropertyChangeListener(r);s=t("<td>");et.append(s.css("padding","4px 0px 2px 0px"));s.append(h.getControl().addClass("VIS_Pref_Label_Font"));et=t("<tr>");at.append(et);e=t("<td>");r.getBtnCount()>=2?(et.append(e),f=t("<Div style='width: 97%'>"),e.append(f),window.innerHeight>700?(f.append(r.getControl().css("width","90%")),f.append(r.getBtn(0).css("width","10%"))):(f.append(r.getControl().css("width","87%")),f.append(r.getBtn(0).css("width","30px").css("-webkit-appearance","none").css("height","30px").css("padding","0px").css("border-color","#BBBBBB")))):(et.append(e),e.append(r.getControl().css("width","97%")))}function r(n){return n==null||n==0?!0:!1}function ir(){if(wi=f.getValue("C_ValidCombination_ID"),o.onClose)o.onClose(wi);i.dialog("close")}function ct(t){var i=null,u;i=lt!=null?jQuery.extend(!0,{},lt):new n.Query;t&&s!=null&&s.getValue().toString().length>0&&(u=s.getValue().toString().toUpperCase(),u.endsWith("%")||(u+="%"),i.addRestriction("UPPER(Alias)",i.LIKE,u));t&&ft.getValue().toString().length>0&&(u=ft.getValue().toString().toUpperCase(),u.endsWith("%")||(u+="%"),i.addRestriction("UPPER(Combination)",i.LIKE,u));tt==null||r(tt.getValue())||i.addRestriction("AD_Org_ID",i.EQUAL,tt.getValue());c==null||r(c.getValue())||i.addRestriction("Account_ID",i.EQUAL,c.getValue());l==null||r(l.getValue())||i.addRestriction("C_SubAcct_ID",i.EQUAL,l.getValue());h==null||r(h.getValue())||i.addRestriction("M_Product_ID",i.EQUAL,h.getValue());a==null||r(a.getValue())||i.addRestriction("C_BPartner_ID",i.EQUAL,a.getValue());v==null||r(v.getValue())||i.addRestriction("C_Campaign_ID",i.EQUAL,v.getValue());y==null||r(y.getValue())||i.addRestriction("C_LocFrom_ID",i.EQUAL,y.getValue());p==null||r(p.getValue())||i.addRestriction("C_LocTo_ID",i.EQUAL,p.getValue());w==null||r(w.getValue())||i.addRestriction("C_Project_ID",i.EQUAL,w.getValue());b==null||r(b.getValue())||i.addRestriction("C_SalesRegion_ID",i.EQUAL,b.getValue());k==null||r(k.getValue())||i.addRestriction("AD_OrgTrx_ID",i.EQUAL,k.getValue());d==null||r(d.getValue())||i.addRestriction("C_Activity_ID",i.EQUAL,d.getValue());g==null||r(g.getValue())||i.addRestriction("User1_ID",i.EQUAL,g.getValue());nt==null||r(nt.getValue())||i.addRestriction("User2_ID",i.EQUAL,nt.getValue());f.setQuery(i);rt.query(0,0,!1)}function rr(){s!=null&&s.setValue("");ft.setValue("");dt.Content="";dt.Visible=!1;ut.val("");tt.setValue(null);c.setValue(null);l!=null&&l.setValue(null);h!=null&&h.setValue(null);a!=null&&a.setValue(null);v!=null&&v.setValue(null);y!=null&&y.setValue(null);p!=null&&p.setValue(null);w!=null&&w.setValue(null);b!=null&&b.setValue(null);k!=null&&k.setValue(null);d!=null&&d.setValue(null);g!=null&&g.setValue(null);nt!=null&&nt.setValue(null)}function ur(){var e=null,i="SELECT C_ValidCombination_ID, Alias FROM C_ValidCombination WHERE ",u=null,rt,ht,ct,lt,at,vt,yt,pt,bt,kt,dt,vi,yi,pi,wi;for(ot.IsHasAlies&&(u=s.getValue(),u==null&&e!=null&&(e=e.concat(n.Msg.translate(n.Env.getCtx(),"Alias")).concat(", "))),rt=0;rt<ot.Elements.length;rt++){var bi=ot.Elements[rt],ki=ot.Elements[rt].IsMandatory,f=ot.Elements[rt].Type;f.equals(fi)?(u=tt.getValue(),i=i.concat("AD_Org_ID"),i=r(u)?i.concat(" IS NULL AND "):i.concat("=").concat(u).concat(" AND ")):f.equals(gt)?(u=c.getValue(),i=i.concat("Account_ID"),i=r(u)?i.concat(" IS NULL AND "):i.concat("=").concat(u).concat(" AND ")):f.equals(hi)?(u=l.getValue(),i=i.concat("C_SubAcct_ID"),i=r(u)?i.concat(" IS NULL AND "):i.concat("=").concat(u).concat(" AND ")):f.equals(si)?(u=h.getValue(),i=i.concat("M_Product_ID"),i=r(u)?i.concat(" IS NULL AND "):i.concat("=").concat(u).concat(" AND ")):f.equals(ti)?(u=a.getValue(),i=i.concat("C_BPartner_ID"),i=r(u)?i.concat(" IS NULL AND "):i.concat("=").concat(u).concat(" AND ")):f.equals(ui)?(u=v.getValue(),i=i.concat("C_Campaign_ID"),i=r(u)?i.concat(" IS NULL AND "):i.concat("=").concat(u).concat(" AND ")):f.equals(ii)?(u=y.getValue(),i=i.concat("C_LocFrom_ID"),i=r(u)?i.concat(" IS NULL AND "):i.concat("=").concat(u).concat(" AND ")):f.equals(ri)?(u=p.getValue(),i=i.concat("C_LocTo_ID"),i=r(u)?i.concat(" IS NULL AND "):i.concat("=").concat(u).concat(" AND ")):f.equals(oi)?(u=w.getValue(),i=i.concat("C_Project_ID"),i=r(u)?i.concat(" IS NULL AND "):i.concat("=").concat(u).concat(" AND ")):f.equals(ci)?(u=b.getValue(),i=i.concat("C_SalesRegion_ID"),i=r(u)?i.concat(" IS NULL AND "):i.concat("=").concat(u).concat(" AND ")):f.equals(ei)?(u=k.getValue(),i=i.concat("AD_OrgTrx_ID"),i=r(u)?i.concat(" IS NULL AND "):i.concat("=").concat(u).concat(" AND ")):f.equals(ni)?(u=d.getValue(),i=i.concat("C_Activity_ID"),i=r(u)?i.concat(" IS NULL AND "):i.concat("=").concat(u).concat(" AND ")):f.equals(li)?(u=g.getValue(),i=i.concat("User1_ID"),i=r(u)?i.concat(" IS NULL AND "):i.concat("=").concat(u).concat(" AND ")):f.equals(ai)&&(u=nt.getValue(),i=i.concat("User2_ID"),i=r(u)?i.concat(" IS NULL AND "):i.concat("=").concat(u).concat(" AND "));ki&&u==null&&e!=null&&(e=e.concat(bi.getName()).concat(", "))}if(e!=null){n.ADialog.info("FillMandatory",!0,e.ToString().Substring(0,e.Length-2),null);return}if(tt==null||r(tt.getValue())){n.ADialog.info("FillMandatory",!0,n.Msg.getElement(n.Env.getCtx(),"AD_Org_ID"),null);return}if(c==null||r(c.getValue())){n.ADialog.info("FillMandatory",!0,n.Msg.getElement(n.Env.getCtx(),"Account_ID"),null);o.setBusy(!1);return}i=i.concat("AD_Client_ID="+n.Env.getCtx().getAD_Client_ID()+" AND C_AcctSchema_ID="+it);o.log.fine("Check = "+i.toString());var di=s.getValue().toString(),et=0,ft=null,st=s.getValue().toString(),ut=null;try{ut=n.DB.executeReader(i,null);ut.read()&&(et=ut.tables[0].rows[0].cells.c_validcombination_id,ft=ut.tables[0].rows[0].cells.alias);ut.close();ut=null}catch(gi){et=0;ut!=null&&(ut.close(),ut=null)}if(o.log.fine("ID="+et+", Alias="+ft),ft==null&&(ft=""),et!=0&&ot.IsHasAlies&&st.equals(ft)){i="UPDATE C_ValidCombination SET Alias=";i=st.toString().length==0?i.concat("NULL"):i.concat("'").concat(st).concat("'");i=i.concat(" WHERE C_ValidCombination_ID=").concat(et);rt=0;try{rt=n.DB.executeQuery(i)}catch(gi){}}if(et!=0){wt(et,it);return}o.log.config("New");ft=null;s!=null&&(ft=s.getValue().toString());ht=0;l!=null&&l.getValue()!=null&&(ht=l.getValue());ct=0;h==null||r(h.getValue())||(ct=h.getValue());lt=0;a==null||r(a.getValue())||(lt=a.getValue());at=0;k==null||r(k.getValue())||(at=k.getValue());vt=0;y==null||r(y.getValue())||(vt=y.getValue());yt=0;p==null||r(p.getValue())||(yt=p.getValue());pt=0;b==null||r(b.getValue())||(pt=b.getValue());bt=0;w==null||r(w.getValue())||(bt=w.getValue());kt=0;v==null||r(v.getValue())||(kt=v.getValue());dt=0;d==null||r(d.getValue())||(dt=d.getValue());vi=0;g==null||r(g.getValue())||(vi=g.getValue());yi=0;nt==null||r(nt.getValue())||(yi=nt.getValue());pi=tt.getValue();wi=c.getValue();t.ajax({url:n.Application.contextUrl+"AccountForm/Save",dataType:"json",data:{AD_Client_ID:n.Env.getCtx().getAD_Client_ID(),AD_Org_ID:pi,C_AcctSchema_ID:it,AD_Account_ID:wi,C_SubAcct_ID:ht,M_Product_ID:ct,C_BPartner_ID:lt,AD_OrgTrx_ID:at,C_LocFrom_ID:vt,C_LocTo_ID:yt,C_SRegion_ID:pt,C_Project_ID:bt,C_Campaign_ID:kt,C_Activity_ID:dt,User1_ID:vi,User2_ID:yi,Alias:ft},success:function(n){returnValue=n.result;wt(returnValue.C_ValidCombination_ID,returnValue.C_AcctSchema_ID)}})}function wt(t,i){var u="SELECT * FROM C_ValidCombination WHERE C_ValidCombination_ID="+t+" AND C_AcctSchema_ID="+i,r=null;try{r=n.DB.executeReader(u,null);r.read()&&(s!=null&&s.setValue(r.getString("Alias")),ft!=null&&ft.setValue(r.getString("Combination")),tt!=null&&tt.setValue(r.getInt("AD_Org_ID")),c!=null&&c.setValue(r.getInt("Account_ID")),l!=null&&l.setValue(r.getInt("C_SubAcct_ID")),h!=null&&h.setValue(r.getInt("M_Product_ID")),a!=null&&a.setValue(r.getInt("C_BPartner_ID")),v!=null&&v.setValue(r.getInt("C_Campaign_ID")),y!=null&&y.setValue(r.getInt("C_LocFrom_ID")),p!=null&&p.setValue(r.getInt("C_LocTo_ID")),w!=null&&w.setValue(r.getInt("C_Project_ID")),b!=null&&b.setValue(r.getInt("C_SalesRegion_ID")),k!=null&&k.setValue(r.getInt("AD_OrgTrx_ID")),d!=null&&d.setValue(r.getInt("C_Activity_ID")),g!=null&&g.setValue(r.getInt("User1_ID")),nt!=null&&nt.setValue(r.getInt("User2_ID")),ut!=null&&ut.val(r.getString("Description")));r.close();r=null}catch(f){r!=null&&(r.close(),r=null)}ct(!1)}st=i.find("#btnOk_"+e);ht=i.find("#btnCancel_"+e);vt=i.find("#btnRefresh_"+e);yt=i.find("#btnUndo_"+e);pt=i.find("#btnSave_"+e);vi=i.find("#lblParameter_"+e);yi=i.find("#parameterDiv_"+e);gi=i.find("#bottumDiv_"+e);nr=i.find("#discriptionDiv_"+e);pi=i.find("#accDiv_"+e);tr=i.find("#acctbl_"+e);bi=i.find("#lblbottumMsg_"+e);kt=i.find("#lblCount_"+e);ut=i.find("#lblbottumMsg2_"+e);n.Application.isRTL&&(st.css("margin-right","-128px"),ht.css("margin-right","55px"));st.val(n.Msg.getMsg("OK"));ht.val(n.Utility.Util.cleanMnemonic(n.Msg.getMsg("Cancel")));vi.val(n.Msg.getMsg("Parameter"));ki();st.on("click",function(){o.setBusy(!0);ir();o.setBusy(!1)});ht.on("click",function(){i.dialog("close")});vt.on("click",function(){o.setBusy(!0);ct(!0);o.setBusy(!1)});yt.on("click",function(){rr()});pt.on("click",function(){o.setBusy(!0);ur();o.setBusy(!1)})};this.showDialog=function(){var n=t(window).width()-50,i=t(window).height()-60;wt.height(i);wt.width(n);ct.append(wt);ct.dialog({modal:!1,resizable:!1,title:ki,width:n,height:i,position:{at:"center top",of:window},close:function(){o.dispose();ct.dialog("destroy");ct=null;o=null}})};this.dataStatusChanged=function(n){var t=f.getValue("Description");di=f.getValue("COMBINATION");t!=null&&t.length>0?ut.css("display","inline-block"):ut.css("display","none");ut.val(t);kt.val(n.totalRecords)};this.disposeComponent=function(){st&&st.off("click");ht&&ht.off("click");vt&&vt.off("click");yt&&yt.off("click");pt&&pt.off("click");ki=null;bt=null;it=null;e=null;di=null;dt=null;s=null;ft=null;tt=null;c=null;l=null;h=null;a=null;v=null;y=null;p=null;w=null;b=null;k=null;d=null;g=null;nt=null;this.log=null;ir=null;gt=null;ni=null;ti=null;ii=null;ri=null;ui=null;fi=null;ei=null;oi=null;si=null;hi=null;ci=null;li=null;ai=null;rr=null;ur=null;at=null;et=null;st=null;ht=null;vt=null;yt=null;pt=null;vi=null;yi=null;gi=null;nr=null;pi=null;tr=null;rt=null;fr=!1;wi=null;lt=null;f=null;bi=null;kt=null;ut=null;ot=null}}i.prototype.dispose=function(){this.disposeComponent()};n.AccountForm=i}(VIS,jQuery),function(n,t){function i(){function gi(){var a,k;e=t("<input id='chkReportQ_"+i.windowNo+"' type='checkbox' style='margin-left: 0px;' class='VIS_Pref_automatic'><span><label id='lblReportQ_"+i.windowNo+"' class='VIS_Pref_Label_Font'>SelectDoc<\/label><\/span>");wt=new n.Controls.VLabel;v=new n.Controls.VLabel;bt=new n.Controls.VLabel;kt=new n.Controls.VLabel;dt=new n.Controls.VLabel;gt=new n.Controls.VLabel;ni=new n.Controls.VLabel;ti=new n.Controls.VLabel;a=n.MLookupFactory.get(n.Env.getCtx(),i.windowNo,0,n.DisplayType.Search,"C_BPartner_ID",0,!1,null);it=new n.Controls.VTextBoxButton("C_BPartner_ID",!1,!1,!0,n.DisplayType.Search,a);y=new n.Controls.VComboBox("",!1,!1,!0);o=new n.Controls.VComboBox("",!1,!1,!0);rt=new n.Controls.VTextBox("NameQ",!1,!1,!0,50,50,"NameQ");ut=new n.Controls.VTextBox("DescriptionQ",!1,!1,!0,50,50,"DescriptionQ");ft=new n.Controls.VTextBox("CommentQ",!1,!1,!0,50,50,"CommentQ");rt.getControl().val("%%");ut.getControl().val("%%");ft.getControl().val("%%");p=new n.Controls.VComboBox("",!1,!1,!0);ii=t("<input id='dtpCreatedFromQ_"+i.windowNo+"' type='date'  style='display: inline-block;line-height: 23px;width:100%'>");ri=t("<input id='dtpCreatedToQ_"+i.windowNo+"' type='date' style='display: inline-block;line-height: 23px;width:100%'>");ui=new n.Controls.VLabel;fi=new n.Controls.VLabel;ei=new n.Controls.VLabel;oi=new n.Controls.VLabel;si=new n.Controls.VLabel;et=new n.Controls.VTextBox("CreatedBy",!1,!0,!0,50,50,"CreatedBy");d=new n.Controls.VTextBox("Name",!1,!1,!0,50,50,"Name");g=new n.Controls.VTextBox("Description",!1,!1,!0,50,50,"Description");nt=new n.Controls.VTextArea("Comment",!1,!1,!0,200,200);ot=t("<input id='dtpCreatedOn_"+i.windowNo+"' readonly class='vis-gc-vpanel-table-readOnly' type='date' style='display: inline-block;height: 30px;width:100%'>");st=new n.Controls.VLabel;h=t("<input id='btnOk_"+i.windowNo+"' class='VIS_Pref_btn-2' style=' margin-top: 0px; margin-right: 0px;' type='button' value='Ok'>");w=t("<input id='btnSave_"+i.windowNo+"' class='VIS_Pref_btn-2' style='margin-bottom: 0px; margin-top: 0px; margin-right: 10px; margin-left: 10px;float: right;' type='button' value='Save'>");ht=t("<input id='btnNext_"+i.windowNo+"' class='VIS_Pref_btn-2' style='margin: 10px; display: none;'  type='button' value='>>'>");ct=t("<input id='btnPre_"+i.windowNo+"' class='VIS_Pref_btn-2' style='margin: 10px; display: none;' type='button' value='<<'>");w.val(n.Msg.getMsg("Save"));h.val(n.Msg.getMsg("OK"));k=n.Application.contextUrl+"Areas/VIS/Images/base/arrow-left.png";s=t("<div id='topLeftDiv_"+i.windowNo+"' style='float: left; height: 100%; margin-bottom: 2px;margin-left: 0px;position: absolute;'><div id='topToggalDiv_"+i.windowNo+"' style='width: 100%; height: 45px;float: left;padding-left: 11px; padding-top: 11px; background-color: #F1F1F1;'><button id='btnToggal_"+i.windowNo+"' style='border: 0px;background-color: transparent; padding: 0px;' ><img src='"+k+"' /><\/button><\/div><\/div>");this.btnToggal=s.find("#btnToggal_"+i.windowNo);u=t("<div style='float: left; width: 100%;height: 74%;' id='topleftparaDiv_"+i.windowNo+"'>");u.css("height",ki);hi=t("<div style='height: 100%; margin-top: 1px;background-color: #F1F1F1;' id='topleftInnerParaDiv_"+i.windowNo+"'>");u.append(hi);s.append(u);s.css("width",vt);var l=t("<table>"),f=t("<tr>"),r=t("<td style='padding: 4px 12px 2px;'>");hi.append(l);l.append(f);f.append(r);r.append(e);f=t("<tr>");r=t("<td style='padding: 4px 12px 2px;'>");l.append(f);f.append(r);r.append(v.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font")).append(wt.getControl().addClass("VIS-Search-hide").css("display","inline-block").addClass("VIS_Pref_Label_Font"));v.getControl().hide();f=t("<tr>");r=t("<td style='padding: 0px 12px 0px;'>");l.append(f);f.append(r);r.append(o.getControl().css("display","inline-block").css("width","236px").css("height","30px")).append(it.getControl().addClass("VIS-Search-hide").css("width","206px")).append(it.getBtn(0).addClass("VIS-Search-hide").css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB"));o.getControl().hide();f=t("<tr>");r=t("<td style='padding: 4px 12px 2px;'>");l.append(f);f.append(r);r.append(bt.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));f=t("<tr>");r=t("<td style='padding: 0px 12px 0px;'>");l.append(f);f.append(r);r.append(y.getControl().css("display","inline-block").css("width","236px").css("height","30px"));f=t("<tr>");r=t("<td style='padding: 4px 12px 2px;'>");l.append(f);f.append(r);r.append(kt.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));f=t("<tr>");r=t("<td style='padding: 0px 12px 0px;'>");l.append(f);f.append(r);r.append(rt.getControl().css("display","inline-block").css("width","236px").css("height","30px"));f=t("<tr>");r=t("<td style='padding: 4px 12px 2px;'>");l.append(f);f.append(r);r.append(dt.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));f=t("<tr>");r=t("<td style='padding: 0px 12px 0px;'>");l.append(f);f.append(r);r.append(ut.getControl().css("display","inline-block").css("width","236px").css("height","30px"));f=t("<tr>");r=t("<td style='padding: 4px 12px 2px;'>");l.append(f);f.append(r);r.append(gt.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));f=t("<tr>");r=t("<td style='padding: 0px 12px 0px;'>");l.append(f);f.append(r);r.append(ft.getControl().css("display","inline-block").css("width","236px").css("height","30px"));f=t("<tr>");r=t("<td style='padding: 4px 12px 2px;'>");l.append(f);f.append(r);r.append(ni.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));f=t("<tr>");r=t("<td style='padding: 0px 12px 0px;'>");l.append(f);f.append(r);r.append(p.getControl().css("display","inline-block").css("width","236px").css("height","30px"));f=t("<tr>");r=t("<td style='padding: 4px 12px 2px;'>");l.append(f);f.append(r);r.append(ti.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));f=t("<tr>");r=t("<td style='padding: 0px 12px 0px;'>");l.append(f);f.append(r);r.append(ii.css("display","inline-block").css("width","236px").css("height","30px"));f=t("<tr>");r=t("<td style='padding: 4px 12px 2px;'>");l.append(f);f.append(r);r.append(ri.css("display","inline-block").css("width","236px").css("height","30px"));ci=t("<div style='float: left; width: 100%;height:45px;position: relative;background-color: #F1F1F1; padding-left: 13px;padding-right: 13px;' id='leftBottomDiv_"+i.windowNo+"'>");s.append(ci);ci.append(h);c=t("<div id='topRightDiv_"+i.windowNo+"' style='float: right;height: 100%; margin-left: 0px;'>");c.css("width",yi);n.Application.isRTL&&(c.css("float","left"),w.css("float","left"),e.css("margin-left","5px"));lt=t("<div id='rightTopDiv_"+i.windowNo+"' style='float: left; width: 98.5%; height: 55%; margin-right: 10px; margin-left: 5px; margin-top: 5px;'>");at=t("<div id='rightBottomDiv_"+i.windowNo+"' style='float: left; width: 99.5%; margin-right: 0px; margin-left: 0px; margin-top: 5px; '>");lt.css("height",pi);at.css("height",di);l=t("<table style='width: 100%; '>");f=t("<tr>");r=t("<td colspan='4' style='text-align: right; height: 10px;'>");at.append(l);l.append(f);f.append(r);r.append(ct).append(st.getControl().css("display","inline-block").css("margin-top","20px").css("margin-right","10px").css("margin-left","10px").addClass("VIS_Pref_Label_Font")).append(ht);st.getControl().css("display","none");f=t("<tr>");r=t("<td colspan='2' class='VIS-archive-table-padding' >");l.append(f);f.append(r);r.append(ui.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));r=t("<td colspan='2' class='VIS-archive-table-padding'>");f.append(r);r.append(fi.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));f=t("<tr>");r=t("<td colspan='2' class='VIS-archive-table-padding'>");l.append(f);f.append(r);r.append(et.getControl().css("display","inline-block").css("width","100%").addClass("VIS_Pref_Label_Font"));r=t("<td colspan='2' class='VIS-archive-table-padding'>");f.append(r);r.append(ot.css("display","inline-block").css("width","100%").addClass("VIS_Pref_Label_Font"));f=t("<tr>");r=t("<td colspan='2' class='VIS-archive-table-padding' >");l.append(f);f.append(r);r.append(ei.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));r=t("<td colspan='2' class='VIS-archive-table-padding'>");f.append(r);r.append(oi.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));f=t("<tr>");r=t("<td colspan='2' class='VIS-archive-table-padding'>");l.append(f);f.append(r);r.append(d.getControl().css("display","inline-block").css("width","100%").addClass("VIS_Pref_Label_Font"));r=t("<td colspan='2' class='VIS-archive-table-padding'>");f.append(r);r.append(g.getControl().css("display","inline-block").css("width","100%").addClass("VIS_Pref_Label_Font"));f=t("<tr>");r=t("<td colspan='2' class='VIS-archive-table-padding'>");l.append(f);f.append(r);r.append(si.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));f=t("<tr>");r=t("<td colspan='4' class='VIS-archive-table-padding'>");l.append(f);f.append(r);r.append(nt.getControl().css("display","inline-block").css("width","100%").css("height","60px").addClass("VIS_Pref_Label_Font"));li=t("<div style='float: left; width: 100%;height: 40px;position: relative;' id='rightBottomSaveDiv_"+i.windowNo+"'>");li.append(w);c.append(lt).append(at).append(li);tt.append(b);tt.append(s).append(c)}function nr(){e.find("label").text(n.Msg.translate(n.Env.getCtx(),"IsReport"));v.getControl().text(n.Msg.translate(n.Env.getCtx(),"AD_Process_ID"));bt.getControl().text(n.Msg.translate(n.Env.getCtx(),"AD_Table_ID"));wt.getControl().text(n.Msg.translate(n.Env.getCtx(),"C_BPartner_ID"));kt.getControl().text(n.Msg.translate(n.Env.getCtx(),"Name"));dt.getControl().text(n.Msg.translate(n.Env.getCtx(),"Description"));gt.getControl().text(n.Msg.translate(n.Env.getCtx(),"Help"));ni.getControl().text(n.Msg.translate(n.Env.getCtx(),"CreatedBy"));ti.getControl().text(n.Msg.translate(n.Env.getCtx(),"Created"));ui.getControl().text(n.Msg.translate(n.Env.getCtx(),"CreatedBy"));fi.getControl().text(n.Msg.translate(n.Env.getCtx(),"Created"));ei.getControl().text(n.Msg.translate(n.Env.getCtx(),"Name"));oi.getControl().text(n.Msg.translate(n.Env.getCtx(),"Description"));si.getControl().text(n.Msg.translate(n.Env.getCtx(),"Help"));st.getControl().text(n.Msg.translate(n.Env.getCtx(),"NoRecordFound"))}function tr(){for(var s=n.context.getAD_Role_ID(),i=!0,f="SELECT DISTINCT p.AD_Process_ID, p.Name FROM AD_Process p INNER JOIN AD_Process_Access pa ON (p.AD_Process_ID=pa.AD_Process_ID) WHERE pa.AD_Role_ID="+s+" AND p.IsReport='Y' AND p.IsActive='Y' AND pa.IsActive='Y' ORDER BY 2",t=n.DB.executeReader(f.toString(),null),r,u;t.read();)r=n.Utility.Util.getValueOfInt(t.getString(0)),u=t.getString(1),i&&(o.getControl().append(" <option><\/option>"),i=!1),o.getControl().append(" <option value="+r+">"+u+"<\/option>");for(t.close(),i=!0,o.getControl().prop("selectedIndex",0),f="SELECT DISTINCT t.AD_Table_ID, t.Name FROM AD_Table t INNER JOIN AD_Tab tab ON (tab.AD_Table_ID=t.AD_Table_ID) INNER JOIN AD_Window_Access wa ON (tab.AD_Window_ID=wa.AD_Window_ID) WHERE wa.AD_Role_ID="+s+" AND t.IsActive='Y' AND tab.IsActive='Y' ORDER BY 2",t=n.DB.executeReader(f.toString(),null);t.read();)r=n.Utility.Util.getValueOfInt(t.getString(0)),u=t.getString(1),i&&(y.getControl().append(" <option><\/option>"),i=!1),y.getControl().append(" <option value="+r+">"+u+"<\/option>");for(t.close(),i=!0,y.getControl().prop("selectedIndex",0),f="SELECT AD_User_ID, Name FROM AD_User u WHERE EXISTS (SELECT * FROM AD_User_Roles ur WHERE u.AD_User_ID=ur.AD_User_ID) ORDER BY 2",t=n.DB.executeReader(f.toString(),null);t.read();)r=n.Utility.Util.getValueOfInt(t.getString(0)),u=t.getString(1),i&&(p.getControl().append(" <option><\/option>"),i=!1),p.getControl().append(" <option value="+r+">"+u+"<\/option>");t.close();i=!0;p.getControl().prop("selectedIndex",0);l>0&&(e.prop("checked",!0),yt())}function yt(){var t="",v=e.prop("checked"),b=null,u,w,r,s,f,h,c;b=n.MRole.getDefault();try{if(!b.getIsCanReport()){i.log.warning("User/Role cannot Report AD_User_ID="+n.context.getAD_User_ID());return}t=t.concat(" AND IsReport=").concat(v?"'Y'":"'N'");v&&(u=o.getControl().find("option:selected").val(),u!=""&&u!=null&&(t=t.concat(" AND AD_Process_ID=").concat(u)));l>0?(t=t.concat(" AND ((AD_Table_ID=").concat(l),a>0&&(t=t.concat(" AND Record_ID=").concat(a)),t=t.concat(")"),l==X_C_BPartner.Table_ID&&a>0&&(t=t.concat(" OR C_BPartner_ID=").concat(a)),t=t.concat(")"),l=0,a=0):(u=y.getControl().find("option:selected").val(),u!=""&&u!=null&&(t=t.concat(" AND AD_Table_ID=").concat(u)));v||(w=it.getValue(),t=w!=null?t.concat(" AND C_BPartner_ID=").concat(w):t.concat(" AND C_BPartner_ID IS NOT NULL"));r=rt.getControl().val();r!=null&&r!="%%"&&r.length>0&&(t=r.indexOf("%")!=-1||r.indexOf("_")!=-1?t.concat(" AND LOWER(Name) LIKE LOWER( ").concat("'").concat(r).concat("')"):t.concat(" AND LOWER(Name)= LOWER(").concat("'").concat(r).concat("')"));r=ut.getControl().val();r!=null&&r!="%%"&&r.length>0&&(t=r.indexOf("%")!=-1||r.indexOf("_")!=-1?t.concat(" AND LOWER(Description) LIKE LOWER( ").concat("'").concat(r).concat("')"):t.concat(" AND LOWER(Description)= LOWER(").concat("'").concat(r).concat("')"));r=ft.getControl().val();r!=null&&r!="%%"&&r.length>0&&(t=r.indexOf("%")!=-1||r.indexOf("_")!=-1?t.concat(" AND LOWER(Help) LIKE LOWER( ").concat("'").concat(r).concat("')"):t.concat(" AND LOWER(Help)= LOWER(").concat("'").concat(r).concat("')"));s=p.getControl().find("option:selected").val();s!=null&&s>0&&(t=t.concat(" AND CreatedBy=").concat(s));f=ii.val();f!=""&&(t=t.concat(" AND Created>=").concat(n.DB.to_date(f)));f=ri.val();f!=""&&(t=t.concat(" AND Created<").concat(n.DB.to_date(f)));i.log.fine(t.toString());t=t.concat(" AND (AD_Process_ID IS NULL OR AD_Process_ID IN (SELECT AD_Process_ID FROM AD_Process_Access WHERE AD_Role_ID=").concat(n.context.getAD_Role_ID()).concat("))");t=t.concat(" AND (AD_Table_ID IS NULL OR (AD_Table_ID IS NOT NULL AND AD_Process_ID IS NOT NULL) OR AD_Table_ID IN (SELECT t.AD_Table_ID FROM AD_Tab t INNER JOIN AD_Window_Access wa ON (t.AD_Window_ID=wa.AD_Window_ID) WHERE wa.AD_Role_ID=").concat(n.context.getAD_Role_ID()).concat("))");i.log.finest(t.toString())}catch(k){}h=t;c="SELECT AD_ARCHIVE_ID,AD_CLIENT_ID,AD_ORG_ID,AD_PROCESS_ID,AD_TABLE_ID,C_BPARTNER_ID,CREATED,CREATEDBY,DESCRIPTION,HELP, ISACTIVE,ISREPORT,NAME,RECORD_ID,UPDATED,UPDATEDBY,EXPORT_ID FROM AD_Archive WHERE AD_Client_ID="+n.Env.getCtx().getAD_Client_ID();h!=null&&h.length>0&&(c+=h);c+=" ORDER BY Created desc";er(c)}function vi(n,t){return n==null?t==null:t==null?!1:n.equals(t)}function ir(){var u;if(!(r.getSelection().length<0)){var f=d.getControl().val(),e=g.getControl().val(),o=nt.getControl().val(),i=Number(r.getSelection().toString());r.get(i)!=null&&(u=!1,vi(f,r.get(i).NAME)||f!=null&&f.length>0&&(u=!0),vi(e,r.get(i).DESCRIPTION)||(u=!0),vi(o,r.get(i).HELP)||(u=!0),k=r.get(i).AD_ARCHIVE_ID,u&&t.ajax({url:n.Application.contextUrl+"Common/UpdateArchive",dataType:"json",data:{name:f,des:e,help:o,archiveId:k},success:function(n){n.result&&yt()}}))}}function wi(u){r!=null&&(r.destroy(),r=null);f.length==0&&(f.push({field:"NAME",caption:n.Msg.translate(n.Env.getCtx(),"NAME"),sortable:!0,size:"16%",min:150,hidden:!1}),f.push({field:"DESCRIPTION",caption:n.Msg.translate(n.Env.getCtx(),"DESCRIPTION"),sortable:!0,size:"16%",min:150,hidden:!1}),f.push({field:"HELP",caption:n.Msg.getElement(n.Env.getCtx(),"HELP"),sortable:!0,size:"16%",min:150,hidden:!1}),f.push({field:"CREATEDBY",caption:n.Msg.getElement(n.Env.getCtx(),"CREATEDBY"),sortable:!0,size:"16%",min:150,hidden:!1}),f.push({field:"CREATED",caption:n.Msg.getElement(n.Env.getCtx(),"CREATED"),sortable:!0,size:"16%",min:150,hidden:!1,render:"date"}),f.push({field:"View",caption:n.Msg.translate(n.Env.getCtx(),"View"),sortable:!0,size:"80px",min:150,hidden:!1,render:function(){return'<div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/download-ico-hover.png" alt="View record" title="View record" style="opacity: 1;"><\/div>'}}),f.push({field:"AD_ARCHIVE_ID",caption:n.Msg.translate(n.Env.getCtx(),"AD_ARCHIVE_ID"),hidden:!0}));setTimeout(10);w2utils.encodeTags(u);r=t(lt).w2grid({name:"gridArchive"+i.windowNo,recordHeight:40,columns:f,records:u,onClick:function(n){n.column==5&&r.records.length>0&&rr(n.recid);ur(n.recid)}})}function rr(i){k=r.get(i).AD_ARCHIVE_ID;t.ajax({url:n.Application.contextUrl+"Common/DownloadPdf",dataType:"json",data:{archiveId:k},success:function(n){n.result!=null&&window.open("data:application/pdf;base64, "+n.result)}})}function ur(n){d.getControl().val(r.get(n).NAME);g.getControl().val(r.get(n).DESCRIPTION);nt.getControl().val(r.get(n).HELP);et.getControl().val(r.get(n).CREATEDBY);r.get(n).CREATED!=null&&ot.val(r.get(n).CREATED.split("T")[0]);k=r.get(n).AD_ARCHIVE_ID}function fr(t){var r="",u="SELECT Name FROM AD_User WHERE AD_User_ID="+t,i;try{i=n.DB.executeReader(u.toString(),null,null);i.read()&&(r=i.getString("Name"));i.close()}catch(f){}return r}function er(t){var u=[],i,f,r;try{for(i=n.DB.executeReader(t.toString(),null,null),f=1;i.read();)r={},r.NAME=i.getString("NAME"),r.DESCRIPTION=i.getString("DESCRIPTION"),r.HELP=i.getString("HELP"),r.CREATEDBY=fr(i.getString("CREATEDBY")),r.CREATED=i.getString("CREATED"),r.AD_ARCHIVE_ID=i.getInt("AD_ARCHIVE_ID"),r.recid=f,f++,u.push(r);i.close()}catch(e){}return wi(u),u}function or(){d.getControl().val("");g.getControl().val("");nt.getControl().val("");et.getControl().val("");ot.val(null)}function sr(){if(h!=null)h.on(n.Events.onTouchStartOrClick,function(){b[0].style.visibility="visible";yt();or();b[0].style.visibility="hidden"});if(w!=null)w.on(n.Events.onTouchStartOrClick,function(){b[0].style.visibility="visible";ir();b[0].style.visibility="hidden"});if(ht!=null)ht.on(n.Events.onTouchStartOrClick,function(){alert("btnNext")});if(ct!=null)ct.on(n.Events.onTouchStartOrClick,function(){alert("btnPre")});if(this.btnToggal!=null)this.btnToggal.on(n.Events.onTouchStartOrClick,function(){pt?(btnToggal.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),pt=!1,s.animate({width:vt},"slow"),u.animate({width:vt},"slow"),u.find("table").css("display","block"),u.css("background-color","transparent"),h.css("display","block"),c.animate({width:yi},"slow",null,function(){r.resize()})):(btnToggal.animate({borderSpacing:180},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),pt=!0,s.animate({width:ai},"slow"),u.animate({width:ai},"slow"),u.find("table").css("display","none"),u.css("background-color","#F1F1F1"),h.css("display","none"),c.animate({width:bi},"slow",null,function(){r.resize()}))});e.change(function(){o.getControl().hide();v.getControl().hide();t(".VIS-Search-hide").show();e.prop("checked")&&(o.getControl().show(),v.getControl().show(),t(".VIS-Search-hide").hide())})}this.log=n.Logging.VLogger.getVLogger("VIS.ArchiveViewer");this.frame;this.windowNo;var l=0,a=0,i=this,pt=!1,tt=t("<div style='width: 100%; height: 100%; background-color: white;'>"),b=t("<div class='vis-apanel-busy'>"),f=[],r=null,k=0,e=null,wt=null,v=null,bt=null,kt=null,dt=null,gt=null,ni=null,ti=null,it=null,y=null,rt=null,ut=null,ft=null,p=null,o=null,ii=null,ri=null,ui=null,fi=null,ei=null,oi=null,si=null,d=null,g=null,nt=null,et=null,ot=null,st=null,h=null,w=null,ht=null,ct=null;this.btnToggal=null;var s=null,c=null,u=null,hi=null,ci=null,lt=null,at=null,li=null,vt=260,ai=50,yi=t(window).width()-(vt+10),bi=t(window).width()-(10+ai),ki=t(window).height()-193,pi=t(window).height()-366,di=t(window).height()-(pi+40+118);this.display=function(){wi()};this.load=function(){gi();nr();tr();sr()};this.getRoot=function(){return tt};this.disposeComponent=function(){tt=null}}n.Apps=n.Apps||{};n.Apps.AForms=n.Apps.AForms||{};i.prototype.sizeChanged=function(){};i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.load();this.frame.getContentGrid().append(this.getRoot());this.display()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.ArchiveViewer=i}(VIS,jQuery),function(n,t){function i(){function c(){r.onClose&&r.onClose();r.dispose();r=null}var i=t("<div><\/div>"),u="Dialog",f="auto",e="auto",o=!0,s=!1,h=!0,r;this.onOkClick=null;this.onCancelClick=null;this.onClose=null;this.setTitle=function(n){u=n};this.setModal=function(n){o=n};this.changeTitle=function(n){i.dialog("widget").find(".ui-dialog-title").text(n)};this.setHeight=function(n){f=n};this.setWidth=function(n){e=n};this.setEnableResize=function(n){h=n};r=this;this.setContent=function(n){i.empty();n.css("margin-left","-6px");n.css("margin-right","-7px");i.append(n)};this.getRoot=function(){return i};this.hidebuttons=function(){i.dialog("widget").find(".ui-dialog-buttonpane .ui-button").hide();i.dialog("widget").find(".ui-widget-content").css("border","0px");i.dialog("widget").find(".ui-dialog-buttonpane").css("padding","0px");i.dialog("widget").find(".ui-dialog-buttonpane").css("margin-top","0px");i.dialog("widget").find(".ui-dialog .ui-dialog-buttonpane").hide()};this.hideButtons=function(){i.dialog("widget").find(".ui-dialog-buttonpane .ui-button").hide();i.dialog("widget").find(".ui-widget-content").css("border","0px");i.dialog("widget").find(".ui-dialog-buttonpane").css("padding","0px");i.dialog("widget").find(".ui-dialog-buttonpane").css("margin-top","0px");i.dialog("widget").find(".ui-dialog .ui-dialog-buttonpane").hide()};this.close=function(){i.dialog("close");this.dispose()};this.show=function(){var l="margin-right:-2px;margin-top:-10px;margin-bottom:3px;margin-right:-4px",a="margin-top:-10px;margin-bottom:3px;margin-right:12px";return n.Application.isRTL&&(l="margin-right:7px;margin-top:-5px;margin-bottom:3px",a="margin-top:-5px;margin-bottom:3px;margin-right:-3px"),i.dialog({height:f,width:e,title:u,modal:o,resizable:h,closeOnEscape:!s,buttons:[{text:n.Msg.getMsg("Ok"),click:function(n){var f=n.target,u;t(f).attr("disabled",!0);u=!0;r.onOkClick&&(u=r.onOkClick(n));u==!0||u==undefined?i!=null&&i.dialog("close"):t(f).attr("disabled",!1)},style:a},{text:n.Msg.getMsg("Cancel"),click:function(){r.onCancelClick&&r.onCancelClick();i&&i.dialog("close")},style:l}],close:c}),t(".ui-dialog .ui-dialog-buttonpane").css("border-width","0 0 0"),s&&t(".ui-dialog-titlebar-close").remove(),i};this.dispose=function(){i!=null&&(i.dialog("destroy"),i.remove());i=null;this.Show=null;this.setContent=null;this.setTitle=null}}n.ChildDialog=i}(VIS,jQuery),function(n,t){function i(i,r,u,f,e){function a(){}function v(){o.onOkClick=function(i){var r=l.val();if(t.trim(r)==""||r==""||r==null)return n.ADialog.info(n.Msg.getMsg("EnterData")),i!=undefined&&i.preventDefault(),!1;s.prop.ChatText=r;n.dataContext.saveChat(s.prop)};o.onCancelClick=function(){}}function y(i,r,u){n.dataContext.getChatRecords(u,function(t){var r=JSON.parse(t),s="",u,o,e;for(u in r.subChat){var c=new Date(r.subChat[u].ChatDate),h=c.toLocaleString(),f='   <div style="margin-bottom: 15px; border: 1px solid DarkGray; min-height: 50px; border-radius: 4px;overflow-y:auto;margin-right:5px">';if(f+=n.Application.isRTL?'<div style="overflow: auto;height: 48px;width: 48px;display: inline;float: right;margin: 5px;position:relative;line-height:45px;text-align:center;">':'<div style="overflow: auto;height: 48px;width: 48px;display: inline;float: left;margin: 5px;position:relative;line-height:45px;text-align:center;">',o=!1,r.subChat[u].AD_Image_ID==0)f+="<img  data-uID='"+r.subChat[u].AD_User_ID+"'  style=\"cursor:pointer;height: 48px;width: 48px;\" src= '"+n.Application.contextUrl+"Areas/VIS/Images/Home/userAvatar.png'/>",o=!0;else for(e in r.userimages)if(r.userimages[e].AD_Image_ID==r.subChat[u].AD_Image_ID&&r.userimages[e].UserImg!="NoRecordFound"&&r.userimages[e].UserImg!="FileDoesn'tExist"){f+='<img  data-uID="'+r.subChat[u].AD_User_ID+'"  style="cursor:pointer;vertical-align: middle;" src="'+n.Application.contextUrl+r.userimages[e].UserImg+'" />';o=!0;break}o==!1&&(f+="<img   data-uID='"+r.subChat[u].AD_User_ID+"'  style=\"cursor:pointer;height: 48px;width: 48px;\" src= '"+n.Application.contextUrl+"Areas/VIS/Images/Home/userAvatar.png'/>");f+='<\/div><div style="overflow-y;margin-bottom:5px"><div style="overflow:auto">';f+=n.Application.isRTL?'<span data-uID="'+r.subChat[u].AD_User_ID+'"  style="float: right; color: #3892DA;;font-size: 10pt;margin-top:2px;cursor:pointer ">':'<span data-uID="'+r.subChat[u].AD_User_ID+'"  style="float: left; color: #3892DA;;font-size: 10pt;margin-top:2px;cursor:pointer ">';f+=n.Env.getCtx().getAD_User_ID()==r.subChat[u].AD_User_ID?"Me":r.subChat[u].UserName;f+=n.Application.isRTL?'<\/span><span style="display: block; text-align: right;float:left; margin-left: 5px;margin-top:2px;font-size: 10pt;">'+h+'<\/span><\/div><div  style="overflow:auto">':'<\/span><span style="display: block; text-align: right;float:right; margin-right: 5px;margin-top:2px;font-size: 10pt;">'+h+'<\/span><\/div><div  style="overflow:auto">';f+=n.Application.isRTL?'<span style="width:526px;font-size: 10pt;margin-right:5px">'+n.Utility.encodeText(r.subChat[u].ChatData)+"<\/span><\/div>":'<span style="width:526px;font-size: 10pt;">'+n.Utility.encodeText(r.subChat[u].ChatData)+"<\/span><\/div>";f+="<\/div>";f+="            <\/div>  ";s+=f}i.html(s)});i.on("click",function(i){var u,f;(t(i.target).is("span")||t(i.target).is("img"))&&(u=t(i.target).data("uid"),u!=undefined&&u!=null&&u>0&&(f=new n.ContactInfo(u,r),f.show(),o.close()))})}var o,s;this.onClose=null;var h=t("<div><\/div>"),c=t('<div style="overflow-y:auto;height:216px;margin-right:-2px;margin-bottom:15px"><\/div>'),l=t('<textarea  id="input-chat-new" style="Height:70px;width:624px;text-wrap:normal;margin-top:0px;font-size: 10pt;resize: none;margin-bottom:-10px;margin-right:3px"  maxlength="500" />');h.append(c).append(l);this.winNo=e;o=null;this.prop={WindowNo:e,ChatID:r,AD_Table_ID:u,Record_ID:i,Description:f,TrxName:null,ChatText:"",page:0,pageSize:10};y(c,e,this.prop);s=this;a();this.show=function(){o=new n.ChildDialog;o.setContent(h);o.setHeight(428);o.setWidth(655);o.setTitle(n.Msg.getMsg("Chat"));o.setModal(!0);o.onClose=function(){s.onClose&&s.onClose();s.dispose()};o.show();v()};this.dispose=function(){this.prop=null;c=null;h.remove();h=null;o=null;s=null}}n.Chat=i}(VIS,jQuery),function(n,t){function u(){t.ajax({url:n.Application.contextUrl+"InfoMenu/LoadMenu",dataType:"json",error:function(){alert("No DATA")},success:function(n){var r=n.result,u,f;for(u in r)f=t("<li data-id='"+r[u].AD_InfoWindow_ID+"' >"),f.append(r[u].Name),i.append(f)}})}var r=t("<div/>"),i;r.css("width","100%");r.css("height","100%");i=t("<ul class='vis-apanel-rb-ul'>");i.css("width","100%");i.css("height","100%");r.append(i);i.on("click","LI",function(i){var r=t(i.target).data("id"),u=new n.InfoWindow(r,null,0,null,null);u.show()});u();n.InfoMenu={show:function(n){n.w2overlay(r.clone(!0),{css:{height:"300px"}})}}}(VIS,jQuery),function(n,t){function i(i,r,u,f,e){function vt(){var f,i,r,u;c.css("width","100%");c.css("height","100%");c.css("position","relative");a.css("width","98%");a.css("height","97%");a.css("position","absolute");a.css("overflow","auto");n.Application.isRTL?(b=t("<div style='background-color: rgb(241, 241, 241);padding-left: 7px;height:88.9%;display: inline-block;width:23%;height:87.8%;overflow:auto;margin-left:10px;padding-right: 10px;'>"),y=t("<div style='background-color: rgb(241, 241, 241);display: inline-block;height:87.8%;'>"),b.append(y),k=t("<div style='display: inline-block;width:75%;height:87.8%;overflow:auto;'>"),d=t("<div style='display: inline-block;width:99%;height:auto;margin-top: 2px;'>")):(b=t("<div style='background-color: rgb(241, 241, 241);padding-left: 7px;height:88.9%;display: inline-block; float: left;width:23%;height:87.8%;overflow:auto;'>"),y=t("<div style='background-color: rgb(241, 241, 241);'>"),b.append(y),k=t("<div style='display: inline-block; float: left;width:75%;height:87.8%;margin-left:10px;'>"),d=t("<div style='display: inline-block; float: left;width:99%;height:auto;margin-top: 2px;'>"));a.append(b);a.append(k);a.append(d);f=n.Msg.getMsg("Refresh");f.indexOf("&")>-1&&(f=f.replace("&",""));i=n.Msg.getMsg("Cancel");i.indexOf("&")>-1&&(i=i.replace("&",""));r=n.Msg.getMsg("Ok");r.indexOf("&")>-1&&(r=r.replace("&",""));g=t("<div style='float:right;'>");n.Application.isRTL?(p=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(i),w=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(r)):(p=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(i),w=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(r));u=t("<div style='float:left;'>");nt=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png'>"));n.Application.isRTL?(u.append(p),u.append(w),g.append(nt)):(g.append(p),g.append(w),u.append(nt));d.append(g);d.append(u);h=t("<div class='vis-apanel-busy'>");h.css("width","98%");h.css("height","97%");h.css("text-align","center");h.css("position","absolute");c.append(a);c.append(h)}function yt(){w.on("click",function(){dt()});nt.on("click",function(){h[0].style.visibility="visible";f!=null&&f!=undefined&&f.length>0&&(f=n.Env.parseContext(n.Env.getCtx(),u,f,!1,!1));et(!0)});p.on("click",function(){rt()});if(!n.Application.isMobile)c.on("keyup",function(t){t.keyCode===13&&(h[0].style.visibility="visible",f!=null&&f!=undefined&&f.length>0&&(f=n.Env.parseContext(n.Env.getCtx(),u,f,!1,!1)),et(!0))})}function pt(){rt()}var rt;this.onClose=null;var c=t("<div>"),a=t("<div>"),ht=!0,ct,lt,at,b,y,k,d,h,g,p,w,nt,v=null,l=null,o=null,ot=!1,s=[],ut="",ft=this,it=[],tt=null;vt();yt();this.show=function(){t.ajax({url:n.Application.contextUrl+"InfoWindow/GetSearchColumn/?Ad_InfoWindow_ID="+i,dataType:"json",error:function(){alert(n.Msg.getMsg("ERRORGettingSchema"));h[0].style.visibility="hidden"},success:function(t){if(t.result==null||t.result.Schema==null){alert(n.Msg.getMsg("ERRORGettingSchema"));return}if(l=t.result,o=l.Schema,o==null){alert(n.Msg.getMsg("ERRORGettingSchema"));return}wt()}})};var wt=function(){var ut=null,i=null,b=t("<table>"),h,it,rt,p,k,d,v,e,f,g,nt,tt;b.css("width","100%");var a=null,ft=0,w=!1,ct=null,ot=null,ht=null;for(h in o)o[h].IsQueryCriteria&&(w=!1,a=t("<tr>"),b.append(a),it=t("<td class='vis-gc-vpanel-table-td1'>"),o[h].AD_Reference_ID==n.DisplayType.YesNo||o[h].AD_Reference_ID==n.DisplayType.Button||o[h].AD_Reference_ID==n.DisplayType.Label?w=!0:(ut=new n.Controls.VLabel(o[h].Name,o[h].ColumnName),rt=ut.getControl().css("margin-bottom","0px").css("margin-top","5px"),rt.css("font-weight","inherit"),it.append(rt)),a.append(it),a=t("<tr>"),b.append(a),p={},ct=o[h].AD_Reference_ID,i=st(o[h].AD_Reference_ID,o[h].ColumnName,o[h].Name,o[h].AD_Reference_Value_ID,o[h].lookup),p.Ctrl=i,o[h].Condition!=null&&o[h].SetValue!=null&&(subCondition=o[h].Condition.substring(1,o[h].Condition.lastIndexOf("@")),ot=o[h].Condition,ht=n.context.isSOTrx(u)?"@IsSOTrx@='Y'":"@IsSOTrx@='N'",ot.toUpperCase()==ht.toUpperCase()&&(o[h].SetValue.toUpperCase()=="Y"?i.getControl().find("input").prop("checked",!0):i.getControl().find("input").prop("checked",!1))),p.AD_Reference_ID=o[h].AD_Reference_ID,p.ColumnName=o[h].SelectClause,o[h].ISIDENTIFIER&&r!=null&&i.setValue(r),k=t("<td>"),a.append(k),v=i.getBtnCount(),v==2?(e=t("<div>"),w&&e.css("margin-top","5px"),n.Application.isRTL?(e.css("width","97%"),f=i.getBtn(1),f!=null&&e.append(f.css("class","vis-controls-txtbtn-table-td2").css("width","14%").css("padding","0px").css("border-color","#BBBBBB").css("height","30px").css("float","left")),f=i.getBtn(0),f!=null&&e.append(f.css("class","vis-controls-txtbtn-table-td2").css("width","14%").css("padding","0px").css("border-color","#BBBBBB").css("height","30px").css("float","left")),e.append(i.getControl().css("width","72%").css("float","left").css("height","30px")),v=-1,i=null):(e.css("width","97%"),e.append(i.getControl().css("width","72%").css("float","left").css("height","30px")),f=i.getBtn(0),f!=null&&e.append(f.css("class","vis-controls-txtbtn-table-td2").css("width","14%").css("padding","0px").css("border-color","#BBBBBB").css("height","30px")),f=i.getBtn(1),f!=null&&e.append(f.css("class","vis-controls-txtbtn-table-td2").css("width","14%").css("padding","0px").css("border-color","#BBBBBB").css("height","30px")),v=-1,i=null),k.append(e)):v==1?(e=t("<div>"),w&&e.css("margin-top","5px"),n.Application.isRTL?(e.css("width","97%"),f=i.getBtn(0),f!=null&&e.append(f.css("class","vis-controls-txtbtn-table-td2").css("width","14%").css("padding","0px").css("border-color","#BBBBBB").css("height","30px").css("float","left")),e.append(i.getControl().css("width","86%").css("float","left").css("height","30px")),v=-1,i=null):(e.css("width","97%"),e.append(i.getControl().css("width","86%").css("float","left").css("height","30px")),f=i.getBtn(0),f!=null&&e.append(f.css("class","vis-controls-txtbtn-table-td2").css("width","14%").css("padding","0px").css("border-color","#BBBBBB").css("height","30px")),v=-1,i=null),k.append(e)):(w&&i.getControl().css("margin-top","5px"),o[h].AD_Reference_ID==n.DisplayType.YesNo&&i.getControl().css("margin-top","12px").css("height","17px"),k.append(i.getControl().css("width","97%").css("font-weight","inherit").css("height","30px"))),o[h].IsRange?(p.IsRange=!0,a=t("<tr>"),b.append(a),a.append(new n.Controls.VLabel(n.Msg.getMsg("To"),o[h].ColumnName).getControl().css("margin-bottom","0px").css("margin-top","5px").css("font-weight","inherit")),a=t("<tr>"),b.append(a),i=st(o[h].AD_Reference_ID,o[h].ColumnName,o[h].Name),p.CtrlTo=i,d=t("<td>"),v=i.getBtnCount(),v==2?(e=t("<div>"),e.css("width","97%"),w&&i.getControl().css("margin-top","5px"),n.Application.isRTL?(e.css("width","97%"),f=i.getBtn(1),f!=null&&e.append(f.css("class","vis-controls-txtbtn-table-td2").css("width","14%").css("padding","0px").css("border-color","#BBBBBB").css("height","30px").css("float","left")),f=i.getBtn(0),f!=null&&e.append(f.css("class","vis-controls-txtbtn-table-td2").css("width","14%").css("padding","0px").css("border-color","#BBBBBB").css("height","30px").css("float","left")),e.append(i.getControl().css("width","72%").css("float","left").css("height","30px")),v=-1,i=null):(e.css("width","97%"),e.append(i.getControl().css("width","72%").css("float","left").css("height","30px")),f=i.getBtn(0),f!=null&&e.append(f.css("class","vis-controls-txtbtn-table-td2").css("width","14%").css("padding","0px").css("border-color","#BBBBBB").css("height","30px")),f=i.getBtn(1),f!=null&&e.append(f.css("class","vis-controls-txtbtn-table-td2").css("width","14%").css("padding","0px").css("border-color","#BBBBBB").css("height","30px")),v=-1,i=null),d.append(e)):(w&&i.getControl().css("margin-top","5px"),o[h].AD_Reference_ID==n.DisplayType.YesNo?i.getControl().css("margin-top","12px").css("height","17px"):i.getControl().css("height","30px"),d.append(i.getControl().css("width","97%").css("font-weight","inherit"))),a.append(d)):p.IsRange=!1,ft=ft+1,s.push(p));y.append(b);g=n.Msg.getMsg("Refresh");g.indexOf("&")>-1&&(g=g.replace("&",""));nt=n.Msg.getMsg("Cancel");nt.indexOf("&")>-1&&(nt=nt.replace("&",""));tt=n.Msg.getMsg("Ok");tt.indexOf("&")>-1&&(tt=tt.replace("&",""));c.dialog({width:1020,height:487,resizable:!1,title:l.WindowName,modal:!0,close:pt});et(!1)},st=function(t,i,r,f,e){var o=null,y,c,p,l,e,w,a,b,k,d,g,nt,tt,s,v,it,rt,h;return t==n.DisplayType.Button?(y=new n.Controls.VButton(i,!1,!1,!0,r,null,null,0),o=y):t==n.DisplayType.String?(c=new n.Controls.VTextBox(i,!1,!1,!0,50,100,null,null,!1),o=c,c.click=function(){ot=!0}):t==n.DisplayType.YesNo?(p=new n.Controls.VCheckBox(i,!1,!1,!0,r,null),o=p):n.DisplayType.IsDate(t)?(t==n.DisplayType.DateTime&&(readOnly=!0),l=new n.Controls.VDate(i,!1,!1,!0,t,r),l.setName(i),o=l):n.DisplayType.IsLookup(t)||n.DisplayType.ID==t?(e=n.MLookupFactory.get(n.Env.getCtx(),u,0,t,i,f,!1,null),t!=n.DisplayType.Search&&t!=n.DisplayType.MultiKey?(w=new n.Controls.VComboBox(i,!1,!1,!0,e,50),o=w):(t=n.DisplayType.Search,a=new n.Controls.VTextBoxButton(i,!1,!1,!0,t,e),a.getBtn(),o=a)):t==n.DisplayType.Location?(b=new n.Controls.VLocation(i,!1,!1,!0,t,null),o=b):t==n.DisplayType.Locator?(k=new n.Controls.VLocator(i,!1,!1,!0,t,e),o=k):n.DisplayType.Text==t||n.DisplayType.TextLong==t?(d=new n.Controls.VTextArea(i,!1,!1,!0,50,100,t),o=d):n.DisplayType.IsNumeric(t)?n.DisplayType.Amount==t?(g=new n.Controls.VAmountTextBox(i,!1,!1,!0,50,100,t,r),o=g):n.DisplayType.Integer==t?(nt=new n.Controls.VNumTextBox(i,!1,!1,!0,50,100,r),o=nt):n.DisplayType.Number==t&&(tt=new n.Controls.VAmountTextBox(i,!1,!1,!0,50,100,t,r),o=tt):t==n.DisplayType.PAttribute?(s=new n.Controls.VPAttribute(i,!1,!1,!0,t,e,u,!1,!1,!1,!0),s.getBtn(0),o=s):t==n.DisplayType.GAttribute?(s=new n.Controls.VPAttribute(i,!1,!1,!0,t,e,u,!1,!1,!1,!1),s.getBtn(0),o=s):t==n.DisplayType.Account?(v=new n.Controls.VAccount(i,!1,!1,!0,t,e,u,r),v.getBtn(0),o=v):t==n.DisplayType.Binary?(it=new n.Controls.VBinary(i,!1,!1,!0,u),o=it):t==n.DisplayType.Image?(rt=new n.Controls.VImage(i,!1,!1,u),o=rt):t==n.DisplayType.URL?(h=new n.Controls.VURL(i,!1,!1,!0,50,100),o=h):(t==n.DisplayType.FileName||t==n.DisplayType.FilePath)&&(h=new n.Controls.VFile(i,!1,!1,!0,u,t),o=h),o},et=function(i){var w,k,g,r,v,p;kt();var c="SELECT ",y=null,b=null,d=0,tt=t.makeArray(o).length;for(w in o){if(y=o[w].SelectClause,b=String(y).indexOf(".")>-1?String(y).substring(String(y).lastIndexOf(".")+1,String(y).length):y,o[w].IsKey&&(ut=b.toUpperCase()),d=o[w].AD_Reference_ID,d==n.DisplayType.YesNo)c+=" ( CASE "+y+" WHEN 'Y' THEN  'True' ELSE 'False'  END ) AS "+b;else if(d==n.DisplayType.List){k=o[w].RefList;c+=" CASE ";for(g in k)c+=" WHEN "+y+"='"+k[g].Key+"' THEN '"+k[g].Value+"'";c+=" END AS "+b}else c+=y+" ";tt-1==w||(c+=", ")}if(c+=" FROM "+l.FromClause,i==!0){var a=" ",e=null,nt=!1;for(r=0;r<s.length;r++)if(e=s[r].Ctrl.getValue(),e!=null&&e.length!=0&&(e!=0||s[r].AD_Reference_ID==n.DisplayType.YesNo)&&e!=-1){if(nt==!0&&(a+=" AND "),s[r].AD_Reference_ID==n.DisplayType.String||s[r].AD_Reference_ID==n.DisplayType.Text||s[r].AD_Reference_ID==n.DisplayType.TextLong)e=String(e).indexOf("%")==0?String(e).replace("%","●"):"●"+e,String(e).lastIndexOf("●")==String(e).length||(e=e+"●"),a+="  UPPER("+s[r].ColumnName+") LIKE '"+e.toUpperCase()+"' ";else if(s[r].AD_Reference_ID==n.DisplayType.Date){var v=null,p=null,u=new Date(s[r].Ctrl.getValue());v="TO_DATE( '"+(Number(u.getMonth())+1)+"-"+u.getDate()+"-"+u.getFullYear()+"', 'MM-DD-YYYY')";s[r].IsRange?(u=new Date(s[r].CtrlTo.getValue()),p="TO_DATE( '"+(Number(u.getMonth())+1)+"-"+u.getDate()+"-"+u.getFullYear()+"', 'MM-DD-YYYY')",a+=" ( "+s[r].ColumnName+" BETWEEN "+v+" AND "+p+")"):a+=s[r].ColumnName+" ="+v}else if(s[r].AD_Reference_ID==n.DisplayType.DateTime){var v=null,p=null,u=new Date(s[r].Ctrl.getValue());v="TO_DATE( '"+(Number(u.getMonth())+1)+"-"+u.getDate()+"-"+u.getFullYear()+" "+u.getHours()+":"+u.getMinutes()+":"+u.getSeconds()+"', 'MM-DD-YYYY HH24:MI:SS')";s[r].IsRange?(u=new Date(s[r].CtrlTo.getValue()),p="TO_DATE( '"+(Number(u.getMonth())+1)+"-"+u.getDate()+"-"+u.getFullYear()+" "+u.getHours()+":"+u.getMinutes()+":"+u.getSeconds()+"', 'MM-DD-YYYY HH24:MI:SS')",a+=" ( "+s[r].ColumnName+" BETWEEN "+v+" AND "+p+")"):a+=s[r].ColumnName+" ="+v}else s[r].AD_Reference_ID==n.DisplayType.YesNo?(e=s[r].Ctrl.getValue()==!0?"Y":"N",a+=s[r].ColumnName+" = '"+e+"'"):(v=null,p=null,v=s[r].Ctrl.getValue(),s[r].IsRange?(p=s[r].CtrlTo.getValue(),a+=" ( "+s[r].ColumnName+" BETWEEN '"+v+"' AND '"+p+"')"):a+=" "+s[r].ColumnName+" ='"+v+"'");nt=!0}a.length>1?(c+=" WHERE "+a,f!=null&&f.length>0&&(c+=" AND "+f)):f!=null&&f.length>0&&(c+=" WHERE "+f);l.OTHERCLAUSE!=null&&(String(l.OTHERCLAUSE).toUpperCase().indexOf("WHERE")==0&&(a.length>1||f!=null&&f.length>1)?l.OTHERCLAUSE=String(l.OTHERCLAUSE).replace("WHERE","AND"):c.toUpperCase().indexOf("WHERE")==-1&&l.OTHERCLAUSE.toUpperCase().indexOf("AND")>-1,c+=" "+l.OTHERCLAUSE)}else c+=" WHERE rownum=-1";t.ajax({url:n.Application.contextUrl+"InfoWindow/GetData",dataType:"json",type:"POST",data:{sql:c,tableName:l.TableName},error:function(){alert(n.Msg.getMsg("ErrorWhileGettingData"));h[0].style.visibility="hidden";return},success:function(n){bt(JSON.parse(n))}})},bt=function(i){var r,s,c,f;if(i==null){alert(n.Msg.getMsg("NoDataFound"));h[0].style.visibility="hidden";return}var l=[],a=[],u=null;for(f in i)r={resizable:!0},u=o[f].AD_Reference_ID,r.caption=o[f].Name,r.field=i[f].ColumnName.toUpperCase(),r.sortable=!0,r.hidden=!o[f].IsDisplayed,r.size="100px",n.DisplayType.IsNumeric(u)?r.render=u==n.DisplayType.Integer?"int":u==n.DisplayType.Amount?"number:2":"number:1":n.DisplayType.IsDate(u)?r.render=function(n,t,i){var r=n[l[i].field];return r?Globalize.format(new Date(r),"d"):""}:u==n.DisplayType.Location||u==n.DisplayType.Locator?r.render="int":u==n.DisplayType.Account?r.render="int":u==n.DisplayType.PAttribute?r.render="int":u==n.DisplayType.Button?r.render=function(){return"<div>button<\/div>"}:u==n.DisplayType.Image?r.render=function(){return"<div>Image<\/div>"}:n.DisplayType.IsLOB(u)&&(r.render=function(){return"<div>[Lob-blob]<\/div>"}),l[f]=r;for(s=0;s<i[0].RowCount&&s<=30;s++){c={};for(f in i)c[i[f].ColumnName.toUpperCase()]=i[f].Values[s];c.recid=s+1;a[s]=c}tt="gridInfodata"+Math.random();tt=tt.replace(".","");w2utils.encodeTags(a);v=t(k).w2grid({name:tt,recordHeight:40,show:{toolbar:!0,columnHeaders:!0,lineNumbers:!0,selectColumn:!0,toolbarReload:!1,toolbarColumns:!0,toolbarSearch:!1,toolbarAdd:!1,toolbarDelete:!1,toolbarSave:!1,selectionBorder:!1,recordTitles:!1},columns:l,records:a,multiSelect:e});h[0].style.visibility="hidden"},kt=function(){v!=null&&v.destroy();v=null},dt=function(){var n=w2ui[tt].getSelection();for(item in n)it.push(w2ui[tt].get(n[item])[ut]);ft.onClose!=null&&it.length>0&&ft.onClose();rt()};this.getSelectedValues=function(){return it};rt=function(){w.off("click");nt.off("click");p.off("click");c.off("keyup");k=null;y=null;v!=null&&v.destroy();v=null;a=null;ht=null;ct=lt=at=b=y=k=d=null;h=g=p=w=nt=null;v=null;l=null;o=null;ot=null;s=null;ut=null;ft=null;it=null;c!=null&&(c.dialog("destroy"),c.remove());c=null;this.disposeComponent=null;this.displaySchema=null;this.getControl=null;this.displayData=null;this.loadData=null;this.disposeDataSec=null;this.btnOKClick=null;this.getSelectedValues=null;this.disposeComponent=null}}n.InfoWindow=i}(VIS,jQuery),function(n,t){function i(i,r,u,f,e,o,s){function dt(){l.css("width","100%");l.css("height","100%");l.css("position","relative");y.css("width","98%");y.css("height","97%");y.css("position","absolute");n.Application.isRTL?(tt=t("<div style='background-color: rgb(241, 241, 241);height:88.9%;display: inline-block;width:23%;height:87.8%;overflow:auto;padding-right: 10px;margin-left: 10px;'>"),k=t("<div style='background-color: rgb(241, 241, 241);display: inline-block;height:87.8%;'>"),tt.append(k),it=t("<div style='display: inline-block;width:75%;height:87.8%;overflow:auto;'>"),d=t("<div style='display: inline-block;width:99%;height:auto;margin-top: 2px;'>")):(tt=t("<div style='background-color: rgb(241, 241, 241);padding-left: 7px;height:88.9%;display: inline-block; float: left;width:23%;height:87.8%;overflow:auto;'>"),k=t("<div style='background-color: rgb(241, 241, 241);'>"),tt.append(k),it=t("<div style='display: inline-block; float: left;width:75%;height:87.8%;margin-left:10px;'>"),d=t("<div style='display: inline-block; float: left;width:99%;height:auto;margin-top: 2px;'>"));y.append(tt);y.append(it);y.append(d);et=n.Msg.getMsg("Refresh");et.indexOf("&")>-1&&(et=et.replace("&",""));g=n.Msg.getMsg("Cancel");g.indexOf("&")>-1&&(g=g.replace("&",""));nt=n.Msg.getMsg("Ok");nt.indexOf("&")>-1&&(nt=nt.replace("&",""));v=t("<div style='float:right;'>");n.Application.isRTL?(p=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(g),w=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(nt)):(p=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(g),w=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(nt));v.append(p);v.append(w);d.append(v);rt=t("<div style='float:left;'>");ut=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png'>"));n.Application.isRTL?(rt.append(p),rt.append(w),v.append(ut)):(v.append(p),v.append(w),rt.append(ut));d.append(v);d.append(rt);c=t("<div class='vis-apanel-busy'>");c.css("width","98%");c.css("height","97%");c.css("text-align","center");c.css("position","absolute");c[0].style.visibility="visible";l.append(y);l.append(c)}function gt(){if(!n.Application.isMobile)l.on("keyup",function(t){t.keyCode===13&&(c[0].style.visibility="visible",s!=null&&s.length>0&&(s=n.Env.parseContext(n.Env.getCtx(),r,s,!1,!1)),at(!0))});p.on("click",function(){ht()});w.on("click",function(){vt()});ut.on("click",function(){c[0].style.visibility="visible";s!=null&&s!=undefined&&s.length>0&&(s=n.Env.parseContext(n.Env.getCtx(),r,s,!1,!1));at(!0)})}function ni(){ht()}var vt,ht;this.onClose=null;var l=t("<div>"),yt=!0,y=t("<div>"),pt=null,wt=null,bt=null,tt=null,k=null,it=null,d=null,et=null,g=null,nt=null,v=null,p=null,w=null,rt=null,ut=null,c=null,a=null,ot=[],h=null,b=null,ct=this,lt="",st=[],kt=null,ft=null;dt();gt();vt=function(){var n=w2ui[ft].getSelection();for(item in n)st.push(w2ui[ft].get(n[item])[lt]);ct.onClose!=null&&st.length>0&&ct.onClose();ht()};this.show=function(){t.ajax({url:n.Application.contextUrl+"InfoGeneral/GetSearchColumns/?tableName="+f,dataType:"json",error:function(){alert(n.Msg.getMsg("ERRORGettingSearchCols"));c[0].style.visibility="hidden"},success:function(t){if(a=t.result,a==null){alert(n.Msg.getMsg("ERRORGettingSearchCols"));c[0].style.visibility="hidden";return}ti()}})};var ti=function(){var i,r,p,f,w,s,v,y;if(h=n.dataContext.getJSONData(n.Application.contextUrl+"InfoGeneral/GetDispalyColumns",{AD_Table_ID:a[0].AD_Table_ID}).result,h==null){alert(n.Msg.getMsg("ERRORGettingDisplayCols"));c[0].style.visibility="hidden";return}var b=null,e=null,o=t("<table>");o.css("width","100%");i=null;for(r in a)i=t("<tr>"),o.append(i),p=t("<td>"),b=new n.Controls.VLabel(a[r].Name,a[r].ColumnName),p.append(b.getControl().css("margin-bottom","0px").css("margin-top","5px").css("font-weight","inherit")),i.append(p),i=t("<tr>"),o.append(i),f={},e=new n.Controls.VTextBox(a[r].ColumnName,!1,!1,!0,50,100,null,null,!1),f.Ctrl=e,f.AD_Reference_ID=10,f.ColumnName=a[r].ColumnName,a[r].IsIdentifier&&e.setValue(u),w=t("<td>"),i.append(w),w.append(e.getControl().css("width","97%").css("font-weight","inherit")),ot.push(f);k.append(o);s=n.Msg.getMsg("Refresh");s.indexOf("&")>-1&&(s=s.replace("&",""));v=n.Msg.getMsg("Cancel");v.indexOf("&")>-1&&(v=v.replace("&",""));y=n.Msg.getMsg("Ok");y.indexOf("&")>-1&&(y=y.replace("&",""));l.dialog({width:1020,height:500,resizable:!1,modal:!0,close:ni});at(!1)},at=function(i){var e,l,y,o;ri();var u="SELECT ",v=0,w=t.makeArray(h).length;for(e in h){if(v=h[e].AD_Reference_ID,v==n.DisplayType.YesNo)u+=" ( CASE "+h[e].ColumnName+" WHEN 'Y' THEN  'True' ELSE 'False'  END ) AS "+h[e].ColumnName;else if(v==n.DisplayType.List){l=h[e].RefList;u+=" CASE ";for(y in l)u+=" WHEN "+h[e].ColumnName+"='"+l[y].Key+"' THEN '"+l[y].Value.replace("'","''")+"'";u+=" END AS "+h[e].ColumnName}else u+=h[e].ColumnName+" ";h[e].IsKey&&(lt=h[e].ColumnName.toUpperCase());w-1==e||(u+=", ")}if(u+=" FROM "+f,i==!0){var a=" ",r=null,p=!1;for(o=0;o<ot.length;o++)(r=ot[o].Ctrl.getValue(),r!=null&&r.length!=0&&r!=0)&&(p==!0&&(a+=" AND "),r=String(r).indexOf("%")==0?String(r).replace("%","●"):"●"+r,String(r).lastIndexOf("●")==String(r).length||(r=r+"●"),a+="  UPPER("+ot[o].ColumnName+") LIKE '"+r.toUpperCase()+"' ",p=!0);a.length>1?(u+=" WHERE "+a,s!=null&&s.length>0&&(u+=" AND "+s)):s!=null&&s.length>0&&(u+=" WHERE "+s)}else u+=s.length>0&&s.trim().toUpperCase().startsWith("WHERE")?" "+s+" AND "+f+"_ID=-1":s.length>0?" WHERE "+f+"_ID=-1 AND "+s:" WHERE "+f+"_ID=-1";t.ajax({url:n.Application.contextUrl+"InfoGeneral/GetData",dataType:"json",type:"POST",data:{sql:u,tableName:f},error:function(){alert(n.Msg.getMsg("ErrorWhileGettingData"));c[0].style.visibility="hidden";return},success:function(n){ii(JSON.parse(n))}})},ii=function(i){var r,e,s,f;if(i==null){alert(n.Msg.getMsg("NoDataFound"));c[0].style.visibility="hidden";return}var l=[],a=[],u=null;for(f in i)r={resizable:!0},u=h[f].AD_Reference_ID,r.caption=h[f].Name,r.field=h[f].ColumnName.toUpperCase(),r.sortable=!0,r.hidden=!h[f].IsDisplayed,r.size="100px",n.DisplayType.IsNumeric(u)?r.render=u==n.DisplayType.Integer?"int":u==n.DisplayType.Amount?"number:2":"number:1":n.DisplayType.IsDate(u)?r.render=function(n,t,i){var r=n[l[i].field];return r?Globalize.format(new Date(r),"d"):""}:u==n.DisplayType.Location||u==n.DisplayType.Locator?r.render="int":u==n.DisplayType.Account?r.render="int":u==n.DisplayType.PAttribute?r.render="int":u==n.DisplayType.Button?r.render=function(){return"<div>button<\/div>"}:u==n.DisplayType.Image?r.render=function(){return"<div>Image<\/div>"}:n.DisplayType.IsLOB(u)&&(r.render=function(){return"<div>[Lob-blob]<\/div>"}),l[f]=r;for(e=0;e<i[0].RowCount&&e<=30;e++){s={};for(f in i)s[i[f].ColumnName.toUpperCase()]=i[f].Values[e];s.recid=e+1;a[e]=s}ft="gridGenInfodata"+Math.random();ft=ft.replace(".","");w2utils.encodeTags(a);b=t(it).w2grid({name:ft,recordHeight:40,show:{toolbar:!0,columnHeaders:!0,lineNumbers:!0,selectColumn:!0,toolbarReload:!1,toolbarColumns:!0,toolbarSearch:!1,toolbarAdd:!1,toolbarDelete:!1,toolbarSave:!1,selectionBorder:!1,recordTitles:!1},columns:l,records:a,multiSelect:o});c[0].style.visibility="hidden"},ri=function(){b!=null&&b.destroy();b=null};this.getSelectedValues=function(){return st};ht=function(){l.off("keyup");p.off("click");w.off("click");ut.off("click");it=null;k=null;b!=null&&b.destroy();b=null;yt=null;y=null;pt=null;wt=null;bt=null;tt=null;k=null;it=null;d=null;et=null;g=null;nt=null;v=null;p=null;w=null;rt=null;ut=null;c=null;a=null;ot=null;h=null;b=null;ct=null;lt=null;st=null;kt=null;l!=null&&(l.dialog("destroy"),l.remove());l=null;this.btnOKClick=null;this.displaySearchCol=null;this.displayData=null;this.loadData=null;this.disposeComponent=null;this.disposeDataSec=null;this.getSelectedValues=null}}n.infoGeneral=i}(VIS,jQuery),function(n,t){function i(i,r,u,f,e,o,s,h,c){function yr(){var r,i,u;it.css("width","100%");it.css("height","100%");it.css("position","relative");ft.css("width","98%");ft.css("height","97%");ft.css("position","absolute");nt.css("width","100%");n.Application.isRTL?(et=t("<div style='background-color: rgb(241, 241, 241);display: inline-block; float:right;width:23%;height:87.8%;overflow:auto;padding-right: 7px;margin-left: 10px;'>"),lt=t("<div style='background-color: rgb(241, 241, 241);'>"),et.append(lt),at=t("<div style='display: inline-block;width:75%;height:87.8%;overflow:auto;'>"),dt=t("<div style='display: inline-block;float: right;width:99%;height:auto;margin-top: 2px;'>")):(et=t("<div style='background-color: rgb(241, 241, 241);display: inline-block; float: left;width:23%;height:87.8%;overflow:auto;padding-left: 7px;'>"),lt=t("<div style='background-color: rgb(241, 241, 241);'>"),et.append(lt),at=t("<div style='display: inline-block; float: left;width:75%;height:87.8%;margin-left:10px;'>"),dt=t("<div style='display: inline-block; float: left;width:99%;height:auto;margin-top: 2px;'>"));ft.append(et);ft.append(at);ft.append(dt);ei=n.Msg.getMsg("Value");ei.indexOf("&")>-1&&(ei=ei.replace("&",""));oi=n.Msg.getMsg("Name");oi.indexOf("&")>-1&&(oi=oi.replace("&",""));si=n.Msg.getMsg("UPC");si.indexOf("&")>-1&&(si=si.replace("&",""));hi=n.Msg.getMsg("SKU");hi.indexOf("&")>-1&&(hi=hi.replace("&",""));ci=n.Msg.getMsg("Warehouse");ci.indexOf("&")>-1&&(ci=ci.replace("&",""));li=n.Msg.getMsg("PriceListVersion");li.indexOf("&")>-1&&(li=li.replace("&",""));fi=n.Msg.getMsg("Refresh");fi.indexOf("&")>-1&&(fi=fi.replace("&",""));vi=n.Msg.getMsg("AddCatalog");vi.indexOf("&")>-1&&(vi=vi.replace("&",""));yi=n.Msg.getMsg("ShowSaved");yi.indexOf("&")>-1&&(yi=yi.replace("&",""));wi=n.Msg.getMsg("ShowCart");wi.indexOf("&")>-1&&(wi=wi.replace("&",""));pi=n.Msg.getMsg("ShowScan");pi.indexOf("&")>-1&&(pi=pi.replace("&",""));vt=n.Msg.getMsg("Cancel");vt.indexOf("&")>-1&&(vt=vt.replace("&",""));yt=n.Msg.getMsg("Ok");yt.indexOf("&")>-1&&(yt=yt.replace("&",""));l=t("<tr>");nt.append(l);r=t("<td>");rt=t("<label class='VIS_Pref_Label_Font' style='margin-bottom: 0px;margin-top:5px;font-weight:inherit'>").append(ei);r.append(rt);l.append(r);l=t("<tr>");nt.append(l);i={};tt=new n.Controls.VTextBox("Value",!1,!1,!0,50,100,null,null,!1);i.Ctrl=tt;i.AD_Reference_ID=10;i.ColumnName="Value";u=t("<td>");l.append(u);u.append(tt.getControl().css("width","97%").css("font-weight","inherit"));w.push(i);l=t("<tr>");nt.append(l);r=t("<td>");rt=t("<label class='VIS_Pref_Label_Font' style='margin-bottom: 0px;margin-top:5px;font-weight:inherit'>").append(oi);r.append(rt);l.append(r);l=t("<tr>");nt.append(l);i={};tt=new n.Controls.VTextBox("Name",!1,!1,!0,50,100,null,null,!1);i.Ctrl=tt;i.AD_Reference_ID=10;i.ColumnName="Name";tt.setValue(e);u=t("<td>");l.append(u);u.append(tt.getControl().css("width","97%").css("font-weight","inherit"));w.push(i);l=t("<tr>");nt.append(l);r=t("<td>");rt=t("<label class='VIS_Pref_Label_Font' style='margin-bottom: 0px;margin-top:5px;font-weight:inherit'>").append(si);r.append(rt);l.append(r);l=t("<tr>");nt.append(l);i={};tt=new n.Controls.VTextBox("UPC",!1,!1,!0,50,100,null,null,!1);i.Ctrl=tt;i.AD_Reference_ID=10;i.ColumnName="UPC";u=t("<td>");l.append(u);u.append(tt.getControl().css("width","97%").css("font-weight","inherit"));w.push(i);l=t("<tr>");nt.append(l);r=t("<td>");rt=t("<label class='VIS_Pref_Label_Font' style='margin-bottom: 0px;margin-top:5px;font-weight:inherit'>").append(hi);r.append(rt);l.append(r);l=t("<tr>");nt.append(l);i={};tt=new n.Controls.VTextBox("SKU",!1,!1,!0,50,100,null,null,!1);i.Ctrl=tt;i.AD_Reference_ID=10;i.ColumnName="SKU";u=t("<td>");l.append(u);u.append(tt.getControl().css("width","97%").css("font-weight","inherit"));w.push(i);l=t("<tr>");nt.append(l);r=t("<td>");rt=t("<label class='VIS_Pref_Label_Font' style='margin-bottom: 0px;margin-top:5px;font-weight:inherit'>").append(ci);r.append(rt);l.append(r);l=t("<tr>");nt.append(l);i={};ti=new n.Controls.VComboBox("M_Warehouse_ID",!1,!1,!0,null,50);i.Ctrl=ti;i.AD_Reference_ID=n.DisplayType.tableDir;i.ColumnName="M_Warehouse_ID";u=t("<td>");l.append(u);u.append(ti.getControl().css("width","97%").css("font-weight","inherit"));w.push(i);l=t("<tr>");nt.append(l);r=t("<td>");rt=t("<label class='VIS_Pref_Label_Font' style='margin-bottom: 0px;margin-top:5px;font-weight:inherit'>").append(li);r.append(rt);l.append(r);l=t("<tr>");nt.append(l);i={};ii=new n.Controls.VComboBox("M_PriceList_Version_ID",!1,!1,!0,null,50);i.Ctrl=ii;i.AD_Reference_ID=n.DisplayType.tableDir;i.ColumnName="M_PriceList_Version_ID";u=t("<td>");l.append(u);u.append(ii.getControl().css("width","97%").css("font-weight","inherit"));w.push(i);lt.append(nt);ot=t("<div style='float:right;'>");n.Application.isRTL?(st=t("<div style='float:left;'>"),wt=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(vt),bt=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(yt),ht=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/addToCart.png'>")),ut=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/list.png'>")),gt=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-left:5px'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/scan.png'>")),pt=t("<button class='VIS_Pref_btn-2'style='margin-top: 5px;margin-bottom: -10px;margin-left:5px'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/opencart.png'>"))):(st=t("<div style='float:right;'>"),wt=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(vt),bt=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(yt),ht=t("<button class='VIS_Pref_btn-2' style='margin-right:5px;margin-top: 5px;margin-bottom: -10px'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/addToCart.png'>")),ut=t("<button class='VIS_Pref_btn-2' disabled style='margin-right:5px;margin-top: 5px;margin-bottom: -10px'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/list.png'>")),gt=t("<button class='VIS_Pref_btn-2' style='margin-right:5px;margin-top: 5px;margin-bottom: -10px'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/scan.png'>")),pt=t("<button class='VIS_Pref_btn-2' style='margin-right:5px;margin-top: 5px;margin-bottom: -10px'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/opencart.png'>")));ct=t("<div style='float:left;'>");ni=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png'>"));n.Application.isRTL?(ct.append(wt),ct.append(bt),ct.append(ut),ct.append(ht),st.append(gt),st.append(pt),et.append(st),ot.append(ni)):(ot.append(wt),ot.append(bt),ot.append(ut),ot.append(ht),st.append(gt),st.append(pt),et.append(st),ct.append(ni));dt.append(ot);dt.append(ct);b=t("<div class='vis-apanel-busy'>");b.css("width","98%");b.css("height","97%");b.css("text-align","center");b.css("position","absolute");b[0].style.visibility="visible";it.append(ft);it.append(b)}function pr(){if(!n.Application.isMobile)it.on("keyup",function(t){t.keyCode===13&&(b[0].style.visibility="visible",c!=null&&c.length>0&&(c=n.Env.parseContext(n.Env.getCtx(),r,c,!1,!1)),bi(!0))});gt.on("click",function(){nu()});pt.on("click",function(){gr()});ht.on("click",function(){tu()});ut.on("click",function(){iu()});wt.on("click",function(){tr()});bt.on("click",function(){or()});ni.on("click",function(){h&&!ai&&ht.show();v.length==0&&ut.prop("disabled",!0);y=[];b[0].style.visibility="visible";c!=null&&c!=undefined&&c.length>0&&(c=n.Env.parseContext(n.Env.getCtx(),r,c,!1,!1));bi(!0)})}function wr(i,u){var f="SELECT AD_Window_ID FROM AD_Tab WHERE AD_Tab_ID = "+n.Utility.Util.getValueOfInt(n.context.getWindowTabContext(r,0,"AD_Tab_ID"));g=n.Utility.Util.getValueOfInt(n.DB.executeScalar(f));ti.ctrl.append(t('<Option value="0"><\/option>'));ii.ctrl.append(t('<Option value="0"><\/option>'));ir=jQuery.parseJSON(ir);rr=jQuery.parseJSON(rr);br();gi=dr(n.Env.getCtx(),r,u);kr(u)}function br(){for(var f=n.MRole.getDefault().addAccessSQL("SELECT M_Warehouse_ID, Value || ' - ' || Name AS ValueName FROM M_Warehouse WHERE IsActive='Y'","M_Warehouse",n.MRole.SQL_NOTQUALIFIED,n.MRole.SQL_RO)+" ORDER BY Value",t=n.DB.executeReader(f.toString(),null),i,r;t.read();)i=n.Utility.Util.getValueOfInt(t.getString(0)),r=t.getString(1),ti.getControl().append(" <option value="+i+">"+r+"<\/option>"),i==u&&ti.ctrl.val(u);t.close()}function kr(t){var u="SELECT plv.M_PriceList_Version_ID, plv.Name || ' (' || c.ISO_Code || ')' AS ValueName FROM M_PriceList_Version plv, M_PriceList pl, C_Currency c WHERE plv.M_PriceList_ID=pl.M_PriceList_ID AND pl.C_Currency_ID=c.C_Currency_ID AND plv.IsActive='Y' AND pl.IsActive='Y'",f,i,r,e;for(t!=0&&(u+=" AND EXISTS (SELECT * FROM M_PriceList xp WHERE xp.M_PriceList_ID="+t+")"),f=n.MRole.getDefault().addAccessSQL(u,"M_PriceList_Version",n.MRole.SQL_FULLYQUALIFIED,n.MRole.SQL_RO)+" ORDER BY plv.Name",i=n.DB.executeReader(f.toString(),null);i.read();)r=n.Utility.Util.getValueOfInt(i.getString(0)),e=i.getString(1),ii.getControl().append(" <option value="+r+">"+e+"<\/option>"),r==gi&&ii.ctrl.val(gi);i.close()}function dr(t,i,u){var e=null,o=t.getContext(i,"DateOrdered"),h,l;o!=null&&o.Length>0?e=System.Convert.ToDateTime(n.Env.parseContext(n.Env.getCtx(),r,"DateOrdered",!1,!1)):(o=t.getContext(i,"DateInvoiced"),o!=null&&o.Length>0&&(e=System.Convert.ToDateTime(n.Env.parseContext(n.Env.getCtx(),r,"DateInvoiced",!1,!1))));e==null&&(h=new Date,e=n.Utility.Util.getValueOfDate(h));var s=0,c="SELECT plv.M_PriceList_Version_ID, plv.ValidFrom FROM M_PriceList pl, M_PriceList_Version plv WHERE pl.M_PriceList_ID=plv.M_PriceList_ID AND plv.IsActive='Y' AND pl.M_PriceList_ID="+u+" ORDER BY plv.ValidFrom DESC",f=null;try{f=n.DB.executeReader(c,null);f.read()&&(l=f.getDateTime(1),s=e>l?f.getInt(0):f.getInt(0));f.close();f=null}catch(a){f!=null&&f.close();this.log.Log(Level.SEVERE,c,a)}return t.setContext(i,"M_PriceList_Version_ID",s),s}function gr(){kt=!1;ri=0;var t=new n.InfoScanForm(r,!0);t.showDialog();t.onClose=function(t,i,u){var l;for(kt=i,ri=u;t.read();){var o="",s="",f=0,h="",e=t.getDecimal("vaicnt_quantity"),y=t.getInt("M_Product_ID"),p=t.getString("value"),c=t.getString("M_AttributeSetInstance_ID");o=t.getString("name");s=t.getString("uom");e>0&&v.push({_prodQty:e,_prdID:t.getInt("M_Product_ID"),_value:t.getString("value"),_uom:t.getInt("C_UOM_ID"),_AD_Session_ID:n.Env.getCtx().getContext("#AD_Session_ID"),_windowNo:r,_RefNo:"",_Attribute:t.getString("M_AttributeSetInstance_ID"),_AttributeName:"",_Locator_ID:"",_IsLotSerial:"N"});c!=""&&(f=n.Utility.Util.getValueOfInt(c),l="SELECT Description FROM M_AttributeSetInstance WHERE M_AttributeSetInstance_ID = "+f,h=n.Utility.Util.getValueOfString(n.DB.executeScalar(l)));a.push({SrNo:a.length,Product:o,Value:p,QtyEntered:e,UOM:s,M_Product_ID1:y,Attribute:f,AttributeName:h,RefNo:""})}ui()}}function ui(){var e,i,u,f;for(k=null,e=[],i=0;i<a.length;i++)u={},u.Product=a[i].Product,u.Value=a[i].Value,u.QtyEntered=a[i].QtyEntered,u.UOM=a[i].UOM,u.Attribute=a[i].AttributeName,u.recid=i+1,e[i]=u;for(p="gridsavedprd"+Math.random(),p=p.replace(".",""),w2utils.encodeTags(e),k=t(at).w2grid({name:p,recordHeight:40,show:{toolbar:!0,columnHeaders:!0,lineNumbers:!0,selectColumn:!0,toolbarReload:!1,toolbarColumns:!0,toolbarSearch:!1,toolbarAdd:!1,toolbarDelete:!1,toolbarSave:!1,selectionBorder:!1,recordTitles:!1},columns:[{field:"Value",caption:'<div style="text-align: center;" ><span>'+n.Msg.translate(n.Env.getCtx(),"Value")+"<\/span><\/div>",sortable:!1,size:"150px",min:150,hidden:!1},{field:"Product",caption:'<div style="text-align: center;" ><span>'+n.Msg.translate(n.Env.getCtx(),"Product")+"<\/span><\/div>",sortable:!1,size:"20%",min:150,hidden:!1},{field:"QtyEntered",caption:'<div style="text-align: center;" ><span>'+n.Msg.translate(n.Env.getCtx(),"QtyEntered")+"<\/span><\/div>",sortable:!1,size:"80px",min:80,hidden:!1,editable:{type:"float"},render:"number:1"},{field:"UOM",caption:'<div style="text-align: center;" ><span>'+n.Msg.translate(n.Env.getCtx(),"UOM")+"<\/span><\/div>",sortable:!1,size:"80px",min:80,hidden:!1},{field:"Attribute",caption:'<div style="text-align: center;" ><span>'+n.Msg.translate(n.Env.getCtx(),"Attribute")+"<\/span><\/div>",sortable:!1,size:"20%",min:150,hidden:!1,render:function(){return'<div><input type=text readonly="readonly" style= "width:85%; border:none" ><\/input><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/MultiX16.png" alt="Attribute Set Instance" title="Attribute Set Instance" style="opacity:1;float:right;"><\/div>'}},{field:"Delete",caption:'<div style="text-align: center;" ><span>'+n.Msg.translate(n.Env.getCtx(),"Delete")+"<\/span><\/div>",sortable:!1,size:"40px",min:80,hidden:!1,render:function(){return'<div style="text-align: center;"><img src="'+n.Application.contextUrl+'Areas/VIS/Images/delete-ico-hover.png" alt="Delete record" title="Delete record" style="opacity: 1;"><\/div>'}},{field:"Insert",caption:'<div style="text-align: center;" ><span>'+n.Msg.translate(n.Env.getCtx(),"Insert")+"<\/span><\/div>",sortable:!1,size:"40px",min:80,hidden:!1,render:function(){return'<div style="text-align: center;"><img src="'+n.Application.contextUrl+'Areas/VIS/Images/add-edit.png" alt="Insert record" title="Insert record" style="opacity: 1;"><\/div>'}}],records:e,onChange:function(n){w2ui[p].records[n.index].QtyEntered=n.value_new;v[n.index]._prodQty=n.value_new;a[n.index].QtyEntered=n.value_new},onClick:function(t){if(t.column==5&&k.records.length>0)v.splice(t.recid-1,1),a.splice(t.recid-1,1),ui();else if(t.column==6&&k.records.length>0)a.push({SrNo:a.length,Product:a[t.recid-1].Product,Value:a[t.recid-1].Value,QtyEntered:a[t.recid-1].QtyEntered,UOM:a[t.recid-1].UOM,M_Product_ID1:a[t.recid-1].M_Product_ID1,Attribute:"",AttributeName:"",RefNo:a[t.recid-1].RefNo}),v[v.length]={_prodQty:a[a.length-1].QtyEntered,_prdID:a[a.length-1].M_Product_ID1,_value:a[a.length-1].Value,_uom:a[a.length-1].UOM,_AD_Session_ID:n.Env.getCtx().getContext("#AD_Session_ID"),_windowNo:r,_RefNo:"",_Attribute:"",_AttributeName:"",_Locator_ID:"",_IsLotSerial:"N"},ui();else if(t.column==4&&k.records.length>0){var u=ur==8418,f=n.context.getContextAsInt(r,"M_Locator_ID"),e=n.context.getContextAsInt(r,"C_BPartner_ID"),i=new n.PAttributesForm(n.Utility.Util.getValueOfInt(a[t.recid-1].Attribute),n.Utility.Util.getValueOfInt(a[t.recid-1].M_Product_ID1),f,e,u,ur,r);i.hasAttribute&&i.showDialog();i.onClose=function(n,i,r){this.M_Locator_ID=r;a[t.recid-1].AttributeName=i;a[t.recid-1].Attribute=n;v[t.recid-1]._Attribute=n;v[t.recid-1]._AttributeName=i;ui()}}}}),f=0;f<k.records.length;f++)t("#grid_"+p+"_rec_"+k.records[f].recid).find("input[type=text]").val(a[f].AttributeName);b[0].style.visibility="hidden"}function ru(i){var ht="",w="",ct="",lt="",ut=0,b=0,k=0,ft=0,nt=0,y,f,c,s;ut=n.Utility.Util.getValueOfInt(n.context.getWindowTabContext(r,1,"M_Locator_ID"));ht=n.context.getContextAsInt(r,n.context.getWindowTabContext(r,0,"KeyColumnName"));w=n.context.getWindowTabContext(r,0,"KeyColumnName");ct=n.context.getContextAsInt(r,n.context.getWindowTabContext(r,1,"KeyColumnName"));lt=n.context.getWindowTabContext(r,1,"KeyColumnName");(g==170||w=="SAP001_StockTransfer_ID")&&(b=n.Utility.Util.getValueOfInt(n.context.getWindowTabContext(r,1,"M_LocatorTo_ID")));ft=n.Utility.Util.getValueOfInt(ht);nt=n.Utility.Util.getValueOfInt(ct);var h=[],et=[],ot=[],tt=[],st=[],l=[],e=[],d=[],a=[],it=[],at=[];for(y in i)if(h.push(v[y]._prdID.toString()),et.push(v[y]._prodQty.toString()),l.push(v[y]._RefNo.toString()),tt.push(v[y]._Attribute.toString()),st.push(v[y]._uom.toString()),v[y]._Locator_ID>0?it.push(v[y]._Locator_ID.toString()):it.push(ut.toString()),nt!=0)break;for(f=0;f<tt.length;f++){var rt=0,o=0,u="",p=0;if(rt=n.Utility.Util.getValueOfInt(tt[f]),a.push(rt.toString()),window.VAICNT&&l[f])if(g==184)u="SELECT C_Order_ID FROM C_Order WHERE IsActive = 'Y' AND DocumentNo = '"+l[f]+"'",k=n.Utility.Util.getValueOfInt(n.DB.executeScalar(u)),window.DTD001&&(u="SELECT ol.C_OrderLine_ID FROM C_OrderLine ol INNER JOIN C_Order o ON ol.C_Order_ID=o.C_Order_ID WHERE o.DocumentNo = '"+l[f]+"' AND ol.M_Product_ID = "+h[f]+" AND ol.M_AttributeSetInstance_ID = "+a[f]+" AND ol.DTD001_Org_ID = "+n.context.getAD_Org_ID(),o=n.Utility.Util.getValueOfInt(n.DB.executeScalar(u))),o==0&&(u="SELECT ol.C_OrderLine_ID FROM C_OrderLine ol INNER JOIN C_Order o ON ol.C_Order_ID=o.C_Order_ID WHERE o.DocumentNo = '"+l[f]+"' AND ol.M_Product_ID = "+h[f]+" AND ol.M_AttributeSetInstance_ID = "+a[f],o=n.Utility.Util.getValueOfInt(n.DB.executeScalar(u)),o==0&&(u="SELECT ol.C_OrderLine_ID FROM C_OrderLine ol INNER JOIN C_Order o ON ol.C_Order_ID=o.C_Order_ID WHERE o.DocumentNo = '"+l[f]+"' AND ol.M_Product_ID = "+h[f],o=n.Utility.Util.getValueOfInt(n.DB.executeScalar(u)))),e.push(o.toString());else if(g==169)u="SELECT C_Order_ID FROM C_Order WHERE IsActive = 'Y' AND DocumentNo = '"+l[f]+"'",k=n.Utility.Util.getValueOfInt(n.DB.executeScalar(u)),u="SELECT ol.C_OrderLine_ID FROM C_OrderLine ol INNER JOIN C_Order o ON ol.C_Order_ID=o.C_Order_ID WHERE o.DocumentNo = '"+l[f]+"' AND ol.M_Product_ID = "+h[f]+" AND ol.M_AttributeSetInstance_ID = "+a[f],o=n.Utility.Util.getValueOfInt(n.DB.executeScalar(u)),o==0&&(u="SELECT ol.C_OrderLine_ID FROM C_OrderLine ol INNER JOIN C_Order o ON ol.C_Order_ID=o.C_Order_ID WHERE o.DocumentNo = '"+l[f]+"' AND ol.M_Product_ID = "+h[f],o=n.Utility.Util.getValueOfInt(n.DB.executeScalar(u))),e.push(o.toString());else if(g==319){if(window.DTD001){if(c="",e.length>0)for(s=0;s<e.Count;s++)e[s]>0&&(c+=c?","+e[s]:e[s]);u="SELECT ol.M_MovementLine_ID FROM M_MovementLine ol INNER JOIN M_Movement o ON ol.M_Movement_ID=o.M_Movement_ID WHERE o.DocumentNo = '"+l[f]+"' AND ol.M_Product_ID = "+h[f];c&&(u+=" AND ol.M_MovementLine_ID Not In ( "+c+")");o=n.Utility.Util.getValueOfInt(n.DB.executeScalar(u));e.push(o.toString())}}else if(g==170){if(window.DTD001){if(c="",e.length>0)for(s=0;s<e.Count;s++)e[s]>0&&(c+=c?","+e[s]:e[s]);u="SELECT ol.M_RequisitionLine_ID FROM M_RequisitionLine ol INNER JOIN M_Requisition o ON ol.M_Requisition_ID=o.M_Requisition_ID WHERE o.DocumentNo = '"+l[f]+"' AND ol.M_Product_ID = "+h[f];c&&(u+=" AND ol.M_RequisitionLine_ID Not In ( "+c+")");o=n.Utility.Util.getValueOfInt(n.DB.executeScalar(u));e.push(o.toString());tt[f]&&(at[f]!="N"&&rt>0?(u="SELECT A_Asset_ID FROM A_Asset WHERE IsActive = 'Y' AND M_Product_ID = "+h[f]+" AND M_AttributeSetInstance_ID = "+rt,p=n.Utility.Util.getValueOfInt(n.DB.executeScalar(u))):(u="SELECT A_Asset_ID FROM A_Asset WHERE IsActive = 'Y' AND M_Product_ID = "+h[f]+" AND SerNo = "+tt[f],p=n.Utility.Util.getValueOfInt(n.DB.executeScalar(u))));d.Add(p)}}else if(g==341){if(window.DTD001){if(c="",e.length>0)for(s=0;s<e.Count;s++)e[s]>0&&(c+=c?","+e[s]:e[s]);u="SELECT ol.M_RequisitionLine_ID FROM M_RequisitionLine ol INNER JOIN M_Requisition o ON ol.M_Requisition_ID=o.M_Requisition_ID WHERE o.DocumentNo = '"+l[f]+"' AND ol.M_Product_ID = "+h[f];c.Length>0&&(u+=" AND ol.M_RequisitionLine_ID Not In ( "+c+")");o=n.Utility.Util.getValueOfInt(n.DB.executeScalar(u));e.push(o.toString())}}else g==168&&(u="SELECT M_Locator_ID FROM M_Locator WHERE IsActive = 'Y' AND Value = '"+l[f]+"'",b=n.Utility.Util.getValueOfInt(n.DB.executeScalar(u)),b>0&&(ut=b),e.push(o.toString()));else g==169?(u="SELECT C_Order_ID FROM M_InOut WHERE IsActive = 'Y' AND M_InOut_ID = "+ht,k=n.Utility.Util.getValueOfInt(n.DB.executeScalar(u)),u="SELECT C_OrderLine_ID FROM C_OrderLine WHERE C_Order_ID = "+k+" AND M_Product_ID = "+h[f]+" AND M_AttributeSetInstance_ID = "+a[f],o=n.Utility.Util.getValueOfInt(n.DB.executeScalar(u)),o==0&&(u="SELECT C_OrderLine_ID FROM C_OrderLine WHERE C_Order_ID = "+k+" AND M_Product_ID = "+h[f],o=n.Utility.Util.getValueOfInt(n.DB.executeScalar(u))),e.push(o.toString())):e.push(o.toString());g==168?(ot.push(uu(rt,h[f],ut).toString()),d.push(p.toString())):g==341?(ot.push("0"),u="SELECT C_Charge_ID FROM C_Charge WHERE IsActive = 'Y' AND DTD001_ChargeType = 'INV'",p=n.Utility.Util.getValueOfInt(n.DB.executeScalar(u)),d.push(p.toString())):(d.push(p.toString()),ot.push("0"))}w=="SAP001_StockTransfer_ID"?t.ajax({type:"POST",url:n.Application.contextUrl+"InfoProduct/SaveStockTfr",dataType:"json",data:{id:ft,keyColumn:w,AD_Table_ID:n.context.getWindowTabContext(r,1,"AD_Table_ID"),prod:JSON.stringify(h),C_UOM_ID:JSON.stringify(st),listAst:JSON.stringify(a),qty:JSON.stringify(et),ordlineID:JSON.stringify(e),listLoc:JSON.stringify(it),locatorTo:b,astID:JSON.stringify(d),lineID:nt},success:function(n){var t=n.result;t},error:function(n,t){console.log(t);returnValue}}):g==170||g==341?t.ajax({type:"POST",url:n.Application.contextUrl+"InfoProduct/Save1",dataType:"json",data:{id:ft,keyColumn:w,prod:JSON.stringify(h),C_UOM_ID:JSON.stringify(st),listAst:JSON.stringify(a),qty:JSON.stringify(et),ordlineID:JSON.stringify(e),listLoc:JSON.stringify(it),locatorTo:b,astID:JSON.stringify(d),lineID:nt},success:function(t){var r=t.result,i;if(r=""){kt&&(i="DELETE FROM VAICNT_InventoryCount WHERE VAICNT_InventoryCount_ID ="+ri,n.DB.executeQuery(i));return}},error:function(n,t){console.log(t)}}):t.ajax({type:"POST",url:n.Application.contextUrl+"InfoProduct/Save",dataType:"json",async:!1,data:{id:ft,keyColumn:w,prod:JSON.stringify(h),C_UOM_ID:JSON.stringify(st),listAst:JSON.stringify(a),qty:JSON.stringify(et),qtyBook:JSON.stringify(ot),ordlineID:JSON.stringify(e),ordID:k,listLoc:JSON.stringify(it),lineID:nt},success:function(t){var r=t.result,i;if(r==""){kt&&(i="DELETE FROM VAICNT_InventoryCount WHERE VAICNT_InventoryCount_ID ="+ri,n.DB.executeQuery(i));return}},error:function(n,t){console.log(t)}})}function uu(t,i,r){var f=null,e="SELECT QtyOnHand FROM M_Storage WHERE M_Product_ID = "+i+" AND M_Locator_ID = "+r+" AND M_AttributeSetInstance_ID = "+t,u;if(t==0&&(e="SELECT SUM(QtyOnHand) FROM M_Storage WHERE M_Product_ID = "+i+" AND M_Locator_ID = "+r),u=null,u=n.DB.executeReader(e),u.read()){if(f=n.Utility.Util.getValueOfDecimal(u.getDecimal(0)),f!=null)return f}else return u.close(),0;return u.Close(),0}function fu(){tr()}var er,or;this.onClose=null;var it=t("<div>"),sr=!0,ft=t("<div>"),hr=null,cr=null,lr=null,et=null,lt=null,at=null,dt=null,fi=null,vi=null,yi=null,pi=null,wi=null,vt=null,yt=null,ot=null,st=null,gt=null,ut=null,pt=null,ht=null,wt=null,bt=null,ct=null,ni=null,b=null,ar=null,w=[],d=null,k=null,ki=this,di="",g=0,y=[],vr=null,p=null,ei=null,oi=null,si=null,hi=null,ci=null,li=null,rt=null,tt=null,ti=null,ii=null,nt=t("<table>"),l=null,ir=null,rr=null,gi=null,v=[],a=[],nr=!1,ai=!1,ur=0,fr=/ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()),kt=!1,ri=0;yr();n.context.getContextAsInt(r,n.context.getWindowTabContext(r,1,"KeyColumnName"))!=0&&(ai=!0);(!h||ai)&&(ht.hide(),ut.hide(),gt.hide(),pt.hide());er="M_Product p LEFT OUTER JOIN M_ProductPrice pr ON (p.M_Product_ID=pr.M_Product_ID AND pr.IsActive='Y') LEFT OUTER JOIN M_PriceList_Version plv ON (pr.M_PriceList_Version_ID=plv.M_PriceList_Version_ID) LEFT OUTER JOIN M_AttributeSet pa ON (p.M_AttributeSet_ID=pa.M_AttributeSet_ID) LEFT OUTER JOIN M_manufacturer mr ON (p.M_Product_ID=mr.M_Product_ID) LEFT OUTER JOIN M_ProductAttributes patr ON (p.M_Product_ID=patr.M_Product_ID), M_Warehouse w";pr();wr(u,f);var nu=function(){kt=!1;ri=0;var t=new n.InfoScanForm(r,!1);t.showDialog();t.onClose=function(t,i,u){var e,k,d,f;for(kt=i,ri=u;t.read();){var h="",c="",l=0,o=0,y="",s=t.getDecimal("vaicnt_quantity"),p=t.getInt("M_Product_ID"),g=t.getString("value"),w=t.getString("vaicnt_attributeno"),nt=t.getString("Islot"),tt=t.getString("IsSerNo"),it=t.getString("IsGuaranteeDate"),b=t.getDateTime("ExpiryDate");b==null&&(b="null");e=t.getString("VAICNT_ReferenceNo");e==""&&(e="null");w!=""&&(o=n.Utility.Util.getValueOfInt(w),k="SELECT Description FROM M_AttributeSetInstance WHERE M_AttributeSetInstance_ID = "+o,y=n.Utility.Util.getValueOfString(n.DB.executeScalar(k)));d="select p.name as Product, u.name as UOM, u.C_UOM_ID from m_product p left outer  join c_uom u on (u.c_uom_id = p.c_uom_id) where p.m_product_id = "+p;try{for(f=n.DB.executeReader(d.toString(),null,null);f.read();)h=f.getString(0),c=f.getString(1),l=f.getInt(2)}catch(rt){}s>0&&v.push({_prodQty:s,_prdID:t.getInt("M_Product_ID"),_value:t.getString("value"),_uom:l,_AD_Session_ID:n.Env.getCtx().getContext("#AD_Session_ID"),_windowNo:r,_RefNo:t.getString("VAICNT_ReferenceNo"),_Attribute:t.getString("vaicnt_attributeno"),_AttributeName:"",_Locator_ID:"",_IsLotSerial:"N"});a.push({SrNo:a.length,Product:h,Value:g,QtyEntered:s,UOM:c,M_Product_ID1:p,Attribute:o,AttributeName:y,RefNo:e})}ui()}},tu=function(){su();bi(!0);v.length>0?ut.prop("disabled",!1):ut.prop("disabled",!0);y=[]},iu=function(){var r=[],u=[],f=[],e=[],o=[],s=[],h=[],c=[],i,l,y,t;a=[];ht.hide();for(i in v){r.push(v[i]._prdID);u.push(v[i]._value);f.push(v[i]._prodQty);c.push(v[i]._RefNo);s.push(v[i]._Attribute);h.push(v[i]._AttributeName);try{l=n.Utility.Util.getValueOfString(n.DB.executeScalar("SELECT Name FROM M_Product WHERE M_Product_ID = "+n.Utility.Util.getValueOfInt(r[i]),null,null));y=n.Utility.Util.getValueOfString(n.DB.executeScalar("SELECT Name FROM C_UOM WHERE C_UOM_ID = "+n.Utility.Util.getValueOfInt(v[i]._uom),null,null));e.push(l);o.push(y)}catch(p){}}if(r.length>0){for(t=0;t<r.length;t++)a.push({SrNo:t,Product:e[t],Value:u[t],QtyEntered:f[t],UOM:o[t],M_Product_ID1:r[t],Attribute:s[t],AttributeName:h[t],RefNo:c[t]});ui()}};or=function(){if(h&&v.length>0)y=[],nr=!0,ru(v);else{y=[];var n=w2ui[p].getSelection();for(item in n)y.push(w2ui[p].get(n[item])[di])}ki.onClose!=null&&ki.onClose();tr()};this.show=function(){t.ajax({url:n.Application.contextUrl+"InfoProduct/GetInfoColumns",dataType:"json",error:function(){alert(n.Msg.getMsg("ERRORGettingSearchCols"));b[0].style.visibility="hidden"},success:function(t){if(d=jQuery.parseJSON(t),d==null){alert(n.Msg.getMsg("ERRORGettingSearchCols"));b[0].style.visibility="hidden";return}it.dialog({width:1020,height:500,title:n.Msg.translate(n.Env.getCtx(),"Info Product"),resizable:!1,modal:!0,close:fu});bi(!1)}})};var bi=function(i){var s,u;ou();var e="SELECT DISTINCT ",h=0,l=t.makeArray(d).length;for(s in d)h=d[s].AD_Reference_ID,e+=h==n.DisplayType.YesNo?" ( CASE "+d[s].ColumnSQL+" WHEN 'Y' THEN  'True' ELSE 'False'  END ) "+d[s].ColumnName:d[s].ColumnSQL+" ",h==n.DisplayType.ID&&(di=d[s].ColumnName.toUpperCase()),l-1==s||(e+=", ");if(e+=" FROM "+er,i==!0){var f="",r=null;for(u=0;u<w.length;u++)(r=w[u].Ctrl.getValue(),r!=null&&r.length!=0&&r!=0)&&(f.length>0&&(f+=" AND "),w[u].Ctrl.displayType==10&&(r=String(r).indexOf("%")==0?String(r).replace("%","●"):"●"+r,String(r).lastIndexOf("●")==String(r).length||(r=r+"●")),w[u].Ctrl.colName=="Value"?f+="  UPPER(p."+w[u].ColumnName+") LIKE '"+r.toUpperCase()+"' ":w[u].Ctrl.colName=="Name"?f+="  UPPER(p."+w[u].ColumnName+") LIKE '"+r.toUpperCase()+"' ":w[u].Ctrl.colName=="UPC"?f+=" (UPPER(patr.UPC) LIKE '"+r.toUpperCase()+"' OR UPPER(p.UPC) LIKE '"+r.toUpperCase()+"' OR UPPER(mr.UPC) LIKE '"+r.toUpperCase()+"')":w[u].Ctrl.colName=="SKU"?f+="  UPPER(p."+w[u].ColumnName+") LIKE '"+r.toUpperCase()+"' ":w[u].Ctrl.colName=="M_Warehouse_ID"?n.Utility.Util.getValueOfInt(r)!=0&&(f+=" w.M_Warehouse_ID="+n.Utility.Util.getValueOfInt(r)):w[u].Ctrl.colName=="M_PriceList_Version_ID"&&n.Utility.Util.getValueOfInt(r)!=0&&(f+=" pr.M_PriceList_Version_ID="+n.Utility.Util.getValueOfInt(r)));f.length>1?(e+=" WHERE "+f,c!=null&&c.length>0&&(e+=" AND "+c.replace(/M_Product\./g,"p."))):c!=null&&c.length>0&&(e+=" WHERE "+c.replace(/M_Product\./g,"p."));g==181&&(c+=" AND (p.Discontinued = 'N' OR p.DiscontinuedBy > sysdate )")}else e+=c.length>0&&c.trim().toUpperCase().startsWith("WHERE")?" "+c.replace(/M_Product\./g,"p.")+" AND "+o+"_ID=-1":c.length>0?" WHERE p."+o+"_ID=-1 AND "+c.replace(/M_Product\./g,"p."):" WHERE p."+o+"_ID=-1";t.ajax({url:n.Application.contextUrl+"InfoProduct/GetData",dataType:"json",type:"POST",data:{sql:e,tableName:o},error:function(){alert(n.Msg.getMsg("ErrorWhileGettingData"));b[0].style.visibility="hidden";return},success:function(n){eu(JSON.parse(n))}})},eu=function(i){var r,l,e,o,f;if(i==null){alert(n.Msg.getMsg("NoDataFound"));b[0].style.visibility="hidden";return}var s=[],c=[],u=null;for(f in i)r={resizable:!0},u=d[f].AD_Reference_ID,r.caption=d[f].Name,r.field=d[f].ColumnName.toUpperCase(),r.sortable=!0,r.size="100px",n.DisplayType.IsNumeric(u)?(r.render=u==n.DisplayType.Integer?"int":u==n.DisplayType.Amount?"number:2":"number:1",d[f].ColumnName.toUpperCase()=="QTYENTERED"&&h&&!ai&&(r.editable={type:"float"})):n.DisplayType.IsDate(u)?r.render=function(n,t,i){var r=n[s[i].field];return r?Globalize.format(new Date(r),"d"):""}:u==n.DisplayType.Location||u==n.DisplayType.Locator?r.render="int":u==n.DisplayType.Account?r.render="int":u==n.DisplayType.PAttribute?r.render="int":u==n.DisplayType.Button?r.render=function(){return"<div>button<\/div>"}:u==n.DisplayType.Image?r.render=function(){return"<div>Image<\/div>"}:n.DisplayType.IsLOB(u)&&(r.render=function(){return"<div>[Lob-blob]<\/div>"}),s[f]=r;for(l=fr?50:100,e=0;e<i[0].RowCount&&e<l;e++){o={};for(f in i)o[i[f].ColumnName]=i[f].Values[e];o.recid=e+1;c[e]=o}p="gridPrdInfodata"+Math.random();p=p.replace(".","");w2utils.encodeTags(c);k=t(at).w2grid({name:p,recordHeight:40,show:{toolbar:!0,columnHeaders:!0,lineNumbers:!0,selectColumn:!0,toolbarReload:!1,toolbarColumns:!0,toolbarSearch:!1,toolbarAdd:!1,toolbarDelete:!1,toolbarSave:!1,selectionBorder:!1,recordTitles:!1},columns:s,records:c,onChange:function(n){var i=-1,t;if(w2ui[p].records[n.index].QTYENTERED=n.value_new,y.length>0){for(t in y)if(y[t].recid==w2ui[p].records[n.index].recid){i=t;break}i>-1?y[n.index].QTYENTERED=n.value_new:y.push(w2ui[p].records[n.index])}else y.push(w2ui[p].records[n.index])}});w2ui[p].hideColumn("M_PRODUCT_ID");(!h||ai)&&w2ui[p].hideColumn("QTYENTERED");b[0].style.visibility="hidden"},ou=function(){k!=null&&k.destroy();k=null};this.getSelectedValues=function(){return y};this.getRefreshStatus=function(){return nr};var su=function(){if(h&&(y.length>0||w2ui[p].getSelection().length>0))hu();else return},hu=function(){var i,f,e,t,o,s,u;if(w2ui[p].getSelection().length>0){i=w2ui[p].getSelection();for(t in i)if(f=w2ui[p].get(i[t]).M_PRODUCT_ID,y.length>0)if(e=y.map(function(n){return n.M_PRODUCT_ID==f}).indexOf(!0),e>-1)continue;else y.push(w2ui[p].get(i[t]));else y.push(w2ui[p].get(i[t]))}if(y.length>0)for(t in y){o="SELECT C_UOM_ID FROM M_Product WHERE M_Product_ID = "+n.Utility.Util.getValueOfInt(y[t].M_PRODUCT_ID);try{s=n.Utility.Util.getValueOfInt(n.DB.executeScalar(o.toString(),null,null))}catch(h){}u=y[t].QTYENTERED;u>0&&v.push({_prodQty:u,_prdID:y[t].M_PRODUCT_ID,_value:y[t].VALUE,_uom:s,_AD_Session_ID:n.Env.getCtx().getContext("#AD_Session_ID"),_windowNo:r,_RefNo:"",_Attribute:"",_AttributeName:"",_Locator_ID:"",_IsLotSerial:"N"})}},tr=function(){it.off("keyup");wt.off("click");bt.off("click");ni.off("click");at=null;lt=null;k!=null&&k.destroy();k=null;sr=null;ft=null;hr=null;cr=null;lr=null;et=null;lt=null;at=null;dt=null;fi=null;vt=null;yt=null;ot=null;wt=null;bt=null;ct=null;ni=null;pt=null;b=null;ar=null;w=null;d=null;k=null;ki=null;di=null;y=null;vr=null;v=null;a=null;nr=!1;fr=null;kt=null;it!=null&&(it.dialog("destroy"),it.remove());it=null;this.btnOKClick=null;this.displaySearchCol=null;this.displayData=null;this.loadData=null;this.disposeComponent=null;this.disposeDataSec=null;this.getSelectedValues=null;this.refreshUI=null}}n.infoProduct=i}(VIS,jQuery),function(n,t){function i(i,r){function pt(){var o,r,s;f.css("width","100%");f.css("height","100%");f.css("position","relative");y.css("width","98%");y.css("height","97%");y.css("position","absolute");b.css("width","100%");n.Application.isRTL?(h=t("<div style='background-color: rgb(241, 241, 241);height:88.9%;display: inline-block;width:25%;height:87.8%;overflow:auto;padding-right: 10px;margin-left: 10px;'>"),rt=t("<div style='background-color: rgb(241, 241, 241);display: inline-block;height:87.8%;'>"),h.append(rt),ft=t("<div style='display: inline-block;width:73%;height:87.8%;overflow:auto;'>"),p=t("<div style='display: inline-block;width:99%;height:auto;margin-top: 2px;'>")):(h=t("<div style='background-color: rgb(241, 241, 241);padding-left: 7px;height:88.9%;display: inline-block; float: left;width:25%;height:87.8%;overflow:auto;'>"),rt=t("<div style='background-color: rgb(241, 241, 241);'>"),h.append(rt),ft=t("<div style='display: inline-block; float: left;width:73%;height:87.8%;margin-left:10px;'>"),p=t("<div style='display: inline-block; float: left;width:99%;height:auto;margin-top: 2px;'>"));y.append(h);y.append(ft);y.append(p);et=n.Msg.translate(n.Env.getCtx(),"Name");et.indexOf("&")>-1&&(et=et.replace("&",""));ht=n.Msg.translate(n.Env.getCtx(),"ReferenceNo");ht.indexOf("&")>-1&&(ht=lblUPCtxt.replace("&",""));ot=n.Msg.translate(n.Env.getCtx(),"DateTrx");ot.indexOf("&")>-1&&(ot=ot.replace("&",""));d=n.Msg.getMsg("Cancel");d.indexOf("&")>-1&&(d=d.replace("&",""));k=n.Msg.getMsg("Search");k.indexOf("&")>-1&&(k=k.replace("&",""));g=n.Msg.getMsg("Ok");g.indexOf("&")>-1&&(g=g.replace("&",""));c=t("<div style='float:right;'>");nt=t("<div style='float:right;'>");n.Application.isRTL?(w=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(d),l=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(g),tt=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:10px'>").append(k)):(u=t("<tr>"),b.append(u),o=t("<td>"),ut=t("<label class='VIS_Pref_Label_Font' style='margin-bottom: 0px;margin-top:5px;font-weight:inherit'>").append(et),o.append(ut),u.append(o),u=t("<tr>"),b.append(u),r={},a=new n.Controls.VTextBox("Name",!1,!1,!0,50,100,null,null,!1),r.Ctrl=a,r.AD_Reference_ID=10,r.ColumnName="Name",s=t("<td>"),u.append(s),s.append(a.getControl().css("width","97%").css("font-weight","inherit")),v.push(r),u=t("<tr>"),b.append(u),o=t("<td>"),ut=t("<label class='VIS_Pref_Label_Font' style='margin-bottom: 0px;margin-top:5px;font-weight:inherit'>").append(ht),o.append(ut),u.append(o),u=t("<tr>"),b.append(u),r={},a=new n.Controls.VTextBox("Reference",!1,!1,!0,50,100,null,null,!1),r.Ctrl=a,r.AD_Reference_ID=10,r.ColumnName="Reference",s=t("<td>"),u.append(s),s.append(a.getControl().css("width","97%").css("font-weight","inherit")),v.push(r),u=t("<tr>"),b.append(u),o=t("<td>"),ut=t("<label class='VIS_Pref_Label_Font' style='margin-bottom: 0px;margin-top:5px;font-weight:inherit'>").append(ot),o.append(ut),u.append(o),u=t("<tr>"),b.append(u),r={},a=new n.Controls.VDate("TrxDate",!1,!1,!0,n.DisplayType.Date,n.Msg.translate("DateTrx")),r.Ctrl=a,r.AD_Reference_ID=10,r.ColumnName="TrxDate",s=t("<td>"),u.append(s),s.append(a.getControl().css("width","97%").css("font-weight","inherit").css("height","30px")),v.push(r),rt.append(b),w=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(d),l=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(g),tt=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:10px'>").append(k));c.append(w);c.append(l);c.append(t('<div style="float:left;margin-right:10px;margin-top:15px;"><input type="checkbox" id="chkDelCart_'+i+'" style="float:left"><span style="float:left">'+n.Msg.getMsg("DeleteCart")+"<\/span>"));nt.append(tt);h.append(nt);p.append(c);n.Application.isRTL?(st.append(w),st.append(l),nt.append(tt),h.append(nt)):(c.append(w),c.append(l),nt.append(tt),h.append(nt));p.append(c);p.append(st);e=t("<div class='vis-apanel-busy'>");e.css("width","98%");e.css("height","97%");e.css("text-align","center");e.css("position","absolute");e[0].style.visibility="visible";ct=p.find("#chkDelCart_"+i);f.append(y);f.append(e)}function wt(){if(!n.Application.isMobile)f.on("keyup",function(n){n.keyCode===13&&(e[0].style.visibility="visible",lt(!0))});w.on("click",function(){disposeComponent()});l.on("click",function(){kt()});tt.on("click",function(){e[0].style.visibility="visible";lt(!0)})}this.onClose=null;this.arrListColumns=[];var f=t("<div>"),at=!0,y=t("<div>"),h=null,rt=null,ft=null,p=null,k=null,d=null,g=null,c=null,nt=null,w=null,l=null,tt=null,ct=null,st=null,e=null,o=null,s=this,it=0,et=null,ht=null,ot=null,ut=null,a=null,b=t("<table>"),u=null,vt=!1,v=[],yt=/ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase());pt();wt();var lt=function(t){var f,c,e;if(t==!0){var o="",a=" rownum <= "+(yt?50:100)+" AND",u=null,s=null,l=[],h="SELECT AD_Window_ID FROM AD_Tab WHERE AD_Tab_ID = "+n.Utility.Util.getValueOfInt(n.context.getWindowTabContext(i,0,"AD_Tab_ID"));for(it=n.Utility.Util.getValueOfInt(n.DB.executeScalar(h,null,null)),f=0;f<v.length;f++)(u=v[f].Ctrl.getValue(),u!=null&&u.length!=0&&u!=0)&&(v[f].Ctrl.colName=="Name"?o+=" AND upper(VAICNT_ScanName) LIKE '"+u.toUpperCase()+"' ":v[f].Ctrl.colName=="Reference"?o+=" AND upper(VAICNT_ReferenceNo) LIKE '"+u.toUpperCase()+"' ":v[f].Ctrl.colName=="TrxDate"&&(o+=" AND to_char(TO_DATE(DateTrx,'DD-MM-YYYY')) = to_char("+Globalize.format(new Date(u),!0)+")"));o+=r?" AND VAICNT_TransactionType = 'OT' ":it==184?" AND VAICNT_TransactionType = 'MR' and VAICNT_ReferenceNo in (SELECT DocumentNo from C_Order WHERE  C_BPartner_ID = "+n.Utility.Util.getValueOfInt(n.context.getWindowTabContext(i,0,"C_BPartner_ID"))+")":it==319||it==170?" AND VAICNT_TransactionType = 'IM' ":it==168?" AND VAICNT_TransactionType = 'PI' ":it==169?" AND VAICNT_TransactionType = 'SH' and VAICNT_ReferenceNo in (SELECT DocumentNo from C_Order WHERE  C_BPartner_ID = "+n.Utility.Util.getValueOfInt(n.context.getWindowTabContext(i,0,"C_BPartner_ID"))+")":it==341?" AND VAICNT_TransactionType = 'IU' ":" AND VAICNT_TransactionType = 'OT' "}else o+=" AND VAICNT_InventoryCount_ID = -1";h="SELECT VAICNT_ScanName,VAICNT_ReferenceNo,DateTrx,VAICNT_InventoryCount_ID FROM VAICNT_InventoryCount WHERE IsActive='Y' AND AD_Client_ID = "+n.Utility.Util.getValueOfInt(n.context.getAD_Client_ID())+o+" ORDER BY VAICNT_ScanName";try{for(s=n.DB.executeReader(h,null,null),c=1;s.read();)e={},e.Name=s.getString("VAICNT_ScanName"),e.Reference=s.getString("VAICNT_ReferenceNo"),e.TrxDate=s.getString("DateTrx"),e.count_ID=s.getInt("VAICNT_InventoryCount_ID"),e.recid=c,l.push(e),c++}catch(y){}bt(l)},bt=function(i){if(i==null){e[0].style.visibility="hidden";return}o!=null&&(o.destroy(),o=null);o=null;s.arrListColumns=[];s.arrListColumns.push({field:"Name",caption:n.Msg.translate(n.Env.getCtx(),"Name"),sortable:!0,size:"16%",min:150,hidden:!1});s.arrListColumns.push({field:"Reference",caption:n.Msg.translate(n.Env.getCtx(),"ReferenceNo"),sortable:!0,size:"16%",min:150,hidden:!1});s.arrListColumns.push({field:"TrxDate",caption:n.Msg.translate(n.Env.getCtx(),"DateTrx"),sortable:!0,size:"16%",min:150,hidden:!1,render:"date"});s.arrListColumns.push({field:"count_ID",caption:n.Msg.translate(n.Env.getCtx(),"ID"),sortable:!0,size:"16%",min:150,hidden:!0});var r="gridPrdInfodata"+Math.random();r=r.replace(".","");w2utils.encodeTags(i);o=t(ft).w2grid({name:r,recordHeight:30,columns:s.arrListColumns,records:i,onClick:function(){o.records.length>0&&l.removeAttr("disabled")}});e[0].style.visibility="hidden"},kt=function(){var t,u,i,e;if(t=-1,u="",o!=null)if(t=Number(o.getSelection().toString()),t>0){if(i=o.get(t).count_ID,u=r?"SELECT cl.M_Product_ID,prd.Name,prd.Value,cl.VAICNT_Quantity,cl.M_AttributeSetInstance_ID,cl.C_UOM_ID,uom.Name as UOM FROM VAICNT_InventoryCount ic INNER JOIN VAICNT_InventoryCountLine cl ON ic.VAICNT_InventoryCount_ID = cl.VAICNT_InventoryCount_ID INNER JOIN M_Product prd ON cl.M_Product_ID = prd.M_Product_ID INNER JOIN C_UOM uom ON cl.C_UOM_ID = uom.C_UOM_ID WHERE ic.VAICNT_InventoryCount_ID = "+i:"select cnt.M_Product_ID,p.Value,cnt.vaicnt_quantity,cnt.vaicnt_attributeno,ats.Islot,ats.IsSerNo,ats.IsGuaranteeDate,case when (ats.IsGuaranteeDate = 'Y') then sysdate+p.GuaranteeDays end as ExpiryDate,cnt.VAICNT_ReferenceNo from (SELECT CASE WHEN (cl.upc = mr.upc) THEN mr.M_product_ID ELSE CASE WHEN (cl.upc = prd.upc) THEN prd.M_Product_ID ELSE CASE WHEN (cl.upc = patr.upc) THEN patr.M_Product_ID END END END AS M_Product_ID,cl.vaicnt_quantity,cl.vaicnt_attributeno,ic.VAICNT_ReferenceNo FROM VAICNT_InventoryCount ic INNER JOIN VAICNT_InventoryCountLine cl ON (ic.VAICNT_InventoryCount_ID = cl.VAICNT_InventoryCount_ID) LEFT JOIN M_manufacturer mr ON cl.upc = mr.upc LEFT JOIN M_product prd ON cl.upc = prd.upc LEFT JOIN M_ProductAttributes patr ON cl.upc = patr.upc WHERE ic.IsActive = 'Y' AND cl.IsActive = 'Y' AND (cl.upc = mr.upc OR cl.upc = prd.upc OR cl.upc = patr.upc) AND ic.ad_client_id = "+n.context.getAD_Client_ID()+" AND prd.ad_client_id = "+n.context.getAD_Client_ID()+" AND ic.VAICNT_InventoryCount_ID = "+i+" ) cnt inner join M_Product p on cnt.M_Product_ID=p.M_Product_ID left join M_attributeset ats on p.M_attributeset_id=ats.M_attributeset_id",e=n.DB.executeReader(u,null,null),s.onClose)s.onClose(e,ct.prop("checked"),i);f.dialog("close")}else alert("Please Select a Record")};this.showDialog=function(){f.dialog({modal:!0,title:n.Msg.translate(n.Env.getCtx(),"Info Scan"),width:800,height:450,resizable:!1,close:function(){s.dispose()}});lt(!1)};this.disposeComponent=function(){f.off("keyup");w.off("click");l.off("click");tt.off("click");ft=null;rt=null;o!=null&&o.destroy();o=null;at=null;y=null;h=null;p=null;k=null;d=null;g=null;c=null;w=null;l=null;ct=null;st=null;e=null;v=null;s=null;vt=!1;f!=null&&(f.dialog("destroy"),f.remove());f=null;this.displayData=null;this.disposeComponent=null}}i.prototype.dispose=function(){this.disposeComponent()};n.InfoScanForm=i}(VIS,jQuery),function(n,t){function i(i,r,u,f,e,o,s,h){function fi(){d.empty();d=null;pt.empty();pt=null;tt.empty();tt=null;c=null;v=null;y=null;p=null;w=null;ot=null;ft=null;nt=null;g=null;it=null;rt=null;ut=null;l=null;ot=null;b=null;progresBar=null;k=null;et!=null&&(et.dialog("destroy"),et.remove());et=null}function li(){wt.onClose&&wt.onClose();fi()}function ei(){ui||(l[0].style.visibility="visible",t.ajax({url:n.Application.contextUrl+"Attachment/GetAttachment",dataType:"json",data:{AD_Table_ID:u,Record_ID:f},error:function(){alert(n.Msg.getMsg("ERRORGettingAttachment"));l[0].style.visibility="hidden"},success:function(i){var u=i.result.FLocation,f=i.result.Attachment,e,c,a,ti,v,ot,o,y,p,w,nt,h,it,st,rt,ht,ut,ct,ft,vt,bt,kt,dt,et,gt,ni;if(u==null){alert(n.Msg.getMsg("ERRORGettingAttachment"));l[0].style.visibility="hidden";return}e=t("<div class='vis-latest-attachments'>");g.append(e);c=t("<div class='vis-attach-top'>");e.append(c);a=t("<div class='vis-attach-file-location pull-left' style='margin-top: -12px;'>");c.append(a);ti=t("<label>").append(n.Msg.getMsg("FileLocation"));a.append(ti);lt=t("<select>");lt.attr("disabled",!0);for(v in u.values)ot=t("<option value="+u.values[v].Key+">"),ot.append(u.values[v].Name),lt.append(ot),u.selectedvalue==u.values[v].Key&&lt.val(u.selectedvalue);a.append(lt);o=t("<div class='vis-attach-top-btns pull-right'>");c.append(o);y=t("<input type='file' multiple='true' style='display:none;'>");o.append(y);y.change(function(){vi(this)});p=t("<a class='vis-attach-ico vis-browse-ico' style='margin-top:-12px'>");o.append(p);p.on("click",function(){y.trigger("click")});s&&p.hide();w=t("<div class='vis-dropdown pull-left'>");o.append(w);nt=t("<a class='vis-btn vis-btn-arrange vis-dropdown-toggle' type='button' data-toggle='dropdown' style='color: #fff;display:none;'>");nt.append(n.Msg.getMsg("Arrange"));nt.append(t("<span class='vis-caret'>"));w.append(nt);h=t("<ul class='dropdown-menu' role='menu' aria-labelledby='dropdownMenu1' id='dropdownMenu' style='margin-left: -33px;'>");w.append(h);it=t("<li role='presentation'>");st=t("<a role='menuitem' tabindex='-1' href='#'>");st.append(n.Msg.getMsg("Type"));it.append(st);it.on("click",function(){});h.append(it);rt=t("<li role='presentation'>");ht=t("<a role='menuitem' tabindex='-1' href='#'>");ht.append(n.Msg.getMsg("Size"));rt.append(ht);rt.on("click",function(){});h.append(rt);ut=t("<li role='presentation'>");ct=t("<a role='menuitem' tabindex='-1' href='#'>");ct.append(n.Msg.getMsg("Name"));ut.append(ct);ut.on("click",function(){});h.append(ut);d=t("<div class='vis-attach-content-wrap' style='display:none;border-bottom: 0px;padding-bottom:0px'>");e.append(d);e.append(at);ft=t("<div class='pull-right' style='height:40px;overflow:auto;margin-top: 5px;'>");at.append(ft);vt=t("<a href='javascript:void(0)'  class='vis-attach-ico vis-uploadall-ico' style='height:30px;width:30px;margin-right: 7px;' >");ft.append(vt);vt.on("click",function(){yi()});bt=t("<a href='javascript:void(0)'  class='vis-attach-ico vis-cancelall-ico' style='margin-right: 10px;height:30px;width:30px;'>");ft.append(bt);bt.on("click",function(){d.empty();yt=[];b=[];d.hide();at.hide();tt.css("height","356px")});if(pt=t("<div class='vis-old-attachments'>"),g.append(pt),tt=t("<div class='vis-attach-content-wrap' style='height:356px;'>"),pt.append(tt),f!=null&&(r=f.AD_Attachment_ID),f!=null&&f._lines!=null){r=f.AD_Attachment_ID;for(kt in f._lines)oi(f._lines[kt],kt)}dt=t("<div class='vis-attach-footer'>");g.append(dt);et=t("<div class='vis-attach-btns pull-right' style='margin-top: 5px;'>");dt.append(et);gt=t('<a class="vis-btn" style="margin-left: 5px;cursor: pointer;">').append(n.Msg.getMsg("DeleteAll"));et.append(gt);gt.on("click",function(){var i,r;if(k.length!=0&&!s&&n.ADialog.ask("DeleteRecord?")){i="";for(r in k)i+=k[r].Line_ID+",";l[0].style.visibility="visible";t.ajax({url:n.Application.contextUrl+"Attachment/DeleteAttachment",dataType:"json",data:{AttachmentLines:i},error:function(){alert(n.Msg.getMsg("ERRORDeletingFile"));l[0].style.visibility="hidden"},success:function(n){n.result==-1?alert("ErrorDeletingFile"):(tt.empty(),k=[]);l[0].style.visibility="hidden"}})}});ni=t('<a class="vis-btn"  style="margin-left: 5px;cursor: pointer;">').append(n.Msg.getMsg("Cancel"));ni.on("click",function(){wt.onClose&&wt.onClose();fi()});et.append(ni);ui=!0;l[0].style.visibility="hidden"}}))}var ui=!1,d=null,pt=null,tt=null,lt=null,r=0,wt,et,ot,c,v,y,p,w,nt,g,it,rt,ut,ft,l,gt,bt,st,kt,ni,a;o||(o=0);h||(h=!1);s||(s=!1);this.onClose=null;wt=this;et=null;et=n.Application.isRTL?t("<div style='margin-right: -14px;margin-left: -3px;margin-top: -5px;overflow:hidden;width:100%;height:100%;'>"):t("<div style='margin-right: -3px;margin-left: -14px;margin-top: -5px;overflow:hidden;width:100%;height:100%;'>");ot=t("<ul style='height:30px;display:none;list-style:none;width:97%;margin-left:-41px'>");c=t("<li>");c.css("float","left");c.css("margin","1px");c.css("padding","5px");c.css("display","block");c.css("position","relative");c.css("font-weight","700");c.css("border","0px");c.css("border-bottom","none");c.css("border-width","1px");c.css("color","#999");c.css("cursor","default");c.css("height","35px");c.css("margin-bottom","-1px");c.css("margin-right","5px");c.css("border-top-left-radius","3px");c.css("border-top-right-radius","3px");c.append(n.Msg.getMsg("FileAttachment"));ot.append(c);v=t("<li>");v.css("float","left");v.css("margin","1px");v.css("padding","5px");v.css("display","block");v.css("position","relative");v.css("font-weight","700");c.css("border","0px");v.css("border-bottom","none");v.css("border-width","1px");v.css("color","#999");v.css("cursor","default");v.css("height","35px");v.css("margin-bottom","-1px");v.css("margin-right","5px");v.css("border-top-left-radius","3px");v.css("border-top-right-radius","3px");v.append(n.Msg.getMsg("InboxMailAttachment"));ot.append(v);y=t("<li>");y.css("float","left");y.css("margin","1px");y.css("padding","5px");y.css("display","block");y.css("position","relative");y.css("font-weight","700");c.css("border","0px");y.css("border-bottom","none");y.css("border-width","1px");y.css("color","#999");y.css("cursor","default");y.css("height","35px");y.css("margin-bottom","-1px");y.css("margin-right","5px");y.css("border-top-left-radius","3px");y.css("border-top-right-radius","3px");y.append(n.Msg.getMsg("SentMailAttachment"));ot.append(y);p=t("<li>");p.css("float","left");p.css("margin","1px");p.css("padding","5px");p.css("display","block");p.css("position","relative");p.css("font-weight","700");c.css("border","0px");p.css("border-bottom","none");p.css("border-width","1px");p.css("color","#999");p.css("cursor","default");p.css("height","35px");p.css("margin-bottom","-1px");p.css("margin-right","5px");p.css("border-top-left-radius","3px");p.css("border-top-right-radius","3px");p.append(n.Msg.getMsg("Letter"));ot.append(p);w=t("<li>");w.css("float","left");w.css("margin","1px");w.css("padding","5px");w.css("display","block");w.css("position","relative");w.css("font-weight","700");c.css("border","0px");w.css("border-bottom","none");w.css("border-width","1px");w.css("color","#999");w.css("cursor","default");w.css("height","35px");w.css("margin-bottom","-1px");w.css("margin-right","5px");w.css("border-top-left-radius","3px");w.css("border-top-right-radius","3px");w.append(n.Msg.getMsg("Appointments"));ot.append(w);et.append(ot);nt=t("<div>");nt.css("width","98%");nt.css("height","98%");nt.css("position","absolute");nt.css("border","0px");nt.css("margin-top","2px");g=t("<div>");g.css("width","100%");g.css("height","100%");g.css("position","absolute");nt.append(g);it=t("<div>");it.append("Inbox Mail Att");it.css("width","100%");it.css("height","100%");it.css("position","absolute");nt.append(it);rt=t("<div>");rt.append("SENT MAIL Att");rt.css("width","100%");rt.css("height","100%");rt.css("position","absolute");nt.append(rt);ut=t("<div>");ut.append("Leter Att");ut.css("width","100%");ut.css("height","100%");ut.css("position","absolute");nt.append(ut);ft=t("<div>");ft.append("Appointment Att");ft.css("width","100%");ft.css("height","100%");ft.css("position","absolute");nt.append(ft);l=t("<div class='vis-apanel-busy'>");l.css("width","100%");l.css("height","100%");l.css("text-align","center");l.css("position","absolute");nt.append(l);gt=t("<div style='width: 100%;height: 100%;background:black;opacity: .1;display:none; position:absolute;'>");nt.append(gt);bt=t("<div style='width: 100%;height: 100%;background:transparent;text-align: center;display:none ;vertical-align: middle;position:absolute;'>");nt.append(bt);st=null;st=n.Application.isRTL?t("<div id='progress_bar' class='vis-ui-progress-bar vis-ui-container' style='top:41%;width: 80%;right: 9%;'>"):t("<div id='progress_bar' class='vis-ui-progress-bar vis-ui-container' style='top:41%;width: 80%;left: 9%;'>");kt=t("<div class='vis-ui-progress' style='width: 0%; display: block;position:absolute'>");ni=t("<span class='vis-ui-label'  style='position:absolute'>").append("0%");kt.append(ni);st.append(kt);bt.append(st);et.append(nt);g[0].style.visibility="visible";it[0].style.visibility="hidden";rt[0].style.visibility="hidden";ut[0].style.visibility="hidden";ft[0].style.visibility="hidden";l[0].style.visibility="hidden";c.css("background","#fff");c.css("color","#0088CC");a=function(n,t){t?(n.css("background","#fff"),n.css("color","#0088CC")):(n.css("background","#eee"),n.css("color","#999"))};c.on("click",function(){g[0].style.visibility="visible";it[0].style.visibility="hidden";rt[0].style.visibility="hidden";ut[0].style.visibility="hidden";ft[0].style.visibility="hidden";l[0].style.visibility="hidden";a(c,!0);a(v,!1);a(y,!1);a(p,!1);a(w,!1);ei()});v.on("click",function(){g[0].style.visibility="hidden";it[0].style.visibility="visible";rt[0].style.visibility="hidden";ut[0].style.visibility="hidden";ft[0].style.visibility="hidden";l[0].style.visibility="hidden";a(c,!1);a(v,!0);a(y,!1);a(p,!1);a(w,!1)});y.on("click",function(){g[0].style.visibility="hidden";it[0].style.visibility="hidden";rt[0].style.visibility="visible";ut[0].style.visibility="hidden";ft[0].style.visibility="hidden";l[0].style.visibility="hidden";a(c,!1);a(v,!1);a(y,!0);a(p,!1);a(w,!1)});p.on("click",function(){g[0].style.visibility="hidden";it[0].style.visibility="hidden";rt[0].style.visibility="hidden";ut[0].style.visibility="visible";ft[0].style.visibility="hidden";l[0].style.visibility="hidden";a(c,!1);a(v,!1);a(y,!1);a(p,!0);a(w,!1)});w.on("click",function(){g[0].style.visibility="hidden";it[0].style.visibility="hidden";rt[0].style.visibility="hidden";ut[0].style.visibility="hidden";ft[0].style.visibility="visible";l[0].style.visibility="hidden";a(c,!1);a(v,!1);a(y,!1);a(p,!1);a(w,!0)});this.show=function(){g[0].style.visibility="visible";it[0].style.visibility="hidden";rt[0].style.visibility="hidden";ut[0].style.visibility="hidden";ft[0].style.visibility="hidden";l[0].style.visibility="hidden";a(c,!0);a(v,!1);a(y,!1);a(p,!1);a(w,!1);ei();et.dialog({width:841,height:502,title:n.Msg.getMsg("Attachment"),resizable:!1,modal:!0,close:li})};var at=t("<div style='width:100%;overflow: auto;margin-top: 5px;border-bottom: 2px solid #eee;display:none;float: left;'>"),b=[];var ai=function(){t.ajax({url:n.Application.contextUrl+"Attachment/GetAttachment",dataType:"json",data:{AD_Table_ID:u,Record_ID:f},error:function(){alert(n.Msg.getMsg("ERRORGettingAttachment"));l[0].style.visibility="hidden"},success:function(n){var t=n.result.Attachment,i;if(t!=null&&(r=t.AD_Attachment_ID),t!=null&&t._lines!=null){r=t.AD_Attachment_ID;for(i in t._lines)oi(t._lines[i],i)}l[0].style.visibility="hidden"}})},vi=function(i){for(var r=[],u,l,o,a,v,s,y,g,w,c,f,it,e=0;e<i.files.length;e++){if(file=i.files[e],file==undefined)return;if(file.name.indexOf("&")>-1||file.name.indexOf("?")>-1||file.name.indexOf("#")>-1||file.name.indexOf("/")>-1||file.name.indexOf("\\")>-1){r.push(file.name);continue}for(u in b)if(file.name==b[u].name){window.setTimeout(function(){alert(n.Msg.getMsg("fileAlreadyAttached"))},20);return}if(k!=null)for(u in k)if(file.name==k[u].Name&&!k[u].IsDeleted){window.setTimeout(function(){alert(n.Msg.getMsg("fileAlreadyAttached"))},20);return}l={};o=t("<div class='vis-attach-file-wrapla'>");d.append(o);a=t("<div class='vis-attach-file-top'>");v=t("<a class='vis-file-close-ico'>");a.append(v);o.append(a);d.show();at.show();v.on("click",function(){var n=t(t(this).parent()).parent(),r,i;n.css("display","none");r=n.html();n.empty();n=null;for(i in b)if(String(r).indexOf(b[i].name)>-1){b.splice(i,1);break}b.length>4?(d.css("height","153px"),tt.css("height","153px")):(d.css("height","97px"),tt.css("height","209px"));b.length==0&&(d.hide(),at.hide(),d.css("height","0px"),tt.css("height","356px"))});s=t("<div class='vis-attach-file-content'>");o.append(s);y=t("<div class='vis-attach-file-icon'>");g=ci(file.name);y.append(t("<img src='"+g+"'>"));s.append(y);var p=t("<div class='vis-attach-file-text' style='margin-bottom:10px'>"),nt="",h=t("<p>");file.name.length>17?(nt=file.name.toString().substr(0,17),h.append(nt),w=t("<a href='#' class='VIS_Pref_tooltip'>").append("..."),c=t("<span style='width: inherit;'>"),c.append(t("<img class='VIS_Pref_callout'>").attr("src",n.Application.contextUrl+"Areas/VIS/Images/ccc.png").append("ToolTip Text")),c.append(t("<label class='VIS_Pref_Label_Font'>").append(file.name)),w.append(c),h.append(w)):h.append(file.name);p.append(h);p.append(t("<p>").append((Number(file.size)/1024).toFixed(2)+"KB"));s.append(p);l.Name=file.name;l.Size=file.size;b.push(file);b.length>4?(d.css("height","153px"),tt.css("height","153px")):(d.css("height","97px"),tt.css("height","209px"))}if(r.length>0){f="";for(it in r)f+=r[it].toString()+"\n";f+=r.length==1?"File has":"Files have";f+=" invalid name. Please change the file name and try again.";alert(f)}},k=[],oi=function(i,r){var w=t("<div class='vis-attach-file-wrap'>"),u,f,c,v,o,h,y,p;tt.append(w);u={};f=t("<div class='vis-attach-file-content'  style='padding-top:5px;padding-bottom:5px;'>");w.append(f);c=t("<div class='vis-attach-file-icon'>");c.append(t("<img src='"+ci(i.FileName)+"'>"));f.append(c);var a=t("<div class='vis-attach-file-text'>"),b="",e=t("<p>");i.FileName.length>17?(b=i.FileName.toString().substr(0,17),e.append(b),v=t("<a href='#' class='VIS_Pref_tooltip'>").append("..."),o=t("<span style='width: inherit;'>"),o.append(t("<img class='VIS_Pref_callout'>").attr("src",n.Application.contextUrl+"Areas/VIS/Images/ccc.png").append("ToolTip Text")),o.append(t("<label class='VIS_Pref_Label_Font'>").append(i.FileName)),v.append(o),e.append(v)):e.append(i.FileName);a.append(e);a.append(t("<p>").append((Number(i.Size)/1024).toFixed(2)+"KB"));f.append(a);h=t("<div class='vis-attach-BottomRight'>");y=t("<a href='javascript:void(0)'  class='vis-attach-ico vis-download-ico' data-id='"+r+"'>");h.append(y);y.on("click",function(){var n=t(this).data("id");k[n].HaveSource?window.open(k[r].Source,"_blank"):pi(n,this)});p=t("<a class='vis-attach-ico vis-delete-ico' data-id='"+r+"'>");h.append(p);p.on("click",function(){if(s)return!1;if(n.ADialog.ask("DeleteRecord?")){var i=t(this).data("id"),r=t(this);l[0].style.visibility="visible";t.ajax({url:n.Application.contextUrl+"Attachment/DeleteAttachment",dataType:"json",data:{AttachmentLines:k[i].Line_ID},error:function(){alert(n.Msg.getMsg("ERRORDeletingFile"));l[0].style.visibility="hidden"},success:function(n){if(n.result==-1)alert("ErrorDeletingFile");else{var t=r.parent().parent().parent();t.css("display","none");t.empty();t=null;k[i].IsDeleted=!0}l[0].style.visibility="hidden"}})}});f.append(h);u.Name=i.FileName;u.Size=i.Size;u.Line_ID=i.Line_ID;u.HaveSource=!1;u.Source=null;u.IsDeleted=!1;k.push(u)},ti=0,ht=0,si=Date.now().toString(),ct=1048576,ii=0,vt=0,yt=[],yi=function(){var n=null,t,r,i;dt(!0);t=0;r=0;for(i in b)t=parseInt(b[i].size/ct),file.size%ct>0&&t++,ii+=t,n={},n.Name=b[i].name,n.Size=b[i].size,yt.push(n);hi()},hi=function(){var i,e,s;if(b==null||b.length==0){dt(!1);alert("NothingToUpload");return}if(ht>=b.length){t.ajax({url:n.Application.contextUrl+"Attachment/SaveAttachmentEntries",dataType:"json",type:"POST",data:{files:JSON.stringify(yt),AD_Attachment_ID:r,folderKey:si,AD_Table_ID:u,Record_ID:f,fileLocation:lt.val(),NewRecord_ID:o,IsDMSAttachment:h},error:function(){dt(!1);yt=[];l[0].style.visibility="hidden"},success:function(n){var u=n.result.Error,i,f,r;u==""?(h&&(i=t(".vis-old-attachments").find(".vis-attach-file-wrap"),i.length>1&&t(i[0]).remove()),ri(100),window.setTimeout(function(){dt(!1)},500),yt=[],f="transfer",r={},r={to:tt,className:"vis-Att-ui-effects-transfer"},d.effect(f,r,500,function(){window.setTimeout(function(){k=[];tt.empty();ai();b=[];d.empty();d.hide();at.hide();d.css("height","0px");tt.css("height","356px");kt.css("width","O%")},500)})):(yt=[],dt(!1),alert(u));ti=0;ht=0;ii=0;vt=0;l[0].style.visibility="hidden"}});return}i=new XMLHttpRequest;e=new FormData;e.append("file",b[ht].slice(vt*ct,vt*ct+Number(ct)));i.open("POST",n.Application.contextUrl+"Attachment/SaveFileinTemp/?filename="+b[ht].name+"&folderKey="+si,!1);i.send(e);ti++;vt++;s=parseInt(b[ht].size/ct);b[ht].size%ct>0&&s++;vt==s&&(ht++,vt=0);ti<=ii&&ri(parseInt(ti/ii*80));window.setTimeout(function(){hi()},2)},dt=function(n){n?(gt.show(),st.show(),bt.show()):(gt.hide(),st.hide(),bt.hide())},wi=function(t,i,r,u,f){var o,c,e,s,h;for(progresBar.attr("value",0),o=parseInt(t.size/r),t.size%r>0&&o++,c=!1,e=0;e<o;e++)e==o-1&&t.size%r>0&&(r=t.size%r),c=!0,s=new XMLHttpRequest,h=new FormData,h.append("file",t.slice(e*r,e*r+Number(r))),s.open("POST",n.Application.contextUrl+"Attachment/SaveFileinTemp/?filename="+t.name+"&folderKey="+i,!1),s.send(h),u++,ri(parseInt(u/f*80))},pi=function(i){l[0].style.visibility="visible";t.ajax({url:n.Application.contextUrl+"Attachment/DownloadAttachment",dataType:"json",data:{fileName:k[i].Name,AD_Attachment_ID:r,AD_AttachmentLine_ID:k[i].Line_ID},error:function(){alert(n.Msg.getMsg("ERRORGettingFile"));l[0].style.visibility="hidden"},success:function(t){var u=new Date,f=t.result,r=n.Application.contextUrl+"TempDownload/"+f+"/"+k[i].Name+"?"+u.getTime(),e=k[i].Name;k[i].HaveSource=!0;l[0].style.visibility="hidden";window.open(r,"_blank");k[i].Source=r}})},bi=function(){iFrame!=null&&(iFrame.css("visibility","visible"),viewer.css("visibility","visible"),g.css("visibility","collapse"))},ri=function(n){kt.css("width",n+"%");ni.empty();ni.append(n+"%")},ki=function(n){return st.each(function(){t(this).animate({width:n+"%"},{duration:2e3,easing:"swing",step:function(n){var i=t(".ui-label",this),r=t(".value",i);Math.ceil(n)<20&&t(".ui-label",this).is(":visible")?i.hide():i.is(":hidden")&&i.fadeIn();Math.ceil(n)==100?(i.text("Done"),setTimeout(function(){i.fadeOut()},1e3)):r.text(Math.ceil(n)+"%")}})})},ci=function(t){var r,u,i;return t==null||t.length==0?"":(r=t.lastIndexOf("."),u=n.Application.contextUrl+"Areas/VIS/Images/",r<1)?u+"defult.png":(i=t.substr(r,t.length-r),u+(i==".xlsx"||i==".xls"?"excel.png":i==".html"||i==".htm"?"html.png":i==".pdf"?"pdf.png":i==".ppt"?"ppt.png":i==".txt"?"text.png":i==".docx"||i==".doc"?"word.png":i==".xml"?"xml.png":i==".jpg"||i==".gif"||i==".png"?"image.png":i==".mp3"?"audio.png":i==".zip"||i==".rar"?"compresed.png":"defult.png"))}}n.attachmentForm=i}(VIS,jQuery),function(n,t){function i(i,r){var f=null,u=[],o=[],s=null;this.Load=function(r){t("#divTabMenuDataLoder").show();t.ajax({url:n.Application.contextUrl+"WFActivity/GetActivities",data:{pageNo:1,pageSize:10,refresh:r},dataType:"json",type:"POST",error:function(){t("#divTabMenuDataLoder").hide();n.HomeMgr.BindMenuClick();return},success:function(e){n.HomeMgr.BindMenuClick();var s=n.HomeMgr.getActiveTab();if(s.activeTabType==3){if(e.result==null||e.result.LstInfo==null){t("#divTabMenuDataLoder").hide();t("#divfActivity").empty();t("#divfActivity").append(0);t("#hAlrtTxtTypeCount").empty();t("#hAlrtTxtTypeCount").append(0);str="<p style=' margin-top:150px;text-align: center'>"+n.Msg.getMsg("NoRecordFound")+"!!!<\/p>";i.append(str);return}f=e.result.LstInfo;i.empty();r==!0&&(o=[],u=[],t("#divfActivity").empty(),t("#divfActivity").append(e.result.count),t("#hAlrtTxtTypeCount").empty(),t("#hAlrtTxtTypeCount").append(e.result.count));h(0);n.HomeMgr.adjustDivSize()}else return}})};this.AppendRecord=function(i,r){t("#divTabMenuDataLoder").show();t.ajax({url:n.Application.contextUrl+"WFActivity/GetActivities",data:{pageNo:i,pageSize:r,refresh:!1},dataType:"json",type:"POST",error:function(){t("#divTabMenuDataLoder").hide();n.HomeMgr.BindMenuClick();return},success:function(t){n.HomeMgr.BindMenuClick();var r=n.HomeMgr.getActiveTab();if(r.activeTabType==3)f=t.result.LstInfo,h(i-1),n.HomeMgr.adjustDivSize();else return}})};var h=function(r){var e,h,y,l,p,v,nt,w;if(f==null||f.length==0){t("#divTabMenuDataLoder").hide();return}for(e in f){u.push(f[e]);h={};s=t("<div class='vis-activityContainer' data-id='"+(Number(10*r)+Number(e))+"'>");s.on("click",function(n){var r,i;if(t(".vis-activityContainer").removeClass("vis-activeFeed"),t(this).addClass("vis-activeFeed"),r=t(n.target).data("viswfazoom"),r=="wfZoom"){t(this).addClass("vis-activeFeed");i=t(n.target).data("index");c(i);return}i=t(this).data("id");a(o[i].wfActivityID,i,this)});y=t("<div class='vis-feedTitleBar'>");l=t("<h3>");l.css("font-weight","normal");l.css("color","#1b95d7");l.append(n.Utility.encodeText(f[e].NodeName));y.append(l);var b=t("<div class='vis-feedTitleBar-buttons'>"),k=t("<ul>"),d=t("<li>"),g=t("<a href='javascript:void(0)' class='vis-feedIcons vis-icon-viewFeed' data-index='"+(Number(10*r)+Number(e))+"' data-viswfazoom='wfZoom' >");g.append("View Feed");d.append(g);k.append(d);b.append(k);y.append(b);s.append(y);p=t("<div class='vis-feedDetails'>");v=t("<p>");v.append(n.Utility.encodeText(f[e].Summary));nt=t("<br>");v.append(nt);v.append(n.Utility.encodeText(n.Msg.getMsg("Priority")+" "+f[e].Priority));p.append(v);w=t("<div class='vis-feedDateTime'>");w.append(t("<br>")).append(Globalize.format(new Date(f[e].Created),"d"));p.append(w);s.append(p);i.append(s);h.ctrl=s;h.index=e;h.recordID=f[e].Record_ID;h.wfActivityID=f[e].AD_WF_Activity_ID;o.push(h)}t("#divTabMenuDataLoder").hide()},l=function(){var i=t(window).width(),r=t(".row.scrollerHorizontal > div").length,u,n,f;r=r-1;t(".scrollerHorizontal").width(i);u=i/r-20;n=parseInt(u);i>=1366&&(t("#workflowActivity").css("display")=="none"?(t("#fllupsScreen").css("left",n+20),t("#favLinks").css("left",n*2+40),t("#welcomeScreen,#fllupsScreen,#favLinks").width(n)):t("#workflowActivity").css("display")=="block"&&(f=i+n+20,t(".scrollerHorizontal").width(f),t("#workflowActivity").css("left",n+20),t("#fllupsScreen").css("left",n*2+40),t("#favLinks").css("left",n*3+60),t("#welcomeScreen,#fllupsScreen,#favLinks,#workflowActivity").width(n)))},e=[],a=function(i,f,e){t("#divTabMenuDataLoder").show();t.ajax({url:n.Application.contextUrl+"WFActivity/GetActivityInfo",dataType:"json",type:"POST",data:{activityID:i,nodeID:u[f].AD_Node_ID,wfProcessID:u[f].AD_WF_Process_ID},error:function(){t("#divTabMenuDataLoder").hide();return},success:function(u){t("#workflowActivity").show();n.HomeMgr.adjustDivSize();var s="transfer",o={};o={to:r,className:"wsp-ui-effects-transfer"};window.setTimeout(function(){v(i,f,u.result);t(e).effect(s,o,500,function(){})},400)}})},v=function(i,f,o){var s={},rt,at,ut,vt,ft,et,tt,yt,pt,wt,bt,ht,b,k,ct,ti,it,h,kt,ot,st,dt,gt,d,ni,l,lt,a,g,v,nt;e=[];s.Index=f;r.empty();rt=t("<div class='vis-workflowActivityDetails-Heading'>");r.append(rt);at=t("<h3>");at.append(n.Msg.getMsg("Detail"));rt.append(at);ut=t("<a href='javascript:void(0)' class='vis-btn-zoom vis-icon-zoomFeedButton  vis-workflowActivityIcons' data-id='"+f+"'>");ut.append(t("<span class='vis-btn-ico vis-btn-zoom-bg vis-btn-zoom-border'>"));ut.append(n.Msg.getMsg("Zoom"));rt.append(ut);ut.on(n.Events.onTouchStartOrClick,function(){var n=t(this).data("id");c(n)});if(rt.append(t("<div class='clearfix'>")),vt=t("<ul class='vis-IIColumnContent'>"),r.append(vt),ft=t("<li>"),ft.css("width","100%"),et=t("<p>"),et.append(n.Msg.getMsg("Node")),et.append(t("<br>")),et.append(n.Utility.encodeText(u[f].NodeName)),ft.append(et),vt.append(ft),tt=t("<p>"),tt.css("margin-top","10px"),tt.append(n.Msg.getMsg("Summary")),tt.append(t("<br>")),tt.append(n.Utility.encodeText(u[f].Summary)),ft.append(tt),r.append(t("<div class='clearfix'>")),yt=t("<h4>"),yt.append(n.Msg.getMsg("Description")),r.append(yt),pt=t("<p>"),pt.append(n.Utility.encodeText(u[f].Description)),r.append(pt),r.append(t("<div class='clearfix'>")),wt=t("<h4>"),wt.append(n.Msg.getMsg("Help")),r.append(wt),bt=t("<p>"),bt.append(n.Utility.encodeText(u[f].Help)),r.append(bt),r.append(t("<h3>").append(n.Msg.getMsg("Action"))),r.append(t("<div class='clearfix'>")),ht=t("<ul class='vis-IIColumnContent'>"),b=t("<li>"),ht.append(b),b.append(t("<p>").append(n.Msg.getMsg("Answer"))),o.NodeAction=="C")k=p(o,i),s.AnswerCtrl=k,k!=null&&(k.getBtnCount()>0?(h=t("<div>"),h.append(k.getControl().css("width","86%").css("margin-bottom","10px")),h.append(k.getBtn(0).css("width","14%").css("height","29px").css("padding","0px").css("border-color","#BBBBBB")),b.append(h)):b.append(k.getControl()),s.AnswerCtrl=k),s.Action="C";else if(o.NodeAction=="W"){ct=t('<button style="margin-bottom:10px;margin-top: 0px;width: 100%;" class="VIS_Pref_pass-btn" data-id="'+f+'" data-window="'+o.AD_Window_ID+'" data-col="'+o.KeyCol+'">').append(o.NodeName);s.AnswerCtrl=ct;b.append(ct);ct.on("click",function(){w(t(this).data("id"),t(this).data("window"),t(this).data("col"))});s.Action="W"}b.append(t("<p>").append(n.Msg.getMsg("Forward")));ti=n.MLookupFactory.get(n.context,0,0,n.DisplayType.Search,"AD_User_ID",0,!1,null);it=new n.Controls.VTextBoxButton("AD_User_ID",!1,!1,!0,n.DisplayType.Search,ti);s.FwdCtrl=it;it.getBtn();it.getBtnCount()==2&&(h=t("<div>"),h.append(it.getControl().css("width","86%").css("margin-bottom","10px")),h.append(it.getBtn(0).css("width","14%").css("height","29px").css("padding","0px").css("border-color","#BBBBBB")),b.append(h));kt=t("<li>");ot=t("<a href='javascript:void(0)' class='vis-btn vis-btn-done vis-icon-doneButton vis-workflowActivityIcons' data-id='"+f+"'>");ot.append(t("<span class='vis-btn-ico vis-btn-done-bg vis-btn-done-border'>"));ot.append(n.Msg.getMsg("Done"));kt.append(ot);ot.on(n.Events.onTouchStartOrClick,function(){var n=t(this).data("id");y(n)});if(ht.append(kt),r.append(ht),r.append(t("<div class='clearfix'>")),r.append(t("<p>").append(n.Msg.getMsg("Message"))),r.append(t("<div class='clearfix'>")),st=t("<div class='vis-sendMessage'>"),dt=t("<input type='text' placeholder='"+n.Msg.getMsg("TypeMessage")+"....'>"),s.MsgCtrl=dt,st.append(dt),st.append(t("<input  type='button' class='vis-feedIcons vis-icon-message'>")),st.append(t("<div class='clearfix'>")),r.append(st),r.append(t("<h3>").append(n.Msg.getMsg("History"))),r.append(t("<div class='clearfix'>")),gt=t("<div class='vis-history-wrap'>"),r.append(gt),e.push(s),o.Node!=null){d=t("<div style='margin-top:15px;margin-bottom:15px'>");for(node in o.Node)if(o.Node[node].History!=null){for(hNode in o.Node[node].History)o.Node[node].History[hNode].State=="CC"&&node<o.Node.length-1?(d.append(t("<div class='vis-vertical-img'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/home/4.jpg'>"))),l=t("<div class='vis-approved_wrap'>"),ni="",ni=o.Node[node].Name,a=t("<div class='vis-left-part'>"),o.Node[node].History[hNode].TextMsg.length>0&&(g=t("<a href='javascript:void(0)' class='VIS_Pref_tooltip' style='margin-right:5px'>").append(t("<img class='VIS_Pref_img-i'>").attr("src",n.Application.contextUrl+"Areas/VIS/Images/i.png")),v=t("<span>"),v.append(t("<img class='VIS_Pref_callout'>").attr("src",n.Application.contextUrl+"Areas/VIS/Images/ccc.png").append("ToolTip Text")),v.append(t("<label class='VIS_Pref_Label_Font'>").append(o.Node[node].History[hNode].TextMsg)),g.append(v),a.append(g)),a.append(ni),l.append(a),nt=t("<div class='vis-right-part'>"),nt.append(n.Msg.getMsg("CompletedBy")).append(t("<span class='vis-app_by'>").append(o.Node[node].History[hNode].ApprovedBy)),l.append(nt),d.append(l)):node<o.Node.length-1||o.Node.length==1?(l=t("<div class='vis-pending_wrap' style='margin-top:-2px'>"),l.append(t("<div class='vis-left-part'>").append(o.Node[node].Name)),l.append(t("<div class='vis-right-part'>").append(n.Msg.getMsg("Pending"))),d.append(l)):(d.append(t("<div class='vis-vertical-img'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/home/4.jpg'>"))),lt=t("<div class='vis-start_wrap' style='margin-bottom:-8px'>"),a=t("<div class='vis-left-part'>"),o.Node[node].History[hNode].TextMsg.length>0&&(g=t("<a href='javascript:void(0)' class='VIS_Pref_tooltip' style='margin-right:5px'>").append(t("<img class='VIS_Pref_img-i'>").attr("src",n.Application.contextUrl+"Areas/VIS/Images/i.png")),v=t("<span >"),v.append(t("<img class='VIS_Pref_callout'>").attr("src",n.Application.contextUrl+"Areas/VIS/Images/ccc.png").append("ToolTip Text")),v.append(t("<label class='VIS_Pref_Label_Font'>").append(o.Node[node].History[hNode].TextMsg)),g.append(v),a.append(g)),a.append(o.Node[node].Name),lt.append(a),nt=t("<div class='vis-right-part'>"),nt.append(n.Msg.getMsg("CompletedBy")).append(t("<span class='vis-app_by'>").append(o.Node[node].History[hNode].ApprovedBy)),lt.append(nt),d.append(lt));gt.append(d)}}t("#divTabMenuDataLoder").hide()},c=function(t){var f="SELECT TableName, AD_Window_ID, PO_Window_ID FROM AD_Table WHERE AD_Table_ID="+u[t].AD_Table_ID,e=-1,o="",i,r;try{i=n.DB.executeDataReader(f);i.read()&&(e=i.getInt(1),o=i.get(0));i.dispose()}catch(s){this.log.log(n.Logging.Level.SEVERE,f,s)}r=new n.Query;r.addRestriction(o+"_ID",n.Query.prototype.EQUAL,u[t].Record_ID);n.viewManager.startWindow(e,r)},y=function(r){t("#divfeedbsy")[0].style.visibility="visible";window.setTimeout(function(){var s,c,a;for(s in e)try{if(r===e[s].Index){var v=e[s].FwdCtrl.getValue(),y=e[s].MsgCtrl.val(),c=null;e[s].Action=="C"&&(c=e[s].AnswerCtrl.getValue());a=n.dataContext.getJSONData(n.Application.contextUrl+"WFActivity/ApproveIt",{activityID:u[r].AD_WF_Activity_ID,nodeID:u[r].AD_Node_ID,txtMsg:y,fwd:v,answer:c}).result;a==""?(t("#divfeedbsy")[0].style.visibility="hidden",t("#workflowActivity").hide(),i.empty(),l(),t("#divTabMenuDataLoder").show(),t.ajax({url:n.Application.contextUrl+"WFActivity/GetActivities",dataType:"json",type:"POST",data:{pageNo:1,pageSize:10,refresh:!0},error:function(){t("#divTabMenuDataLoder").hide();return},success:function(r){if(e=[],n.HomeMgr.getActiveTab().activeTabType==3){if(r.result==null||r.result.LstInfo==null){t("#divTabMenuDataLoder").hide();t("#divfActivity").empty();t("#divfActivity").append(0);t("#hAlrtTxtTypeCount").empty();t("#hAlrtTxtTypeCount").append(0);return}f=r.result.LstInfo;i.empty();o=[];u=[];t("#divfActivity").empty();t("#divfActivity").append(r.result.count);t("#hAlrtTxtTypeCount").empty();t("#hAlrtTxtTypeCount").append(r.result.count);h(0);n.HomeMgr.adjustDivSize()}}})):alert(a);break}}catch(p){alert("FillManadatory")}t("#divfeedbsy")[0].style.visibility="hidden"},2)},p=function(i,r){var f,e,u;return i.ColID==0?null:i.ColReference==n.DisplayType.YesNo?(u=n.MLookupFactory.get(n.context,0,0,n.DisplayType.List,i.ColName,319,!1,null),new n.Controls.VComboBox(i.ColName,!1,!1,!0,u,50)):i.ColReference==n.DisplayType.List?(u=n.MLookupFactory.get(n.context,0,0,n.DisplayType.List,i.ColName,i.ColReferenceValue,!1,null),new n.Controls.VComboBox(i.ColName,!1,!1,!0,u,50)):i.ColName.toUpperCase()=="C_GENATTRIBUTESETINSTANCE_ID"?(f=null,e=new n.MGAttributeLookup(n.context,0),t.ajax({url:n.Application.contextUrl+"WFActivity/GetRelativeData",async:!1,data:{activityID:r},dataType:"json",success:function(t){t.result&&(f=new n.Controls.VPAttribute("C_GenAttributeSetInstance",!0,!1,!0,n.DisplayType.PAttribute,e,0,!0,!1,!1,!1),f.SetC_GenAttributeSet_ID(t.result.GenAttributeSetID))}}),f):i.ColReference==n.DisplayType.TableDir?(u=n.MLookupFactory.get(n.context,0,0,n.DisplayType.TableDir,i.ColName,i.ColReferenceValue,!1,null),new n.Controls.VComboBox(i.ColName,!1,!1,!0,u,50)):i.ColReference==n.DisplayType.Search?(u=n.MLookupFactory.get(n.context,0,0,n.DisplayType.Search,i.ColName,i.ColReferenceValue,!1,null),new n.Controls.VTextBoxButton(i.ColName,!1,!1,!0,n.DisplayType.Search,u)):new n.Controls.VTextBox(i.ColName,!1,!1,!0,50,100,null,null,!1)},w=function(t,i,r){var f=new n.Query;f.addRestriction(r,n.Query.prototype.EQUAL,u[t].Record_ID);n.viewManager.startWindow(i,f)};this.clear=function(){for(var n in o)o[n]=null}}n.wfActivity=i}(VIS,jQuery),function(n,t){function i(i,r,u){function rt(){st();ht();ut();ft(u)}function ut(){var f,t,c,i;f=n.Env.isBaseLanguage(y,"AD_Ref_List")?"SELECT Value, Name, Description FROM AD_Ref_List WHERE AD_Reference_ID=135 ORDER BY Name":"SELECT l.Value, t.Name, t.Description FROM AD_Ref_List l, AD_Ref_List_Trl t WHERE l.AD_Ref_List_ID=t.AD_Ref_List_ID AND t.AD_Language='"+n.Env.getAD_Language(y)+"' AND l.AD_Reference_ID=135 ORDER BY t.Name";var u=[],e=[],o=[];try{for(t=n.DB.executeReader(f,null);t.read();){var l=t.get(0),v=t.get(1),r=t.get(2);(r==null||r=="undefined")&&(r="");u.push(l);e.push(v);o.push(r)}t.Close();t.dispose()}catch(p){t!=null&&t.close()}finally{t!=null&&t.close()}for(c=u.length,s=[],h=[],a=[],i=0;i<c;i++)s.push(u[i]),h.push(e[i]),a.push(o[i])}function ft(u){var e,f,o,c;p=r.getValue("DocStatus");e=r.getValue("DocAction");f=r.getValue("Processing");f=f=="N"?!1:!0;o=y.getWindowContext(i,"OrderType");c=y.isSOTrx(i);t.ajax({url:n.Application.contextUrl+"DocAction/GetDocActions",type:"POST",dataType:"Json",data:{AD_Table_ID:d,Record_ID:u,docStatus:p,processing:f,orderType:o,isSOTrx:c,docAction:e,tableName:r.getTableName(),values:JSON.stringify(s),names:JSON.stringify(h)},success:function(n){var t=JSON.parse(n);et(t);ot(t)}})}function et(t){if(k(!1),p=t.DocStatus,t.Error!=null&&t.Error!=""&&t.Error!="undefined"){n.ADialog.error(t.Error);return}if(t.DocStatus==null){v.text("*** ERROR ***");return}}function ot(t){for(var u,i,r=0;r<t.Index;r++)for(u=!1,i=0;i<s.length&&!u;i++)t.Options[r].equals(s[i])&&(e.append("<option >"+h[i]+"<\/option>"),u=!0);if(t.DefaultV!=null&&t.DefaultV!=""&&t.DefaultV!="undefined"&&e.val(t.DefaultV).change(),c.prop("disable",!1),o.getNumberOfOptions()==0){n.ADialog.info("Info DocAction - No Options","");o.log.info("DocAction - No Options");f.close();return}}function st(){var u=t("<tr>"),o=t("<tr>"),s=t("<tr>"),i=t("<td>"),h=t("<td>"),r;n.Application.isRTL?i.append('<span style="margin-right:3px">'+n.Msg.getMsg("DocAction")+"<\/span>"):i.append("<span >"+n.Msg.getMsg("DocAction")+"<\/span>");h.append(e);u.append(i).append(h);r=t('<td colspan="2">');r.append(v);o.append(r);$td31=t("<td>");$td32=t('<td style="text-align:right">');s.append($td31).append($td32);l.append(u).append(o).append(s);c.append(l);k(!0);c.append(w).append(b);f=new n.ChildDialog}function ht(){e.on("change",function(){var n=g();n!=-1&&a.length>0&&v.text(a[n])});f.onOkClick=function(){ct()&&(o.isOKPressed=!0,o.onClose&&o.onClose())};f.onCancelClick=function(){o.onClose&&o.onClose()}}function k(n){n?(w.show(),b.show(),c.find("button").prop("disabled",!0)):(w.hide(),b.hide(),c.find("button").prop("disabled",!1))}function g(){var t=-1,i,n;if(e.val()==null)return t;for(i=e.val(),n=0;n<h.length&&t==-1;n++)if(i.equals(h[n])){t=n;break}return t}function ct(){k(!0);var n=g();return n==-1?(k(!1),!1):(r.setValue("DocAction",s[n]),!0)}var y=n.Env.getCtx(),d=r.getAD_Table_ID(),s=[],h=[],a=[],p=null,nt=0,tt="",l,f,w,b;this.log=n.Logging.VLogger.getVLogger("VDocAction");var it,e=t('<select style="width:235px;margin-left:10px"><\/select>'),v=t('<p style="font-size:12px;margin-top:10px;margin-bottom:-5px"><\/p>'),c=t('<div style="margin-bottom:-5px"><\/div>'),o=this;this.batch=!1;this.isOKPressed=!1;l=t('<table style="width:360px;margin-bottom:9px">');f=null;this.onClose=null;w=t('<img src="'+n.Application.contextUrl+'Areas/VIS/Images/busy.gif"/>');b=t("<label>"+n.Msg.getMsg("Loading")+"<\/label>");n.Application.isRTL&&(e.css({"margin-left":"0px","margin-right":"10px"}),v.css({"margin-right":"3px"}));rt();this.getNumberOfOptions=function(){return e.children("option").length};this.isStartProcess=function(){return this.isOKPressed};this.isBatch=function(){return this.batch};this.show=function(){f.setContent(c);f.setTitle(n.Msg.getMsg("DocAction"));f.setModal(!0);f.show()};f.onClose=function(){o.dispose()};this.dispose=function(){f.close();f=null;d=null;s=null;h=null;a=null;p=null;nt=0;tt=null;it=null;e=null;v=null;c=null;o=null;l&&l.empty();l=null}}function r(){this.ACTION_COMPLETE="CO";this.ACTION_WAITCOMPLETE="WC";this.ACTION_APPROVE="AP";this.ACTION_REJECT="RJ";this.ACTION_POST="PO";this.ACTION_VOID="VO";this.ACTION_CLOSE="CL";this.ACTION_REVERSE_CORRECT="RC";this.ACTION_REVERSE_ACCRUAL="RA";this.ACTION_REACTIVATE="RE";this.ACTION_NONE="--";this.ACTION_PREPARE="PR";this.ACTION_UNLOCK="XL";this.ACTION_INVALIDATE="IN";this.ACTION_REOPEN="OP";this.STATUS_DRAFTED="DR";this.STATUS_COMPLETED="CO";this.STATUS_APPROVED="AP";this.STATUS_INVALID="IN";this.STATUS_NOTAPPROVED="NA";this.STATUS_VOIDED="VO";this.STATUS_REVERSED="RE";this.STATUS_CLOSED="CL";this.STATUS_UNKNOWN="??";this.STATUS_INPROGRESS="IP";this.STATUS_WAITINGPAYMENT="WP";this.STATUS_WAITINGCONFIRMATION="WC"}n.VDocAction=i;n.DocumentEngine=r}(VIS,jQuery),function(n,t){function i(){function n(n,i,r,u,f){if(window.WSP){var e=t("<div id='divAptBusy' class='wsp-busy-indicater'><\/div>");t("body").append(e);f==!1?(e.show(),WSP.AppointmentsForm.init(n,i,r,u,e)):(e.show(),WSP.TaskForm.init(n,i,r,u,e))}else alert("please download WSP !!!")}return{init:n}}n.AppointmentsForm=i()}(VIS,jQuery),function(n,t){function i(i,r,u){function fu(){var r=t("<div><\/div>"),dt=null,i,u,e,a,v,y,b,ft,vt,yt;dt=n.Application.isRTL?t('<p class="vis-payment-spanPayment-RTL"> '+n.Msg.translate(f,"PaymentMethod")+" <\/p>"):t('<p class="vis-payment-spanPayment"> '+n.Msg.translate(f,"PaymentMethod")+" <\/p>");dt.appendTo(r);p=t('<select class="vis-payment-cmbPayment"><\/select>');p.appendTo(r);r.appendTo(k);lt=t('<table class="vis-payment-table"><\/table>');i=t("<tr><\/tr>");lt.append(i);nr=t('<p class="vis-payment-span"> '+n.Msg.translate(f,"CreditCardType")+"<\/p>");tr=t('<p class="vis-payment-span">'+n.Msg.translate(f,"CreditCardNumber")+"<\/p>");ir=t('<p class="vis-payment-span">'+n.Msg.translate(f,"Expires")+"<\/p>");ur=t('<p class="vis-payment-span">'+n.Msg.translate(f,"VoiceAuthCode")+"<\/p>");pt=t('<p class="vis-payment-span">'+n.Msg.translate(f,"Online")+"<\/p>");wi=t('<p class="vis-payment-span"><\/p>');s=t('<table class="vis-payment-table"><\/table>');u=t("<tr><\/tr>");s.append(u);ut=t('<table class="vis-payment-table"><\/table>');u.append(ut);i.append(s);g=t('<select  class="vis-payment-cmb"><\/select>');var gt=t("<tr><\/tr>"),ii=t("<td ><\/td>"),ri=t('<td class="vis-payment-td2"><\/td>');ii.append(nr);ri.append(g);gt.append(ii).append(ri);ut.append(gt);d=t('<input class="vis-payment-inputs" type="text"><\/input>');var hi=t("<tr><\/tr>"),ci=t('<td class="vis-payment-td1"><\/td>'),li=t('<td class="vis-payment-td2"><\/td>');ci.append(tr);li.append(d);hi.append(ci).append(li);ut.append(hi);wt=t('<input class="vis-payment-inputs"  type="text"><\/input>');var ai=t("<tr><\/tr>"),vi=t('<td class="vis-payment-td1"><\/td>'),yi=t('<td class="vis-payment-td2"><\/td>');vi.append(ir);yi.append(wt);ai.append(vi).append(yi);ut.append(ai);bt=t('<input class="vis-payment-inputs"  type="text"><\/input>');var pi=t("<tr><\/tr>"),ar=t('<td class="vis-payment-td1"><\/td>'),vr=t('<td class="vis-payment-td2"><\/td>');ar.append(ur);vr.append(bt);pi.append(ar).append(vr);ut.append(pi);pt=t('<button class="vis-payment-inputs-buttons"  type="button">'+n.Msg.translate(f,"Online")+"<\/button>");e=t("<tr><\/tr>");a=t('<td colspan="2"><\/td>');a.append(pt);e.append(a);ut.append(e);rr=t('<p class="vis-payment-span"> '+n.Msg.translate(f,"C_BP_BankAccount_ID")+"<\/p>");bi=t('<p class="vis-payment-span"> <\/p>');h=t('<table class="vis-payment-table"><\/table>');v=t("<tr><\/tr>");si=t('<table class="vis-payment-table"><\/table>');h.append(v);v.append(si);i.append(h);et=t('<select class="vis-payment-cmb"><\/select>');var yr=t("<tr><\/tr>"),pr=t('<td class="vis-payment-td1"><\/td>'),wr=t('<td class="vis-payment-td2"><\/td>');pr.append(rr);wr.append(et);yr.append(pr).append(wr);si.append(yr);cr=t('<p class="vis-payment-span"> '+n.Msg.translate(f,"C_BankAccount_ID")+"<\/p>");gi=t('<p class="vis-payment-span"> '+n.Msg.translate(f,"Amount")+"<\/p>");ti=t('<p class="vis-payment-span vis-payment-AmountField"> <\/p>');er=t('<p class="vis-payment-span"> '+n.Msg.translate(f,"RoutingNo")+"<\/p>");fr=t('<p class="vis-payment-span"> '+n.Msg.translate(f,"AccountNo")+"<\/p>");hr=t('<p class="vis-payment-span"> '+n.Msg.translate(f,"CheckNo")+"<\/p>");ui=t('<p class="vis-payment-span"> '+n.Msg.translate(f,"C_Currency_ID")+"<\/p>");ki=t('<p class="vis-payment-span"> <\/p>');ei=t('<button class="vis-payment-inputs-buttons"  type="button">'+n.Msg.translate(f,"Online")+"<\/button>");c=t('<table class="vis-payment-table"><\/table>');y=t("<tr><\/tr>");w=t('<table class="vis-payment-table"><\/table>');y.append(w);c.append(y);i.append(c);nt=t('<select class="vis-payment-cmb"><\/select>');var br=t("<tr><\/tr>"),kr=t('<td class="vis-payment-td1"><\/td>'),dr=t('<td class="vis-payment-td2"><\/td>');kr.append(cr);dr.append(nt);br.append(kr).append(dr);w.append(br);ti=t('<p class="vis-payment-span vis-payment-AmountField"> <\/p>');var gr=t("<tr><\/tr>"),nu=t('<td class="vis-payment-td1"><\/td>'),tu=t('<td class="vis-payment-td2"><\/td>');nu.append(gi);tu.append(ti);gr.append(nu).append(tu);w.append(gr);it=t('<input  class="vis-payment-inputs"  type="text"> <\/input>');var iu=t("<tr><\/tr>"),ru=t('<td class="vis-payment-td1"><\/td>'),uu=t('<td class="vis-payment-td2"><\/td>');ru.append(er);uu.append(it);iu.append(ru).append(uu);w.append(iu);tt=t('<input class="vis-payment-inputs"  type="text"> <\/input>');var fu=t("<tr><\/tr>"),eu=t('<td class="vis-payment-td1"><\/td>'),ou=t('<td class="vis-payment-td2"><\/td>');eu.append(fr);ou.append(tt);fu.append(eu).append(ou);w.append(fu);rt=t('<input class="vis-payment-inputs"  type="text"> <\/input>');var su=t("<tr><\/tr>"),hu=t('<td class="vis-payment-td1"><\/td>'),cu=t('<td class="vis-payment-td2"><\/td>');hu.append(hr);cu.append(rt);su.append(hu).append(cu);w.append(su);ot=t('<select class="vis-payment-cmb"><\/select>');var lu=t("<tr><\/tr>"),au=t('<td class="vis-payment-td1"><\/td>'),vu=t('<td class="vis-payment-td2"><\/td>');au.append(ui);vu.append(ot);lu.append(au).append(vu);w.append(lu);ei=t('<button class="vis-payment-inputs-buttons"  type="button">'+n.Msg.translate(f,"Online")+"<\/button>");b=t("<tr><\/tr>");ft=t('<td colspan="2"><\/td>');ft.append(ei);b.append(ft);w.append(b);or=t('<Span class="vis-payment-span"> '+n.Msg.translate(f,"C_PaymentTerm_ID")+"<\/span>");l=t('<table  class="vis-payment-table"><\/table>');vt=t("<tr><\/tr>");oi=t('<table  class="vis-payment-table"><\/table>');vt.append(oi);l.append(vt);i.append(l);ht=t('<select class="vis-payment-cmb"><\/select>');var yu=t("<tr><\/tr>"),pu=t('<td class="vis-payment-td1"><\/td>'),wu=t('<td class="vis-payment-td2"><\/td>');pu.append(or);wu.append(ht);yu.append(pu).append(wu);oi.append(yu);lr=t('<p class="vis-payment-span"> '+n.Msg.translate(f,"C_CashBook_ID")+"<\/p>");fi=t('<p class="vis-payment-span"> '+n.Msg.translate(f,"C_Currency_ID")+"<\/p>");di=t('<p class="vis-payment-span"> '+n.Msg.translate(f,"Amount")+"<\/p>");ni=t('<p class="vis-payment-span vis-payment-AmountField"> <\/p>');sr=t('<p class="vis-payment-span"> '+n.Msg.translate(f,"DateAcct")+"<\/p>");o=t('<table class="vis-payment-table"><\/table>');yt=t("<tr><\/tr>");at=t('<table class="vis-payment-table"><\/table>');yt.append(at);o.append(yt);i.append(o);st=t('<select class="vis-payment-cmb"><\/select>');var bu=t("<tr><\/tr>"),ku=t('<td class="vis-payment-td1"><\/td>'),du=t('<td class="vis-payment-td2"><\/td>');ku.append(fi);du.append(st);bu.append(ku).append(du);at.append(bu);ct=t('<select class="vis-payment-cmb"><\/select>');var gu=t("<tr><\/tr>"),nf=t('<td class="vis-payment-td1"><\/td>'),tf=t('<td class="vis-payment-td2"><\/td>');nf.append(lr);tf.append(ct);gu.append(nf).append(tf);at.append(gu);kt=t('<input class="vis-payment-inputs vis-payment-date"  type="date"><\/input>');var rf=t("<tr><\/tr>"),uf=t('<td class="vis-payment-td1"><\/td>'),ff=t('<td class="vis-payment-td2"><\/td>');uf.append(sr);ff.append(kt);rf.append(uf).append(ff);at.append(rf);ni=t('<p class="vis-payment-span vis-payment-AmountField"> <\/p> ');var ef=t("<tr><\/tr>"),of=t('<td class="vis-payment-td1"><\/td>'),sf=t('<td class="vis-payment-td2"><\/td>');of.append(di);sf.append(ni);ef.append(of).append(sf);at.append(ef);k.append(lt)}function eu(i){var f=!1;return(y=r.getValue("DocStatus"),r.getValue("C_BPartner_ID")==null)?(n.ADialog.error("0",!0,n.Msg.getMsg("SaveErrorRowNotFound")),f=!1):(y=r.getValue("DocStatus"),y==null&&(y=""),y.equals("RE")||y.equals("VO")||y.equals("CL"))?f=!1:(b=y.equals("CO")||y.equals("WP")?!1:!0,b||ii||r.getValue("M_Warehouse_ID")==null||(b=!0),b?lt.hide():lt.show(),_Amount=r.getValue("GrandTotal"),!b&&_Amount==0)?(n.ADialog.error("",!0,n.Msg.getMsg("PaymentZero")),f=!1):(yr=parseInt(r.getValue("AD_Client_ID")),pr=parseInt(r.getValue("AD_Org_ID")),wr=parseInt(r.getValue("C_BPartner_ID")),a=r.getValue("PaymentRule"),ri=parseInt(r.getValue("C_Currency_ID")),yt=r.getValue("DateAcct"),(r.getValue("C_PaymentTerm_ID")!=null||r.getValue("C_PaymentTerm_ID")!={})&&(ft=parseInt(r.getValue("C_PaymentTerm_ID"))),r.getValue("C_Payment_ID")!=null&&r.getValue("C_Payment_ID")!={}&&(ai=parseInt(r.getValue("C_Payment_ID"))),r.getValue("C_CashLine_ID")!=null&&r.getValue("C_CashLine_ID")!={}&&(vi=parseInt(r.getValue("C_CashLine_ID"))),e={_DocStatus:y,_isSOTrx:ii,_AD_Client_ID:yr,_AD_Org_ID:pr,_C_BPartner_ID:wr,_PaymentRule:a,_C_Currency_ID:ri,_DateAcct:yt,_C_PaymentTerm_ID:ft,_C_Payment_ID:ai,_C_CashLine_ID:vi,values:JSON.stringify(i),_Amount:_Amount},t.ajax({url:n.Application.contextUrl+"PaymentRule/LoadPaymentMethodDetails",type:"POST",async:!1,dataType:"Json",data:e,success:function(n){var i,v,e,r;ar(!1);i=JSON.parse(n);vr=i.CCType;b?lt.hide():lt.show();ni.text(_Amount);ti.text(_Amount);d.val(i.strKNumber);wt.val(i.strKExp);bt.val(i.strKApproval);wi.val(i.strKStatus);i.canChange&&(g.attr("disable",!1),d.attr("disable",!1),wt.attr("disable",!1),bt.attr("disable",!1),pt.attr("disable",!1));it.val(i.StrSRouting);tt.val(i.StrSNumber);rt.val(i.StrSCheck);ki.text(i.StrSStatus);bi.text(i.StrTStatus);yt!=null&&(kt.Value=yt);v=ri;i._Currencies!=null&&i._Currencies!=undefined&&i._Currencies[ri]?(t.each(i._Currencies,function(n,i){ot.append(t("<option><\/option>").attr("value",i.Key).text(i.Name))}),t.each(i._Currencies,function(n,i){st.append(t("<option><\/option>").attr("value",i.Key).text(i.Name))})):(fi.hide(),st.hide(),ui.hide(),ot.hide());a==null&&(a="");for(e in u.values){if(r=e,dt.equals(r)&&!ii)continue;else if(gt.equals(r)&&ii)continue;p.append(t('<option value="'+r+'">'+u.values[e]+"<\/option>"));r.equals(a)&&p.val(r)}return i.loadPaymentTerms!=null&&i.loadPaymentTerms!=undefined&&(t.each(i.loadPaymentTerms,function(n,i){ht.append(t("<option><\/option>").attr("value",i.Key).text(i.Name))}),ft!=null&&ft!=undefined&&ht.val(ft)),i.loadAccounts!=null&&i.loadAccounts!=undefined&&(t.each(i.loadAccounts,function(n,i){et.append(t("<option><\/option>").attr("value",i.Key).text(i.Name))}),i.kp!=null&&et.val(i.kp)),i.ccs!=null&&i.ccs!=undefined&&(t.each(i.ccs,function(n,i){g.append(t("<option><\/option>").attr("value",i.Key).text(i.Name))}),i.CCType!=null&&g.val(i.CCType)),i.loadBankAccounts!=null&&i.loadBankAccounts!=undefined&&(t.each(i.loadBankAccounts,function(n,i){nt.append(t("<option><\/option>").attr("value",i.Key).text(i.Name))}),i.kp!=null&&nt.val(i.kp)),i.Checkbook_ID!=null&&nt.val(i.Checkbook_ID),i.loadCashBooks!=null&&i.loadCashBooks!=undefined&&t.each(i.loadCashBooks,function(n,i){ct.append(t("<option><\/option>").attr("value",i.Key).text(i.Name))}),i.Checkbook_ID!=null&&(ct.val(i.Checkbook_ID),yi==0&&(yi=i.Checkbook_ID)),a=="B"?(s.hide(),l.hide(),o.show(),h.hide(),c.hide()):a=="K"?(s.show(),l.hide(),o.hide(),h.hide(),c.hide()):a=="D"?(s.hide(),l.hide(),o.hide(),h.show(),c.hide()):a=="P"?(s.hide(),l.show(),o.hide(),h.hide(),c.hide()):a=="S"&&(s.hide(),l.hide(),o.hide(),h.hide(),c.show()),f=!0}}),f)}function ou(n){if(n!=undefined&&!n){v.close();return}p.on("change",su);ot.on("change",hu);st.on("change",cu);pt.on("click",lu);v.onOkClick=function(){ar(!0);var n=au();n&&(vt.isOKPressed=!0,vt.onClose&&vt.onClose())};v.onCancelClick=function(){vt.onClose&&vt.onClose()};v.onClose=function(){vt.dispose()}}function su(){var n=p.val(),t;n!=null&&(t=n.toLower(),(dt==t.toLower()||dt==t.toUpper())&&(t=gt.toLower()),t+="Panel",n.equals("K")?(s.show(),l.hide(),o.hide(),h.hide(),c.hide()):n.equals("B")?(s.hide(),l.hide(),o.show(),h.hide(),c.hide()):n.equals("D")?(s.hide(),l.hide(),o.hide(),h.show(),c.hide()):n.equals("P")?(s.hide(),l.show(),o.hide(),h.hide(),c.hide()):n.equals("S")?(s.hide(),l.hide(),o.hide(),h.hide(),c.show()):n.equals("T")&&(s.hide(),l.hide(),o.hide(),h.hide(),c.hide()))}function hu(){}function cu(){}function lu(){}function au(){var o=!0,s=vu(),u;return s?(u=p.val(),u==null)?void 0:b&&u?(u.equals(a)||r.setValue("PaymentRule",u),o=!0):(e.cmbPayment=p.val(),u.equals(br)?(e.cmbBCurrency=st.val(),e.cmbBCashBook=ct.val(),e.bDateField=kt.val()):u.equals(kr)?(e.cmbKType=g.val(),e.txtKNumber=d.val(),e.txtKExp=wt.val(),e.txtKApproval=bt.val()):u.equals(gt)?e.cmbTAccount=et.val():u.equals(dr)?e.cmbPTerm=ht.val():u.equals(pi)&&(e.cmbSBankAccount=nt.val(),e.txtSRouting=it.val(),e.txtSNumber=tt.val(),e.txtSCheck=rt.val(),e.cmbSCurrency=ot.val()),e.C_Order_ID=f.getContextAsInt(i,"C_Order_ID"),e.C_Invoice_ID=f.getContextAsInt(i,"C_Invoice_ID"),t.ajax({url:n.Application.contextUrl+"PaymentRule/SaveChanges",type:"POST",async:!1,dataType:"Json",data:e,success:function(n){var t=JSON.parse(n);return t.ErrorMsg!=null&&t.ErrorMsg!=""&&t.ErrorMsg!=undefined&&alert(t.ErrorMsg),t.SucessMsg!=null&&t.SucessMsg!=""&&t.SucessMsg!=undefined&&alert(t.SucessMsg),t.newPaymentRule==null||t.newPaymentRule==undefined||t.newPaymentRule.equals(a)||r.setValue("PaymentRule",t.newPaymentRule),t.newDateAcct==null||t.newDateAcct==undefined||t.newDateAcct.equals(yt)||r.setValue("DateAcct",t.newDateAcct),t.newC_PaymentTerm_ID!=ft&&t.newC_PaymentTerm_ID>0&&r.setValue("C_PaymentTerm_ID",t.newC_PaymentTerm_ID),t._C_Payment_ID!=ai&&(t._C_Payment_ID==0?r.setValue("C_Payment_ID",null):r.setValue("C_Payment_ID",t._C_Payment_ID)),t._C_CashLine_ID!=vi&&(t._C_CashLine_ID==0?r.setValue("C_CashLine_ID",null):r.setValue("C_CashLine_ID",t._C_CashLine_ID)),o=!0},error:function(){return o=!1}}),o):o=!1}function vu(){var i=!0,u,t,s,r,f;try{if(u=p.val(),u==null||u==undefined)return!1;if(t=u,b)return!0;var h=yt,o=ft,c=yi,l=vr,e=0;if(t.equals(br))c=ct.val(),h=kt.val();else if(t.equals(kr))l=g.val(),(d.val()==null||d.val()==""||d.val()==undefined)&&(n.ADialog.error("",!0,n.Msg.getMsg("CreditCardNumberError")),i=!1);else if(t.equals(gt)||t.equals(dt))s=et.val(),s==null&&(n.ADialog.error("",!0,n.Msg.getMsg("PaymentBPBankNotFound")),i=!1);else if(t.equals(dr))o=ht.val(),r!=null&&(o=r);else if(t.equals(pi))r=nt.val(),r!=null&&(e=r),(it.val()==null||it.val()==""||it.val()==undefined)&&(n.ADialog.error("",!0,n.Msg.getMsg("PaymentBankRoutingNotValid")),i=!1),(tt.val()==null||tt.val()==""||tt.val()==undefined)&&(n.ADialog.error("",!0,n.Msg.getMsg("PaymentBankAccountNotValid")),i=!1),(rt.val()==null||rt.val()==""||rt.val()==undefined)&&(n.ADialog.error("",!0,n.Msg.getMsg("PaymentBankCheckNotValid")),i=!1);else return!1;"KTSD".indexOf(t)!=-1&&e==0&&(f=nu,t.equals(gt)?f=gr:t.equals(dt)?f=tu:t.equals(pi)&&(f=iu),e==0&&"S".equals(t)&&(n.ADialog.error("",!0,n.Msg.getMsg("PaymentNoProcessor")),i=!1))}catch(a){log.Severe(a.ToString())}return i}function ar(n){n?(hi.show(),ci.show(),k.find("button").prop("disabled",!0)):(hi.hide(),ci.hide(),k.find("button").prop("disabled",!1))}var vt=this,f=n.Env.getCtx(),li=!1,ii=n.context.isSOTrx(i),y=null,a="",ri=0,yt=null,ft=0,ai=0,vi=0,yi=0,vr="",wi,bi,ki,di,ni,gi,ti,ru,nr,tr,ir,rr,ur,fr,er,ui,fi,or,sr,hr,cr,lr,p,g,et,ot,st,ht,nt,ct,pt,ei,d,wt,bt,tt,it,rt,kt,lt,at,oi,uu,ut,si,w,hi,ci;this.log=n.Logging.VLogger.getVLogger("vPayment");var yr=0,pr=0,wr=0,e={},br="B",dt="D",kr="K",dr="P",pi="S",gt="T",gr="A",nu="C",tu="D",iu="K",b=!1,k,v=null,o,s,h,c,l;this.onClose=null;hi=t('<img src="'+n.Application.contextUrl+'Areas/VIS/Images/busy.gif"/>');ci=t("<label>"+n.Msg.getMsg("Loading")+"<\/label>");this.init=function(){fu();li=eu(u.values);ou(li)};this.isInitOK=function(){return li};this.show=function(){v=new n.ChildDialog;k=t("<div><\/div>");k.append(hi).append(ci);ar(!0);v.setContent(k);v.setWidth(360);v.setTitle(n.Msg.getMsg("Payment"));v.setModal(!0);v.show()};this.onClose=null;this.dispose=function(){k!=null&&(k=null);v=null;o=null;s=null;h=null;c=null;l=null;this.onClose=null;wi=null;bi=null;ki=null;di=null;ni=null;gi=null;ti=null;ru=null;nr=null;tr=null;ir=null;rr=null;ur=null;fr=null;er=null;ui=null;fi=null;or=null;sr=null;hr=null;cr=null;lr=null;p=null;g=null;et=null;ot=null;st=null;ht=null;nt=null;ct=null;pt=null;ei=null;d=null;wt=null;bt=null;tt=null;it=null;rt=null;kt=null;at=null;oi=null;uu=null;ut=null;si=null;w=null}}n.VPayment=i}(VIS,jQuery),function(n,t){n.TestForm=function(){function o(){i=t("<div>");f=t("<input type='text'>");r=t("<input type='button'>").val("Show");u=t("<input type='button'>").val("Close");i.append(f).append(r).append(u)}var i,f,r,u,e;this.frame;this.windowNo;o();e=this;r.on(n.Events.onTouchStartOrClick,function(){alert("Test From has value :==> "+f.val())});u.on(n.Events.onTouchStartOrClick,function(){confirm("wanna close this form???")&&e.dispose()});this.getRoot=function(){return i};this.disposeComponent=function(){e=null;i&&i.remove();i=null;r&&r.off(n.Events.onTouchStartOrClick);u&&u.off(n.Events.onTouchStartOrClick);f=r=u=null;this.getRoot=null;this.disposeComponent=null}};n.TestForm.prototype.init=function(n,t){this.frame=t;this.frame.getContentGrid().append(this.getRoot())};n.TestForm.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null}}(VIS,jQuery),function(n,t){function i(i){var e,o,u,r,f;this.onClose=null;this.dGrid=null;e="SelectDeselectAll";o=!0;this.arrListColumns=[];u=this;this.$root=t("<div style='position:relative'>");this.$busyDiv=t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>");this.topDiv=t("<div style='float: left; width: 100%;'>");this.middelDiv=t("<div style='height: 60%;float: left; width: 99.5%;border: 1px solid;'>");this.bottomDiv=t("<div style='height: 40px; width: 100%; float: left ;margin-top: 10px;'>");this.windowNo=i.getWindowNo();this.mTab=i;this.initOK=!1;r="btnOk_"+this.windowNo;this.Okbtn=t("<input id='"+r+"' class='VIS_Pref_btn-2' style='margin-bottom:0px;margin-top:0px ;float:right; margin-right:10px' type='button' value='"+n.Msg.getMsg("OK")+"'>");r="btnCancel_"+this.windowNo;this.cancelbtn=t("<input id='"+r+"' class='VIS_Pref_btn-2' style='margin-bottom:0px;margin-top:0px; margin-right: 3px; float:right' type='button' value='"+n.Msg.getMsg("Cancel")+"'>");r="btnDelete_"+this.windowNo;f=n.Application.contextUrl+"Areas/VIS/Images/base/uncheck-icon.png";this.selectAllButton=t("<button type='button' id='"+r+"' style='margin-bottom:0px;margin-top:0px;display: none;float: left;padding: 0px;border: 0px;' value='Ok' role='button' aria-disabled='false'><img src='"+f+"'><\/button>");r="btnRefresh_"+this.windowNo;f=n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png";this.btnRefresh=t("<button id='"+r+"' style='margin-bottom: 1px; margin-top: 0px;display: none; float: left; margin-left: 0px;height: 38px; ' class='VIS_Pref_btn-2'><img src='"+f+"'><\/button>");n.Application.isRTL&&(this.Okbtn.css("margin-right","-132px"),this.cancelbtn.css("margin-right","55px"));this.lblBankAccount=new n.Controls.VLabel;this.lblBPartner=new n.Controls.VLabel;this.lblOrder=new n.Controls.VLabel;this.lblInvoice=new n.Controls.VLabel;this.lblShipment=new n.Controls.VLabel;this.lblLocator=new n.Controls.VLabel;this.cmbOrder=new n.Controls.VComboBox("",!1,!1,!0);this.cmbInvoice=new n.Controls.VComboBox("",!1,!1,!0);this.cmbShipment=new n.Controls.VComboBox("",!1,!1,!0);this.cmbBankAccount=null;this.vBPartner=null;this.locatorField=null;this.child=null;this.relatedToOrg=new n.Controls.VCheckBox("Related To My Organization",!1,!1,!0,"Related To My Organization",null);this.title="";this.vetoablechange=function(){this.locatorField.setBackground("")};this.setBusy=function(n){u.$busyDiv.css("display",n?"block":"none")};this.showDialog=function(){this.locatorField&&(this.locatorField.setBackground(!1),this.locatorField.addVetoableChangeListener(this));var n=this;this.$root.append(this.$busyDiv);this.setBusy(!1);this.$root.dialog({modal:!0,title:this.title,width:900,height:500,resizable:!1,position:{at:"center top",of:window},close:function(){n.dispose();n.dGrid!=null&&n.dGrid.destroy();u=null;n.$root.dialog("destroy");n.$root=null}})};this.disposeComponent=function(){u=null;this.Okbtn&&this.Okbtn.off("click");this.cancelbtn&&this.cancelbtn.off("click");this.selectAllButton&&this.selectAllButton.off("click");this.btnRefresh&&this.btnRefresh.off("click");this.disposeComponent=null}}i.prototype.dispose=function(){this.disposeComponent()};i.prototype.create=function(t){var i=n.Env.getCtx().getContextAsInt(t.getWindowNo(),"BaseTable_ID"),r=null;if(i==392)r=new n.VCreateFromStatement(t);else if(i==318)r=new n.VCreateFromInvoice(t);else if(i==319)r=new n.VCreateFromShipment(t);else return i==426?null:null;return r};i.prototype.initBPDetails=function(n){return n};i.prototype.initBPartner=function(t){var r=n.MLookupFactory.getMLookUp(n.Env.getCtx(),this.windowNo,3499,n.DisplayType.Search),i;return this.vBPartner=new n.Controls.VTextBoxButton("C_BPartner_ID",!0,!1,!0,n.DisplayType.Search,r),i=n.Env.getCtx().getContextAsInt(this.windowNo,"C_BPartner_ID"),this.vBPartner.setValue(i),this.initBPartnerOIS(i,t)};i.prototype.initBPartnerOIS=function(i,r){var o=this.cmbOrder,e,f,u;for(t(o).html(""),e="Y".equals(n.Env.getCtx().getWindowContext(this.windowNo,"IsReturnTrx")),f=this.getOrders(n.Env.getCtx(),i,e,r),u=0;u<f.length;u++)u==0&&this.cmbOrder.getControl().append(" <option value=0> <\/option>"),this.cmbOrder.getControl().append(" <option value="+f[u].ID+">"+f[u].value+"<\/option>");return this.cmbOrder.getControl().prop("selectedIndex",0),this.initBPDetails(i)};i.prototype.getOrders=function(t,i,r,u){var o=[],l="o.DocumentNo||' - ' ||".concat(n.DB.to_char("o.DateOrdered",n.DisplayType.Date,n.Env.getAD_Language(t))).concat("||' - '||").concat(n.DB.to_char("o.GrandTotal",n.DisplayType.Amount,n.Env.getAD_Language(t))),e="m.M_InOutLine_ID",s,f,h,c;u&&(e="m.C_InvoiceLine_ID");s="SELECT o.C_Order_ID,".concat(l).concat(" FROM C_Order o WHERE o.C_BPartner_ID="+i+" AND o.IsSOTrx='N' AND o.DocStatus IN ('CL','CO') AND o.IsReturnTrx='"+(r?"Y":"N")+"' AND o.C_Order_ID IN (SELECT ol.C_Order_ID FROM C_OrderLine ol LEFT OUTER JOIN M_MatchPO m ON (ol.C_OrderLine_ID=m.C_OrderLine_ID) GROUP BY ol.C_Order_ID,ol.C_OrderLine_ID, ol.QtyOrdered,").concat(e).concat(" HAVING (ol.QtyOrdered <> SUM(m.Qty) AND ").concat(e).concat(" IS NOT NULL) OR ").concat(e).concat(" IS NULL) ORDER BY o.DateOrdered");try{for(f=n.DB.executeReader(s.toString(),null);f.read();)h=n.Utility.Util.getValueOfInt(f.getString(0)),c=f.getString(1),o.push({ID:h,value:c});f.close()}catch(a){}return o};i.prototype.jbInit=function(){var u,i,o;this.init();this.lblBankAccount.getControl().text(n.Msg.translate(n.Env.getCtx(),"C_BankAccount_ID"));this.lblBPartner.getControl().text(n.Msg.getElement(n.Env.getCtx(),"C_BPartner_ID"));this.lblOrder.getControl().text(n.Msg.getElement(n.Env.getCtx(),"C_Order_ID",!1));this.lblInvoice.getControl().text(n.Msg.getElement(n.Env.getCtx(),"C_Invoice_ID",!1));this.lblShipment.getControl().text(n.Msg.getElement(n.Env.getCtx(),"M_InOut_ID",!1));this.lblLocator.getControl().text(n.Msg.translate(n.Env.getCtx(),"M_Locator_ID"));var e=t("<div class='VIS_Pref_show'>"),r=t("<div class='VIS_Pref_dd' style='float: left; height: 34px;'>"),f=t("<div style='float: left; margin-right: 5px; width: 30%; text-align: right'>");if(n.Application.isRTL&&(f=t("<div style='float: right; margin-right: 5px; width: 30%; text-align: left'>")),u=t("<h5 style='width: 100%'>"),i=t("<div style='float: left; width: 68%;' class='VIS_Pref_slide-show pp'>"),this.topDiv.append(e),e.append(r),r.append(f),f.append(u),this.cmbBankAccount!=null){r.css("float","none");u.append(this.lblBankAccount.getControl().addClass("VIS_Pref_Label_Font"));r.append(i);i.append(this.cmbBankAccount.getControl().css("width","100%"));return}n.Application.isRTL?(u.append(this.lblOrder.getControl().addClass("VIS_Pref_Label_Font")),r.append(i),i.append(this.cmbOrder.getControl().css("width","100%"))):this.vBPartner!=null&&(u.append(this.lblBPartner.getControl().addClass("VIS_Pref_Label_Font")),i.removeClass("VIS_Pref_slide-show pp"),r.append(i),i.append(this.vBPartner.getControl().css("width","88%")).append(this.vBPartner.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB")));r=t("<div class='VIS_Pref_dd' style='float: left ; height: 34px;'>");f=t("<div style='float: left; margin-right: 5px; width: 30%; text-align: right'>");n.Application.isRTL&&(f=t("<div style='float: right; margin-right: 5px; width: 30%; text-align: left'>"));u=t("<h5 style='width: 100%'>");i=t("<div style='float: left; width: 68%;' class='VIS_Pref_slide-show'>");e.append(r);r.append(f);f.append(u);n.Application.isRTL?this.vBPartner!=null&&(u.append(this.lblBPartner.getControl().addClass("VIS_Pref_Label_Font")),i.removeClass("VIS_Pref_slide-show pp"),r.append(i),i.append(this.vBPartner.getControl().css("width","88%")).append(this.vBPartner.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB"))):(u.append(this.lblOrder.getControl().addClass("VIS_Pref_Label_Font")),r.append(i),i.append(this.cmbOrder.getControl().css("width","100%")));e=t("<div class='VIS_Pref_show'>");r=t("<div class='VIS_Pref_dd' style='float: left ; height: 34px;'>");f=t("<div style='float: left; margin-right: 5px;width: 30%; text-align: right'>");n.Application.isRTL&&(f=t("<div style='float: right; margin-right: 5px; width: 30%; text-align: left'>"));u=t("<h5 style='width: 100%'>");i=t("<div style='float: left; width: 68%;' class='VIS_Pref_slide-show pp'>");this.topDiv.append(e);e.append(r);r.append(f);f.append(u);n.Application.isRTL?(u.append(this.lblInvoice.getControl().addClass("VIS_Pref_Label_Font")),r.append(i),i.append(this.cmbInvoice.getControl().css("width","100%")),u.append(this.lblShipment.getControl().addClass("VIS_Pref_Label_Font")),r.append(i),i.append(this.cmbShipment.getControl().css("width","100%"))):this.locatorField!=null&&(u.append(this.lblLocator.getControl().addClass("VIS_Pref_Label_Font")),i.removeClass("VIS_Pref_slide-show pp"),r.append(i),i.append(this.locatorField.getControl().css("width","88%")).append(this.locatorField.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB")));r=t("<div class='VIS_Pref_dd' style='float: left ; height: 34px;'>");f=t("<div style='float: left; margin-right: 5px;width: 30%; text-align: right'>");n.Application.isRTL&&(f=t("<div style='float: right; margin-right: 5px; width: 30%; text-align: left'>"));u=t("<h5 style='width: 100%'>");i=t("<div style='float: left; width: 68%;' class='VIS_Pref_slide-show pp'>");e.append(r);r.append(f);f.append(u);n.Application.isRTL?this.locatorField!=null&&(u.append(this.lblLocator.getControl().addClass("VIS_Pref_Label_Font")),i.removeClass("VIS_Pref_slide-show pp"),r.append(i),i.append(this.locatorField.getControl().css("width","88%")).append(this.locatorField.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB"))):(u.append(this.lblInvoice.getControl().addClass("VIS_Pref_Label_Font")),r.append(i),i.append(this.cmbInvoice.getControl().css("width","100%")),u.append(this.lblShipment.getControl().addClass("VIS_Pref_Label_Font")),r.append(i),i.append(this.cmbShipment.getControl().css("width","100%")));e=t("<div class='VIS_Pref_show'>");r=t("<div class='VIS_Pref_dd' style='float: left ; height: 34px;'>");f=t("<div style='float: left; margin-right: 5px;width: 100%; text-align: left'>");n.Application.isRTL&&(f=t("<div style='float: right; margin-right: 5px; width: 30%; text-align: left'>"));u=t("<h5 style='width: 100%'>");i=t("<div style='float: left; width: 68%;' class='VIS_Pref_slide-show pp'>");this.topDiv.append(e);e.append(r);r.append(f);f.append(u);u.append(this.relatedToOrg.getControl().css("width","100%"));n.Application.isRTL;r=t("<div class='VIS_Pref_dd' style='float: left ; height: 34px;'>");f=t("<div style='float: left; margin-right: 5px;width: 30%; text-align: right'>");n.Application.isRTL&&(f=t("<div style='float: right; margin-right: 5px; width: 30%; text-align: left'>"));u=t("<h5 style='width: 100%'>");i=t("<div style='float: left; width: 68%;' class='VIS_Pref_slide-show pp'>");e.append(r);r.append(f);f.append(u);n.Application.isRTL;o=n.MLookupFactory.getMLookUp(n.Env.getCtx(),this.windowNo,3499,n.DisplayType.Search);this.vBPartner=new n.Controls.VTextBoxButton("C_BPartner_ID",!0,!1,!0,n.DisplayType.Search,o)};i.prototype.init=function(){this.$root.append(this.topDiv).append(this.middelDiv).append(this.bottomDiv);this.bottomDiv.append(this.selectAllButton);this.bottomDiv.append(this.btnRefresh);this.bottomDiv.append(this.cancelbtn);this.bottomDiv.append(this.Okbtn);this.middelDiv.append(this.dGrid);$self=this;this.Okbtn.on("click",function(){var t=!1;$self.setBusy(!0);$self.locatorField!=null?t=n.VCreateFromShipment.prototype.saveMInOut():$self.cmbBankAccount!=null?(t=n.VCreateFromStatement.prototype.saveStatment(),$self.middelDiv.css("height","79%")):t=n.VCreateFromInvoice.prototype.saveInvoice();$self.setBusy(!1);t&&$self.$root.dialog("close")});this.cancelbtn.on("click",function(){$self.$root.dialog("close")});this.selectAllButton.on("click",function(){});if(this.relatedToOrg)this.relatedToOrg.getControl().on("click",function(){$self.setBusy(!0);var n=$self.cmbOrder.getControl().find("option:selected").val();$self.cmbInvoice.getControl().prop("selectedIndex",-1);$self.cmbShipment.getControl().prop("selectedIndex",-1);$self.loadOrder(n,!1);$self.setBusy(!1)});if(this.btnRefresh)this.btnRefresh.on("click",function(){if($self.cmbBankAccount!=null){$self.setBusy(!0);var t=$self.cmbBankAccount.getControl().find("option:selected").val();t&&n.VCreateFromStatement.prototype.loadBankAccount(t);$self.setBusy(!1)}});this.cmbOrder&&this.cmbOrder.getControl().change(function(){$self.setBusy(!0);var n=$self.cmbOrder.getControl().find("option:selected").val();$self.cmbInvoice.getControl().prop("selectedIndex",-1);$self.cmbShipment.getControl().prop("selectedIndex",-1);$self.locatorField!=null?$self.loadOrder(n,!1):$self.loadOrder(n,!0);$self.setBusy(!1)});this.cmbBankAccount&&this.cmbBankAccount.getControl().change(function(){$self.setBusy(!0);var t=$self.cmbBankAccount.getControl().find("option:selected").val();t&&n.VCreateFromStatement.prototype.loadBankAccount(t);$self.setBusy(!1)});this.cmbInvoice&&this.cmbInvoice.getControl().change(function(){$self.setBusy(!0);var t=$self.cmbInvoice.getControl().find("option:selected").val();$self.cmbOrder.getControl().prop("selectedIndex",-1);$self.cmbShipment.getControl().prop("selectedIndex",-1);n.VCreateFromShipment.prototype.loadInvoice(t);$self.setBusy(!1)});this.cmbShipment&&this.cmbShipment.getControl().change(function(){$self.setBusy(!0);var t=$self.cmbShipment.getControl().find("option:selected").val();$self.cmbOrder.getControl().prop("selectedIndex",-1);$self.cmbInvoice.getControl().prop("selectedIndex",-1);n.VCreateFromInvoice.prototype.loadShipment(t);$self.setBusy(!1)})};i.prototype.isInitOK=function(){return this.initOK};i.prototype.loadOrder=function(t,i){var r=null;r=this.getOrderData(n.Env.getCtx(),t,i);this.loadGrid(r)};i.prototype.getOrderData=function(t,i,r){var h=[],u="",o,e,s,f;$self.relatedToOrg.getValue()?(u="SELECT round((l.QtyOrdered-SUM(COALESCE(m.Qty,0))) * (CASE WHEN l.QtyOrdered=0 THEN 0 ELSE l.QtyEntered/l.QtyOrdered END ),2) as QUANTITY,round((l.QtyOrdered-SUM(COALESCE(m.Qty,0))) * (CASE WHEN l.QtyOrdered=0 THEN 0 ELSE l.QtyEntered/l.QtyOrdered END ),2) as QTYENTER, l.C_UOM_ID  as C_UOM_ID  ,COALESCE(uom.UOMSymbol,uom.Name) as UOM, COALESCE(l.M_Product_ID,0) as M_PRODUCT_ID ,COALESCE(p.Name,c.Name) as PRODUCT, l.M_AttributeSetInstance_ID AS M_ATTRIBUTESETINSTANCE_ID , ins.description ,  l.C_OrderLine_ID as C_ORDERLINE_ID,l.Line  as LINE,'false' as SELECTROW   FROM C_OrderLine l LEFT OUTER JOIN M_MatchPO m ON (l.C_OrderLine_ID=m.C_OrderLine_ID AND ",u=u.concat(r?"m.C_InvoiceLine_ID":"m.M_InOutLine_ID"),u=u.concat(" IS NOT NULL)").concat(" LEFT OUTER JOIN M_Product p ON (l.M_Product_ID=p.M_Product_ID) LEFT OUTER JOIN C_Charge c ON (l.C_Charge_ID=c.C_Charge_ID)"),u=n.Env.isBaseLanguage(t,"C_UOM")?u.concat(" LEFT OUTER JOIN C_UOM uom ON (l.C_UOM_ID=uom.C_UOM_ID)"):u.concat(" LEFT OUTER JOIN C_UOM_Trl uom ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.AD_Language='").concat(n.Env.getAD_Language(t)).concat("')"),u=u.concat(" LEFT OUTER JOIN M_AttributeSetInstance ins ON (ins.M_AttributeSetInstance_ID =l.M_AttributeSetInstance_ID) "),u=u.concat(" WHERE l.C_Order_ID="+i+" AND l.DTD001_Org_ID = "+$self.mTab.getValue($self.windowNo,"AD_Org_ID")+" GROUP BY l.QtyOrdered,CASE WHEN l.QtyOrdered=0 THEN 0 ELSE l.QtyEntered/l.QtyOrdered END, l.C_UOM_ID,COALESCE(uom.UOMSymbol,uom.Name), l.M_Product_ID,COALESCE(p.Name,c.Name),l.M_AttributeSetInstance_ID , l.Line,l.C_OrderLine_ID, ins.description  ORDER BY l.Line")):(u="SELECT round((l.QtyOrdered-SUM(COALESCE(m.Qty,0))) * (CASE WHEN l.QtyOrdered=0 THEN 0 ELSE l.QtyEntered/l.QtyOrdered END ),2) as QUANTITY,round((l.QtyOrdered-SUM(COALESCE(m.Qty,0))) * (CASE WHEN l.QtyOrdered=0 THEN 0 ELSE l.QtyEntered/l.QtyOrdered END ),2) as QTYENTER, l.C_UOM_ID  as C_UOM_ID  ,COALESCE(uom.UOMSymbol,uom.Name) as UOM, COALESCE(l.M_Product_ID,0) as M_PRODUCT_ID ,COALESCE(p.Name,c.Name) as PRODUCT, l.M_AttributeSetInstance_ID AS M_ATTRIBUTESETINSTANCE_ID , ins.description ,  l.C_OrderLine_ID as C_ORDERLINE_ID,l.Line  as LINE,'false' as SELECTROW   FROM C_OrderLine l LEFT OUTER JOIN M_MatchPO m ON (l.C_OrderLine_ID=m.C_OrderLine_ID AND ",u=u.concat(r?"m.C_InvoiceLine_ID":"m.M_InOutLine_ID"),u=u.concat(" IS NOT NULL)").concat(" LEFT OUTER JOIN M_Product p ON (l.M_Product_ID=p.M_Product_ID) LEFT OUTER JOIN C_Charge c ON (l.C_Charge_ID=c.C_Charge_ID)"),u=n.Env.isBaseLanguage(t,"C_UOM")?u.concat(" LEFT OUTER JOIN C_UOM uom ON (l.C_UOM_ID=uom.C_UOM_ID)"):u.concat(" LEFT OUTER JOIN C_UOM_Trl uom ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.AD_Language='").concat(n.Env.getAD_Language(t)).concat("')"),u=u.concat(" LEFT OUTER JOIN M_AttributeSetInstance ins ON (ins.M_AttributeSetInstance_ID =l.M_AttributeSetInstance_ID) "),u=u.concat(" WHERE l.C_Order_ID="+i+" GROUP BY l.QtyOrdered,CASE WHEN l.QtyOrdered=0 THEN 0 ELSE l.QtyEntered/l.QtyOrdered END, l.C_UOM_ID,COALESCE(uom.UOMSymbol,uom.Name), l.M_Product_ID,COALESCE(p.Name,c.Name), l.M_AttributeSetInstance_ID, l.Line,l.C_OrderLine_ID, ins.description  ORDER BY l.Line"));o="SELECT * FROM ("+u.toString()+") WHERE QUANTITY > 0";e=null;try{for(e=n.DB.executeReader(o.toString(),null,null),console.log(o.toString()),s=1;e.read();)f={},f.Quantity=e.getString("quantity"),f.QuantityEntered=e.getString("qtyenter"),f.C_UOM_ID=e.getString("uom"),f.M_Product_ID=e.getString("product"),f.M_AttributeSetInstance_ID=e.getString("description"),f.C_Order_ID=e.getString("line"),f.M_InOut_ID=null,f.C_Invoice_ID=null,f.C_UOM_ID_K=e.getString("c_uom_id"),f.M_Product_ID_K=e.getString("m_product_id"),f.M_AttributeSetInstance_ID_K=e.getString("m_attributesetinstance_id"),f.C_Order_ID_K=e.getString("c_orderline_id"),f.M_InOut_ID_K=null,f.C_Invoice_ID_K=null,f.recid=s,s++,h.push(f);e.close()}catch(c){}return h};i.prototype.loadGrid=function(i){if(this.dGrid!=null&&(this.dGrid.destroy(),this.dGrid=null),this.arrListColumns.length==0&&(this.arrListColumns.push({field:"Quantity",caption:n.Msg.translate(n.Env.getCtx(),"Quantity"),sortable:!1,size:"150px",render:"number:1",hidden:!1}),this.arrListColumns.push({field:"QuantityEntered",caption:n.Msg.getMsg("QtyEntered"),editable:{type:"float"},render:"number:1",sortable:!1,size:"150px",hidden:!1}),this.arrListColumns.push({field:"C_UOM_ID",caption:n.Msg.translate(n.Env.getCtx(),"C_UOM_ID"),sortable:!1,size:"150px",hidden:!1}),this.arrListColumns.push({field:"M_Product_ID",caption:n.Msg.translate(n.Env.getCtx(),"M_Product_ID"),sortable:!1,size:"150px",hidden:!1}),this.arrListColumns.push({field:"M_AttributeSetInstance_ID",caption:n.Msg.translate(n.Env.getCtx(),"M_AttributeSetInstance_ID"),sortable:!1,size:"150px",hidden:!1,render:function(){return'<div><input type=text readonly="readonly" style= "width:80%; border:none" ><\/input><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/MultiX16.png" alt="Attribute Set Instance" title="Attribute Set Instance" style="opacity:1;float:right;"><\/div>'}}),this.arrListColumns.push({field:"C_Order_ID",caption:n.Msg.getElement(n.Env.getCtx(),"C_OrderLine_ID"),sortable:!1,size:"150px",hidden:!1}),this.arrListColumns.push({field:"M_InOut_ID",caption:n.Msg.getElement(n.Env.getCtx(),"M_InOut_ID"),sortable:!1,size:"150px",hidden:!1}),this.arrListColumns.push({field:"C_Invoice_ID",caption:n.Msg.getElement(n.Env.getCtx(),"C_Invoice_ID"),sortable:!1,size:"150px",hidden:!1}),this.arrListColumns.push({field:"C_UOM_ID_K",caption:n.Msg.translate(n.Env.getCtx(),"C_UOM_ID"),sortable:!1,size:"150px",hidden:!0}),this.arrListColumns.push({field:"M_Product_ID_K",caption:n.Msg.translate(n.Env.getCtx(),"M_Product_ID"),sortable:!1,size:"150px",hidden:!0}),this.arrListColumns.push({field:"C_Order_ID_K",caption:n.Msg.getElement(n.Env.getCtx(),"C_Order_ID"),sortable:!1,size:"150px",hidden:!0}),this.arrListColumns.push({field:"M_InOut_ID_K",caption:n.Msg.getElement(n.Env.getCtx(),"M_InOut_ID"),sortable:!1,size:"150px",hidden:!0}),this.arrListColumns.push({field:"C_Invoice_ID_K",caption:n.Msg.getElement(n.Env.getCtx(),"C_Invoice_ID"),sortable:!1,size:"150px",hidden:!0})),w2utils.encodeTags(i),this.dGrid=t(this.middelDiv).w2grid({name:"gridCreateForm",recordHeight:30,show:{selectColumn:!0},multiSelect:!0,columns:this.arrListColumns,records:i}),this.dGrid.records.length>0)for(var r=0;r<this.dGrid.records.length;r++)t("#grid_"+$self.dGrid.name+"_rec_"+(r+1)).find("input[type=text]").val(i[r].M_AttributeSetInstance_ID);this.dGrid.on("change",function(n){$self.dGrid.columns[n.column].field=="QuantityEntered"&&($self.dGrid.records[n.index].QuantityEntered=n.value_new)});this.dGrid.on("click",function(i){if(i.preventDefault,$self.dGrid.columns[i.column].field=="M_AttributeSetInstance_ID"){var u=0,f=u==8418,e=n.context.getContextAsInt($self.windowNo,"M_Locator_ID"),o=n.context.getContextAsInt($self.windowNo,"C_BPartner_ID"),r=new n.PAttributesForm(n.Utility.Util.getValueOfInt($self.dGrid.records[i.recid-1].M_AttributeSetInstance_ID_K),n.Utility.Util.getValueOfInt($self.dGrid.records[i.recid-1].M_Product_ID_K),e,o,f,u,$self.windowNo);r.hasAttribute&&r.showDialog();r.onClose=function(n,r){t("#grid_"+$self.dGrid.name+"_rec_"+i.recid).find("input[type=text]").val(r);$self.dGrid.records[i.recid-1].M_AttributeSetInstance_ID_K=n;$self.dGrid.records[i.recid-1].M_AttributeSetInstance_ID=r}}})};n.VCreateFrom=i}(VIS,jQuery),function(n,t){function i(t){function f(){i.title=n.Msg.getElement(n.Env.getCtx(),"C_Invoice_ID",!1)+" .. "+n.Msg.translate(n.Env.getCtx(),"CreateFrom");i.lblInvoice!=null&&i.lblInvoice.getControl().css("display","none");i.cmbInvoice!=null&&i.cmbInvoice.getControl().css("display","none");i.lblLocator!=null&&i.lblLocator.getControl().css("display","none");i.locatorField!=null&&i.locatorField.getControl().css("display","none");var t=i.initBPartner(!0);return o(t),!0}function e(t,i){var u=[],o="s.DocumentNo||' - '||".concat(n.DB.to_char("s.MovementDate",n.DisplayType.Date,n.Env.getAD_Language(n.Env.getCtx()))),s="SELECT s.M_InOut_ID,".concat(o).concat(" FROM M_InOut s WHERE s.C_BPartner_ID="+i+" AND s.IsSOTrx='N' AND s.DocStatus IN ('CL','CO') AND s.M_InOut_ID IN (SELECT sl.M_InOut_ID FROM M_InOutLine sl LEFT OUTER JOIN M_MatchInv mi ON (sl.M_InOutLine_ID=mi.M_InOutLine_ID) GROUP BY sl.M_InOut_ID,mi.M_InOutLine_ID,sl.MovementQty HAVING (sl.MovementQty<>SUM(mi.Qty) AND mi.M_InOutLine_ID IS NOT NULL) OR mi.M_InOutLine_ID IS NULL) ORDER BY s.MovementDate"),r,f,e;try{for(r=n.DB.executeReader(s.toString(),null);r.read();)f=n.Utility.Util.getValueOfInt(r.getString(0)),e=r.getString(1),u.push({ID:f,value:e});r.close()}catch(h){}return u}function o(t){var u,r;for(i.cmbShipment.getControl().html(""),u=e(n.Env.getCtx(),t),r=0;r<u.length;r++)r==0&&i.cmbShipment.getControl().append(" <option value=0> <\/option>"),i.cmbShipment.getControl().append(" <option value="+u[r].ID+">"+u[r].value+"<\/option>");i.cmbShipment.getControl().prop("selectedIndex",0)}var i=this.$super,r,u;i.constructor(t);r=this;f();i.jbInit();i.initOK=!0;u=t.getWindowNo();this.disposeComponent=function(){i=null;r=null;this.disposeComponent=null}}n.Utility.inheritPrototype(i,n.VCreateFrom);i.prototype.saveInvoice=function(){var i,n,r,t;if(this.$super.dGrid==null)return!1;if((i={},n=this.$super.dGrid.getSelection(),n!=null)&&!(n.length<=0)){for(r=n.toString().split(","),t=0;t<r.length;t++)i[t]=this.$super.dGrid.get(r[t]);var u=this.$super.mTab.getValue("C_Invoice_ID"),f=this.$super.cmbOrder.getControl().find("option:selected").val(),e=this.$super.cmbShipment.getControl().find("option:selected").val();return this.saveData(i,n,f,e,u)}};i.prototype.loadShipment=function(t){var i=this.getShipmentData(n.Env.getCtx(),t);this.$super.loadGrid(i)};i.prototype.getShipmentData=function(t,i){var e=[],u="SELECT l.MovementQty-SUM(NVL(mi.Qty,0)),round(l.QtyEntered/l.MovementQty,6), l.C_UOM_ID,COALESCE(uom.UOMSymbol,uom.Name), l.M_Product_ID,p.Name, l.M_InOutLine_ID,l.Line, l.C_OrderLine_ID ",f;u=n.Env.isBaseLanguage(t,"C_UOM")?u.concat("FROM C_UOM uom ").concat("INNER JOIN M_InOutLine l ON (l.C_UOM_ID=uom.C_UOM_ID) "):u.concat("FROM C_UOM_Trl uom ").concat("INNER JOIN M_InOutLine l ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.AD_Language='").concat(n.Env.getAD_Language(t)).concat("') ");u=u.concat("INNER JOIN M_Product p ON (l.M_Product_ID=p.M_Product_ID) ").concat("LEFT OUTER JOIN M_MatchInv mi ON (l.M_InOutLine_ID=mi.M_InOutLine_ID) ").concat("WHERE l.M_InOut_ID="+i).concat("GROUP BY l.MovementQty, round(l.QtyEntered/l.MovementQty,6),l.C_UOM_ID,COALESCE(uom.UOMSymbol,uom.Name),l.M_Product_ID,p.Name, l.M_InOutLine_ID,l.Line,l.C_OrderLine_ID ").concat("ORDER BY l.Line");try{for(dr=n.DB.executeReader(u.toString(),null,null),f=1;dr.read();){var r={},o=dr.getDecimal(0),s=dr.getDecimal(1),h=o*s;r.Quantity=h;r.C_UOM_ID=dr.getString(3);r.M_Product_ID=dr.getString(5);r.C_Order_ID=".";r.M_InOut_ID=dr.getString(7);r.C_Invoice_ID=null;r.C_UOM_ID_K=dr.getString(2);r.M_Product_ID_K=dr.getInt(4);r.C_Order_ID_K=dr.getInt(8);r.M_InOut_ID_K=dr.getInt(6);r.C_Invoice_ID_K=null;r.recid=f;f++;e.push(r)}dr.close()}catch(c){}return e};i.prototype.saveData=function(i,r,u,f,e){var o=this;t.ajax({type:"POST",url:n.Application.contextUrl+"Common/SaveInvoice",dataType:"json",data:{model:i,selectedItems:r,C_Order_ID:u,C_Invoice_ID:e,M_inout_id:f},success:function(n){if(returnValue=n.result,returnValue){o.dispose();o.$super.$root.dialog("close");return}alert(returnValue)}})};i.prototype.dispose=function(){this.disposeComponent!=null&&this.disposeComponent()};n.VCreateFromInvoice=i}(VIS,jQuery),function(n,t){function i(t){function u(){var u,t,r;i.title=n.Msg.getElement(n.Env.getCtx(),"M_InOut_ID",!1)+" .. "+n.Msg.translate(n.Env.getCtx(),"CreateFrom");i.lblShipment!=null&&i.lblShipment.getControl().css("display","none");i.cmbShipment!=null&&i.cmbShipment.getControl().css("display","none");u=3537;t=new n.MLocatorLookup(n.Env.getCtx(),i.windowNo);i.locatorField=new n.Controls.VLocator("M_Locator_ID",!0,!1,!0,n.DisplayType.Locator,t);r=i.initBPartner(!1);e(r)}function f(t,i,r){var f=[],e="i.DocumentNo||' - '||".concat(n.DB.to_char("DateInvoiced",n.DisplayType.Date,n.Env.getAD_Language(t))).concat("|| ' - ' ||").concat(n.DB.to_char("GrandTotal",n.DisplayType.Amount,n.Env.getAD_Language(t))),o="SELECT i.C_Invoice_ID,".concat(e).concat(" FROM C_Invoice i INNER JOIN C_DocType d ON (i.C_DocType_ID = d.C_DocType_ID) WHERE i.C_BPartner_ID="+i+" AND i.IsSOTrx='N' AND d.IsReturnTrx='"+(r?"Y":"N")+"' AND i.DocStatus IN ('CL','CO') AND i.C_Invoice_ID IN (SELECT il.C_Invoice_ID FROM C_InvoiceLine il LEFT OUTER JOIN M_MatchInv mi ON (il.C_InvoiceLine_ID=mi.C_InvoiceLine_ID) GROUP BY il.C_Invoice_ID,mi.C_InvoiceLine_ID,il.QtyInvoiced HAVING (il.QtyInvoiced<>SUM(mi.Qty) AND mi.C_InvoiceLine_ID IS NOT NULL) OR mi.C_InvoiceLine_ID IS NULL) ORDER BY i.DateInvoiced"),u=null;try{for(u=n.DB.executeReader(o.toString(),null,null);u.read();)key=n.Utility.Util.getValueOfInt(u.getString(0)),value=u.getString(1),f.push({ID:key,value:value});u.close()}catch(s){u.close()}return f}function e(t){var e,u,r;for(i.cmbInvoice.getControl().html(""),e="Y".equals(n.Env.getCtx().getWindowContext(i.windowNo,"IsReturnTrx")),u=f(n.Env.getCtx(),t,e),r=0;r<u.length;r++)r==0&&i.cmbInvoice.getControl().append(" <option value=0> <\/option>"),i.cmbInvoice.getControl().append(" <option value="+u[r].ID+">"+u[r].value+"<\/option>");i.cmbInvoice.getControl().prop("selectedIndex",0)}var i=this.$super,r;i.constructor(t);r=this;u();i.jbInit();i.initOK=!0;this.disposeComponent=function(){i=null;r=null;this.disposeComponent=null}}n.Utility.inheritPrototype(i,n.VCreateFrom);i.prototype.saveMInOut=function(){var i,n,u,t,r;if(this.$super.dGrid==null)return!1;if((i={},n=this.$super.dGrid.getSelection(),n!=null)&&!(n.length<=0)){for(u=n.toString().split(","),t=0;t<u.length;t++)i[t]=this.$super.dGrid.get(u[t]);if(r=this.$super.locatorField.getValue(),r==null||r==0)return alert("Locator Field is Mendatory"),!1;if(i.length==0)return!1;var f=r,e=this.$super.mTab.getValue("M_InOut_ID"),o=this.$super.cmbInvoice.getControl().find("option:selected").val(),s=this.$super.cmbOrder.getControl().find("option:selected").val();return this.saveData(i,n,s,o,f,e)}};i.prototype.loadInvoice=function(t){var i=this.getInvoiceData(n.Env.getCtx(),t);this.$super.loadGrid(i)};i.prototype.getInvoiceData=function(t,i){var o=[],f="SELECT l.QtyInvoiced-SUM(NVL(mi.Qty,0)),round(l.QtyEntered/l.QtyInvoiced,6), l.C_UOM_ID,COALESCE(uom.UOMSymbol,uom.Name), l.M_Product_ID,p.Name, l.C_InvoiceLine_ID,l.Line, l.C_OrderLine_ID ",r,e;f=n.Env.isBaseLanguage(t,"C_UOM")?f.concat("FROM C_UOM uom ").concat("INNER JOIN C_InvoiceLine l ON (l.C_UOM_ID=uom.C_UOM_ID) "):f.concat("FROM C_UOM_Trl uom ").concat("INNER JOIN C_InvoiceLine l ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.AD_Language='").concat(n.Env.getAD_Language(t)).concat("') ");f=f.concat("INNER JOIN M_Product p ON (l.M_Product_ID=p.M_Product_ID) ").concat("LEFT OUTER JOIN M_MatchInv mi ON (l.C_InvoiceLine_ID=mi.C_InvoiceLine_ID) ").concat("WHERE l.C_Invoice_ID="+i+"GROUP BY l.QtyInvoiced, round(l.QtyEntered/l.QtyInvoiced,6),l.C_UOM_ID,COALESCE(uom.UOMSymbol,uom.Name),l.M_Product_ID,p.Name, l.C_InvoiceLine_ID,l.Line,l.C_OrderLine_ID ORDER BY l.Line");r=null;try{for(r=n.DB.executeReader(f.toString(),null,null),e=1;r.read();){var u={},s=r.getDecimal(0),h=r.getDecimal(1),c=s*h;u.Quantity=c;u.C_UOM_ID=r.getString(3);u.M_Product_ID=r.getString(5);u.C_Order_ID=".";u.M_InOut_ID=null;u.C_Invoice_ID=r.getString(7);u.C_UOM_ID_K=r.getString(2);u.M_Product_ID_K=r.getInt(4);u.C_Order_ID_K=r.getInt(8);u.M_InOut_ID_K=null;u.C_Invoice_ID_K=r.getInt(6);u.recid=e;e++;o.push(u)}r.close()}catch(l){}return o};i.prototype.saveData=function(i,r,u,f,e,o){var s=this;console.log(e);t.ajax({type:"POST",url:n.Application.contextUrl+"Common/SaveShipment",dataType:"json",data:{model:i,selectedItems:r,C_Order_ID:u,C_Invoice_ID:f,M_Locator_ID:e,M_InOut_ID:o},success:function(n){if(returnValue=n.result,returnValue){s.dispose();s.$super.$root.dialog("close");return}alert(returnValue)}})};i.prototype.dispose=function(){this.disposeComponent!=null&&this.disposeComponent()};n.VCreateFromShipment=i}(VIS,jQuery),function(n,t){function i(t){function f(){var f,e,t;return i.mTab.getValue("C_BankStatement_ID")==null?(n.ADialog.error(n.Msg.getMsg(n.Env.getCtx(),"SaveErrorRowNotFound",!0)),!1):(i.title=n.Msg.getElement(n.Env.getCtx(),"C_BankStatement_ID",!1)+" .. "+n.Msg.translate(n.Env.getCtx(),"CreateFrom"),f=4917,e=n.MLookupFactory.getMLookUp(n.Env.getCtx(),r,f,n.DisplayType.TableDir),i.cmbBankAccount=new n.Controls.VComboBox("C_BankAccount_ID",!0,!1,!0,e,150,n.DisplayType.TableDir,0),i.cmbBankAccount.getControl().prop("selectedIndex",0),t=n.Env.getCtx().getContextAsInt(r,"C_BankAccount_ID"),i.cmbBankAccount.setValue(t),u.loadBankAccount(t),i.btnRefresh&&i.btnRefresh.css("display","black"),!0)}var i=this.$super,u,r;i.constructor(t);u=this;r=t.getWindowNo();f();i.jbInit();i.initOK=!0;i.middelDiv.css("height","79%");this.disposeComponent=function(){this.disposeComponent=null}}n.Utility.inheritPrototype(i,n.VCreateFrom);i.prototype.getTableFieldVOs=function(){var t=this.$super;t.arrListColumns=[];t.arrListColumns.push({field:"Date",caption:n.Msg.translate(n.Env.getCtx(),"Date"),sortable:!0,size:"150px",hidden:!1});t.arrListColumns.push({field:"C_Payment_ID",caption:n.Msg.translate(n.Env.getCtx(),"C_Payment_ID"),sortable:!0,size:"150px",hidden:!1});t.arrListColumns.push({field:"C_Currency_ID",caption:n.Msg.translate(n.Env.getCtx(),"C_Currency_ID"),sortable:!0,size:"150px",hidden:!1});t.arrListColumns.push({field:"Amount",caption:n.Msg.translate(n.Env.getCtx(),"Amount"),sortable:!0,size:"150px",hidden:!1});t.arrListColumns.push({field:"ConvertedAmount",caption:n.Msg.translate(n.Env.getCtx(),"ConvertedAmount"),sortable:!0,size:"150px",hidden:!1});t.arrListColumns.push({field:"C_BPartner_ID",caption:n.Msg.translate(n.Env.getCtx(),"C_BPartner_ID"),sortable:!0,size:"150px",hidden:!1});t.arrListColumns.push({field:"C_Payment_ID_K",caption:n.Msg.translate(n.Env.getCtx(),"C_Payment_ID"),sortable:!0,size:"150px",hidden:!0});t.arrListColumns.push({field:"C_Currency_ID_K",caption:n.Msg.translate(n.Env.getCtx(),"C_Currency_ID"),sortable:!0,size:"150px",hidden:!0})};i.prototype.loadBankAccount=function(t){var i=this.$super,r=i.mTab.getValue("StatementDate"),u=this.getBankAccountData(n.Env.getCtx(),t,r);this.getTableFieldVOs();setTimeout(function(){i.loadGrid(u)},10)};i.prototype.getBankAccountData=function(t,i,r){var s=[],u,e,o,f;try{for(r==null&&(r=DateTime.Today.Date),u=null,e=[],e[0]=new n.DB.SqlParam("@t",r),e[0].setIsDate(!0),e[1]=new n.DB.SqlParam("@C_BankAccount_ID",i),u=n.DB.executeReader("SELECT p.DateTrx,p.C_Payment_ID,p.DocumentNo, ba.C_Currency_ID,c.ISO_Code,p.PayAmt,currencyConvert(p.PayAmt,p.C_Currency_ID,ba.C_Currency_ID,@t,null,p.AD_Client_ID,p.AD_Org_ID), bp.Name FROM C_BankAccount ba INNER JOIN C_Payment_v p ON (p.C_BankAccount_ID=ba.C_BankAccount_ID) INNER JOIN C_Currency c ON (p.C_Currency_ID=c.C_Currency_ID) LEFT OUTER JOIN C_BPartner bp ON (p.C_BPartner_ID=bp.C_BPartner_ID) WHERE p.Processed='Y' AND p.IsReconciled='N' AND p.DocStatus IN ('CO','CL','RE','VO') AND p.PayAmt<>0 AND p.C_BankAccount_ID=@C_BankAccount_ID AND NOT EXISTS (SELECT * FROM C_BankStatementLine l WHERE p.C_Payment_ID=l.C_Payment_ID AND l.StmtAmt <> 0)",e,null),o=1;u.read();)f={},f.Date=u.getString(0),f.C_Payment_ID=u.getString(2),f.C_Currency_ID=u.getString(4),f.Amount=u.getDecimal(5),f.ConvertedAmount=u.getDecimal(6),f.C_BPartner_ID=u.getString(7),f.C_Payment_ID_K=u.getString(1),f.C_Currency_ID_K=u.getInt(3),f.recid=o,o++,s.push(f)}catch(h){}return s};i.prototype.saveStatment=function(){var i,n;if(this.$super.dGrid==null)return!1;var u=this.$super.mTab.getValue("C_BankStatement_ID"),r={},t=this.$super.dGrid.getSelection();if(t!=null&&!(t.length<=0)){for(i=t.toString().split(","),n=0;n<i.length;n++)r[n]=this.$super.dGrid.get(i[n]);return this.saveData(r,t,u)}};i.prototype.saveData=function(i,r,u){var f=this;t.ajax({type:"POST",url:n.Application.contextUrl+"Common/SaveStatment",dataType:"json",data:{model:i,selectedItems:r,C_BankStatement_ID:u},success:function(n){if(returnValue=n.result,returnValue){f.dispose();f.$super.$root.dialog("close");return}alert(returnValue)}})};i.prototype.dispose=function(){this.disposeComponent()};n.VCreateFromStatement=i}(VIS,jQuery),function(n,t){function i(){function c(){var t='<div style="width: 400px;margin: 20px auto;vertical-align: middle;"><div style="width: 400px;float: left;"><div style="width: 100px;float: left;   margin-top: 8px;"><span>'+n.Msg.getMsg("VISPRO_SelectTable")+'<\/span><\/div><div style="width: 300px;float: left;"><select style="width: 100%;float: left;" class="VIS_Pref_pass" id="cmbAllTable_@windowNo"><\/select><\/div><\/div><div style="float: left;margin-left: 5px;margin-top: 7px; display: none;"><input id="chkAllTable_@windowNo" type="checkbox" /><span>'+n.Msg.getMsg("VISPRO_AllTable")+'<\/span><\/div><div style="width: 400px;float: left; display: none;"><div style="width: 100px;float: left;"><span>'+n.Msg.getMsg("VISPRO_Path")+'<\/span><\/div><div style="width: 300px;float: left;"><input style="width: 81%;float: left;" class="VIS_Pref_pass" type="text" id="txtpath_@windowNo" /><input type="file" multiple="" webkitdirectory="" style="height: -1px; width:30px "><\/div><\/div><div style="width: 400px;float: left; display: none;"><div style="width: 100px;float: left;"><span>'+n.Msg.getMsg("VISPRO_EntityType")+'<\/span><\/div><div style="width: 300px;float: left;"><input id="chkClassType_@windowNo" type="checkbox" /><span>'+n.Msg.getMsg("VISPRO_ClassType")+'<\/span><\/div><\/div><div class="VIS-locator-DivStyle" style="text-align: right"><input type="button" id="btnCancel_@windowNo" style="margin-bottom:0px;margin-top:0px; float:right " value="'+n.Msg.getMsg("Cancel")+'" class="VIS_Pref_btn-2" /><input type="button" id="btnOk_@windowNo" style="margin-bottom:0px;margin-top:0px; float:right; margin-right:10px" class="VIS_Pref_btn-2" value="'+n.Msg.getMsg("VIS_Genrate")+'" /><a href="javascript:void(0)" class="VIS_Pref_pass-btn" style="display: none; margin-bottom: 0px; margin-top: 0px;float: right; margin-right: 10px;" id="btnOkA_@windowNo" >'+n.Msg.getMsg("VIS_Download")+"<\/a><\/div><\/div>";t=t.replaceAll("@windowNo",i.windowNo);r.html(t);r.append(s);u=r.find("#btnOk_"+i.windowNo);e=r.find("#btnCancel_"+i.windowNo);f=r.find("#btnOkA_"+i.windowNo);h=r.find("#cmbAllTable_"+i.windowNo);chkAllTable=r.find("#chkAllTable_"+i.windowNo);txtpath=r.find("#txtpath_"+i.windowNo);chkClassType=r.find("#chkClassType_"+i.windowNo)}function l(){y()}function a(){if(u!=null)u.on(n.Events.onTouchStartOrClick,function(){o(!0);v();o(!1)});if(f!=null)f.on(n.Events.onTouchStartOrClick,function(){f.css("display","none");u.css("display","block")});if(e!=null)e.on(n.Events.onTouchStartOrClick,function(){i.dispose()})}function v(){var e=i,r=h.find("option:selected").val();t.ajax({url:n.Application.contextUrl+"Common/GenerateXClasses",dataType:"json",data:{directory:"",chkStatus:!1,tableId:r,classType:""},success:function(t){if(t.contant!=null){var i="data:text/csv;charset=utf-8,"+encodeURIComponent(t.contant);f.attr("download",t.fileName).attr("href",i).attr("target","_blank");n.ADialog.info(t.msg);f.css("display","block");u.css("display","none")}o(!1)}})}function y(){try{for(var t=n.DB.executeReader("select Name, AD_TABLE_ID,TableName from AD_TABLE order by name",null,null);t.read();)h.append("<option value='"+t.getString(1)+"'>"+t.getString(0)+"<\/option>");t.close()}catch(i){}}function o(n){s.css("display",n?"block":"none")}this.frame;this.windowNo;this.log=n.Logging.VLogger.getVLogger("GenerateXModel");var i=this,r=t("<div style='width: 100%; height: 100%; background-color: white;'>"),s=t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>"),u=null,f=null,e=null,h=null;varchkAllTable=null;vartxtpath=null;varchkClassType=null;this.Initialize=function(){c();l();a();o(!1)};this.getRoot=function(){return r};this.disposeComponent=function(){u&&u.off(n.Events.onTouchStartOrClick);e&&e.off(n.Events.onTouchStartOrClick);i=null;this.windowNo=null;r=null;s=null;this.getRoot=null;this.disposeComponent=null}}n.AForms=n.AForms||{};i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;try{this.Initialize()}catch(i){}this.frame.getContentGrid().append(this.getRoot())};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.AForms.GenerateXModel=i}(VIS,jQuery),function(n,t){function i(t,i,r){function f(t){var s=[],u="SELECT C_ACCTSCHEMA_ID,NAME FROM C_ACCTSCHEMA WHERE C_ACCTSCHEMA_ID=(SELECT  C_ACCTSCHEMA1_ID   FROM AD_CLIENTINFO WHERE AD_CLIENT_ID="+t+")",h=null,i=n.DB.executeReader(u.toString(),null,null),r,e,f,o;for(i.read()&&(r={},h=i.getInt(0),r.Key=h,r.Name=i.getString(1),s.push(r)),i.close(),u="SELECT c_acctschema_id,name FROM C_AcctSchema acs WHERE IsActive='Y' AND EXISTS (SELECT * FROM C_AcctSchema_GL gl WHERE acs.C_AcctSchema_ID=gl.C_AcctSchema_ID) AND EXISTS (SELECT * FROM C_AcctSchema_Default d WHERE acs.C_AcctSchema_ID=d.C_AcctSchema_ID)",t!=0&&(u+=" AND AD_Client_ID="+t),u+=" ORDER BY C_AcctSchema_ID",i=n.DB.executeReader(u.toString(),null,null);i.read();)r={},e=i.getInt(0),r.Key=e,r.Name=i.getString(1),e!=h&&(u="SELECT c_acctschema_id,name from C_AcctSchema WHERE C_AcctSchema_ID="+e,f=n.DB.executeReader(u.toString(),null,null),f.read()&&(o={},o.Key=f.getInt(0),o.Name=f.getString(1),s.push(o)),f.close());return i.close(),s}var u;this.windowNo=t;this.AD_Client_ID=i;this.AD_Org_ID=0;this.DateFrom=null;this.DateTo=null;u=this;this.ASchemas=[];this.ASchema=[];this.dataByData=null;this._elements=[];this.documentQuery=!1;this.C_AcctSchema_ID=0;this.PostingType="";this.AD_Table_ID=r;this.Record_ID=0;this.whereInfo=[];this.tableInfo=[];this.sortBy1="";this.sortBy2="";this.sortBy3="";this.sortBy4="";this.group1=!1;this.group2=!1;this.group3=!1;this.group4=!1;this._leadingColumns=0;this._ref1=null;this._ref2=null;this.TABLE_ALIAS="zz";this.FUNCTION_COUNT="Count";this.FUNCTION_SUM="Sum";this.AD_Client_ID==0&&(this.AD_Client_ID=n.Env.getCtx().getContextAsInt(this.windowNo,"AD_Client_ID"));this.AD_Client_ID==0&&(this.AD_Client_ID=n.Env.getCtx().ctx.AD_Client_ID);this.ASchemas=f(this.AD_Client_ID);this.ASchema=this.ASchemas[0];this.ELEMENTTYPE_AD_Reference_ID=181;this.ELEMENTTYPE_Account="AC";this.ELEMENTTYPE_Activity="AY";this.ELEMENTTYPE_BPartner="BP";this.ELEMENTTYPE_LocationFrom="LF";this.ELEMENTTYPE_LocationTo="LT";this.ELEMENTTYPE_Campaign="MC";this.ELEMENTTYPE_Organization="OO";this.ELEMENTTYPE_OrgTrx="OT";this.ELEMENTTYPE_Project="PJ";this.ELEMENTTYPE_Product="PR";this.ELEMENTTYPE_SubAccount="SA";this.ELEMENTTYPE_SalesRegion="SR";this.ELEMENTTYPE_UserList1="U1";this.ELEMENTTYPE_UserList2="U2";this.ELEMENTTYPE_UserElement1="X1";this.ELEMENTTYPE_UserElement2="X2"}function r(r,u,f,e,o){function yu(){uu.getControl().text(n.Msg.getMsg("Selection"));pi.getControl().text(n.Msg.translate(n.Env.getCtx(),yr));wi.getControl().text(n.Msg.translate(n.Env.getCtx(),pr));d.find("label").text(n.Msg.getMsg(br));di.getControl().text(n.Msg.translate(n.Env.getCtx(),wr));gi.getControl().text(n.Msg.translate(n.Env.getCtx(),yi));bi.getControl().text(n.Msg.translate(n.Env.getCtx(),kr));ki.getControl().text(n.Msg.translate(n.Env.getCtx(),"AcctDateTo"));fu.getControl().text(n.Msg.getMsg("Display"));oi.find("label").text(n.Msg.getMsg("DisplayQty"));hi.find("label").text(n.Msg.getMsg("DisplaySourceInfo"));si.find("label").text(n.Msg.getMsg("DisplayDocumentInfo"));ur.getControl().text(n.Msg.getMsg("SortBy"));fr.getControl().text(n.Msg.getMsg("GroupBy"));at.getControl().css("color","#19A0ED");v.text(n.Msg.getMsg("RePost"));v.show();rt.find("label").text(n.Msg.getMsg("Force"));rt.show()}function pu(){bt.css("font-size","14px").css("color","#333333");wt.css("font-size","28px").css("color","#19A0ED");ut.show();nt.show();yt.css("display","none");v.hide();rt.hide()}function lr(){wt.css("font-size","14px").css("color","#333333");bt.css("font-size","28px").css("color","#19A0ED");ut.hide();nt.hide();yt.css("display","block");v.show();rt.show()}function ft(n){vi.css("display",n?"block":"none")}function wu(i){var e,s,o,u,f,r,c;for(l.dGrid!=null&&(l.dGrid.destroy(),l.dGrid=null),e=[],s=1,o=0;o<i.Data.length;o++){for(u=i.Data[o],f={},r=0;r<i.Columns.length;r++)l.arrListColumns.length!=i.Columns.length&&l.arrListColumns.push({field:i.Columns[r],caption:n.Msg.translate(n.Env.getCtx(),i.Columns[r]),sortable:!0,size:"16%",hidden:!1}),u[r]!=null&&typeof u[r]=="object"?f[i.Columns[r]]=u[r].Name:u[r]!=null&&i.Columns[r]=="Account Date"?(c=new Date(parseInt(u[r].substr(6))),e!=null&&(f[i.Columns[r]]=c.toDateString())):f[i.Columns[r]]=u[r];f.recid=s;s++;e.push(f)}setTimeout(10);w2utils.encodeTags(e);l.dGrid=t(yt).w2grid({name:"gridAccViewer"+h,recordHeight:40,columns:l.arrListColumns,records:e})}function bu(){if(wt!=null)wt.on(n.Events.onTouchStartOrClick,function(){pu()});if(bt!=null)bt.on(n.Events.onTouchStartOrClick,function(){lr()});if(ot!=null&&ot.getControl().change(function(){eu()}),g!=null)g.on("click",function(){ft(!0);li()});if(d!=null&&d.change(function(){ou()}),it!=null&&it.getControl().change(function(){su()}),v!=null)v.on("click",function(){ft(!0);var t="(SELECT ca.c_invoice_id FROM c_allocationline ca inner join c_invoice ci on ci.c_invoice_id= ca.c_invoice_id WHERE ci.issotrx='Y' and ca.c_allocationhdr_id="+s.Record_ID,i="SELECT (SELECT SUM(al.amount) FROM c_allocationline al INNER JOIN c_allocationhdr alh ON al.c_allocationhdr_id=alh.c_allocationhdr_id  WHERE  alh.posted   ='Y' and c_invoice_id="+t+")) as aloc  ,(SELECT SUM(cl.linenetamt)  FROM c_invoiceline cl WHERE  c_invoice_id     ="+t+")) as adj  from dual";setTimeout(function(){var r=n.DB.executeReader(i.toString(),null,null),u;r.read()&&r.getInt(0)-r.getInt(1)==0&&(u="update c_allocationhdr alh set alh.posted ='N' where alh.c_allocationhdr_id in (select c_allocationhdr_id from c_allocationline where c_invoice_id="+t+"))",n.DB.executeQuery(u));r.close();r=null},5);gu()});if(c!=null)c.on("click",function(){kt(c)});if(y!=null)y.on("click",function(){kt(y)});if(p!=null)p.on("click",function(){kt(p)});if(w!=null)w.on("click",function(){kt(w)});if(b!=null)b.on("click",function(){kt(b)});if(k!=null)k.on("click",function(){kt(k)})}function ku(){cr=t("<div id='topDiv_"+h+"' style='float: left; width: 100%; height: 45px; margin-bottom: 2px;margin-left: 0px;'><div id='queryDiv_"+h+"'style='display: inline-block;  padding-left: 15px;margin-right: 15px;' ><label id='lblquery_"+h+"' class='VIS_Pref_Label_Font' style='vertical-align: middle; cursor: pointer;font-size: 28px;color: #19A0ED;'>"+n.Msg.getMsg("ViewerQuery")+"<\/label><\/div><div id='resulttopDiv_"+h+"' style='display: inline-block; width: 160px;'><label id='lblresult_"+h+"' class='VIS_Pref_Label_Font' style='vertical-align: middle; cursor: pointer;'>"+n.Msg.getMsg("ViewerResult")+"<\/label><\/div><\/div>");nt=t("<div id='leftSideDiv_"+h+"' style='float: left; margin-bottom: 3px; margin-left: 0px;background-color: #F1F1F1; '>");n.Application.isRTL&&(nt.css("float","right"),g.css("float","left"),v.css("float","right"));nt.css("width","50%");nt.css("height",ci);vt=t("<div style='float: left;width: 100%;height: 100%;' id='parameterLeftDiv_"+h+"'>");nt.append(vt);var u=t("<table style='width: 100%;height: 100%;'>"),r=t("<tr>"),i=t("<td style='padding: 4px 2px 2px;'>");vt.append(u);u.append(r);r.append(i);i.append(pi.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));i=t("<td style='padding: 0px 15px 0px; '>");r.append(i);i.append(ot.getControl().css("display","inline-block").css("width","100%").css("height","32px"));r=t("<tr>");i=t("<td style='padding: 4px 2px 2px;'>");u.append(r);r.append(i);i.append(wi.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));i=t("<td style='padding: 0px 15px 0px;'>");r.append(i);i.append(ii.getControl().css("display","inline-block").css("width","100%").css("height","32px"));r=t("<tr>");i=t("<td style='padding: 4px 2px 2px;'>");u.append(r);r.append(i);i.append(d);i=t("<td style='padding: 0px 15px 0px;'>");r.append(i);i.append(it.getControl().css("display","inline-block").css("width","100%").css("height","32px"));i.append(c);r=t("<tr>");i=t("<td style='padding: 4px 2px 2px;'>");u.append(r);r.append(i);i.append(bi.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));i=t("<td style='padding: 0px 15px 0px;'>");r.append(i);i.append(gt);r=t("<tr>");i=t("<td style='padding: 4px 2px 2px;'>");u.append(r);r.append(i);i.append(ki.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));i=t("<td style='padding: 0px 15px 0px;'>");r.append(i);i.append(ni);r=t("<tr>");i=t("<td style='padding: 4px 2px 2px;'>");u.append(r);r.append(i);i.append(di.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));i=t("<td style='padding: 0px 15px 0px;'>");r.append(i);i.append(pt.getControl().css("display","inline-block").css("width","100%").css("height","32px"));r=t("<tr>");i=t("<td style='padding: 4px 2px 2px;'>");u.append(r);r.append(i);i.append(gi.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));i=t("<td style='padding: 0px 15px 0px;'>");r.append(i);i.append(y);r=t("<tr>");i=t("<td style='padding: 4px 2px 2px;'>");u.append(r);r.append(i);i.append(nr.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));i=t("<td style='padding: 0px 15px 0px;'>");r.append(i);i.append(p);r=t("<tr>");i=t("<td style='padding: 4px 2px 2px;'>");u.append(r);r.append(i);i.append(tr.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));i=t("<td style='padding: 0px 15px 0px;'>");r.append(i);i.append(w);r=t("<tr>");i=t("<td style='padding: 4px 2px 2px;'>");u.append(r);r.append(i);i.append(ir.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));i=t("<td style='padding: 0px 15px 0px;'>");r.append(i);i.append(b);r=t("<tr>");i=t("<td style='padding: 4px 2px 2px;'>");u.append(r);r.append(i);i.append(rr.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));i=t("<td style='padding: 0px 15px 0px;'>");r.append(i);i.append(k);ut=t("<div id='rightSideDiv_"+h+"' style='float: right;margin-bottom: 3px; margin-right: 0px; '>");ut.css("width","50%");ut.css("height",ci);vt=t("<div style='float: left;width: 100%;height: 100%;' id='parameterRightDiv_"+h+"'>");ut.append(vt);u=t("<table style='width: 100%;height: 100%;'>");r=t("<tr>");i=t("<td style='padding: 4px 15px 2px;'>");vt.append(u);u.append(r);r.append(i);i.append(si);r=t("<tr>");i=t("<td style='padding: 0px 15px 0px;'>");u.append(r);r.append(i);i.append(hi);r=t("<tr>");i=t("<td style='padding: 4px 15px 2px;'>");u.append(r);r.append(i);i.append(oi);r=t("<tr>");i=t("<td style='padding: 4px 15px 2px;'>");u.append(r);r.append(i);i.append(ur.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));i=t("<td style='padding: 4px 15px 2px;'>");r.append(i);i.append(fr.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));r=t("<tr>");i=t("<td style='padding: 0px 15px 0px;'>");u.append(r);r.append(i);i.append(st.getControl().css("display","inline-block").css("width","100%").css("height","32px"));i=t("<td style='padding: 4px 15px 2px;'>");r.append(i);i.append(er);r=t("<tr>");i=t("<td style='padding: 0px 15px 0px;'>");u.append(r);r.append(i);i.append(ht.getControl().css("display","inline-block").css("width","100%").css("height","32px"));i=t("<td style='padding: 4px 15px 2px;'>");r.append(i);i.append(or);r=t("<tr>");i=t("<td style='padding: 0px 15px 0px;'>");u.append(r);r.append(i);i.append(ct.getControl().css("display","inline-block").css("width","100%").css("height","32px"));i=t("<td style='padding: 4px 15px 2px;'>");r.append(i);i.append(sr);r=t("<tr>");i=t("<td style='padding: 0px 15px 0px;'>");u.append(r);r.append(i);i.append(lt.getControl().css("display","inline-block").css("width","100%").css("height","32px"));i=t("<td style='padding: 4px 15px 2px;'>");r.append(i);i.append(hr);tt=t("<div style='float: left;background-color: #F1F1F1; width:100%'>");tt.css("height",50);tt.append(v);tt.append(rt);tt.append(at.getControl().css("margin-left","10px").css("margin-right","10px").css("margin-top","15px").addClass("VIS_Pref_Label_Font"));tt.append(g);tt.append(dt);yt=t("<div id='resultDiv_"+h+"' style='float: left; width: 100%; display: none; margin-bottom: 2px;margin-left: 0px;background-color: #F1F1F1;'>");yt.css("height",ci);et.append(cr).append(nt).append(ut).append(yt).append(tt);et.append(vi)}function du(t,u){s||(s=new i(h,r,t));setTimeout(function(){ai(ot.getControl(),s.getAcctSchema());eu();ai(it.getControl(),s.getTable());ai(ii.getControl(),s.getPostingType());ai(pt.getControl(),s.getOrg())},2);c.find("span").text("");y.attr("Name",yi);y.find("span").text("");var f=t!=0&&u!=0;f&&d.prop("checked",!0);ou();su();at.getControl().text(n.Msg.getMsg("EnterSelctionAndDisplayToQueryFind"));at.getControl().css("color","#19A0ED");f&&(s.AD_Table_ID=t,s.Record_ID=u)}function eu(){var o=ot.getControl().find("option:selected").val(),e,t,i,r,u;if(o!=null){for(s.C_AcctSchema_ID=o,e=s.getAcctSchemaElements(s.C_AcctSchema_ID),st.getControl().empty(),ht.getControl().empty(),ct.getControl().empty(),lt.getControl().empty(),ti({Key:"",Name:""}),ti({Key:"DateAcct",Name:n.Msg.translate(n.Env.getCtx(),"DateAcct")}),ti({Key:"DateTrx",Name:n.Msg.translate(n.Env.getCtx(),"DateTrx")}),ti({Key:"C_Period_ID",Name:n.Msg.translate(n.Env.getCtx(),"C_Period_ID")}),t=[],t.push(nr),t.push(tr),t.push(ir),t.push(rr),t.push(nu),t.push(tu),t.push(iu),t.push(ru),i=[],i.push(p),i.push(w),i.push(b),i.push(k),i.push(ri),i.push(ui),i.push(fi),i.push(ei),r=0,u=0;u<e.length&&r<t.length;u++){var f=e[u][0],h=s.getColumnName(f.elementtype),c=s.getColumnName(f.elementtype);ti({Key:h,Name:n.Msg.translate(n.Env.getCtx(),c)});f.elementtype=="OO"||f.elementtype=="AC"||(t[r].getControl().text(n.Msg.translate(n.Env.getCtx(),c)),t[r].getControl().show(),i[r].attr("Name",h),i[r].find("span").text(""),i[r].show(),r++)}while(r<t.length)t[r].getControl().hide(),i[r++].hide();st.getControl().prop("selectedIndex",0);ht.getControl().prop("selectedIndex",0);ct.getControl().prop("selectedIndex",0);lt.getControl().prop("selectedIndex",0)}}function ti(n){st.getControl().append(" <option selected value='"+n.Key+"' >"+n.Name+"<\/option>");ht.getControl().append(" <option selected value='"+n.Key+"' >"+n.Name+"<\/option>");ct.getControl().append(" <option selected value='"+n.Key+"' >"+n.Name+"<\/option>");lt.getControl().append(" <option selected value='"+n.Key+"' >"+n.Name+"<\/option>")}function li(){var t="",i,u,f;if(s.C_AcctSchema_ID=0,s.AD_Org_ID=0,i=ot.getControl().find("option:selected").val(),i!=null&&(s.C_AcctSchema_ID=i),t=t.concat("C_AcctSchema_ID=").concat(s.C_AcctSchema_ID),i=ii.getControl().find("option:selected").val(),i!=null&&i!="0"&&(s.PostingType=i),t=t.concat(", PostingType=").concat(s.PostingType),s.documentQuery=d.prop("checked"),t=t.concat(", DocumentQuery=").concat(s.documentQuery),d.prop("checked")){if(s.AD_Table_ID==0||s.Record_ID==0)return;t=t.concat(", AD_Table_ID=").concat(s.AD_Table_ID).concat(", Record_ID=").concat(s.Record_ID)}else if(s.DateFrom=gt.val(),s.DateFrom!=""&&(t=t.concat(", DateFrom=").concat(s.DateFrom)),s.DateTo=ni.val(),s.DateTo!=""&&(t=t.concat(", DateTo=").concat(s.DateTo)),i=pt.getControl().find("option:selected").val(),i!=null&&(s.AD_Org_ID=i),t=t.concat(", AD_Org_ID=").concat(s.AD_Org_ID),u=s.whereInfo,u!=null)for(f=0;f<u.length;f++)t=t.concat(", ").concat(u[f]);s.displayQty=oi.prop("checked");t=t.concat(", - Display Qty=").concat(s.displayQty);s.displaySourceAmt=hi.prop("checked");t=t.concat(", Source=").concat(s.displaySourceAmt);s.displayDocumentInfo=si.prop("checked");t=t.concat(", Doc=").concat(s.displayDocumentInfo);st.getControl().find("option:selected").val()!=null&&(s.sortBy1=st.getControl().find("option:selected").val());s.group1=er.prop("checked");t=t.concat(" - Sorting: ").concat(s.sortBy1).concat("/").concat(s.group1);ht.getControl().find("option:selected").val()!=null&&(s.sortBy2=ht.getControl().find("option:selected").val());s.group2=or.prop("checked");t=t.concat(", ").concat(s.sortBy2).concat("/").concat(s.group2);ct.getControl().find("option:selected").val()!=null&&(s.sortBy3=ct.getControl().find("option:selected").val());s.group3=sr.prop("checked");t=t.concat(", ").concat(s.sortBy3).concat("/").concat(s.group3);lt.getControl().find("option:selected").val()!=null&&(s.sortBy4=lt.getControl().find("option:selected").val());s.group4=hr.prop("checked");t=t.concat(", ").concat(s.sortBy4).concat("/").concat(s.group4);g.Enabled=!1;at.getControl().text(n.Msg.translate(n.Env.getCtx(),"Processing"));lr();setTimeout(function(){var n=s.Query(r);n!=null&&(wu(n),ft(!1))},2);g.Enabled=!0;at.getControl().text(n.Msg.getMsg("EnterSelctionAndDisplayToQueryFind"))}function ou(){var n=d.prop("checked");n?(it.getControl().removeAttr("disabled"),c.removeAttr("disabled"),gt.attr("disabled","disabled"),ni.attr("disabled","disabled"),pt.getControl().attr("disabled","disabled"),y.attr("disabled","disabled"),p.attr("disabled","disabled"),w.attr("disabled","disabled"),b.attr("disabled","disabled"),k.attr("disabled","disabled"),ri.attr("disabled","disabled"),ui.attr("disabled","disabled"),fi.attr("disabled","disabled"),ei.attr("disabled","disabled")):(it.getControl().attr("disabled","disabled"),c.attr("disabled","disabled"),gt.removeAttr("disabled"),ni.removeAttr("disabled"),pt.getControl().removeAttr("disabled"),y.removeAttr("disabled"),p.removeAttr("disabled"),w.removeAttr("disabled"),b.removeAttr("disabled"),k.removeAttr("disabled"),ri.removeAttr("disabled"),ui.removeAttr("disabled"),fi.removeAttr("disabled"),ei.removeAttr("disabled"))}function su(){var n=it.getControl().find("option:selected").val();n!=null&&(s.AD_Table_ID=jQuery.grep(s.tableInfo,function(t){return t.Name==n})[0].Key);s.Record_ID=0;c.find("span").text("");c.attr("Name",n+"_ID")}function kt(t){var u=t.attr("name"),f="IsSummary='N'",r=u,i,o,e;u.equals("Account_ID")?(r="C_ElementValue_ID",i=s.getAcctSchemaElement("AC"),i!=null&&(f+=" AND C_Element_ID="+i.c_element_id)):u.equals("User1_ID")?(r="C_ElementValue_ID",i=s.getAcctSchemaElement("U1"),i!=null&&(f+=" AND C_Element_ID="+i.c_element_id)):u.equals("User2_ID")?(r="C_ElementValue_ID",i=s.getAcctSchemaElement("U2"),i!=null&&(f+=" AND C_Element_ID="+i.c_element_id)):d.prop("checked")&&(f="");o=r.substring(0,r.length-3);e=new n.infoGeneral(!0,s.windowNo,"",o,r,!1,f);e.onClose=function(){var i=null,n=e.getSelectedValues();return(n!=null&&(i=r+"="+n.toString()),e=null,i==null||i.length==0||n==null)?(t.find("span").text(""),s.whereInfo.Remove(u),t.width=44,0):(t==c?s.Record_ID=n:s.whereInfo.push({Key:u,Value:u+"="+n}),t.find("span").text(s.getButtonText(o,r,i)),t.find("span").text()!=""?t.AutoSize=!0:t.Width=44,n)};e.show()}function gu(){var i,r,u;n.ADialog.ask("PostImmediate?")&&s.documentQuery&&s.AD_Table_ID!=0&&s.Record_ID!=0&&(i=rt.prop("checked"),window.FRPT?(r=Number(n.context.getWindowTabContext(h,0,"AD_Org_ID")),u=Number(n.context.getWindowTabContext(h,0,"C_DocType_ID")),t.ajax({url:n.Application.contextUrl+"FRPT/PostingLogicFRPT/PostImediateFRPT",dataType:"json",async:!1,data:{AD_Client_ID:s.AD_Client_ID,AD_Table_ID:s.AD_Table_ID,Record_ID:s.Record_ID,force:i,OrgID:r,AD_Window_ID:cu,DocTypeID:u},error:function(){ft(!1);n.ADialog.info(n.Msg.getMsg("ERRORGettingPostingServer"))},success:function(n){n.result&&li();ft(!1)}})):t.ajax({url:n.Application.contextUrl+"Posting/PostImmediate",dataType:"json",data:{AD_Client_ID:s.AD_Client_ID,AD_Table_ID:s.AD_Table_ID,Record_ID:s.Record_ID,force:i},error:function(){ft(!1);n.ADialog.info(n.Msg.getMsg("ERRORGettingPostingServer"))},success:function(n){n.result=="OK"&&li();ft(!1)}}))}function ai(n,t){for(var i=0;i<t.length;i++)n.append(" <option selected value='"+t[i].Key+"' >"+t[i].Name+"<\/option>");n.prop("selectedIndex",0)}var et=t("<div style='position:relative;'>"),vi=t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>"),l=this,hu=r,ar=u,vr=f,h=e,cu=o;this.arrListColumns=[];this.dGrid=null;var yr="C_AcctSchema_ID",lu="DocumentType",pr="PostingType",wr="AD_Org_ID",yi="Account_ID",br="SelectDocument",kr="AcctDateFrom",a=n.Application.contextUrl+"Areas/VIS/Images/base/Find24.gif",dr=n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png",gr=n.Application.contextUrl+"Areas/VIS/Images/base/Print24.PNG",g=t("<button id='btnRefresh_"+h+"'style='margin-bottom: 1px; margin-top: 6px; float: right; margin-left: 15px; height: 38px;' class='VIS_Pref_btn-2'><img src='"+dr+"'/><\/button>"),dt=t("<button id='btnPrint_"+h+"' style='border: 0px;background-color: transparent; padding: 0px;float: right;margin-right: 10px;margin-top: 5px;'><img src='"+gr+"'/><\/button>"),v=t("<button id='btnRePost_"+h+"' style='float: left; display: inline-block;height: 30px;margin-top: 10px;margin-left: 5px;' ><img src='"+a+"'/><\/button>"),c=t("<button Name='btnSelctDoc' id='btnSelctDoc_"+h+"' style='height:30px; margin-top: 1px;'><img src='"+a+"'/><span style='padding-left: 3px;'><\/span><\/button>"),y=t("<button  Name='btnAccount' id='btnAccount_"+h+"'   style='height:30px; padding: 0px;'><img src='"+a+"'/><span style='padding-left: 3px;'><\/span><\/button>"),p=t("<button  Name='btnProduct' id='btnProduct_"+h+"'   style='height:30px; padding: 0px;'><img src='"+a+"'/><span style='padding-left: 3px;'><\/span><\/button>"),w=t("<button Name='btnBPartner' id='btnBPartner_"+h+"' style='height:30px; padding: 0px;'><img src='"+a+"'/><span style='padding-left: 3px;'><\/span><\/button>"),b=t("<button  Name='btnProject' id='btnProject_"+h+"'   style='height:30px; padding: 0px;'><img src='"+a+"'/><span style='padding-left: 3px;'><\/span><\/button>"),k=t("<button Name='btnCampaning' id='btnCampaning_"+h+"' style=' height:30px; padding: 0px;'><img src='"+a+"'/><span style='padding-left: 3px;'><\/span><\/button>"),ot=new n.Controls.VComboBox("",!1,!1,!0),ii=new n.Controls.VComboBox("",!1,!1,!0),pt=new n.Controls.VComboBox("",!1,!1,!0),it=new n.Controls.VComboBox("",!1,!1,!0),st=new n.Controls.VComboBox("",!1,!1,!0),ht=new n.Controls.VComboBox("",!1,!1,!0),ct=new n.Controls.VComboBox("",!1,!1,!0),lt=new n.Controls.VComboBox("",!1,!1,!0),pi=new n.Controls.VLabel,wi=new n.Controls.VLabel,bi=new n.Controls.VLabel,ki=new n.Controls.VLabel,di=new n.Controls.VLabel,gi=new n.Controls.VLabel,nr=new n.Controls.VLabel,tr=new n.Controls.VLabel,ir=new n.Controls.VLabel,rr=new n.Controls.VLabel,ur=new n.Controls.VLabel,fr=new n.Controls.VLabel,nu=new n.Controls.VLabel,tu=new n.Controls.VLabel,iu=new n.Controls.VLabel,ru=new n.Controls.VLabel,ri=t("<button id='btnSel5_"+h+"' style='border: 0px;background-color: transparent; padding: 0px;'><img src='"+a+"' /><span><\/span><\/button>"),ui=t("<button id='btnSel6_"+h+"' style='border: 0px;background-color: transparent; padding: 0px;'><img src='"+a+"' /><span><\/span><\/button>"),fi=t("<button id='btnSel7_"+h+"' style='border: 0px;background-color: transparent; padding: 0px;'><img src='"+a+"' /><span><\/span><\/button>"),ei=t("<button id='btnSel8_"+h+"' style='border: 0px;background-color: transparent; padding: 0px;'><img src='"+a+"' /><span><\/span><\/button>"),at=new n.Controls.VLabel,uu=new n.Controls.VLabel,fu=new n.Controls.VLabel,wt=null,bt=null,d=t("<input id='chkSelectDoc_"+h+"' type='checkbox' checked class='VIS_Pref_automatic'><span><label id='lblSelectDoc_"+h+"' class='VIS_Pref_Label_Font'>SelectDoc<\/label><\/span>"),oi=t("<input id='chkQty_"+h+"' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblQty_"+h+"' class='VIS_Pref_Label_Font'>chkQty<\/label><\/span>"),rt=t("<input id='chkforcePost_"+h+"' type='checkbox' class='VIS_Pref_automatic' style='display: inline-block;margin-left: 20px;'><span><label id='lblforcePost_"+h+"' class='VIS_Pref_Label_Font'>chkforcePost<\/label><\/span>"),si=t("<input id='chkDisDocinfo_"+h+"' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblDisDocinfo_"+h+"' class='VIS_Pref_Label_Font'>chkDisDocinfo<\/label><\/span>"),hi=t("<input id='chkDisSouce_"+h+"' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblDisSouce_"+h+"' class='VIS_Pref_Label_Font'>chkDisSouce<\/label><\/span>"),er=t("<input id='chkSumriz1_"+h+"' type='checkbox' class='VIS_Pref_automatic'>"),or=t("<input id='chkSumriz2_"+h+"' type='checkbox' class='VIS_Pref_automatic'>"),sr=t("<input id='chkSumriz3_"+h+"' type='checkbox' class='VIS_Pref_automatic'>"),hr=t("<input id='chkSumriz4_"+h+"' type='checkbox' class='VIS_Pref_automatic'>"),gt=t("<input id='vdtpkAccDateFrom_"+h+"' type='date' name='DateOrdered' style='display: inline-block;line-height: 23px;width:100%'>"),ni=t("<input id='vdtpkAccDateTo_"+h+"' type='date' name='DateOrdered' style='display: inline-block;line-height: 23px;width:100%'>"),cr=null,nt=null,ut=null,vt=null,tt=null,yt=null,au=t(window).width()/2,vu=t(window).width()/2,ci=t(window).height()-200,s=null;this.showDialog=function(){ku();ft(!0);wt=et.find("#lblquery_"+h);bt=et.find("#lblresult_"+h);lr();v.hide();rt.hide();dt.hide();setTimeout(function(){yu();bu()},2);du(ar,vr);et.dialog({modal:!0,resizable:!1,title:n.Msg.getMsg("AcctViewer"),width:t(window).width()/2+t(window).width()/4,position:{at:"center top",of:window},close:function(){l.dGrid!=null&&(l.dGrid.destroy(),l.dGrid=null);l.dispose();l=null;et.dialog("destroy");et=null}});li()};this.disposeComponent=function(){g&&g.off("click");dt&&dt.off("click");v&&v.off("click");c&&c.off("click");y&&y.off("click");p&&p.off("click");w&&w.off("click");b&&b.off("click");k&&k.off("click");hu=null;ar=null;vr=null;h=null;this.arrListColumns=null;this.dGrid=null;yr=null;lu=null;pr=null;wr=null;yi=null;br=null;kr=null;a=null;dr=null;gr=null;g=null;dt=null;v=null;c=null;y=null;p=null;w=null;b=null;k=null;ot=null;ii=null;pt=null;it=null;st=null;ht=null;ct=null;lt=null;pi=null;wi=null;bi=null;ki=null;di=null;gi=null;nr=null;tr=null;ir=null;rr=null;ur=null;fr=null;nu=null;tu=null;iu=null;ru=null;ri=null;ui=null;fi=null;ei=null;at=null;uu=null;fu=null;wt=null;bt=null;d=null;oi=null;rt=null;si=null;hi=null;er=null;or=null;sr=null;hr=null;gt=null;ni=null;cr=null;nt=null;ut=null;vt=null;tt=null;yt=null;au=null;vu=null;ci=null;s=null;vi=null;this.disposeComponent=null}}i.prototype.getAcctSchema=function(){return this.ASchemas};i.prototype.getTable=function(){var r=[],f=null,t;try{for(t=n.DB.executeReader("SELECT AD_Table_ID, TableName FROM AD_Table t WHERE EXISTS (SELECT * FROM AD_Column c WHERE t.AD_Table_ID=c.AD_Table_ID AND c.ColumnName='Posted') AND IsView='N'".toString(),null,null);t.read();){var u=t.getInt(0),i=t.getString(1),e=n.Msg.translate(n.Env.getCtx(),i+"_ID");r.push({Key:i,Name:e});this.tableInfo.push({Key:u,Name:i});u==this.AD_Table_ID&&(f=i)}t.close()}catch(o){}return r};i.prototype.getOrg=function(){var i=[],r="SELECT AD_Org_ID, Name FROM AD_Org WHERE AD_Client_ID="+this.AD_Client_ID+" ORDER BY Value",t=n.DB.executeReader(r.toString(),null,null);for(i.push({Key:0,Name:""});t.read();)i.push({Key:t.getInt(0),Name:t.getString(1)});return t.close(),i};i.prototype.getPostingType=function(){var i=[],t=n.DB.executeReader(" SELECT Value, Name FROM AD_Ref_List WHERE AD_Reference_ID=125 AND IsActive='Y' ORDER BY 1".toString(),null,null);for(i.push({Key:0,Name:""});t.read();)i.push({Key:t.getString(0),Name:t.getString(1)});return t.close(),i};i.prototype.getAcctSchemaElements=function(t){var f=t,u,i,r;this._elements=[];u="SELECT c_acctschema_element_id,name,elementtype,c_elementvalue_id,seqno,'AcctSchemaElement['||c_acctschema_element_id||'-'||name||'('||elementtype||')='||c_elementvalue_id||',Pos='||seqno||']' as detail,c_element_id FROM C_AcctSchema_Element WHERE C_AcctSchema_ID="+f+" AND IsActive='Y' ORDER BY SeqNo";try{for(i=n.DB.executeReader(u.toString(),null,null);i.read();)r=[],r.push({c_acctschema_element_id:i.getInt(0),name:i.getString(1),elementtype:i.getString(2),c_elementvalue_id:i.getInt(3),seqno:i.getString(4),detail:i.getString(5),c_element_id:i.getInt(6)}),this._elements.push(r);i.close()}catch(e){}return this._elements};i.prototype.getAcctSchemaElement=function(n){var t,i;for(this._elements==null&&this.getAcctSchemaElements(),t=0;t<this._elements.length;t++)if(i=this._elements[t][0],i.elementtype.equals(n))return i;return null};i.prototype.getColumnName=function(n){return n.equals(this.ELEMENTTYPE_Organization)?"AD_Org_ID":n.equals(this.ELEMENTTYPE_Account)?"Account_ID":n.equals(this.ELEMENTTYPE_BPartner)?"C_BPartner_ID":n.equals(this.ELEMENTTYPE_Product)?"M_Product_ID":n.equals(this.ELEMENTTYPE_Activity)?"C_Activity_ID":n.equals(this.ELEMENTTYPE_LocationFrom)?"C_LocFrom_ID":n.equals(this.ELEMENTTYPE_LocationTo)?"C_LocTo_ID":n.equals(this.ELEMENTTYPE_Campaign)?"C_Campaign_ID":n.equals(this.ELEMENTTYPE_OrgTrx)?"AD_OrgTrx_ID":n.equals(this.ELEMENTTYPE_Project)?"C_Project_ID":n.equals(this.ELEMENTTYPE_SalesRegion)?"C_SalesRegion_ID":n.equals(this.ELEMENTTYPE_UserList1)?"User1_ID":n.equals(this.ELEMENTTYPE_UserList2)?"User2_ID":n.equals(this.ELEMENTTYPE_UserElement1)?"UserElement1_ID":n.equals(this.ELEMENTTYPE_UserElement2)?"UserElement2_ID":""};i.prototype.getButtonText=function(t,i,r){var f="SELECT (",o=n.Env.getAD_Language(n.Env.getCtx()),e,u;f=f.concat(n.MLookupFactory.getLookup_TableDirEmbed(o,i,"avd",i)).concat(") FROM ").concat(t).concat(" avd WHERE avd.").concat(r);e="<"+r+">";try{u=n.DB.executeReader(f.toString(),null,null);u.read()&&(e=u.getString(0));u.close()}catch(s){}return e};i.prototype.Query=function(t){var i="",u,f,e,r;if(this.C_AcctSchema_ID!=0&&(i=i.concat(this.TABLE_ALIAS).concat(".C_AcctSchema_ID=").concat(this.C_AcctSchema_ID)),this.PostingType!=null&&this.PostingType.length>0&&(i.length>0&&(i=i.concat(" AND ")),i=i.concat(this.TABLE_ALIAS).concat(".PostingType='").concat(this.PostingType).concat("'")),this.documentQuery)i.length>0&&(i=i.concat(" AND ")),i=i.concat(this.TABLE_ALIAS).concat(".AD_Table_ID=").concat(this.AD_Table_ID).concat(" AND ").concat(this.TABLE_ALIAS).concat(".Record_ID=").concat(this.Record_ID);else{if(u=this.whereInfo,u!=null)for(f=0;f<u.length;f++)e=u[f],e!=null&&e.length>0&&(i.length>0&&(i=i.concat(" AND ")),i=i.concat(this.TABLE_ALIAS).concat(".").concat(e));(this.DateFrom!=null||this.DateTo!=null)&&(i.length>0&&(i=i.concat(" AND ")),i=this.DateFrom!=null||this.DateTo!=null?i.concat("TRUNC(").concat(this.TABLE_ALIAS).concat(".DateAcct,'DD') BETWEEN ").concat(n.DB.to_date(this.DateFrom)).concat(" AND ").concat(n.DB.to_date(this.DateTo)):this.DateFrom!=null?i.concat("TRUNC(").concat(this.TABLE_ALIAS).concat(".DateAcct,'DD') >= ").concat(n.DB.to_date(this.DateFrom)):i.concat("TRUNC(").concat(this.TABLE_ALIAS).concat(".DateAcct,'DD') <= ").concat(n.DB.to_date(this.DateTo)));this.AD_Org_ID!=0&&(i.length>0&&(i=i.concat(" AND ")),i=i.concat(this.TABLE_ALIAS).concat(".AD_Org_ID=").concat(this.AD_Org_ID))}return r="",this.sortBy1.length>0&&(r=r.concat(this.TABLE_ALIAS).concat(".").concat(this.sortBy1)),this.sortBy2.length>0&&(r.length>0&&(r=r.concat(",")),r=r.concat(this.TABLE_ALIAS).concat(".").concat(this.sortBy2)),this.sortBy3.length>0&&(r.length>0&&(r=r.concat(",")),r=r.concat(this.TABLE_ALIAS).concat(".").concat(this.sortBy3)),this.sortBy4.length>0&&(r.length>0&&(r=r.concat(",")),r=r.concat(this.TABLE_ALIAS).concat(".").concat(this.sortBy4)),r.length==0&&(r=r.concat(this.TABLE_ALIAS).concat(".Fact_Acct_ID")),this.getDataModel(t,i,r,this.group1,this.group2,this.group3,this.group4,this.sortBy1,this.sortBy2,this.sortBy3,this.sortBy4),this.dataByData};i.prototype.getDataModel=function(i,r,u,f,e,o,s,h,c,l,a){var v=this;t.ajax({url:n.Application.contextUrl+"Common/GetDataQuery",async:!1,dataType:"json",type:"POST",data:{AD_Client_ID:i,whereClause:r,orderClause:u,gr1:f,gr2:e,gr3:o,gr4:s,sort1:h,sort2:c,sort3:l,sort4:a},success:function(n){return v.dataByData=n.result,n.result}})};r.prototype.dispose=function(){this.disposeComponent()};n.AcctViewer=r}(VIS,jQuery),function(n,t){function i(){function b(){var nt="topDiv_"+i.windowNo,v="btnSpaceDiv_"+i.windowNo,tt="btnSpace_"+i.windowNo,it="spnSelect_"+i.windowNo,rt="spnGenerate_"+i.windowNo,y="lblGenerate_"+i.windowNo,p="lblSelect_"+i.windowNo,s=n.Application.contextUrl+"Areas/VIS/Images/base/arrow-left.png",w,b,k,d,h,g,l,a;i.topDiv=t("<div id='"+nt+"' style='float: left; width: 100%; height: 45px; margin-bottom: 2px;margin-left: 0px;'><div id='"+v+"' style='width: 260px; height: 45px;float: left;padding-left: 11px; padding-top: 11px;; background-color: #F1F1F1;'><button id='"+tt+"' style='border: 0px;background-color: transparent; padding: 0px;' ><img src='"+s+"' /><\/button><\/div><div id='"+it+"'style='display: inline-block;  padding-left: 15px;margin-right: 15px;' ><label id='"+p+"' class='VIS_Pref_Label_Font' style='vertical-align: middle;font-size: 28px;color: #19A0ED;'>"+n.Msg.translate(n.Env.getCtx(),"Select")+"<\/label><\/div><div id='"+rt+"' style='display: inline-block; width: 160px;'><label id='"+y+"' class='VIS_Pref_Label_Font' style='vertical-align: middle;font-size: 17px;'>"+n.Msg.translate(n.Env.getCtx(),"Generate")+"<\/label><\/div><\/div>");w="sideDiv_"+i.windowNo;b="parameterDiv_"+i.windowNo;i.btnSpaceDiv=i.topDiv.find("#"+v);this.lblGenrate=i.topDiv.find("#"+y);this.lblSelect=i.topDiv.find("#"+p);i.sideDiv=t("<div id='"+w+"' style='float: left; margin-left: 0px; background-color: #F1F1F1;'>");i.sideDiv.css("width",r);i.sideDiv.css("height",c);i.div=t("<div style='float: left; width: 100%;' id='"+b+"'>");i.sideDiv.append(i.div);var o=t("<table style='width: 100%;'>"),u=t("<tr>"),f=t("<td style='padding: 4px 15px 2px;'>");i.div.append(o);o.append(u);u.append(f);f.append(i.lblWarehouse.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));u=t("<tr>");f=t("<td style='padding: 0px 15px 0px;'>");o.append(u);u.append(f);f.append(i.cmbWarehouse.getControl().css("display","inline-block").css("width","236px").css("height","30px"));u=t("<tr>");f=t("<td style='padding: 4px 15px 2px;'>");o.append(u);u.append(f);f.append(i.lblBPartner.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));u=t("<tr>");f=t("<td style='padding: 0px 15px 0px;'>");o.append(u);u.append(f);f.append(i.vSearchBPartner.getControl().css("width","206px")).append(i.vSearchBPartner.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB"));k="gridSelectDiv_"+i.windowNo;d="gridGenerateDiv_"+i.windowNo;i.gridSelectDiv=t("<div id='"+k+"' style='float: right; margin-right: 15px;border: 1px solid darkgray;'>");i.gridSelectDiv.css("width",e);i.gridSelectDiv.css("height",c);i.gridGenerateDiv=t("<div id='"+d+"' style='height: 85%; float: right; display: none; background-color: #F1F1F1; margin-left: 15px;;margin-right: 15px;'>");i.gridGenerateDiv.css("width",t(window).width()-30);h="btnOk_"+i.windowNo;i.okBtn=t("<input id='"+h+"' class='VIS_Pref_btn-2' style='margin-bottom: 1px; margin-top: 1px; float: right; margin-right: 15px ;width: 70px;height: 38px;' type='button' value='Ok'>");h="btnRefresh_"+i.windowNo;s=n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png";i.btnRefresh=t("<button id='"+h+"' style='margin-bottom: 1px; margin-top: 0px; float: left; margin-left: 15px; height: 38px;' class='VIS_Pref_btn-2'><img src='"+s+"'><\/button>");g="discriptionDiv_"+i.windowNo;i.bottumDiv=t("<div style='width: 100%; height: 50px; float: left; margin-bottom: 0px;margin-top: 5px;'>");l=t("<div id='"+g+"' style='width: 69%; float: left; margin-bottom: 0px;  padding-top: 8px;padding-left: 10px; text-align: left;'>");l.append(i.lblStatusInfo.getControl().addClass("VIS_Pref_Label_Font"));a=t("<div style='width: 175px; float: right; text-align: right; margin-bottom: 0px;'>");a.append(i.okBtn);i.bottumDiv.append(i.btnRefresh).append(l).append(a);i.$root.append(i.$busyDiv);i.$root.append(i.topDiv).append(i.sideDiv).append(i.gridSelectDiv).append(i.gridGenerateDiv).append(i.bottumDiv)}function k(){i.lblWarehouse.getControl().text(n.Msg.translate(n.Env.getCtx(),"M_Warehouse_ID"));i.lblBPartner.getControl().text(n.Msg.translate(n.Env.getCtx(),"C_BPartner_ID"));i.tabSelect.getControl().text(n.Msg.getMsg("Select",!1,!1));i.tabGenrate.getControl().text(n.Msg.getMsg("Generate",!1,!1));i.lblStatusInfo.getControl().text(n.Msg.getMsg("InvGenerateSel",!1,!1))}function d(){var r=n.MLookupFactory.getMLookUp(n.Env.getCtx(),i.windowNo,2223,n.DisplayType.TableDir),t;i.cmbWarehouse=new n.Controls.VComboBox("M_Warehouse_ID",!0,!1,!0,r,150,n.DisplayType.TableDir,0);t=n.MLookupFactory.getMLookUp(n.Env.getCtx(),i.windowNo,2762,n.DisplayType.Search);i.vSearchBPartner=new n.Controls.VTextBoxButton("C_BPartner_ID",!0,!1,!0,n.DisplayType.Search,t)}function v(r){i.dGrid!=null&&(i.dGrid.destroy(),i.dGrid=null);i.arrListColumns.length==0&&(i.arrListColumns.push({field:"AD_Org_ID",caption:n.Msg.translate(n.Env.getCtx(),"AD_Org_ID"),sortable:!0,size:"16%",min:150,hidden:!1}),i.arrListColumns.push({field:"C_DocType_ID",caption:n.Msg.translate(n.Env.getCtx(),"C_DocType_ID"),sortable:!0,size:"16%",min:150,hidden:!1}),i.arrListColumns.push({field:"DocumentNo",caption:n.Msg.getElement(n.Env.getCtx(),"DocumentNo"),sortable:!0,size:"16%",min:150,hidden:!1}),i.arrListColumns.push({field:"C_BPartner_ID",caption:n.Msg.getElement(n.Env.getCtx(),"C_BPartner_ID"),sortable:!0,size:"16%",min:150,hidden:!1}),i.arrListColumns.push({field:"DateOrdered",caption:n.Msg.getElement(n.Env.getCtx(),"DateOrdered"),sortable:!0,size:"16%",min:150,hidden:!1,render:"date"}),i.arrListColumns.push({field:"TotalLines",caption:n.Msg.getElement(n.Env.getCtx(),"TotalLines"),sortable:!0,size:"20%",min:150,hidden:!1}),i.arrListColumns.push({field:"C_Order_ID",caption:n.Msg.translate(n.Env.getCtx(),"C_UOM_ID"),sortable:!0,size:"150px",hidden:!0}));setTimeout(10);w2utils.encodeTags(r);i.dGrid=t(i.gridSelectDiv).w2grid({name:"gridGenShipForm"+i.windowNo,recordHeight:40,show:{selectColumn:!0},multiSelect:!0,columns:i.arrListColumns,records:r})}function l(){var f=[],s=n.Env.getCtx().getAD_Client_ID(),r="SELECT C_Order_ID, o.Name as ord, dt.Name as docType, DocumentNo, bp.Name as bpName, DateOrdered, TotalLines FROM M_InOut_Candidate_v ic, AD_Org o, C_BPartner bp, C_DocType dt WHERE ic.AD_Org_ID=o.AD_Org_ID AND ic.C_BPartner_ID=bp.C_BPartner_ID AND ic.C_DocType_ID=dt.C_DocType_ID AND ic.AD_Client_ID="+s,i,e,t;u!=null&&u.toString()!="-1"&&(r=r.concat(" AND ic.M_Warehouse_ID=").concat(u));o!=null&&(r=r.concat(" AND ic.C_BPartner_ID=").concat(o));r=r.concat(" ORDER BY o.Name,bp.Name,DateOrdered");try{for(i=n.DB.executeReader(r.toString(),null,null),e=1;i.read();)t={},t.C_Order_ID=i.getInt(0),t.AD_Org_ID=i.getString(1),t.C_DocType_ID=i.getString(2),t.DocumentNo=i.getString(3),t.C_BPartner_ID=i.getString(4),t.DateOrdered=i.getString(5),t.TotalLines=i.getString(6),t.recid=e,e++,f.push(t)}catch(h){}return v(f),f}function g(){var r,u,f,e,n,t;if(i.dGrid==null)return!1;if((r=[],u=i.dGrid.getSelection(),u!=null)&&!(u.length<=0)){for(f=u.toString().split(","),t=0;t<f.length;t++)r[t]=i.dGrid.get(f[0]).C_Order_ID;if(r.length==0)return"";for(e="C_Order_ID",n=e,n=r.length>1?n.concat(" IN ("):n.concat("="),t=0;t<r.length;t++)t>0&&(n=n.concat(",")),n=e.endsWith("_ID")?n.concat(r[t].toString()):n.concat("'").concat(r[t].toString());return r.length>1&&(n=n.concat(")")),n.toString()}}function nt(r){var f=i;t.ajax({url:n.Application.contextUrl+"Common/GenerateShipments",dataType:"json",data:{whereClause:r,M_Warehouse_ID:u},success:function(n){n.DocumentText!=null&&(tt(!0),f.gridGenerateDiv.html(n.DocumentText),f.lblStatusInfo.getControl().text(n.lblStatusInfo));n.ErrorMsg!=null&&alert(n.ErrorMsg);f.$busyDiv[0].style.visibility="hidden"}})}function tt(n){n&&(i.btnRefresh.hide(),i.okBtn.hide(),i.btnToggel.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),n=!1,i.gridSelectDiv.animate({width:e},"fast"),i.sideDiv.animate({width:"toggle",height:"toggle"},"slow"));i.gridSelectDiv.css("display","none");i.sideDiv.css("display","none");i.gridGenerateDiv.css("display","block");i.btnToggel.hide();lblSelect.css("font-size","17px").css("color","#333333");lblGenrate.css("font-size","28px").css("color","#19A0ED")}var i;this.frame;this.windowNo;i=this;this.arrListColumns=[];this.dGrid=null;var s=null,u=null,o=null,y=!1,p=!1,f=!1;this.lblWarehouse=new n.Controls.VLabel;this.lblBPartner=new n.Controls.VLabel;this.lblStatusInfo=new n.Controls.VLabel;this.tabSelect=new n.Controls.VLabel;this.tabGenrate=new n.Controls.VLabel;this.cmbWarehouse=new n.Controls.VComboBox("",!1,!1,!0);this.vSearchBPartner=null;this.$root=t("<div style='width: 100%; height: 100%; background-color: white;'>");this.$busyDiv=t("<div class='vis-apanel-busy'>");this.topDiv=null;this.sideDiv=null;this.gridSelectDiv=null;this.gridGenerateDiv=null;this.bottumDiv=null;this.div=null;this.okBtn=null;this.cancelBtn=null;this.btnRefresh=null;this.btnToggel=null;this.spnSelect=null;this.spnGenerate=null;this.btnSpaceDiv=null;this.lblGenrate=null;this.lblSelect=null;var r=260,h=50,e=t(window).width()-(r+20+5),a=t(window).width()-(20+h),w=e+r+5,c=t(window).height()-210;this.vetoablechange=function(){o=i.vSearchBPartner.getValue();l()};this.Initialize=function(){if(d(),k(),b(),this.btnToggel=this.$root.find("#btnSpace_"+i.windowNo),this.spnSelect=this.$root.find("#spnSelect_"+i.windowNo),this.spnGenerate=this.$root.find("#spnGenerate_"+i.windowNo),this.okBtn!=null)this.okBtn.on(n.Events.onTouchStartOrClick,function(){i.$busyDiv[0].style.visibility="visible";i.okBtn.attr("disabled","disabled");s=g();s!=null&&nt(s);i.$busyDiv[0].style.visibility="hidden"});if(this.cancelBtn!=null)this.cancelBtn.on(n.Events.onTouchStartOrClick,function(){i.$root.dialog("close")});if(this.btnRefresh!=null)this.btnRefresh.on(n.Events.onTouchStartOrClick,function(){i.okBtn.removeAttr("disabled");u=i.cmbWarehouse.getControl().find("option:selected").val();o=i.vSearchBPartner.getValue();l()});if(this.btnToggel!=null)this.btnToggel.on(n.Events.onTouchStartOrClick,function(){f?(i.btnToggel.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),f=!1,i.btnSpaceDiv.animate({width:r},"slow"),i.gridSelectDiv.animate({width:e},"slow"),i.div.css("display","block"),i.sideDiv.animate({width:r},"slow",null,function(){i.dGrid.resize()})):(i.btnToggel.animate({borderSpacing:180},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),f=!0,i.btnSpaceDiv.animate({width:h},"slow"),i.sideDiv.animate({width:h},"slow"),i.div.css("display","none"),i.gridSelectDiv.animate({width:a},"slow",null,function(){i.dGrid.resize()}))});if(this.spnGenerate!=null)this.spnGenerate.on(n.Events.onTouchStartOrClick,function(){i.btnRefresh.hide();i.okBtn.hide();f&&(i.btnToggel.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),f=!1,i.gridSelectDiv.animate({width:e},"fast"),i.sideDiv.animate({width:r},"fast"),i.btnSpaceDiv.animate({width:r},"fast"));i.gridSelectDiv.css("display","none");i.sideDiv.css("display","none");i.gridGenerateDiv.css("display","block");i.btnToggel.hide();lblSelect.css("font-size","17px").css("color","#333333");lblGenrate.css("font-size","28px").css("color","#19A0ED")});if(this.spnSelect!=null)this.spnSelect.on(n.Events.onTouchStartOrClick,function(){f||(i.btnRefresh.show(),i.okBtn.show(),i.gridGenerateDiv.css("display","none"),i.gridSelectDiv.css("display","block"),i.sideDiv.css("display","block"),i.div.css("display","block"),i.gridSelectDiv.animate({width:e},"fast"),i.btnToggel.show(),lblSelect.css("font-size","28px").css("color","#19A0ED"),lblGenrate.css("font-size","17px").css("color","#333333"))});this.cmbWarehouse!=null&&this.cmbWarehouse.getControl().change(function(){u=i.cmbWarehouse.getControl().find("option:selected").val();l()});this.vSearchBPartner!=null&&this.vSearchBPartner.addVetoableChangeListener(this)};this.display=function(){v(null)};this.getRoot=function(){return this.$root};this.disposeComponent=function(){this.okBtn&&this.okBtn.off(n.Events.onTouchStartOrClick);this.cancelBtn&&this.cancelBtn.off(n.Events.onTouchStartOrClick);i=null;this.frame=null;this.windowNo=null;this.arrListColumns=null;this.dGrid=null;s=null;u=null;o=null;y=null;p=null;f=null;this.lblWarehouse=null;this.lblBPartner=null;this.lblStatusInfo=null;this.tabSelect=null;this.tabGenrate=null;this.cmbWarehouse=null;this.vSearchBPartner=null;this.$root=null;this.$busyDiv=null;this.topDiv=null;this.sideDiv=null;this.gridSelectDiv=null;this.gridGenerateDiv=null;this.bottumDiv=null;this.okBtn=null;this.cancelBtn=null;this.btnRefresh=null;this.btnToggel=null;this.spnSelect=null;this.spnGenerate=null;r=null;e=null;a=null;w=null;c=null;this.getRoot=null;this.disposeComponent=null}}n.Apps.AForms=n.Apps.AForms||{};i.prototype.init=function(t,i){this.frame=i;this.windowNo=t;n.Env.getCtx().setContext(this.windowNo,"IsSOTrx","Y");try{var r=this.Initialize()}catch(u){}this.frame.getContentGrid().append(this.getRoot());this.display();this.cmbWarehouse.getControl().focus()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VInOutGen=i}(VIS,jQuery),function(n,t){function i(){function b(){var nt="topDiv_"+i.windowNo,v="btnSpaceDiv_"+i.windowNo,tt="btnSpace_"+i.windowNo,it="spnSelect_"+i.windowNo,rt="spnGenerate_"+i.windowNo,y="lblGenerate_"+i.windowNo,p="lblSelect_"+i.windowNo,s=n.Application.contextUrl+"Areas/VIS/Images/base/arrow-left.png",w,b,k,d,h,g,l,a;i.topDiv=t("<div id='"+nt+"' style='float: left; width: 100%; height: 45px; margin-bottom: 2px;margin-left: 0px;'><div id='"+v+"' style='width: 260px; height: 45px;float: left;padding-left: 11px; padding-top: 11px;; background-color: #F1F1F1;'><button id='"+tt+"' style='border: 0px;background-color: transparent; padding: 0px;' ><img src='"+s+"' /><\/button><\/div><div id='"+it+"'style='display: inline-block;  padding-left: 15px;margin-right: 15px;' ><label id='"+p+"' class='VIS_Pref_Label_Font' style='vertical-align: middle;font-size: 28px;color: #19A0ED;'>"+n.Msg.translate(n.Env.getCtx(),"Select")+"<\/label><\/div><div id='"+rt+"' style='display: inline-block; width: 160px;'><label id='"+y+"' class='VIS_Pref_Label_Font' style='vertical-align: middle; font-size: 17px;'>"+n.Msg.translate(n.Env.getCtx(),"Generate")+"<\/label><\/div><\/div>");w="sideDiv_"+i.windowNo;b="parameterDiv_"+i.windowNo;i.btnSpaceDiv=i.topDiv.find("#"+v);this.lblGenrate=i.topDiv.find("#"+y);this.lblSelect=i.topDiv.find("#"+p);i.sideDiv=t("<div id='"+w+"' style='float: left; margin-left: 0px; background-color: #F1F1F1;'>");i.sideDiv.css("width",r);i.sideDiv.css("height",c);i.div=t("<div style='float: left; width: 100%;' id='"+b+"'>");i.sideDiv.append(i.div);var o=t("<table style='width: 100%;'>"),u=t("<tr>"),e=t("<td style='padding: 4px 15px 2px;'>");i.div.append(o);o.append(u);u.append(e);e.append(i.lblOrg.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));u=t("<tr>");e=t("<td style='padding: 4px 15px 2px;'>");o.append(u);u.append(e);e.append(i.cmbOrg.getControl().css("display","inline-block").css("width","236px").css("height","30px"));u=t("<tr>");e=t("<td style='padding: 4px 15px 2px;'>");o.append(u);u.append(e);e.append(i.lblBPartner.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));u=t("<tr>");e=t("<td style='padding: 0px 15px 0px;'>");o.append(u);u.append(e);e.append(i.vSearchBPartner.getControl().css("width","206px")).append(i.vSearchBPartner.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB"));k="gridSelectDiv_"+i.windowNo;d="gridGenerateDiv_"+i.windowNo;i.gridSelectDiv=t("<div id='"+k+"' style='float: right; margin-right: 15px;border: 1px solid darkgray;'>");i.gridSelectDiv.css("width",f);i.gridSelectDiv.css("height",c);i.gridGenerateDiv=t("<div id='"+d+"' style='height: 85%; float: right; display: none; background-color: #F1F1F1; margin-left: 15px;;margin-right: 15px;'>");i.gridGenerateDiv.css("width",t(window).width()-30);h="btnOk_"+i.windowNo;i.okBtn=t("<input id='"+h+"' class='VIS_Pref_btn-2' style='margin-bottom: 1px; margin-top: 1px; float: right; margin-right: 15px ;width: 70px;height: 38px;' type='button' value='Ok'>");h="btnRefresh_"+i.windowNo;s=n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png";i.btnRefresh=t("<button id='"+h+"' style='margin-bottom: 1px; margin-top: 0px; float: left; margin-left: 15px;height: 38px; ' class='VIS_Pref_btn-2'><img src='"+s+"'><\/button>");g="discriptionDiv_"+i.windowNo;i.bottumDiv=t("<div style='width: 100%; height: 50px; float: left; margin-bottom: 0px;margin-top: 5px;'>");l=t("<div id='"+g+"' style='width: 69%; float: left; margin-bottom: 0px; padding-top: 8px;padding-left: 10px; text-align: left;'>");l.append(i.lblStatusInfo.getControl().addClass("VIS_Pref_Label_Font"));a=t("<div style='width: 175px; float: right; text-align: right; margin-bottom: 0px;'>");a.append(i.okBtn);i.bottumDiv.append(i.btnRefresh).append(l).append(a);i.$root.append(i.$busyDiv);i.$root.append(i.topDiv).append(i.sideDiv).append(i.gridSelectDiv).append(i.gridGenerateDiv).append(i.bottumDiv)}function k(){i.lblOrg.getControl().text(n.Msg.translate(n.Env.getCtx(),"AD_Org_ID"));i.lblBPartner.getControl().text(n.Msg.translate(n.Env.getCtx(),"C_BPartner_ID"));i.tabSelect.getControl().text(n.Msg.getMsg("Select",!1,!1));i.tabGenrate.getControl().text(n.Msg.getMsg("Generate",!1,!1));i.lblStatusInfo.getControl().text(n.Msg.getMsg("InvGenerateSel",!1,!1))}function d(){var r=n.MLookupFactory.getMLookUp(n.Env.getCtx(),i.windowNo,2163,n.DisplayType.TableDir),t;i.cmbOrg=new n.Controls.VComboBox("AD_Org_ID",!0,!1,!0,r,150,n.DisplayType.TableDir,0);t=n.MLookupFactory.getMLookUp(n.Env.getCtx(),i.windowNo,2762,n.DisplayType.Search);i.vSearchBPartner=new n.Controls.VTextBoxButton("C_BPartner_ID",!0,!1,!0,n.DisplayType.Search,t)}function v(r){i.dGrid!=null&&(i.dGrid.destroy(),i.dGrid=null);i.arrListColumns.length==0&&(i.arrListColumns.push({field:"AD_Org_ID",caption:n.Msg.translate(n.Env.getCtx(),"AD_Org_ID"),sortable:!0,size:"16%",min:150,hidden:!1}),i.arrListColumns.push({field:"C_DocType_ID",caption:n.Msg.translate(n.Env.getCtx(),"C_DocType_ID"),sortable:!0,size:"16%",min:150,hidden:!1}),i.arrListColumns.push({field:"DocumentNo",caption:n.Msg.getElement(n.Env.getCtx(),"DocumentNo"),sortable:!0,size:"16%",min:150,hidden:!1}),i.arrListColumns.push({field:"C_BPartner_ID",caption:n.Msg.getElement(n.Env.getCtx(),"C_BPartner_ID"),sortable:!0,size:"16%",min:150,hidden:!1}),i.arrListColumns.push({field:"DateOrdered",caption:n.Msg.getElement(n.Env.getCtx(),"DateOrdered"),sortable:!0,size:"16%",min:150,hidden:!1,render:"date"}),i.arrListColumns.push({field:"TotalLines",caption:n.Msg.getElement(n.Env.getCtx(),"TotalLines"),sortable:!0,size:"20%",min:150,hidden:!1}),i.arrListColumns.push({field:"C_Order_ID",caption:n.Msg.translate(n.Env.getCtx(),"C_UOM_ID"),sortable:!0,size:"150px",hidden:!0}));w2utils.encodeTags(r);i.dGrid=t(i.gridSelectDiv).w2grid({name:"gridGenForm"+i.windowNo,recordHeight:40,show:{selectColumn:!0},multiSelect:!0,columns:i.arrListColumns,records:r})}function l(){var u=[],s=n.Env.getCtx().getAD_Client_ID(),r="SELECT C_Order_ID, o.Name as ord, dt.Name as docType, DocumentNo, bp.Name as bpName, DateOrdered, TotalLines FROM C_Invoice_Candidate_v ic, AD_Org o, C_BPartner bp, C_DocType dt WHERE ic.AD_Org_ID=o.AD_Org_ID AND ic.C_BPartner_ID=bp.C_BPartner_ID AND ic.C_DocType_ID=dt.C_DocType_ID AND ic.AD_Client_ID="+s,i,f,t;e!=null&&e.toString()!="-1"&&(r=r.concat(" AND ic.AD_Org_ID=").concat(e));o!=null&&(r=r.concat(" AND ic.C_BPartner_ID=").concat(o));r=r.concat(" ORDER BY o.Name,bp.Name,DateOrdered");try{for(i=n.DB.executeReader(r.toString(),null,null),f=1;i.read();)t={},t.C_Order_ID=i.getInt(0),t.AD_Org_ID=i.getString(1),t.C_DocType_ID=i.getString(2),t.DocumentNo=i.getString(3),t.C_BPartner_ID=i.getString(4),t.DateOrdered=i.getString(5),t.TotalLines=i.getString(6),t.recid=f,f++,u.push(t)}catch(h){}return v(u),u}function g(){var r,u,f,e,n,t;if(i.dGrid==null)return!1;if((r=[],u=i.dGrid.getSelection(),u!=null)&&!(u.length<=0)){for(f=u.toString().split(","),t=0;t<f.length;t++)r[t]=i.dGrid.get(f[0]).C_Order_ID;if(r.length==0)return"";for(e="C_Order_ID",n=e,n=r.length>1?n.concat(" IN ("):n.concat("="),t=0;t<r.length;t++)t>0&&(n=n.concat(",")),n=e.endsWith("_ID")?n.concat(r[t].toString()):n.concat("'").concat(r[t].toString());return r.length>1&&(n=n.concat(")")),n.toString()}}function nt(r){var u=i;t.ajax({url:n.Application.contextUrl+"Common/GenerateInvoices",dataType:"json",data:{whereClause:r},success:function(n){n.DocumentText!=null&&(tt(!0),u.gridGenerateDiv.html(n.DocumentText),u.lblStatusInfo.getControl().text(n.lblStatusInfo));n.ErrorMsg!=null&&alert(n.ErrorMsg);u.$busyDiv[0].style.visibility="hidden"}})}function tt(n){n&&(i.btnRefresh.hide(),i.okBtn.hide(),i.btnToggel.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),n=!1,i.gridSelectDiv.animate({width:f},"fast"),i.sideDiv.animate({width:"toggle",height:"toggle"},"slow"));i.gridSelectDiv.css("display","none");i.sideDiv.css("display","none");i.gridGenerateDiv.css("display","block");i.btnToggel.hide();lblSelect.css("font-size","17px").css("color","#333333");lblGenrate.css("font-size","28px").css("color","#19A0ED")}var i;this.frame;this.windowNo;i=this;this.arrListColumns=[];this.dGrid=null;var s=null,e=null,o=null,y=!1,p=!1,u=!1;this.lblOrg=new n.Controls.VLabel;this.lblBPartner=new n.Controls.VLabel;this.lblStatusInfo=new n.Controls.VLabel;this.tabSelect=new n.Controls.VLabel;this.tabGenrate=new n.Controls.VLabel;this.cmbOrg=new n.Controls.VComboBox("",!1,!1,!0);this.vSearchBPartner=null;this.$root=t("<div style='width: 100%; height: 100%; background-color: white;'>");this.$busyDiv=t("<div class='vis-apanel-busy'>");this.topDiv=null;this.sideDiv=null;this.gridSelectDiv=null;this.gridGenerateDiv=null;this.bottumDiv=null;this.div=null;this.okBtn=null;this.cancelBtn=null;this.btnRefresh=null;this.btnToggel=null;this.spnSelect=null;this.spnGenerate=null;this.btnSpaceDiv=null;this.lblGenrate=null;this.lblSelect=null;var r=260,h=50,f=t(window).width()-(r+20+5),a=t(window).width()-(20+h),w=f+r+5,c=t(window).height()-210;this.vetoablechange=function(){o=i.vSearchBPartner.getValue();l()};this.Initialize=function(){if(d(),k(),b(),this.btnToggel=this.$root.find("#btnSpace_"+i.windowNo),this.spnSelect=this.$root.find("#spnSelect_"+i.windowNo),this.spnGenerate=this.$root.find("#spnGenerate_"+i.windowNo),this.okBtn!=null)this.okBtn.on(n.Events.onTouchStartOrClick,function(){i.$busyDiv[0].style.visibility="visible";i.okBtn.attr("disabled","disabled");s=g();s!=null&&nt(s);i.$busyDiv[0].style.visibility="hidden"});if(this.cancelBtn!=null)this.cancelBtn.on(n.Events.onTouchStartOrClick,function(){i.$root.dialog("close")});if(this.btnRefresh!=null)this.btnRefresh.on(n.Events.onTouchStartOrClick,function(){i.okBtn.removeAttr("disabled");e=i.cmbOrg.getControl().find("option:selected").val();o=i.vSearchBPartner.getValue();l()});if(this.btnToggel!=null)this.btnToggel.on(n.Events.onTouchStartOrClick,function(){u?(i.btnToggel.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),u=!1,i.btnSpaceDiv.animate({width:r},"slow"),i.gridSelectDiv.animate({width:f},"slow"),i.div.css("display","block"),i.sideDiv.animate({width:r},"slow",null,function(){i.dGrid.resize()})):(i.btnToggel.animate({borderSpacing:180},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),u=!0,i.btnSpaceDiv.animate({width:h},"slow"),i.sideDiv.animate({width:h},"slow"),i.div.css("display","none"),i.gridSelectDiv.animate({width:a},"slow",null,function(){i.dGrid.resize()}))});if(this.spnGenerate!=null)this.spnGenerate.on(n.Events.onTouchStartOrClick,function(){i.btnRefresh.hide();i.okBtn.hide();u&&(i.btnToggel.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),u=!1,i.gridSelectDiv.animate({width:f},"fast"),i.sideDiv.animate({width:r},"fast"),i.btnSpaceDiv.animate({width:r},"fast"));i.gridSelectDiv.css("display","none");i.sideDiv.css("display","none");i.gridGenerateDiv.css("display","block");i.btnToggel.hide();lblSelect.css("font-size","17px").css("color","#333333");lblGenrate.css("font-size","28px").css("color","#19A0ED")});if(this.spnSelect!=null)this.spnSelect.on(n.Events.onTouchStartOrClick,function(){u||(i.btnRefresh.show(),i.okBtn.show(),i.gridGenerateDiv.css("display","none"),i.gridSelectDiv.css("display","block"),i.sideDiv.css("display","block"),i.div.css("display","block"),i.gridSelectDiv.animate({width:f},"fast"),i.btnToggel.show(),lblSelect.css("font-size","28px").css("color","#19A0ED"),lblGenrate.css("font-size","17px").css("color","#333333"))});this.cmbOrg!=null&&this.cmbOrg.getControl().change(function(){e=i.cmbOrg.getControl().find("option:selected").val();l()});this.vSearchBPartner!=null&&this.vSearchBPartner.addVetoableChangeListener(this)};this.display=function(){v(null)};this.getRoot=function(){return this.$root};this.disposeComponent=function(){this.okBtn&&this.okBtn.off(n.Events.onTouchStartOrClick);this.cancelBtn&&this.cancelBtn.off(n.Events.onTouchStartOrClick);i=null;this.frame=null;this.windowNo=null;this.arrListColumns=null;this.dGrid=null;s=null;e=null;o=null;y=null;p=null;u=null;this.lblOrg=null;this.lblBPartner=null;this.lblStatusInfo=null;this.tabSelect=null;this.tabGenrate=null;this.cmbOrg=null;this.vSearchBPartner=null;this.$root=null;this.$busyDiv=null;this.topDiv=null;this.sideDiv=null;this.gridSelectDiv=null;this.gridGenerateDiv=null;this.bottumDiv=null;this.okBtn=null;this.cancelBtn=null;this.btnRefresh=null;this.btnToggel=null;this.spnSelect=null;this.spnGenerate=null;r=null;f=null;a=null;w=null;c=null;this.getRoot=null;this.disposeComponent=null}}n.Apps.AForms=n.Apps.AForms||{};i.prototype.init=function(t,i){this.frame=i;this.windowNo=t;n.Env.getCtx().setContext(this.windowNo,"IsSOTrx","Y");try{var r=this.Initialize()}catch(u){}this.frame.getContentGrid().append(this.getRoot());this.display();this.cmbOrg.getControl().focus()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VInvoiceGen=i}(VIS,jQuery),function(n,t){function i(){function vt(){var a=n.Application.contextUrl+"Areas/VIS/Images/base/arrow-left.png",e,l,o,s,h,c;i.topDiv=t("<div id='topDiv_"+i.windowNo+"' style='float: left; width: 100%; height: 45px; margin-bottom: 2px;margin-left: 0px;'><div id='btnSpaceDiv_"+i.windowNo+"' style='width: 260px; height: 45px;float: left;padding-left: 11px; padding-top: 11px;; background-color: #F1F1F1;'><button id='btnToggelDiv_"+i.windowNo+"' style='border: 0px;background-color: transparent; padding: 0px;' ><img src='"+a+"' /><\/button><\/div><\/div>");e=t("<div style='float: left;  margin-right: 15px;padding-top: 10px;'>");e.append(i.lblInvoice.getControl().css("display","inline-block").css("font-size","24px").css("margin-left","15px").css("color","#19A0ED").addClass("VIS_Pref_Label_Font"));e.append(chkSameBPartnerDiv);e.append(chkSameProductDiv);e.append(chkSameQtyDiv);e.css("width",y);e.css("height","45px");i.topDiv.append(e);i.invoiceTopDiv=e;i.btnSpaceDiv=i.topDiv.find("#btnSpaceDiv_"+i.windowNo);i.sideDiv=t("<div id='sideDiv_"+i.windowNo+"' style='float: left; margin-left: 0px;background-color: #F1F1F1; '>");i.sideDiv.css("width",v);i.sideDiv.css("height",tt-3);i.div=t("<div style='float: left;overflow-y: scroll;height: 100%;' id='parameterDiv_"+i.windowNo+"'>");i.sideDiv.append(i.div);var f=t("<table style='width: 100%;height: 100%;'>"),r=t("<tr>"),u=t("<td style='padding: 4px 15px 2px;'>");i.div.append(f);f.append(r);r.append(u);u.append(i.lblMatchFrom.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));r=t("<tr>");u=t("<td style='padding: 0px 15px 0px;'>");f.append(r);r.append(u);u.append(i.cmbMatchFrom.getControl().css("display","inline-block").css("width","236px").css("height","32px"));r=t("<tr>");u=t("<td style='padding: 4px 15px 2px;'>");f.append(r);r.append(u);u.append(i.lblMatchTo.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));r=t("<tr>");u=t("<td style='padding: 0px 15px 0px;'>");f.append(r);r.append(u);u.append(i.cmbMatchTo.getControl().css("display","inline-block").css("width","236px").css("height","32px"));r=t("<tr>");u=t("<td style='padding: 4px 15px 2px;'>");f.append(r);r.append(u);u.append(i.lblMatchMode.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));r=t("<tr>");u=t("<td style='padding: 0px 15px 0px;'>");f.append(r);r.append(u);u.append(i.cmbMatchMode.getControl().css("display","inline-block").css("width","236px").css("height","32px"));r=t("<tr>");u=t("<td style='padding: 4px 15px 2px;'>");f.append(r);r.append(u);u.append(i.lblBPartner.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));r=t("<tr>");u=t("<td style='padding: 0px 15px 0px;'>");f.append(r);r.append(u);u.append(i.onlyVendor.getControl().css("width","206px")).append(i.onlyVendor.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB"));r=t("<tr>");u=t("<td style='padding: 4px 15px 2px;'>");f.append(r);r.append(u);u.append(i.lblProduct.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));r=t("<tr>");u=t("<td style='padding: 0px 15px 0px;'>");f.append(r);r.append(u);u.append(i.onlyProduct.getControl().css("width","206px")).append(i.onlyProduct.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB"));r=t("<tr>");u=t("<td style='padding: 4px 15px 2px;'>");f.append(r);r.append(u);u.append(i.lblDateFrom.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));r=t("<tr>");u=t("<td style='padding: 0px 15px 0px;'>");f.append(r);r.append(u);u.append(i.dtpFrom);r=t("<tr>");u=t("<td style='padding: 4px 15px 2px;'>");f.append(r);r.append(u);u.append(i.lblDateTo.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));r=t("<tr>");u=t("<td style='padding: 0px 15px 0px;'>");f.append(r);r.append(u);u.append(i.dtpTo);r=t("<tr>");u=t("<td style='padding: 10px 15px 0px;'>");f.append(r);r.append(u);u.append(chkIsReturnTrxDiv);i.divForGrid=t("<div id='divForGrid_"+i.windowNo+"' style='float: left;margin-left: 15px;margin-right: 15px'>");i.divForGrid.css("width",y);i.divForGrid.css("height",tt-3);i.gridInvoiceDiv=t("<div id='gridInvoiceDiv_"+i.windowNo+"' style='width: 100%;float: left; '>");i.gridInvoiceDiv.css("height","47%");i.invoicegrd=t("<div style='float: left; width: 100%;height: 99%;'>");i.gridInvoiceDiv.append(i.invoicegrd);i.gridReciptDiv=t("<div id='gridReciptDiv_"+i.windowNo+"' style='width: 100%;float: left;'>");i.gridReciptDiv.css("height","46%");l=t("<div style='float: left; width: 100%; margin-top: 0px;'>");l.append(i.lblReceipt.getControl().css("display","inline-block").css("font-size","24px").css("color","#19A0ED").addClass("VIS_Pref_Label_Font"));i.reciptgrd=t("<div style='float: left; width: 100%;height: 99%;'>");i.gridReciptDiv.append(i.reciptgrd);o=t("<div style='float: left; width: 60%; margin-left: 185px;margin-top: 3px;'>");s=t("<div style='float: left;width: 33%;'>");s.append(i.lblMatched.getControl().css("display","block").addClass("VIS_Pref_Label_Font"));s.append(i.txtMatched.getControl().css("width","100%"));o.append(s);h=t("<div style='float: left; padding-left: 15px;margin-top: 0px;width: 33%;'>");h.append(i.lblMatchedTo.getControl().css("display","block").addClass("VIS_Pref_Label_Font"));h.append(i.txtMatchedTo.getControl().css("width","100%"));o.append(h);c=t("<div style='float: left; padding-left: 15px;margin-top: 0px;width: 33.3%; '>");c.append(i.lblDifference.getControl().css("display","block").addClass("VIS_Pref_Label_Font"));c.append(i.txtDifference.getControl().css("width","100%"));o.append(c);i.bottumButtonDiv=t("<div style='float: left;margin-top: 5px; width:100%'>");i.bottumButtonDiv.css("height",55);i.bottumButtonDiv.append(i.btnSearch);i.bottumButtonDiv.append(o);i.bottumButtonDiv.append(i.btnProcess);i.bottumDiv=t("<div style='float: left;background-color: #F1F1F1; width:100%'>");i.bottumDiv.css("height",30);i.bottumDiv.append(i.lblStatusInfo.getControl().addClass("VIS_Pref_Label_Font"));i.bottumDiv.append(i.lblStatusCount.getControl().css("float","right").addClass("VIS_Pref_Label_Font"));i.divForGrid.append(i.gridInvoiceDiv).append(l).append(i.gridReciptDiv);i.$root.append(i.topDiv).append(i.sideDiv).append(i.divForGrid).append(i.bottumButtonDiv).append(i.bottumDiv);i.$root.append(i.$busyDiv)}function yt(){var r=n.Application.contextUrl+"Areas/VIS/Images/base/arrow-left.png";i.dtpFrom=t("<input id='dateFrom_"+i.windowNo+"' type='date' name='DateOrdered' style='display: inline-block;line-height: 23px;width:236px'>");i.dtpTo=t("<input id='dateTo_"+i.windowNo+"' type='date' name='DateOrdered' style='display: inline-block;line-height: 23px;width:236px'>");this.chkIsReturnTrxDiv=t("<div>");i.chkIsReturnTrx=t("<input id='chkIsReturnTrx_"+i.windowNo+"' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblIsReturnTrx_"+i.windowNo+"' class='VIS_Pref_Label_Font'>Return Transaction<\/label><\/span>");this.chkIsReturnTrxDiv.append(i.chkIsReturnTrx);this.chkSameBPartnerDiv=t("<div style='float: right; margin-right: 15px;'>");n.Application.isRTL&&(this.chkSameBPartnerDiv=t("<div style='float: left; margin-right: 15px;margin-left: 15px;'>"));i.chkSameBPartner=t("<input id='chkSameBPartner_"+i.windowNo+"' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblSameBPartner_"+i.windowNo+"' class='VIS_Pref_Label_Font'>Same BPartner<\/label><\/span>");this.chkSameBPartnerDiv.append(i.chkSameBPartner);this.chkSameProductDiv=t("<div style='float: right; margin-right: 15px;' >");n.Application.isRTL&&(this.chkSameProductDiv=t("<div style='float: left; margin-right: 15px;'>"));i.chkSameProduct=t("<input id='chkSameProduct_"+i.windowNo+"' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblSameProduct_"+i.windowNo+"' class='VIS_Pref_Label_Font'>Same Product<\/label><\/span>");this.chkSameProductDiv.append(i.chkSameProduct);this.chkSameQtyDiv=t("<div style='float: right; margin-right: 15px;' >");n.Application.isRTL&&(this.chkSameQtyDiv=t("<div style='float: left; margin-right: 15px;'>"));i.chkSameQty=t("<input id='chkSameQty_"+i.windowNo+"' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblSameQty_"+i.windowNo+"' class='VIS_Pref_Label_Font'>Same Quantity<\/label><\/span>");this.chkSameQtyDiv.append(i.chkSameQty);i.btnSearch=t("<input id='btnSearch_"+i.windowNo+"' class='VIS_Pref_pass-btn' style='margin-top: 10px;margin-left: 15px;  float: left;' type='button' value='Search'>");i.btnProcess=t("<Button id='btnProcess_"+i.windowNo+"' style='margin-top: 10px; float: right;margin-right: 15px;' class='VIS_Pref_btn-2'>Process<\/Button>");i.lblInvoice.getControl().text(n.Msg.translate(n.Env.getCtx(),"Invoice"));i.lblReceipt.getControl().text(n.Msg.translate(n.Env.getCtx(),"Receipt"));i.lblMatchFrom.getControl().text(n.Msg.translate(n.Env.getCtx(),"MatchFrom"));i.lblMatchTo.getControl().text(n.Msg.translate(n.Env.getCtx(),"MatchTo"));i.lblMatchMode.getControl().text(n.Msg.translate(n.Env.getCtx(),"MatchMode"));i.lblBPartner.getControl().text(n.Msg.translate(n.Env.getCtx(),"C_BPartner_ID"));i.lblProduct.getControl().text(n.Msg.translate(n.Env.getCtx(),"M_Product_ID"));i.lblDateFrom.getControl().text(n.Msg.translate(n.Env.getCtx(),"DateFrom"));i.lblDateTo.getControl().text(n.Msg.translate(n.Env.getCtx(),"DateTo"));i.lblMatched.getControl().text(n.Msg.translate(n.Env.getCtx(),"ToBeMatched"));i.lblMatchedTo.getControl().text(n.Msg.translate(n.Env.getCtx(),"Matching"));i.lblDifference.getControl().text(n.Msg.translate(n.Env.getCtx(),"Difference"));i.chkIsReturnTrx.prop("checked",!1);i.btnProcess.attr("disabled","disabled");i.chkSameProduct.prop("checked",!0);i.chkSameBPartner.prop("checked",!0);i.chkSameQty.prop("checked",!1);i.chkIsReturnTrx.next("label").text(n.Msg.translate(n.Env.getCtx(),"isReturnTrx"));i.chkSameProduct.next("label").text(n.Msg.translate(n.Env.getCtx(),"SameProduct"));i.chkSameBPartner.next("label").text(n.Msg.translate(n.Env.getCtx(),"SameBPartner"));i.chkSameQty.next("label").text(n.Msg.translate(n.Env.getCtx(),"SameQty"));i.lblSearch.getControl().text(n.Msg.translate(n.Env.getCtx(),"Search"));i.btnSearch.text(n.Msg.translate(n.Env.getCtx(),"Search"))}function ut(){ht();ft();i.lblStatusInfo.getControl().text("");i.lblStatusCount.getControl().text(0)}function pt(){var t=n.MLookupFactory.getMLookUp(n.Env.getCtx(),i.windowNo,3499,n.DisplayType.Search);i.onlyVendor=new n.Controls.VTextBoxButton("C_BPartner_ID",!0,!1,!0,n.DisplayType.Search,t);t=n.MLookupFactory.getMLookUp(n.Env.getCtx(),i.windowNo,3840,n.DisplayType.Search);i.onlyProduct=new n.Controls.VTextBoxButton("M_Product_ID",!0,!1,!0,n.DisplayType.Search,t)}function ft(){i.cmbMatchTo.getControl().empty();var n=null;i.cmbMatchFrom.getControl().find("option").length>0&&(n=i.cmbMatchFrom.getControl().find("option:selected").val(),n.equals(u[o])?i.cmbMatchTo.getControl().append(" <option value="+u[e]+">"+u[e]+"<\/option>"):n.equals(u[f])?i.cmbMatchTo.getControl().append(" <option value="+u[e]+">"+u[e]+"<\/option>"):(i.cmbMatchTo.getControl().append(" <option value="+u[o]+">"+u[o]+"<\/option>"),i.cmbMatchTo.getControl().append(" <option value="+u[f]+">"+u[f]+"<\/option>")),i.cmbMatchTo.getControl().prop("selectedIndex",0),i.lblInvoice.getControl().text(n));et()}function et(){selection=i.cmbMatchTo.getControl().find("option:selected").val();i.lblReceipt.getControl().text(selection)}function it(){var y=i.cmbMatchFrom.getControl()[0].selectedIndex,l=i.cmbMatchTo.getControl().find("option:selected").val(),c=o,a,v,t,h;l.equals(u[e])?c=e:l.equals(u[f])&&(c=f);ot(y,c);i.onlyProduct.getValue()!=null&&(a=i.onlyProduct.getValue(),r=r.concat(" AND lin.M_Product_ID=").concat(a));i.onlyVendor.getValue()!=null&&(v=i.onlyVendor.getValue(),r=r.concat(" AND hdr.C_BPartner_ID=").concat(v));t=i.dtpFrom.val();h=i.dtpTo.val();t!=""&&h!=""?r=r.concat(" AND ").concat(s).concat(" BETWEEN ").concat(n.DB.to_date(t)).concat(" AND ").concat(n.DB.to_date(h)):t!=""?r=r.concat(" AND ").concat(s).concat(" >= ").concat(DB.to_date(t)):h!=""&&(r=r.concat(" AND ").concat(s).concat(" <= ").concat(n.DB.to_date(h)));st(i.vdgvInvoice);i.txtMatched.getControl().val(0);i.lblStatusInfo.getControl().text(i.cmbMatchFrom.getControl().find("option:selected").val()+"# = "+i.vdgvInvoice.records.length+" -"+i.cmbMatchTo.getControl().find("option:selected").val()+"# = "+i.vdgvReceipt.records.length);i.lblStatusCount.getControl().text(0)}function c(n){var t=-1,h,c,s,v,y,w,a,b;n!=null?t=n:i.vdgvInvoice.getSelection().length>0&&(t=Number(i.vdgvInvoice.getSelection().toString()));h=0;t<0||(c=i.cmbMatchTo.getControl().find("option:selected").val(),s=o,c.equals(u[e])?s=e:c.equals(u[f])&&(s=f),v=i.cmbMatchFrom.getControl()[0].selectedIndex,ot(s,v),y={key:i.vdgvInvoice.get(t).C_BPartner_ID_K,value:i.vdgvInvoice.get(t).C_BPartner_ID},w={key:i.vdgvInvoice.get(t).M_Product_ID_K,value:i.vdgvInvoice.get(t).M_Product_ID},i.chkSameBPartner.prop("checked")&&(r=r.concat(" AND hdr.C_BPartner_ID=").concat(y.key)),i.chkSameProduct.prop("checked")&&(r=r.concat(" AND lin.M_Product_ID=").concat(w.key)),a=i.vdgvInvoice.get(t).Qty,b=i.vdgvInvoice.get(t).Matched,h=a-b,i.chkSameQty.prop("checked")&&(r=r.concat(" AND ").concat(p).concat("=").concat(a)),st(i.vdgvReceipt));l=h;i.txtMatched.setValue(l);i.txtMatchedTo.setValue(0);i.txtDifference.setValue(l);i.lblStatusInfo.getControl().text(i.cmbMatchFrom.getControl().find("option:selected").val()+"# = "+i.vdgvInvoice.records.length+" -"+i.cmbMatchTo.getControl().find("option:selected").val()+"# = "+i.vdgvReceipt.records.length);i.lblStatusCount.getControl().text(0)}function wt(){var n=-1,r,w,b,y,t,p,c,a;if(i.vdgvInvoice.getSelection().length>0&&(n=Number(i.vdgvInvoice.getSelection().toString())),!(n<0)){var g={key:i.vdgvInvoice.get(n).C_BPartner_ID_K,value:i.vdgvInvoice.get(n).C_BPartner_ID},v={key:i.vdgvInvoice.get(n).Line_K,value:i.vdgvInvoice.get(n).Line},k={key:i.vdgvInvoice.get(n).M_Product_ID_K,value:i.vdgvInvoice.get(n).M_Product_ID},o=l,s=i.vdgvInvoice.get(n).Matched,h=i.vdgvReceipt.getSelection().toString();if(h!=null&&!(h.length<=0))for(r=h.toString().split(","),n=0;n<r.length;n++)if(w=i.vdgvReceipt.get(r[0])._ID,w!=null){if(b={key:i.vdgvReceipt.get(r[n]).M_Product_ID_K,value:i.vdgvReceipt.get(r[n]).M_Product_ID},k.key!=b.key)continue;y={key:i.vdgvReceipt.get(r[n]).Line_K,value:i.vdgvReceipt.get(r[n]).Line};t=0;i.cmbMatchMode.getControl()[0].selectedIndex==d&&(t=i.vdgvReceipt.get(r[n]).Qty);t=t-Number(i.vdgvReceipt.get(r[n]).Matched);i.cmbMatchMode.getControl()[0].selectedIndex==d?(t>o&&(t=o),o=o-t):(t>s&&(t=t-s),s=s+t);p=!0;(i.cmbMatchFrom.getControl().find("option:selected").val().equals(u[f])||i.cmbMatchTo.getControl().find("option:selected").val().equals(u[f]))&&(p=!1);c=0;a=0;i.cmbMatchFrom.getControl()[0].selectedIndex==e?(c=v.key,a=y.key):(c=y.key,a=v.key);bt(p,c,a,t,v.key,h)}}}function ot(n,t){var u=i.cmbMatchMode.getControl()[0].selectedIndex==rt;r="";n==o?(s="hdr.DateInvoiced",p="lin.QtyInvoiced",r=r.concat("SELECT hdr.C_Invoice_ID,hdr.DocumentNo, hdr.DateInvoiced, bp.Name,hdr.C_BPartner_ID, lin.Line,lin.C_InvoiceLine_ID, p.Name,lin.M_Product_ID, lin.QtyInvoiced,SUM(NVL(mi.Qty,0)) as match FROM C_Invoice hdr INNER JOIN C_BPartner bp ON (hdr.C_BPartner_ID=bp.C_BPartner_ID) INNER JOIN C_InvoiceLine lin ON (hdr.C_Invoice_ID=lin.C_Invoice_ID) INNER JOIN M_Product p ON (lin.M_Product_ID=p.M_Product_ID) INNER JOIN C_DocType dt ON (hdr.C_DocType_ID=dt.C_DocType_ID and dt.DocBaseType in ('API','APC') AND dt.IsReturnTrx = ").concat(i.chkIsReturnTrx.prop("checked")?"'Y')":"'N')").concat(" FULL JOIN M_MatchInv mi ON (lin.C_InvoiceLine_ID=mi.C_InvoiceLine_ID) WHERE hdr.DocStatus IN ('CO','CL')"),w=" GROUP BY hdr.C_Invoice_ID,hdr.DocumentNo,hdr.DateInvoiced,bp.Name,hdr.C_BPartner_ID, lin.Line,lin.C_InvoiceLine_ID,p.Name,lin.M_Product_ID,lin.QtyInvoiced HAVING "+(u?"0":"lin.QtyInvoiced")+"<>SUM(NVL(mi.Qty,0))"):n==f?(s="hdr.DateOrdered",p="lin.QtyOrdered",r=r.concat("SELECT hdr.C_Order_ID,hdr.DocumentNo, hdr.DateOrdered, bp.Name,hdr.C_BPartner_ID, lin.Line,lin.C_OrderLine_ID, p.Name,lin.M_Product_ID, lin.QtyOrdered,SUM(COALESCE(mo.Qty,0)) as match FROM C_Order hdr INNER JOIN C_BPartner bp ON (hdr.C_BPartner_ID=bp.C_BPartner_ID) INNER JOIN C_OrderLine lin ON (hdr.C_Order_ID=lin.C_Order_ID) INNER JOIN M_Product p ON (lin.M_Product_ID=p.M_Product_ID) INNER JOIN C_DocType dt ON (hdr.C_DocType_ID=dt.C_DocType_ID AND dt.DocBaseType='POO'AND dt.isReturnTrx = ").concat(i.chkIsReturnTrx.prop("checked")?"'Y')":"'N')").concat(" FULL JOIN M_MatchPO mo ON (lin.C_OrderLine_ID=mo.C_OrderLine_ID) WHERE mo.").concat(t==e?"M_InOutLine_ID":"C_InvoiceLine_ID").concat(u?" IS NOT NULL":" IS NULL AND hdr.DocStatus IN ('CO','CL')"),w=" GROUP BY hdr.C_Order_ID,hdr.DocumentNo,hdr.DateOrdered,bp.Name,hdr.C_BPartner_ID, lin.Line,lin.C_OrderLine_ID,p.Name,lin.M_Product_ID,lin.QtyOrdered HAVING "+(u?"0":"lin.QtyOrdered")+"<>SUM(COALESCE(mo.Qty,0))"):(s="hdr.MovementDate",p="lin.MovementQty",r=r.concat("SELECT hdr.M_InOut_ID,hdr.DocumentNo, hdr.MovementDate, bp.Name,hdr.C_BPartner_ID, lin.Line,lin.M_InOutLine_ID, p.Name,lin.M_Product_ID, lin.MovementQty,SUM(NVL(m.Qty,0)) as match FROM M_InOut hdr INNER JOIN C_BPartner bp ON (hdr.C_BPartner_ID=bp.C_BPartner_ID) INNER JOIN M_InOutLine lin ON (hdr.M_InOut_ID=lin.M_InOut_ID) INNER JOIN M_Product p ON (lin.M_Product_ID=p.M_Product_ID) INNER JOIN C_DocType dt ON (hdr.C_DocType_ID = dt.C_DocType_ID AND dt.DocBaseType='MMR' AND dt.isReturnTrx = ").concat(i.chkIsReturnTrx.prop("checked")?"'Y')":"'N')").concat(" FULL JOIN ").concat(t==f?"M_MatchPO":"M_MatchInv").concat(" m ON (lin.M_InOutLine_ID=m.M_InOutLine_ID) WHERE hdr.DocStatus IN ('CO','CL')"),w=" GROUP BY hdr.M_InOut_ID,hdr.DocumentNo,hdr.MovementDate,bp.Name,hdr.C_BPartner_ID, lin.Line,lin.M_InOutLine_ID,p.Name,lin.M_Product_ID,lin.MovementQty HAVING "+(u?"0":"lin.MovementQty")+"<>SUM(NVL(m.Qty,0))")}function st(t){var s=n.MRole.getDefault().addAccessSQL(r.toString(),"hdr",n.MRole.SQL_FULLYQUALIFIED,n.MRole.SQL_RO)+w,u;try{for(var f=n.DB.executeReader(s.toString(),null,null),e=[],o=1;f.read();)u={},u._ID=f.getInt(0),u.DocumentNo=f.getString(1),u.Date=f.getString(2),u.C_BPartner_ID=f.getString(3),u.C_BPartner_ID_K=f.getInt(4),u.Line=f.getString(5),u.Line_K=f.getInt(6),u.M_Product_ID=f.getString(7),u.M_Product_ID_K=f.getInt(8),u.Qty=f.getString(9),u.Matched=f.getString(10),u.recid=o,o++,e.push(u);if(f.close(),t.columns.length>0,e.length<1){ht(t.name.contains("vdgvReceipt"));return}t.name.contains("vdgvReceipt")?dt(i.arrListColumns,e):t.name.contains("vdgvInvoice")&&(kt(i.arrListColumns,e),c())}catch(h){}}function bt(r,u,f,e,o){if(e==0)return!0;var s=i;t.ajax({url:n.Application.contextUrl+"Common/CreateMatchRecord",dataType:"json",data:{invoice:r,M_InOutLine_ID:u,Line_ID:f,qty:e},success:function(){it();i.vdgvReceipt.delete(!0);n.ADialog.info("Processed Line No: "+o.toString(),null,null,null)}})}function ht(r){i.arrListColumns.length==0&&(i.arrListColumns.push({field:"_ID",caption:"_ID",sortable:!0,size:"11%",hidden:!0}),i.arrListColumns.push({field:"DocumentNo",caption:n.Msg.translate(n.Env.getCtx(),"DocumentNo"),sortable:!0,size:"11%",hidden:!1}),i.arrListColumns.push({field:"Date",caption:n.Msg.translate(n.Env.getCtx(),"Date"),sortable:!0,size:"11%",hidden:!1,render:"date"}),i.arrListColumns.push({field:"C_BPartner_ID",caption:n.Msg.translate(n.Env.getCtx(),"C_BPartner_ID"),sortable:!0,size:"11%",hidden:!1}),i.arrListColumns.push({field:"C_BPartner_ID_K",caption:n.Msg.translate(n.Env.getCtx(),"C_BPartner_ID"),sortable:!0,size:"11%",hidden:!0}),i.arrListColumns.push({field:"Line",caption:n.Msg.translate(n.Env.getCtx(),"Line"),sortable:!0,size:"11%",hidden:!1}),i.arrListColumns.push({field:"Line_K",caption:n.Msg.translate(n.Env.getCtx(),"Line"),sortable:!0,size:"11%",hidden:!0}),i.arrListColumns.push({field:"M_Product_ID",caption:n.Msg.translate(n.Env.getCtx(),"M_Product_ID"),sortable:!0,size:"11%",hidden:!1}),i.arrListColumns.push({field:"M_Product_ID_K",caption:n.Msg.translate(n.Env.getCtx(),"M_Product_ID"),sortable:!0,size:"11%",hidden:!0}),i.arrListColumns.push({field:"Qty",caption:n.Msg.translate(n.Env.getCtx(),"Qty"),sortable:!0,size:"11%",hidden:!1}),i.arrListColumns.push({field:"Matched",caption:n.Msg.translate(n.Env.getCtx(),"Matched"),sortable:!0,size:"11%",hidden:!1}));r==null?(i.vdgvInvoice!=null&&(i.vdgvInvoice.destroy(),i.vdgvInvoice=null),i.vdgvInvoice=t(i.invoicegrd).w2grid({name:"vdgvInvoice"+i.windowNo,recordHeight:30,show:{selectColumn:!1},onSelect:function(n){c(n.recid)},multiSelect:!1,columns:i.arrListColumns,records:null}),i.vdgvReceipt!=null&&(i.vdgvReceipt.destroy(),i.vdgvReceipt=null),i.vdgvReceipt=t(i.reciptgrd).w2grid({name:"vdgvReceipt"+i.windowNo,recordHeight:30,show:{selectColumn:!0},onSelect:function(n){this.multiSelect=!0;a(n.recid,!0)},onUnselect:function(n){a(n.recid,!1)},multiSelect:!1,columns:i.arrListColumns,records:null})):r?r&&(i.vdgvReceipt!=null&&(i.vdgvReceipt.destroy(),i.vdgvReceipt=null),i.vdgvReceipt=t(i.reciptgrd).w2grid({name:"vdgvReceipt"+i.windowNo,recordHeight:30,show:{selectColumn:!0},onSelect:function(n){this.multiSelect=!0;a(n.recid,!0)},onUnselect:function(n){a(n.recid,!1)},multiSelect:!1,columns:i.arrListColumns,records:null})):(i.vdgvInvoice!=null&&(i.vdgvInvoice.destroy(),i.vdgvInvoice=null),i.vdgvInvoice=t(i.invoicegrd).w2grid({name:"vdgvInvoice"+i.windowNo,recordHeight:30,show:{selectColumn:!1},onSelect:function(n){c(n.recid)},multiSelect:!1,columns:i.arrListColumns,records:null}))}function kt(n,r){i.vdgvInvoice!=null&&(i.vdgvInvoice.destroy(),i.vdgvInvoice=null);w2utils.encodeTags(r);i.vdgvInvoice=t(i.invoicegrd).w2grid({name:"vdgvInvoice"+i.windowNo,recordHeight:30,show:{selectColumn:!1},onSelect:function(n){c(n.recid)},multiSelect:!1,columns:n,records:r})}function dt(n,r){i.vdgvReceipt!=null&&(i.vdgvReceipt.destroy(),i.vdgvReceipt=null);w2utils.encodeTags(r);i.vdgvReceipt=t(i.reciptgrd).w2grid({name:"vdgvReceipt"+i.windowNo,recordHeight:30,show:{selectColumn:!0},onSelect:function(n){this.multiSelect=!0;a(n.recid,!0)},onUnselect:function(n){a(n.recid,!1)},multiSelect:!1,columns:n,records:r})}function a(n,t){var o,r,u,h,c;if(!(i.vdgvInvoice.records.length<1)){if(!i.chkSameProduct.prop("checked")){setTimeout(function(){i.vdgvReceipt.unselect(Number(n))},10);return}o=-1;i.vdgvInvoice.getSelection().length>0&&(o=Number(i.vdgvInvoice.getSelection().toString()));var a={key:i.vdgvInvoice.get(o).M_Product_ID_K,value:i.vdgvInvoice.get(o).M_Product_ID},f=0,s=0,e=n+","+i.vdgvReceipt.getSelection().toString().replace(n,"");if(t&&e!=null&&e.length>0)for(e=e.replace(/,$/,""),r=e.toString().split(","),u=0;u<r.length;u++)if(h=i.vdgvReceipt.get(r[0])._ID,h!=null){if(c={key:i.vdgvReceipt.get(r[u]).M_Product_ID_K,value:i.vdgvReceipt.get(r[u]).M_Product_ID},a.key!=c.key){setTimeout(function(){i.vdgvReceipt.unselect(Number(n))},10);return}i.cmbMatchMode.getControl()[0].selectedIndex==d&&(f=f+Number(i.vdgvReceipt.get(r[u]).Qty));f=f-Number(i.vdgvReceipt.get(r[u]).Matched);s++}g=f;i.txtMatchedTo.setValue(g.toString());i.txtDifference.setValue(l-g);s<=0&&i.btnProcess.removeAttr("disabled");i.lblStatusCount.getControl().text(s)}}var i,h;this.frame;this.windowNo;i=this;this.arrListColumns=[];this.vdgvInvoice=null;this.vdgvReceipt=null;this.lblMatchFrom=new n.Controls.VLabel;this.lblMatchTo=new n.Controls.VLabel;this.lblMatchMode=new n.Controls.VLabel;this.lblBPartner=new n.Controls.VLabel;this.lblProduct=new n.Controls.VLabel;this.lblDateFrom=new n.Controls.VLabel;this.lblDateTo=new n.Controls.VLabel;this.lblInvoice=new n.Controls.VLabel;this.lblReceipt=new n.Controls.VLabel;this.lblMatched=new n.Controls.VLabel;this.lblMatchedTo=new n.Controls.VLabel;this.lblDifference=new n.Controls.VLabel;this.lblStatusInfo=new n.Controls.VLabel;this.lblStatusCount=new n.Controls.VLabel;this.lblSearch=new n.Controls.VLabel;this.cmbMatchFrom=new n.Controls.VComboBox("",!1,!1,!0);this.cmbMatchTo=new n.Controls.VComboBox("",!1,!1,!0);this.cmbMatchMode=new n.Controls.VComboBox("",!1,!1,!0);this.chkIsReturnTrx=null;this.chkSameBPartner=null;this.chkSameProduct=null;this.chkSameQty=null;this.onlyVendor=null;this.onlyProduct=null;this.dtpFrom=null;this.dtpTo=null;this.btnSearch=null;this.btnProcess=null;this.btnToggel=null;this.txtMatched=new n.Controls.VTextBox("",!1,!0,!1);this.txtMatchedTo=new n.Controls.VTextBox("",!1,!0,!1);this.txtDifference=new n.Controls.VTextBox("",!1,!0,!1);this.$root=t("<div style='width: 100%; height: 100%; background-color: white;'>");this.$busyDiv=t("<div id='testBesy' style='height: 100%;' class='vis-apanel-busy'>");this.sideDiv=null;this.gridSelectDiv=null;this.gridInvoiceDiv=null;this.gridReciptDiv=null;this.processlDiv=null;this.bottumDiv=null;this.bottumButtonDiv=null;this.btnSpaceDiv=null;this.topDiv=null;this.div=null;this.divForGrid=null;this.invoicegrd=null;this.reciptgrd=null;this.invoiceTopDiv=null;var b=!1,v=260,k=50,y=t(window).width()-(v+30),nt=t(window).width()-(30+k),tt=t(window).height()-240,ct=n.Env.getCtx().getAD_Client_ID(),lt=n.Env.getCtx().getAD_Org_ID(),at=n.Env.getCtx().getAD_User_ID(),o=0,e=1,f=2,d=0,rt=1,r=null,s="",p="",w="",l=0,g=0,u=[];u.push(n.Msg.getElement3(n.Env.getAD_Language(n.Env.getCtx()),"C_Invoice_ID",!1));u.push(n.Msg.getElement3(n.Env.getAD_Language(n.Env.getCtx()),"M_InOut_ID",!1));u.push(n.Msg.getElement3(n.Env.getAD_Language(n.Env.getCtx()),"C_Order_ID",!1));h=[];h.push(n.Msg.getMsg("NotMatched"));h.push(n.Msg.getMsg("Matched"));this.Initialize=function(){for(var r=0;r<u.length;r++)this.cmbMatchFrom.getControl().append(" <option value='"+u[r]+"'>"+u[r]+"<\/option>");for(r=0;r<h.length;r++)this.cmbMatchMode.getControl().append(" <option value='"+h[r]+"'>"+h[r]+"<\/option>");if(this.cmbMatchFrom.getControl().prop("selectedIndex",0),this.cmbMatchMode.getControl().prop("selectedIndex",0),pt(),yt(),vt(),this.btnToggel=this.$root.find("#btnToggelDiv_"+i.windowNo),this.gridSelectDiv=this.$root.find("#divForGrid_"+i.windowNo),this.cmbMatchFrom.getControl()!=null&&this.cmbMatchFrom.getControl().change(function(){i.$busyDiv[0].style.visibility="visible";ut();ft();i.$busyDiv[0].style.visibility="hidden"}),this.cmbMatchTo.getControl()!=null&&this.cmbMatchTo.getControl().change(function(){i.$busyDiv[0].style.visibility="visible";et();i.$busyDiv[0].style.visibility="hidden"}),this.btnSearch!=null)this.btnSearch.on(n.Events.onTouchStartOrClick,function(){i.$busyDiv[0].style.visibility="visible";it();i.$busyDiv[0].style.visibility="hidden"});if(this.btnProcess!=null)this.btnProcess.on(n.Events.onTouchStartOrClick,function(){i.$busyDiv[0].style.visibility="visible";wt();i.$busyDiv[0].style.visibility="hidden"});if(this.btnToggel!=null)this.btnToggel.on(n.Events.onTouchStartOrClick,function(){b?(i.btnToggel.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),b=!1,i.btnSpaceDiv.animate({width:v},"slow"),i.gridSelectDiv.animate({width:y},"slow"),i.invoiceTopDiv.animate({width:y},"slow"),i.div.css("display","block"),i.sideDiv.animate({width:v},"slow",null,function(){i.vdgvInvoice.resize();i.vdgvReceipt.resize()})):(i.btnToggel.animate({borderSpacing:180},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),b=!0,i.btnSpaceDiv.animate({width:k},"slow"),i.sideDiv.animate({width:k},"slow"),i.div.css("display","none"),i.invoiceTopDiv.animate({width:nt},"slow"),i.gridSelectDiv.animate({width:nt},"slow",null,function(){i.vdgvInvoice.resize();i.vdgvReceipt.resize()}))});this.chkSameBPartner.change(function(){i.$busyDiv[0].style.visibility="visible";c();i.$busyDiv[0].style.visibility="hidden"});this.chkSameQty.change(function(){i.$busyDiv[0].style.visibility="visible";c();i.$busyDiv[0].style.visibility="hidden"});this.chkSameProduct.change(function(){i.$busyDiv[0].style.visibility="visible";c();i.$busyDiv[0].style.visibility="hidden"});i.$busyDiv[0].style.visibility="hidden"};this.display=function(){ut()};this.getRoot=function(){return this.$root};this.callConsolidate=function(){t.ajax({url:n.Application.contextUrl+"Common/Consolidate",dataType:"json",async:!0,success:function(){}});i.vdgvReceipt.multiSelect=!0;var r="vdgvReceipt"+i.windowNo;w2ui[r].multiSelect=!0};this.disposeComponent=function(){this.btnSearch&&this.btnSearch.off(n.Events.onTouchStartOrClick);this.btnProcess&&this.btnProcess.off(n.Events.onTouchStartOrClick);this.btnToggel&&this.btnToggel.off(n.Events.onTouchStartOrClick);this.frame=null;this.windowNo=null;this.arrListColumns=null;this.vdgvInvoice=null;this.vdgvReceipt=null;this.lblMatchFrom=null;this.lblMatchTo=null;this.lblMatchMode=null;this.lblBPartner=null;this.lblProduct=null;this.lblDateFrom=null;this.lblDateTo=null;this.lblInvoice=null;this.lblReceipt=null;this.lblMatched=null;this.lblMatchedTo=null;this.lblDifference=null;this.lblStatusInfo=null;this.lblStatusCount=null;this.lblSearch=null;this.cmbMatchFrom=null;this.cmbMatchTo=null;this.cmbMatchMode=null;this.chkIsReturnTrx=null;this.chkSameBPartner=null;this.chkSameProduct=null;this.chkSameQty=null;this.onlyVendor=null;this.onlyProduct=null;this.dtpFrom=null;this.dtpTo=null;this.btnSearch=null;this.btnProcess=null;this.btnToggel=null;this.txtMatched=null;this.txtMatchedTo=null;this.txtDifference=null;this.$root=null;this.$busyDiv=null;this.sideDiv=null;this.gridSelectDiv=null;this.gridInvoiceDiv=null;this.gridReciptDiv=null;this.processlDiv=null;this.bottumDiv=null;this.btnSpaceDiv=null;b=null;v=null;k=null;y=null;nt=null;tt=null;ct=null;lt=null;at=null;o=null;e=null;f=null;d=null;rt=null;r=null;s=null;p=null;w=null;l=null;g=null;i=null;u=null;h=null;this.disposeComponent=null}}n.Apps.AForms=n.Apps.AForms||{};i.prototype.init=function(t,i){this.frame=i;this.windowNo=t;n.Env.getCtx().setContext(this.windowNo,"IsSOTrx","Y");try{var r=this.Initialize()}catch(u){}this.frame.getContentGrid().append(this.getRoot());this.display();this.callConsolidate()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VMatch=i}(VIS,jQuery),function(n,t){function i(){function dt(){var k,d;setBusy(!0);l.setValue(!0);k=n.Application.contextUrl+"Areas/VIS/Images/base/arrow-left.png";h=t("<div id='sideDiv_"+i.windowNo+"' style='float: left; margin-left: 0px; width:260px;height: 90%'>");w=t("<div id='btnSpaceDiv_"+i.windowNo+"' style='width: 260px; height: 45px;float: left;padding-left: 11px; padding-top: 11px;background-color: #F1F1F1;   margin-bottom: 1px;'><button id='btnSpace_"+i.windowNo+"' style='border: 0px;background-color: transparent; padding: 0px;' ><img src='"+k+"' /><\/button><\/div><\/div>");b=t("<div style='float: left; width: 100%;background-color: #F1F1F1;height:"+at+"px ' id='parameterDiv_"+i.windowNo+"'>");h.append(w).append(b);k=n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png";u=t("<button id='btnRefresh_"+i.windowNo+"' style='margin-bottom: 1px; margin-top: 0px; float: left;margin-left: 15px;height: 38px; ' class='VIS_Pref_btn-2'><img src='"+k+"'><\/button>");a=t("<input id='btnCreateCharge_"+i.windowNo+"' class='VIS_Pref_btn-2' style='margin-bottom: 1px;margin-top: 1px; float: right; margin-right: 10px ;width: 70px;height: 38px;' type='button' value='"+n.Msg.getMsg("Create",!1,!1)+"'>");c=t("<input id='btnCancel_"+i.windowNo+"' class='VIS_Pref_btn-2' style='margin-bottom: 1px; margin-top: 1px; float: right;margin-right: 5px ;width: 70px;height: 38px;' type='button' value='"+n.Msg.getMsg("Cancel",!1,!1)+"'>");s=t("<input id='btnAccount_"+i.windowNo+"' class='VIS_Pref_btn-2' style='margin-bottom: 1px;margin-top: 1px; float: right; margin-right: 0px ;width: 70px;height: 38px;' type='button' value='"+n.Msg.getMsg("Create",!1,!1)+"'>");var o=t("<table style='width: 100%;'>"),r=t("<tr>"),e=t("<td style='padding: 4px 15px 2px;'>");b.append(o);o.append(r);r.append(e);e.append(tt.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));r=t("<tr>");e=t("<td style='padding: 4px 15px 2px;'>");o.append(r);r.append(e);e.append(v.getControl().css("display","inline-block").css("width","236px").css("height","30px"));r=t("<tr>");e=t("<td style='padding: 4px 15px 2px;'>");o.append(r);r.append(e);e.append(it.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));r=t("<tr>");e=t("<td style='padding: 0px 15px 0px;'>");o.append(r);r.append(e);e.append(y.getControl().css("display","inline-block").css("width","236px").css("height","30px"));r=t("<tr>");e=t("<td style='padding: 4px 15px 2px;'>");o.append(r);r.append(e);e.append(l.getControl().css("height","30px"));ut=t("<div style='width: 100%; height: 45px; float: left; background-color: #F1F1F1;'>");d=t("<div style='width: 100%; float: right; text-align: right; margin-bottom: 0px;'>");d.append(s).append(c);ut.append(a).append(u);f=t("<div id='rightSideGridDiv_"+i.windowNo+"' style='height: 98%; float: right;  margin-left: 15px;margin-right: 15px;'>");f.css("width",et);rt=t("<div id='gridDiv_"+i.windowNo+"' style=' float: left; border: 1px solid rgb(169, 169, 169); width: 100%;margin-top: 1px;height:"+(b.height()+45)+"px'>");f.append(rt);f.append(d);h.append(ut);p.append(st);p.append(h).append(f)}function gt(u){r!=null&&(r.destroy(),r=null);o.length==0&&(o.push({field:"C_ElementValue_ID",caption:n.Msg.getMsg("C_ELEMENTVALUE_ID"),sortable:!0,size:"16%",min:150,hidden:!0}),o.push({field:"Value",caption:n.Msg.getMsg("SearchKey"),sortable:!0,size:"25%",min:150,hidden:!1}),o.push({field:"Name",caption:n.Msg.getMsg("Name"),sortable:!0,size:"25%",min:150,hidden:!1}),o.push({field:"Expense",caption:n.Msg.getMsg("Expense"),sortable:!0,size:"25%",min:150,hidden:!1,editable:{type:"checkbox"}}));w2utils.encodeTags(u);r=t(rt).w2grid({name:"gridAccountElement"+i.windowNo,recordHeight:40,show:{selectColumn:!0},multiSelect:!0,columns:o,records:u})}function vt(){var u=[],i,r,f,t;if(g=n.Env.getCtx().getContextAsInt("$C_AcctSchema_ID"),ht=n.Env.getCtx().getAD_Client_ID(),ct=n.Env.getCtx().getAD_Org_ID(),i="SELECT C_Element_ID FROM C_AcctSchema_Element WHERE ElementType='AC' AND C_AcctSchema_ID= "+g,d=n.DB.executeScalar(i,null,null),d!=0){i="SELECT C_TaxCategory_ID FROM C_TaxCategory WHERE IsDefault='Y' AND AD_Client_ID="+ht;ot=n.DB.executeScalar(i,null,null);i="SELECT 'false' as Select1,C_ElementValue_ID,Value, Name, case when AccountType = 'E' THEN 'true' else 'false' end as Expense FROM C_ElementValue  WHERE AccountType IN ('R','E') AND IsSummary='N' AND C_Element_ID= "+d+" ORDER BY 2 desc";try{for(r=n.DB.executeReader(i.toString(),null,null),f=1;r.read();)t={},t.C_ElementValue_ID=r.getString(1),t.Value=r.getString(2),t.Name=r.getString(3),t.Expense=r.getString(4)=="false"?!1:!0,t.recid=f,f++,u.push(t)}catch(e){}return gt(u),setBusy(!1),u}}function ni(r,u,f,e,o){t.ajax({url:n.Application.contextUrl+"VCharge/CreateCharge",dataType:"json",async:!1,data:{m_C_AcctSchema_ID:r,m_C_TaxCategory_ID:u,name:f,C_ElementValue_ID:e,expense:o},success:function(t){if(t.ID==0){i.log.saveError("ChargeNotCreated",t.Msg);n.ADialog.warn(t.Msg,!0,null);setBusy(!1);return}var r=t.ID;n.ADialog.info("ChargeCreated",!0,null);setBusy(!1)}})}function ti(i,r,u,f,e){t.ajax({url:n.Application.contextUrl+"VCharge/CreateChargeByList",type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",async:!1,data:JSON.stringify({AcctSchemaID:i,TaxCategoryID:r,namepara:u,ElementValuID:f,expense:e}),success:function(t){t.listCreatedP&&n.ADialog.info("ChargeCreated \n"+t.listCreatedP.replaceAll(",","\n"),!0,null);t.listRejectedP&&n.ADialog.info("ChargeNotCreated \n"+t.listRejectedP.replaceAll(",","\n"),!0,null);setBusy(!1)}})}this.frame;this.windowNo;var i=this,o=[],r=null,yt=!1,pt=!1,nt=!1,tt=new n.Controls.VLabel(n.Msg.getMsg("SearchKey",!1,!1),"SearchKey",!1,!0),it=new n.Controls.VLabel(n.Msg.getMsg("Name",!1,!1),"Name",!1,!0),v=new n.Controls.VTextBox("SearchKey",!0,!1,!0,50,100,null,null,!1),y=new n.Controls.VTextBox("Name",!1,!1,!0,50,100,null,null,!1),l=new n.Controls.VCheckBox("Expense",!1,!1,!0,n.Msg.getMsg("Expense",!1,!1),null),wt=new n.Controls.VCheckBox("SelectAll",!1,!1,!0,n.Msg.getMsg("SelectAll",!1,!1),null),a=null,s=null,bt=new n.Controls.VLabel;this.log=n.Logging.VLogger.getVLogger("VCharge");var p=t("<div style='width: 100%; height: 100%; background-color: white; '>"),st=t("<div class='vis-apanel-busy' style='width:100%;height:100%;z-index: 1'>"),h=null,f=null,w=null,b=null,rt=null,ut=null,c=null,u=null,e=null,k=260,ft=50,et=t(window).width()-(k+30),lt=t(window).width()-(30+ft),kt=et+k+5,at=t(window).height()-210,d=0,g=0,ot=0,ht=0,ct=0;setBusy=function(n){st.css("display",n?"block":"none")};this.Initialize=function(){if(dt(),e=p.find("#btnSpace_"+i.windowNo),c!=null)c.on(n.Events.onTouchStartOrClick,function(){i.dispose()});if(u!=null)u.on(n.Events.onTouchStartOrClick,function(){setBusy(!0);vt();setBusy(!1)});if(e!=null)e.on(n.Events.onTouchStartOrClick,function(){nt?(a.show(),u.show(),tt.getControl().show(),it.getControl().show(),v.getControl().show(),y.getControl().show(),l.getControl().show(),e.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),nt=!1,f.animate({width:et},"slow"),w.animate({width:k},"slow"),h.animate({width:k},"slow",null,function(){r.resize()})):(a.hide(),u.hide(),tt.getControl().hide(),it.getControl().hide(),v.getControl().hide(),y.getControl().hide(),l.getControl().hide(),e.animate({borderSpacing:180},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),nt=!0,w.animate({width:ft},"slow"),h.animate({width:ft},"slow"),f.animate({width:lt},"slow",null,function(){r.resize()}))});if(s!=null)s.on(n.Events.onTouchStartOrClick,function(){var i,t,n;setBusy(!0);var u=[],f=[],e=[];if(r&&(i=r.getSelection(),i)&&!(i.length<=0)){for(t=i.toString().split(","),n=0;n<t.length;n++)u[n]=r.get(t[n]).C_ElementValue_ID,f[n]=r.get(t[n]).Name,e[n]=r.get(t[n]).Expense;if(u.length==0)return"";ti(g,ot,f,u,e)}});if(a!=null)a.on(n.Events.onTouchStartOrClick,function(){var u,f,r;if(setBusy(!0),u=l.getValue(),f=v.getValue().trim(),f.length==0){n.ADialog.warn("SearchKeyMandatory",!0,null);setBusy(!1);return}if(r=y.getValue().trim(),r.length==0){n.ADialog.warn("NameMandatory",!0,null);setBusy(!1);return}t.ajax({url:n.Application.contextUrl+"VCharge/CreateElementValue",dataType:"json",async:!1,data:{m_AD_Org_ID:ct,value:f,name:r,expense:u,m_C_Element_ID:d},success:function(t){if(t.ID==0){i.log.saveError("ChargeNotCreated",t.Msg);n.ADialog.warn(t.Msg,!0,null);setBusy(!1);return}ni(g,ot,r,t.ID,u)}})})};this.display=function(){setTimeout(vt(),5)};this.getRoot=function(){return p};this.disposeComponent=function(){c&&c.off(n.Events.onTouchStartOrClick);u&&u.off(n.Events.onTouchStartOrClick);e&&e.off(n.Events.onTouchStartOrClick);s&&s.off(n.Events.onTouchStartOrClick);i.windowNo=null;o=null;r=null;yt=null;pt=null;nt=null;tt=null;it=null;v=null;y=null;l=null;wt=null;btnCreateCharg=null;s=null;bt=null;i.log=null;p=null;st=null;h=null;f=null;w=null;b=null;rt=null;ut=null;c=null;u=null;e=null;k=null;ft=null;et=null;lt=null;kt=null;at=null;d=null;g=null;ot=null;ht=null;ct=null;i=null;this.getRoot=null;this.disposeComponent=null}}n.Apps.AForms=n.Apps.AForms||{};i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.Initialize();this.frame.getContentGrid().append(this.getRoot());this.display()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VCharge=i}(VIS,jQuery),function(n,t){function i(){function ti(){var b,g;setBusy(!0);b=n.Application.contextUrl+"Areas/VIS/Images/base/arrow-left.png";c=t("<div id='sideDiv_"+i.windowNo+"' style='float: left; margin-left: 0px; width:260px;height: 90%'>");a=t("<div id='btnSpaceDiv_"+i.windowNo+"' style='width: 260px; height: 45px;float: left;padding-left: 11px; padding-top: 11px;background-color: #F1F1F1;   margin-bottom: 1px;'><button id='btnSpace_"+i.windowNo+"' style='border: 0px;background-color: transparent; padding: 0px;' ><img src='"+b+"' /><\/button><\/div><\/div>");v=t("<div style='float: left; width: 100%;background-color: #F1F1F1;height:"+lt+"px ' id='parameterDiv_"+i.windowNo+"'>");c.append(a).append(v);b=n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png";f=t("<button id='btnRefresh_"+i.windowNo+"' style='margin-bottom: 1px; margin-top: 0px; float: right;margin-right: 10px;height: 38px; ' class='VIS_Pref_btn-2'><img src='"+b+"'><\/button>");h=t("<input id='btnOk_"+i.windowNo+"' class='VIS_Pref_btn-2' style='margin-bottom: 1px; margin-top: 1px; float: right;margin-right: 5px ;width: 70px;height: 38px;' type='button' value='"+n.Msg.getMsg("OK",!1,!1)+"'>");var y=t("<table style='width: 100%;'>"),u=t("<tr>"),o=t("<td style='padding: 4px 15px 2px;'>");v.append(y);y.append(u);u.append(o);o.append(r.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));u=t("<tr>");o=t("<td style='padding: 4px 15px 2px;'>");y.append(u);u.append(o);o.append(w.getControl().css("display","inline-block").css("width","236px").css("height","30px"));u=t("<tr>");o=t("<td style='padding: 4px 15px 2px;'>");y.append(u);u.append(o);o.append(p.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));u=t("<tr>");o=t("<td style='padding: 0px 15px 0px;'>");y.append(u);u.append(o);o.append(rt.getControl().css("display","inline-block").css("width","236px").css("height","30px"));u=t("<tr>");o=t("<td style='padding: 4px 15px 2px;'>");y.append(u);u.append(o);o.append(kt.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));u=t("<tr>");o=t("<td style='padding: 0px 15px 0px;'>");y.append(u);u.append(o);o.append(ut.getControl().css("display","inline-block").css("width","236px").css("height","30px"));u=t("<tr>");o=t("<td style='padding: 4px 15px 2px;'>");y.append(u);u.append(o);o.append(dt.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));u=t("<tr>");o=t("<td style='padding: 0px 15px 0px;'>");y.append(u);u.append(o);o.append(ft.getControl().css("display","inline-block").css("width","236px").css("height","30px"));d=t("<div style='width: 100%; height: 45px; float: left; background-color: #F1F1F1;'>");g=t("<div style='width: 100%; float: right; text-align: right; margin-bottom: 0px;'>");g.append(h);d.append(f);s=t("<div id='rightSideGridDiv_"+i.windowNo+"' style='height: 98%; float: right;  margin-left: 15px;margin-right: 15px;'>");s.css("width",tt);k=t("<div id='gridDiv_"+i.windowNo+"' style=' float: left; border: 1px solid rgb(169, 169, 169); width: 100%;margin-top: 1px;height:"+(v.height()+45)+"px'>");k.append(e);s.append(k);s.append(g);c.append(d);l.append(et);l.append(c).append(s)}function ii(){st.push({Key:"0",Name:n.Msg.getMsg("ModeView",!1,!1)});ui();ri()}function ri(){t.ajax({url:n.Application.contextUrl+"Common/GetDataQueryAttribute",type:"GET",dataType:"json",async:!1,success:function(n){if(n.lst){u=n.lst;for(var t=0;t<u.length;t++)at(w.getControl(),u[t].GetKeyNamePair,t),at(rt.getControl(),u[t].GetKeyNamePair,t)}n.priceList&&ot(ut.getControl(),n.priceList);n.whList&&ot(ft.getControl(),n.whList);setBusy(!1)}})}function ui(){ot(b.getControl(),st)}function ot(n,t){for(var i=0;i<t.length;i++)n.append(" <option selected value='"+t[i].Key+"' >"+t[i].Name+"<\/option>");n.prop("selectedIndex",0)}function at(n,t,i){i==0&&n.append(" <option selected value='0' ><\/option>");n.append(" <option selected value='"+t.Key+"' >"+t.Name+"<\/option>");n.prop("selectedIndex",0)}function fi(i,r){var s,h,o,f,u;for(r=r<2?2:r,i+=1,row=0;row<i;row++)for(s=t("<tr id='row_"+row+"' >"),e.append(s),col=0;col<r;col++)h=t("<td id='col_"+col+"'  style='padding: 4px 15px 2px;'>"),s.append(h);o=new n.Controls.VLabel;o.getControl().text("Mode");f=e.find("#row_0");r==2?(u=f.find("#col_"+(r-1)),u.append(b.getControl().css("display","inline-block").css("width","236px").css("height","30px")),u=f.find("#col_"+(r-2)),u.append(o.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"))):(u=f.find("#col_2"),u.append(b.getControl().css("display","inline-block").css("width","236px").css("height","30px")),u=f.find("#col_1"),u.append(o.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font")))}function ei(r,u){var f=0,e=0,o=0,s=0;r&&(f=r.GetM_Attribute_ID,e=r.GetM_AttributeValue_ID);u&&(o=u.GetM_Attribute_ID,s=u.GetM_AttributeValue_ID);t.ajax({url:n.Application.contextUrl+"Common/GetGridElement",dataType:"json",data:{xM_Attribute_ID:f,xM_AttributeValue_ID:e,yM_Attribute_ID:o,yM_AttributeValue_ID:s,M_PriceList_Version_ID:ht,M_Warehouse_ID:ct,windowNo:i.windowNo},async:!1,success:function(){setBusy(!1)}})}function oi(){var h,c,a,t,f,p,b;if(w!=null&&!it){if(h=w.getControl()[0].selectedIndex,c=rt.getControl()[0].selectedIndex,h==c){i.log.warning("Same Attribute Selected");return}it=!0;ht=ut.getControl().find("option:selected").val();ct=ft.getControl().find("option:selected").val();var v=2,o=[],s=[],l=null,y=null;for(h>0&&(o=u[h-1].GetMAttributeValues),o!=null&&(v=o.length+1,i.log.info("X - "+u[h-1].GetName+" #"+o.length)),a=2,c>0&&(s=u[c-1].GetMAttributeValues),s.length>0&&(a=s.length+1,i.log.info("Y - "+u[c-1].GetName+" #"+s.length)),i.log.info("Rows="+a+" - Cols="+v),fi(a,v),t=null,f=null,row=0;row<a;row++)for(col=0;col<v;col++)o!=null&&(l=o[col]),s!=null&&(y=s[row]),row==0&&col==0?(p=new n.Controls.VLabel,b=new n.Controls.VLabel,o!=null&&(p.getControl().text(u[h-1].GetName),t=e.find("#row_1"),f=t.find("#col_"+col),f.append(p.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"))),s.length>0&&(b.getControl().text(u[c-1].GetName),t=e.find("#row_1"),f=t.find("#col_"+col),f.append(b.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"))),l!=null&&(r=new n.Controls.VLabel,r.getControl().text(l.Name),t=e.find("#row_1"),f=t.find("#col_"+(col+1)),f.append(r.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font")))):row==0?l!=null&&(r=new n.Controls.VLabel,r.getControl().text(l.Name),t=e.find("#row_1"),f=t.find("#col_"+(col+1)),f.append(r.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"))):col==0?y!=null&&(r=new n.Controls.VLabel,r.getControl().text(y.Name),t=e.find("#row_"+row+1),f=t.find("#col_"+col),f.append(r.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"))):ei(l,y,col,row+1);it=!1}}function si(){var n=b.getControl().find("option:selected").val();n!=wt&&n!=bt&&n==pt}this.frame;this.windowNo;var i=this,vt=!1,yt=!1,y=!1,it=!1,st=[],pt=0,wt=0,bt=0,ht=0,ct=0,u=[],r=new n.Controls.VLabel(n.Msg.getElement(n.Env.getCtx(),"M_Attribute_ID"),"M_Attribute_ID",!1,!0),p=new n.Controls.VLabel(n.Msg.getElement(n.Env.getCtx(),"M_Attribute_ID"),"M_Attribute_ID",!1,!0),kt=new n.Controls.VLabel(n.Msg.getElement(n.Env.getCtx(),"M_PriceList_ID"),"M_PriceList_ID",!1,!0),dt=new n.Controls.VLabel(n.Msg.getElement(n.Env.getCtx(),"M_Warehouse_ID"),"M_Warehouse_ID",!1,!0),hi=new n.Controls.VLabel(n.Msg.getMsg("Mode",!1,!1),"Mode",!1,!0),w=new n.Controls.VComboBox("",!1,!1,!0),rt=new n.Controls.VComboBox("",!1,!1,!0),ut=new n.Controls.VComboBox("",!1,!1,!0),ft=new n.Controls.VComboBox("",!1,!1,!0),b=new n.Controls.VComboBox("",!1,!1,!0);this.log=n.Logging.VLogger.getVLogger("VAttributeGrid");var l=t("<div style='width: 100%; height: 100%; background-color: white; '>"),et=t("<div class='vis-apanel-busy' style='width:100%;height:100%;z-index: 1'>"),c=null,s=null,a=null,v=null,k=null,d=null,h=null,f=null,o=null,g=260,nt=50,tt=t(window).width()-(g+30),gt=t(window).width()-(30+nt),ni=tt+g+5,lt=t(window).height()-210,e=t("<table style='width: 100%;'>");setBusy=function(n){et.css("display",n?"block":"none")};this.Initialize=function(){if(ti(),o=l.find("#btnSpace_"+i.windowNo),h!=null)h.on(n.Events.onTouchStartOrClick,function(){si();i.dispose()});if(f!=null)f.on(n.Events.onTouchStartOrClick,function(){setBusy(!0);e.empty();oi();setBusy(!1)});if(o!=null)o.on(n.Events.onTouchStartOrClick,function(){y?(f.show(),r.getControl().show(),p.getControl().show(),o.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),y=!1,s.animate({width:tt},"slow"),a.animate({width:g},"slow")):(f.hide(),r.getControl().hide(),p.getControl().hide(),o.animate({borderSpacing:180},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),y=!0,a.animate({width:nt},"slow"),c.animate({width:nt},"slow"))})};this.display=function(){setTimeout(ii(),5)};this.getRoot=function(){return l};this.disposeComponent=function(){h&&h.off(n.Events.onTouchStartOrClick);f&&f.off(n.Events.onTouchStartOrClick);o&&o.off(n.Events.onTouchStartOrClick);i.windowNo=null;vt=null;yt=null;y=null;r=null;p=null;i.log=null;l=null;et=null;c=null;s=null;a=null;v=null;k=null;d=null;h=null;f=null;o=null;g=null;nt=null;tt=null;gt=null;ni=null;lt=null;i=null;this.getRoot=null;this.disposeComponent=null}}n.Apps.AForms=n.Apps.AForms||{};i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.Initialize();this.frame.getContentGrid().append(this.getRoot());this.display()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VAttributeGrid=i}(VIS,jQuery);VIS=window.VIS||{},function(n,t){function r(){function dt(){v=t("<div>");v.css({position:"absolute",bottom:"0",background:"url('"+n.Application.contextUrl+"Areas/VIS/Images/busy.gif') no-repeat","background-position":"center center",width:"98%",height:"98%","text-align":"center",opacity:".1","z-index":"9999999"});v[0].style.visibility="hidden";b.append(v)}function o(n){v[0].style.visibility=n?"visible":"hidden"}function gt(){var f=t(window).height()*(94/100),i,u;k=t("<div class='vis-mainContainer' style='height:"+f+"px !important'>");i=" <div class='vis-pSelectInfo'> <div class='vis-paymentselect-field'> <label>"+n.Msg.translate(n.Env.getCtx(),"C_BankAccount_ID")+" <\/label> <select id='VIS_cmbBankAccount_"+r.windowNo+"'><\/select> <\/div> <div class='vis-paymentselect-field'> <label>"+n.Msg.getMsg("CurrentBalance")+" <\/label> <input type='text' class='vis-fieldreadonly' disabled id='VIS_txtCurrentBal_"+r.windowNo+"' MaxLength='50'><\/input> <\/div> <div class='vis-paymentselect-field'> <label>"+n.Msg.translate(n.Env.getCtx(),"C_BPartner_ID")+" <\/label> <select id='VIS_cmbbusinessPartner_"+r.windowNo+"'><\/select> <\/div> <div class='vis-paymentselect-field'> <label style='width:100%;'>"+n.Msg.translate(n.Env.getCtx(),"PayDate")+" <\/label> <input  id='VIS_cmbPayDate_"+r.windowNo+"'type='date'> <\/div> <div class='vis-paymentselect-field'> <label>"+n.Msg.translate(n.Env.getCtx(),"PaymentRule")+" <\/label> <select id='VIS_cmbPaymentMethod_"+r.windowNo+"'><\/select> <\/div> <div class='vis-paymentselect-field'> <label>"+n.Msg.getMsg("PaymentAmount")+" <\/label> <input type='number' id='VIS_txtPaymentAmount_"+r.windowNo+"' MaxLength='50'><\/input> <\/div> <div class='vis-paymentselect-field'> <input type='checkbox' id='VIS_chkOnlyDue_"+r.windowNo+"' style='height: 15px;width: auto;'><\/input> <label for='VIS_chkOnlyDue_"+r.windowNo+"'>"+n.Msg.getMsg("OnlyDue")+" <\/label> <div class='vis-paymentselect-field'> <div class='vis-paymentselect-field'> <label for='VIS_lblShowDetail_"+r.windowNo+"'><\/label> <div class='vis-paymentselect-field'> <button class='VIS_Pref_btn-2' disabled id='VIS_btnRefresh_"+r.windowNo+"' style='margin-top: 5px;margin-bottom: -10px;'><img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png'><\/button> <\/div> <\/div>";d=t("<div class='vis-pSelectIionGrid'>");u=" <div class='vis-pSelectProcess'> <div class='vis-paymentselect-field'> <input id='VIS_btnCancel_"+r.windowNo+"' style='background-color:#616364;color: white;font-weight: 200;font-family: helvetica;font-size: 14px;padding: 10px 15px;float:right;width:100px;margin-top:10px;height:40px;margin-left:10px;' type='submit' value='"+n.Msg.getMsg("Cancel")+"' ><\/input> <input id='VIS_btnOK_"+r.windowNo+"' disabled style='background-color:#616364;color: white;font-weight: 200;font-family: helvetica;font-size: 14px;padding: 10px 15px;float:right;width:100px;margin-top:10px;margin-left:10px;height:40px;' type='submit' value='"+n.Msg.getMsg("OK")+"' ><\/input> <\/div> <\/div>";k.append(t(i)).append(d).append(t(u));b.append(k);ni()}function ni(){f=t("#VIS_cmbBankAccount_"+r.windowNo);s=t("#VIS_cmbbusinessPartner_"+r.windowNo);h=t("#VIS_cmbPaymentMethod_"+r.windowNo);tt=t("#VIS_txtCurrentBal_"+r.windowNo);p=t("#VIS_chkOnlyDue_"+r.windowNo);a=t("#VIS_txtPaymentAmount_"+r.windowNo);ut=t("#VIS_lblShowDetail_"+r.windowNo);w=t("#VIS_btnRefresh_"+r.windowNo);y=t("#VIS_cmbPayDate_"+r.windowNo);g=t("#VIS_btnOK_"+r.windowNo);it=t("#VIS_btnCancel_"+r.windowNo);var n=new Date,i=("0"+n.getDate()).slice(-2),u=("0"+(n.getMonth()+1)).slice(-2),e=n.getFullYear()+"-"+u+"-"+i;y.val(e);ft();ti();ri();l.BankAccount.length>0&&et()}function ti(){w.on("click",function(){o(!0);ei()&&window.setTimeout(function(){ii();o(!1)},20)});g.on("click",function(){var i,t;if(e.getSelection().length<=0)return n.ADialog.info("PleaseSelectRecord"),!1;if(i=e.getSelection(),i.length>0){for(t=0;t<i.length;t++)rt[t].SELECT=!0;o(!0);window.setTimeout(function(){oi()},20)}});it.on("click",function(){r.dispose()});f.on("change",function(){o(!0);window.setTimeout(function(){fi();et();o(!1)},20)});p.on("click",function(){w.trigger("click")})}function ft(){try{e!=null&&(e.destroy(),e=null)}catch(t){}u.length==0&&(u.push({field:"SELECT",caption:n.Msg.getMsg("SELECT"),sortable:!0,size:"100px",hidden:!0}),u.push({field:"C_INVOICE_ID",caption:n.Msg.getMsg("Invoice"),sortable:!0,size:"100px"}),u.push({field:"DUEDATE",caption:n.Msg.getMsg("DueDate"),sortable:!0,size:"100px"}),u.push({field:"BUSINESSPARTNER",caption:n.Msg.getMsg("BusinessPartner"),sortable:!0,size:"100px"}),u.push({field:"DOCUMENTNO",caption:n.Msg.getMsg("Document_No"),sortable:!0,size:"100px"}),u.push({field:"CURRENCY",caption:n.Msg.getMsg("Currency"),sortable:!0,size:"100px"}),u.push({field:"GRANDTOTAL",caption:n.Msg.getMsg("GrandTotal"),sortable:!0,size:"100px"}),u.push({field:"DISCOUNTAMOUNT",caption:n.Msg.getMsg("DiscountAmt"),sortable:!0,size:"100px"}),u.push({field:"DISCOUNTDATE",caption:n.Msg.getMsg("DiscountDate"),sortable:!0,size:"100px"}),u.push({field:"AMOUNTDUE",caption:n.Msg.getMsg("AmountDue"),sortable:!0,size:"100px"}),u.push({field:"PAYMENTAMOUNT",caption:n.Msg.getMsg("PaymentAmount"),sortable:!0,size:"100px"}));e=d.w2grid({name:"gridPaymentSelection_"+r.windowNo,recordHeight:40,show:{selectColumn:!0},multiSelect:!0,columns:u,records:c});e.on("select",function(t){nt+=n.Utility.Util.getValueOfInt(c[t.index].PAYMENTAMOUNT);a.val(nt);var i=e.getSelection();g.removeAttr("disabled")});e.on("unselect",function(t){nt-=n.Utility.Util.getValueOfInt(c[t.index].PAYMENTAMOUNT);a.val(nt);var i=e.getSelection()})}function ii(){var u,r,e;c=[];u=0;r=[];r.push(f.val());l!=null?(e=jQuery.grep(l.BankAccount,function(t){return t.ID==n.Utility.Util.getValueOfInt(f.val())}),e.length>0?r.push(e[0].Currency_ID):r.push(0)):r.push(0);r.push(s.val());r.push(y.val());r.push(h.val());r.push(a.val());r.push(p.prop("checked"));t.ajax({url:n.Application.contextUrl+"VPaySelect/GetGridRecords",async:!1,datatype:"Json",type:"POST",cache:!1,contentType:"application/json; charset=utf-8",data:JSON.stringify(r),success:function(n){var t=JSON.parse(n),r;if(c=[],t!=null||t!=undefined)for(rt=t,i=0;i<t.length;i++)r={},r.SELECT=t[i].SELECT,r.C_INVOICE_ID=t[i].C_INVOICE_ID,r.DUEDATE=t[i].DUEDATE,r.BUSINESSPARTNER=t[i].BUSINESSPARTNER,r.DOCUMENTNO=t[i].DOCUMENTNO,r.CURRENCY=t[i].CURRENCY,r.GRANDTOTAL=t[i].GRANDTOTAL,r.DISCOUNTAMOUNT=t[i].DISCOUNTAMOUNT,r.DISCOUNTDATE=t[i].DISCOUNTDATE,r.AMOUNTDUE=t[i].AMOUNTDUE,r.PAYMENTAMOUNT=t[i].PAYMENTAMOUNT,r.recid=u,u++,c.push(r)},error:function(n){console.log(n)}});ft()}function ri(){t.ajax({url:n.Application.contextUrl+"VPaySelect/GetDetail",async:!1,datatype:"Json",type:"GET",cache:!1,success:function(n){var t=JSON.parse(n);l=t;(t!=null||t!=undefined)&&t.BankAccount.length>0&&(w.removeAttr("disabled"),ui(t));o(!1)},error:function(n){console.log(n);o(!1)}})}function ui(n){var i;if(n.BankAccount!=null||n.BankAccount.length>0){f.empty();for(i in n.BankAccount)f.append(t('<Option value="'+n.BankAccount[i].ID+'">'+n.BankAccount[i].Value+"<\/option>"))}if(n.BusinessPartner!=null||n.BusinessPartner.length>0){s.empty();s.append(t('<Option value="-1"><\/option>'));for(i in n.BusinessPartner)s.append(t('<Option value="'+n.BusinessPartner[i].ID+'">'+n.BusinessPartner[i].Value+"<\/option>"))}if(n.PaymentMethod!=null||n.PaymentMethod.length>0){h.empty();for(i in n.PaymentMethod)h.append(t('<Option value="'+n.PaymentMethod[i].ID+'">'+n.PaymentMethod[i].Value+"<\/option>"))}o(!1)}function fi(){t.ajax({url:n.Application.contextUrl+"VPaySelect/GetPaymentMethod",async:!1,datatype:"Json",type:"GET",cache:!1,data:{C_BankAccount_ID:parseInt(f.val())},success:function(n){var i=JSON.parse(n),r;if((i!=null||i!=undefined)&&(i!=null||i.length>0)){h.empty();for(r in i)h.append(t('<Option value="'+i[r].ID+'">'+i[r].Value+"<\/option>"))}},error:function(n){console.log(n)}})}function et(){var t=jQuery.grep(l.BankAccount,function(t){return t.ID==n.Utility.Util.getValueOfInt(f.val())});t.length>0&&tt.val(t[0].CurrentBalance+" "+t[0].ISOCode)}function ei(){return s!=null&&s.val()<=0?(n.ADialog.info("SelectBusinessPartnerFirst"),o(!1),!1):!0}function oi(){var i=[],u;i.push(f.val());l!=null?(u=jQuery.grep(l.BankAccount,function(t){return t.ID==n.Utility.Util.getValueOfInt(f.val())}),i.push(u[0].Currency_ID)):i.push(0);i.push(s.val());i.push(y.val());i.push(h.val());i.push(a.val());i.push(p.prop("checked"));i.push(JSON.stringify(rt));t.ajax({url:n.Application.contextUrl+"VPaySelect/GeneratePaymentSelection",async:!1,datatype:"Json",type:"POST",cache:!1,contentType:"application/json; charset=utf-8",data:JSON.stringify(i),success:function(t){var f=JSON.parse(t),i,u;(f!=null||f!=undefined)&&(r.dispose(),i=new n.CFrame,u=new n.Apps.AForms.VPayPrint,i.setName(n.Msg.getMsg("Payment Print/Export")),i.setTitle(n.Msg.getMsg("Payment Print/Export")),i.hideHeader(!1),i.setContent(u),i.show(),u.initialize())},error:function(n){console.log(n)}})}this.windowNo=null;var b=t("<div style='width: 100%; height: 100%; background-color: white;'>"),r=this,k=null,ot=null,st=null,ht=null,ct=null,lt=null,at=null,vt=null,d=null,yt=null,pt=null,wt=null,bt=null,f=null,s=null,h=null,y=null,kt=null,p=null,tt=null,ut=null,a=null,u=[],e=null,w=null,g=null,it=null,c=[],rt=null,l=null,nt=0,v=null;this.initialize=function(){dt();o(!0);window.setTimeout(function(){gt()},20)};this.getRoot=function(){return b};this.disposeComponent=function(){windowNo=null;b=null;r=this;k=null;ot=null;st=null;ht=null;ct=null;lt=null;at=null;vt=null;d=null;yt=null;pt=null;wt=null;bt=null;f=null;s=null;h=null;y=null;kt=null;p=null;tt=null;ut=null;a=null;u=null;e=null;w=null;g=null;it=null;c=null}}n.Apps.AForms=n.Apps.AForms||{};r.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.frame.getContentGrid().append(this.getRoot());this.initialize()};r.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VPaySelect=r}(VIS,jQuery);VIS=window.VIS||{},function(n,t){function i(){function tt(){s=t("<div>");s.css({position:"absolute",bottom:"0",background:"url('"+n.Application.contextUrl+"Areas/VIS/Images/busy.gif') no-repeat","background-position":"center center",width:"98%",height:"98%","text-align":"center",opacity:".1","z-index":"9999999"});s[0].style.visibility="hidden";h.append(s)}function r(n){s[0].style.visibility=n?"visible":"hidden"}function it(){c=t("<div class='vis-mainContainer'>");var r=" <div class='vis-pPrintInfo'> <div class='vis-paymentselect-field'> <label>"+n.Msg.translate(n.Env.getCtx(),"C_PaySelection_ID")+" <\/label> <div class='vis-paymentPrintChk-field'> <input type='checkbox' id='VIS_chkShowPrintPayment_"+i.windowNo+"' style='height: 15px;width: auto;'><\/input> <label for='VIS_chkOnlyDue_"+i.windowNo+"'>"+n.Msg.getMsg("ShowPrintedPayments")+" <\/label> <\/div> <select id='VIS_PaySelection_"+i.windowNo+"' style='background-position: 99%;'><\/select> <\/div> <div class='vis-paymentPrint-field' style='margin-right:24px;'> <label>"+n.Msg.translate(n.Env.getCtx(),"C_BankAccount_ID")+" <\/label> <input type='text' name='vis-name vis-fieldreadonly' style='background: #f8f8f8 !important;' disabled id='VIS_txtBankAccount_"+i.windowNo+"' MaxLength='50'><\/input> <\/div> <div class='vis-paymentPrint-field'> <label>"+n.Msg.getMsg("CurrentBalance")+" <\/label> <input type='text' class='vis-fieldreadonly' disabled id='VIS_txtCurrentBal_"+i.windowNo+"' MaxLength='50'><\/input> <\/div> <div class='vis-paymentPrint-field' style='margin-right:24px;'> <label>"+n.Msg.translate(n.Env.getCtx(),"PaymentRule")+" <\/label> <select name='vis-name' id='VIS_cmbPaymentMethod_"+i.windowNo+"'><\/select> <\/div> <div class='vis-paymentPrint-field'> <label>"+n.Msg.translate(n.Env.getCtx(),"C_Currency_ID")+" <\/label> <input type='text' class='vis-fieldreadonly' disabled id='VIS_txtCurrency_"+i.windowNo+"' MaxLength='50'><\/input> <\/div> <div class='vis-paymentPrint-field' style='margin-right:24px;'> <label>"+n.Msg.getMsg("CheckNo")+" <\/label> <input type='number' name='vis-name'  id='VIS_txtCheckNo_"+i.windowNo+"' MaxLength='50'><\/input> <\/div> <div class='vis-paymentPrint-field'> <label>"+n.Msg.getMsg("NoOfPayments")+" <\/label> <input type='text' class='vis-fieldreadonly' disabled id='VIS_txtNoOfPayments_"+i.windowNo+"' MaxLength='50'><\/input> <\/div> <\/div>",u=" <div class='vis-pPrintProcess'> <div class='vis-paymentPrint-field' style='float:right;'> <input id='VIS_btnCancel_"+i.windowNo+"' style='background-color:#616364;color: white;font-weight: 200;font-family: helvetica;font-size: 14px;padding: 10px 15px;float:right;width:100px;margin-top:10px;margin-left:10px;height:40px;' type='submit' value='"+n.Msg.getMsg("Cancel")+"' ><\/input> <input id='VIS_btnExport_"+i.windowNo+"' style='background-color:#616364;color: white;font-weight: 200;font-family: helvetica;font-size: 14px;padding: 10px 15px;float:right;width:100px;margin-top:10px;margin-left:10px;height:40px;' type='submit' value='"+n.Msg.getMsg("Export")+"' ><\/input> <input id='VIS_btnPrint_"+i.windowNo+"' style='background-color:#616364;color: white;font-weight: 200;font-family: helvetica;font-size: 14px;padding: 10px 15px;float:right;width:100px;margin-top:10px;margin-left:10px;height:40px;' type='submit' value='"+n.Msg.getMsg("Print")+"' ><\/input> <\/div> <\/div>";c.append(t(r)).append(t(u));h.append(c);tt();rt()}function rt(){f=t("#VIS_PaySelection_"+i.windowNo);y=t("#VIS_txtBankAccount_"+i.windowNo);p=t("#VIS_txtCurrentBal_"+i.windowNo);u=t("#VIS_cmbPaymentMethod_"+i.windowNo);w=t("#VIS_txtCurrency_"+i.windowNo);e=t("#VIS_txtCheckNo_"+i.windowNo);l=t("#VIS_txtNoOfPayments_"+i.windowNo);a=t("#VIS_chkShowPrintPayment_"+i.windowNo);b=t("#VIS_btnPrint_"+i.windowNo);k=t("#VIS_btnExport_"+i.windowNo);d=t("#VIS_btnCancel_"+i.windowNo);v(!0);ft()}function v(i){var u=null;u=i?0:f.val();r(!0);t.ajax({url:n.Application.contextUrl+"VPayPrint/GetDetail",async:!1,datatype:"Json",type:"GET",cache:!1,data:{showPrintedPayment:a.prop("checked"),C_PaymentSelect_ID:u,isFirstTime:i},success:function(n){var t=JSON.parse(n);controlsData=t;(t!=null||t!=undefined)&&(ut(t),g(),r(!1))},error:function(n){r(!1);console.log(n)}})}function g(){t.ajax({url:n.Application.contextUrl+"VPayPrint/LoadPaymentRuleInfo",async:!1,datatype:"Json",type:"GET",cache:!1,data:{paymentMethod_ID:u.val(),C_PaySelection_ID:f.val(),m_C_BankAccount_ID:o,PaymentRule:u.text()},success:function(n){var t=JSON.parse(n);r(!1);(t!=null||t!=undefined)&&(e.val(t.CheckNo),l.val(t.NoOfPayments))},error:function(n){console.log(n)}})}function ut(i){var s;try{if(i.PaymentSelection!=null||i.PaymentSelection.length>0){f.empty();for(s in i.PaymentSelection)f.append(t('<Option value="'+i.PaymentSelection[s].ID+'">'+i.PaymentSelection[s].Value+"<\/option>"))}if(i.PaymentMethod!=null||i.PaymentMethod.length>0){u.empty();for(s in i.PaymentMethod)u.append(t('<Option value="'+i.PaymentMethod[s].ID+'">'+i.PaymentMethod[s].Value+"<\/option>"))}(i.PSelectInfo!=null||i.PSelectInfo.length>0)&&(y.val(i.PSelectInfo[0].BankAccount),e.val(i.PSelectInfo[0].CheckNo),p.val(i.PSelectInfo[0].CurrentBalance),w.val(i.PSelectInfo[0].Currency),l.val(i.PSelectInfo[0].NoOfPayments),o=i.PSelectInfo[0].BankAccount_ID)}catch(h){return n.ADialog.info("VPayPrintNoRecords"),r(!1),!1}if(f.val()==null)return n.ADialog.info("VPayPrintNoRecords"),!1}function ft(){b.on("click",function(){nt()&&et()});k.on("click",function(){nt()&&ht()});d.on("click",function(){i.dispose()});f.on("change",function(){r(!0);window.setTimeout(function(){v(!1);r(!1)},20)});u.on("change",function(){r(!0);window.setTimeout(function(){g();r(!1)},20)});a.on("click",function(){r(!0);window.setTimeout(function(){v(!1);r(!1)},20)})}function nt(){try{if(f==null||f.val()<=-1||o<=-1||u.val()<=-1||e.val().length<=0)return n.ADialog.info("VPayPrintNoRecords"),!1}catch(t){return n.ADialog.info("VPayPrintNoRecords"),!1}return!0}function et(){r(!0);t.ajax({url:n.Application.contextUrl+"VPayPrint/Cmd_Print",async:!1,datatype:"Json",type:"GET",cache:!1,data:{paymentMethod_ID:u.val(),C_PaySelection_ID:f.val(),m_C_BankAccount_ID:o,PaymentRule:u.text(),checkNo:e.val()},success:function(t){r(!1);var u=JSON.parse(t);if(u!=null||u!=undefined)n.ADialog.ask("ContinueCheckPrint?")&&(r(!0),window.setTimeout(function(){var f=n.DB.executeScalar("select ad_process_id from ad_process where value = 'CheckPrintFormat'"),e=n.DB.executeScalar("select ad_table_id from ad_table where tablename = 'C_PaySelectionCheck'"),t=new n.ProcessInfo(null,f,e,parseInt(u.check_ID[0])),r;t.setAD_User_ID(n.context.getAD_User_ID());t.setAD_Client_ID(n.context.getAD_Client_ID());r=new n.ProcessCtl(i,t,null);r.setIsPdf(!0);r.process(i.windowNo);ot(u)},20));else return n.ADialog.info("VPayPrintNoRecords"),!1},error:function(n){console.log(n)}})}function ot(i){var s=[];s.push(u.val());s.push(f.val());s.push(o);s.push(u.text());s.push(e.val());s.push(JSON.stringify(i.check_ID));s.push(JSON.stringify(i.m_batch));s.push(JSON.stringify(i.m_checks));t.ajax({url:n.Application.contextUrl+"VPayPrint/ContinueCheckPrint",async:!1,datatype:"Json",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(s),success:function(t){r(!1);var i=JSON.parse(t);(i!=null||i!=undefined)&&n.ADialog.ask("VPayPrintPrintRemittance?")&&(r(!0),window.setTimeout(function(){st(t)},20))},error:function(n){r(!1);console.log(n)}})}function st(u){var f=u;t.ajax({url:n.Application.contextUrl+"VPayPrint/VPayPrintRemittance",async:!1,datatype:"Json",type:"POST",contentType:"application/json; charset=utf-8",data:u,success:function(t){var o,e;if(r(!1),o=JSON.parse(t),f!=null||f!=undefined){var s=n.DB.executescalar("select ad_process_id from ad_process where value = 'remittanceprintformat'"),h=n.DB.executescalar("select ad_table_id from ad_table where tablename = 'c_payment'"),u=new n.processinfo(null,s,h,f[0]);u.setad_user_id(n.context.getad_user_id());u.setad_client_id(n.context.getad_client_id());e=new n.processctl(i,u,null);e.setispdf(!0);e.process(i.windowno)}},error:function(n){console.log(n)}})}function ht(){r(!0);t.ajax({url:n.Application.contextUrl+"VPayPrint/Cmd_Export",async:!1,datatype:"Json",type:"POST",cache:!1,data:{paymentMethod_ID:u.val(),C_PaySelection_ID:f.val(),m_C_BankAccount_ID:o,PaymentRule:u.text(),checkNo:e.val()},success:function(t){var i,u;if(r(!1),i=JSON.parse(t),i!=null||i!=undefined)n.ADialog.ask("VPayPrintSuccess?")&&(r(!0),window.setTimeout(function(){ct(i)},20),u=n.Application.contextUrl+"TempDownload/"+i.filepath,window.open(u,"_blank"));else return n.ADialog.info("VPayPrintNoRecords"),!1},error:function(n){console.log(n)}})}function ct(i){var u=[];u.push(JSON.stringify(i.check_ID));u.push(JSON.stringify(i.m_batch));u.push(JSON.stringify(i.m_checks));t.ajax({url:n.Application.contextUrl+"VPayPrint/VPayPrintSuccess",async:!1,datatype:"Json",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(u),success:function(n){r(!1);var t=JSON.parse(n);t!=null||t!=undefined},error:function(n){console.log(n)}})}this.windowNo=null;var h=t("<div style='width: 100%; height: 100%; background-color: white;'>"),i=this,c=null,f=null,y=null,p=null,u=null,w=null,e=null,l=null,a=null,b=null,k=null,d=null,o=null,s=null;this.initialize=function(){it()};this.getRoot=function(){return h};this.lockUI=function(){};this.unlockUI=function(){};this.disposeComponent=function(){windowNo=null;h=null;i=this}}n.Apps.AForms=n.Apps.AForms||{};i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.frame.getContentGrid().append(this.getRoot());this.initialize()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VPayPrint=i}(VIS,jQuery);VIS=window.VIS||{},function(n,t){function i(){function ut(){c=t("<div>");c.css({position:"absolute",bottom:"0",background:"url('"+n.Application.contextUrl+"Areas/VIS/Images/busy.gif') no-repeat","background-position":"center center",width:"98%",height:"98%","text-align":"center",opacity:".1","z-index":"9999999"});c[0].style.visibility="hidden";v.append(c)}function h(n){c[0].style.visibility=n?"visible":"hidden"}function ft(){var e=t(window).height()*(92/100),u,f;y=t("<div class='vis-mainContainer' style='height:"+e+"px !important'>");u=" <div class='vis-pBOMInfo'> <div class='vis-paymentselect-field'> <label>"+n.Msg.translate(n.Env.getCtx(),"M_Product_ID")+" <\/label> <select id='VIS_cmbProduct_"+i.windowNo+"'><\/select> <\/div> <div class='vis-paymentselect-field'> <label>"+n.Msg.translate(n.Env.getCtx(),"C_Invoice_ID")+" <\/label> <select id='VIS_cmbinvoice_"+i.windowNo+"'><\/select> <\/div> <div class='vis-paymentselect-field'> <label>"+n.Msg.translate(n.Env.getCtx(),"C_Order_ID")+" <\/label> <select id='VIS_cmbOrder_"+i.windowNo+"'><\/select> <\/div> <div class='vis-paymentselect-field'> <label>"+n.Msg.translate(n.Env.getCtx(),"C_Project_ID")+" <\/label> <select id='VIS_cmbOpportunity_"+i.windowNo+"'><\/select> <\/div> <div class='vis-paymentselect-field'> <label>"+n.Msg.translate(n.Env.getCtx(),"Qty")+"<\/label> <input type='number' id='VIS_txtQuantity_"+i.windowNo+"' min='0' MaxLength='50'><\/input> <\/div> <div class='vis-paymentselect-field'> <button class='VIS_Pref_btn-2'  id='VIS_btnRefresh_"+i.windowNo+"' style='margin-top: 5px;margin-bottom: -10px;'><img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png'><\/button> <\/div> <\/div>";r=t("<div class='vis-BOMLines'>");f=" <div class='vis-pSelectProcess'> <div class='vis-paymentselect-field'> <input id='VIS_btnCancel_"+i.windowNo+"' style='background-color:#616364;color: white;font-weight: 200;font-family: helvetica;font-size: 14px;padding: 10px 15px;float:right;width:100px;margin-top:10px;height:40px;margin-left:10px;' type='submit' value='"+n.Msg.getMsg("Cancel")+"' ><\/input> <input id='VIS_btnOK_"+i.windowNo+"' disabled style='background-color:#616364;color: white;font-weight: 200;font-family: helvetica;font-size: 14px;padding: 10px 15px;float:right;width:100px;margin-top:10px;margin-left:10px;height:40px;' type='submit' value='"+n.Msg.getMsg("OK")+"' ><\/input> <\/div> <\/div>";y.append(t(u)).append(r).append(t(f));v.append(y);et()}function et(){u=t("#VIS_cmbProduct_"+i.windowNo);f=t("#VIS_cmbinvoice_"+i.windowNo);e=t("#VIS_cmbOrder_"+i.windowNo);o=t("#VIS_cmbOpportunity_"+i.windowNo);a=t("#VIS_txtQuantity_"+i.windowNo);p=t("#VIS_btnCancel_"+i.windowNo);s=t("#VIS_btnOK_"+i.windowNo);w=t("#VIS_btnRefresh_"+i.windowNo);b();ot()}function ot(){w.on("click",function(){h(!0);r.empty();window.setTimeout(function(){b();h(!1)},20)});s.on("click",function(){lt()});p.on("click",function(){i.dispose()});u.on("change",function(){u.val()>0?s.removeAttr("disabled"):s.attr("disabled",!0);h(!0);window.setTimeout(function(){ht()},20)});f.on("change",function(){f.val()>0?(u.val()>0&&s.removeAttr("disabled"),e.attr("disabled",!0),o.attr("disabled",!0)):(s.attr("disabled",!0),e.removeAttr("disabled"),o.removeAttr("disabled"))});e.on("change",function(){e.val()>0?(u.val()>0&&s.removeAttr("disabled"),f.attr("disabled",!0),o.attr("disabled",!0)):(s.attr("disabled",!0),f.removeAttr("disabled"),o.removeAttr("disabled"))});o.on("change",function(){o.val()>0?(u.val()>0&&s.removeAttr("disabled"),e.attr("disabled",!0),f.attr("disabled",!0)):(s.attr("disabled",!0),e.removeAttr("disabled"),f.removeAttr("disabled"))});a.on("change",function(){for(var i,n=0;n<t(r[0]).children().length;n++)i=l[n].BOMQty,t(t(t(t(r[0]).children()[n]).children()[0]).children()[1]).attr("Value",i*a.val())})}function b(){t.ajax({url:n.Application.contextUrl+"VBOMDrop/GetDetail",async:!1,datatype:"Json",type:"GET",cache:!1,success:function(n){var t=JSON.parse(n);controlsData=t;(t!=null||t!=undefined)&&st(t);h(!1)},error:function(n){console.log(n);h(!1)}})}function st(n){var i;if(n.Product!=null||n.Product.length>0){u.empty();u.append(t('<Option value="-1"><\/option>'));for(i in n.Product)u.append(t('<Option value="'+n.Product[i].ID+'">'+n.Product[i].Value+"<\/option>"))}if(n.Invoice!=null||n.Invoice.length>0){f.empty();f.append(t('<Option value="-1"><\/option>'));for(i in n.Invoice)f.append(t('<Option value="'+n.Invoice[i].ID+'">'+n.Invoice[i].Value+"<\/option>"))}if(n.Order!=null||n.Order.length>0){e.empty();e.append(t('<Option value="-1"><\/option>'));for(i in n.Order)e.append(t('<Option value="'+n.Order[i].ID+'">'+n.Order[i].Value+"<\/option>"))}if(n.Opportunity!=null||n.Opportunity.length>0){o.empty();o.append(t('<Option value="-1"><\/option>'));for(i in n.Product)o.append(t('<Option value="'+n.Opportunity[i].ID+'">'+n.Opportunity[i].Value+"<\/option>"))}h(!1)}function ht(){a.val("");t.ajax({url:n.Application.contextUrl+"VBOMDrop/GetBOMLines",async:!1,datatype:"Json",type:"GET",cache:!1,data:{productID:parseInt(u.val())},success:function(n){var t=JSON.parse(n);controlsData=t;t!=null||t!=undefined?ct(t):r.empty();h(!1)},error:function(n){console.log(n);h(!1)}})}function ct(n){var e="",i;r.empty();var u="",f="";for(l=n,i=0;i<n.length;i++){e="";n[i].BOMType=="P"?(u="<input type='checkbox' checked disabled id='VIS_chkBOMLine_"+i+"' style='height: 15px;width: auto;'><\/input>",f="<input type='number' id='VIS_qtyBOMLine_"+i+"' style='background: pink;width:200%;' min='0' value='"+n[i].BOMQty+"'><\/input>"):n[i].BOMType=="O"?(u="<input type='checkbox' id='VIS_chkBOMLine_"+i+"' style='height: 15px;width: auto;'><\/input>",f="<input type='number' disabled id='VIS_qtyBOMLine_"+i+"' style='background: #FFF5FF;width:200%;'  min='0' value='"+n[i].BOMQty+"'><\/input>"):(u=" <input type='radio' name='vis-radiolist' checked id='VIS_chkBOMLine_"+i+"' style='height: 15px;width: auto;'><\/input>",f="<input type='number' id='VIS_qtyBOMLine_"+i+"' style='background: pink;width:200%;' min='0' value='"+n[i].BOMQty+"'><\/input>");e+="<div class='vis-bomlinesdata'> <div style='float:left;width: 50%;'> <label style='margin: 5px;width:100%;'>"+n[i].ProductName+"<\/label>"+f+" <\/div> <div style='float:right;'>"+u+" <label style='margin-right:5px;'>"+n[i].BOMTypeName+"<\/label> <\/div> <\/div>";r.append(t(e));t("#VIS_chkBOMLine_"+i).on("click",function(){var n=t(t(t(t(this).parent()).parent().children()[0]).children()[1]);t(this).prop("checked")?(n.css("background","pink"),n.removeAttr("disabled")):(n.css("background","#FFF5FF"),n.attr("disabled",!0))})}}function lt(){var c=[],s,a;for(c.push(u.val()),c.push(f.val()),c.push(e.val()),c.push(o.val()),s=0;s<t(r[0]).children().length;s++)a=t(t(t(t(r[0]).children()[s]).children()[1]).children()[0]).prop("checked"),a?(l[s].IsSelected=!0,l[s].BOMQty=t(t(t(t(r[0]).children()[s]).children()[0]).children()[1]).val()):l[s].IsSelected=!1;c.push(JSON.stringify(l));t.ajax({url:n.Application.contextUrl+"VBOMDrop/SaveRecord",async:!1,datatype:"Json",type:"POST",cache:!1,contentType:"application/json; charset=utf-8",data:JSON.stringify(c),success:function(t){JSON.parse(t)?i.dispose():n.ADialog.info("RecordNotSaved")},error:function(n){console.log(n);h(!1)}})}this.windowNo=null;var v=t("<div style='width: 100%; height: 100%; background-color: white;'>"),i=this,y=null,k=null,r=null,d=null,g=null,nt=null,tt=null,it=null,rt=null,u=null,f=null,e=null,o=null,a=null,s=null,p=null,c=null,l=[],w=null;this.initialize=function(){ut();h(!0);window.setTimeout(function(){ft()},20)};this.getRoot=function(){return v};this.disposeComponent=function(){v=null;i=null;y=null;k=null;r=null;d=null;g=null;nt=null;tt=null;it=null;rt=null;u=null;f=null;e=null;o=null;a=null;s=null;p=null;c=null;l=null}}n.Apps.AForms=n.Apps.AForms||{};i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.frame.getContentGrid().append(this.getRoot());this.initialize()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VBOMDrop=i}(VIS,jQuery);VIS=window.VIS||{},function(n,t){function i(){function ht(){e=t("<div>");e.css({position:"absolute",bottom:"0",background:"url('"+n.Application.contextUrl+"Areas/VIS/Images/busy.gif') no-repeat","background-position":"center center",width:"98%",height:"98%","text-align":"center",opacity:".1","z-index":"9999999"});e[0].style.visibility="hidden";o.append(e)}function l(n){e[0].style.visibility=n?"visible":"hidden"}function ct(){var ft=t(window).height()*(96/100),et=n.MLookupFactory.get(n.Env.getCtx(),0,0,n.DisplayType.TableDir,"AD_Org_ID",0,!1,null),tt,e,it,c,rt,f,y,p,w,b,k,d,g,nt,ut;a=new n.Controls.VComboBox("AD_Org_ID",!1,!1,!0,et,50);tt=n.MLookupFactory.get(n.Env.getCtx(),0,0,n.DisplayType.List,"MovementType",189,!1,null);v=new n.Controls.VComboBox("MovementType",!1,!1,!0,tt,29);e=t("<div><\/div>");it=n.MLookupFactory.get(n.context,0,0,n.DisplayType.Search,"M_Locator_ID",0,!1,"");u=new n.Controls.VTextBoxButton("M_Locator_ID",!1,!1,!0,n.DisplayType.Search,it);e.append(u.getControl());e.append(u.getBtn(0));e.append(u.getBtn(1));u.getControl().addClass("vis-lookupTextboxes");u.getBtn(0).addClass("vis-lookupButtons");u.getBtn(1).addClass("vis-lookupButtons");u.getBtn(0).css("height","30");u.getBtn(0).css("width","30");u.getBtn(1).css("width","30");u.getBtn(1).css("height","30");u.getBtn(0).css("padding","0px");u.getBtn(1).css("padding","0px");c=t("<div><\/div>");rt=n.MLookupFactory.get(n.context,0,0,n.DisplayType.Search,"M_Product_ID",0,!1,"");r=new n.Controls.VTextBoxButton("M_Product_ID",!1,!1,!0,n.DisplayType.Search,rt);c.append(r.getControl());c.append(r.getBtn(0));c.append(r.getBtn(1));r.getControl().addClass("vis-lookupTextboxes");r.getBtn(0).addClass("vis-lookupButtons");r.getBtn(1).addClass("vis-lookupButtons");r.getBtn(0).css("height","30");r.getBtn(0).css("width","30");r.getBtn(0).css("padding","0px");r.getBtn(1).css("height","30");r.getBtn(1).css("width","30");r.getBtn(0).css("padding","0px");r.getBtn(1).css("padding","0px");s=t("<div class='vis-mainContainer' style='height:"+ft+" !important'>");f=t("<div class='vis-pSelectInfo' style='height:76%;'>");y=t("<div class='vis-paymentselect-field'>");y.append(t("<label>"+n.Msg.translate(n.Env.getCtx(),"AD_Org_ID")+" <\/label>"));y.append(a.getControl());f.append(y);p=t("<div class='vis-paymentselect-field'>");p.append(t("<label>"+n.Msg.translate(n.Env.getCtx(),"MovementType")+" <\/label>"));p.append(v.getControl());f.append(p);w=t("<div class='vis-paymentselect-field'>");w.append(t("<label style='width:100%;'>"+n.Msg.translate(n.Env.getCtx(),"M_Locator_ID")+" <\/label>"));w.append(e);f.append(w);b=t("<div class='vis-paymentselect-field'>");b.append(t("<label style='width:100%;'>"+n.Msg.translate(n.Env.getCtx(),"Product")+" <\/label>"));b.append(c);f.append(b);k=t("<div class='vis-paymentselect-field'>");k.append(t("<label style='width:100%;'>"+n.Msg.translate(n.Env.getCtx(),"DateFrom")+" <\/label>"));k.append(t("<input  id='VIS_dtpFromDate"+i.windowNo+"'type='date'>"));f.append(k);d=t("<div class='vis-paymentselect-field'>");d.append(t("<label style='width:100%;'>"+n.Msg.translate(n.Env.getCtx(),"DateTo")+" <\/label>"));d.append(t("<input  id='VIS_dtpToDate"+i.windowNo+"'type='date'>"));f.append(d);g=t("<div class='vis-paymentselect-field' style='float:right;width:20%;'>");g.append(t("<button class='VIS_Pref_btn-2' id='VIS_btnRefresh_"+i.windowNo+"' style='margin-top: 5px;'><img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/requery.png'><\/button>"));f.append(g);nt=t("<div class='vis-paymentselect-field' style='float:right;width:20%;'>");nt.append(t("<button class='VIS_Pref_btn-2' id='VIS_btnZoom_"+i.windowNo+"' style='margin-top: 5px;margin-right: 10px;'><img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/zoom.png'><\/button>"));f.append(nt);h=t("<div class='vis-pSelectIionGrid'>");ut=" <div class='vis-pSelectProcess' style='float:none;'> <div class='vis-paymentselect-field'> <input id='VIS_btnCancel_"+i.windowNo+"' style='background-color:#616364;color: white;font-weight: 200;font-family: helvetica;font-size: 14px;padding: 10px 15px;float:right;width:100px;height:40px;margin-left:10px;margin-right:5px;' type='submit' value='"+n.Msg.getMsg("Cancel")+"' ><\/input> <input id='VIS_btnOK_"+i.windowNo+"'  style='background-color:#616364;color: white;font-weight: 200;font-family: helvetica;font-size: 14px;padding: 10px 15px;float:right;width:100px;margin-left:10px;height:40px;' type='submit' value='"+n.Msg.getMsg("OK")+"' ><\/input> <\/div> <\/div>";s.append(f).append(h).append(t(ut));o.append(s);lt();window.setTimeout(function(){vt()},20);at();l(!0)}function lt(){k=t("#VIS_dtpFromDate"+i.windowNo);d=t("#VIS_dtpToDate"+i.windowNo);y=t("#VIS_btnRefresh_"+i.windowNo);g=t("#VIS_btnZoom_"+i.windowNo);p=t("#VIS_btnOK_"+i.windowNo);w=t("#VIS_btnCancel_"+i.windowNo);var n=new Date,r=("0"+n.getDate()).slice(-2),u=("0"+(n.getMonth()+1)).slice(-2),f=n.getFullYear()+"-"+u+"-"+r}function at(){y.on("click",function(){nt()});g.on("click",function(){yt()});p.on("click",function(){nt()});w.on("click",function(){i.dispose()})}function vt(){n.AEnv.getGridWindow(i.windowNo,223,function(r){var e,u;if(r.error!=null){n.ADialog.error(r.error);self.dispose();self=null;return}(e=t.parseJSON(r.result),n.context.setContextOfWindow(t.parseJSON(r.wCtx),i.windowNo),u=new n.GridWindow(e),u!=null)&&(b=u.getTabs()[0],f=new n.GridController(!1),f.initGrid(!0,i.windowNo,i,b),f.setVisible(!0),window.innerHeight>700?f.sizeChanged(window.innerHeight-230,window.innerWidth):f.sizeChanged(window.innerHeight-215,window.innerWidth),h.append(f.getRoot()),f.activate(),c=new n.Query,c.addRestriction("AD_Client_ID",n.Query.prototype.EQUAL,n.context.getAD_Client_ID()))})}function nt(){var e=null,t,i;e=c!=null?jQuery.extend(!0,{},c):new n.Query;t=a.getValue();(t==null||t.toString()=="-1"||t.toString().trim().length==0)&&(t=null);t!=null&&t.toString().length>0&&e.addRestriction("AD_Org_ID",n.Query.prototype.EQUAL,t);t=u.getValue();t!=null&&t.toString().length>0&&e.addRestriction("M_Locator_ID",n.Query.prototype.EQUAL,t);t=r.getValue();t!=null&&t.toString().length>0&&e.addRestriction("M_Product_ID",n.Query.prototype.EQUAL,t);t=v.getValue();(t==null||t.toString()=="-1"||t.toString().trim().length==0)&&(t=null);t!=null&&t.toString().length>0&&e.addRestriction("MovementType",n.Query.prototype.EQUAL,t);i=k.val().toString();i!=null&&i.length>0&&(i=new Date(i),e.addRestriction("TRUNC(MovementDate,'DD')",n.Query.prototype.GREATER_EQUAL,i));i=d.val().toString();i!=null&&i.length>0&&(i=new Date(i),e.addRestriction("TRUNC(MovementDate,'DD')",n.Query.prototype.LESS_EQUAL,i));b.setQuery(e);f.query(0,0,!1)}function yt(){var r=0,u=null,f=null,t=n.context.getContextAsInt(i.windowNo,"M_InOutLine_ID"),e;(t!=0?(n.context.getContext(i.windowNo,"MovementType").equals("C-")?r=169:n.context.getContext(i.windowNo,"MovementType").equals("C+")?r=409:n.context.getContext(i.windowNo,"MovementType").equals("V+")?r=184:n.context.getContext(i.windowNo,"MovementType").equals("V-")&&(r=411),u="M_InOut_ID",f="SELECT M_InOut_ID FROM M_InOutLine WHERE M_InOutLine_ID="+t):(t=n.context.getContextAsInt(i.windowNo,"M_InventoryLine_ID"),t!=0?(r=168,u="M_Inventory_ID",f="SELECT M_Inventory_ID FROM M_InventoryLine WHERE M_InventoryLine_ID="+t):(t=n.context.getContextAsInt(i.windowNo,"M_MovementLine_ID"),t!=0?(r=170,u="M_Movement_ID",f="SELECT M_Movement_ID FROM M_MovementLine WHERE M_MovementLine_ID="+t):(t=n.context.getContextAsInt(i.windowNo,"M_ProductionLine_ID"),t!=0&&(r=191,u="M_Production_ID",f="SELECT M_Production_ID FROM M_ProductionLine WHERE M_ProductionLine_ID="+t)))),r!=0)&&(e=0,e=n.Utility.Util.getValueOfInt(n.DB.executeScalar(f,null,null)),pt(u,t,r,e))}function pt(t,i,r,u){var f=new n.Query;f.addRestriction(t,n.Query.prototype.EQUAL,u);n.viewManager.startWindow(r,f)}this.windowNo=null;var o=t("<div style='width: 100%; height: 100%; background-color: white;'>"),i=this,s=null,tt=null,h=null,it=null,rt=null,ut=null,ft=null,a=null,v=null,k=null,d=null,et=[],ot=null,y=null,g=null,p=null,w=null,st=[],e=null,u=null,r=null,f=null,c=null,b=null;this.initialize=function(){ht();l(!0);window.setTimeout(function(){ct();l(!1)},20)};this.getRoot=function(){return o};this.dataStatusChanged=function(){};this.setBusy=function(n){l(n)};this.disposeComponent=function(){windowNo=null;o=null;i=this;s=null;tt=null;$divBankAccount=null;$divCurrentBalance=null;$divBusinessPartner=null;$divOnlyDueInvoice=null;$divPaymentDate=null;$divPaymentMethod=null;h=null;it=null;rt=null;ut=null;ft=null;$cmbBankAccount=null;$cmbBusinessPartner=null;$cmbPaymentMethod=null;$cmbPaymentDate=null;$lblCurrentBal=null;$chkOnlyDueInvoice=null;$txtCurrentBal=null;$lblMsg=null;$txtPaymentAmount=null;et=null;ot=null;y=null;p=null;w=null;st=null}}n.Apps.AForms=n.Apps.AForms||{};i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.frame.getContentGrid().append(this.getRoot());this.initialize()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VTrxMaterial=i}(VIS,jQuery),function(n,t){function i(i,u,f){function er(){ut=e.find("#ulQry_"+i);y=e.find("#drpSavedQry_"+i);p=e.find("#drpColumn_"+i);a=e.find("#drpOperator_"+i);nt=e.find("#divValue1_"+i);tt=e.find("#divValue2_"+i);k=e.find("#txtQryName_"+i);pt=e.find("#btnOk_"+i);ht=e.find("#btnCancel_"+i);lt=e.find("#btnSave_"+i);ct=e.find("#btnDelete_"+i);wt=e.find("#btnRefresh_"+i);at=e.find("#divDynamic_"+i);d=e.find("#chkDynamic_"+i);v=e.find("#drpDynamicOp_"+i);bt=e.find("#txtYear_"+i);rt=e.find("#txtMonth_"+i);w=e.find("#txtDay_"+i);g=e.find("#divYear_"+i);ft=e.find("#divMonth_"+i);et=e.find("#divDay_"+i);g.hide();ft.hide();et.hide();at.hide();ni=e.find("#tblQry_"+i);ci=ni.find("tbody");wi=e.find("#pstatus_"+i);pi=e.find("#divBusy_"+i)}function or(){var o,e,u,t,f,i;for(s=ei(null,!1),o=r.getData(n.context,si,hi,"Code"),nr(s),ii=ut.html(),ki(o),e='<option value="-1"> <\/option>',u=0;u<gt.length;u++)if(t=gt[u],!t.getIsEncrypted()){if(f=t.getColumnName(),t.getDisplayType()==n.DisplayType.Button){if(t.getAD_Reference_Value_ID()==0)continue;f.endsWith("_ID")?t.setDisplayType(n.DisplayType.Table):t.setDisplayType(n.DisplayType.List)}(i=t.getHeader(),i!=null&&i.length!=0||(i=n.Msg.getElement(n.context,f),i!=null&&i.Length!=0))&&(t.getIsKey()&&(i+=" (ID)"),e+='<option value="'+f+'">'+i+"<\/option>")}p.html(e);it(!1)}function sr(){ht.on("click",function(){b||(o.okBtnPressed=!1,l.close())});d.on("change",function(){var n=d.prop("checked");v.prop("disabled",!n);a.prop("disabled",n);di(!n);dt(!n);n?ri(o.getIsUserColumn(p.val())):(g.hide(),ft.hide(),et.hide())});v.on("change",function(){ri()});p.on("change",function(){var t,i,e,r,f;b||(d.prop("disabled",!0),d.prop("checked",!1),at.hide(),t=p.val(),oi(!0),t&&t!="-1"&&(i=null,e=null,i=t.endsWith("_ID")||t.endsWith("_Acct")||t.endsWith("_ID_1")||t.endsWith("_ID_2")||t.endsWith("_ID_3")?o.getOperatorsQuery(n.Query.prototype.OPERATORS_ID):t.startsWith("Is")?o.getOperatorsQuery(n.Query.prototype.OPERATORS_YN):o.getOperatorsQuery(n.Query.prototype.OPERATORS),r=u.getField(t),r!=null&&n.DisplayType.IsDate(r.getDisplayType())?(v.html(o.getOperatorsQuery(n.Query.prototype.OPERATORS_DATE_DYNAMIC,!0)),at.show(),d.prop("disabled",!1),ri()):o.getIsUserColumn(t)&&(v.html(o.getOperatorsQuery(n.Query.prototype.OPERATORS_DYNAMIC_ID,!0)),at.show(),d.prop("disabled",!1),ri(!0)),a.html(i),a[0].SelectedIndex=0,f=ai(t),gi(!0,f),ui(lt,!0),a.prop("disabled",!1)),di(!0),dt(!1))});a.on("change",function(){var t,i,r;b||(t=a.val(),t||(t=""),i="",r="",t&&t!="0"?n.Query.prototype.BETWEEN.equals(t)?(i=p.val(),r=ai(i),gi(!1,r),dt(!0)):dt(!1):(ui(lt,!1),dt(!1),oi(!0)))});y.on("change",function(){var n,t;b||(n=y.val(),n&&n!="-1"?(t=null,h=r.getQueryLines(n),fi(h),k.val(y.find("option:selected").text()),k.prop("readonly",!1),ui(ct,!0)):(ui(ct,!1),k.val(""),k.prop("readonly",!0),h=null,fi(null)))});ni.on("click",function(n){if(!b&&n.target.nodeName==="IMG"){var i=t(n.target).data("index");h.splice(i,1);fi(h)}});ut.on("click","LI",function(){var i,r;b||(i=t(this).data("value"),i!=null?(it(!0),r=t(this).index(),setTimeout(function(){var u,f,t;r<9?(u=i.toString().split("|"),f=u.length,o.created=f==1?!1:!0,o.days=parseInt(u[0]),i=""):o.days=0;c=new n.Query(ot);c.addRestriction(i);t=0;t=ei(c,!0);c.setRecordCount(t);it(!1);t!=0&&(o.okBtnPressed=!0,l.close())},10)):(o.okBtnPressed=!1,l.close()))});lt.on("click",vi);ct.on("click",function(){var t;b||(t=y.val(),t==null||t.toString()==""||parseInt(t)<1)||(it(!0),window.setTimeout(function(){var i=y.find("option:selected").text(),u;r.deleteUserQuery(t)?(u=r.getData(n.context,si,hi,"Code"),ut.empty(),ut.html(ii),ki(u),y[0].selectedIndex=0,n.ADialog.info("Deleted",!0,i,""),k.val(""),k.prop("readony",!0),it(!1),y.trigger("change")):n.ADialog.info("DeleteError",!0,i,"");it(!1)},10))});pt.on("click",function(){b||(o.okPressed=!0,o.okBtnPressed=!0,vr())});wt.on("click",function(){if(!b){vi();var t=rr(),n=0;n=ei(t,!0);nr(n)}})}function hr(){ht&&(ht.off("click"),d.off("change"),v.off("change"),p.off("change"),a.off("change"),y.off("change"),ni.off("click"),ut.off("click"),lt.off("click"),ct.off("click"),pt.off("click"),wt.off("click"))}function ki(t){for(var i="",r="";t.read();)i+='<li data-value="'+t.get(1)+'" >'+n.Utility.encodeText(t.get(0))+"<\/li>",r+='<option value="'+t.get("AD_UserQuery_ID")+'">'+n.Utility.encodeText(t.get(0))+"<\/option>";i.length>0&&ut.append(i);y.html("<option value='-1' > <\/option>"+r)}function ri(n){var t=v[0].selectedIndex;if(n){g.hide();ft.hide();et.hide();return}g.show();ft.show();et.show();w.prop("readonly",!1);rt.prop("min",1);t==3?(rt.prop("min",0),w.val(0),rt.val(0),bt.val(1)):t==2?(g.hide(),bt.val(""),rt.val(1),w.val(0)):t==1?(g.hide(),ft.hide(),w.val(0)):t==0&&(w.prop("readonly",!0),g.hide(),ft.hide(),w.val(0))}function cr(){return et.is(":visible")||g.is(":visible")||et.is(":visible")}function lr(n){var t="",i;return n==3?(i=Math.round(kt(n)/365,1),t="Last "+i.toString()+" Years"):n==2?(i=Math.round(kt(n)/31,1),t="Last "+i.toString()+" Month"):t=kt()!=0?"Last "+kt()+" Days":"This Day",t}function ar(n){return" adddays(sysdate, - "+kt(n)+") "}function kt(n){var u=0,i,t;if(n==3){var r=bt.val(),i=rt.val(),t=w.val();r=r&&r!=""?parseInt(r):0;i=i&&i!=""?parseInt(i):0;t=t&&t!=""?parseInt(t):0;u=r*365+i*31+t}else n==2?(i=rt.val(),t=w.val(),i=i&&i!=""?parseInt(i):0,t=t&&t!=""?parseInt(t):0,u=i*31+t):(t=t=w.val(),t=t&&t!=""?parseInt(t):0,u=t);return u}function di(n){var r=nt.children()[1],i=null;nt.children().length>2&&(i=nt.children()[2]);i?t(i).prop("disabled",!n).prop("readonly",!n):r!=null&&t(r).prop("disabled",!n).prop("readonly",!n)}function dt(n){var r=tt.children()[1],i=null;tt.children().length>2&&(i=tt.children()[2]);i?t(i).prop("disabled",!n).prop("readonly",!n):r!=null&&t(r).prop("disabled",!n).prop("readonly",!n)}function ui(n,t){n.prop("disabled",!t)}function gi(i,r){var e,o,u,f;i&&(vt=null);yt=null;e=null;o=null;i?(e=nt.children()[1],nt.children().length>2&&(o=nt.children()[2])):(e=tt.children()[1],tt.children().length>2&&(o=tt.children()[2]));e!=null&&(t(e).remove(),o!=null&&t(o).remove(),e=null);u=null;u=r!=null?r.getIsKey()?new n.Controls.VNumTextBox(r.getColumnName(),!1,!1,!0,r.getDisplayLength(),r.getFieldLength(),r.getColumnName()):n.VControlFactory.getControl(null,r,!0,!0,!1):new n.Controls.VTextBox("columnName",!1,!0,!1,20,20,"format","GetObscureType",!1);u!=null&&(u.setReadOnly(!1),n.DisplayType.Text==r.getDisplayType()||n.DisplayType.TextLong==r.getDisplayType()?(u.getControl().attr("rows","1"),u.getControl().css("width","100%")):n.DisplayType.YesNo==r.getDisplayType()?u.getControl().css("clear","both"):n.DisplayType.IsDate(r.getDisplayType())&&u.getControl().css("line-height","1"),f=null,u.getBtnCount()>0&&!(u instanceof n.Controls.VComboBox)&&(f=u.getBtn(0)),i?(nt.append(u.getControl()),vt=u,f&&(nt.append(f),u.getControl().css("width","65%"),f.css("max-width","35px"))):(tt.append(u.getControl()),yt=u,f&&(tt.append(f),u.getControl().css("width","65%"),f.css("max-width","35px"))))}function fi(t){var r,e;ci.empty();var f="",u="",i=null;if(t)for(r=0,e=t.length;r<e;r++)u='<tr class="vis-advancedSearchTableRow">',i=t[r],u+="<td>"+i.KEYNAME+'<\/td><td style="display:none">'+i.KEYVALUE+"<\/td><td>"+i.OPERATORNAME+"<\/td><td>"+i.VALUE1NAME+'<\/td><td style="display:none">'+i.VALUE1VALUE+"<\/td><td>"+i.VALUE2NAME+'<\/td><td style="display:none">'+i.VALUE2VALUE+'<\/td><td style="display:none">'+i.AD_USERQUERYLINE_ID+'<\/td><td style="display:none">'+i.OPERATOR+'<\/td><td><img style="cursor:pointer" data-index = "'+r+'" src="'+n.Application.contextUrl+'Areas/VIS/Images/base/delete10.png" /><\/td>',u+="<\/tr>",f+=u;ci.html(f)}function ei(t){var r="SELECT COUNT(*) FROM ",f,u,e;r+=ot;f=!1;st!=null&&st.length>0&&(r+=st.indexOf("@")==-1?" WHERE "+st:" WHERE "+n.Env.parseContext(n.context,i,st,!1),f=!0);t!=null&&t.getIsActive()&&(r+=f?" AND ":" WHERE ",r+=n.Env.parseContext(n.context,i,t.getWhereClause(!0),!1));u=n.MRole.getDefault().addAccessSQL(r.toString(),ot,n.MRole.SQL_NOTQUALIFIED,n.MRole.SQL_RO);n.context.setContext(i,fr,"FindSQL",u);s=999999;try{s=n.DB.executeScalar(u,null)}catch(h){ti.Log(n.Level.SEVERE,u,h)}return e=n.MRole.getDefault(),o.okPressed=!1,s==0||s==null?(s=0,n.ADialog.info("FindZeroRecords",!0,"FindZeroRecords")):t!=null&&e.getIsQueryMax(s)?n.ADialog.error("FindOverMax",!0,s+" > "+e.getMaxQueryRecords()):o.okPressed=!0,t!=null,s}function nr(n){var t=" "+n+" / "+s+" ";if(wi.text(t),s<f){bi=!0;return}}function ai(n){var t,i;if(n==null||n.length==0)return null;for(t=0;t<gt.length;t++)if(i=gt[t],n.equals(i.getColumnName()))return i;return null}function vi(){var i=p.val(),n,t,s,o,h;if(!i||i=="-1"||(n=p.find("option:selected").text(),t="",n==null||n.trim().length==0))return!1;if(t=i.toString(),s=d.prop("checked"),s)if(cr()){var r=">=",u=" >= ",f=lr(v[0].selectedIndex),e=ar(v[0].selectedIndex);yi(n,t,u,r,f,e,null,null)}else{var r="=",u=" = ",f=v.find("option:selected").text(),e=v.val();yi(n,t,u,r,f,e,null,null)}else o=a.val(),a[0].selectedIndex>-1&&(o=v.find("option:selected").text()),h=a.val(),yi(n,t,o,h,ir(!0),tr(!0),ir(!1),tr(!1));return p[0].selectedIndex=0,a[0].selectedIndex=0,oi(),oi(!0),k.prop("readonly",!1),!0}function tr(t){var i=null;return(i=t?vt:yt,i!=null)?i.getDisplayType()==n.DisplayType.YesNo?i.getValue().toString().toLowerCase()=="true"?"Y":"N":i.getValue():""}function ir(n){var t=null;return(t=n?vt:yt,t!=null)?t.getDisplay():""}function yi(t,i,r,u,f,e,o,s){h==null&&(h=[]);var c={};c.KEYNAME=t;c.KEYVALUE=i;c.OPERATORNAME=u;c.VALUE1NAME=n.Utility.encodeText(f);c.VALUE1VALUE=f==""?"":e==null?"NULL":n.Utility.encodeText(n.Utility.Util.getValueOfString(e));c.VALUE2NAME=n.Utility.encodeText(o);c.VALUE2VALUE=s==null?"NULL":n.Utility.encodeText(n.Utility.Util.getValueOfString(s));c.AD_USERQUERYLINE_ID=0;c.OPERATOR=r;h.push(c);fi(h)}function oi(n){var t=null;t=n?yt:vt;t!=null&&t.setValue(null)}function rr(){var e=new n.Query(ot),o,f,c,a,b,v;if(h)for(o=0;o<h.length;o++){var r=h[o],y=r.KEYNAME.toString(),p=r.KEYVALUE.toString(),l=ai(p),w=l.getColumnSQL(),s=r.OPERATORNAME.toString(),t=r.VALUE1VALUE,u=null;if(t!=null&&t.toString().trim().startsWith("adddays")||t.toString().trim().startsWith("@")||(u=ur(l,t)),f=null,t==null||t.toString().length<1){if(n.Query.prototype.BETWEEN.equals(s))continue;u=n.Env.NULLString;f="NULL"}else f=r.VALUE1NAME.toString();if(n.Query.prototype.BETWEEN.equals(s)){if(c=r.VALUE2VALUE.toString(),c==null||c.toString().trim().length<1)continue;if(a=ur(l,c),b=r.VALUE2NAME.toString(),a==null)continue;e.addRangeRestriction(w,u,a,y,f,b)}else u==null&&t!=null&&(t.toString().trim().startsWith("adddays")||t.toString().trim().startsWith("@"))?(v=p+s+t,where=n.Env.parseContext(n.context,i,v,!1),e.addRestriction(v)):e.addRestriction(w,s,u,y,f)}return e}function ur(t,i){var u,r,e,f,o;if(i==null||(u=t.getDisplayType(),r=i.toString(),r==null||r.equals(n.Env.NULLString)||r==""))return null;try{if(u==n.DisplayType.Integer||n.DisplayType.IsID(u)&&t.getColumnName().endsWith("_ID"))return parseInt(r);if(n.DisplayType.IsNumeric(u))return parseFloat(r);if(n.DisplayType.IsDate(u)){e="";try{return new Date(r)}catch(h){e=""}try{return Date.Parse(e)}catch(c){return null}}}catch(s){return f=s.message,(f==null||f.length==0)&&(f=s.toString()),o="",o+=t.getColumnName()+" = "+r+" - "+f,n.ADialog.error("ValidationError",!0,o.toString()),null}return r}function vr(){var f,i;if(it(!0),vi(),c=rr(),c.getRestrictionCount()==0){it(!1);return}f=c.getWhereClause(!0);i=n.Utility.encodeText(k.val());i!=null&&i.length==0&&(i=null);var t=y.val(),u="";t=t!=null&&t.toString()!="-1"&&parseInt(t)>0?t:0;window.setTimeout(function(){(t!=0||i!=null)&&(r.insertOrUpdate(t,i,f,si,hi,h)?(li=!1,u=(t>0?"Updated":"Saved")+" "+i):(li=!0,u=(t>0?"UpdatedError":"SaveError")+" "+i));var e=!1;ei(c,!0)!=0&&(e=!0);it(!1);u!=""&&n.ADialog.info(u,!0,"",null);e&&l.close()},10)}function it(n){b=n;pi.css("visibility",b?"visible":"hidden");pt.prop("disabled",n);ht.prop("disabled",n);wt.prop("disabled",n)}var yr=u.getName(),si=u.getAD_Tab_ID(),hi=u.getAD_Table_ID(),ot=u.getTableName(),st=u.getWhereClause(),gt=u.getFields(),e=t("<div style='height:100%'>").html("<div class='vis-apanel-busy' style='height:96%; width:98%;'><\/div>"),pi=null,o=this,l=null,pt,ht,ct,lt,wt,k,y,p,a,v,d,bt,rt,w,wi,ut,at,g,ft,et,nt,tt,ni,ci,fr=99,s=0,bi=!1,li=!1,b=!1,h=null,ti=n.Logging.VLogger.getVLogger("Find"),vt,yt,ii,c;this.onClose=null;this.created=!1;this.days=0;this.okPressed=!1;this.okBtnPressed=!1;ii="";c=new n.Query(ot);c.addRestriction(st);e.load(n.Application.contextUrl+"ASearch/Index/?windowNo="+i,function(){er();or();sr()});this.show=function(){l=new n.ChildDialog;l.setHeight(550);l.setWidth(860);l.setTitle(n.Msg.getMsg("Find"));l.setModal(!0);l.onClose=function(){o.onClose&&o.onClose();o.dispose()};l.show();l.setContent(e);l.hideButtons()};this.getQuery=function(){var t=n.MRole.getDefault();return t.getIsQueryMax(s)?(c=n.Query.prototype.getNoRecordQuery(ot,!1),s=0,ti.warning("Query - over max")):ti.info("Query="+c),c};this.disposeComponent=function(){hr();pt=ht=ct=lt=wt=null;k=y=p=a=v=d=bt=rt=w=null;ut=at=g=ft=et=null;e&&e.remove();e=null;s=bi=li=null;h=null;ti=null;this.created=this.days=0;this.okPressed=this.okBtnPressed=null;vt=yt=ii=null;c=null}}var r={getData:function(t,i,r,u){var e=t.getAD_Client_ID(),f=null,o="SELECT NAME,"+u+", AD_UserQuery_ID FROM AD_UserQuery WHERE AD_Client_ID="+e+" AND IsActive='Y' AND (AD_Tab_ID="+i+" OR AD_Table_ID="+r+") ORDER BY AD_UserQuery_ID";try{f=n.DB.executeDataReader(o,null,null)}catch(s){f!=null&&(f=null)}return f},getQueryLines:function(t){var i=null,e=[],o="SELECT KEYNAME,KEYVALUE,OPERATOR AS OPERATORNAME,VALUE1NAME,VALUE1VALUE,VALUE2NAME,VALUE2VALUE,AD_USERQUERYLINE_ID FROM AD_UserQueryLine WHERE AD_UserQuery_ID="+t+" ORDER BY SeqNo",u,f,r;try{for(i=n.DB.executeDataReader(o,null,null),u="",f="";i.read();)r={},r.KEYNAME=i.get("KEYNAME"),r.KEYVALUE=i.get("KEYVALUE"),r.OPERATORNAME=i.get("OPERATORNAME"),r.VALUE1NAME=i.get("VALUE1NAME"),r.VALUE1VALUE=i.get("VALUE1VALUE"),r.VALUE2NAME=i.get("VALUE2NAME"),r.VALUE2VALUE=i.get("VALUE2VALUE"),r.AD_USERQUERYLINE_ID=i.get("AD_USERQUERYLINE_ID"),u=i.get("OPERATORNAME").toString(),f=n.Query.prototype.OPERATORS[u],r.OPERATOR=f,e.push(r)}catch(s){}return e},deleteLines:function(t){var i="DELETE FROM AD_UserQueryLine WHERE AD_UserQuery_ID="+t,r=n.DB.executeQuery(i,null,null);return r>=0},deleteUserQuery:function(i){var r=-1;return t.ajax({url:n.Application.contextUrl+"ASearch/DeleteQuery",type:"POST",datatype:"json",async:!1,data:{id:i}}).done(function(n){r=parseInt(n)}),r>=0},insertOrUpdate:function(i,r,u,f,e,o){var s=-1;return t.ajax({url:n.Application.contextUrl+"ASearch/InsertOrUpdateQuery",type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:JSON.stringify({id:i,name:r,where:u,tabid:f,tid:e,qLines:o})}).done(function(n){s=parseInt(n)}),s>=0}};i.prototype.getOperatorsQuery=function(t,i){var f="",r="",u;for(u in t)r=t[u],i&&(r=n.Msg.getMsg(r)),f+='<option value="'+u+'">'+r+"<\/option>";return f};i.prototype.getIsUserColumn=function(n){return n.endsWith("atedBy")||n.equals("AD_User_ID")?!0:n.equals("SalesRep_ID")?!0:!1};i.prototype.getCurrentDays=function(){return this.days};i.prototype.getIsCreated=function(){return this.created};i.prototype.getIsOKPressed=function(){return this.okPressed&&this.okBtnPressed};i.prototype.dispose=function(){this.disposeComponent()};n.Find=i}(VIS,jQuery),function(n,t){function i(i,r,u,f,e,o,s,h){this.init=function(){l()};var c=[],l=function(){for(var g="SELECT DISTINCT t.AD_Table_ID, t.TableName FROM AD_Table t WHERE EXISTS (SELECT 1 FROM AD_Tab tt WHERE tt.AD_Table_ID = t.AD_Table_ID AND tt.SeqNo=10)  AND t.AD_Table_ID IN (SELECT AD_Table_ID FROM AD_Column WHERE ColumnName='"+r+"_ID') AND TableName NOT LIKE 'I%'AND TableName NOT LIKE '"+r+"' ORDER BY 1",v=n.DB.executeReader(g,null),b,e,k,y,d,p,w,i,l;v.read();)if(b=v.getString(1),e=a(b,f,u.getWhereClause()),e!=null)for(i in e){k=e[i];y=!0;for(d in c)if(c[d].ID==e[i].ID){y=!1;break}y&&c.push(k)}if(v=null,c.length==0)alert(n.Msg.getMsg("NoZoomTarget"));else{p=t("<div>");w=t("<ul class=vis-apanel-rb-ul>");p.append(w);for(i in c){l=t("<li data-id='"+c[i].ID+"'>");l.append(c[i].Name);l.on("click",function(i){var f,r,u;i.stopImmediatePropagation();f=t(this).data("id");r=new n.Query;r.addRestriction(s,n.Query.prototype.EQUAL,h);n.viewManager.startWindow(f,r);u=t("#w2ui-overlay");u.hide();u=null});w.append(l)}o.w2overlay(p.clone(!0),{css:{height:"200px"}})}},a=function(t,i,r){var b=[],c=[],g=0,nt,tt="",a="",it=!1,ft=n.context.ctx,e=[],l="SELECT DISTINCT w.AD_Window_ID, w.Name, tt.WhereClause, t.TableName, wp.AD_Window_ID, wp.Name, ws.AD_Window_ID, ws.Name FROM AD_Table t INNER JOIN AD_Tab tt ON (tt.AD_Table_ID = t.AD_Table_ID) ",ut=n.Env.isBaseLanguage(),u,o,p,s,k,w,d,f,rt,h;if(ut?(l+="INNER JOIN AD_Window w ON (tt.AD_Window_ID=w.AD_Window_ID)",l+=" LEFT OUTER JOIN AD_Window ws ON (t.AD_Window_ID=ws.AD_Window_ID) LEFT OUTER JOIN AD_Window wp ON (t.PO_Window_ID=wp.AD_Window_ID)"):(l+="INNER JOIN AD_Window_Trl w ON (tt.AD_Window_ID=w.AD_Window_ID AND w.AD_Language='"+n.Env.getAD_Language()+"')",l+=" LEFT OUTER JOIN AD_Window_Trl ws ON (t.AD_Window_ID=ws.AD_Window_ID AND ws.AD_Language='"+n.Env.getAD_Language()+"') LEFT OUTER JOIN AD_Window_Trl wp ON (t.PO_Window_ID=wp.AD_Window_ID AND wp.AD_Language='"+n.Env.getAD_Language()+"')"),l+="WHERE t.TableName ='"+t+"' AND w.AD_Window_ID <>"+i+" AND tt.SeqNo=10 AND (wp.AD_Window_ID IS NOT NULL OR EXISTS (SELECT 1 FROM AD_Tab tt2 WHERE tt2.AD_Window_ID = ws.AD_Window_ID AND tt2.AD_Table_ID=t.AD_Table_ID AND tt2.SeqNo=10)) ORDER BY 2",u=n.DB.executeDataSet(l,null),u!=null&&u.getTables()[0].getRows().length>0){for(o=0;o<u.getTables()[0].getRows().length;o++){if(it=!0,g=u.getTables()[0].getRows()[o].getCell(6),tt=u.getTables()[0].getRows()[o].getCell(7),nt=u.getTables()[0].getRows()[o].getCell(4),a=u.getTables()[0].getRows()[o].getCell(2),nt==null||nt.Length==0)break;p={};p.AD_Window_ID=u.getTables()[0].getRows()[o].getCell(0);p.windowName=u.getTables()[0].getRows()[o].getCell(1);p.whereClause=a;e.push(p)}if(u=null,s="",!it||e.length<=1&&g==0)return b;if(e.length<=1)s="SELECT count(*) FROM "+t+" WHERE "+r,a!=null&&a.Length!=0&&(s+=" AND "+n.Evaluator.replaceVariables(a,n.Env.getCtx(),null));else if(e.length>1){for(f in e)v(c,e[f].whereClause);s="SELECT DISTINCT ";for(f in c)f!=0&&(s+=","),s+=c[f].toString();c.length==0&&(s+="count(*) ");s+=" FROM "+t+" WHERE "+r}if(k=[],u=n.DB.executeDataSet(s,null),u!=null&&u.getTables()[0].getRows().length>0)for(w=0;w<u.getTables()[0].getRows().length;w++)if(c.length>0){k=[];for(f in c)d={},d.columnName=c[f].toString(),d.columnValue=u.getTables()[0].getRows()[w].getCell(c[f].toString()),k.push(d);for(f in e)if(y(k,e[f].whereClause)){h={};h.ID=e[f].AD_Window_ID;h.Name=e[f].windowName;b.push(h);break}}else rt=u.getTables()[0].getRows()[w].getCell(0),rt!=0&&(h={},h.ID=g,h.Name=tt,b.push(h))}return b},v=function(n,t){var i;if(t!=null&&t.Length!=0&&(i=t,!(i.indexOf(" EXISTS ")>0)&&!(i.indexOf(" IN ")>0)&&!(i.indexOf("(")>0)&&!(i.indexOf(")")>0)))while(i.indexOf("=")!=-1){var f=i.indexOf("="),u=i.lastIndexOf(" ",f),e=f-(u+1),r=i.substr(u+1,e);r.indexOf(".")!=-1&&(u=r.indexOf(".")+1,e=f-u,r=r.substr(u,e));n.indexOf(r)<0&&n.push(r);i=i.substr(f+1)}},y=function(t,i){var r,o,s;if(i==null||i.Length==0)return!0;if(r=i,o=!0,r.indexOf(" EXISTS ")>0||r.indexOf(" IN ")>0||r.indexOf("(")>0||r.indexOf(")")>0)return!1;while(r.indexOf("=")!=-1){var u=r.indexOf("="),f=r.lastIndexOf(" ",u),e=r.substr(f+1,u-(f+1)),h="",c="";e.indexOf(".")!=-1&&(f=e.indexOf("."),e=e.substr(f,u));for(s in t)if(e==t[s].columnName){h="'"+t[s].columnValue+"'";break}if(r=r.substr(u+1),f=0,u=r.indexOf(" "),c=u==-1?r.substr(f):r.substr(f,u),!n.Evaluator.evaluateLogicTuple(h,"=",c)){o=!1;break}}return o}}n.AZoomAcross=i}(VIS,jQuery),function(n,t){function i(i,r,u,f){function ri(){w=f;w||(at=i.gridTable.AD_Table_ID,o=r.getSelectedRows(),l=i.getRecords()[i.getCurrentRow()]);a=t('<ul class="vis-sms-ul" ><\/ul>');v=t("<div>");v.css("position","absolute");v.css("bottom","0");v.css("background","url('"+n.Application.contextUrl+"Areas/VIS/Images/LoadingCircle.gif') no-repeat");v.css("background-position","center center");v.css("width","100%");v.css("height","100%");v.css("text-align","center");v.css("opacity",".1");v[0].style.visibility="hidden"}function ui(){var i='         <div class="contentArea" style="width: 100%; float: left; height: 96%">',r;i+=' <div class="vis-sms-leftDiv"><\/div>';i+='   <div class="vis-sms-ContentWrap"><div class="vis-sms-ContentArea"><div class="vis-sms-leftWrap"><div class="vacom-form-horizontal">';i+='   <div class="vis-sms-inputWrap"><div class="vis-sms-form-data-sub">';i+='         <input type="text"  id="'+s.windowNo+'_emailMoblie"  placeholder="'+n.Msg.getMsg("EnterMobileNumber")+'">';i+="<\/div>";i+="  <\/div>";i+='  <\/div><div class="vis-sms-textarea-div" style="width: 100%; float: left; border: 1px solid rgb(204, 204, 204);">';i+=' <textarea  ondrop="return false;" id="'+s.windowNo+'_vis-sms-textarea" style="width: 100%; height:100%;resize:none" placeholder="'+n.Msg.getMsg("WriteMsgHere")+'"><\/textarea><\/div>';i+=' <div class="vis-sms-leftFooter">';i+='<div ><p class="vis-sms-counter" id='+s.windowNo+'_acCount><\/p> <p  class="vis-sms-counter"   id='+s.windowNo+'_oper><\/p> <p  class="vis-sms-counter"   id='+s.windowNo+"_maxCount >160<\/p> <\/div>";i+=' <input id="'+s.windowNo+'_dyndis" type="checkbox"><label  id="'+s.windowNo+'_dyndislbl"  for="'+s.windowNo+'_dyndis" >'+n.Msg.getMsg("DynamicSms")+"<\/label><\/div><\/div>";i+='  <div class="vis-sms-divider"><\/div>';i+=' <div class="vis-sms-rytWrap"><div class="vis-sms-rytContent">';i+=' <div class="vis-sms-rytBcc"><div><h4 style="float:left">'+n.Msg.getMsg("Mobile")+"<\/h4>";i+=' <img  id="'+s.windowNo+'_SmsRefresh"  style="cursor: pointer;float:right;margin-top:8px" title="'+n.Msg.getMsg("Refresh")+'" src="'+n.Application.contextUrl+'Areas/VIS/Images/Refresh24.png">';i+='   <\/div><div class="vis-sms-BccList">';i+=" <\/div><\/div><\/div><\/div>  <\/div><\/div>";e.append(t(i));r=0;k=e.find("#"+s.windowNo+"_dyndis");e.find(".contentArea").css("height",e.height()-44);e.find(".vis-sms-leftDiv").height(e.height()-44);y=e.find(".vis-sms-leftDiv");et=e.find(".vis-sms-BccList");c=e.find("#"+s.windowNo+"_emailMoblie");pt=e.find("#"+s.windowNo+"_SmsRefresh");c.css("margin-top","10px");h=e.find("#"+s.windowNo+"_vis-sms-textarea");$leftfootArea=e.find(".vis-sms-leftFooter");rt=e.find("#"+s.windowNo+"_acCount");ut=e.find("#"+s.windowNo+"_oper");ot=e.find("#"+s.windowNo+"_maxCount");e.find(".vis-sms-textarea-div").css("margin-top","10px");e.find(".vis-sms-rytBcc").height(e.find(".vis-sms-rytContent").height()-10);w?(e.find(".vis-sms-leftDiv").hide(),e.find(".vis-sms-rytWrap").hide(),e.find(".vis-sms-textarea-div").height(e.height()-150),e.find(".vis-sms-leftWrap").css("width","100%"),e.find("#"+s.windowNo+"_dyndislbl").hide(),r=e.width()-40,k.prop("checked",!1),k.hide()):(e.find(".vis-sms-textarea-div").height(e.height()-150),r=e.width()-240,e.find(".vis-sms-leftWrap").width(r-345));b=e.find(".vis-sms-ContentWrap");b.css("width",r);yt=!0;e.find(".vis-sms-BccList").height(e.find(".vis-sms-rytContent").height()-70)}function fi(){var f,u,c,s,h,r;for(nt=t('<img src="'+n.Application.contextUrl+'Areas/VIS/Images/Action.png" style="cursor:pointer" ><\/img>'),f=t('<div class="vis-apanel-lb-toggle" style="height:100%;overflow-x:hidden;overflow-y:hidden"><\/div>'),f.append(nt),y.append(f),p=t('<ul class="vis-apanel-lb-ul"><\/ul>'),p.css({height:e.height()-80+"px",overflow:"auto","white-space":"nowrap",width:"150%"}),u=0;u<i.gridTable.getFields().length;u++)if(c=i.gridTable.getFields(0)[u].getColumnName().toUpper()==i.getKeyColumnName().toUpper(),i.gridTable.getFields(0)[u].getIsDisplayed()||c){if(c||p.append(t("<li>"+i.gridTable.getFields(0)[u].getHeader()+"<\/li>")),s=[],h=[],i.gridTable.getFields(0)[u].getColumnName().toUpper().equals(g))for(r=0;r<o.length;r++)n.DisplayType.IsLookup(i.getField(g).getDisplayType())?o[r][g.toLower()]!=null&&(s.push(o[r][g.toLower()]),h.push(o[r][i.getKeyColumnName().toLower()])):o[r][g.toLower()]!=null&&(s.push(o[r][g.toLower()]),h.push(o[r][i.getKeyColumnName().toLower()]));oi(s,h)}f.append(p)}function wt(n){var t,u;if(n&&(a.empty(),o=r.getSelectedRows(),l=i.getRecords()[i.getCurrentRow()]),r.singleRow)bt();else if(o.length>0)for(t=0;t<o.length;t++)o[t].mobile!=null&&(u=o[t][i.getKeyColumnName().toLower()],a.append('<li class="vis-sms-list-li-bcc"  data-mobile="'+o[t].mobile+'"><input id="'+s.windowNo+"_"+o[t].mobile+'_CheckBoxList1" type="checkbox" value="'+o[t].mobile+'" checked/><label class="vis-sms-chcklist-label"  for="'+s.windowNo+"_"+o[t].mobile+'_CheckBoxList1">'+o[t].mobile+"("+u+")<\/label><\/li>"));else bt();n||et.append(a);a.children().length>1&&k.prop("checked")==!0&&(c.val(""),c.prop("disabled",!0))}function bt(){if(l.mobile!=null){var n=l[i.getKeyColumnName().toLower()];a.append('<li class="vis-sms-list-li-bcc" data-mobile="'+l.mobile+'"><input id="'+s.windowNo+"_"+l.mobile+'_CheckBoxList1" type="checkbox" value="'+l.mobile+'" checked /><label class="vis-sms-chcklist-label"  for="'+s.windowNo+"_"+l.mobile+'_CheckBoxList1">'+l.mobile+"("+n+")<\/label><\/li>")}}function ei(){it=t('<img  class="vis-Sms-sendButton" title="'+n.Msg.getMsg("SendSms").replace("&","")+'" src="'+n.Application.contextUrl+'Areas/VIS/Images/sendSms.png"> <\/img>');ht.append(it);w||(tt=t('<img  class="vis-sms-preview-btn" title="'+n.Msg.getMsg("Preview").replace("&","")+'" src="'+n.Application.contextUrl+'Areas/VIS/Images/preview.png"> <\/img>'),ht.append(tt))}function oi(i,r){for(var f,e=0;e<i.length;e++){var o="Select AD_User_ID,issms,mobile from ad_user where c_bpartner_ID="+i[e],u=n.DB.executeDataSet(o);if(u!=null&&u.getTables()[0].getRows().length>0)for(f=0;f<u.getTables()[0].getRows().length;f++)if(u.getTables()[0].getRows()[f].getCell("ISSMS")!=null&&u.getTables()[0].getRows()[f].getCell("ISSMS").toString().equals("Y")){if(u.getTables()[0].getRows()[f].getCell("MOBILE")==null||u.getTables()[0].getRows()[f].getCell("MOBILE")=="")continue;if(t(a.children("li").data(u.getTables()[0].getRows()[f].getCell("MOBILE")+r[e])).length>0)continue;a.append('<li  class="vis-sms-list-li-bcc"><input id="'+s.windowNo+"_"+u.getTables()[0].getRows()[f].getCell("MOBILE")+'_CheckBoxList1" type="checkbox"  value="'+u.getTables()[0].getRows()[f].getCell("MOBILE")+r[e]+'" checked/><label class="vis-sms-chcklist-label" for="'+s.windowNo+"_"+u.getTables()[0].getRows()[f].getCell("MOBILE")+'_CheckBoxList1">'+u.getTables()[0].getRows()[f].getCell("MOBILE")+"("+r[e]+")<\/label><\/li>")}}}function si(){it.on("click",wi);h.on("keyup",kt);if(!w){nt.on("click",hi);k.on("click",ci);p.children("li").on("click",li);tt.on("click",ai);nt.trigger("click");pt.on("click",vi)}}function hi(){k.prop("checked")==!0?y.width()==40?(y.css("width","200px"),y.find("ul").show(),b.width(b.width()-160),e.find(".vis-sms-leftWrap").width(e.find(".vis-sms-leftWrap").width()-160)):ct():y.width()!=40&&ct()}function ct(){y.css({width:"40px"});y.find("ul").hide();b.width(b.width()+160);e.find(".vis-sms-leftWrap").width(e.find(".vis-sms-leftWrap").width()+160)}function ci(){this.checked?(y.width()!=40&&y.find("ul").show(),r.singleRow==!1&&o.length>1&&(c.val(""),c.prop("disabled",!0))):(y.width()!=40&&ct(),c.prop("disabled",!1))}function li(){var r=h[0],f="@@"+t(this).text()+"@@",s=r.scrollTop,n=0,u=r.selectionStart||r.selectionStart=="0"?"ff":document.selection?"ie":!1,e,o,i;u=="ie"?(h.focus(),i=document.selection.createRange(),i.moveStart("character",-h.val().length),n=i.text.length):u=="ff"&&(n=r.selectionStart);e=h.val().substring(0,n);o=h.val().substring(n,h.val().length);h.val(e+f+o);n=n+f.length;u=="ie"?(h.focus(),i=document.selection.createRange(),i.moveStart("character",-h.val().length),i.moveStart("character",n),i.moveEnd("character",0),i.select()):u=="ff"&&(r.selectionStart=n,r.selectionEnd=n,h.focus());r.scrollTop=s;r=null;kt()}function ai(){var f=h.val(),e="",u,i;e=r.singleRow==!1&&o.length>0?dt(f,0):gt(f);u=t("<div><\/div>");u.append(n.Utility.encodeText(e));i=new n.ChildDialog;i.setHeight(420);i.setWidth(850);i.setTitle(n.Msg.getMsg("Preview"));i.setModal(!0);i.setContent(u);i.show();i.hidebuttons()}function vi(){wt(!0)}function kt(){rt.text(h.val().length);parseInt(rt.text())>parseInt(ot.text())?(ut.text(">"),lt("#ED0000")):parseInt(rt.text())==parseInt(ot.text())?(ut.text("="),lt("#000000")):(ut.text("<"),lt("#000000"))}function lt(n){ut.css("color",n);rt.css("color",n);ot.css("color",n)}function yi(t,u){for(var l=t,h={},f=t;f.indexOf("@@")>-1;){f=f.substring(f.indexOf("@@")+2);var c=f.substring(0,f.indexOf("@@")),s=null,e=Object.keys(r.getColumnNames()).filter(function(n){return r.getColumnNames()[n]===c})[0];n.DisplayType.IsLookup(i.getField(e).getDisplayType())||n.DisplayType.Location==i.getField(e).getDisplayType()?o[u][e.toLower()]!=null&&o[u][e.toLower()]!=undefined&&(s=i.getField(e.toLower()).lookup.getDisplay(o[u][e.toLower()])):n.DisplayType.IsDate(i.getField(e).getDisplayType())?(s=i.getField(e).value,s=new Date(s)):s=o[u][e.toLower()];f=f.substring(f.indexOf("@@")+2);h["@@"+c+"@@"]=s}return h}function pi(t){for(var u=t,o={};u.indexOf("@@")>-1;){u=u.substring(u.indexOf("@@")+2);var s=u.substring(0,u.indexOf("@@")),e=null,f=Object.keys(r.getColumnNames()).filter(function(n){return r.getColumnNames()[n]===s})[0];n.DisplayType.IsLookup(i.getField(f).getDisplayType())||n.DisplayType.Location==i.getField(f).getDisplayType()?l[f.toLower()]!=null&&l[f.toLower()]!=undefined&&(e=i.getField(f.toLower()).lookup.getDisplay(l[f.toLower()])):n.DisplayType.IsDate(i.getField(f).getDisplayType())?(e=i.getField(f).value,e=new Date(e)):e=l[f.toLower()];u=u.substring(u.indexOf("@@")+2);o["@@"+s+"@@"]=e}return o}function dt(t,u){for(var h=t,f=t;f.indexOf("@@")>-1;){f=f.substring(f.indexOf("@@")+2);var c=f.substring(0,f.indexOf("@@")),s=null,e=Object.keys(r.getColumnNames()).filter(function(n){return r.getColumnNames()[n]===c})[0];n.DisplayType.IsLookup(i.getField(e).getDisplayType())||n.DisplayType.Location==i.getField(e).getDisplayType()?o[u][e.toLower()]!=null&&o[u][e.toLower()]!=undefined&&(s=i.getField(e.toLower()).lookup.getDisplay(o[u][e.toLower()])):n.DisplayType.IsDate(i.getField(e).getDisplayType())?(s=i.getField(e).value,s=new Date(s)):s=o[u][e.toLower()];f=f.substring(f.indexOf("@@")+2);h=h.replace("@@"+c+"@@",s)}return h}function gt(t){for(var f=t;f.indexOf("@@")>-1;){f=f.substring(f.indexOf("@@")+2);var o=f.substring(0,f.indexOf("@@")),e=null,u=Object.keys(r.getColumnNames()).filter(function(n){return r.getColumnNames()[n]===o})[0];n.DisplayType.IsLookup(i.getField(u).getDisplayType())||n.DisplayType.Location==i.getField(u).getDisplayType()?l[u.toLower()]!=null&&l[u.toLower()]!=undefined&&(e=i.getField(u.toLower()).lookup.getDisplay(l[u.toLower()])):n.DisplayType.IsDate(i.getField(u).getDisplayType())?(e=i.getField(u).value,e=new Date(e)):e=r.singleRow==!0?i.getField(u).value:l[u.toLower()];f=f.substring(f.indexOf("@@")+2);t=t.replace("@@"+o+"@@",e)}return t}function wi(){var d=h.val(),s,p,i,f,u,y,w,b,g,nt;if(d!=null&&d!=""&&d.trim().length!=0||n.ADialog.ask(n.Msg.getMsg("SendWithoutBody"))){if(ft=[],s="",p=[],k.prop("checked")==!1){if(i={},i.MobileNumbers=[],c.val().contains(";"))for(f=c.val().split(";"),u=0;u<f.length;u++)f[u]!=null&&f[u]!=""&&(ti(f[u])?i.MobileNumbers.push(f[u]):s+=f[u]+",");else c.val()!=null&&c.val()!=""&&(ti(c.val())?i.MobileNumbers.push(c.val()):s+=c.val()+",");if(a!=null&&a!=undefined)if(selectedValues=[],e.find("[id*=CheckBoxList1]:checked").each(function(){selectedValues.push(t(this).val())}),selectedValues.length>0)for(y=0;y<selectedValues.length;y++)selectedValues[y]?i.MobileNumbers.push(selectedValues[y]):s+=selectedValues[y]+",";else if(c.val().trim().length==0){window.setTimeout(function(){n.ADialog.info("NoNumberFound")},2);return}if(s!=""){window.setTimeout(function(){n.ADialog.info("InvalidMobileNumbers"+s)},2);return}if(i.Body={},i.MobileNumbers.length>0)for(w=0;w<i.MobileNumbers.length;w++)ft.push({num:i.MobileNumbers[w],info:'"'+i.MobileNumbers[w]+'","'+h.val()+'","'+new Date+'","@@response@@"'});p.push(i)}else if(selectedValues=[],t("[id*=CheckBoxList1]:checked").each(function(){selectedValues.push(t(this).val())}),r.singleRow==!0&&o.length>0)p.push(ni(l,0));else for(b=0;b<o.length;b++)p.push(ni(o[b],b));g=JSON.stringify(p);v[0].style.visibility="visible";nt={sms:g,format:h.val()};t.ajax({url:n.Application.contextUrl+"Sms/SendSms",data:nt,datatype:"json",type:"post",cache:!1,success:function(i){var r=JSON.parse(i),e,o,u,s,h,c,f;if(v[0].style.visibility="hidden",r.ResultMessage=="SmsConfigurationNotFound"){window.setTimeout(function(){n.ADialog.info(n.Msg.getMsg("SmsConfigurationNotFound"))},2);return}for(e=t('<div style="max-height: 300px;overflow:auto"><\/div>'),o=t("<table><\/table>"),u=0;u<r.Response.length;u++)s=t("<tr><\/tr>"),h=t("<td><\/td>"),h.append(r.Response[u].mobileNumber+" - "+r.Response[u].response),s.append(h),o.append(s);e.append(o);c=t('<a style="float:right" href="javascript:void(0)" ><img title="'+n.Msg.getMsg("SaveSmsLog")+'" src="'+n.Application.contextUrl+'Areas/VIS/Images/base/Save24.PNG"><\/img><\/a>');e.append(c);f=new n.ChildDialog;f.setTitle(n.Msg.getMsg("Information"));f.setContent(e);f.show();f.hidebuttons();c.on("click",function(){for(var i="",u,f,e,n=0;n<r.Response.length;n++)u=t.grep(ft,function(t){return t.num==r.Response[n].mobileNumber}),i+=u[0].info.replace("@@response@@",r.Response[n].response)+"\n";f=(new Date).toISOString().slice(0,19).replace(/-/g,"");e="data:text/csv;base64,"+window.btoa(i);t(this).attr("href",e).attr("download","file-"+f+".csv")})},error:function(t){console.log(t);n.ADialog.error("MessageSendingFailed");v[0].style.visibility="hidden"}})}}function ni(n,t){var i={},u,t,e,f;if(i.MobileNumbers=[],c.val().contains(";"))for(u=c.val().split(";"),t=0;t<u.length;t++)u[t]!=null&&u[t]!=""&&i.MobileNumbers.push(u[t]);else c.val()!=null&&c.val()!=""&&i.MobileNumbers.push(c.val());if(a!=null&&a!=undefined&&Object.keys(n).indexOf("mobile")>-1&&selectedValues.indexOf(n.mobile)>-1&&i.MobileNumbers.push(n.mobile),e="",r.singleRow==!1?(i.Body=yi(h.val(),t),e=dt(h.val(),t)):(i.Body=pi(h.val()),e=gt(h.val())),i.MobileNumbers.length>0)for(f=0;f<i.MobileNumbers.length;f++)ft.push({num:i.MobileNumbers[f],info:'"'+i.MobileNumbers[f]+'","'+e+'","'+new Date+'","@@response@@"'});return i}function ti(n){var i=!0,t,r;if(n.indexOf("(")>-1&&(n=n.substring(0,n.toString().indexOf("("))),n.length<10||n.length>12)i=!1;else{for(r=n.length,t=0;t<r;t++)isNaN(n[t])&&(/\s+$/.test(n[t])||n[t]!="("&&n[t]!=")"&&(i=!1));n.indexOf("(")>-1&&!n.indexOf(")")>-1&&(i=!1)}return i}function bi(){e.height(vt);e.width(st);var n=0;e.find(".contentArea").css("height",e.height()-44);e.find(".vis-sms-leftDiv").height(e.height()-44);e.find(".vis-sms-textarea-div").css("margin-top","10px");e.find(".vis-sms-rytBcc").height(e.find(".vis-sms-rytContent").height()-10);w?(e.find(".vis-sms-leftDiv").hide(),e.find(".vis-sms-rytWrap").hide(),e.find(".vis-sms-textarea-div").height(e.height()-150),e.find(".vis-sms-leftWrap").css("width","100%"),n=e.width()-40,k.prop("checked",!1),k.hide()):(e.find(".vis-sms-textarea-div").height(e.height()-150),n=st-(e.find(".vis-sms-leftDiv").width()+30),e.find(".vis-sms-leftWrap").width(n-345));b=e.find(".vis-sms-ContentWrap");b.css("width",n)}this.frame=null;this.windowNo=n.Env.getWindowNo();var ii=n.Env.getCtx(),d=null,w=!1,g="C_BPARTNER_ID",o=null,l=null,at=0,ft=[],s=this,vt=0,st=0,p=null,e=t('<div class="vis-sms-rootDiv"><\/div>'),ht=t('<div class="vis-awindow-header vis-menuTitle">'),y=null,b=null,et=null,nt=null,h=null,a=null,c=null,p=null,rt,ut,ot,it,tt,yt=!1,v,pt=null,k=null;ri();this.initializeComponent=function(){var i=t('<a href="javascript:void(0)"  class="vis-mainMenuIcons vis-icon-menuclose"><\/a>'),u="";u=w?t("<p>"+n.Msg.getMsg("Sms")+" ("+n.Msg.getMsg("Contacts")+") <\/p>"):t("<p>"+n.Msg.getMsg("Sms")+" ("+r.aPanel.$parentWindow.getName()+") <\/p>");e.append(ht.append(i).append(u));e.append(v);i.click(function(n){s.dispose();s=null;n.stopPropagation()});ui();ei();w||(fi(),wt(!1));si()};this.disposeComponent=function(){it.off("click");w||(nt.off("click"),p.children("li").off("click"),p.remove(),nt.remove());k.off("click");tt!=undefined&&(tt.off("click"),tt.remove());h.off("keyup");e.find(".vis-sms-CcBcc").off("click");ii=null;d=null;w=!1;g="";o=null;l=null;at=0;p=null;e.remove();e=null;y.remove();y=null;b.remove();b=null;et.remove();et=null;nt=null;a.remove();a=null;c.remove();c=null;p!=null&&p.remove();p=null;it.remove();it=null;tt=null;s=null};this.show=function(){d=new n.ChildDialog;d.setHeight(800);d.setWidth(1600);d.setTitle(n.Msg.getMsg("Sms"));d.setModal(!0);d.show();e=t('<div class="vis-sms-rootDiv"><\/div>');d.setContent(e);initializeComponent()};this.getRoot=function(){return e};this.sizeChanged=function(n,t){vt=n;st=t;yt==!0&&bi()}}i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;t.hideHeader(!0);this.initializeComponent();this.frame.getContentGrid().append(this.getRoot())};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Sms=i}(VIS,jQuery),function(n,t){function i(i,r,u,f,e,o){var l=232,h="",c=null,s=null;this.getRequests=function(){for(var s="SELECT COUNT(*) FROM AD_Table WHERE TableName='R_Request'",f=n.DB.executeReader(s,null),c,l,p,e,i;f.read();)if(parseInt(f.getString(0))==0){n.ADialog.error("VIS_NotSupported");return}for(h="(AD_Table_ID="+r+" AND Record_ID="+u+")",r==114?h+=" OR AD_User_ID="+u+" OR SalesRep_ID="+u:r==291?h+=" OR C_BPartner_ID="+u:r==259?h+=" OR C_Order_ID="+u:r==318?h+=" OR C_Invoice_ID="+u:r==335?h+=" OR C_Payment_ID="+u:r==208?h+=" OR M_Product_ID="+u:r==203?h+=" OR C_Project_ID="+u:r==539&&(h+=" OR A_Asset_ID="+u),s="SELECT Processed, COUNT(*) FROM R_Request WHERE "+h+" GROUP BY Processed ORDER BY Processed DESC",f=n.DB.executeReader(s,null),c=0,l=0;f.read();)"Y"==f.getString(0)?c=f.getString(1):l+=f.getString(1);p=t("<div>");e=t("<ul class=vis-apanel-rb-ul>");p.append(e);i=t("<li data-id='RequestCreate'>");i.append(n.Msg.getMsg("RequestNew"));i.on("click",function(n){a(n)});if(e.append(i),l>0){i=t("<li data-id='RequestActive'>");i.append(n.Msg.getMsg("RequestActive"));i.on("click",function(n){v(n)});e.append(i)}if(c>0){i=t("<li data-id='RequestActive'>");i.append(n.Msg.getMsg("RequestAll"));i.on("click",function(n){y(n)});e.append(i)}o.w2overlay(p.clone(!0),{css:{height:"200px"}})};var a=function(i){i.stopImmediatePropagation();c=n.viewManager.startWindow(l,null);c.onLoad=function(){var n=c.cPanel.curGC;n.onRowInserting=function(){c.cPanel.cmd_new(!1)};n.onRowInserted=function(){s=c.cPanel.curTab;s.setValue("AD_Table_ID",r);s.setValue("Record_ID",u);f!=null&&f>0&&s.setValue("C_BPartner_ID",f);r==291?s.setValue("C_BPartner_ID",u):r==114?s.setValue("AD_User_ID",u):r==203?s.setValue("C_Project_ID",u):r==539?s.setValue("A_Asset_ID",u):r==259?s.setValue("C_Order_ID",u):r==318?s.setValue("C_Invoice_ID",u):r==208?s.setValue("M_Product_ID",u):r==335?s.setValue("C_Payment_ID",u):r==319&&s.setValue("M_InOut_ID",u)}};var e=t("#w2ui-overlay");e.hide();e=null},v=function(i){var r,u;i.stopImmediatePropagation();r=new n.Query;r.addRestriction("("+h+") AND Processed='N'");n.viewManager.startWindow(l,r);u=t("#w2ui-overlay");u.hide();u=null},y=function(i){var r,u;i.stopImmediatePropagation();r=new n.Query;r.addRestriction(h);n.viewManager.startWindow(l,r);u=t("#w2ui-overlay");u.hide();u=null}}n.ARequest=i}(VIS,jQuery),function(n,t){function i(){var c=n.Application.contextFullUrl,i;if(c||(c=n.Application.contextUrl),c&&c.toString().toLowerCase().indexOf("softwareonthecloud.com")>-1){n.ADialog.info("VIS_GotoControlPanel",!0,"","");return}var l=t("<div style='height:100%'>"),ft=t("<div style='width:80%;height:100%;overflow:auto;' class='vis-pull-left'>"),rt=t("<div style='height:100%'>");l.append(rt);rt.append(ft);i=t("<div style='background-color: rgb(241, 241, 241);width:20%;height:100%;padding:15px;word-wrap: break-word;' class='vis-pull-right' >");rt.append(i);i.append(t('<h3 style="margin-top:5px;font-size: 16px;font-weight: 200px;color: #1b95d7;">').append(n.Msg.getMsg("Result")));var r=t("<div class='vis-apanel-busy' style='height:100%'>"),yt=n.Env.getWindowNo(),a=null,v=null,y=null,p=null,f=null,e=null,w=null,o=null,b=null,k=null,d=null,g=null,nt=null,s=null,ot=null,tt=null,it=null,ut=null,u=null,h=null,et=null;this.load=function(){var ui=t("<div class='vis-graywrap'>"),i,rt,ut,ot,vt,yt,pt,wt,bt,ri,u,kt,dt,gt,ni,ti,c,ii;ft.append(ui);i=t("<div class='initial-client-form'>");ui.append(i);i.append(t("<h3 class='VIS_Pref_change-pass' style='margin-left:15px;margin-right: 15px;'>").append(t("<label class='VIS_Pref_Label_Font' style='margin-top:0px'>").append(n.Msg.getMsg("TenantHeaderComment"))));rt=t("<div class='vis-intial-form-data'>");rt.append(t("<label>").append(n.Msg.translate(n.context,"AD_Client_ID")));a=t('<input type="text" name="tenant" placeholder="'+n.Msg.getMsg("Tenant")+'">');rt.append(a);i.append(rt);ut=t("<div class='vis-intial-form-data' >");ut.append(t("<label>").append(n.Msg.translate(n.context,"AD_Org_ID")));v=t('<input type="text" name="tenant" placeholder="'+n.Msg.getMsg("Org")+'">');ut.append(v);i.append(ut);ot=t("<div class='vis-intial-form-data'>");ot.append(t("<label>").append(n.Msg.parseTranslation(n.context,"@AD_User_ID@ @AD_Client_ID@")));y=t('<input type="text" name="tenant" placeholder="'+n.Msg.getMsg("TenantAdmin")+'">');ot.append(y);i.append(ot);vt=t("<div class='vis-intial-form-data' >");vt.append(t("<label>").append(n.Msg.parseTranslation(n.context,"@AD_User_ID@ @AD_Org_ID@")));p=t('<input type="text" name="tenant" placeholder="'+n.Msg.getMsg("TenantUser")+'">');vt.append(p);i.append(vt);yt=t("<div class='vis-intial-form-dataCombo'>");yt.append(t("<label>").append(n.Msg.translate(n.context,"C_Currency_ID")));f=t('<select placeholder="Currency">');yt.append(f);i.append(yt);pt=t("<div class='vis-intial-form-dataCombo'>");pt.append(t("<label>").append(n.Msg.translate(n.context,"C_Country_ID")));e=t('<select placeholder="Country">');pt.append(e);i.append(pt);wt=t("<div class='vis-intial-form-dataCombo'>");wt.append(t("<label>").append(n.Msg.translate(n.context,"City")));w=t('<input type="text" placeholder="'+n.Msg.getMsg("City")+'" style="width:100%;">');wt.append(w);i.append(wt);bt=t("<div class='vis-intial-form-dataCombo' >");bt.append(t("<label>").append(n.Msg.translate(n.context,"C_Region_ID")));o=t('<select placeholder="Region">');bt.append(o);i.append(bt);i.append(t('<div style="width:100%;float:left;">').append(t("<label  style='margin-right:15px;margin-left:15px;margin-top:10px;color: #499EDE;font-family: helvetica;font-weight: 400;font-size: 16px;' class='vis-pull-left'>").append(n.Msg.getMsg("Optional"))));ri=t('<div style="padding-left:15px;padding-right:15px;">');u=t("<div class='vis-intial-form-data' style='width: 100%;border:1px darkgrey solid;padding:10px;border-radius: 5px;margin-top:0px;'>");ri.append(u);i.append(ri);kt=t('<div class="vis-initial-form-checkbox" >');b=t('<input type="checkbox">');kt.append(b);kt.append(t("<label>").append(n.Msg.translate(n.context,"C_Project_ID")));u.append(kt);dt=t('<div class="vis-initial-form-checkbox">');k=t('<input type="checkbox">');dt.append(k);dt.append(t("<label>").append(n.Msg.translate(n.context,"C_SalesRegion_ID")));u.append(dt);gt=t('<div class="vis-initial-form-checkbox">');d=t('<input type="checkbox" checked disabled>');gt.append(d);gt.append(t("<label>").append(n.Msg.translate(n.context,"M_Product_ID")));u.append(gt);ni=t('<div class="vis-initial-form-checkbox">');g=t('<input type="checkbox">');ni.append(g);ni.append(t("<label>").append(n.Msg.translate(n.context,"C_Campaign_ID")));u.append(ni);ti=t('<div class="vis-initial-form-checkbox">');nt=t('<input type="checkbox" checked disabled>');ti.append(nt);ti.append(t("<label>").append(n.Msg.translate(n.context,"C_BPartner_ID")));u.append(ti);c=t("<div class='vis-initial-btn-left vis-pull-right'>");i.append(c);ii=t('<div style="display: inline;">');c.append(ii);h=t('<input type="checkbox" style="margin-right: 5px;margin-left: 10px;margin-top: 5px;">');h.prop("checked",!0);h.on("click",function(){h.prop("checked")?s.css("display","none"):s.css("display","initial")});ii.append(h);et=t("<label style='margin-right: 10px;font-size: 14px;color: #666;font-weight: normal;'>").append(n.Msg.getMsg("UseDefault"));ii.append(et);s=t("<a class='vis-initial-btn vis-initial-btn-blue' style='margin-right:10px;display:none;'>").append(n.Msg.getMsg("LoadAccountingValues"));s.on("click",function(){it.trigger("click")});c.append(s);it=t("<input type='file' style='display:none;' accept='.csv*'>");it.change(function(){lt(this)});c.append(it);tt=t("<a class='vis-initial-btn' style='margin-right: 15px;'>").append(n.Msg.getMsg("Done"));tt.on("click",function(){at()});c.append(tt);l.append(r);r[0].style.visibility="visible";t.ajax({url:n.Application.contextUrl+"VSetup/GetInitialData",dataType:"json",error:function(){alert(n.Msg.getMsg("ERRORGettingInitialData"));r[0].style.visibility="hidden"},success:function(t){var i=t.result;if(i==null){alert(n.Msg.getMsg("ERRORGettingInitialData"));r[0].style.visibility="hidden";return}st(i.currency);ht(i.country);ct(i.region);r[0].style.visibility="hidden"}})};var st=function(n){if(n!=null)for(var i in n)f.append(t('<option value="'+n[i].ID+'">').append(n[i].Name))},ht=function(n){if(n!=null)for(var i in n)e.append(t('<option value="'+n[i].ID+'">').append(n[i].Name))},ct=function(n){if(n!=null)for(var i in n)o.append(t('<option value="'+n[i].ID+'">').append(n[i].Name))},lt=function(t){u=t.files[0].name;r[0].style.visibility="visible";window.setTimeout(function(){ut=Date.now().toString();var i=new XMLHttpRequest,f=new FormData;f.append("file",t.files[0]);i.open("POST",n.Application.contextUrl+"Attachment/SaveFileinTemp/?filename="+u+"&folderKey="+ut,!1);i.send(f);r[0].style.visibility="hidden"},2)},at=function(){var s,c,l,tt,it,ot,rt,st,ft,ht,et;if(i.empty(),s=a.val(),s==null||s.length==0||s.trim().length==0){alert(n.Msg.getMsg("FillTenantName"));return}if(c=v.val(),c==null||c.length==0||c.trim().length==0){alert(n.Msg.getMsg("FillOrgName"));return}if(l=y.val(),l==null||l.length==0||l.trim().length==0){alert(n.Msg.getMsg("FillUserClient"));return}if(tt=p.val(),tt==null||tt.length==0||tt.trim().length==0){alert(n.Msg.getMsg("FillUserOrg"));return}if(it=w.val(),it==null||it.length==0||it.trim().length==0){alert(n.Msg.getMsg("FillCity"));return}if(ot=f.val(),rt=f.find("option:selected").text(),rt==null||rt.length==0||rt.trim().length==0){alert(n.Msg.getMsg("FillCurrency"));return}if(st=e.val(),ft=e.find("option:selected").text(),ft==null||ft.length==0||ft.trim().length==0){alert(n.Msg.getMsg("FillCountry"));return}if(ht=o.val(),et=o.find("option:selected").text(),et==null||et.length==0||et.trim().length==0){alert(n.Msg.getMsg("FillRegion"));return}if(h.prop("checked"))u=null;else if(u==null||u.length==0||u.trim().length==0){alert(n.Msg.getMsg("SelectFile"));return}var ct=d.prop("checked"),lt=nt.prop("checked"),at=b.prop("checked"),yt=g.prop("checked"),pt=k.prop("checked");r[0].style.visibility="visible";t.ajax({url:n.Application.contextUrl+"VSetup/InitailizeClientSetup",type:"POST",dataType:"json",data:{clientName:s,orgName:c,userClient:l,userOrg:tt,city:it,currencyID:ot,currencyName:rt,countryID:st,countryName:ft,regionID:ht,regionName:et,cfProduct:ct,cfBPartner:lt,cfProject:at,cfMCampaign:yt,cfSRegion:pt,fileName:u,folderKey:ut},error:function(){n.ADialog.error("ErrorCreatingTenant");r[0].style.visibility="hidden"},success:function(n){var t=n.result;r[0].style.visibility="hidden";vt(t)}})},vt=function(r){r.Log!=null&&r.Log.trim().length>0&&(i.append(t('<div style="margin-bottom:10px">').append(" Error - "+r.Log)),i.append(t('<div style="margin-bottom:10px">').append(n.Msg.getMsg("VIS_TenantErrorMsg"))));i.append(t('<div style="margin-bottom:10px">').append(" Tenant Name - "+r.TenantName));i.append(t('<div style="margin-bottom:10px">').append(" Organization Name - "+r.OrgName));i.append(t('<div style="margin-bottom:10px">').append(" Admin Role - "+r.AdminRole));i.append(t('<div style="margin-bottom:10px">').append(" User Role - "+r.UserRole));i.append(t('<div style="margin-bottom:10px">').append(" Admin Username - "+r.AdminUser));i.append(t('<div style="margin-bottom:10px">').append(" Admin User Password - "+r.AdminUserPwd));i.append(t('<div style="margin-bottom:10px">').append(" Org Username - "+r.OrgUser));i.append(t('<div style="margin-bottom:10px">').append(" Org User Password - "+r.OrgUserPwd));var u=n.Application.isRTL?t('<a href="javascript:void(o)" style="float:left;" class="vis-initial-btn vis-initial-btn-blue">').append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/Save24.png'>")):t('<a href="javascript:void(o)" style="float:right;" class="vis-initial-btn vis-initial-btn-blue">').append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/Save24.png'>"));u.on("click",function(){var n="",i,u;n+=" Tenant Name - "+r.TenantName+"\t\n";n+=" Organization Name - "+r.OrgName+"\t\n";n+=" Admin Role - "+r.AdminRole+"\t\n";n+=" User Role - "+r.UserRole+"\t\n";n+=" Admin Username - "+r.AdminUser+"\t\n";n+=" Admin User Password - "+r.AdminUserPwd+"\t\n";n+=" Org Username - "+r.OrgUser+"\t\n";n+=" Org User Password - "+r.OrgUserPwd+"\t\n";i=(new Date).toISOString().slice(0,19).replace(/-/g,"");u="data:text/csv;base64,"+window.btoa(n);t(this).attr("href",u).attr("download","file-"+i+".txt");divLog.dialog("close");divLog=null});i.append(u)};this.disposeComponent=function(){a=null;v=null;y=null;p=null;f=null;e=null;w=null;o=null;b=null;k=null;d=null;g=null;nt=null;s=null;ot=null;tt=null;r=null;l=null};this.getRoot=function(){return l}}n.Apps=n.Apps||{};n.Apps.AForms=n.Apps.AForms||{};i.prototype.sizeChanged=function(){};i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.load();this.frame.getContentGrid().append(this.getRoot())};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VSetup=i}(VIS,jQuery),function(n,t){function i(){function s(o){e=o;u=e.find("#vis_favScroll");h();f=t("#userFav-Tab");i=t('<ul class="vis-userFavourites-ListMenu">');i.on("click",function(u){var f=t(u.target),e;f.data("btn")=="action"?n.viewManager.startAction(f.data("action"),f.data("id")):f.data("btn")=="zoom"?n.viewManager.startActionInNewTab(f.data("action"),f.data("id")):f.data("btn")=="remove"&&(a(f.data("id")),e=t(f).parent().parent(),e.empty(),e.remove(),r(i.find("li").length))})}function h(){t.ajax({url:n.Application.contextUrl+"Home/GetFavouriteNode",dataType:"json",error:function(){alert(n.Msg.getMsg("ERRORGetFavouriteNode"))},success:function(n){if(u.empty(),n.result)for(var t=0,f=n.result.length;t<f;t++)o(n.result[t]);r(i.find("li").length);u.append(i)}})}function c(n){o(n);r(i.find("li").length)}function o(r){var f,u,e,c,l,o,h,s;i!=null&&(f=t('<li data-nodeid="'+r.NodeID+'" >'),u=0,r.Action=="W"?u=r.WindowID:r.Action=="X"?u=r.FormID:r.Action=="P"?u=r.ProcessID:r.Action=="R"&&(u=r.ProcessID),e=t('<a href="#" data-id="'+u+'" data-action="'+r.Action+'" data-nodeid="'+r.NodeID+'" data-btn="action" style="overflow: auto;width: 100%;height: 100%;padding-top: 17px;" >'),c=t("<a data-id='"+u+"' data-action='"+r.Action+"' data-btn='zoom' style='height: 25px;width: 25px;float: right;margin-top: -17px;margin-right: -10px;'>").append(t("<img data-id='"+u+"' data-action='"+r.Action+"' data-btn='zoom' src='"+n.Application.contextUrl+"Areas/VIS/Images/zoomfav.png' >")),f.append(c),l=t("<a data-id='"+r.NodeID+"'  data-btn='remove' style='height: 25px;width: 25px;float: right;margin-top: -16px;'>").append(t("<img data-id='"+r.NodeID+"'  data-btn='remove' src='"+n.Application.contextUrl+"Areas/VIS/Images/removefav.png' >")),f.append(l),f.append(e),o=r.Name,o.length>27?(o=o.substr(0,27),e.append(o),h=t("<a href='#' class='VIS_Pref_tooltip' style='display: inline-block;'>").append("..."),s=t("<span style='width: inherit;'>"),s.append(t("<img class='VIS_Pref_callout'>").attr("src",n.Application.contextUrl+"Areas/VIS/Images/ccc.png").append("ToolTip Text")),s.append(t("<label class='VIS_Pref_Label_Font'>").append(r.Name)),h.append(s),e.append(h)):e.append(r.Name),i.append(f))}function l(n){var f,u,e,o;if(i!=null){for(f=i.find("li"),u=null,e=0,o=f.length;e<o;e++)u=t(f[e]),u.data("nodeid")===n&&u.remove();f=u=null;r(i.find("li").length)}}function a(i){n.FavouriteHelper.removeFavourite(i);t.ajax({url:n.Application.contextUrl+"Home/RemoveNodeFavourite/?nodeID="+i,dataType:"json"})}function r(t){f.empty();f.html("<span class='favouritesIcons icon-favourite' /><span class='favouriteTabLabel-Large'>"+n.Msg.getMsg("Favourites")+" - <\/span><strong>"+t+"<\/strong>")}var e,u,i,f;return{init:s,addFavourite:c,removeFavourite:l}}n.favMgr=i()}(VIS,jQuery),function(n,t){function h(i,r){var u=null,f="";url=n.Application.contextUrl+"WSP/Contacts/GetBPLocation?WinNo="+r.windowNo+"&bpartnerID="+i;t.ajax({type:"GET",async:!1,url:url,dataType:"json",success:function(n){u=JSON.parse(n);for(var t=0;t<u.lstBPLocation.length;t++)f+="<option value='"+u.lstBPLocation[t].ID+"'>"+u.lstBPLocation[t].Name+"<\/option>";o.empty();o.append(f)}})}function c(t,i,r,f,e,o){u=new n.ChildDialog;u.setContent(t);i=="Customer"?u.setTitle(n.Msg.getMsg("Customer")):i=="Employee"?u.setTitle(n.Msg.getMsg("Employee")):i=="Vendor"?u.setTitle(n.Msg.getMsg("Vendor")):i=="Prospect"&&u.setTitle(n.Msg.getMsg("Prospect"));u.setEnableResize(!1);u.setModal(!0);u.show();l(e,i,o);r.on("change",function(){h(r.val(),f)})}function l(e,o,s){u.onOkClick=function(){var l=t("#divBPartner_"+i.windowNo).find("img"),rt=t(window).height()*(50/100),ut=t(window).width()*(50/100),u;e.css("margin-top",rt);e.css("margin-left",ut);s.show();l.css("visibility","visible");var h=t("#txtName_"+i.windowNo).val(),c=t("#txtSearchKey_"+i.windowNo).val(),a=t("#ddlGreeting1_"+i.windowNo).val(),ft=t("#txtName2_"+i.windowNo).val(),v=t("#ddlBPGroup_"+i.windowNo).val(),y=t("#ddlBPRelation_"+i.windowNo).val(),p=t("#ddlBPLoaction_"+i.windowNo).val(),w=t("#txtContact_"+i.windowNo).val(),b=t("#ddlGreeting_"+i.windowNo).val(),k=t("#txtTitle_"+i.windowNo).val(),d=t("#txtEmail_"+i.windowNo).val(),g=r.getValue(),nt=t("#txtPhone_"+i.windowNo).val(),tt=t("#txtPhone2_"+i.windowNo).val(),it=t("#txtFax_"+i.windowNo).val();if(h.trim()==""||c.trim()==""){alert(n.Msg.getMsg("NameMandatory"));s.hide();l.css("visibility","collapse");return}u=null;o=="Customer"?u=n.Msg.getMsg("Customer"):o=="Employee"?u=n.Msg.getMsg("Employee"):o=="Vendor"?u=n.Msg.getMsg("Vendor"):o=="Prospect"&&(u=n.Msg.getMsg("Prospect"));url=n.Application.contextUrl+"WSP/Contacts/AddBPartnerInfo";v=="0"&&(v=undefined);y=="0"&&(y=undefined);p=="0"&&(p=undefined);b=="0"&&(b=undefined);a=="0"&&(a=undefined);g==null&&(g=undefined);nt==""&&(nt=undefined);tt==""&&(tt=undefined);w==""&&(w=undefined);h==null&&(h=undefined);it==""&&(it=undefined);c==""&&(c=undefined);k==""&&(k=undefined);d==""&&(d=undefined);u==""&&(u=undefined);t.ajax({type:"Post",async:!1,url:url,dataType:"json",data:{searchKey:c,name:h,name2:ft,greeting:b,bpGroup:v,bpRelation:y,bpLocation:p,contact:w,greeting1:a,title:k,email:d,address:g,phoneNo:nt,phoneNo2:tt,fax:it,windowNo:i.windowNo,BPtype:u},success:function(n){s.hide();l.css("visibility","collapse");alert(n);f.empty()}})}}function a(i,u,o,s,h,l,a){var y=null,p="",w="",b="",k="",g=new n.MLocationLookup(n.context.ctx,i.windowNo),nt,d;r=new n.Controls.VLocation("C_Location_ID",!0,!1,!0,n.DisplayType.Location,g);nt=r.getBtnCount();f=t("<div id='divBPartner_"+i.windowNo+"' style='width:auto;height:auto;margin-right:5px'> <img src='/ViennaAdvantageWeb1/Areas/VIS/Images/busy.gif' style=' margin-top: 120px; margin-left: 327px; z-index:9999;position:absolute;visibility:collapse'>");d=n.Application.contextUrl+"WSP/Contacts/AddBusinessPartner?WinNo="+i.windowNo+"&UserID="+u;t.ajax({type:"GET",async:!1,url:d,dataType:"json",success:function(n){for(var i=JSON.parse(n),t=0;t<i.lstGreeting.length;t++)p+="<option value='"+i.lstGreeting[t].ID+"'>"+i.lstGreeting[t].Name+"<\/option>";for(t=0;t<i.lstBPGroup.length;t++)w+="<option value='"+i.lstBPGroup[t].ID+"'>"+i.lstBPGroup[t].Name+"<\/option>";for(t=0;t<i.lstBPRelation.length;t++)b+="<option value='"+i.lstBPRelation[t].ID+"'>"+i.lstBPRelation[t].Name+"<\/option>";for(t=0;t<i.lstBPLocation.length;t++)k+="<option value='"+i.lstBPLocation[t].ID+"'>"+i.lstBPLocation[t].Name+"<\/option>";y=v(p,w,k,b,o,s)}});f.append(y);f.load();c(f,h,e,i,l,a)}function v(u,f,c,l,a,v){var y=t("<table id='tableBPartner_"+i.windowNo+"'><tr><td><div style='margin-top: 0px; float: right' class='wsp-BPartner'>"+n.Msg.getMsg("SearchKey")+" <\/div><\/td><td style='width:300px'><div style='margin-top: 0px;width:100%' class='wsp-BPartner'><input id='txtSearchKey_"+i.windowNo+"' style='height: 25px;width:100%' type='text'><\/div><\/td><td style='width:50px'><\/td> <td style='margin-left:10px'><div style='margin-top: 0px; float: right;margin-right: 5px' class='wsp-BPartner'>"+n.Msg.getMsg("Greeting")+"  <\/div><\/td><td style='width:300px'><div style='margin-top: 0px;margin-right:5px' class='wsp-BPartner'><select id='ddlGreeting1_"+i.windowNo+"' style='width:100%'>"+u+"<\/select><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>"+n.Msg.getMsg("Name")+"  <\/div><\/td><td style='width:300px'><div style='width:100%' class='wsp-BPartner'><input id='txtName_"+i.windowNo+"' style='height: 25px;width:100%' type='text'><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>"+n.Msg.getMsg("Name2")+"  <\/div><\/td><td style='width:300px'><div style='width:100%' class='wsp-BPartner'><input id='txtName2_"+i.windowNo+"' style='height: 25px;width:100%' type='text'><\/div><\/td><td style='width:50px'> <\/td> <td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>"+n.Msg.getMsg("BPGroup")+"  <\/div><\/td><td style='width:300px'><div style='margin-right: 5px' class='wsp-BPartner'><select id='ddlBPGroup_"+i.windowNo+"' style='width: 100%'>"+f+"<\/select><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>"+n.Msg.getMsg("BPRelation")+"  <\/div><\/td><td style='width:300px'><div style='width:100%' class='wsp-BPartner'><select style='width:100%' id='ddlBPRelation_"+i.windowNo+"' >"+l+"<\/select><\/div><\/td> <td style='width:50px'><\/td><td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>"+n.Msg.getMsg("BPLoaction")+"  <\/div><\/td><td style='width:300px'><div  class='wsp-BPartner' style='margin-right: 5px'><select id='ddlBPLoaction_"+i.windowNo+"' style='width:100%'><\/select><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>"+n.Msg.getMsg("Contact")+"  <\/div><\/td><td style='width:300px'><div style='width:100%' class='wsp-BPartner'><input id='txtContact_"+i.windowNo+"' style='height: 25px;width:100%' type='text'><\/div><\/td> <td style='width:50px'><\/td><td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>"+n.Msg.getMsg("Greeting")+"  <\/div><\/td><td style='width:300px'><div  class='wsp-BPartner' style='margin-right: 5px'><select id='ddlGreeting_"+i.windowNo+"' style='width: 100%'>"+u+"<\/select><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>"+n.Msg.getMsg("Title")+"  <\/div><\/td><td style='width:300px'><div style='width:100%' class='wsp-BPartner'><input id='txtTitle_"+i.windowNo+"' style='height: 25px;width:100%' type='text'><\/div><\/td> <td style='width:50px'><\/td><td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>"+n.Msg.getMsg("EmailAddress")+"  <\/div><\/td><td style='width:300px'><div  class='wsp-BPartner' style='margin-right: 5px'><input id='txtEmail_"+i.windowNo+"' style='height: 25px;width:100%' type='text'><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>"+n.Msg.getMsg("Address")+"  <\/div><\/td><td style='width:300px'><div style='width:100%' id='divAddress_"+i.windowNo+"' class='wsp-BPartner' ><\/div> <\/td> <td style='width:50px'><\/td><td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>"+n.Msg.getMsg("Phone")+"  <\/div><\/td><td style='width:300px'><div  class='wsp-BPartner' style='margin-right: 5px'><input id='txtPhone_"+i.windowNo+"' style='height: 25px;width:100%' type='text'><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>"+n.Msg.getMsg("2ndPhone")+"  <\/div><\/td><td style='width:300px'><div class='wsp-BPartner' style='width:100%;'><input id='txtPhone2_"+i.windowNo+"' style='height: 25px;width:100%' type='text'><\/div><\/td> <td style='width:50px'><\/td><td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>"+n.Msg.getMsg("Fax")+"  <\/div><\/td><td style='width:300px' ><div style='margin-bottom:7px;margin-right: 5px' class='wsp-BPartner' ><input id='txtFax_"+i.windowNo+"' style='height: 25px;width:100%;' type='text'><\/div><\/td><\/tr><\/table>"),p=y.find("#divAddress_"+i.windowNo);return y.find("#ddlBPRelation_"+i.windowNo).val(a),e=y.find("#ddlBPRelation_"+i.windowNo),o=y.find("#ddlBPLoaction_"+i.windowNo),s=y.find("#ddlBPGroup_"+i.windowNo).val(v),h(a,i),r.getBtn(0).css("width","10%"),r.getBtn(0).css("height","10%"),r.getBtn(0).css("padding","0px"),r.getBtn(1).css("width","10%"),r.getBtn(1).css("height","10%"),r.getBtn(1).css("padding","0px"),p.append(r.getControl().css("width","80%")).append(r.getBtn(0)).append(r.getBtn(1)),y}var u=null,f=null,i=null,r=null,e=null,o=null,s=null;n.BPartner=function(n,t,r,u,e,o,s){f!=null&&f.empty();i=n;a(i,t,r,u,e,o,s)};n.AddUpdateBPartner=function(i,h,c,l,a,v){function ni(n,t,i){ti(n,t,i)}function ti(i,e,o){var s=null,h="",c="",l="",v="",p=new n.MLocationLookup(n.context.ctx,i),w,a;r=new n.Controls.VLocation("C_Location_ID",!0,!1,!0,n.DisplayType.Location,p);w=r.getBtnCount();f=t("<div id='divBPartner_"+i+"' style='width:auto;height:auto;margin-right:5px'> <img src='/ViennaAdvantageWeb1/Areas/VIS/Images/busy.gif' style=' margin-top: 120px; margin-left: 327px; z-index:9999;position:absolute;visibility:collapse'>");fi(f,i,e,o);a=n.Application.contextUrl+"BPartner/InitBP?WinNo="+i+"&bPartnerID="+e+"&bpType="+o;t.ajax({type:"GET",async:!1,url:a,dataType:"json",success:function(t){for(var u=JSON.parse(t),r=0;r<u.lstGreeting.length;r++)h+="<option value='"+u.lstGreeting[r].ID+"'>"+n.Utility.encodeText(u.lstGreeting[r].Name)+"<\/option>";for(r=0;r<u.lstBPGroup.length;r++)c+="<option value='"+u.lstBPGroup[r].ID+"'>"+n.Utility.encodeText(u.lstBPGroup[r].Name)+"<\/option>";for(r=0;r<u.lstBPRelation.length;r++)l+="<option value='"+u.lstBPRelation[r].ID+"'>"+n.Utility.encodeText(u.lstBPRelation[r].Name)+"<\/option>";s=ii(i,e,o,u,h,c,v,l)}});window.setTimeout(function(){u!=null&&(f.append(s),f.load(),t(".vis-apanel-busy").css("visibility","hidden"),t(".vis-apanel-busy").css("height","460px"),t(".vis-apanel-busy").css("z-index","99"),y!=null&&y.hide())},500)}function ii(i,u,f,h,c,l){var a=t("<DIV class='vis-MainDivBPartnerPopUp'><DIV class='vis-DivBPartnerLeft' ><DIV class='vis-FirstDivBPartnerPopUp' > <\/DIV>"+bt("50%","Phone Number",5)+bt("50%","Internet",100)+"<DIV class='vis-SecondDivBPartnerPopUp'> <\/DIV>"+bt("100%","Address",5)+"<DIV class='vis-ThirdDivBPartnerPopUp'> <\/DIV> <\/DIV><DIV class='vis-FourthDivBPartnerPopUp'> <\/DIV> <\/DIV>"),v;a.find(".vis-FirstDivBPartnerPopUp").append("<DIV class='vis-FirstDivCotrol' ><\/DIV>");a.find(".vis-FirstDivBPartnerPopUp").append("<DIV class='vis-DivBPartnerRight' > <\/DIV>");a.find(".vis-SecondDivBPartnerPopUp").append("<DIV class='vis-SecondDivCotrol' ><\/DIV> ");a.find(".vis-SecondDivBPartnerPopUp").append("<DIV class='vis-SecondDivImgCotrol'><\/DIV> ");a.find(".vis-ThirdDivBPartnerPopUp").append("<DIV class='vis-ThirdDivCotrol' ><\/DIV>");a.find(".vis-FourthDivBPartnerPopUp").append("<DIV class='vis-FourthDivHeader' > "+n.Msg.getMsg("BPType")+" <\/DIV> <DIV class='vis-FourthDivControl'><\/DIV>");a.find(".vis-DivBPartnerRight").append("<div class='image-upload' style='float: right; position: absolute; z-index: 999; top:31px;overflow:hidden;right:0'><label for='file-input' class='vis-file-label-bp'><span style='margin-right:8px' class='vis-change-picture-ico'><\/span><\/label><input type='file' id='VISFileDialog_"+i+"' accept='image/*' class='wsp-file-input' value='Add Pic' style='opacity: 0; width: 100%; margin-top: 0px; float: right; z-index: 999; position: absolute; right: 0px; cursor: pointer;'><\/div>");a.find(".vis-DivBPartnerRight").append("<DIV class='vis-FirstDivImgCotrol'><\/DIV>");a.find(".vis-FirstDivCotrol").append("<DIV class='vis-FirstDivCotrolChild'> <div class='vis-all-lable'>"+n.Msg.getMsg("SearchKeyValue")+"  <\/div> <div class='vis-all-control'><input class='vis-gc-vpanel-table-mandatory'  id='txtSearchKey_"+i+"' style='height: 25px;width:100%' type='text'><\/div><\/DIV>");a.find(".vis-FirstDivCotrol").append("<DIV class='vis-FirstDivCotrolChild'> <div class='vis-all-lable'>"+n.Msg.getMsg("Greeting")+"  <\/div> <div class='vis-all-control'><select id='ddlGreeting_"+i+"' style='width: 100%'>"+c+"<\/select><\/div><\/DIV>");a.find(".vis-FirstDivCotrol").append("<DIV class='vis-FirstDivCotrolChild'> <div class='vis-all-lable'>"+n.Msg.getMsg("ContactName")+"  <\/div> <div class='vis-all-control'><input class='vis-gc-vpanel-table-mandatory' id='txtContact_"+i+"' style='height: 25px;width:100%' type='text'> <\/div><\/DIV>");a.find(".vis-FirstDivCotrol").append("<DIV class='vis-FirstDivCotrolChild'> <div class='vis-all-lable'>"+n.Msg.getMsg("CompanyName")+"  <\/div> <div class='vis-all-control'><input class='vis-gc-vpanel-table-mandatory' id='txtName_"+i+"' style='height: 25px;width:100%' type='text'> <\/div><\/DIV>");a.find(".vis-FirstDivCotrol").append("<DIV class='vis-FirstDivCotrolChild'> <div class='vis-all-lable'>"+n.Msg.getMsg("BusinessPartnerGroup")+"  <\/div> <div class='vis-all-control'><select class='vis-gc-vpanel-table-mandatory' id='ddlBPGroup_"+i+"' style='width: 100%;float:left'>"+l+"<\/select> <\/div><\/DIV>");a.find(".vis-FirstDivImgCotrol").append("<DIV class='vis-FirstDivCotrolChild' >  <div style='float: left;width:320px;height:242px;line-height:236px;background: none repeat scroll 0% 0% #EEE;padding:0px;text-align:center;margin-top:20px' ><img id='imgBPartner_"+i+"' /><\/div> ");a.find(".vis-SecondDivCotrol").append("<DIV class='vis-SecondDivCotrolChild'> <div class='vis-all-lable'>"+n.Msg.getMsg("Phone")+"  <\/div> <div class='vis-all-control'><input id='txtPhone_"+i+"' style='height: 25px;width:100%' type='text'><\/div><\/DIV>");a.find(".vis-SecondDivCotrol").append("<DIV class='vis-SecondDivCotrolChild'> <div class='vis-all-lable'>"+n.Msg.getMsg("Mobile")+"  <\/div> <div class='vis-all-control'><input id='txtMobile_"+i+"' style='height: 25px;width:100%' type='text'><\/div><\/DIV>");a.find(".vis-SecondDivCotrol").append("<DIV class='vis-SecondDivCotrolChild'> <div class='vis-all-lable'>"+n.Msg.getMsg("Fax")+"  <\/div> <div class='vis-all-control'><input id='txtFax_"+i+"' style='height: 25px;width:100%;' type='text'> <\/div><\/DIV>");a.find(".vis-SecondDivImgCotrol").append("<DIV class='vis-SecondDivCotrolChild' > <div class='vis-all-lable'>"+n.Msg.getMsg("EmailAddress")+"  <\/div> <div class='vis-all-control'><input id='txtEmail_"+i+"' style='height: 25px;width:100%' type='text'> <\/div><\/DIV>");a.find(".vis-SecondDivImgCotrol").append("<DIV class='vis-SecondDivCotrolChild' > <div class='vis-all-lable'>"+n.Msg.getMsg("WebUrl")+"  <\/div> <div class='vis-all-control'><input id='txtWebUrl_"+i+"' style='height: 25px;width:100%' type='text'> <\/div><\/DIV>");a.find(".vis-ThirdDivCotrol").append("<DIV class='vis-ThirdDivCotrolChild'> <div class='vis-all-lable'>"+n.Msg.getMsg("Address")+"  <\/div> <div id='divAddress_"+i+"' class='vis-all-control'><\/div><\/DIV>");a.find(".vis-FourthDivControl").append("<DIV style='float: left;width:33%'> <div style='float: left;width:100%' class='wsp-BPartner'><input id='chkCustomer_"+i+"' type='checkbox'> "+n.Msg.getMsg("Customer")+"<\/div><\/DIV>");a.find(".vis-FourthDivControl").append("<DIV style='float: left;width:33%'> <div style='float: left;width:100%' class='wsp-BPartner'><input id='chkVendor_"+i+"' type='checkbox'>  "+n.Msg.getMsg("Vendor")+" <\/div><\/DIV>");a.find(".vis-FourthDivControl").append("<DIV style='float: left;width:33%'> <div style='float: left;width:100%' class='wsp-BPartner'><input id='chkProspect_"+i+"' type='checkbox'> "+n.Msg.getMsg("Prospect")+"<\/div><\/DIV>");v=a.find("#divAddress_"+i);e=a.find("#ddlBPRelation_"+i);o=a.find("#ddlBPLoaction_"+i);s=a.find("#ddlBPGroup_"+i);p=a.find("#txtName_"+i);w=a.find("#txtSearchKey_"+i);d=a.find("#ddlGreeting1_"+i);ot=a.find("#txtName2_"+i);b=a.find("#txtContact_"+i);k=a.find("#ddlGreeting_"+i);g=a.find("#txtTitle_"+i);tt=a.find("#txtEmail_"+i);nt=a.find("#txtPhone_"+i);st=a.find("#txtPhone2_"+i);it=a.find("#txtFax_"+i);ft=a.find("#chkCustomer_"+i);et=a.find("#chkVendor_"+i);at=a.find("#chkProspect_"+i);r.setValue(h.location);vt=a.find("#VISFileDialog_"+i);yt=a.find("#imgBPartner_"+i);pt=a.find("#txtMobile_"+i);wt=a.find("#txtWebUrl_"+i);ri();u>0?(e.val(h.bpRelationID),s.val(h.bpGroupID),o.val(h.bpLocationID),p.val(n.Utility.decodeText(h.name)),w.val(n.Utility.decodeText(h.searchKey)),d.val(),ot.val(n.Utility.decodeText(h.name2)),yt.removeAttr("src").attr("src",h.userImage),b.val(n.Utility.decodeText(h.contact)),k.val(),g.val(n.Utility.decodeText(h.title)),tt.val(n.Utility.decodeText(h.email)),nt.val(n.Utility.decodeText(h.phoneNo)),st.val(n.Utility.decodeText(h.phoneNo2)),it.val(n.Utility.decodeText(h.fax)),k.val(h.greeting),d.val(h.greeting1),r.setValue(h.location),pt.val(h.mobile),wt.val(h.WebUrl),h.isCustomer&&ft.attr("checked","checked"),h.isVendor&&et.attr("checked","checked"),kt(e.val(),i,h.bpLocationID)):ct>0&&lt>0&&(a.find("#ddlBPRelation_"+i).val(ct),a.find("#ddlBPGroup_"+i).val(lt),kt(e.val(),i,h.bpLocationID));r.getBtn(0).css("width","10%");r.getBtn(0).css("height","30px");r.getBtn(0).css("padding","0px");r.getBtn(1).css("width","10%");r.getBtn(1).css("height","30px");r.getBtn(1).css("padding","0px");v.append(r.getControl().css("width","80%")).append(r.getBtn(0)).append(r.getBtn(1));rt=a.find("#divAddress_"+i).find("Input");ht=a.find("#divAddress_"+i).find("Button").eq(1);ei(i,f,u);e.on("change",function(){kt(e.val(),i)});w.on("focusout",function(){w.val()==""?t("#divSearchKey").css("visibility","visible"):t("#divSearchKey").css("visibility","collapse ")});p.on("focusout",function(){p.val()==""?t("#divName").css("visibility","visible"):t("#divName").css("visibility","collapse")});s.on("focusout",function(){s.val()=="0"||s.val()==""?t("#divBPGroup").css("visibility","visible"):t("#divBPGroup").css("visibility","collapse ")});rt.on("focusout",function(){r.getValue()<=0?t("#divAddressValidate_"+i).css("visibility","visible"):t("#divAddressValidate_"+i).css("visibility","collapse ")});ht.on("focusout",function(){r.getValue()<=0?t("#divAddressValidate_"+i).css("visibility","visible"):t("#divAddressValidate_"+i).css("visibility","collapse ")});b.on("focusout",function(){b.val()==""?t("#divContact_"+i).css("visibility","visible"):t("#divContact_"+i).css("visibility","collapse")});return a}function bt(n,t,i){return"<DIV class='vis-BPsplitter' style='width:"+n+"'><span style='background-color: white; position: relative;top: -0.8em;margin-left: "+i+"px;'> "+t+" <\/span><\/DIV>"}function ri(){vt.on("change",function(){gt=Date.now().toString();var t=new XMLHttpRequest,i=new FormData;i.append("file",vt[0].files[0]);i.append("fileKey",gt);t.open("POST",n.Application.contextUrl+"BPartner/SaveImageAsByte",!0);t.setRequestHeader("Cache-Control","no-cache");t.setRequestHeader("Pragma","no-cache");t.send(i);t.addEventListener("load",function(n){var i=n.target.response,r=JSON.parse(i),t=JSON.parse(r);yt.removeAttr("src").attr("src","data:image/jpg;base64,"+t[0]);dt=t[1]},!1)})}function ui(){w.off("focusout");p.off("focusout");s.off("focusout");rt.off("focusout");ht.off("focusout");b.off("focusout");r.dispose();r=null;p=null;ot=null;rt=null;b=null;tt=null;it=null;k=null;d=null;nt=null;st=null;w=null;g=null;c=null;f.remove();f.empty()}function fi(t){u=new n.ChildDialog;u.setContent(t);u.onClose=function(){ui()};u.setWidth(870);u.setHeight(620);u.setTitle(n.Msg.getMsg("BusinessPartner"));u.setEnableResize(!1);u.setModal(!0);u.show();u.getRoot().dialog({position:[200,130]})}function ei(i,f,h){u.onOkClick=function(){var l,a,u;if(y!=null?(y.show(),l=t(window).height()*(50/100),a=t(window).width()*(50/100)):t(".vis-apanel-busy").css("visibility","visible"),ut=r.getValue(),w.val().trim()=="")return alert(n.Msg.getMsg("SearchkeyMandatory")),y!=null&&y.hide(),t(".vis-apanel-busy").css("visibility","hidden"),!1;if(p.val().trim()=="")return alert(n.Msg.getMsg("NameMandatory")),y!=null&&y.hide(),t(".vis-apanel-busy").css("visibility","hidden"),!1;if(s.val().trim()=="0")return alert(n.Msg.getMsg("BPGroupMandatory")),y!=null&&y.hide(),t(".vis-apanel-busy").css("visibility","hidden"),!1;if(b.val().trim()=="")return alert(n.Msg.getMsg("ContactMandatory")),y!=null&&y.hide(),t(".vis-apanel-busy").css("visibility","hidden"),!1;if(ut<=0||ut==null)return alert(n.Msg.getMsg("AddressMandatory")),y!=null&&y.hide(),t(".vis-apanel-busy").css("visibility","hidden"),!1;if(ft.is(":checked")==!1&&et.is(":checked")==!1&&at.is(":checked")==!1)return alert(n.Msg.getMsg("PleaseSelectBusinessType")),y!=null&&y.hide(),t(".vis-apanel-busy").css("visibility","hidden"),!1;u=null;u=f;url=n.Application.contextUrl+"BPartner/AddBPartnerInfo";var v=w.val(),rt=p.val(),ot=p.val(),c=k.val(),st=s.val(),ht=e.val(),ct=o.val(),lt=b.val(),fi=d.val(),vt=g.val(),yt=tt.val(),bt=nt.val(),kt=nt.val(),gt=it.val(),ni=ft.is(":checked"),ti=et.is(":checked"),ii=at.is(":checked"),ri=pt.val(),ui=wt.val();window.setTimeout(function(){t.ajax({type:"Post",async:!1,url:url,dataType:"json",data:{C_BPartner_ID:h,searchKey:v,name:rt,name2:ot,greeting:c,bpGroup:st,bpRelation:ht,bpLocation:ct,contact:lt,greeting1:c,title:vt,email:yt,address:ut,phoneNo:bt,phoneNo2:kt,fax:gt,windowNo:i,BPtype:u,isCustomer:ni,isVendor:ti,isProspect:ii,fileName:dt,mobile:ri,webUrl:ui},success:function(n){alert(n);y!=null&&y.hide();t(".vis-apanel-busy").css("visibility","hidden")}})},2)}}function kt(i,r,u){var f=null,e="";url=n.Application.contextUrl+"BPartner/GetBPLocation?WinNo="+r+"&bpartnerID="+i;t.ajax({type:"GET",async:!1,url:url,dataType:"json",success:function(t){f=JSON.parse(t);for(var i=0;i<f.lstBPLocation.length;i++)e+="<option value='"+f.lstBPLocation[i].ID+"'>"+n.Utility.encodeText(f.lstBPLocation[i].Name)+"<\/option>";o.empty();o.append(e);o.val(u)}})}var p=null,w=null,k=null,ot=null,b=null,d=null,g=null,tt=null,nt=null,st=null,it=null,g=null,rt=null,ht=null,y=null,ct=0,lt=0,ut=null,ft=null,et=null,at=null,vt=null,dt=null,gt="",yt=null,pt=null,wt=null;l==null&&(t(".vis-apanel-busy").css("visibility","visible"),t(".vis-apanel-busy").css("z-index","9999999"));y=l;f!=null&&f.empty();ct=a;lt=v;ni(i,h,c)}}(VIS,jQuery),function(n,t){function y(){r=null;f=null;s=null;$mainUserInfo=null;a=800;c=1048576;l=10;r=t(" <div id='mainUserInfoDiv_"+i+"'><div class='wsp-view_left_part' style='float:left;width: 45%;padding-left: 10px;padding-right: 10px'><input type='hidden' value='0' id='userID_"+i+"'><\/input> <p id='hduserName_"+i+"' style='display: none;'><\/p>  <p id='userName_"+i+"' class='wsp-view_profile_name'><\/p> <a id='dotImg_"+i+"' href='javascript:void(0)' style='display: none;'><\/a><div id='popUpDiv_"+i+"' style='display: none;'><\/div><input type='hidden' value='0' id='BPID_"+i+"'><\/input><input type='hidden' value='0' id='BPGroupID_"+i+"'><\/input><input type='hidden' value='' id='userTableID_"+i+"'><p id='companyName_"+i+"' class='wsp-view_profile_possession border'><\/p><p class='wsp-view_profile_possession border' style='border-bottom: 1px solid #DFDFDF; padding-bottom: 20px;' id='pContactTypeCategory_"+i+"'><\/p><div class='wsp-profile_big_img_mobile'><span id='editMobileImage_"+i+"' class='mobilespan' style='width:24px;float:right;'><input type='file' id='wsp-fileinput_"+i+"' class='wsp-file-input' value='Add Pic' style='opacity: 0; width: 7%; margin-top: -6px; float: left; z-index: 999; position: absolute; cursor: pointer;'><img src='"+n.Application.contextUrl+"Areas/WSP/Images/Edit-icon.png' style='z-index: 100; position: absolute;'><\/span><img id='mobileImg_"+i+"' width='100%' alt='Image is not available' src='Areas/VIS/Images/home/User.png'><\/div><div id='divTeam_"+i+"' class='wsp-view_team'><\/div><div id='divContactDetails_"+i+"' class='wsp-view_team'><\/div><div id='divcompanyDetails_"+i+"' class='wsp-view_team'><\/div><div id='divRole_"+i+"' class='wsp-view_team'><\/div><\/div><div class='wsp-view_right_part'  style='float:left;width: 55%;' id='WSP_view_right_part_"+i+"'><div id='userBigImg_"+i+"' class='wsp-profile_big_img' style='width: 322px;'><div class='image-upload' style='float: right; position: absolute; z-index: 999; width: 100%'> <label for='file-input' class='wsp-file-label'><span class='wsp-change-picture-ico'><\/span><\/label><input type='file' id='wsp-file-input_"+i+"' class='wsp-file-input' value='Add Pic' style='opacity: 0; width: 30%; margin-top: 0px; float: right; z-index: 999; position: absolute; right: 0px; cursor: pointer;'><\/div><div class='wsp-bigimg'> <img id='bigUserImage_"+i+"' alt='Image is not available' src='"+n.Application.contextUrl+"Areas/VIS/Images/home/User.png'><\/div><\/div><div class='wsp-action'><table id='actionTable_"+i+"' class='wsp-tableRightContent'><tbody><tr style='height:30px'> <td class='tdactionlist'><a id='edit_"+i+"' class='wsp-tableaction' href='javascript:void(0)'><span class='wsp-left_icon'> <img src='"+n.Application.contextUrl+"Areas/WSP/Images/edit_2.png'><\/span> <p>Edit <\/p> <\/a> <\/td> <td class='tdactionlist'> <a id='sendSMS_"+i+"' class='wsp-tableaction' href='javascript:void(0)'><span class='wsp-left_icon'> <img src='"+n.Application.contextUrl+"Areas/WSP/Images/send_sms.png'><\/span> <p> Send Sms <\/p> <\/a> <\/td> <\/tr>  <tr style='height:30px'>       <td class='tdactionlist'><a id='email_"+i+"' class='wsp-tableaction' href='javascript:void(0)'><span class='wsp-left_icon email_icon'>           <img src='"+n.Application.contextUrl+"Areas/WSP/Images/message.png'><\/span>           <p>Email <\/p>       <\/a>       <\/td>       <td class='tdactionlist'><a id='appointment_"+i+"' class='wsp-tableaction' href='javascript:void(0)'><span class='wsp-left_icon'>           <img src='"+n.Application.contextUrl+"Areas/WSP/Images/appointment.png'><\/span>           <p>Appointment <\/p>       <\/a>       <\/td>   <\/tr>   <tr style='height:30px'>       <td class='tdactionlist'><a id='activity_"+i+"' class='wsp-tableaction' href='javascript:void(0)'><span class='wsp-left_icon'>            <img src='"+n.Application.contextUrl+"Areas/WSP/Images/activity.png'><\/span>           <p>Activity<\/p>       <\/a>       <\/td>        <td class='tdactionlist'><a id='createOrder_"+i+"' href='javascript:void(0)' class='wsp-tableaction'><span class='wsp-left_icon'>           <img src='"+n.Application.contextUrl+"Areas/WSP/Images/create_order.png'><\/span>           <p>Create Order<\/p>       <\/a>        <\/td>    <\/tr>   <tr style='height:30px'>       <td class='tdactionlist'><a id='BPInfo_"+i+"' class='wsp-tableaction' href='javascript:void(0)'><span class='wsp-left_icon'>           <img src='"+n.Application.contextUrl+"Areas/WSP/Images/bp_info.png'><\/span>           <p>BP Info<\/p>       <\/a>        <\/td>        <td class='tdactionlist'><a id='addBPartner_"+i+"' href='javascript:void(0)' class='wsp-tableaction'><span class='wsp-left_icon'>           <img src='"+n.Application.contextUrl+"Areas/WSP/Images/addBPartner.png'><\/span>           <p style=''>Add BPartner <\/p>       <\/a>       <\/td>   <\/tr> <tr style='height:30px'><td class='tdactionlist'><a id='History_"+i+"' class='wsp-tableaction' href='javascript:void(0)'><span class='wsp-left_icon'><img src='/Areas/WSP/Images/History24.png'><\/span><p>"+n.Msg.getMsg("History")+"<\/p><\/a><\/td><\/tr>   <tr>   <\/tr><\/tbody><\/table><\/div><div id='divBirthday_"+i+"' class='wsp-birthday_container' style='display: none;'><\/div><\/div><\/div>")}var i=0,o=t(document).width(),v=t(document).height(),r=null,h=0,e=null,f=null,s=null,a=null,c=null,l=null,u=null,o=t(document).width(),v=t(document).height();n.ContactInfo=function(v,p){for(var w=n.DB.executeReader("SELECT COUNT(*) FROM AD_Table WHERE TableName='C_BPartner'",null);w.read();)if(parseInt(w.getString(0))==0){n.ADialog.error("VIS_NotSupported");self.dispose();return}h=v;i=p;t(".vis-apanel-busy").css("visibility","visible");e=n.Application.contextUrl+"WSP/Contacts/UserContactInfo?WinNo="+i+"&userID="+h+"&isPartialViewLoad=true";y(h,e);this.show=function(){if(!window.WSP){alert("please download WSP !!!");t(".vis-apanel-busy").css("visibility","hidden");return}window.setTimeout(function(){u=new n.ChildDialog;u.setContent(r);u.setWidth(610);u.setTitle(n.Msg.getMsg("ContactInfo"));u.setEnableResize(!1);u.setModal(!0);u.show();u.getRoot().dialog({position:[400,0]});u.onClose=function(){dispose()};t.ajax({type:"GET",async:!1,url:e,dataType:"json",success:function(h){function ri(i,r,f){f.stopPropagation();t.ajax({type:"GET",async:!1,url:i,dataType:"json",success:function(t){var i=JSON.parse(t),f=new n.Query;r?(f.addRestriction("C_BPartner_ID",n.Query.prototype.EQUAL,i[1]),n.viewManager.startWindow(i[0],f),k.find("p").removeAttr("style"),u.close()):(f.addRestriction("C_Order_ID",n.Query.prototype.EQUAL,i[1]),win=n.viewManager.startWindow(i[0],f),win.onLoad=function(){var n=win.cPanel.curGC;n.onRowInserting=function(){win.cPanel.cmd_new(!1)};n.onRowInserted=function(){tab=win.cPanel.curTab;tab.setValue("C_BPartner_ID",et.text())}},st.find("p").removeAttr("style"),u.close())}})}var v=JSON.parse(h),p="",y,wt,nt,d;v[0].Customer!=""&&(p+=v[0].Customer);v[0].Vendor!=""&&(v[0].Customer!=""&&(p+=","),p+=v[0].Vendor);v[0].Employee!=""&&((v[0].Customer!=""||v[0].Vendor!="")&&(p+=","),p+=v[0].Employee);v[0].Prospect!=""&&((v[0].Customer!=""||v[0].Vendor!=""||v[0].Employee!="")&&(p+=","),p+=v[0].Prospect);var ht=r.find("#divRole_"+i),ct=r.find("#divTeam_"+i),b=r.find("#divContactDetails_"+i),it=r.find("#dotImg_"+i),w=r.find("#userID_"+i),lt=r.find("#userTableID_"+i),rt=r.find("#hduserName_"+i),ft=r.find("#userName_"+i),et=r.find("#BPID_"+i),bt=r.find("#BPGroupID_"+i),ui=r.find("#companyName_"+i),fi=r.find("#pContactTypeCategory_"+i),ai=r.find("#mobileImg_"+i),ur=r.find("#team_"+i),fr=r.find("#teamNotFound_"+i),vi=r.find("#address_"+i),yi=r.find("#country_"+i),pi=r.find("#postal_"+i),wi=r.find("#phone_"+i),bi=r.find("#userEmail_"+i),er=r.find("#emailNotFound_"+i),kt=r.find("#divcompanyDetails_"+i),ei=r.find("#companyNotFound"+i),or=r.find("#role_"+i),ki=r.find("#roleNotFound_"+i),at=r.find("#bigUserImage_"+i),ot=r.find("#divBirthday_"+i),sr=r.find("#userBigImg_"+i),k=r.find("#edit_"+i);s=r.find("#WSP_dots_"+i);var dt=r.find("#sendSMS_"+i),gt=r.find("#email_"+i),g=r.find("#BPInfo_"+i),st=r.find("#createOrder_"+i),vt=r.find("#addBPartner_"+i),di=r.find("#History_"+i),yt=r.find("#appointment_"+i),pt=r.find("#activity_"+i),gi=r.find("#ImportContacts_"+i),tt=r.find("#wsp-file-input_"+i),oi=r.find("#wsp-fileinput_"+i),hr=r.find(".WSP_profile_big_img"),nr=r.find(".WSP_profile_big_img_mobile"),si=null,tr=r.find("#mainUserInfoDiv_"+i),ni=!1,ut=!1,ti=!1,v=JSON.parse(h),hi="",ii="";for(w.empty(),w.append(v[0].UserID),rt.empty(),rt.append(v[0].FirstName),rt.hide(),ft.empty(),it.empty(),p==""||p==null?(k.removeAttr("href"),k.css("cursor","auto"),k.find("p").css("color","black"),g.removeAttr("href"),g.css("cursor","auto"),g.find("p").css("color","black")):(k.attr("href","javascript:void(0)"),k.css("cursor","pointer"),k.removeAttr("style"),g.attr("href","javascript:void(0)"),g.css("cursor","pointer"),g.removeAttr("style")),o>=1e3&&o<=1024?v[0].FirstName.length>15?(it.show(),ft.append(v[0].FirstName.substring(0,15)).append(it.append("..."))):ft.append(v[0].FirstName):v[0].FirstName.length>20?(it.show(),ft.append(v[0].FirstName.substring(0,20)).append(it.append("..."))):ft.append(v[0].FirstName),et.empty(),et.append(v[0].BPartnerID),lt.append(v[0].TableID),bt.empty(),bt.append(v[0].BPGroupID),ui.empty(),ui.append(v[0].CompanyName),fi.empty(),fi.append(p),ai.removeAttr("src").attr("src",v[0].Image),ct.empty(),ct.append("<p>"+n.Msg.getMsg("Teams")+"<\/p>"),y=0;y<v.length;y++)v[y].Team!=""&&v[y].Team!=null&&(ni=!0,ii+=y==0||ii==""?v[y].Team:", "+v[y].Team);for(ni||ct.append(" <p  id='teamNotFound_"+i+"' style='word-break: break-all; font-style: italic;'>"+n.Msg.getMsg("NotFound")+"<\/p>"),ni&&ct.append(" <p id='team_"+i+"' >"+ii+"<\/p>"),vi.empty(),b.empty(),b.append("<p style='word-break: break-all;'> "+n.Msg.getMsg("ContactDetails")+" <a href='javascript:void(0)'> <img style='margin-bottom:3px' id='showAddressOnGoogleMap_"+i+"' src='"+n.Application.contextUrl+"Areas/VIS/Images/base/ToLink20.png'> <\/a><\/p> "),y=0;y<v.length;y++)v[y].FirstName==""&&v[y].Address!=""&&v[y].Address!=null&&(ut=!0,b.append("<p id='address_"+i+"' style='word-break: break-all'>"+v[y].Address+"<\/p>"));for(yi.empty(),v[0].CountryName!=""&&v[0].CountryName!=null&&(ut=!0,b.append("<p id='country_"+i+"' style='word-break: break-all'>"+v[0].City+"("+v[0].CountryName+")<\/p> ")),pi.empty(),v[0].Postal!=""&&v[0].Postal!=null&&(ut=!0,b.append("<p id='postal_"+i+"' style='word-break: break-all'>"+n.Msg.getMsg("ZipCode")+": "+v[0].Postal+"<\/p>")),wi.empty(),y=0;y<v.length;y++)v[y].FirstName==""&&v[y].PhoneNo!=""&&v[y].PhoneNo!=null&&(ut=!0,o<=1024?b.append("<a href='tel:"+v[y].PhoneNo+"'><p id='phone_"+i+"' style='word-break: break-all'><span class='wsp-caller'><img src='"+n.Application.contextUrl+"Areas/WSP/Images/caller.png'><\/span>"+v[y].PhoneNo+"<\/p><\/a>"):b.append("<p id='phone_"+i+"' style='word-break: break-all'><span class='wsp-caller'><img src='"+n.Application.contextUrl+"Areas/WSP/Images/caller.png'><\/span>"+v[y].PhoneNo+"<\/p>"));for(bi.empty(),v[0].Email!=""&&v[0].Email!=null&&(ut=!0,b.append("<p id='userEmail_"+i+"' style='word-break: break-all;display: inline-flex;margin-top: 0;'> <span class='wsp-caller'><img src='"+n.Application.contextUrl+"Areas/WSP/Images/sms.png'><\/span>"+v[0].Email+"<\/p>")),!ut,kt.empty(),kt.append("<p>"+n.Msg.getMsg("Company")+"<\/p>"),kt.append("<p id='companyDetails_"+i+"' style='word-break: break-all'>"+v[0].CompanyName+"<\/p>"),ei.empty(),v[0].CompanyName!=""&&v[0].CompanyName!=null&&ei.append(n.Msg.getMsg("NotFound")),ht.empty(),ht.append("<p>"+n.Msg.getMsg("RoleAssign")+"<\/p>"),y=0;y<v.length;y++)v[y].Role!=""&&v[y].Role!=null&&(ti=!0,hi+=y==0?v[y].Role:", "+v[y].Role);ti&&ht.append("<p id='role_"+i+"'>"+hi+"<\/p>");ki.empty();ti||ht.append("<p id='roleNotFound_"+i+"' style='word-break: break-all; font-style: italic;'>"+n.Msg.getMsg("NotFound")+"<\/p>");v[0].Image.indexOf("User")>0?at.removeAttr("src").attr("src",n.Application.contextUrl+"Areas/VIS/Images/home/User.png"):at.removeAttr("src").attr("src",v[0].Image);ot.empty();var ci=new Date,li=new Date(v[0].Birthday),ir=ci.getMonth()+1+"/"+ci.getDate(),rr=li.getMonth()+1+"/"+li.getDate();v[0].Birthday!=""?(ot.show(),ot.css("border","1px solid #1886BF"),wt=t("<div class='wsp-birthdat_text'>"),rr==ir&&wt.append("<p> "+n.Msg.getMsg("Today")+" "+n.Msg.getMsg("is")+" <span class='wsp-birthday_text_highlight'>"+v[0].FirstName+"<\/span> "+n.Msg.getMsg("Birthday")+"<\/p>"),wt.append("<p>"+v[0].FirstName+" "+n.Msg.getMsg("Birthday")+" "+n.Msg.getMsg("on")+"  <span class='wsp-birthday_text_highlight'>"+v[0].Birthday+"<\/span><\/p> <\/div>"),ot.append(wt)):ot.hide();it.on("click",function(n){$popUp.show();var t=r.find("<div class='arrow_box'> <p style='margin-left:5px;margin-top:5px;margin-right:5px'>"+rt.text()+"<\/p><\/div>");$popUp.append(t);$popUp.delay(2e3).fadeOut();n.stopPropagation()});if(s!=null)s.on("click",function(n){tr.animate({right:"-1000px"},a);n.stopPropagation()});t(".ui-dialog-content").on("click",function(n){t("#w2ui-overlay").hide();n.stopPropagation()});nt=t("<ul id='ulEditOption' class='vis-apanel-rb-ul'>");d=t("<ul id='ulCreateOrder' class='vis-apanel-rb-ul'>");k.on("click",function(r){var u,h,e;if(p==""||p==null)return r.preventDefault(),!1;k.find("p").css("background-color","#e0e0e0");r.stopPropagation();var o=w.text(),s=p.split(",");if(s.length>1){for(t("#w2ui-overlay").show(),nt!=null&&nt.empty(),u=t("<div/>"),u.css("width","auto"),u.css("height","100%"),nt.css("width","auto"),nt.css("height","100%"),h="",e=0;e<s.length;e++)h+="<li style='margin-top:15px;margin-left:10px;margin-right:13px;font-size: 15px' id='"+s[e].trim()+"_"+i+"'>"+n.Msg.getMsg(s[e].trim())+"<\/li>";nt.append(h);u.append(nt);k.w2overlay(u.clone(!0),{css:{height:"300px"}});u.css("top","395px");nt.load()}else p=="Employee"&&(f=n.Application.contextUrl+"WSP/Contacts/GetWindowID?windowName=Employee Master&userID="+o),p=="Customer"&&(f=n.Application.contextUrl+"WSP/Contacts/GetWindowID?windowName=Customer Master&userID="+o),p=="Vendor"&&(f=n.Application.contextUrl+"WSP/Contacts/GetWindowID?windowName=Vendor Master&userID="+o),p=="Prospect"&&(f=n.Application.contextUrl+"WSP/Contacts/GetWindowID?windowName=Prospects&userID="+o),ri(f,!0,r)});nt.on("click","LI",function(i){t("#w2ui-overlay").hide();var r=t(this).text();r=="Employee"&&(f=n.Application.contextUrl+"WSP/Contacts/GetWindowID?windowName=Employee Master&userID="+w.text());r=="Customer"&&(f=n.Application.contextUrl+"WSP/Contacts/GetWindowID?windowName=Customer Master&userID="+w.text());r=="Vendor"&&(f=n.Application.contextUrl+"WSP/Contacts/GetWindowID?windowName=Vendor Master&userID="+w.text());r=="Prospect"&&(f=n.Application.contextUrl+"WSP/Contacts/GetWindowID?windowName=Prospects&userID="+w.text());ri(f,!0,i);i.stopPropagation()});dt.on("click",function(i){dt.find("p").css("background-color","#e0e0e0");t(".vis-apanel-busy").css("visibility","visible");t(".vis-apanel-busy").css("z-index","999999999999");i.stopPropagation();window.setTimeout(function(){var r=new n.Sms(null,null,0,!0),i=new n.CFrame;i.setName(n.Msg.getMsg("Sms"));i.setTitle(n.Msg.getMsg("Sms"));i.hideHeader(!0);i.setContent(r);i.show();r.initializeComponent();t(".vis-apanel-busy").css("visibility","hidden");u.close()},2)});gt.on("click",function(r){gt.find("p").css("background-color","#e0e0e0");t(".vis-apanel-busy").css("visibility","visible");t(".vis-apanel-busy").css("z-index","999999999999");r.stopPropagation();window.setTimeout(function(){var f=new n.Email(t("#userEmail_"+i).text(),null,null,w.text(),!0,!0,lt.text()),r=new n.CFrame;r.setName(n.Msg.getMsg("EMail"));r.setTitle(n.Msg.getMsg("EMail"));r.hideHeader(!0);r.setContent(f);r.show();f.initializeComponent();t(".vis-apanel-busy").css("visibility","hidden");u.close()},2)});g.on("click",function(i){if(p==""||p==null)return i.preventDefault(),!1;g.find("p").css("background-color","#e0e0e0");window.setTimeout(function(){var r=w.text(),i="";i=n.Application.contextUrl+"WSP/Contacts/GetWindowID?windowName=Business Partner Info&userID="+r;t.ajax({type:"GET",async:!1,url:i,dataType:"json",success:function(t){var i=JSON.parse(t),r=new n.Query;r.addRestriction("C_BPartner_ID",n.Query.prototype.EQUAL,i[1]);n.viewManager.startWindow(i[0],r);g.find("p").removeAttr("style");u.close()}})},500)});st.on("click",function(r){var u,f;st.find("p").css("background-color","#e0e0e0");t("#w2ui-overlay").show();t("#w2ui-overlay").find("div").empty();d!=null&&d.empty();u=t("<div/>");u.css("width","auto");u.css("height","100%");d.css("width","auto");d.css("height","100%");f=t("<li style='margin-top:15px;margin-left:10px;margin-right:13px;font-size: 15px' id='SaleOrder_"+i+"'>"+n.Msg.getMsg("Sales Order")+"<\/li> <li  style='margin-top:10px;margin-left:10px;margin-right:13px;font-size: 15px' id='PurchaseOrder_"+i+"' >"+n.Msg.getMsg("PurchaseOrder")+"<\/li>");d.append(f);u.append(d);st.w2overlay(u.clone(!0),{css:{height:"300px"}});u.css("top","395px");r.stopPropagation();d.load()});d.on("click","LI",function(i){t("#w2ui-overlay").hide();var r=t(this).text();e=n.Application.contextUrl+"WSP/Contacts/GetWindowAndOrderID?windowName="+r+"&userID="+w.text();ri(e,!1,i);i.stopPropagation()});vt.on("click",function(t){vt.find("p").css("background-color","#e0e0e0");t.stopPropagation();$saleOrder=null;$purchaseOrder=null;n.AddUpdateBPartner(i,0,p,null,et.text(),bt.text());vt.find("p").removeAttr("style")});di.on("click",function(){var t=new n.AttachmentHistory(lt.val(),w.text(),et.text(),0,"AD_User_ID");t.show()});yt.on("click",function(r){r.stopPropagation();yt.find("p").css("background-color","#e0e0e0");t(".vis-apanel-busy").css("visibility","visible");t(".vis-apanel-busy").css("z-index","999999999999");window.setTimeout(function(){n.AppointmentsForm.init(lt.text(),t("#userID_"+i).text(),n.context.getAD_User_ID(),rt.text(),!1);yt.find("p").removeAttr("style");t(".vis-apanel-busy").css("visibility","hidden");u.close()},500)});gi.on("click",function(n){n.stopPropagation();t(".vis-apanel-busy").css("visibility","visible");t(".vis-apanel-busy").css("z-index","999999999999");window.setTimeout(function(){WSP.importcontacts(self);t(".vis-apanel-busy").css("visibility","hidden")},50)});pt.on("click",function(r){r.stopPropagation();pt.find("p").css("background-color","#e0e0e0");t(".vis-apanel-busy").css("visibility","visible");t(".vis-apanel-busy").css("z-index","999999999999");window.setTimeout(function(){n.AppointmentsForm.init(0,t("#userID_"+i).text(),n.context.getAD_User_ID(),rt.text(),!0);pt.find("p").removeAttr("style");t(".vis-apanel-busy").css("visibility","hidden")},500)});tt.on("change",function(){t(".vis-apanel-busy").css("visibility","visible");t(".vis-apanel-busy").css("z-index","999999999999");var f=w.text(),i=new XMLHttpRequest,r=new FormData,u=tt;if(r.append("file",u[0].files[0]),r.append("userID",f),u[0].files[0].size/c>l){alert(n.Msg.getMsg("UploadedFileSizeLimit"));tt.replaceWith(tt.val("").clone(!0));return}i.open("POST",n.Application.contextUrl+"WSP/Contacts/SaveImageAsByte",!0);i.setRequestHeader("Cache-Control","no-cache");i.setRequestHeader("Pragma","no-cache");i.send(r);i.addEventListener("load",function(n){var i=n.target.response,r=JSON.parse(i);image=JSON.parse(r);at.removeAttr("src").attr("src","data:image/jpg;base64,"+image[1]);t(".vis-apanel-busy").css("visibility","hidden")},!1);tt.val("")});oi.on("change",function(){t(".vis-apanel-busy").css("visibility","visible");t(".vis-apanel-busy").css("z-index","999999999999");var f=w.text(),i=new XMLHttpRequest,r=new FormData,u=tt;if(r.append("file",u[0].files[0]),r.append("userID",f),u[0].files[0].size/c>l){alert(n.Msg.getMsg("UploadedFileSizeLimit"));return}i.open("POST",n.Application.contextUrl+"WSP/Contacts/SaveImageAsByte",!0);i.setRequestHeader("Cache-Control","no-cache");i.setRequestHeader("Pragma","no-cache");i.send(r);i.addEventListener("load",function(n){var i=n.target.response,r=JSON.parse(i);image=JSON.parse(r);at.removeAttr("src").attr("src","data:image/jpg;base64,"+image[1]);nr.removeAttr("src").attr("src","data:image/jpg;base64,"+image[1]);t(".vis-apanel-busy").css("visibility","hidden")},!1)});si=b.find("#showAddressOnGoogleMap_"+i);si.on("click",function(){var n=b.find("#address_"+i).text()+b.find("#country_"+i).text(),t="http://local.google.com/maps?q="+n;window.open(t)});t(".vis-apanel-busy").css("visibility","hidden")}})},2)}}}(VIS,jQuery),function(n,t){function i(){function b(){h=t('<div style="width:100%;height:100%">');u=t("<ul class='vis-apanel-rb-ul' style='width:100%;height:100%'>");e=t("<li data-isfav='no' data-id='favaction'>").append(n.Msg.getMsg("AddFav"));o=t("<li data-isfav='yes' data-id='favaction'>").append(n.Msg.getMsg("RemoveFav"));l=t("<li data-isfav='"+i.data("isfav")+"' data-id='favaction'>").append(n.Msg.getMsg("OpenNewTab"));u.append(e);u.append(o);u.append(l);h.append(u);d()}function k(n){i=n;f=i.data("value");a=i.data("action");s=i.data("actionid");y=i.data("name");v=i.data("isfav");p||(b(),p=!0);v=="yes"?(e.css("display","none"),o.css("display","block")):(e.css("display","block"),o.css("display","none"));i.w2overlay(h.clone(!0),{css:{height:"300px"}})}function d(){e.on("click",w);o.on("click",w);l.on("click",g)}function w(){v=="yes"?(i.removeClass("vis-favitmchecked"),i.addClass("vis-favitmunchecked"),i.data("isfav","no"),tt(f),n.favMgr.removeFavourite(f)):(r={},r.Action=a,r.WindowID=s,r.FormID=s,r.ProcessID=s,r.NodeID=f,r.Name=y,i.removeClass("vis-favitmunchecked"),i.addClass("vis-favitmchecked"),i.data("isfav","yes"),nt(f),n.favMgr.addFavourite(r))}function g(){n.viewManager.startActionInNewTab(a,s)}function nt(i){t.ajax({url:n.Application.contextUrl+"Home/SetNodeFavourite/?nodeID="+i,dataType:"json"})}function tt(i){t.ajax({url:n.Application.contextUrl+"Home/RemoveNodeFavourite/?nodeID="+i,dataType:"json"})}function it(n){c||(c=t("#vis_divTree"));var r=c.children(0).find("[data-value='"+n+"']"),i=t(r.children()[1]);i.removeClass("vis-favitmchecked");i.addClass("vis-favitmunchecked");i.data("isfav","no")}var h=null,u=null,f=null,i=null,r=null,c=null,e=null,o=null,l=null,a,s,y,v,p=!1;return{removeFavourite:it,showOverlay:k}}n.FavouriteHelper=i()}(VIS,jQuery),function(n,t){function i(i,r,u,f,e,o,s,h,c,l){function ku(){tt=o;tt?s!=null&&s!=undefined&&(ei=s):(ei=r.gridTable.AD_Table_ID,v=u.getSelectedRows(),w=r.getRecords()[r.getCurrentRow()]);ut=t('<ul class="vis-email-ul" ><\/ul>');d=t("<div>");d.css("position","absolute");d.css("bottom","0");d.css("background","url('"+n.Application.contextUrl+"Areas/VIS/Images/LoadingCircle.gif') no-repeat");d.css("background-position","center center");d.css("width","98%");d.css("height","98%");d.css("text-align","center");d.css("opacity",".1");d[0].style.visibility="hidden"}function du(){e?(yt=t('<img  class="vis-email-sendbtn" title="'+n.Msg.getMsg("SendMail").replace("&","")+'" src="'+n.Application.contextUrl+'Areas/vis/Images/email-send.png"> <\/img>'),dt.append(yt)):(yt=t('<img  class="vis-email-saveAttachbtn" title="'+n.Msg.getMsg("SaveAttachment").replace("&","")+'" src="'+n.Application.contextUrl+'Areas/vis/Images/email-saveAttachment.png"> <\/img>'),dt.append(yt));tt||(si=t('<img  class="vis-email-btns" title="'+n.Msg.getMsg("Preview").replace("&","")+'" src="'+n.Application.contextUrl+'Areas/vis/Images/email-preview.png"> <\/img>'),dt.append(si),ci=t('<img  class="vis-email-btns" title="'+n.Msg.getMsg("SaveAs").replace("&","")+'" src="'+n.Application.contextUrl+'Areas/vis/Images/email-saveas.png"> <\/img>'),dt.append(ci),li=t('<img  class="vis-email-btns"  title="'+n.Msg.getMsg("Save").replace("&","")+'" src="'+n.Application.contextUrl+'Areas/vis/Images/email-save.png"> <\/img>'),dt.append(li),hi=t('<img  class="vis-email-btns" title="'+n.Msg.getMsg("Open").replace("&","")+'" src="'+n.Application.contextUrl+'Areas/vis/Images/email-open.png"> <\/img>'),dt.append(hi));e||(yr=t('<img  class="vis-email-btns" title="'+n.Msg.getMsg("SavePdf").replace("&","")+'" src="'+n.Application.contextUrl+'Areas/vis/Images/email-savepdf.png"> <\/img>'),dt.append(yr))}function gu(){var i={windowNo:y.windowNo,language:n.Env.getAD_Language(n.Env.getCtx())};t.ajax({type:"Get",async:!1,url:n.Application.contextUrl+"Email/Init",data:i,success:function(n){nf(n)}})}function nf(n){var r,u;a.append(t(n));r=0;et=a.find("#"+y.windowNo+"_dyndis");a.find(".vis-email-attachmentContainer").hide();rt=a.find(".vis-email-leftDiv");yi=a.find(".vis-Email-BccList");ht=a.find("#"+y.windowNo+"_emailSubject");cr=a.find(".vis-DMSAttachDocList");ur=a.find(".vis-dmsdocumentheader");c!=undefined&&c!=null&&ht.val(c);di=a.find("#"+y.windowNo+"_vis-email-attacImg");oi=a.find("#"+y.windowNo+"_vis-Email-textarea");gi=a.find(".vis-Email-leftFooter");a.find(".contentArea").css("height",a.height()-44);a.find(".vis-Email-textarea-div").css({"margin-top":"10px"});u=/ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase());u==!0&&a.find(".vis-Email-textarea-div").css({overflow:"auto"});a.find(".vis-email-leftDiv").height(a.height()-44);a.find(".vis-Email-rytWrap").height(a.height()-44);tt?(a.find(".vis-form-data-sub").css("margin-top","0px"),a.find(".vis-email-leftDiv").hide(),a.find(".vis-Email-rytWrap").hide(),st=a.find("#"+y.windowNo+"_emailToTop"),k=a.find("#"+y.windowNo+"_emailBccTop"),ft=a.find("#"+y.windowNo+"_eamilCcTop"),k.hide(),ft.hide(),a.find(".vis-Email-textarea-div").height(a.height()-180),a.find(".vis-Email-leftWrap").css("width","100%"),a.find(".vis-Email-leftFooter").hide(),r=a.width()-40,et.prop("checked",!1),a.find(".vis-Email-topinputWrap").css("overflow","auto"),et.hide(),i!=undefined&&i!=null&&st.val(i),a.find(".vis-form-data-sub").width(a.width()-85)):e?(a.find(".vis-Email-topinputWrap").hide(),st=a.find("#"+y.windowNo+"_emailTo"),k=a.find("#"+y.windowNo+"_emailBcc"),ft=a.find("#"+y.windowNo+"_eamilCc"),a.find(".vis-Email-textarea-div").height(a.height()-145),ki=a.find("#"+y.windowNo+"_emailRefresh"),r=a.width()-90,a.find(".vis-Email-leftWrap").width(r-350),a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width()-60)):(a.find(".vis-Email-rytWrap").hide(),a.find(".vis-Email-topinputWrap").hide(),di.hide(),a.find(".vis-Email-textarea-div").height(a.height()-142),a.find(".vis-Email-leftWrap").css("margin-right","20px"),r=a.width()-240,a.find(".vis-Email-leftWrap").width(r-25),a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width()-60));a.find(".vis-Email-BccList").height(a.find(".vis-Email-rytContent").height()-(a.find(".vis-Email-rytForm").height()+70)-280);ot=a.find(".vis-Email-ContentWrap");ot.css("width",r);p!=null&&p!=undefined&&(p.body.style.width=r-370+"px");iu=!0}function tf(){try{oi.kendoEditor({tools:["bold","italic","underline","strikethrough","justifyLeft","justifyCenter","justifyRight","justifyFull","insertUnorderedList","insertOrderedList","indent","outdent","createLink","unlink","insertImage","insertFile","subscript","superscript","createTable","addRowAbove","addRowBelow","addColumnLeft","addColumnRight","deleteRow","deleteColumn","viewHtml","formatting","cleanFormatting","fontName",{name:"fontSize",items:[].concat([{text:"8px",value:"8px"}],[{text:"12px",value:"12px"}],[{text:"16px",value:"16px"}],[{text:"20px",value:"20px"}],[{text:"24px",value:"24px"}])},"foreColor","backColor"],encoded:!1});p=oi.data("kendoEditor");h!=undefined&&h!=null&&p.value(h)}catch(t){return console.log(t),n.ADialog.error("PleaseInstallKendoUIModule"),y.dispose(),y=null,!1}return!0}function uu(n){var i,t,f;if(n==!0&&(v=u.getSelectedRows(),w=r.getRecords()[r.getCurrentRow()]),u.singleRow)fu();else if(v.length>0){for(i="",t=0;t<v.length;t++)e&&v[t].email!=null&&(e=!0,f=v[t][r.getKeyColumnName().toLower()],i+='<li class="vis-list-li-bcc"  data-email="'+v[t].email+'"><input id="'+y.windowNo+"_"+v[t].email+'_CheckBoxList1" type="checkbox" value="'+v[t].email+'" checked/><label class="vis-chcklist-label"  for="'+y.windowNo+"_"+v[t].email+'_CheckBoxList1">'+v[t].email+"("+f+")<\/label><\/li>");ut.append(i);i=null}else fu();n||yi.append(ut)}function fu(){if(e&&w.email!=null){e=!0;var n=w[r.getKeyColumnName().toLower()];ut.append('<li class="vis-list-li-bcc" data-email="'+w.email+'"><input id="'+y.windowNo+"_"+w.email+'_CheckBoxList1" type="checkbox" value="'+w.email+'" checked /><label class="vis-chcklist-label" for="'+y.windowNo+"_"+w.email+'_CheckBoxList1">'+w.email+"("+n+")<\/label><\/li>")}}function eu(i){var e,c,f,o,s,h,u;for(i?at.empty():(vt=t('<img src="'+n.Application.contextUrl+'Areas/VIS/Images/Action.png" style="cursor:pointer" ><\/img>'),e=t('<div class="vis-apanel-lb-toggle" style="height:100%;overflow-x:hidden;overflow-y: hidden;"><\/div>'),e.append(vt),rt.append(e),at=t('<ul class="vis-apanel-lb-ul"><\/ul>'),at.css({height:a.height()-85+"px",overflow:"auto","overflow-x":"hidden","white-space":"nowrap",width:"150%"})),c="",f=0;f<r.gridTable.getFields().length;f++)if(o=r.gridTable.getFields(0)[f].getColumnName().toUpper()==r.getKeyColumnName().toUpper(),r.gridTable.getFields(0)[f].getIsDisplayed()||o){if(o||(c+="<li>"+r.gridTable.getFields(0)[f].getHeader()+"<\/li>"),s=[],h=[],r.gridTable.getFields(0)[f].getColumnName().toUpper().equals(ti))for(u=0;u<v.length;u++)n.DisplayType.IsLookup(r.getField(ti).getDisplayType())?v[u][ti.toLower()]!=null&&(s.push(v[u][ti.toLower()]),h.push(v[u][r.getKeyColumnName().toLower()])):v[u][ti.toLower()]!=null&&(s.push(v[u][ti.toLower()]),h.push(v[u][r.getKeyColumnName().toLower()]));rf(s,h)}o||at.append(c);i||e.append(at);at.children("li").on("click",cf)}function rf(i,r){for(var f,e=0;e<i.length;e++){var s="Select AD_User_ID,email from ad_user where isEmail='Y' AND c_bpartner_ID="+i[e],u=n.DB.executeDataSet(s),o="";if(u!=null&&u.getTables()[0].getRows().length>0)for(f=0;f<u.getTables()[0].getRows().length;f++)if(u.getTables()[0].getRows()[f].getCell("email")!=null){if(u.getTables()[0].getRows()[f].getCell("EMAIL")==null||u.getTables()[0].getRows()[f].getCell("EMAIL")=="")continue;if(t(ut.children("li").data(u.getTables()[0].getRows()[f].getCell("EMAIL")+r[e])).length>0)continue;o+='<li  class="vis-list-li-bcc"><input id="'+y.windowNo+"_"+u.getTables()[0].getRows()[f].getCell("EMAIL")+'_CheckBoxList1" type="checkbox"  value="'+u.getTables()[0].getRows()[f].getCell("EMAIL")+'" checked/><label class="vis-chcklist-label"  for="'+y.windowNo+"_"+u.getTables()[0].getRows()[f].getCell("EMAIL")+'_CheckBoxList1">'+u.getTables()[0].getRows()[f].getCell("EMAIL")+"("+r[e]+")<\/label><\/li>"}ut.append(o);o=null}}function uf(){di.on("click",function(){ff()});ni.on("click","li",function(i){var u,r;if(i.stopPropagation(),u=t(this).attr("value"),parseInt(u)==0)of(i);else if(parseInt(u)==1){if(t("#w2ui-overlay").hide(),pt!=null&&pt.GetDmsCloseOrNot()){n.ADialog.info("DMSAlreadyOpen");return}r=new n.CFrame;pt=new VADMS.DocumentManagementSystem;r.setName(n.Msg.getMsg("VADMS_Document"));r.setTitle(n.Msg.getMsg("VADMS_Document"));r.hideHeader(!0);pt.setWindowNo(y.windowNo);pt.OpenFromEmail(!0);r.setContent(pt);pt.initialize();r.show()}});if(e){yt.on("click",af);if(ki!=null&&ki!=undefined)ki.on("click",bf)}else yt.on("click",vf);if(!e)yr.on("click",yf);if(tt)a.find(".vis-Email-CcBcc").on("click",kf);else{vt.on("click",ef);et.on("click",hf);si.on("click",lf);hi.on("click",pf);ci.on("click",au);li.on("click",wf);vt.trigger("click")}}function ff(){var i,r;ni!=null&&ni.empty();i=t("<div/>");i.css("width","auto");i.css("height","100%");ni.css("width","auto");ni.css("height","100%");r="<li style='margin-top:15px;margin-left:10px;margin-right:13px;font-size: 15px' class='vis-filesystem' value='0'>"+n.Msg.getMsg("FileSystem")+"<\/li> ";window.VADMS&&(r+="<li style='margin-top:15px;margin-left:10px;margin-right:13px;font-size: 15px' class='vis-dms' value='1'>"+n.Msg.getMsg("DMS")+"<\/li>");ni.append(r);i.append(ni);di.w2overlay(i.clone(!0),{css:{height:"300px"}});i.css("top","395px");ni.load()}function ef(n){et.prop("checked")==!0?rt.width()==40?(e?(middleDivWidth=gt-(a.find(".vis-email-leftDiv").width()+200),a.find(".vis-Email-leftWrap").width(middleDivWidth-355),a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width()-45),ot.width(middleDivWidth)):(middleDivWidth=gt-(a.find(".vis-email-leftDiv").width()+200),a.find(".vis-Email-leftWrap").width(middleDivWidth-15),a.find(".vis-form-data-sub").width(middleDivWidth-40),ot.width(middleDivWidth)),rt.css("width","200px"),rt.find("ul").show(),p!=null&&p!=undefined&&(p.body.style.width=p.body.style.width-160)):dr():rt.width()!=40&&dr();n.stopPropagation()}function dr(){rt.css({width:"40px"});rt.find("ul").hide();e?(middleDivWidth=gt-(a.find(".vis-email-leftDiv").width()+40),a.find(".vis-Email-leftWrap").width(middleDivWidth-355),a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width()-45),ot.width(middleDivWidth)):(middleDivWidth=gt-(a.find(".vis-email-leftDiv").width()+40),a.find(".vis-Email-leftWrap").width(middleDivWidth-15),a.find(".vis-form-data-sub").width(middleDivWidth-40),ot.width(middleDivWidth));p!=null&&p!=undefined&&(p.body.style.width=p.body.style.width+160)}function of(){var n;if(hr==!1){if(a.find(".vis-email-attachmentContainer").is(":visible"))a.find(".vis-email-attachmentContainer").hide(),a.find(".vis-Email-textarea-div").height(a.find(".vis-Email-textarea-div").height()+(a.find(".vis-email-attachmentContainer").height()+13));else if(n=a.find(".vis-Email-ContentArea").height(),a.find(".vis-email-attachmentContainer").show(),a.find(".vis-Email-textarea-div").height(a.find(".vis-Email-textarea-div").height()-(a.find(".vis-email-attachmentContainer").height()+13)),it==null||it==undefined){ou();it=a.find("<input type='file' multiple='true' style='display:none;'>");lr.append(it);nr.on("click",function(){it.trigger("click")});it.change(function(){gr(this)})}}else a.find(".vis-email-attachmentContainer").is(":visible")||(n=a.find(".vis-Email-ContentArea").height(),(it==null||it==undefined)&&(ou(),it=t("<input type='file' multiple='true' style='display:none;'>"),it.change(function(){this.files.length<1||(a.find(".vis-email-attachmentContainer").show(),gr(this),tt?a.find(".vis-Email-textarea-div").height(a.find(".vis-Email-ContentArea").height()-(a.find(".vis-form-horizontal").height()+30)):a.find(".vis-Email-textarea-div").height(a.find(".vis-Email-ContentArea").height()-(a.find(".vis-form-horizontal").height()+50)),cu())}))),it.trigger("click")}function ou(){lr=t("<div><\/div>");var n=t("<div><\/div>");if(a.find(".vis-email-attachmentContainer").append(n),hr==!1&&(nr=t('<a class="vis-attach-ico browse-ico" style="margin-right:8px;float:right;height:30px;width:30px;margin-top:6px;"><\/a>'),lr.append(nr),n.append(nr)),ar=t("<div><\/div>"),n.append(ar),ii=t("<div class='vis-attach-content-wrap' style='height:83px;border-bottom:2px solid white;padding-bottom:0px'>"),ii.append(t('<div style="height:auto;overflow:auto" ><\/div>')),ar.append(ii),a.find(".vis-email-attachmentContainer").append(tr),hr==!1){vr=t("<div><\/div>");n.append(vr);pr=t('<a href="javascript:void(0)" class="vis-attach-ico uploadall-ico" style="height:30px;width:30px;margin-right: 7px;float:right"><\/a>');vr.append(pr);pr.on("click",function(){cu()})}}function su(){return ii.children(0).height()<75?!1:!0}function hf(){this.checked?(rt.width()!=40&&rt.find("ul").show(),e==!0&&u.singleRow==!1&&v.length>1&&(st.val(""),st.prop("disabled",!0),ft.val(""),ft.prop("disabled",!0),k.val(""),k.prop("disabled",!0))):(rt.width()!=40&&dr(),e==!0&&u.singleRow==!1&&v.length>1&&(st.prop("disabled",!1),ft.prop("disabled",!1),k.prop("disabled",!1)))}function cf(){p.paste("@@"+t(this).text()+"@@")}function lf(){var f=p.value(),e="",r,i;e=u.singleRow==!1&&v.length>0?df(f,0):gf(f);r=t("<div><\/div>");r.append(e);i=new n.ChildDialog;i.setHeight(420);i.setWidth(850);i.setTitle(n.Msg.getMsg("Preview"));i.setModal(!0);i.setContent(r);i.show();i.hidebuttons()}function af(){var l=ht.val(),b=p.value(),it,rt,o,e,i,ot,s,c,a,at,ct,vt;if((l==null||l==""||l.trim().length==0)&&(b==null||b==""||b.trim().length==0)){if(!n.ADialog.ask(n.Msg.getMsg("SendWithoutSubjectandBody")))return;l=" "}else{if(l==null||l==""||l.trim().length==0){if(!n.ADialog.ask(n.Msg.getMsg("SendWithoutSubject")))return;l=" "}if((b==null||b==""||b.trim().length==0)&&!n.ADialog.ask(n.Msg.getMsg("SendWithoutBody")))return}lt=!1;var g=st.val(),h=k.val(),tt=ft.val();if(g.trim().length>0)if(g.contains(";")){for(e=g.split(";"),i=0;i<e.length;i++)if(e[i]!=null&&e[i]!="")if(bt(e[i]))lt=!0;else{window.setTimeout(function(){n.ADialog.info("NotValidEmail",!0,":"+e[i])},2);return}}else if(bt(g))lt=!0;else{window.setTimeout(function(){n.ADialog.info("NotValidEmail",!0,":"+g)},2);return}if(tt.trim().length>0)if(tt.contains(";")){for(e=tt.split(";"),i=0;i<e.length;i++)if(e[i]!=null&&e[i]!="")if(bt(e[i]))lt=!0;else{window.setTimeout(function(){n.ADialog.info("NotValidEmail",!0,":"+e[i])},2);return}}else if(bt(tt))lt=!0;else{window.setTimeout(function(){n.ADialog.info("NotValidEmail",!0,":"+tt)},2);return}if(h.trim().length>0)if(h.contains(";")){for(e=h.split(";"),i=0;i<e.length;i++)if(e[i]!=null&&e[i]!="")if(bt(e[i]))lt=!0;else{window.setTimeout(function(){n.ADialog.info("NotValidEmail",!0,":"+e[i])},2);return}}else if(bt(h))lt=!0;else{window.setTimeout(function(){n.ADialog.info("NotValidEmail",!0,":"+h)},2);return}if(it=[],et.prop("checked")==!1){if(rt=!1,o={},o.To=g,o.Cc=tt,o.Bcc=[],h.contains(";"))for(e=h.split(";"),i=0;i<e.length;i++)e[i]!=null&&e[i]!=""&&o.Bcc.push(e[i]);else h!=null&&h!=""&&o.Bcc.push(h);if(ut!=null&&ut!=undefined&&(nt=[],t("[id*=CheckBoxList1]:checked").each(function(){nt.push(t(this).val())}),nt.length>0))for(s=0;s<nt.length;s++){if(!bt(nt[s])){window.setTimeout(function(){n.ADialog.info("NotValidEmail",!0,":"+nt[s])},2);return}rt=!0;o.Bcc.push(nt[s])}if(o.Subject=l,o.TableID=ei,o.Recordids="",w!=null)if(u.singleRow==!1){for(ot="",c=0;c<v.length;c++)ot+=v[c][r.keyColumnName.toLower()]+",";o.Recordids=ot}else o.Recordids=f>0?f:u.singleRow==!0?r.getField(r.keyColumnName.toLower()).value:w[r.keyColumnName.toLower()];else f>0&&(o.Recordids=f);if(o.AttachmentFolder=rr,!rt&&!lt){window.setTimeout(function(){n.ADialog.info("NoEmailAddressFound")},2);return}it.push(o)}else{if(nt=[],t("[id*=CheckBoxList1]:checked").each(function(){nt.push(t(this).val())}),nt.length>0)for(s=0;s<nt.length;s++)if(!bt(nt[s])){window.setTimeout(function(){n.ADialog.info("NotValidEmail",!0,":"+nt[s])},2);return}if(u.singleRow==!0||v.length==0){if(a=yu(w,0),a==null||a==undefined)return;it.push(a)}else for(c=0;c<v.length;c++)(a=yu(v[c],c),a!=null&&a!=undefined)&&it.push(a)}if(it.length==0){window.setTimeout(function(){n.ADialog.info("NoEmailAddressFound")},2);return}at=JSON.stringify(it);ct=!1;n.ADialog.ask(n.Msg.getMsg("WantAlertMessage"))&&(ct=!0);d[0].style.visibility="visible";vt={mails:n.Utility.encodeText(at),AD_User_ID:fi.getAD_User_ID(),AD_Client_ID:fi.getAD_Client_ID(),AD_Org_ID:fi.getAD_Org_ID(),attachment_ID:sr,fileNamesFornNewAttach:JSON.stringify(vi),fileNamesForopenFormat:JSON.stringify(ri),mailFormat:n.Utility.encodeText(p.value()),notify:ct,strDocAttach:n.context.getContext("DocumentAttachViaEmail_"+y.windowNo)};t.ajax({url:n.Application.contextUrl+"Email/SendMail",data:vt,datatype:"json",type:"post",cache:!1,async:!0,success:function(t){d[0].style.visibility="hidden";var i=JSON.parse(t);i==""?(y.dispose(),y=null,pt.dispose(),pt=null):window.setTimeout(function(){n.ADialog.info(i);i.contains("MailSent")&&n.context.setContext("DocumentAttachViaEmail_"+y.windowNo,"")},2)}})}function bt(n){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(n)}function vf(){var e,i,h,o,s;if(e=ht.val(),e==null||e==""||e.trim().length==0){n.ADialog.info(n.Msg.getMsg("PleaseAddSubject"));return}if(i=p.value(),i!=null&&i!=""&&i!=undefined&&!(i.trim().length<1)){if(h="",o={},v=u.getSelectedRows(),w=r.getRecords()[r.getCurrentRow()],u.singleRow==!1)for(s=0;s<v.length;s++)o[v[s][r.keyColumnName.toLower()]]=nu(i,s);else f>0?o[f]=er(i):o[w[r.keyColumnName.toLower()]]=er(i);d[0].style.visibility="visible";t.ajax({url:n.Application.contextUrl+"Email/SaveAttachment",datatype:"json",type:"post",cache:!1,data:{subject:e,AD_Table_ID:ei,html:n.Utility.encodeText(i),values:JSON.stringify(o)},success:function(){d[0].style.visibility="hidden";n.ADialog.info("Saved")},error:function(){n.ADialog.error("PotentiallyDangerous")}})}}function yf(){var i=p.value(),s,e,o,f;if(i!=null&&i!=""&&i!=undefined&&!(i.trim().length<1)){if(s="",e=[],v=u.getSelectedRows(),w=r.getRecords()[r.getCurrentRow()],u.singleRow==!1)for(o=0;o<v.length;o++)e.push(nu(i,o));else e.push(er(i));d[0].style.visibility="visible";f=window.open();f.document.write("<html><head>");f.document.write("<\/head><body >");f.document.write(i);f.document.write("<\/body><\/html>");f.print();t.ajax({url:n.Application.contextUrl+"Email/InsertAttachmentText",datatype:"json",type:"post",cache:!1,data:{html:n.Utility.encodeText(i),values:JSON.stringify(e)},success:function(n){var t,i;d[0].style.visibility="hidden";t=JSON.parse(n);ru=t;i="data:application/pdf;charset=utf-8;base64,"+ru;window.open(i);return}})}}function pf(){var t=new n.Openmailformat(u.gTab.getAD_Window_ID(),e);t.show();t.onClose=function(){var n=t.getSelectedRow();n!=null&&n!=undefined&&(wi=n.ad_texttemplate_id,ht.val(n.subject),n.isdynamiccontent=="Y"?et.prop("checked",!1).trigger("click"):et.prop("checked",!0).trigger("click"),bi=n.ad_window_id!=null&&n.ad_window_id!=undefined&&n.ad_window_id>0?!1:!0,or=n.name,p.value(n.mailtext))}}function au(){var i=p.value(),t;i!=null&&i.trim()!=""&&i!=undefined&&(t=new n.Newmailformat(e),t.show(),t.onClose=function(){or=t.getName();bi=t.saveForAll();vu(0)})}function wf(){var n=p.value();n!=null&&n!=""&&n!=undefined&&(wi>0?vu(wi):au())}function bf(){ut.empty();uu(!0);eu(!0)}function vu(i){var u={id:i,AD_Client_ID:fi.getAD_Client_ID(),AD_Org_ID:fi.getAD_Org_ID(),name:n.Utility.encodeText(or),isDynamic:et.prop("checked"),subject:n.Utility.encodeText(ht.val()),text:n.Utility.encodeText(p.value()),saveforAll:bi,AD_Window_ID:r.getAD_Window_ID(),folderName:rr,attachmentID:sr};t.ajax({type:"POST",url:n.Application.contextUrl+"Email/SaveFormats",data:u,success:function(n){wi=parseInt(n)}})}function kf(){k.is(":visible")?(k.hide(),ft.hide(),a.find(".vis-email-attachmentContainer").is(":visible")?a.find(".vis-Email-textarea-div").height(a.height()-365):a.find(".vis-Email-textarea-div").height(a.height()-180)):(k.show(),ft.show(),a.find(".vis-email-attachmentContainer").is(":visible")?a.find(".vis-Email-textarea-div").height(a.height()-440):a.find(".vis-Email-textarea-div").height(a.height()-255))}function yu(t,i){var h=!1,e={},o,i,s;if(e.To=st.val(),e.Cc=ft.val(),e.Bcc=[],k.val().contains(";"))for(o=k.val().split(";"),i=0;i<o.length;i++)o[i]!=null&&o[i]!=""&&e.Bcc.push(o[i]);else k.val()!=null&&k.val()!=""&&e.Bcc.push(k.val());if(ut!=null&&ut!=undefined)if(Object.keys(t).indexOf("email")>-1&&nt.indexOf(t.email)>-1)bt(t.email)||window.setTimeout(function(){n.ADialog.info("NotValidEmail",!0,":"+t.email);return},2),e.Bcc.push(t.email),h=!0;else if((!u.singleRow!=!1||v.length!=1)&&(!u.singleRow==!1||v.length>1))return;if(s=ht.val(),s.trim().length==0&&(s="  "),e.Subject=s,e.TableID=ei,e.Recordids=u.singleRow==!0?f:t[r.keyColumnName.toLower()],e.Body=u.singleRow==!1?nu(p.value(),i):er(p.value()),e.AttachmentFolder=rr,u.singleRow!=!0&&v.length!=1||h||lt)return e}function nu(t,i){for(var e=t,s={};e.indexOf("@@")>-1;){e=e.substring(e.indexOf("@@")+2);var h=e.substring(0,e.indexOf("@@")),o=null,f=Object.keys(u.getColumnNames()).filter(function(n){return u.getColumnNames()[n]===h})[0];f!=undefined&&f!=null&&(n.DisplayType.IsLookup(r.getField(f).getDisplayType())||n.DisplayType.Location==r.getField(f).getDisplayType()?v[i][f.toLower()]!=null&&v[i][f.toLower()]!=undefined&&(o=r.getField(f.toLower()).lookup.getDisplay(v[i][f.toLower()])):n.DisplayType.IsDate(r.getField(f).getDisplayType())?(o=r.getField(f).value,o=new Date(o).toLocaleString()):o=v[i][f.toLower()]);e=e.substring(e.indexOf("@@")+2);s["@@"+h+"@@"]=o}return s}function er(t){for(var f=t,o={};f.indexOf("@@")>-1;){f=f.substring(f.indexOf("@@")+2);var s=f.substring(0,f.indexOf("@@")),e=null,i=Object.keys(u.getColumnNames()).filter(function(n){return u.getColumnNames()[n]===s})[0];i!=undefined&&i!=null&&(n.DisplayType.IsLookup(r.getField(i).getDisplayType())||n.DisplayType.Location==r.getField(i).getDisplayType()?w[i.toLower()]!=null&&w[i.toLower()]!=undefined&&(e=r.getField(i.toLower()).lookup.getDisplay(w[i.toLower()])):n.DisplayType.IsDate(r.getField(i).getDisplayType())?(e=r.getField(i).value,e=new Date(e).toLocaleString()):e=u.singleRow==!0?r.getField(i).value:w[i.toLower()]);f=f.substring(f.indexOf("@@")+2);o["@@"+s+"@@"]=e}return o}function df(t,i){for(var s=t,e=t;e.indexOf("@@")>-1;){e=e.substring(e.indexOf("@@")+2);var h=e.substring(0,e.indexOf("@@")),o=null,f=Object.keys(u.getColumnNames()).filter(function(n){return u.getColumnNames()[n]===h})[0];f!=undefined&&f!=null&&(n.DisplayType.IsLookup(r.getField(f).getDisplayType())||n.DisplayType.Location==r.getField(f).getDisplayType()?v[i][f.toLower()]!=null&&v[i][f.toLower()]!=undefined&&(o=r.getField(f.toLower()).lookup.getDisplay(v[i][f.toLower()])):n.DisplayType.IsDate(r.getField(f).getDisplayType())?(o=r.getField(f).value,o=new Date(o).toLocaleString()):o=v[i][f.toLower()]);e=e.substring(e.indexOf("@@")+2);s=o!=null&&o!=undefined?s.replace("@@"+h+"@@",o):s.replace("@@"+h+"@@","")}return s}function gf(t){for(var f=t;f.indexOf("@@")>-1;){f=f.substring(f.indexOf("@@")+2);var o=f.substring(0,f.indexOf("@@")),e=null,i=Object.keys(u.getColumnNames()).filter(function(n){return u.getColumnNames()[n]===o})[0];i!=undefined&&i!=null&&(n.DisplayType.IsLookup(r.getField(i).getDisplayType())||n.DisplayType.Location==r.getField(i).getDisplayType()?w[i.toLower()]!=null&&w[i.toLower()]!=undefined&&(e=r.getField(i.toLower()).lookup.getDisplay(w[i.toLower()])):n.DisplayType.IsDate(r.getField(i).getDisplayType())?(e=r.getField(i).value,e=new Date(e).toLocaleString()):e=u.singleRow==!0?r.getField(i).value:w[i.toLower()]);f=f.substring(f.indexOf("@@")+2);t=t.replace("@@"+o+"@@",e)}return t}function ne(){var n=0;a.height(tu);a.width(gt);a.find(".contentArea").css("height",a.height()-44);a.find(".vis-Email-BccList").height(1);a.find(".vis-email-leftDiv").height(a.height()-44);tt?(a.find(".vis-email-attachmentContainer").is(":visible")?a.find(".vis-Email-textarea-div").height(a.height()-345):a.find(".vis-Email-textarea-div").height(a.height()-180),a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width()-85),n=a.width()-40):e?(a.find(".vis-email-attachmentContainer").is(":visible")?a.find(".vis-Email-textarea-div").height(a.height()-(a.find(".vis-email-attachmentContainer").height()+150)):a.find(".vis-Email-textarea-div").height(a.height()-(a.find(".vis-email-attachmentContainer").height()+50)),n=gt-(a.find(".vis-email-leftDiv").width()+30),a.find(".vis-Email-leftWrap").width(n-355),a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width()-45)):(a.find(".vis-Email-textarea-div").height(a.height()-155),p!=null&&p!=undefined,n=gt-(a.find(".vis-email-leftDiv").width()+30),a.find(".vis-Email-leftWrap").width(n-15),a.find(".vis-form-data-sub").width(n-40));ot!=null&&ot.css("width",n-10);p!=null&&p!=undefined&&(p.body.style.width=n-370+"px");tt||a.find(".vis-Email-BccList").height(a.find(".vis-Email-rytContent").height()-(a.find(".vis-Email-rytForm").height()+70))}var br,ir,fr,gr;this.frame=null;this.windowNo=n.Env.getWindowNo();var fi=n.Env.getCtx(),kt=null,ti="C_BPARTNER_ID",v=null,w=null,wi=0,or,bi,b=[],pu=[],ii=null,sr=0;l&&(sr=l);var hr=!0,lt=!1,ei=0,nt=[],tt=!1,ri=[],vi=[],at=null,a=null,rt=null,ot=null,yi=null,cr=null,vt=null,ut=null,et=null,st=null,k=null,ft=null,ki=null,di=null,ht=null,oi=null,p=null,gi=null,si=null,yt=null,hi=null,ci=null,li=null,wu=null,d,dt=t('<div class="vis-awindow-header vis-menuTitle">'),y=this,lr,nr,ar,vr,yr,pr,tu=0,gt=0,te=y.windowNo;a=t('<div class="vis-email-rootDiv"><\/div>');var wr=t('<div class="vis-email-rootDivBusy"><\/div>'),ni=t("<ul id='ulAttachmentOption' class='vis-apanel-rb-ul'>"),pt=null,iu=!1,tr=t("<div style='width: 100%;height: 100%;background:black;opacity: .1;display:none'>"),ai=null;ai=n.Application.isRTL?t("<div id='progress_bar' class='vis-ui-progress-bar ui-container' style='top:41%;width: 80%;right: 10%;'>"):t("<div id='progress_bar' class='vis-ui-progress-bar ui-container' style='top:41%;width: 80%;left: 9%;'>");tr.append(ai);br=t("<div class='vis-ui-progress' style='width: 0%; display: block;position:absolute;margin-top:2px'>");ai.append(br);ir=t("<span class='ui-label' >").append("0%");ai.append(ir);var kr=0,ui=0,rr=Date.now().toString(),ct=1048576,wt=0,pi=0,bu=[],ru="",it=null,g,ur=null;ku();this.initializeComponent=function(){var i=null,r;(e==!0?(i=t('<a href="javascript:void(0)"  class="vis-mainMenuIcons vis-icon-menuclose"><\/a>'),r=tt?t("<p>"+n.Msg.getMsg("EMail")+" ("+n.Msg.getMsg("Contacts")+") <\/p>"):t("<p>"+n.Msg.getMsg("EMail")+" ("+u.aPanel.$parentWindow.getName()+") <\/p>")):(i=t('<a href="javascript:void(0)"  class="vis-mainMenuIcons vis-icon-menuclose"><\/a>'),r=tt?t("<p>"+n.Msg.getMsg("Letter")+" ("+n.Msg.getMsg("Contacts")+") <\/p>"):t("<p>"+n.Msg.getMsg("Letter")+" ("+u.aPanel.$parentWindow.getName()+") <\/p>")),a.append(dt.append(i).append(r)),i.click(function(n){y.dispose();y=null;n.stopPropagation()}),gu(),tf()!=!1)&&(a.append(d),du(),tt||e&&uu(!1),tt||eu(!1),uf())};this.getRoot=function(){return a};fr=function(n){n?(tr.show(),ai.show()):(tr.hide(),ai.hide())};gr=function(i){for(var f,u,c,e,l,v,o,y,k,w,h,r=0;r<i.files.length;r++){if(g=i.files[r],g==undefined)return;if(g.size!=0){for(u in b)if(g.name==b[u].name){window.setTimeout(function(){n.ADialog.info("fileAlreadyAttached")},2);return}if(ri!=null)for(f=0;f<ri.length;f++)if(g.name==ri[f]){window.setTimeout(function(){n.ADialog.info("fileAlreadyAttached")},2);return}wt=0;for(u in b)wt+=b[u].size;if(wt+g.size>ct*24){window.setTimeout(function(){n.ADialog.info("MaxFileSize25MB")},2);return}if(g.size>ct*24){window.setTimeout(function(){n.ADialog.info("MaxFileSize25MB")},2);return}c={};e=t("<div style='margin-bottom:3px' class='vis-attach-file-wrapla'>");ii.children(0).append(e);l=t("<div class='vis-attach-file-top'>");v=t("<a class='vis-file-close-ico'>");l.append(v);e.append(l);ii.show();v.on("click",function(){var i=t(t(this).parent()).parent(),r=i.html(),n;i.remove();i=null;for(n in b)if(String(r).indexOf(b[n].name)>-1){wt=wt-n.size;b.splice(n,1);break}vi.splice(0,vi.length);for(n in b)vi.push(b[n].name);su()||(a.find(".vis-attach-content-wrap").height(83),a.find(".vis-email-attachmentContainer").height(90),tt?a.find(".vis-Email-textarea-div").height(t(".vis-Email-ContentArea").height()-(t(".vis-form-horizontal").height()+30)):a.find(".vis-Email-textarea-div").height(t(".vis-Email-ContentArea").height()-(t(".vis-form-horizontal").height()+50)));b.length==0&&(a.find(".vis-email-attachmentContainer").hide(),a.find(".vis-email-attachmentContainer").height(90),a.find(".vis-attach-content-wrap").height(83),tt?a.find(".vis-Email-textarea-div").height(t(".vis-Email-ContentArea").height()-(t(".vis-form-horizontal").height()+30)):a.find(".vis-Email-textarea-div").height(t(".vis-Email-ContentArea").height()-(t(".vis-form-horizontal").height()+50)));ui--});o=t("<div class='vis-attach-file-content'>");e.append(o);y=t("<div class='vis-attach-file-icon'>");k=hu(g.name);y.append(t("<img src='"+k+"'>"));o.append(y);var p=t("<div class='vis-attach-file-text' style='margin-bottom:10px'>"),d="",s=t("<p>");g.name.length>17?(d=g.name.toString().substr(0,17),s.append(d),w=t("<a href='javascript:void(0)' class='VIS_Pref_tooltip'>").append("..."),h=t("<span style='width: inherit;'>"),h.append(t("<img class='VIS_Pref_callout'>").attr("src",n.Application.contextUrl+"Areas/VIS/Images/email-ccc.png").append("ToolTip Text")),h.append(t("<label class='VIS_Pref_Label_Font'>").append(g.name)),w.append(h),s.append(w)):s.append(g.name);p.append(s);p.append(t("<p>").append((Number(g.size)/1024).toFixed(2)+"KB"));o.append(p);c.Name=g.name;c.Size=g.size;b.push(g);su()&&a.find(".vis-email-attachmentContainer").height()==90&&(a.find(".vis-email-attachmentContainer").height(155),a.find(".vis-attach-content-wrap").height(145))}}};var hu=function(t){var r,u,i;return t==null||t.length==0?"":(r=t.lastIndexOf("."),u=n.Application.contextUrl+"Areas/VIS/Images/",r<1)?u+"defult.png":(i=t.substr(r,t.length-r),u+(i==".xlsx"||i==".xls"?"excel.png":i==".html"||i==".htm"?"html.png":i==".pdf"?"pdf.png":i==".ppt"?"ppt.png":i==".txt"?"text.png":i==".docx"||i==".doc"?"word.png":i==".xml"?"xml.png":"defult.png"))},ie=function(i,r){var s=t("<div class='vis-attach-file-wrapla'>"),h,c,u,f,l,v,o;ii.append(s);h=t("<div class='vis-attach-file-top'>");c=t("<a class='vis-file-close-ico'>");h.append(c);s.append(h);c.on("click",function(){var n=t(t(this).parent()).parent(),r,i;n.css("display","none");r=n.html();n.empty();n=null;for(i in ri)if(String(r).indexOf(ri[i])>-1){ri.splice(i,1);break}});u={};f=t("<div class='vis-attach-file-content'>");s.append(f);l=t("<div class='vis-attach-file-icon'>");l.append(t("<img src='"+hu(i)+"'>"));f.append(l);var a=t("<div class='vis-attach-file-text'  style='margin-bottom:10px'>"),y="",e=t("<p>");i.length>17?(y=i.toString().substr(0,17),e.append(y),v=t("<a href='javascript:void(0)' class='VIS_Pref_tooltip'>").append("..."),o=t("<span style='width: inherit;'>"),o.append(t("<img class='VIS_Pref_callout'>").attr("src",n.Application.contextUrl+"Areas/VIS/Images/email-ccc.png").append("ToolTip Text")),o.append(t("<label class='VIS_Pref_Label_Font'>").append(i)),v.append(o),e.append(v)):e.append(i);a.append(e);a.append(t("<p>").append((Number(r)/1024).toFixed(2)+"KB"));f.append(a);u.Name=i;u.Line_ID=0;u.HaveSource=!1;u.Source=null;u.IsDeleted=!1;pu.push(u)},cu=function(){var t=null,i=0,r=0,n;wt=0;for(n in b)i=parseInt(b[n].size/ct),g.size%ct>0&&i++,wt+=i,r+=b[n].size,t={},vi.push(b[n].name),t.Name=b[n].name,t.Size=b[n].size,bu.push(t);r>ct*24||(fr(!0),lu())},lu=function(){var t,i,r;if((b==null||b.length==0)&&(fr(!1),a.find(".vis-email-attachmentContainer").hide(),a.find(".vis-Email-textarea-div").height(a.find(".vis-Email-textarea-div").height()+(a.find(".vis-email-attachmentContainer").height()+13)),window.setTimeout(function(){n.ADialog.info("NothingToUpload");return},2)),ui>=b.length){fr(!1);return}t=new XMLHttpRequest;i=new FormData;i.append("file",b[ui].slice(pi*ct,pi*ct+Number(ct)));t.open("POST",n.Application.contextUrl+"Email/SaveAttachmentinTemp?filename="+b[ui].name+"&folderKey="+rr,!1);t.send(i);kr++;pi++;r=parseInt(b[ui].size/ct);b[ui].size%ct>0&&r++;pi==r&&(ui++,pi=0);kr<=wt&&sf(parseInt(kr/wt*100));window.setTimeout(function(){lu()},2)},sf=function(n){br.css("width",n+"%");ir.empty();ir.append(n+"%")};this.show=function(){kt=new n.ChildDialog;kt.setHeight(800);kt.setWidth(1600);kt.setTitle(n.Msg.getMsg("EMail"));kt.setModal(!0);kt.show();kt.setContent(a);initializeComponent()};this.disposeComponent=function(){fi=null;kt=null;ti="";v=null;w=null;ei=0;nt=null;tt||(hi!=null&&hi.off("click"),si!=null&&si.off("click"),li!=null&&li.off("click"),ci!=null&&ci.off("click"),vt!=null&&vt.off("click"),at!=null&&at.remove(),vt!=null&&vt.remove(),ut!=null&&ut.remove(),et!=null&&et.remove(),oi!=null&&oi.remove());yt!=null&&yt.off("click");it!=null&&it!=undefined&&(it.off("change"),it.off("click"));at=null;a!=null&&a.remove();a=null;rt!=null&&rt.remove();rt=null;ot!=null&&ot.remove();ot=null;yi!=null&&yi.remove();yi=null;vt=null;ut=null;et=null;e&&(st!=null&&st.remove(),st=null,k!=null&&k.remove(),k=null,ft!=null&&ft.remove(),ft=null);ht!=null&&ht.remove();ht=null;oi=null;p!=null&&p!=undefined&&p.destroy();p=null;gi!=null&&gi.remove();gi=null;si=null;yt=null;wu=null;hi=null;li=null;ci=null};this.sizeChanged=function(n,t){tu=n;gt=t;iu==!0&&ne()};this.ShowDMSDocumentAttchment=function(){var r=null,f=null,u,i;if(cr.children().remove(),u=t("<ul><\/ul>"),n.context.getContext("DocumentAttachViaEmail_"+y.windowNo)!=""){for(ur.empty(),ur.append(n.Msg.getMsg("Documents")),r=n.context.getContext("DocumentAttachViaEmail_"+y.windowNo).split(","),i=0;i<r.length;i++)r[i].trim()!=""&&(f=r[i].split("-"),u.append("<Li><input type='checkbox' checked value='"+f[0]+"'> "+f[1]+"<\/Li>"));cr.append(u)}else ur.empty();u.on("click","input",function(){var r="",e=t(this).attr("value"),o,u,i,f;if(t(this).is(":checked"))t(this).is(":checked")&&(f=e+"-"+t(this).text(),r=n.context.getContext("DocumentAttachViaEmail_"+y.windowNo)+(r!=""?","+f:f));else for(o=n.context.getContext("DocumentAttachViaEmail_"+y.windowNo).split(","),u=jQuery.grep(o,function(n){if(!n.trim().contains(e.toString().trim()))return n}),i=0;i<u.length;i++)r+=i==0?u[i].trim():","+u[i].trim();n.context.setContext("DocumentAttachViaEmail_"+y.windowNo,r)})};this.IsBusy=function(n){n?wr.css("display","block"):wr.css("display","none");wr.appendTo(a)}}i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;t.hideHeader(!0);this.initializeComponent();this.frame.getContentGrid().append(this.getRoot())};i.prototype.refresh=function(){this.ShowDMSDocumentAttchment()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Email=i}(VIS,jQuery),function(n,t){n.Newmailformat=function(i){function s(){var r,i;e=t("<div  ><\/div>");var o=t("<div><\/div>"),s=t('<div style="overflow:auto;margin-bottom:10px"><\/div>'),h=t('<p  style="float:left;margin-right:10px"  >'+n.Msg.getMsg("Name")+"<\/p>");u=t('<input type="text" style="float:left;margin-right:4px" ><\/input>');s.append(h).append(u);f=t('<input type="checkbox" style="float:right"><\/input>');r=t('<p  style="float:right;margin-bottom:0px;margin-right:4px"  >'+n.Msg.getMsg("ForAllWindows")+"<\/p>");i=t("<div><\/div>");n.Application.isRTL&&(h.css({float:"right","margin-right":"0px","margin-left":"0px"}),u.css({float:"right","margin-right":"10px","margin-left":"0px"}),f.css("float","left"),r.css({float:"left","margin-right":"5px"}),i.css({float:"right","margin-bottom":"-5px"}));i.append(r).append(f);o.append(s).append(i);e.append(o)}function h(){return u.val()==null||u.val()==""?(n.ADialog.info(n.Msg.getMsg("FileNameMendatory")),!1):(o.onClose(),!0)}function c(){e.remove();e=null;u.remove();u=null;f.remove();f=null;r=null}var e,u,f,r,o=this;s();this.show=function(){r=new n.ChildDialog;i?r.setTitle(n.Msg.getMsg("EmailFormats")):r.setTitle(n.Msg.getMsg("LetterFormats"));r.setModal(!0);r.setContent(e);r.show();r.onOkClick=h;r.onClose=c};this.getName=function(){return u.val()};this.saveForAll=function(){return f.prop("checked")}}}(VIS,jQuery),function(n,t){n.Openmailformat=function(i,r){function l(){f=" SELECT NAME        ,";f+=" nvl(SUBJECT,' ')  as SUBJECT          ,";f+=" nvl(MAILTEXT,' ')     as MAILTEXT    ,";f+=" nvl(CREATED,sysdate)         as CREATED  , ";f+=" AD_CLIENT_ID      ,";f+="  AD_ORG_ID         ,";f+=" CREATEDBY         ,";f+="  nvl(ISACTIVE,'Y')         as ISACTIVE ,";f+=" nvl(ISHTML,'Y')          as ISHTML  ,";f+="  AD_TEXTTEMPLATE_ID,";f+="  nvl( UPDATED,sysdate)         as UPDATED  ,";f+="  UPDATEDBY         ,";f+="  AD_Window_ID         ,";f+="  nvl(ISDYNAMICCONTENT,'N') as ISDYNAMICCONTENT";f+="   FROM ad_texttemplate";f+="   WHERE isactive='Y' and AD_Window_ID IS NULL ";i>0&&(f+=" OR AD_Window_ID="+i);u=n.DB.executeDataSet(f)}function a(){var n=w2ui.openformatgrid.getSelection();return s=w2ui.openformatgrid.get(n),h.onClose(),!0}function v(){u=null;f=null;e=null;w2ui.openformatgrid!=undefined&&w2ui.openformatgrid.destroy();o.remove()}var f,u=null,s={},h=this,c=[],o,e;this.onClose=null;l();this.show=function(){var f,y,c,s,l,i,h;for(o=t('<div  style="height:305px"><\/div>'),e=new n.ChildDialog,n.Application.isRTL?e.setHeight(435):e.setHeight(430),e.setWidth(850),r?e.setTitle(n.Msg.getMsg("EmailFormat")):e.setTitle(n.Msg.getMsg("LetterFormat")),e.setModal(!0),e.setContent(o),e.show(),e.onOkClick=a,e.onClose=v,f=[],i=0;i<u.tables[0].columns.length;i++)u.tables[0].columns[i].name=="name"?f.push({field:u.tables[0].columns[i].name,caption:n.Msg.getMsg("Name"),size:"150px",hidden:!1}):u.tables[0].columns[i].name=="subject"?f.push({field:u.tables[0].columns[i].name,caption:n.Msg.getMsg("Subject"),size:"150px",hidden:!1}):u.tables[0].columns[i].name=="mailtext"?f.push({field:u.tables[0].columns[i].name,caption:n.Msg.getMsg("Mailtext"),size:"150px",hidden:!1}):u.tables[0].columns[i].name=="created"?f.push({field:u.tables[0].columns[i].name,caption:n.Msg.getMsg("Created"),size:"150px",hidden:!1}):u.tables[0].columns[i].name=="isdynamiccontent"?f.push({field:u.tables[0].columns[i].name,caption:n.Msg.getMsg("IsDynamicContent"),size:"150px",hidden:!1}):f.push({field:u.tables[0].columns[i].name,caption:n.Msg.getMsg(u.tables[0].columns[i].name),size:"100px",hidden:!0});for(y=[],c=[],u.tables[0].rows.length>0&&(c=Object.keys(u.tables[0].rows[0].cells)),s=0;s<u.tables[0].rows.length;s++){for(l={},l.recid=s,i=0;i<c.length;i++)h=c[i],l[h]=h=="mailtext"?u.tables[0].rows[s].cells[h]:n.Utility.encodeText(u.tables[0].rows[s].cells[h]);y.push(l)}o.w2grid({name:"openformatgrid",recordHeight:30,show:{selectColumn:!0},multiSelect:!1,columns:f,records:y})};this.getSelectedRow=function(){return s};this.getAttachments=function(){return c}}}(VIS,jQuery),function(n,t){function e(i,r,u,f,e){var l=null,o=null,s=null,h=new n.ReportViewer(f,e),a=function(t){l=n.context.getAD_Client_ID();o="SELECT AD_PrintFormat_ID, Name, AD_Client_ID FROM AD_PrintFormat WHERE AD_Table_ID='"+t+"' AND IsTableBased='Y' ";u>0&&(o=o+" AND AD_Tab_ID='"+u+"' ");o=o+"ORDER BY AD_Client_ID DESC, IsDefault DESC, Name";o=n.MRole.getDefault().addAccessSQL(o,"AD_PrintFormat",n.MRole.SQL_NOTQUALIFIED,n.MRole.SQL_RO);s=null;var i=null,r=[];try{for(s=n.DB.executeReader(o,null,null);s.read();)n.Utility.Util.getValueOfInt(s.get(2).toString())==l&&(i={},i.Key=n.Utility.Util.getValueOfInt(s.get(0)),i.Name=s.getString(1),r.push(i));s.close();r.length==0?i==null?c(null,t,t):c(i,0,t):c(r[0],0,t)}catch(f){s.close()}},c=function(i,f,e){var o=[],s;o.push(r.getTableName());o.push(r.getWhereClause(!0));u&&o.push(u.toString());s=null;s=i!=null?i.Key:f;t.ajax({url:n.Application.contextUrl+"JsonData/GenerateReport/",dataType:"json",data:{id:s,queryInfo:JSON.stringify(o),code:r.getCode(0),isCreateNew:f>0&&u>0,nProcessInfo:JSON.stringify(""),pdf:!1,csv:!1},success:function(t){t==null&&alert(n.Msg.getMsg("ERRORGettingRepData"));var u=jQuery.parseJSON(t);if(u.IsError){n.ADialog.error(u.ErrorText);h.close();return}u.HTML&&u.HTML.length>0&&(h.show(u.HTML,u.AD_PrintFormat_ID,i,e,o,r.getCode(0)),h.setReportBytes(u.Report))}})};a(i)}function o(i,r){function gt(){var n=window.open();n.document.write('<html dir="RTL"><head>');n.document.write("<\/head><body >");n.document.write(ct);n.document.write("<\/body><\/html>");n.print();n.close()}var c=t("<div style='height:100%;width:100%;'>"),e=null,w=null,l=null,u=null,b=null,k=null,d=null,g=null,nt=null,a=null,v=null,s=null,ct=null,y=null,kt=null,tt=null,p=null,rt=null,lt=n.Env.getScreenHeight()-50,ot=t(window).width(),dt=this,st,pt,wt,et,h,ht;s=new n.CFrame;s.setName(n.Msg.getMsg("Report"));s.setTitle(n.Msg.getMsg("Report"));var ut=null,at=t("<div>"),it=t("<ul class='vis-apanel-rb-ul'>");at.append(it);var vt=!1,o=[],yt=null;this.setReportBytes=function(n){yt=n};this.getRoot=function(){return c};this.dispose=function(){};this.show=function(t,i,r,u,f,e){kt=r;tt=u;p=f;y=i;rt=e;vt=n.MRole.getDefault().getIsCanExport(tt);vt?(v.css("display","block"),a.css("display","block")):(v.css("display","none"),a.css("display","none"));ft(t)};st=function(){c.empty();c.remove();u.empty();e.empty();e.remove();s&&(s.dispose(),s=null);c=null;e=null;w=null;l=null;u=null;b=null;k=null;d=null;g=null;nt=null};this.close=function(){st()};pt=function(){n.Application.isRTL?(e=t("<div class='vis-report-header' style='padding-right: 10px;padding-left:0px;'>").append(t('<h3 class="vis-report-tittle" style="float:right;padding-top: 10px;">').append(n.Msg.getMsg("Report"))),w=t('<a href="javascript:void(0)" class="vis-mainMenuIcons vis-icon-menuclose" style="float:left">'),l=t('<div class="vis-report-top-icons" style="float:left;">'),u=t('<ul style="margin-top: 10px;">'),l.append(u),nt=t('<li><a style="cursor:pointer;" class="vis-report-icon vis-print-ico"><\/a><\/li>'),u.append(nt),g=t("<li><a style='cursor:pointer;' class='vis-report-icon vis-customize-ico'><\/a><\/li>"),u.append(g),d=t("<li><a style='cursor:pointer;' class='vis-report-icon vis-search-ico'><\/a><\/li>"),u.append(d),k=t("<li><a style='cursor:pointer;' class='vis-report-icon vis-requery-ico'><\/a><\/li>"),u.append(k),b=t("<li><a style='cursor:pointer;' class='vis-report-icon vis-archive-ico'><\/a><\/li>"),u.append(b),a=t("<li><a style='cursor:pointer;' class='vis-report-icon vis-savepdf-ico'><\/a><\/li>"),u.append(a),v=t("<li><a style='cursor:pointer;' class='vis-report-icon vis-savecsv-ico'><\/a><\/li>"),u.append(v),ut=t("<li><a style='cursor:pointer;' class='vis-report-icon vis-repformat-ico'><\/a><\/li>"),u.append(ut),e.append(w),e.append(l),c.append(e)):(e=t("<div class='vis-report-header' style='padding-left: 10px;padding-right: 0px;'>").append(t('<h3 class="vis-report-tittle" style="float:left;padding-top: 10px;">').append(n.Msg.getMsg("Report"))),w=t('<a href="javascript:void(0)" class="vis-mainMenuIcons vis-icon-menuclose" style="float:right">'),l=t('<div class="vis-report-top-icons" style="float:right;">'),u=t('<ul style="margin-top: 10px;">'),l.append(u),ut=t("<li><a style='cursor:pointer;' class='vis-report-icon vis-repformat-ico'><\/a><\/li>"),u.append(ut),v=t("<li><a style='cursor:pointer;' class='vis-report-icon vis-savecsv-ico'><\/a><\/li>"),u.append(v),a=t("<li><a style='cursor:pointer;' class='vis-report-icon vis-savepdf-ico'><\/a><\/li>"),u.append(a),b=t("<li><a style='cursor:pointer;' class='vis-report-icon vis-archive-ico'><\/a><\/li>"),u.append(b),k=t("<li><a style='cursor:pointer;' class='vis-report-icon vis-requery-ico'><\/a><\/li>"),u.append(k),d=t("<li><a style='cursor:pointer;' class='vis-report-icon vis-search-ico'><\/a><\/li>"),u.append(d),g=t("<li><a style='cursor:pointer;' class='vis-report-icon vis-customize-ico'><\/a><\/li>"),u.append(g),nt=t('<li><a style="cursor:pointer;" class="vis-report-icon vis-print-ico"><\/a><\/li>'),u.append(nt),e.append(w),e.append(l),c.append(e));wt()};wt=function(){w.on("click",function(){st()});nt.on("click",function(){gt()});g.on("click",function(){var t=new n.Query;t.addRestriction("AD_PrintFormat_ID",n.Query.prototype.EQUAL,y);n.viewManager.startWindow(240,t)});k.on("click",function(){h.empty();h.css("width","0px");bt()});a.on("click",function(){ni()});v.on("click",function(){ti()});ut.on("click",function(){var i,r,u;for(it.empty(),i=0;i<o.length;i++)r=o[i].IsDefault=="Y"?"vis-favitmchecked":"vis-favitmunchecked",u=t('<li><a data-isdefbtn="no" data-id="'+o[i].ID+'">'+o[i].Name+'<\/a><a data-isdefbtn="yes" data-id="'+o[i].ID+'" style="min-height: 16px;display: inline-block;margin-left: 5px;min-width: 16px;margin-top: 0px" class="vis-menufavitm '+r+'" > <\/a><\/li>'),it.append(u);it.append(t('<li><a data-id="-1">'+n.Msg.getMsg("NewReport")+"<\/a>"));t(this).w2overlay(at.clone(!0),{css:{height:"300px"}})});it.on("click","LI",function(i){var l=t(i.target),u=l.data("id"),e,s,c;if(l.data("isdefbtn")=="yes"){for(e="UPDATE AD_PrintFormat SET IsDefault='N' WHERE IsDefault='Y' AND AD_Table_ID="+tt+" AND AD_Tab_ID="+r.getAD_Tab_ID(),n.DB.executeQuery(e),e="UPDATE AD_PrintFormat SET IsDefault='Y' WHERE AD_PrintFormat_ID="+u,n.DB.executeQuery(e),s=0;s<o.length;s++)o[s].IsDefault=o[s].ID==u?"Y":"N";return}y=u;h.empty();h.css("width","0px");f(!0);c=!1;u==-1&&(u=tt,c=!0);t.ajax({url:n.Application.contextUrl+"JsonData/GenerateReport/",dataType:"json",data:{id:u,queryInfo:JSON.stringify(p),code:rt,isCreateNew:c,nProcessInfo:JSON.stringify(""),pdf:!1,csv:!1},success:function(t){t==null&&alert(n.Msg.getMsg("ERRORGettingRepData"));var i=jQuery.parseJSON(t);i.HTML&&i.HTML.length>0&&ft(i.HTML);y=i.AD_PrintFormat_ID;f(!1)}})});d.on("click",function(){var t=new n.Find(i,r,0);t.onClose=function(){if(t.getIsOKPressed()){var n=t.getQuery(),i=t.getCurrentDays(),r=t.getIsCreated();t.dispose();t=null;p[1]=n.getWhereClause(!0);bt()}};t.show()});b.on("click",function(){f(!0);t.ajax({url:n.Application.contextUrl+"JsonData/ArchiveDoc/",dataType:"json",type:"post",data:{AD_Process_ID:0,Name:p[0],AD_Table_ID:tt,Record_ID:0,C_BPartner_ID:0,isReport:!0,binaryData:yt},success:function(){n.ADialog.info("Archived",!0,"","");f(!1)}})})};var bt=function(){f(!0);t.ajax({url:n.Application.contextUrl+"JsonData/GenerateReport/",dataType:"json",data:{id:y,queryInfo:JSON.stringify(p),code:rt,isCreateNew:!1,nProcessInfo:JSON.stringify(""),pdf:!1,csv:!1},success:function(t){t==null&&alert(n.Msg.getMsg("ERRORGettingRepData"));var i=jQuery.parseJSON(t);i.HTML&&i.HTML.length>0&&ft(i.HTML);f(!1)}})},ni=function(){f(!0);t.ajax({url:n.Application.contextUrl+"JsonData/GenerateReport/",dataType:"json",data:{id:y,queryInfo:JSON.stringify(p),code:rt,isCreateNew:!1,nProcessInfo:JSON.stringify(""),pdf:!0,csv:!1},success:function(t){t==null&&alert(n.Msg.getMsg("ERRORGettingRepData"));var i=jQuery.parseJSON(t);i.HTML&&i.HTML.length>0?ft(i.HTML):window.open(n.Application.contextUrl+i.ReportFilePath);f(!1)}})},ti=function(){f(!0);t.ajax({url:n.Application.contextUrl+"JsonData/GenerateReport/",dataType:"json",data:{id:y,queryInfo:JSON.stringify(p),code:rt,isCreateNew:!1,nProcessInfo:JSON.stringify(""),pdf:!1,csv:!0},success:function(t){t==null&&alert(n.Msg.getMsg("ERRORGettingRepData"));var i=jQuery.parseJSON(t);i.HTML&&i.HTML.length>0?ft(i.HTML):window.open(n.Application.contextUrl+i.ReportFilePath);f(!1)}})},ft=function(i){var e,s,c,l,b;it.empty();e="SELECT AD_PrintFormat_ID, Name, Description,IsDefault FROM AD_PrintFormat WHERE AD_Table_ID="+tt;r.getAD_Tab_ID()>0&&(e=e+" AND AD_Tab_ID="+r.getAD_Tab_ID());e=e+" ORDER BY Name";e=n.MRole.getDefault().addAccessSQL(e,"AD_PrintFormat",n.MRole.SQL_NOTQUALIFIED,n.MRole.SQL_RO);var u=null,p=[],a=-1;try{for(u=n.DB.executeReader(e,null,null),o=[];u.read();)a=parseInt(a)+1,s=u.getString(1),p.indexOf(s)>-1&&(s=s+"_"+(parseInt(a)+1)),c={},c.ID=n.Utility.Util.getValueOfInt(u.get(0)),c.Name=s,c.IsDefault=u.getString(3),p.push(u.getString(1)),o.push(c);u.close()}catch(k){u.close()}u=null;h.html(i);h.css("min-width",ot+"px");ct=i;var w=document.getElementsByClassName("vis-reptabledetect"),v=0,y=0;for(l=0,b=w.length;l<b;l++)y=t(w[l]).width(),y>v&&(v=y);h.css("width",v+50);f(!1)},f=function(n){ht.css("display",n?"block":"none")};pt();et=t("<div Style='height:"+lt+"px;width:"+ot+"px;overflow:auto;background:#63BFE9;float:left;'>");h=t("<div Style='height:"+lt+"px;width:"+ot+"px;'>");et.append(h);ht=t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>");f(!0);et.append(ht);c.append(et);s.hideHeader(!0);s.setContent(dt);s.show()}function s(u,e,o,s){function h(i,r){t.ajax({url:n.Application.contextUrl+"JsonData/GeneratePrint/",dataType:"json",data:{AD_Process_ID:u,Name:"Print",AD_Table_ID:e,Record_ID:o,WindowNo:s,csv:i},success:function(t){t==null&&alert(n.Msg.getMsg("ERRORGettingRepData"));var i=jQuery.parseJSON(t);if(r&&r(),i.IsError){n.ADialog.error(i.ErrorText);return}i.ReportFilePath&&window.open(n.Application.contextUrl+i.ReportFilePath)}})}this.start=function(n){i.off("click");r.off("click");i.on("click",function(){h(!0)});r.on("click",function(){h(!1)});n.w2overlay(f.clone(!0),{css:{height:"300px"}})};this.startPdf=function(n){h(!1,n)};this.startCsv=function(n){h(!0,n)}}var f=t('<div style="width:100%;height:100%">'),u=t("<ul class='vis-apanel-rb-ul'  style='width:100%;height:100%'>"),i,r;f.append(u);i=t("<li>").append(n.Msg.getMsg("OpenCSV"));u.append(i);r=t("<li>").append(n.Msg.getMsg("OpenPDF"));u.append(r);n.ReportViewer=o;n.AReport=e;n.APrint=s}(VIS,jQuery),function(n,t){n.AttachmentHistory=function(i,r,u,f,e){function vf(){o=t("<div>");o.css({position:"absolute",bottom:"0",background:"url('"+n.Application.contextUrl+"Areas/VIS/Images/busy.gif') no-repeat","background-position":"center center",width:"98%",height:"98%","text-align":"center",opacity:".1"});o[0].style.visibility="hidden";sr.append(o)}function yf(){sr=t('<div style="height:100%">');b=t('<div class="vis-history-inboxDiv">');ht=t('<div style="display:none" class="vis-history-mainRelatedDiv">');ci=t('<div style="display:none" class="vis-history-mainRelatedDiv">');hr=t('<div class="vis-attachhistory-content-wrap">');tu=t('<div class="vis-attachhistory-left-wrap">');cr=t('<div class="vis-attachhistory-table-top">');li=t('<div class="vis-attachhistory-search-wrap">');su=t('<div class="vis-attachhistory-search">').append(' <input placeholder="'+n.Msg.getMsg("Search")+'" type="text">').append('<span class="vis-attachhistory-search-icon"><\/span>');li.append('<img class="prthistory" style="margin-top:15px;margin-left:40px" title="'+n.Msg.getMsg("Print")+'" src="'+n.Application.contextUrl+'Areas/vis/Images/history-print.png"  />').append(su);a=t('<div class="vis-attachhistory-right-wrap">');p=t('<div class="vis-attachhistory-right-wrap">').hide();fu==!0?p.append('<label class="vis-attachhistory-noRecFoundforIP" > '+n.Msg.getMsg("NoRecordFound")+" <\/label>"):p.append('<label class="vis-attachhistory-noRecFound" > '+n.Msg.getMsg("NoRecordFound")+" <\/label>");iu=t('<div class="vis-attachhistory-apanel-tabcontrol">');ai=t('<ul class="vis-attachhistory-appsaction-ul vis-attachhistory-apanel-tabcontrol-ul">');ai.append('<li data-type="History" class="vis-attachhistory-apanel-tab-selected" style="opacity: 1;">'+n.Msg.getMsg("History")+'<\/li><li  data-type="RelatedHistory"  style="opacity: 1;">'+n.Msg.getMsg("RelatedHistory")+"<\/li>");u>0&&ai.append('<li  data-type="UserHistory"  style="opacity: 1;">'+n.Msg.getMsg("UserHistory")+"<\/li>");cr.append(iu.append(ai));ru=t('<div class="vis-attachhistory-table-wrap">').append(b).append(ht).append(ci).append(dr);sr.append(hr.append(tu.append(cr).append(ru)));hr.append(li).append(a).append(p);rt=li.find("input");af=su.find(".prthistory");yt=t('<ul class="vis-his-attachs">');eu=t("<ul class='vis-apanel-rb-ul'>");eu.append('<li style="display:none" data-type="R"><a><span class="vis-attachhistory-email-icon vis-attachhistory-reply-icon"><\/span>'+n.Msg.getMsg("Reply")+'<\/a><\/li> <li data-type="F"><a style="color: rgb(111, 111, 111); "><span class="vis-attachhistory-email-icon vis-attachhistory-forword-icon"><\/span>'+n.Msg.getMsg("Forward")+"<\/a><\/li>")}function pf(){dr=t('<ul style="float:right;margin-top:10px" class="vis-statusbar-ul">');tt=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageFirst16.png" alt="First Page" title="First Page" style="opacity: 0.6;"><\/div><\/li>');it=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageUp16.png" alt="Page Up" title="Page Up" style="opacity: 0.6;"><\/div><\/li>');vt=t('<li><select class="vis-statusbar-combo"><\/select><\/li>');ot=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageDown16.png" alt="Page Down" title="Page Down" style="opacity: 0.6;"><\/div><\/li>');et=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageLast16.png" alt="Last Page" title="Last Page" style="opacity: 0.6;"><\/div><\/li>');dr.append(tt).append(it).append(vt).append(ot).append(et)}function nf(t){var u,e,f;for(o[0].style.visibility="visible",u="SELECT count(*) FROM (( SELECT ai.AppointmentsInfo_ID AS ID, ai.record_ID, ai.created,'"+n.Msg.getMsg("Appointment")+"' AS TYPE, subject  FROM AppointmentsInfo ai JOIN AD_User au on au.AD_User_ID=ai.createdby WHERE ai.record_Id ="+r,t!="undefined"&&t!=null&&t!=""&&(u+=" AND upper(ai.Subject)  like upper('%"+t+"%')"),u+=" AND ai.IsTask='N' And ai.Ad_Table_Id = "+i+" And ai.AD_User_ID = "+or.getAD_User_ID()+")   UNION( SELECT ai.AppointmentsInfo_ID AS ID, ai.record_ID, ai.created,'"+n.Msg.getMsg("Task")+"' AS TYPE, subject  FROM AppointmentsInfo ai JOIN AD_User au on au.AD_User_ID=ai.createdby WHERE ai.record_Id ="+r,t!="undefined"&&t!=null&&t!=""&&(u+=" AND upper(ai.Subject)  like upper('%"+t+"%')"),u+=" AND ai.IsTask='Y' And ai.Ad_Table_Id = "+i+" And ai.AD_User_ID = "+or.getAD_User_ID()+")   UNION SELECT MAILATTACHMENT1_ID AS ID, record_ID,created,'"+n.Msg.getMsg("SentMail")+"' AS TYPE, TITLE AS Subject FROM mailattachment1 WHERE record_id="+r,t!="undefined"&&t!=null&&t!=""&&(u+=" AND ((upper(ai.title)  like upper('%"+t+"%')) OR (upper(ai.mailaddressfrom) like upper('%"+t+"%')) OR (upper(mailaddress) like upper('%"+t+"%')) OR (upper(mailaddressbcc) like upper('%"+t+"%')) OR (upper(mailaddresscc) like upper('%"+t+"%')))"),u+=" And attachmenttype='M' And ad_table_id="+i+" UNION SELECT MAILATTACHMENT1_ID AS ID, record_ID,created,'"+n.Msg.getMsg("InboxMail")+"' AS TYPE, TITLE AS Subject FROM mailattachment1 WHERE record_id="+r,t!="undefined"&&t!=null&&t!=""&&(u+=" AND ((upper(ai.title)  like upper('%"+t+"%')) OR (upper(ai.mailaddressfrom) like upper('%"+t+"%')) OR (upper(mailaddress) like upper('%"+t+"%')) OR (upper(mailaddressbcc) like upper('%"+t+"%')) OR (upper(mailaddresscc) like upper('%"+t+"%')))"),u+=" And attachmenttype='I' And ad_table_id="+i+" UNION SELECT MAILATTACHMENT1_ID AS ID, record_ID,created,'"+n.Msg.getMsg("Letter")+"' AS TYPE, TITLE AS Subject FROM mailattachment1  WHERE record_id="+r,t!="undefined"&&t!=null&&t!=""&&(u+=" AND upper(ai.title)  like upper('%"+t+"%')"),u+=" And attachmenttype='L' And ad_table_id="+i+") ORDER BY created DESC",vu=n.DB.executeScalar(u),e=parseInt(vu/ui),bt=e+(vu%ui>0?1:0),g=1,s=vt.find("select"),s.empty(),f=1;f<=bt;f++)s.append("<option>"+f+"<\/option>");tt.css("opacity","0.6");it.css("opacity","0.6")}function gi(t){var u="SELECT * FROM (( SELECT ai.AppointmentsInfo_ID AS ID, ai.record_ID, ai.created,'"+n.Msg.getMsg("Appointment")+"' AS TYPE,ai.Subject,au.name  FROM AppointmentsInfo ai JOIN AD_User au on au.AD_User_ID=ai.createdby WHERE ai.record_Id ="+r,f;t!="undefined"&&t!=null&&t!=""&&(u+=" AND upper(ai.Subject)  like upper('%"+t+"%')");u+=" AND ai.IsTask='N' And ai.Ad_Table_Id = "+i+" And ai.AD_User_ID = "+or.getAD_User_ID()+")   UNION( SELECT ai.AppointmentsInfo_ID AS ID, ai.record_ID, ai.created,'"+n.Msg.getMsg("Task")+"' AS TYPE,ai.Subject,au.name  FROM AppointmentsInfo ai JOIN AD_User au on au.AD_User_ID=ai.createdby WHERE ai.record_Id ="+r;t!="undefined"&&t!=null&&t!=""&&(u+=" AND upper(ai.Subject)  like upper('%"+t+"%')");u+=" AND ai.IsTask='Y' And ai.Ad_Table_Id = "+i+" And ai.AD_User_ID = "+or.getAD_User_ID()+")   UNION SELECT ai.MAILATTACHMENT1_ID AS ID, ai.record_ID,ai.created,'"+n.Msg.getMsg("SentMail")+"' AS TYPE, ai.TITLE AS Subject,au.name  FROM mailattachment1 ai JOIN AD_User au on au.AD_User_ID=ai.createdby WHERE ai.record_id="+r;t!="undefined"&&t!=null&&t!=""&&(u+=" AND ((upper(ai.title)  like upper('%"+t+"%')) OR (upper(ai.mailaddressfrom) like upper('%"+t+"%')) OR (upper(mailaddress) like upper('%"+t+"%')) OR (upper(mailaddressbcc) like upper('%"+t+"%')) OR (upper(mailaddresscc) like upper('%"+t+"%')))");u+=" And ai.attachmenttype='M' And ai.ad_table_id="+i+" UNION SELECT ai.MAILATTACHMENT1_ID AS ID, ai.record_ID,ai.created,'"+n.Msg.getMsg("InboxMail")+"' AS TYPE, ai.TITLE AS Subject,au.name  FROM mailattachment1 ai JOIN AD_User au on au.AD_User_ID=ai.createdby WHERE ai.record_id="+r;t!="undefined"&&t!=null&&t!=""&&(u+=" AND ((upper(ai.title)  like upper('%"+t+"%')) OR (upper(ai.mailaddressfrom) like upper('%"+t+"%')) OR (upper(mailaddress) like upper('%"+t+"%')) OR (upper(mailaddressbcc) like upper('%"+t+"%')) OR (upper(mailaddresscc) like upper('%"+t+"%')))");u+=" And ai.attachmenttype='I' And ai.ad_table_id="+i+" UNION SELECT ai.MAILATTACHMENT1_ID AS ID, ai.record_ID,ai.created,'"+n.Msg.getMsg("Letter")+"' AS TYPE, ai.TITLE AS Subject,au.name  FROM mailattachment1 ai JOIN AD_User au on au.AD_User_ID=ai.createdby WHERE ai.record_id="+r;t!="undefined"&&t!=null&&t!=""&&(u+=" AND upper(ai.title)  like upper('%"+t+"%')");u+=" And ai.attachmenttype='L' And ai.ad_table_id="+i+") ORDER BY created DESC";f=n.DB.executeDataSetPaging(u,g,ui);f!=null&&f.getTables().length>0&&kf(f)}function nr(i){(i==undefined||i==null)&&(i="");t.ajax({url:n.Application.contextUrl+"AttachmentHistory/RelatedHistory",datatype:"json",type:"get",cache:!1,data:{keyColumnID:r,pageSize:ui,pageNo:k,searchText:n.Utility.encodeText(i),keyColName:e},success:function(n){var i=JSON.parse(n),r,t;if(bf(i),br==undefined||br==0||si==!0){for(br=i.TotalRecords,r=parseInt(br/ui),k=1,kt=r+(br%ui>0?1:0),s=vt.find("select"),s.empty(),t=1;t<=kt;t++)s.append("<option>"+t+"<\/option>");tt.css("opacity","0.6");it.css("opacity","0.6");gf()}else ne();o[0].style.visibility="hidden";si=!1},error:function(n){console.log(n);o[0].style.visibility="hidden";si=!1}})}function tr(i){(i==undefined||i==null)&&(i="");t.ajax({url:n.Application.contextUrl+"AttachmentHistory/UserHistory",datatype:"json",type:"get",cache:!1,data:{C_BPartner_ID:u,pageSize:ui,pageNo:d,searchText:n.Utility.encodeText(i)},success:function(n){var i=JSON.parse(n),r,t;if(wf(i),kr==undefined||kr==0||si==!0){for(kr=i.TotalRecords,r=parseInt(kr/ui),d=1,dt=r+(kr%ui>0?1:0),s=vt.find("select"),s.empty(),t=1;t<=dt;t++)s.append("<option>"+t+"<\/option>");tt.css("opacity","0.6");it.css("opacity","0.6");df()}else te();o[0].style.visibility="hidden";si=!1},error:function(n){console.log(n);o[0].style.visibility="hidden";si=!1}})}function wf(i){var u,f,e,r;for(ct=[],ei=[],u=i.RHistory,ct.push({field:"ID",caption:n.Msg.getMsg("id"),size:"150px",hidden:!0}),ct.push({field:"Record_ID",caption:n.Msg.getMsg("record_id"),size:"150px",hidden:!0}),ct.push({field:"Created",caption:n.Msg.getMsg("Date"),size:"150px",hidden:!1}),ct.push({field:"Type",caption:n.Msg.getMsg("Type"),size:"150px",hidden:!1}),n.Application.isRTL?ct.push({field:"TableName",caption:n.Msg.getMsg("Table"),size:"150px",hidden:!1,resizable:!0,style:"text-align: right",render:function(i){var r=t('<img class="findImg" data-ids="'+i.Record_ID+"-"+i.AD_Table_ID+'" style="margin-left:10px;cursor:pointer" src="'+n.Application.contextUrl+'Areas/vis/Images/history-zoom.png" alt="email"  >'),u=t("<div >").append(r).append(i.TableName);return u.html()}}):ct.push({field:"TableName",caption:n.Msg.getMsg("Table"),size:"150px",hidden:!1,resizable:!0,style:"text-align: left",render:function(i){var r=t('<img class="findImg" data-ids="'+i.Record_ID+"-"+i.AD_Table_ID+'" style="margin-right:10px;cursor:pointer" src="'+n.Application.contextUrl+'Areas/vis/Images/history-zoom.png" alt="email"  >'),u=t("<div >").append(r).append(i.TableName);return u.html()}}),ct.push({field:"Subject",caption:n.Msg.getMsg("Subject"),size:"150px",hidden:!1}),ct.push({field:"UserName",caption:n.Msg.getMsg("UserName"),size:"150px",hidden:!1}),u.length>0&&(l=Object.keys(u[0])),r=0;r<l.length;r++)if(l[r]=="ID"||l[r]=="Record_ID"||l[r]=="Created"||l[r]=="Type"||l[r]=="TableName"||l[r]=="Subject"||l[r]=="UserName")continue;else ct.push({field:l[r],caption:n.Msg.getMsg(l[r]),size:"100px",hidden:!0});for(f=0;f<u.length;f++){for(e={},e.recid=f,r=0;r<l.length;r++)l[r]=="Created"?e[l[r]]=new Date(u[f][l[r]]).toLocaleString():l[r]=="Type"?u[f][l[r]]=="A"?e[l[r]]=n.Msg.getMsg("Appointment"):u[f][l[r]]=="T"?e[l[r]]=n.Msg.getMsg("Task"):u[f][l[r]]=="L"?e[l[r]]=n.Msg.getMsg("Letter"):u[f][l[r]]=="M"?e[l[r]]=n.Msg.getMsg("SentMail"):(u[f][l[r]]=="Z"||u[f][l[r]]=="I")&&(e[l[r]]=n.Msg.getMsg("InboxMail")):e[l[r]]=n.Utility.encodeText(u[f][l[r]]);ei.push(e)}}function bf(i){var u,f,e,r;for(at=[],fi=[],u=i.RHistory,at.push({field:"ID",caption:n.Msg.getMsg("id"),size:"150px",hidden:!0}),at.push({field:"Record_ID",caption:n.Msg.getMsg("record_id"),size:"150px",hidden:!0}),at.push({field:"Created",caption:n.Msg.getMsg("Date"),size:"150px",hidden:!1}),at.push({field:"Type",caption:n.Msg.getMsg("Type"),size:"150px",hidden:!1}),n.Application.isRTL?at.push({field:"TableName",caption:n.Msg.getMsg("Table"),size:"150px",hidden:!1,resizable:!0,style:"text-align: right",render:function(i){var r=t('<img class="findImg" data-ids="'+i.Record_ID+"-"+i.AD_Table_ID+'" style="margin-left:10px;cursor:pointer" src="'+n.Application.contextUrl+'Areas/vis/Images/history-zoom.png" alt="email"  >'),u=t("<div >").append(r).append(i.TableName);return u.html()}}):at.push({field:"TableName",caption:n.Msg.getMsg("Table"),size:"150px",hidden:!1,resizable:!0,style:"text-align: left",render:function(i){var r=t('<img class="findImg" data-ids="'+i.Record_ID+"-"+i.AD_Table_ID+'" style="margin-right:10px;cursor:pointer" src="'+n.Application.contextUrl+'Areas/vis/Images/history-zoom.png" alt="email"  >'),u=t("<div >").append(r).append(i.TableName);return u.html()}}),at.push({field:"Subject",caption:n.Msg.getMsg("Subject"),size:"150px",hidden:!1}),u.length>0&&(h=Object.keys(u[0])),r=0;r<h.length;r++)if(h[r]=="ID"||h[r]=="Record_ID"||h[r]=="Created"||h[r]=="Type"||h[r]=="TableName"||h[r]=="Subject")continue;else at.push({field:h[r],caption:n.Msg.getMsg(h[r]),size:"100px",hidden:!0});for(f=0;f<u.length;f++){for(e={},e.recid=f,r=0;r<h.length;r++)h[r]=="Created"?e[h[r]]=new Date(u[f][h[r]]).toLocaleString():h[r]=="Type"?u[f][h[r]]=="A"?e[h[r]]=n.Msg.getMsg("Appointment"):u[f][h[r]]=="T"?e[h[r]]=n.Msg.getMsg("Task"):u[f][h[r]]=="L"?e[h[r]]=n.Msg.getMsg("Letter"):u[f][h[r]]=="M"?e[h[r]]=n.Msg.getMsg("SentMail"):u[f][h[r]]=="I"&&(e[h[r]]=n.Msg.getMsg("InboxMail")):e[h[r]]=n.Utility.encodeText(u[f][h[r]]);fi.push(e)}}function kf(t){var r,u,i,f;for(st=[],gt=[],i=0;i<t.tables[0].columns.length;i++)t.tables[0].columns[i].name=="id"?st.push({field:t.tables[0].columns[i].name,caption:n.Msg.getMsg("id"),size:"150px",hidden:!0}):t.tables[0].columns[i].name=="record_id"?st.push({field:t.tables[0].columns[i].name,caption:n.Msg.getMsg("record_id"),size:"150px",hidden:!0}):t.tables[0].columns[i].name=="created"?st.push({field:t.tables[0].columns[i].name,caption:n.Msg.getMsg("Date"),size:"150px",hidden:!1}):t.tables[0].columns[i].name=="type"?st.push({field:t.tables[0].columns[i].name,caption:n.Msg.getMsg("Type"),size:"150px",hidden:!1}):t.tables[0].columns[i].name=="name"?st.push({field:t.tables[0].columns[i].name,caption:n.Msg.getMsg("CreatedBy"),size:"150px",hidden:!1}):t.tables[0].columns[i].name=="subject"?fu==!0?st.push({field:t.tables[0].columns[i].name,caption:n.Msg.getMsg("Subject"),size:"150px",hidden:!1}):st.push({field:t.tables[0].columns[i].name,caption:n.Msg.getMsg("Subject"),size:"230px",hidden:!1}):st.push({field:t.tables[0].columns[i].name,caption:n.Msg.getMsg(t.tables[0].columns[i].name),size:"100px",hidden:!0});for(t.tables[0].rows.length>0&&(h=Object.keys(t.tables[0].rows[0].cells)),r=0;r<t.tables[0].rows.length;r++){for(u={},u.recid=r,i=0;i<h.length;i++)f=h[i],h[i]=="created"?u[h[i]]=new Date(t.tables[0].rows[r].cells[f]).toLocaleString():u[f]=n.Utility.encodeText(t.tables[0].rows[r].cells[f]);gt.push(u)}}function df(){y!=undefined&&y!=null&&(y.destroy(),y=null);y=ci.w2grid({name:"userhistorygrid",recordHeight:30,show:{toolbar:!0},multiSelect:!1,columns:ct,records:ei});y.on("select",er);y.on("search",fr);ei.length>0?(y.select(0),p.hide(),a.show()):(p.show(),a.hide());t(".findImg").on("click",function(i){var r=t(i.target).data("ids").split("-");n.AEnv.zoom(r[1],r[0])})}function gf(){v!=undefined&&v!=null&&(v.destroy(),v=null);v=ht.w2grid({name:"realtedhistorygrid",recordHeight:30,show:{toolbar:!0},multiSelect:!1,columns:at,records:fi});v.on("select",er);v.on("search",fr);fi.length>0?(v.select(0),p.hide(),a.show()):(p.show(),a.hide());t(".findImg").on("click",function(i){var r=t(i.target).data("ids").split("-");n.AEnv.zoom(r[1],r[0])})}function rr(){nt.destroy();nt=null;nt=b.w2grid({name:"historyinboxgrid",recordHeight:30,show:{toolbar:!0},multiSelect:!1,columns:st,records:gt});nt.on("select",er);nt.on("search",fr);gt.length>0?(nt.select(0),p.hide(),a.show()):(p.show(),a.hide());o[0].style.visibility="hidden";o[0].style.visibility="hidden"}function ne(){v.destroy();v=null;v=ht.w2grid({name:"realtedhistorygrid",recordHeight:30,show:{toolbar:!0},multiSelect:!1,columns:at,records:fi});v.on("select",er);v.on("search",fr);fi.length>0?(v.select(0),p.hide(),a.show()):(p.show(),a.hide());o[0].style.visibility="hidden";t(".findImg").off("click");t(".findImg").on("click",function(i){var r=t(i.target).data("ids").split("-");n.AEnv.zoom(r[1],r[0])})}function te(){y.destroy();y=null;y=ci.w2grid({name:"userhistorygrid",recordHeight:30,show:{toolbar:!0},multiSelect:!1,columns:ct,records:ei});y.on("select",er);y.on("search",fr);ei.length>0?(y.select(0),p.hide(),a.show()):(p.show(),a.hide());o[0].style.visibility="hidden";t(".findImg").off("click");t(".findImg").on("click",function(i){var r=t(i.target).data("ids").split("-");n.AEnv.zoom(r[1],r[0])})}function ie(){ai.on("click",ce);li.find("input").on("keydown",rf);li.find("img").on("click",ue);yt.on("click",ae);a.on("keydown",cf);a.on("click",cf);ot.on("click",fe);it.on("click",ee);vt.on("change",oe);tt.on("click",se);et.on("click",he);eu.on(n.Events.onTouchStartOrClick,"LI",function(n){var i=t(this).data("type");re(i,n)})}function re(t){var f=null,u;t=="R"||t=="F"&&(f=new n.Email("",null,null,r,!0,!0,i,ni.html(),ir.text(),yu));u=new n.CFrame;u.setName(n.Msg.getMsg("EMail"));u.setTitle(n.Msg.getMsg("EMail"));u.hideHeader(!0);u.setContent(f);u.show();f.initializeComponent();lt.close()}function ue(){w!=undefined&&w.is(":visible")==!0?(t(".vis-attachhistory-right-row > ul > li").css("float","left"),t(".vis-attachhistory-right-row > ul").css("height","auto"),tf(w.html()),t(".vis-attachhistory-right-row > ul > li").css("float","none"),t(".vis-attachhistory-right-row > ul").css("height","45px")):c!=undefined&&c.is(":visible")==!0&&(t(".vis-attachhistory-right-row > ul > li").css("float","left"),t(".vis-attachhistory-right-row > ul").css("height","auto"),t(t(".vis-attachhistory-to").find("p")).text(t(t(".vis-attachhistory-to").find("p")).text().replace(/;/g,"; ")),t(t(".vis-attachhistory-bcc").find("p")).text(t(t(".vis-attachhistory-bcc").find("p")).text().replace(/;/g,"; ")),t(t(".vis-attachhistory-cc").find("p")).text(t(t(".vis-attachhistory-cc").find("p")).text().replace(/;/g,"; ")),tf(c.html()),t(".vis-attachhistory-right-row > ul > li").css("float","none"),t(".vis-attachhistory-right-row > ul").css("height","45px"),t(t(".vis-attachhistory-to").find("p")).text(t(t(".vis-attachhistory-to").find("p")).text().replace(/; /g,";")),t(t(".vis-attachhistory-bcc").find("p")).text(t(t(".vis-attachhistory-bcc").find("p")).text().replace(/; /g,";")),t(t(".vis-attachhistory-cc").find("p")).text(t(t(".vis-attachhistory-cc").find("p")).text().replace(/; /g,";")))}function tf(t){var i=window.open(),r='<link rel="stylesheet" href="'+n.Application.contextUrl+'Areas/VIS/Content/VIS.all.min.css" />';i.document.write(r+t);i.print();i.close()}function rf(n){(n.keyCode==undefined||n.keyCode==13)&&rt!=undefined&&rt!=null&&(si=!0,b.is(":visible")?(o[0].style.visibility="visible",nf(rt.val()),gi(rt.val()),ku=rt.val(),rr()):ht.is(":visible")?(o[0].style.visibility="visible",nr(rt.val()),du=rt.val()):(o[0].style.visibility="visible",tr(rt.val()),gu=rt.val()))}function fe(){b.is(":visible")?(g<bt&&(o[0].style.visibility="visible",g++,s.val(g),gi(),rr()),ur()):ht.is(":visible")?k<kt&&(o[0].style.visibility="visible",k++,s.val(k),nr(),gr()):d<dt&&(o[0].style.visibility="visible",d++,s.val(d),tr(),nu())}function ee(){b.is(":visible")?(g>1&&(o[0].style.visibility="visible",g--,s.val(g),gi(),rr()),ur()):ht.is(":visible")?(k>1&&(o[0].style.visibility="visible",k--,s.val(k),nr()),gr()):(d>1&&(o[0].style.visibility="visible",d--,s.val(d),tr()),nu())}function oe(){b.is(":visible")?(o[0].style.visibility="visible",g=s.val(),gi(),rr(),ur()):ht.is(":visible")?(o[0].style.visibility="visible",k=s.val(),nr(),gr()):(o[0].style.visibility="visible",d=s.val(),tr(),nu())}function se(){b.is(":visible")?(o[0].style.visibility="visible",g=1,s.val(g),gi(),rr(),ur()):ht.is(":visible")?(o[0].style.visibility="visible",k=1,s.val(k),nr(),gr()):(o[0].style.visibility="visible",d=1,s.val(d),tr(),nu())}function he(){b.is(":visible")?(o[0].style.visibility="visible",g=bt,s.val(g),gi(),rr(),ur()):ht.is(":visible")?(o[0].style.visibility="visible",k=kt,s.val(k),nr(),gr()):(o[0].style.visibility="visible",d=dt,s.val(d),tr(),nu())}function ur(){g==1&&g<bt?(tt.css("opacity","0.6"),it.css("opacity","0.6"),ot.css("opacity","1"),et.css("opacity","1")):g>1&&g<bt?(tt.css("opacity","1"),it.css("opacity","1"),ot.css("opacity","1"),et.css("opacity","1")):g==bt&&bt==1?(tt.css("opacity","0.6"),it.css("opacity","0.6"),ot.css("opacity","0.6"),et.css("opacity","0.6")):g==bt&&(tt.css("opacity","1"),it.css("opacity","1"),ot.css("opacity","0.6"),et.css("opacity","0.6"))}function gr(){k==1&&k<kt?(tt.css("opacity","0.6"),it.css("opacity","0.6"),ot.css("opacity","1"),et.css("opacity","1")):k>1&&k<kt?(tt.css("opacity","1"),it.css("opacity","1"),ot.css("opacity","1"),et.css("opacity","1")):k==kt&&kt==1?(tt.css("opacity","0.6"),it.css("opacity","0.6"),ot.css("opacity","0.6"),et.css("opacity","0.6")):k==kt&&(tt.css("opacity","1"),it.css("opacity","1"),ot.css("opacity","0.6"),et.css("opacity","0.6"))}function nu(){d==1&&d<dt?(tt.css("opacity","0.6"),it.css("opacity","0.6"),ot.css("opacity","1"),et.css("opacity","1")):d>1&&d<dt?(tt.css("opacity","1"),it.css("opacity","1"),ot.css("opacity","1"),et.css("opacity","1")):d==dt&&dt==1?(tt.css("opacity","0.6"),it.css("opacity","0.6"),ot.css("opacity","0.6"),et.css("opacity","0.6")):d==dt&&(tt.css("opacity","1"),it.css("opacity","1"),ot.css("opacity","0.6"),et.css("opacity","0.6"))}function ce(i){var f=t(i.target).data("type"),r;if(f=="History"){for((rt!="undefined"||rt!=null)&&rt.val(ku),s=vt.find("select"),s.empty(),r=1;r<=bt;r++)s.append("<option>"+r+"<\/option>");ur();b.show();ci.hide();ht.hide();s.val(g);gt.length>0?(nt.select(0),nt.refresh(),p.hide(),a.show()):(p.show(),a.hide())}else if(f=="RelatedHistory"){for((rt!="undefined"||rt!=null)&&rt.val(du),s=vt.find("select"),s.empty(),r=1;r<=kt;r++)s.append("<option>"+r+"<\/option>");v==undefined||v==null?(o[0].style.visibility="visible",nr(),s.val(k)):(a.find("*").show(),fi.length>0&&(v.select(0),v.refresh(),s.val(k)));t(".findImg").on("click",function(i){var r=t(i.target).data("ids").split("-");n.AEnv.zoom(r[1],r[0])});fi.length>0?(v.select(0),p.hide(),a.show()):(p.show(),a.hide());b.hide();ci.hide();ht.show()}else if(f=="UserHistory"){if((rt!="undefined"||rt!=null)&&rt.val(gu),u==null||u==0){n.ADialog.info("BPartnerNotFound");return}for(s=vt.find("select"),s.empty(),r=1;r<=dt;r++)s.append("<option>"+r+"<\/option>");y==undefined||y==null?(o[0].style.visibility="visible",tr(),s.val(d)):(a.find("*").show(),ei.length>0&&(y.select(0),y.refresh(),s.val(d)));t(".findImg").on("click",function(i){var r=t(i.target).data("ids").split("-");n.AEnv.zoom(r[1],r[0])});ei.length>0?(y.select(0),p.hide(),a.show()):(p.show(),a.hide());b.hide();ht.hide();ci.show()}t(i.target).addClass("vis-attachhistory-apanel-tab-selected");t(i.target).siblings("li").removeClass("vis-attachhistory-apanel-tab-selected")}function fr(n){n.onComplete=function(){b.is(":visible")?nt.last.searchIds.length>0&&nt.select(nt.last.searchIds[0]):v.last.searchIds.length>0&&v.select(v.last.searchIds[0])}}function er(i){var r;if(o[0].style.visibility="visible",r=i.target=="historyinboxgrid"?nt.get(i.recid):i.target=="realtedhistorygrid"?v.get(i.recid):y.get(i.recid),t(".vis-attachhistory-view-comments").text(n.Msg.getMsg("ViewMoreComments")),r.type==n.Msg.getMsg("Appointment")||r.Type=="Appointment"||r.type==n.Msg.getMsg("Task")||r.Type=="Task"?w!=undefined&&w.is(":visible")==!1&&(t(ft[0].children[0]).hide(),w.show()):c!=undefined&&c.is(":visible")==!1&&(t(ut[0].children[0]).hide(),c.show()),r.type!=undefined)switch(r.type){case n.Msg.getMsg("Appointment"):ou(r.id);break;case n.Msg.getMsg("Task"):ou(r.id);break;case n.Msg.getMsg("SentMail"):uf(r.id);break;case n.Msg.getMsg("InboxMail"):ff(r.id);break;case n.Msg.getMsg("Letter"):ef(r.id)}else switch(r.Type){case n.Msg.getMsg("Appointment"):ou(r.ID);break;case n.Msg.getMsg("Task"):ou(r.ID);break;case n.Msg.getMsg("SentMail"):uf(r.ID);break;case n.Msg.getMsg("InboxMail"):ff(r.ID);break;case n.Msg.getMsg("Letter"):ef(r.ID)}}function ou(t){var i="SELECT AI.AppointmentsInfo_ID, AI.Subject,AI.Location,AI.Description,AI.AD_Table_ID, AI.Record_ID,  (  CASE Label    WHEN 1     THEN  '"+n.Msg.getMsg("Important",!0)+"'    WHEN 2    THEN '"+n.Msg.getMsg("Business",!0)+"'    WHEN 3    THEN   '"+n.Msg.getMsg("Personal",!0)+"'    WHEN 4    THEN '"+n.Msg.getMsg("Vacation",!0)+"'    WHEN 5    THEN '"+n.Msg.getMsg("MustAttend",!0)+"'    WHEN 6    THEN '"+n.Msg.getMsg("TravelRequired",!0)+"'    WHEN 7    THEN '"+n.Msg.getMsg("NeedsPreparation",!0)+"'    WHEN 8    THEN '"+n.Msg.getMsg("BirthDay",!0)+"'    WHEN 9    THEN '"+n.Msg.getMsg("Anniversary",!0)+"'    WHEN 10    Then '"+n.Msg.getMsg("PhoneCall",!0)+"'    ELSE '"+n.Msg.getMsg("None",!0)+"'  END ) AS label ,  AI.StartDate , AI.EndDate,  (  CASE AI.AllDay    WHEN 'Y'        THEN '"+n.Msg.getMsg("Yes",!0)+"'        ELSE '"+n.Msg.getMsg("No",!0)+"'  END) AS Allday ,  (  CASE AI.Status    WHEN 1    THEN '"+n.Msg.getMsg("Tentative",!0)+"'     WHEN 2    THEN '"+n.Msg.getMsg("Busy",!0)+"'    WHEN 3    THEN '"+n.Msg.getMsg("OutOfOffice",!0)+"'    Else     '"+n.Msg.getMsg("Free",!0)+"'     End) as Status,      AI.ReminderInfo , AI.AttendeeInfo,  AI.RecurrenceInfo ,      (       CASE AI.IsPrivate        WHEN 'Y'        THEN '"+n.Msg.getMsg("Yes")+"'        ELSE '"+n.Msg.getMsg("No")+"'      END) AS IsPrivate,AI.comments ,ac.Name as caname   FROM AppointmentsInfo ai LEFT OUTER JOIN appointmentcategory AC  ON AI.appointmentcategory_id=ac.appointmentcategory_id WHERE AI.AppointmentsInfo_ID="+t;n.DB.executeDataSet(i,null,function(r){var s,f,u,e;if(r!=null&&r.getTables().length>0){if(s=0,s=b.is(":visible")?0:r.tables[0].rows[0].cells.ad_table_id+"-"+r.tables[0].rows[0].cells.record_id,i="",f=r.tables[0].rows[0].cells.attendeeinfo,f!=null&&f!=undefined&&(i=" SELECT name FROM AD_User WHERE AD_User_ID IN ("+f.replace(/;/g,",")+")",u=n.DB.executeDataSet(i),u!=null&&u.getTables().length>0&&(i="",u.tables[0].rows.length>0))){for(e=0;e<u.tables[0].rows.length;e++)i+=u.tables[0].rows[e].cells.name+", ";i=i.substring(0,i.length-2)}le(t,r.tables[0].rows[0].cells.location,r.tables[0].rows[0].cells.description,r.tables[0].rows[0].cells.label,r.tables[0].rows[0].cells.startdate,r.tables[0].rows[0].cells.enddate,r.tables[0].rows[0].cells.allday,"",r.tables[0].rows[0].cells.comments,s,r.tables[0].rows[0].cells.subject,r.tables[0].rows[0].cells.caname,"",r.tables[0].rows[0].cells.appointmentsinfo_id,i)}else o[0].style.visibility="hidden"})}function uf(i){t.ajax({url:n.Application.contextUrl+"AttachmentHistory/LoadSentMails",datatype:"json",type:"get",cache:!1,data:{ID:i},success:function(n){var t=JSON.parse(n),r=0;r=b.is(":visible")?0:t.AD_Table_ID+"-"+t.Record_ID;pu(i,t.Title,t.To,t.From,t.Date,t.Detail,t.Bcc,t.Cc,t.Comments,t.IsMail,t.IsLetter,t.Attach,r,t.ID)}})}function ff(i){t.ajax({url:n.Application.contextUrl+"AttachmentHistory/LoadInboxMails",datatype:"json",type:"get",cache:!1,data:{ID:i},success:function(n){var t=JSON.parse(n),r=0;r=b.is(":visible")?0:t.AD_Table_ID+"-"+t.Record_ID;pu(i,t.Title,t.To,t.From,t.Date,t.Detail,t.Bcc,t.Cc,t.Comments,t.IsMail,t.IsLetter,t.Attach,r,t.ID)}})}function ef(i){t.ajax({url:n.Application.contextUrl+"AttachmentHistory/LoadLetters",datatype:"json",type:"get",cache:!1,data:{ID:i},success:function(n){var t=JSON.parse(n),r=0;r=b.is(":visible")?0:t.AD_Table_ID+"-"+t.Record_ID;pu(i,t.Title,"","",t.Date,t.Detail,"","",t.Comments,!1,!0,t.Attach,r,t.ID)}})}function pu(i,r,u,f,e,s,h,l,v,y,p,w,b,k){var d;if(ft!=undefined&&ft.hide(),hi=!1,pi==undefined||pi==null){if(ir=t("<p>"+n.Utility.encodeText(r)+"<\/p>"),vi=t("<p>"+n.Utility.encodeText(u)+"<\/p>"),wi=t("<p>"+n.Utility.encodeText(h)+"<\/p>"),bi=t("<p>"+n.Utility.encodeText(l)+"<\/p>"),yi=t(" <p>"+n.Utility.encodeText(f)+"<\/p>"),pi=t("<p>"+n.Utility.encodeText(e)+"<\/p>"),ri=t('<a class="vis-attachhistory-email-dropdown"><\/a>'),(ni==undefined||ni==null)&&(ni=t('<p class="vis-attachhistory-detail"><\/p>')),ni.html(s),(pt==undefined||pt==null)&&(pt=t('<input type="text" placeholder="'+n.Msg.getMsg("TypeComment")+'"><\/input>')),oi=t('<img src="'+n.Application.contextUrl+'Areas/vis/Images/history-email.png" alt="email">'),ti=n.Application.isRTL?t('<img style="float:left;cursor:pointer;margin-top:3px;margin-right:5px" data-ids="'+b+'" src="'+n.Application.contextUrl+'Areas/vis/Images/history-zoom.png" alt="email">'):t('<img style="float:right;cursor:pointer;margin-top:3px;margin-right:5px" data-ids="'+b+'" src="'+n.Application.contextUrl+'Areas/vis/Images/history-zoom.png" alt="email">'),ut=t('<div class="vis-attachhistory-right-content">'),c=t('<div class="vis-attachhistory-grid-data">'),c.append(t('<div class="vis-attachhistory-right-row2">').append(t("<h6>"+n.Msg.getMsg("Title")+"<\/h6>").append(oi)).append(ir)),c.append(t('<div class="vis-attachhistory-right-row3"><\/div>').append(ri).append(ti)),p==!0&&c.find(".vis-attachhistory-right-row").last().hide(),p==!0&&c.append(t('<div class="vis-attachhistory-right-row3">').append(pi)),b==0?ti.hide():ti.show(),y==!0?oi.prop("src",n.Application.contextUrl+"Areas/vis/Images/history-email.png"):p==!0&&oi.prop("src",n.Application.contextUrl+"Areas/vis/Images/history-letter.png"),c.append(t('<div class="vis-attachhistory-right-row vis-attachhistory-to">').append("<h6>"+n.Msg.getMsg("To")+"<\/h6> ").append(vi)),(u=="undefined"||u==null||u==""||p==!0)&&c.find(".vis-attachhistory-right-row").last().hide(),c.append(t('<div value="bccDiv" class="vis-attachhistory-right-row  vis-attachhistory-bcc">').append("<h6>"+n.Msg.getMsg("Bcc")+"<\/h6> ").append(wi)),(h=="undefined"||h==null||h==""||p==!0)&&c.find(".vis-attachhistory-right-row").last().hide(),c.append(t('<div  value="ccDiv"  class="vis-attachhistory-right-row vis-attachhistory-cc">').append("<h6>"+n.Msg.getMsg("Cc")+"<\/h6> ").append(bi)),(l=="undefined"||l==null||l==""||p==!0)&&c.find(".vis-attachhistory-right-row").last().hide(),c.append(t('<div class="vis-attachhistory-right-row">').append("<h6>"+n.Msg.getMsg("From")+"<\/h6>").append(yi)),c.append(t('<div class="vis-attachhistory-right-row">').append("<h6>"+n.Msg.getMsg("Attachments")+"<\/h6>")),w!=undefined&&w.length>0)for(d=0;d<w.length;d++)yt.append('<li><a data-IDs="'+w[d].ID+'">'+n.Utility.encodeText(w[d].Name)+'<\/a><span class="vis-attachhistory-attach-download"><img src="'+n.Application.contextUrl+'Areas/vis/Images/history-download.png" alt="email"><\/span><\/li>');else c.find(".vis-attachhistory-right-row").last().hide();c.find(".vis-attachhistory-right-row").last().append(yt);c.append(t('<div class="vis-attachhistory-right-row">').append("<h6>"+n.Msg.getMsg("Details")+"<\/h6>").append(ni));lr=t('<div class="vis-attachhistory-bottom"><\/div>');hu=t('<div class="vis-attachhistory-comments"><\/div>');hu.append(pt).append('<span class="vis-attachhistory-comment-icon"><\/span>');lr.append(t('<div class="vis-attachhistory-right-row" style="margin-top:0px">').append(hu).append('<p class="vis-attachhistory-view-comments" style="float:right;width:auto">'+n.Msg.getMsg("ViewMoreComments")+"<\/p>"));ut.append('<div style="display:none" class="vis-attachhistory-grid-data">').append(c).append(lr);li.parent()!=undefined?a.append(ut):a.append(ut);ti.on("click",function(i){var r=t(i.target).data("ids").split("-");n.AEnv.zoom(r[0],r[1])})}else{if(ut.show(),t(ut[0].children[0]).hide(),(ri==undefined||ri==null)&&(ri=t('<a class="vis-attachhistory-email-dropdown"><\/a>')),y==!0?(oi.prop("src",n.Application.contextUrl+"Areas/vis/Images/history-email.png"),ri.show()):p==!0&&(oi.prop("src",n.Application.contextUrl+"Areas/vis/Images/history-letter.png"),ri.hide()),ir.text(n.Utility.encodeText(r)),u=="undefined"||u==null&&u==""||p==!0?t(vi.parent()).hide():(vi.text(n.Utility.encodeText(u)),t(vi.parent()).show()),h=="undefined"||h==null||h==""||p==!0?t(wi.parent()).hide():(wi.text(n.Utility.encodeText(h)),t(wi.parent()).show()),l=="undefined"||l==null||l==""||p==!0?t(bi.parent()).hide():(bi.text(n.Utility.encodeText(l)),t(bi.parent()).show()),p==!0?t(yi.parent()).hide():(yi.text(n.Utility.encodeText(f)),t(yi.parent()).show()),ti.data("ids",b),b==0?ti.hide():ti.show(),pi.text(n.Utility.encodeText(e)),w!=undefined&&w.length>0){for(yt.empty(),d=0;d<w.length;d++)yt.append('<li><a  data-IDs="'+w[d].ID+'">'+n.Utility.encodeText(w[d].Name)+'<\/a><span class="vis-attachhistory-attach-download"><img src="'+n.Application.contextUrl+'Areas/vis/Images/history-download.png" alt="email"><\/span><\/li>');t(yt.parent()).show()}else t(yt.parent()).hide();ni.html(s)}t(".vis-attachhistory-view-comments").off("click");t(".vis-attachhistory-view-comments").on("click",function(){of(k,!1,this)});if(y){yu=k;ri.show();t(".vis-attachhistory-email-dropdown").off("click");t(".vis-attachhistory-email-dropdown").on("click",function(){t(this).w2overlay(eu.clone(!0),{css:{height:"300px"}})})}else ri.hide();t(".vis-attachhistory-comment-icon").data("ID",i);v!=undefined?pt.val(n.Utility.encodeText(v)):pt.val("");o[0].style.visibility="hidden"}function le(i,r,u,f,e,s,h,c,l,v,y,p,b,k,d){var g,nt,tt;if(ut!=undefined&&ut.hide(),hi=!0,di==undefined||di==null){yr=t("<p>"+n.Utility.encodeText(r)+"<\/p>");vr=t("<p>"+n.Utility.encodeText(y)+"<\/p>");ki=t("<p>"+n.Utility.encodeText(u)+"<\/p>");uu=t("<p>"+n.Utility.encodeText(p)+"<\/p>");lu=t("<p>"+n.Utility.encodeText(d)+"<\/p>");au=t("<p>"+n.Utility.encodeText(f)+"<\/p>");di=t("<p>"+n.Utility.encodeText(new Date(e).toLocaleString())+"<\/p>");pr=t(" <p>"+n.Utility.encodeText(new Date(s).toLocaleString())+"<\/p>");wr=t("<p>"+n.Utility.encodeText(h)+"<\/p>");(wt==undefined||wt==null)&&(wt=t('<input type="text" placeholder="'+n.Msg.getMsg("TypeComment")+'"><\/input>'));ii=n.Application.isRTL?t('<img style="float:left;cursor:pointer" data-ids="'+v+'" src="'+n.Application.contextUrl+'Areas/vis/Images/history-zoom.png" alt="email">'):t('<img style="float:right;cursor:pointer" data-ids="'+v+'" src="'+n.Application.contextUrl+'Areas/vis/Images/history-zoom.png" alt="email">');ft=t('<div class="vis-attachhistory-right-content">');w=t('<div class="vis-attachhistory-grid-data">');g=t('<div style="float:left;width:100%" ><\/div>');g.append(t('<div class="vis-attachhistory-right-row2">').append(t("<h6>"+n.Msg.getMsg("Title")+' <img src="'+n.Application.contextUrl+'Areas/vis/Images/history-appointment.png"  alt="email"><\/h6>').append(ii)).append(vr));v==0?ii.hide():ii.show();g.append(t('<div class="vis-attachhistory-right-row3"  style="margin-bottom:11px" >').append("<h6>"+n.Msg.getMsg("Location")+"<\/h6> ").append(yr));(r=="undefined"||r==null&&r=="")&&w.find(".vis-attachhistory-right-row").last().hide();w.append(g);nt=t('<div style="float:left;width:100%" ><\/div>');nt.append(t('<div  class="vis-attachhistory-right-row2"> ').append("<h6>"+n.Msg.getMsg("StartDate")+"<\/h6> ").append(di));nt.append(t('<div class="vis-attachhistory-right-row3"  style="margin-bottom:11px" >').append("<h6>"+n.Msg.getMsg("EndDate")+"<\/h6>").append(pr));w.append(nt);tt=t('<div style="float:left;width:100%" ><\/div>');tt.append(t('<div class="vis-attachhistory-right-row2">').append("<h6>"+n.Msg.getMsg("AllDay")+"<\/h6>").append(wr));tt.append(t('<div class="vis-attachhistory-right-row3"  style="margin-bottom:11px" >').append("<h6>"+n.Msg.getMsg("Category")+"<\/h6> ").append(uu));w.append(tt);w.append(t('<div class="vis-attachhistory-right-row">').append("<h6>"+n.Msg.getMsg("Contacts")+"<\/h6> ").append(lu));w.append(t('<div class="vis-attachhistory-right-row">').append("<h6>"+n.Msg.getMsg("Description")+"<\/h6> ").append(ki));(u=="undefined"||u==null&&u=="")&&w.find(".vis-attachhistory-right-row").last().hide();ar=t('<div class="vis-attachhistory-bottom"><\/div>');cu=t('<div class="vis-attachhistory-comments"><\/div>');cu.append(wt).append('<span class="vis-attachhistory-comment-icon"><\/span>');ar.append(t('<div class="vis-attachhistory-right-row" style="margin-top:0px">').append(cu).append('<p class="vis-attachhistory-view-comments">'+n.Msg.getMsg("ViewMoreComments")+"<\/p>"));ft.append('<div style="display:none" class="vis-attachhistory-grid-data">').append(w).append(ar);a.append(ft);ii.on("click",function(i){var r=t(i.target).data("ids").split("-");n.AEnv.zoom(r[0],r[1])})}else ft.show(),vr.text(n.Utility.encodeText(y)),yr.text(n.Utility.encodeText(r)),u=="undefined"||u==null||u==""?t(ki.parent()).hide():(ki.text(n.Utility.encodeText(u)),t(ki.parent()).show()),lu.text(n.Utility.encodeText(d)),p=="undefined"||p==null||p==""?uu.text(n.Utility.encodeText("")):uu.text(n.Utility.encodeText(p)),ii.data("ids",v),v==0?ii.hide():ii.show(),di.text(n.Utility.encodeText(new Date(e).toLocaleString())),pr.text(n.Utility.encodeText(new Date(s).toLocaleString())),wr.text(n.Utility.encodeText(h)),t(ft[0].children[0]).hide();t(".vis-attachhistory-view-comments").off("click");t(".vis-attachhistory-view-comments").on("click",function(){of(k,!0,this)});l!=undefined?wt.val(n.Utility.encodeText(l)):wt.val("");t(".vis-attachhistory-comment-icon").data("ID",i);o[0].style.visibility="hidden"}function of(i,r,u){r==!0?w.is(":visible")?(t.ajax({url:n.Application.contextUrl+"AttachmentHistory/ViewChatonHistory",datatype:"json",type:"POST",cache:!1,data:{record_ID:i,isAppointment:r},success:function(n){var t=JSON.parse(n);hf(t,r)},error:function(){n.ADialog.error("RecordNotSaved")}}),t(u).text(n.Msg.getMsg("HideComments"))):(w.show(),t(ft[0].children[0]).hide(),t(u).text(n.Msg.getMsg("ViewMoreComments"))):c.is(":visible")?(t.ajax({url:n.Application.contextUrl+"AttachmentHistory/ViewChatonHistory",datatype:"json",type:"POST",cache:!1,data:{record_ID:i,isAppointment:r},success:function(n){var t=JSON.parse(n);hf(t,r)},error:function(){n.ADialog.error("RecordNotSaved")}}),t(u).text(n.Msg.getMsg("HideComments"))):(c.show(),t(ut[0].children[0]).hide(),t(u).text(n.Msg.getMsg("ViewMoreComments")))}function sf(t,i){return t+='   <div class="vis-attachhistory-comment-data"><div class="vis-attachhistory-comment-detail">',t+=i.UserImage!="NoRecordFound"&&i.UserImage!="FileDoesn'tExist"&&i.UserImage!=null?'<img  class="userAvatar-Feeds"  src="'+i.UserImage+"?"+new Date+'">':'<img  class="userAvatar-Feeds" src="'+n.Application.contextUrl+'Areas/VIS/Images/home/defaultUser46X46.png ">',t+='<div class="vis-attachhistory-comment-text">',t+=i.CreatedBy==n.Env.getCtx().getAD_User_ID()?"<h6>"+n.Msg.getMsg("Me")+" <\/h6>":"<h6>"+i.UserName+"<\/h6>",t+(" <p>"+i.CharacterData+'<\/p><\/div><\/div><div class="vis-attachhistory-comment-dateTime"><p>'+new Date(i.Created).toLocaleString()+"<\/p><\/div><\/div>")}function hf(n,i){var r,u;if(n.length>0){for(r=' <div class="vis-attachhistory-comments-container">',u=0;u<n.length;u++)r=sf(r,n[u]);r+="<\/div>"}i==!1?c.is(":visible")?(t(ut[0].children[0]).show(),t(ut[0].children[0]).empty(),t(ut[0].children[0]).append(r),c.hide()):(c.show(),t(ut[0].children[0]).hide()):i==!0&&(w.is(":visible")?(t(ft[0].children[0]).show(),t(ft[0].children[0]).empty(),t(ft[0].children[0]).append(r),w.hide()):(w.show(),t(ft[0].children[0]).hide()))}function ae(i){var r=i.target,f="",u="";(t(r).is("a")?(f=t(r).text(),u=t(r).data("ids")):t(r).is("img")?(f=t(t(r).parent()).siblings().text(),u=t(t(r).parent()).siblings().data("ids")):t(r).is("span")&&(f=t(r).siblings().text(),u=t(r).siblings().data("ids")),u!=null&&u!=0)&&(o[0].style.visibility="hidden",t.ajax({url:n.Application.contextUrl+"AttachmentHistory/DownloadAttachment",datatype:"json",type:"get",cache:!1,data:{ID:u,Name:f},success:function(t){var i=JSON.parse(t),r=n.Application.contextUrl+"TempDownload/"+i;window.open(r);o[0].style.visibility="hidden"}}))}function cf(i){var f=i.target,r,u;(i.keyCode==undefined||i.keyCode==13)&&(i.keyCode!=undefined||t(f).hasClass("vis-attachhistory-comment-icon"))&&(r=0,r=t(".vis-attachhistory-comment-icon").data("ID"),r!=0)&&(u="",u=hi==!0?wt.val():pt.val(),u.length!=0)&&t.ajax({url:n.Application.contextUrl+"AttachmentHistory/SaveComment",datatype:"json",type:"POST",cache:!1,data:{ID:r,Text:u,isAppointment:hi},success:function(n){var u=JSON.parse(n),f=!0,i,r;if(hi==!1?(pt.val(""),c.is(":visible")&&(f=!1)):hi==!0&&(wt.val(""),w.is(":visible")&&(f=!1)),f==!0){if(u.length>0){for(i=' <div class="vis-attachhistory-comments-container">',r=0;r<u.length;r++)i=sf(i,u[r]);i+="<\/div>"}hi==!0?(t(ft[0].children[0]).empty(),t(ft[0].children[0]).append(i)):(t(ut[0].children[0]).empty(),t(ut[0].children[0]).append(i))}},error:function(){n.ADialog.error("RecordNotSaved")}})}var lf=n.Env.getWindowNo(),or=n.Env.getCtx(),st=[],gt=[],h=[],at=[],fi=[],hi,ct=[],ei=[],l=[],lt,sr,b,nt,ht,v,y,ci,wu=this,hr,tu,su,li,cr,iu,ai,ru,a,ut,ft,w,lr,ar,p,hu,cu,c,yt,ir,vi,yi,bu,ni,pi,pt,wi,bi,oi,wt,ti,ii,ri,vr,yr,ki,uu,lu,au,di,pr,wr,o,ui=50,g,k,vu,br,kr,bt,kt,dt,d,dr,tt,et,ot,it,vt,s,rt,af,fu,ku,du,gu,eu,si,yu;this.initializeComponent=function(){fu=/ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase());g=1;k=1;d=1;pf();yf();vf();nf();gi();ie()};this.displayInboxDiv=function(){nt=b.w2grid({name:"historyinboxgrid",recordHeight:30,show:{toolbar:!0},multiSelect:!1,columns:st,records:gt});nt.on("select",er);nt.on("search",fr);gt.length>0?(nt.select(0),p.hide(),a.show()):(p.show(),a.hide());o[0].style.visibility="hidden";t(".vis-attachhistory-search-icon").on("click",rf)};si=!1;yu=0;this.getRoot=function(){return sr};this.show=function(){lt=new n.ChildDialog;this.initializeComponent();lt.setContent(sr);fu==!0?(lt.setHeight(650),lt.setWidth(800)):(lt.setHeight(650),lt.setWidth(1200));lt.setTitle(n.Msg.getMsg("History"));lt.setModal(!0);lt.show();lt.hideButtons();this.displayInboxDiv();lt.onClose=function(){wu.dispose()}};this.dispose=function(){lf=0;or=null;st=[];st=null;gt=[];gt=null;h=[];h=null;hr!=null&&hr.remove();tu!=null&&tu.remove();cr!=null&&cr.remove();iu!=null&&iu.remove();ai!=null&&ai.remove();ru!=null&&ru.remove();a!=null&&a.remove();ut!=null&&ut.remove();ft!=null&&ft.remove();w!=null&&w.remove();lr!=null&&lr.remove();ar!=null&&ar.remove();p!=null&&p.remove();c!=null&&c.remove();yt!=null&&yt.remove();ir!=null&&ir.remove();vi!=null&&vi.remove();yi!=null&&yi.remove();bu!=null&&bu.remove();ni!=null&&ni.remove();pi!=null&&pi.remove();pt!=null&&pt.remove();wi!=null&&wi.remove();bi!=null&&bi.remove();oi!=null&&oi.remove();wt!=null&&wt.remove();yr!=null&&yr.remove();vr!=null&&vr.remove();ki!=null&&ki.remove();au!=null&&au.remove();di!=null&&di.remove();pr!=null&&pr.remove();wr!=null&&wr.remove();o!=null&&o.remove();dr!=null&&dr.remove();tt!=null&&tt.remove();et!=null&&et.remove();ot!=null&&ot.remove();it!=null&&it.remove();vt!=null&&vt.remove();s!=null&&s.remove();b!=null&&b!=undefined&&b.remove();b=null;nt!=null&&nt!=undefined&&nt.destroy();nt=null;w2ui.historyinboxgrid!=undefined&&w2ui.historyinboxgrid.destroy();v!=null&&v!=undefined&&v.destroy();v=null;w2ui.realtedhistorygrid!=undefined&&w2ui.realtedhistorygrid.destroy();y!=null&&y!=undefined&&y.destroy();y=null;w2ui.userhistorygrid!=undefined&&w2ui.userhistorygrid.destroy();wu=null}}}(VIS,jQuery),function(n,t){function i(){var k=null,d=null,a=null,et=null,g=null,v=null,nt=null,ot=null,st=null,vt=null,e=null,y=null,ht=null,o=null,yt=null,ct=null,s=null,pt=null,lt=null,h=null,wt=null,at=null,c=null,bt=null,tt=null,p=null,it=null,kt=null,rt=null,ut=null,w=null,f=null,r=null,fi=null,ei=null,l=null,i=null,u=-1,b=!1;this.Load=function(i,u){k=i;d=u;n.Application.isRTL?(nt=t("<div class='vis-rad-recordData' style='float:right'>"),f=t("<button  class='vis-rad-navBtn' disabled='disabled' style='float:left'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/down-arrow.png'>")),r=t("<button  class='vis-rad-navBtn' disabled='disabled' style='float:left'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/up-arrow.png'>")),tt=t("<div class='vis-rad-actionIcons' style='float:right'>"),p=t("<button  class='vis-rad-actionBtn' style='margin-right:0px'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/add-new.png'>")),rt=t("<div class='vis-rad-btnWrap' style='float:left'>"),w=t("<a href = 'javascript:void(0)'  class='vis-rad-buttons' style='margin-left:0px'>").append(n.Msg.getMsg("Cancel")),kt=t("<span class='vis-rad-paging' style='float:none' >").append(l),o=t("<input type='checkbox' checked style='float:right' >"),yt=t("<label style='float:right'>").append(n.Msg.translate(n.Env.getCtx(),"IsActive")),s=t("<input type='checkbox' checked style='float:right'>"),pt=t("<label style='float:right'>").append(n.Msg.translate(n.Env.getCtx(),"IsExclude")),h=t("<input type='checkbox' style='float:right'>"),wt=t("<label style='float:right'>").append(n.Msg.translate(n.Env.getCtx(),"IsReadOnly")),c=t("<input type='checkbox' style='float:right'>"),bt=t("<label style='float:right'>").append(n.Msg.translate(n.Env.getCtx(),"IsDependentEntities"))):(nt=t("<div class='vis-rad-recordData'>"),f=t("<button  class='vis-rad-navBtn' disabled='disabled'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/down-arrow.png'>")),r=t("<button  class='vis-rad-navBtn' disabled='disabled'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/up-arrow.png'>")),tt=t("<div class='vis-rad-actionIcons' >"),p=t("<button  class='vis-rad-actionBtn'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/add-new.png'>")),rt=t("<div class='vis-rad-btnWrap' >"),w=t("<a href = 'javascript:void(0)'  class='vis-rad-buttons'>").append(n.Msg.getMsg("Cancel")),kt=t("<span class='vis-rad-paging'>").append(l),o=t("<input type='checkbox' checked >"),yt=t("<label>").append(n.Msg.translate(n.Env.getCtx(),"IsActive")),s=t("<input type='checkbox' checked >"),pt=t("<label>").append(n.Msg.translate(n.Env.getCtx(),"IsExclude")),h=t("<input type='checkbox'>"),wt=t("<label>").append(n.Msg.translate(n.Env.getCtx(),"IsReadOnly")),c=t("<input type='checkbox'>"),bt=t("<label>").append(n.Msg.translate(n.Env.getCtx(),"IsDependentEntities")));a=t("<div>");et=t("<div class='vis-rad-contantWrap'>");g=t("<div class='vis-rad-contantTop'>");st=t("<div class='vis-rad-roleCombo'>");vt=t("<lable>").append(n.Msg.translate(n.Env.getCtx(),"AD_Role_ID"));e=t("<select>");st.append(vt);st.append(e);y=t("<div class='vis-rad-recordOp'>");ht=t("<div class='vis-rad-check'>");ht.append(o);ht.append(yt);y.append(ht);ct=t("<div class='vis-rad-check'>");ct.append(s);ct.append(pt);y.append(ct);lt=t("<div class='vis-rad-check'>");lt.append(h);lt.append(wt);y.append(lt);at=t("<div class='vis-rad-check'>");at.append(c);at.append(bt);y.append(at);nt.append(st);nt.append(y);g.append(nt);ot=t("<div class='vis-rad-navIcons'>");ot.append(f);ot.append(r);g.append(ot);v=t("<div class='vis-rad-contantBottom'>");it=t("<button  class='vis-rad-actionBtn'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/del.png'>"));tt.append(p);tt.append(it);v.append(tt);l=t("<lable>");v.append(kt);ut=t("<a href = 'javascript:void(0)'  class='vis-rad-buttons'>").append(n.Msg.getMsg("Ok"));rt.append(w);rt.append(ut);v.append(rt);et.append(g);et.append(v);a.append(et);ii();dt();gt();a.dialog({width:600,height:228,resizable:!1,title:"Record",modal:!0})};var dt=function(){for(var r=n.MRole.getDefault().addAccessSQL("SELECT AD_Role_ID, Name FROM AD_Role ORDER BY 2","AD_Role",n.MRole.SQL_NOTQUALIFIED,n.MRole.SQL_RO),t=n.DB.executeReader(r,null,null),i='<option Value="-1"><\/option>';t.read();)i+='<option value="'+t.getInt(0)+'">'+t.getString(1)+"<\/option>";e.append(i);i=null;r=null;t=null},gt=function(){var f="SELECT AD_ROLE_ID,ISACTIVE,ISDEPENDENTENTITIES,ISEXCLUDE,ISREADONLY FROM AD_Record_Access WHERE AD_Table_ID="+k+" AND Record_ID="+d+" AND AD_Client_ID="+n.Env.getCtx().getAD_Client_ID(),r,t;for(i==null&&(i=[]),r=n.DB.executeReader(f,null,null),t=null;r.read();)t={},t.AD_ROLE_ID=r.getInt(0),t.ISACTIVE=r.getString(1),t.ISDEPENDENTENTITIES=r.getString(2),t.ISEXCLUDE=r.getString(3),t.ISREADONLY=r.getString(4),i.push(t);t=null;r=null;f=null;i.length>0?(u=0,ft()):b=!0},ni=function(){var r=e.val(),i;r!=-1&&(i=!1,b||(i=!0),t.ajax({url:n.Application.contextUrl+"RecordAccess/SaveAccess/",dataType:"json",data:{AD_Role_ID:r,AD_Table_ID:k,Record_ID:d,isActive:o.prop("checked"),isExclude:s.prop("checked"),isReadOnly:h.prop("checked"),isDependentEntities:c.prop("checked"),isUpdate:i},success:function(n){var t=n.result;t==!0&&ti()}}))},ii=function(){f.on("click",function(){u+=1;ft()});r.on("click",function(){b?b=!1:u-=1;ft()});p.on("click",function(){ri()});it.on("click",function(){ui()});ut.on("click",function(){ni()});w.on("click",function(){ti()})},ri=function(){b=!0;u=i.length-1;ft();e.val(-1);o.attr("checked",!0);s.attr("checked",!0);h.attr("checked",!1);c.attr("checked",!1);l.empty();l.append("+"+(i.length+1)+"/"+(i.length+1));i.length>0&&(r.attr("disabled",!1),r.css("opacity","1"))},ft=function(){e.val(i[u].AD_ROLE_ID);o.attr("checked",i[u].ISACTIVE=="Y"?!0:!1);s.attr("checked",i[u].ISEXCLUDE=="Y"?!0:!1);h.attr("checked",i[u].ISREADONLY=="Y"?!0:!1);c.attr("checked",i[u].ISDEPENDENTENTITIES=="Y"?!0:!1);l.empty();l.append(u+1+"/"+i.length);i.length>u+1?(f.attr("disabled",!1),f.css("opacity","1")):(f.attr("disabled",!0),f.css("opacity",".5"));u==0?(r.attr("disabled",!0),r.css("opacity",".5")):(r.attr("disabled",!1),r.css("opacity","1"))},ui=function(){var i=e.val();i==-1||b||t.ajax({url:n.Application.contextUrl+"RecordAccess/DeleteRecord/",dataType:"json",data:{AD_Role_ID:i,AD_Table_ID:k,Record_ID:d,isActive:o.prop("checked"),isExclude:s.prop("checked"),isReadOnly:h.prop("checked"),isDependentEntities:c.prop("checked")},success:function(n){var t=n.result;t==!0&&ti()}})},ti=function(){f.off("click");r.off("click");p.off("click");it.off("click");ut.off("click");w.off("click");dt=null;gt=null;ni=null;ii=null;ri=null;ft=null;ui=null;k=null;d=null;g=null;v=null;fi=null;ei=null;f=null;r=null;p=null;it=null;ut=null;w=null;vt=null;e=null;o=null;s=null;h=null;c=null;l=null;i=null;dt=null;gt=null;ni=null;a.dialog("destroy");a.remove();a=null}}n.RecordAccessDialog=i}(VIS,jQuery),function(n,t){function i(){function ai(){r=i.getContextAsInt("$C_Currency_ID");yi();pi();wi();bi();ki();dt.append(ft).append(et).append(ot).append(li);wt.append(p).append(dt);di();vi();u[0].style.visibility="hidden"}function vi(){g.fireValueChanged=lr;o.on("change",function(){yt("C_Currency_ID",o.val());y()});tt.on("change",function(){yt("Date",tt.is(":checked"));y()});w.on("change",function(){ar()});l.on("change",function(){yt("Date",l.val());y()});d.on("click",function(){vr()});kt.on("click",function(){ci();pt()})}function yi(){var t=null,f=n.MLookupFactory.getMLookUp(i,lt.windowNo,3505,n.DisplayType.TableDir),u;if(t=f.getData(!0,!0,!1,!1),t!=null&&t!=undefined&&t.length>0)for(u=0;u<t.length;u++)o.append("<option value="+t[u].Key+">"+t[u].Name+"<\/option>"),t[u].Key==r&&o.val(r);f=n.MLookupFactory.getMLookUp(i,lt.windowNo,3499,n.DisplayType.Search);g=new n.Controls.VTextBoxButton("C_BPartner_ID",!0,!1,!0,n.DisplayType.Search,f)}function pi(){var f=t('<div class="vis-allocation-leftControls">'),u,r;f.append('<span class="vis-allocation-inputLabels">'+n.Msg.translate(i,"C_BPartner_ID")+"<\/span>").append(g.getControl().addClass("vis-allocation-bpartner")).append(g.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB"));u=t('<div class="vis-allocation-leftControls">');u.append('<span class="vis-allocation-inputLabels">'+n.Msg.translate(i,"C_Currency_ID")+"<\/span>").append(o);p.append(f).append(u).append('<div class="vis-allocation-leftControls"><span class="vis-allocation-inputLabels">'+n.Msg.getMsg("Date")+'<\/span><input  class="vis-allocation-date"  type="date"><\/input>').append('<div class="vis-allocation-leftControls"><input name="vchkMultiCurrency" class="vis-allocation-multicheckbox" type="checkbox"><label>'+n.Msg.getMsg("MultiCurrency")+"<\/label><\/div>").append('<div class="vis-allocation-leftControls"><input  class="vis-allocation-cashbox"  type="checkbox"><label>'+n.Msg.getMsg("Cash")+"<\/label><\/div>").append('<div class="vis-allocation-leftControls"><input  class="vis-allocation-autowriteoff"  type="checkbox"><label>'+n.Msg.getMsg("AutoWriteOff")+"<\/label><\/div>");tt=p.find(".vis-allocation-multicheckbox");w=p.find(".vis-allocation-cashbox");l=p.find(".vis-allocation-date");kt=p.find(".vis-allocation-autowriteoff");l.val(Globalize.format(new Date,"yyyy-MM-dd"));r=t('<div class="vis-allocation-resultdiv">');r.append('<div class="vis-allocation-leftControls"><span class="vis-allocation-inputLabels">'+n.Msg.getMsg("Difference")+"<\/span>");r.append('<div style="width:20%" class="vis-allocation-leftControls"><span class="vis-allocation-lblCurrnecy"><\/span>');r.append('<div style="width:80%"  class="vis-allocation-leftControls"><span class="vis-allocation-lbldifferenceAmt"><\/span>');r.append(' <a class="vis-group-btn vis-group-create vis-group-grayBtn" style="float: right;">'+n.Msg.getMsg("Process")+"<\/a>");p.append(r);si=r.find(".vis-allocation-lbldifferenceAmt");d=r.find(".vis-group-btn");d.css({"pointer-events":"none",opacity:"0.5"});hi=r.find(".vis-allocation-lblCurrnecy")}function wi(){ft.append("<p>"+n.Msg.translate(i,"C_Payment_ID")+"<\/p>").append('<div class="vis-allocation-payment-grid"><\/div>').append('<p class="vis-allocate-paymentSum">0-Sum 0.00<\/p>');gt=ft.find(".vis-allocation-payment-grid");ii=ft.find(".vis-allocate-paymentSum")}function bi(){et.append("<p>"+n.Msg.translate(i,"C_CashLine_ID")+"<\/p>").append('<div  class="vis-allocation-cashLine-grid"><\/div>').append('<p class="vis-allocate-cashSum">0-Sum 0.00<\/p>');ni=et.find(".vis-allocation-cashLine-grid");ri=et.find(".vis-allocate-cashSum")}function ki(){ot.append("<p>"+n.Msg.translate(i,"C_Invoice_ID")+"<\/p>").append('<div  class="vis-allocation-invoice-grid"><\/div>').append('<p class="vis-allocate-invoiceSum">0-Sum 0.00<\/p>');ti=ot.find(".vis-allocation-invoice-grid");ui=ot.find(".vis-allocate-invoiceSum")}function di(){u=t("<div class='vis-apanel-busy' style='height:96%; width:98%;'><\/div>");u[0].style.visibility="hidden";wt.append(u)}function y(){var s,c,f,y,e,p;if(a!=0&&r!=0){u[0].style.visibility="visible";s=null;it=l.val();it!=null&&it!=undefined&&it!=""&&(s=n.DB.to_date(it));var t=tt.is(":checked"),w=i.getAD_Role_ID(),d=i.getAD_User_ID(),h=n.MRole.getDefault(),g=a,o="SELECT 'false' as SELECTROW, p.DateTrx as DATE1,p.DocumentNo As DOCUMENTNO,p.C_Payment_ID As CPAYMENTID,c.ISO_Code as ISOCODE,p.PayAmt AS PAYMENT,currencyConvert(p.PayAmt ,p.C_Currency_ID ,"+r+",p.DateTrx ,p.C_ConversionType_ID ,p.AD_Client_ID ,p.AD_Org_ID ) AS CONVERTEDAMOUNT,currencyConvert(ALLOCPAYMENTAVAILABLE(C_Payment_ID) ,p.C_Currency_ID ,"+r+",p.DateTrx ,p.C_ConversionType_ID ,p.AD_Client_ID ,p.AD_Org_ID) as OPENAMT,p.MultiplierAP as MULTIPLIERAP, 0 as APPLIEDAMT FROM C_Payment_v p INNER JOIN C_Currency c ON (p.C_Currency_ID=c.C_Currency_ID) WHERE   ((p.IsAllocated ='N' and p.c_charge_id is null)  OR (p.isallocated = 'N' AND p.c_charge_id is not null and p.isprepayment = 'Y')) AND p.Processed='Y' AND p.C_BPartner_ID="+a;t||(o+=" AND p.C_Currency_ID="+r);o+=" ORDER BY p.DateTrx,p.DocumentNo";o=h.addAccessSQL(o,"p",!0,!1);c=n.DB.executeDataSet(o);v=9;gi(c,t);f="SELECT 'false' as SELECTROW, cn.created as CREATED, cn.receiptno AS RECEIPTNO, cn.c_cashline_id AS CCASHLINEID,c.ISO_Code AS ISO_CODE,cn.amount AS AMOUNT, currencyConvert(cn.Amount ,cn.C_Currency_ID ,"+r+",cn.Created ,114 ,cn.AD_Client_ID ,cn.AD_Org_ID ) AS CONVERTEDAMOUNT, cn.amount as OPENAMT,cn.MultiplierAP AS MULTIPLIERAP,0 as APPLIEDAMT  from c_cashline_new cn INNER join c_currency c ON (cn.C_Currency_ID=c.C_Currency_ID) WHERE cn.IsAllocated   ='N' AND cn.Processed ='Y' and cn.cashtype = 'B' and cn.docstatus in ('CO','CL')  AND cn.C_BPartner_ID="+a;t||(f+=" AND cn.C_Currency_ID="+r);f+=" ORDER BY cn.created,cn.receiptno";f=h.addAccessSQL(f,"cn",!0,!1);y=n.DB.executeDataSet(f);nr(y,t);v=9;e="SELECT 'false' as SELECTROW , i.DateInvoiced  as DATE1 ,  i.DocumentNo    AS DOCUMENTNO  ,  i.C_Invoice_ID AS CINVOICEID,  c.ISO_Code AS ISO_CODE    ,  (invoiceOpen(C_Invoice_ID,C_InvoicePaySchedule_ID)  *i.MultiplierAP) AS CURRENCY    ,currencyConvert(invoiceOpen(C_Invoice_ID,C_InvoicePaySchedule_ID)  *i.MultiplierAP,i.C_Currency_ID ,"+r+",i.DateInvoiced ,i.C_ConversionType_ID ,i.AD_Client_ID ,i.AD_Org_ID ) AS CONVERTED  , currencyConvert(invoiceOpen(C_Invoice_ID,C_InvoicePaySchedule_ID),i.C_Currency_ID,"+r+",i.DateInvoiced,i.C_ConversionType_ID,i.AD_Client_ID,i.AD_Org_ID)                                         *i.MultiplierAP AS AMOUNT,  (currencyConvert(invoiceDiscount(i.C_Invoice_ID ,"+s+",C_InvoicePaySchedule_ID),i.C_Currency_ID ,"+r+",i.DateInvoiced ,i.C_ConversionType_ID ,i.AD_Client_ID ,i.AD_Org_ID )*i.Multiplier*i.MultiplierAP) AS DISCOUNT ,  i.MultiplierAP ,i.docbasetype  ,0 as WRITEOFF ,0 as APPLIEDAMT FROM C_Invoice_v i INNER JOIN C_Currency c ON (i.C_Currency_ID=c.C_Currency_ID) WHERE i.IsPaid='N' AND i.Processed='Y' AND i.C_BPartner_ID="+a;t||(e+=" AND i.C_Currency_ID="+r);e+=" ORDER BY i.DateInvoiced, i.DocumentNo";e=h.addAccessSQL(e,"i",!0,!1);p=n.DB.executeDataSet(e);tr(p,t);b=7;st=8;ht=11;k=12;pt();u[0].style.visibility="hidden"}}function gi(t,r){var f=[],l,o,e,h,u,c;for(f.push({field:"selectrow",caption:"check",size:"40px",editable:{type:"checkbox"}}),u=0;u<t.tables[0].columns.length;u++)t.tables[0].columns[u].name=="date1"?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"Date"),size:"150px",hidden:!1}):t.tables[0].columns[u].name=="documentno"?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"DOCUMENTNO"),size:"150px",hidden:!1}):t.tables[0].columns[u].name=="isocode"&&r==!0?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"TRXCURRENCY"),size:"150px",hidden:!1}):t.tables[0].columns[u].name=="isocode"&&r==!1?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"TRXCURRENCY"),size:"150px",hidden:!0}):t.tables[0].columns[u].name=="payment"&&r==!0?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"AMOUNT"),size:"150px",hidden:!1}):t.tables[0].columns[u].name=="payment"&&r==!1?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"AMOUNT"),size:"150px",hidden:!0}):t.tables[0].columns[u].name=="convertedamount"?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"CONVERTEDAMOUNT"),size:"150px",hidden:!1}):t.tables[0].columns[u].name=="openamt"?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"OPENAMOUNT"),size:"150px",hidden:!1}):t.tables[0].columns[u].name=="appliedamt"?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"AppliedAmount"),size:"150px",hidden:!1}):t.tables[0].columns[u].name=="cpaymentid"?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"c_payment_id"),hidden:!0}):t.tables[0].columns[u].name=="multiplierap"&&f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"multiplierap"),hidden:!0});for(l=[],o=[],t.tables[0].rows.length>0&&(o=Object.keys(t.tables[0].rows[0].cells)),e=0;e<t.tables[0].rows.length;e++){for(h={},h.recid=e,u=0;u<o.length;u++)c=o[u],h[c]=c=="selectrow"?!1:n.Utility.encodeText(t.tables[0].rows[e].cells[c]);l.push(h)}s!=undefined&&s!=null&&(s.destroy(),s=null);s=gt.w2grid({name:"openformatgrid",multiSelect:!0,columns:f,records:l,onClick:function(n){er(n)},onChange:function(n){sr(n)},onDblClick:function(n){ir(n)}})}function nr(t,r){var f=[],l,o,e,s,u,c;for(f.push({field:"selectrow",caption:"check",size:"40px",editable:{type:"checkbox"}}),u=0;u<t.tables[0].columns.length;u++)t.tables[0].columns[u].name=="created"?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"Date"),size:"150px",hidden:!1}):t.tables[0].columns[u].name=="receiptno"?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"RECEIPTNO"),size:"150px",hidden:!1}):t.tables[0].columns[u].name=="iso_code"&&r==!0?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.getMsg("TRX"),size:"150px",hidden:!1}):t.tables[0].columns[u].name=="iso_code"&&r==!1?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.getMsg("TRX"),size:"150px",hidden:!0}):t.tables[0].columns[u].name=="amount"&&r==!0?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"AMOUNT"),size:"150px",hidden:!1}):t.tables[0].columns[u].name=="amount"&&r==!1?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"AMOUNT"),size:"150px",hidden:!0}):t.tables[0].columns[u].name=="convertedamount"?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.getMsg("Converted"),size:"150px",hidden:!1}):t.tables[0].columns[u].name=="openamt"?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"OPENAMOUNT"),size:"150px",hidden:!1}):t.tables[0].columns[u].name=="appliedamt"?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"AppliedAmount"),size:"150px",hidden:!1}):t.tables[0].columns[u].name=="ccashlineid"?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"ccashlineid"),size:"150px",hidden:!0}):t.tables[0].columns[u].name=="multiplierap"&&f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"multiplierap"),hidden:!0});for(l=[],o=[],t.tables[0].rows.length>0&&(o=Object.keys(t.tables[0].rows[0].cells)),e=0;e<t.tables[0].rows.length;e++){for(s={},s.recid=e,u=0;u<o.length;u++)c=o[u],s[c]=c=="selectrow"?!1:n.Utility.encodeText(t.tables[0].rows[e].cells[c]);l.push(s)}h!=undefined&&h!=null&&(h.destroy(),h=null);h=ni.w2grid({name:"openformatgridcash",multiSelect:!0,columns:f,records:l,onChange:function(n){hr(n)},onClick:function(n){or(n)},onDblClick:function(n){rr(n)}})}function tr(t,r){var f=[],l,o,e,s,u,h;for(f.push({field:"selectrow",caption:"check",size:"40px",editable:{type:"checkbox"}}),u=0;u<t.tables[0].columns.length;u++)t.tables[0].columns[u].name=="date1"?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"Date"),size:"150px",hidden:!1}):t.tables[0].columns[u].name=="documentno"?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"DocumentNo"),size:"150px",hidden:!1}):t.tables[0].columns[u].name=="iso_code"&&r==!0?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.getMsg("Trx"),size:"150px",hidden:!1}):t.tables[0].columns[u].name=="iso_code"&&r==!1?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.getMsg("Trx"),size:"150px",hidden:!0}):t.tables[0].columns[u].name=="currency"&&r==!0?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"AMOUNT"),size:"150px",hidden:!1}):t.tables[0].columns[u].name=="currency"&&r==!1?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"AMOUNT"),size:"150px",hidden:!0}):t.tables[0].columns[u].name=="converted"?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.getMsg("Converted"),size:"150px",hidden:!1}):t.tables[0].columns[u].name=="amount"?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"OPENAMOUNT"),size:"150px",hidden:!1}):t.tables[0].columns[u].name=="docbasetype"?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"DocBaseType"),size:"150px",hidden:!0}):t.tables[0].columns[u].name=="discount"?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"Discount"),size:"150px",hidden:!1}):t.tables[0].columns[u].name=="writeoff"?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"WriteOff"),size:"150px",hidden:!1}):t.tables[0].columns[u].name=="appliedamt"?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"AppliedAmount"),size:"150px",hidden:!1}):t.tables[0].columns[u].name=="cinvoiceid"?f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"cinvoiceid"),size:"150px",hidden:!0}):t.tables[0].columns[u].name=="multiplierap"&&f.push({field:t.tables[0].columns[u].name,caption:n.Msg.translate(i,"multiplierap"),hidden:!0});for(l=[],o=[],t.tables[0].rows.length>0&&(o=Object.keys(t.tables[0].rows[0].cells)),e=0;e<t.tables[0].rows.length;e++){for(s={},s.recid=e,u=0;u<o.length;u++)h=o[u],s[h]=h=="selectrow"?!1:n.Utility.encodeText(t.tables[0].rows[e].cells[h]);l.push(s)}c!=undefined&&c!=null&&(c.destroy(),c=null);c=ti.w2grid({name:"openformatgridinvoice",multiSelect:!0,columns:f,records:l,onChange:function(n){cr(n)},onClick:function(n){fr(n)},onDblClick:function(n){ur(n)}})}function ir(n){var i,r;if(w2ui.openformatgrid.columns[n.column].field=="appliedamt"){if(i=w2ui.openformatgrid.getChanges(),i==undefined||i.length==0)return;if(r=t.grep(i,function(t){return parseInt(t.recid)==parseInt(n.recid)}),r==null||r==undefined||r[0].selectrow==undefined){w2ui.openformatgrid.columns[n.column].editable=!1;return}w2ui.openformatgrid.columns[n.column].editable={type:"text"}}}function rr(n){var i,r;if(w2ui.openformatgridcash.columns[n.column].field=="appliedamt"){if(i=w2ui.openformatgridcash.getChanges(),i==undefined||i.length==0)return;if(r=t.grep(i,function(t){return parseInt(t.recid)==parseInt(n.recid)}),r==null||r==undefined||r[0].selectrow==undefined){w2ui.openformatgridcash.columns[n.column].editable=!1;return}w2ui.openformatgridcash.columns[n.column].editable={type:"text"}}}function ur(n){var i,r;if(w2ui.openformatgridinvoice.columns[n.column].field=="appliedamt"||w2ui.openformatgridinvoice.columns[n.column].field=="writeoff"||w2ui.openformatgridinvoice.columns[n.column].field=="discount"){if(i=w2ui.openformatgridinvoice.getChanges(),i==undefined||i.length==0)return;if(r=t.grep(i,function(t){return parseInt(t.recid)==parseInt(n.recid)}),r==null||r==undefined||r[0].selectrow==undefined){w2ui.openformatgridinvoice.columns[n.column].editable=!1;return}w2ui.openformatgridinvoice.columns[n.column].editable={type:"text"}}}function fr(n){var u=w2ui.openformatgridinvoice.getColumn("appliedamt",!0),r,i;(n.column==0||n.column==null)&&(r=w2ui.openformatgridinvoice.getChanges(),i=t.grep(r,function(t){return parseInt(t.recid)==parseInt(n.recid)}),i==null||i==undefined||i.length==0||i[0].selectrow==undefined?(w2ui.openformatgridinvoice.refreshCell(0,"appliedamt"),w2ui.openformatgridinvoice.refreshCell(0,"writeoff"),w2ui.openformatgridinvoice.refreshCell(0,"discount")):i[0].selectrow==!0||(w2ui.openformatgridinvoice.unselect(n.recid),w2ui.openformatgridinvoice.columns[u].editable=!1,w2ui.openformatgridinvoice.get(0).changes.appliedamt="0",w2ui.openformatgridinvoice.refreshCell(0,"appliedamt"),w2ui.openformatgridinvoice.get(0).changes.discount="0",w2ui.openformatgridinvoice.refreshCell(0,"discount"),w2ui.openformatgridinvoice.get(0).changes.writeoff="0",w2ui.openformatgridinvoice.refreshCell(0,"writeoff")),nt(n.recid,n.column,!0,!1))}function er(n){var r,u,i;if(vt){n.preventDefault();return}r=w2ui.openformatgrid.getColumn("appliedamt",!0);(n.column==0||n.column==null)&&(u=w2ui.openformatgrid.getChanges(),i=t.grep(u,function(t){return parseInt(t.recid)==parseInt(n.recid)}),i==null||i==undefined||i.length==0||i[0].selectrow==undefined?w2ui.openformatgrid.refreshCell(n.recid,"appliedamt"):i[0].selectrow==!0||(w2ui.openformatgrid.unselect(n.recid),w2ui.openformatgrid.columns[r].editable=!1,w2ui.openformatgrid.get(n.recid).changes.appliedamt="0",w2ui.openformatgrid.refreshCell(n.recid,"appliedamt")),nt(n.recid,n.column,!1,!1))}function or(n){var r,u,i;if(at){n.preventDefault();return}r=w2ui.openformatgridcash.getColumn("appliedamt",!0);(n.column==0||n.column==null)&&(u=w2ui.openformatgridcash.getChanges(),i=t.grep(u,function(t){return parseInt(t.recid)==parseInt(n.recid)}),i==null||i==undefined||i.length==0||i[0].selectrow==undefined?w2ui.openformatgridcash.refreshCell(0,"appliedamt"):i[0].selectrow==!0||(w2ui.openformatgridcash.unselect(n.recid),w2ui.openformatgridcash.columns[r].editable=!1,w2ui.openformatgridcash.get(0).changes.appliedamt="0",w2ui.openformatgridcash.refreshCell(0,"appliedamt")),nt(n.recid,n.column,!0,!0))}function sr(n){if(vt){n.preventDefault();return}var t=w2ui.openformatgrid.getColumn("appliedamt",!0);w2ui.openformatgrid.columns[t].editable!=undefined&&(w2ui.openformatgrid.getChanges(n.recid)!=undefined&&w2ui.openformatgrid.getChanges(n.recid).length>0?(w2ui.openformatgrid.get(n.recid).changes.appliedamt=n.value_new,w2ui.openformatgrid.refreshCell(n.recid,"appliedamt")):n.column>0&&w2ui.openformatgrid.set(n.recid,{appliedamt:n.value_new}),n.column==t&&(parseFloat(w2ui.openformatgrid.get(n.index).openamt)>parseFloat(w2ui.openformatgrid.get(n.index).appliedamt)||w2ui.openformatgrid.set(0,{appliedamt:w2ui.openformatgrid.get(n.index).openamt}),nt(n.index,n.column,!1,!1)))}function hr(n){if(at){n.preventDefault();return}var t=w2ui.openformatgridcash.getColumn("appliedamt",!0);w2ui.openformatgridcash.columns[t].editable!=undefined&&(w2ui.openformatgridcash.getChanges(n.recid)!=undefined&&w2ui.openformatgridcash.getChanges(n.recid).length>0?(w2ui.openformatgridcash.get(n.recid).changes.appliedamt=n.value_new,w2ui.openformatgridcash.refreshCell(n.recid,"appliedamt")):n.column>0&&w2ui.openformatgridcash.set(n.recid,{appliedamt:n.value_new}),n.column==t&&(parseFloat(w2ui.openformatgridcash.get(n.index).openamt)>parseFloat(w2ui.openformatgridcash.get(n.index).appliedamt)||w2ui.openformatgridcash.set(0,{appliedamt:w2ui.openformatgridcash.get(n.index).paidamount}),nt(n.index,n.column,!0,!0)))}function cr(n){var t=w2ui.openformatgridinvoice.getColumn("appliedamt",!0),i=w2ui.openformatgridinvoice.getColumn("writeoff",!0),r=w2ui.openformatgridinvoice.getColumn("discount",!0);(w2ui.openformatgridinvoice.columns[t].editable!=undefined||w2ui.openformatgridinvoice.columns[i].editable!=undefined||w2ui.openformatgridinvoice.columns[r].editable!=undefined)&&(w2ui.openformatgridinvoice.getChanges(n.recid)!=undefined&&w2ui.openformatgridinvoice.getChanges(n.recid).length>0?t==n.column?(w2ui.openformatgridinvoice.get(n.recid).changes.appliedamt=n.value_new,w2ui.openformatgridinvoice.refreshCell(n.recid,"appliedamt")):i==n.column?(w2ui.openformatgridinvoice.get(n.recid).changes.writeoff=n.value_new,w2ui.openformatgridinvoice.refreshCell(n.recid,"writeoff")):r==n.column&&(w2ui.openformatgridinvoice.get(n.recid).changes.discount=n.value_new,w2ui.openformatgridinvoice.refreshCell(n.recid,"discount")):n.column>0&&(t==n.column?w2ui.openformatgridinvoice.set(n.recid,{appliedamt:n.value_new}):i==n.column?w2ui.openformatgridinvoice.set(n.recid,{writeoff:n.value_new}):r==n.column&&w2ui.openformatgridinvoice.set(n.recid,{discount:n.value_new})),(n.column==w2ui.openformatgridinvoice.getColumn("discount",!0)||n.column==w2ui.openformatgridinvoice.getColumn("writeoff",!0)||n.column==w2ui.openformatgridinvoice.getColumn("appliedamt",!0))&&nt(n.index,n.column,!0,!1))}function nt(n,t,i,r){var u=n,h=t,s,f,o,e;if((h==null||h==undefined)&&(h=0),i){if(r)h==0&&(o=w2ui.openformatgridcash.columns,oi=ut(w2ui.openformatgridcash.getChanges(),u),s=o[v].field,f=w2ui.openformatgridcash.get(u).changes,oi?(e=parseFloat(w2ui.openformatgridcash.get(u)[o[b].field]),s=="appliedamt"&&(f!=null&&f!=undefined?(f.appliedamt=e,w2ui.openformatgridcash.refreshCell(u,"appliedamt")):w2ui.openformatgridcash.set(u,{appliedamt:e}))):s=="appliedamt"&&(f!=null&&f!=undefined?(f.appliedamt=0,w2ui.openformatgridcash.refreshCell(u,"appliedamt")):w2ui.openformatgridcash.set(u,{appliedamt:0})));else if(h==0){o=w2ui.openformatgridinvoice.columns;fi=ut(w2ui.openformatgridinvoice.getChanges(),u);var f=w2ui.openformatgridinvoice.get(u).changes,l=o[ht].field,c=o[k].field;fi?(e=parseFloat(w2ui.openformatgridinvoice.get(u)[o[b].field]),e=e-parseFloat(w2ui.openformatgridinvoice.get(u)[o[st].field]),c=="appliedamt"&&(f!=null&&f!=undefined?(f.writeoff=0,f.appliedamt=e,w2ui.openformatgridinvoice.refreshCell(u,"writeoff"),w2ui.openformatgridinvoice.refreshCell(u,"appliedamt")):(w2ui.openformatgridinvoice.set(u,{writeoff:0}),w2ui.openformatgridinvoice.set(u,{appliedamt:e})))):c=="appliedamt"&&f!=null&&f!=undefined&&(f.writeoff=0,f.appliedamt=e,w2ui.openformatgridinvoice.refreshCell(u,"writeoff"),w2ui.openformatgridinvoice.refreshCell(u,"appliedamt"))}}else h==0&&(o=w2ui.openformatgrid.columns,ei=ut(w2ui.openformatgrid.getChanges(),u),s=o[v].field,f=w2ui.openformatgrid.get(u).changes,ei?(e=parseFloat(w2ui.openformatgrid.get(u)[o[b].field]),s=="appliedamt"&&(f!=null&&f!=undefined?(f.appliedamt=e,w2ui.openformatgrid.refreshCell(u,"appliedamt")):w2ui.openformatgrid.set(u,{appliedamt:e}))):s=="appliedamt"&&(f!=null&&f!=undefined?(f.appliedamt=0,w2ui.openformatgrid.refreshCell(u,"appliedamt")):w2ui.openformatgrid.set(u,{appliedamt:0})));kt.is(":checked")&&ci();pt()}function ut(n,i){if(n==null||n.length==0)return!1;var r=t.grep(n,function(n){return parseInt(n.recid)==i});return r==null||r==undefined||r.length==0||r[0].selectrow==undefined?!1:r[0].selectrow}function ci(){var i,r,n,o;if(e=0,f=0,w.is(":checked"))for(i=w2ui.openformatgridcash.getChanges(),n=0;n<i.length;n++)i[n].selectrow==!0&&(f+=parseFloat(i[n].appliedamt));else for(r=w2ui.openformatgrid.getChanges(),n=0;n<r.length;n++)r[n].selectrow==!0&&(f+=parseFloat(r[n].appliedamt));var u=w2ui.openformatgridinvoice.getChanges(),t=null,s=w2ui.openformatgridinvoice.columns;for(n=u.length-1;n>=0;n--)u[n].selectrow==!0&&(e+=parseFloat(u[n].appliedamt),t==null&&(t=w2ui.openformatgridinvoice.get(u[n].recid),t[s[b].field]<=0&&(t=null)));e>f&&(o=e-f,e*.05>=o&&t!=null&&(t.changes.writeoff=o,t.changes.appliedamt=t.changes.appliedamt-o,w2ui.openformatgridinvoice.refreshCell(t.recid,"writeoff"),w2ui.openformatgridinvoice.refreshCell(t.recid,"appliedamt")))}function lr(){yt(g.getName(),g.value)}function yt(n,t){t!=null&&(n=="C_BPartner_ID"?(a=t,y()):n=="C_Currency_ID"?(r=parseInt(t),y()):n=="Date"&&tt&&y())}function pt(){var b=n.DisplayType.GetNumberFormat(n.DisplayType.Amount),i=new Date,c,p,w,t,r,e,g;i=null;c=parseFloat(0);bt=0;var s=null,h=null,f=null;if(s=w2ui.openformatgrid.getChanges(),h=w2ui.openformatgridcash.getChanges(),f=w2ui.openformatgridinvoice.getChanges(),s!=null)for(t=0;t<s.length;t++)if(s[t].selectrow==!0){var u=w2ui.openformatgrid.get(s[t].recid),a=new Date(u.date1),y=new n.TimeUtil;i=y.max(i,a);r=Object.keys(u);e=parseFloat(s[t][r[v+1]]);c=c+e;bt++}if(ii.text(bt+" - "+n.Msg.getMsg("Sum")+"  "+b.GetFormatedValue(c)+" "),p=parseFloat(0),ct=0,h!=null)for(t=0;t<h.length;t++)if(h[t].selectrow==!0){var u=w2ui.openformatgridcash.get(h[t].recid),a=new Date(u.date1),y=new n.TimeUtil;i=y.max(i,a);r=Object.keys(u);e=parseFloat(h[t][r[v+1]]);p=p+e;ct++}if(ri.text(ct+" - "+n.Msg.getMsg("Sum")+"  "+b.GetFormatedValue(p)+" "),w=parseFloat(0),rt=0,f!=null)for(t=0;t<f.length;t++)if(f[t].selectrow==!0){var u=w2ui.openformatgridinvoice.get(f[t].recid),a=new Date(u.date1),y=new n.TimeUtil;i=y.max(i,a);r=Object.keys(u);e=f[t][r[k+1]]!=""?parseFloat(f[t][r[k+1]]):0;w=w+e;rt++}ui.text(rt+" - "+n.Msg.getMsg("Sum")+"  "+b.GetFormatedValue(w)+" ");i!=null&&l.val(Globalize.format(i,"yyyy-MM-dd"));o.children("option").filter(":selected").text()!=null&&hi.text(o.children("option").filter(":selected").text());g=c+p-w;si.text(b.GetFormatedValue(g));g==parseFloat(0)?(d.prop("readonly",!1),d.css({"pointer-events":"auto",opacity:"1"})):(d.prop("readonly",!0),d.css({"pointer-events":"none",opacity:"0.5"}))}function ar(){var i=w2ui.openformatgrid.getChanges(),r=w2ui.openformatgridcash.getChanges(),n,u,t;if(w.is(":checked")){if(at=!1,vt=!0,i!=null){for(n=0;n<i.length;n++)u=ut(w2ui.openformatgrid.getChanges(),i[n].recid),u&&(t=w2ui.openformatgrid.get(i[n].recid).changes,t!=null&&t!=undefined&&(t.selectrow=!1,t.appliedamt=0,w2ui.openformatgrid.refreshCell(i[n].recid,"selectrow"),w2ui.openformatgrid.refreshCell(i[n].recid,"appliedamt")));w2ui.openformatgrid.refresh()}}else if(at=!0,vt=!1,r!=null){for(n=0;n<r.length;n++)u=ut(w2ui.openformatgridcash.getChanges(),r[n].recid),u&&(t=w2ui.openformatgridcash.get(r[n].recid).changes,t!=null&&t!=undefined&&(t.selectrow=!1,t.appliedamt=0,w2ui.openformatgridcash.refreshCell(r[n].recid,"selectrow"),w2ui.openformatgridcash.refreshCell(r[n].recid,"appliedamt")));w2ui.openformatgrid.refresh()}pt()}function vr(){var i=!0,t;if(e>f?(t=e-f,e*.05<=t&&(i=n.ADialog.ask("AllocationWriteOffWarn"))):f>e&&(t=f-e,f*.05>=t&&(i=n.ADialog.error("AllocationWriteOffWarn"))),i){u[0].style.visibility="visible";var r=w2ui.openformatgrid.getChanges(),o=w2ui.openformatgridcash.getChanges(),s=w2ui.openformatgridinvoice.getChanges(),h=l.val();w.is(":checked")?yr(r,o,s,h):pr(r,o,s,h)}}function yr(i,r,f){var h,s,e,c,p,d;if(rt+ct==0)return"";var g="",nt="",tt="",it="",ut="",ft=[],et=[],ot=[];for(s=0;s<i.length;s++)e=w2ui.openformatgrid.get(i[s].recid),ft.push({appliedamt:i[s].appliedamt,date:e.date1,converted:e.convertedamount,cpaymentid:e.cpaymentid,documentno:e.documentno,isocode:e.isocode,multiplierap:e.multiplierap,openamt:e.openamt,payment:e.payment});if(r.length>0)for(h=Object.keys(w2ui.openformatgridcash.get(0)),g=h[v+1],s=0;s<r.length;s++)e=w2ui.openformatgridcash.get(r[s].recid),et.push({appliedamt:r[s].appliedamt,date:e.created,amount:e.amount,ccashlineid:e.ccashlineid,converted:e.convertedamount,isocode:e.iso_code,multiplierap:e.multiplierap,openamt:e.openamt,receiptno:e.receiptno});if(f.length>0)for(h=Object.keys(w2ui.openformatgridinvoice.get(0)),nt=h[k+1],tt=h[st+1],it=h[ht+1],ut=h[b+1],s=0;s<f.length;s++)e=w2ui.openformatgridinvoice.get(f[s].recid),c=f[s].discount,c==undefined&&(c=e.discount),p=f[s].appliedamt,p==undefined&&(p=e.appliedamt),d=f[s].writeoff,d==undefined&&(d=e.writeoff),ot.push({appliedamt:p,discount:c,writeoff:d,cinvoiceid:e.cinvoiceid,converted:e.converted,currency:e.currency,date:e.date1,docbasetype:e.docbasetype,documentno:e.documentno,isocode:e.iso_code,multiplierap:e.multiplierap,amount:e.amount});t.ajax({url:n.Application.contextUrl+"PaymentAllocation/SaveCashData",data:{paymentData:JSON.stringify(ft),cashData:JSON.stringify(et),invoiceData:JSON.stringify(ot),currency:o.val(),isCash:w.is(":checked"),_C_BPartner_ID:a,_windowNo:lt.windowNo,payment:g,DateTrx:l.val(),appliedamt:nt,discount:tt,writeOff:it,open:ut},success:function(){y();u[0].style.visibility="hidden"},error:function(){u[0].style.visibility="hidden"}})}function pr(i,r,f){var h,s,e,c,p,d;if(rt+v==0)return"";var g="",nt="",tt="",it="",ut="",ft=[],et=[],ot=[];for(s=0;s<i.length;s++)e=w2ui.openformatgrid.get(i[s].recid),h=Object.keys(w2ui.openformatgrid.get(0)),g=h[10],ft.push({appliedamt:i[s].appliedamt,date:e.date1,converted:e.convertedamount,cpaymentid:e.cpaymentid,documentno:e.documentno,isocode:e.isocode,multiplierap:e.multiplierap,openamt:e.openamt,payment:e.payment});if(r.length>0)for(h=Object.keys(w2ui.openformatgridcash.get(0)),s=0;s<r.length;s++)e=w2ui.openformatgridcash.get(r[s].recid),et.push({appliedamt:r[s].appliedamt,date:e.created,amount:e.amount,ccashlineid:e.ccashlineid,converted:e.convertedamount,isocode:e.iso_code,multiplierap:e.multiplierap,openamt:e.openamt,receiptno:e.receiptno});if(f.length>0)for(h=Object.keys(w2ui.openformatgridinvoice.get(0)),nt=h[k+1],g=h[k+1],tt=h[st+1],it=h[ht+1],ut=h[b+1],s=0;s<f.length;s++)e=w2ui.openformatgridinvoice.get(f[s].recid),c=f[s].discount,c==undefined&&(c=e.discount),p=f[s].appliedamt,p==undefined&&(p=e.appliedamt),d=f[s].writeoff,d==undefined&&(d=e.writeoff),ot.push({appliedamt:p,discount:c,writeoff:d,cinvoiceid:e.cinvoiceid,converted:e.converted,currency:e.currency,date:e.date1,docbasetype:e.docbasetype,documentno:e.documentno,isocode:e.iso_code,multiplierap:e.multiplierap,amount:e.amount});t.ajax({url:n.Application.contextUrl+"PaymentAllocation/SavePaymentData",data:{paymentData:JSON.stringify(ft),cashData:JSON.stringify(et),invoiceData:JSON.stringify(ot),currency:o.val(),isCash:w.is(":checked"),_C_BPartner_ID:a,_windowNo:lt.windowNo,payment:g,DateTrx:l.val(),appliedamt:nt,discount:tt,writeOff:it,open:ut},success:function(){y();u[0].style.visibility="hidden"},error:function(){u[0].style.visibility="hidden"}})}this.frame=null;this.windowNo=0;var i=n.Env.getCtx(),wt=t('<div class="vis-allocate-root">'),p=t('<div  style="width:25%;background-color: #f8f8f8;float: left;height: 100%;position: relative;padding: 15px;">'),dt=t('<div class="vis-allocation-rightContainer">'),ft=t('<div class="vis-allocate-paymentdiv" >'),et=t('<div class="vis-allocate-cashdiv" >'),ot=t('<div class="vis-allocate-invoicediv" >'),li=t("<div >"),g=null,o=t('<select class="vis-allocation-currencycmb" ><\/select>'),gt=null,ni=null,ti=null,s=null,h=null,c=null,tt=null,w=null,l=null,a=0,r=0,v=7,it=null,b=6,st=7,ht=10,k=11,ii=null,ri=null,ui=null,rt=0,bt=0,ct=0,fi=!1,ei=!1,oi=!1,si=null,d=null,hi=null,kt=null,u=null,lt=this,at=!0,vt=!1,f=0,e=0;ai();this.disposeComponent=function(){s!=undefined&&s!=null&&(s.destroy(),s=null);h!=undefined&&h!=null&&(h.destroy(),h=null);c!=undefined&&c!=null&&(c.destroy(),c=null)};this.getRoot=function(){return wt}}i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.frame.getContentGrid().append(this.getRoot())};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps=n.Apps||{};n.Apps.AForms=n.Apps.AForms||{};n.Apps.AForms.VAllocation=i}(VIS,jQuery),function(n,t){function i(){function ci(){h.append('<div class="col-lg-4 col-md-4"><div class="vis-group-content-wrap"><\/div><\/div><div class="col-lg-4 col-md-4"><div class="vis-group-content-wrap"><\/div><\/div><div class="col-lg-4 col-md-4 last-child"><div class="vis-group-content-wrap"><\/div><\/div>');var n=h.find(".vis-group-content-wrap");v=t(n[0]);c=t(n[1]);l=t(n[2]);n=null;li();yi();pi();wi()}function li(){i=t("<div class='vis-apanel-busy' style='height:96%; width:98%;'><\/div>");i[0].style.visibility="hidden";h.append(i)}function ai(){b.on("click",nr);d.on("click",at);y.on("keydown",ur);nt.on("click",ti);ut.on("click",vt);it.on("click",ni);w.on("keydown",fr);tt.on("click",gt);p.on("keydown",er);rt.on("click",ir);g.on("click",tr);r.on("scroll",rr);h.on("click",vi)}function vi(i){var r=t(i.target);return!r.hasClass("vis-group-roless")&&r.parents(".vis-group-roless").length==0&&!r.hasClass("vis-group-ass-btns vis-group-save-btn")&&a.length>0?(n.ADialog.ask("VIS_SaveRole")?ti():a=[],i.stopPropagation(),!1):!r.hasClass("vis-group-groupss")&&r.parents(".vis-group-groupss").length==0&&!r.hasClass("vis-group-ass-btns vis-group-save-btn")&&e.length>0?(n.ADialog.ask("VIS_SaveGroup")?vt():e=[],i.stopPropagation(),!1):void 0}function yi(){i[0].style.visibility="visible";v.append('<div class="vis-group-content-head"><h4 class="vis-group-content-tittle vis-group-createUser">'+n.Msg.getMsg("VIS_CreateInviteUser")+'<\/h4><span class=" vis-group-pointer vis-group-head-right">'+n.Msg.getMsg("SortBy")+'<\/span><div class="vis-group-clear-both"><\/div><\/div>');st=v.find(".vis-group-head-right");v.append('<div class="vis-group-content-headDown"><input class="vis-group-add-btn vis-group-pointer vis-group-addLeft vis-group-ass-btns" type="button"><input class="vis-group-SearchText" value="" placeholder="'+n.Msg.getMsg("Search")+'" type="text"><input class=" vis-group-pointer vis-group-ass-btns vis-group-search-icon" type="button"><div class="vis-group-clear-both"><\/div> <\/div>');y=v.find(".vis-group-SearchText");d=v.find(".vis-group-search-icon");b=v.find(".vis-group-add-btn");r=t('<div class="vis-group-users-container">').append('<div style="border-top: 1px solid #dfdfdf; width: 97%;"><\/div>');r.height(t(h.parent()).height()-95);v.append(r);ki()}function pi(){c.append(' <div class="vis-group-content-head"><h4 class="vis-group-content-tittle vis-group-role">'+n.Msg.getMsg("Role")+'<\/h4><h7 class="vis-group-SaveMessage">'+n.Msg.getMsg("VIS_RoleSaved")+'<\/h7><div class="vis-group-top-right"><input class="vis-group-ass-btns vis-group-pointer vis-group-add-btn" type="button"><input class="vis-group-ass-btns vis-group-pointer vis-group-save-btn" type="button"><\/div><div class="vis-group-content-headDown"><span><input class="vis-group-SearchText" value="" placeholder="'+n.Msg.getMsg("Search")+'" type="text"><input class="vis-group-ass-btns vis-group-pointer vis-group-search-icon" type="button"> <\/span><\/div><div class="vis-group-clear-both"><\/div><\/div>');nt=c.find(".vis-group-save-btn");g=c.find(".vis-group-add-btn");p=c.find(".vis-group-SearchText");tt=c.find(".vis-group-ass-btns");u=t('<div class="vis-group-role-container">');u.append('<div style="border-top: 1px solid #dfdfdf; width: 97%;"><\/div>');c.append(u);u.height(t(h.parent()).height()-95);ui()}function wi(){l.append('<div class="vis-group-content-head"><h4 class="vis-group-content-tittle vis-group-rights">'+n.Msg.getMsg("VIS_Groups")+'<\/h4><h7 class="vis-group-SaveMessage">'+n.Msg.getMsg("VIS_GroupSaved")+'<\/h7><div class="vis-group-top-right"><div class="vis-group-top-right"><input class="vis-group-ass-btns vis-group-pointer vis-group-add-btn" type="button"><input class="vis-group-ass-btns vis-group-pointer vis-group-save-btn" type="button"><\/div><\/div><div class="vis-group-content-headDown"><span><input class="vis-group-SearchText"  value="" placeholder="'+n.Msg.getMsg("Search")+'" type="text"><input class="vis-group-ass-btns vis-group-pointer vis-group-search-icon" type="button"> <\/span><\/div><div class="vis-group-clear-both"><\/div><\/div>');w=l.find(".vis-group-SearchText");it=l.find(".vis-group-ass-btns");rt=l.find(".vis-group-add-btn");ut=l.find(".vis-group-save-btn");f=t('<div class="vis-group-role-container">').append('<div style="vis-group-border-top: 1px solid #dfdfdf; width: 97%;"><\/div>');l.append(f);f.height(t(h.parent()).height()-95);gi()}function bi(){k.append("<li value=1>"+n.Msg.getMsg("Name")+"<\/li>");k.append("<li value=2>"+n.Msg.getMsg("SearchKey")+"<\/li>");k.append("<li value=3>"+n.Msg.getMsg("EMail")+"<\/li>");st.on("click",function(){t(this).w2overlay(k.clone(!0))});k.on(n.Events.onTouchStartOrClick,"LI",function(){dt=t(this).val();at()})}function ki(){di();at()}function di(){var i=' <script type="text/x-handlebars-template">{{#each this}}<div class="vis-group-user-wrap"  data-UID="{{AD_UserID}}"><div class="vis-group-user-profile vis-group-pro-width"><div style=" height:46px;width:46px" class="vis-group-user-img">{{#if UserImage}}<img src="'+n.Application.contextUrl+'{{UserImage}}" alt="user-img">{{else}}<img src="'+n.Application.contextUrl+'Areas/VIS/Images/home/defaultUser46X46.PNG" alt="user-img">{{/if}}<\/div><div class="vis-group-user-text">{{#if IsActive }}<p style="font-weight: bold">{{Username}}<\/p>{{else}}<p>{{Username}}<\/p>{{/if}}<span>{{Email}}<\/span><\/div><\/div><div class="vis-group-user-right"><ul>{{#if IsActive }}{{#if IsUpdate}}<li><span class="vis-group-user-ico vis-group-pointer vis-group-activeUser" data-UID="{{AD_UserID}}"><\/span><\/li>{{else}}<li><span disabled class="vis-group-user-ico vis-group-pointer vis-group-activeUser" data-UID="{{AD_UserID}}"><\/span><\/li>{{/if}}{{else}}{{#if IsUpdate}}<li><span class="vis-group-user-ico vis-group-pointer vis-group-inactiveUser"  data-UID="{{AD_UserID}}"><\/span><\/li>{{else}}<li><span disabled class="vis-group-user-ico vis-group-pointer vis-group-inactiveUser"  data-UID="{{AD_UserID}}"><\/span><\/li>{{/if}}{{/if}}<li><span class="vis-group-user-ico vis-group-pointer vis-group-edit" data-UID="{{AD_UserID}}-{{UserTableID}}-{{UserWindowID}}"><\/span><\/li><\/ul><p>{{Country}}<\/p><\/div><\/div>{{/each}}​<\/script>';yt=t(i).html();ht=Handlebars.compile(yt)}function ui(){pt=t(' <script type="text/x-handlebars-template">{{#each this}}<div class="vis-group-user-wrap vis-group-roless vis-group-role-pad"  data-UID="{{AD_Role_ID}}"><div class="vis-group-user-profile">{{#if IsAssignedToUser}}{{#if IsUpdate}}<input type="checkbox" data-UID="{{AD_Role_ID}}" checked="">{{else}}<input disabled type="checkbox" data-UID="{{AD_Role_ID}}" checked="">{{/if}}<label style="color: #535353;font-weight: bold;">{{Name}}<\/label>{{else}}{{#if IsUpdate}}<input type="checkbox" data-UID="{{AD_Role_ID}}" >{{else}}<input disabled type="checkbox" data-UID="{{AD_Role_ID}}" >{{/if}}<label>{{Name}}<\/label>{{/if}}<\/div><div class="vis-group-user-right"><ul><li><span class="vis-group-user-ico vis-group-pointer vis-group-edit"  data-UID="{{AD_Role_ID}}-{{roleWindowID}}"><\/span><\/li><\/ul><\/div><\/div>{{/each}}​<\/script>').html();wt=Handlebars.compile(pt)}function gi(){bt=t(' <script type="text/x-handlebars-template">{{#each this}}<div class="vis-group-user-wrap vis-group-groupss vis-group-role-pad" data-UID="{{AD_Group_ID}}"><div class="vis-group-user-profile">{{#if IsAssignedToUser}}<input type="checkbox" data-UID="{{AD_Group_ID}}" checked=""><label style="color: #535353;font-weight: bold;">{{Name}}<\/label>{{else}}<input type="checkbox" data-UID="{{AD_Group_ID}}" ><label>{{Name}}<\/label>{{/if}}<\/div><div class="vis-group-user-right"><ul><li><span class="vis-group-user-ico vis-group-info vis-group-pointer"   data-UID="{{AD_Group_ID}}-{{GroupWindowID}}"><\/span><\/li><li><span class="vis-group-user-ico vis-group-edit vis-group-pointer"   data-UID="{{AD_Group_ID}}-{{GroupWindowID}}"><\/span><\/li><\/ul>                           <\/div><\/div>{{/each}}​<\/script>').html();kt=Handlebars.compile(bt)}function nr(){var t=new n.createUser;t.intialize();t.show()}function tr(){var t=new n.createrole;t.intialize();t.show()}function ir(){i[0].style.visibility="visible";lt==0&&t.ajax({url:n.Application.contextUrl+"Group/GetWindowIds",async:!1,success:function(n){var t=JSON.parse(n);t!=null&&t!=undefined&&(lt=t.GroupWindowID,ei=t.RoleWindowID,oi=t.UserWindowID)},error:function(){n.Msg.getMsg("VIS_GroupWindowNotFound")}});var r=new n.Query;r.addRestriction("AD_GroupInfo_ID",n.Query.prototype.EQUAL,0);n.viewManager.startWindow(lt,r);i[0].style.visibility="hidden"}function at(){ot=1;t.ajax({url:n.Application.contextUrl+"Group/GetUserInfo",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!0,data:{searchText:y.val(),sortBy:dt,pageNo:ot,pageSize:ri},success:function(n){var i=JSON.parse(n);r.find(".vis-group-user-wrap").remove();r.append(ht(i));r.off("click");r.on("click",or);t(r.children(".vis-group-user-wrap")).length>0&&t(r.children(".vis-group-user-wrap")[0]).trigger("click");ot++},error:function(){n.ADialog.error("VIS_ErrorLoadingContacts");i[0].style.visibility="hidden"}})}function rr(){t(this).scrollTop()+t(this).innerHeight()>=this.scrollHeight&&t.ajax({url:n.Application.contextUrl+"Group/GetUserInfo",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!0,data:{searchText:y.val(),sortBy:dt,pageNo:ot,pageSize:ri},success:function(n){ot++;var t=JSON.parse(n);r.append(ht(t));i[0].style.visibility="hidden"},error:function(){n.ADialog.error("VIS_ErrorLoadingContacts");i[0].style.visibility="hidden"}})}function ur(n){(n.keyCode==undefined||n.keyCode==13)&&y!=undefined&&y!=null&&at()}function fr(n){(n.keyCode==undefined||n.keyCode==13)&&w!=undefined&&w!=null&&ni()}function er(n){(n.keyCode==undefined||n.keyCode==13)&&p!=undefined&&p!=null&&gt()}function or(i){var u,f,e;if(!(a.length>0)){if(u=t(i.target),t(t(r.children(".vis-group-selected-op"))[0]).removeClass("vis-group-selected-op vis-group-selected-opbackground"),u.hasClass("vis-group-user-wrap"))u.addClass("vis-group-selected-op vis-group-selected-opbackground"),ct=u.data("uid");else if(t(u.parents(".vis-group-user-wrap")).length>0)t(u.parents(".vis-group-user-wrap")).addClass("vis-group-selected-op vis-group-selected-opbackground"),ct=t(u.parents().find(".vis-group-selected-op")).data("uid");else return;u.hasClass("vis-group-user-ico vis-group-pointer vis-group-edit")?(f=u.data("uid").split("-"),e=new n.Query,e.addRestriction("AD_User_ID",n.Query.prototype.EQUAL,f[0]),n.viewManager.startWindow(f[2],e)):u.hasClass("vis-group-user-ico vis-group-pointer vis-group-activeUser")&&u.attr("disabled")!="disabled"?fi(u,!1):u.hasClass("vis-group-user-ico vis-group-pointer vis-group-inactiveUser")&&u.attr("disabled")!="disabled"&&fi(u,!0);gt(u)}}function gt(){i[0].style.visibility="visible";var r=p.val();t.ajax({url:n.Application.contextUrl+"Group/GetRoleInfo",data:{AD_User_ID:ct,name:r},success:function(n){var f=JSON.parse(n),r;u.find(".vis-group-user-wrap").remove();u.append(wt(f));u.off("click");u.on("click",sr);for(t(u.children(".vis-group-user-wrap")).length>0&&t(t(u).children(".vis-group-user-wrap")[0]).trigger("click"),ft=[],r=0;r<f.length;r++)ft.push({AD_Role_ID:f[r].AD_Role_ID,IsAssignedToUser:f[r].IsAssignedToUser});t(u.find("input")).off("click");t(u.find("input")).on("click",lr);i[0].style.visibility="hidden"},error:function(){n.ADialog.error("VIS_ErrorLoadingRoles");i[0].style.visibility="hidden"}})}function ni(){i[0].style.visibility="visible";var r=w.val();t.ajax({url:n.Application.contextUrl+"Group/GetGroupInfo",data:{AD_Role_ID:o,name:r},success:function(n){var u=JSON.parse(n),r;f.find(".vis-group-user-wrap").remove();f.append(kt(u));f.off("click");f.on("click",hr);for(t(f.children(".vis-group-user-wrap")).length>0&&t(t(f).children(".vis-group-user-wrap")[0]).trigger("click"),et=[],i[0].style.visibility="hidden",r=0;r<u.length;r++)r==0&&(lt=u[r].GroupWindowID),et.push({AD_Group_ID:u[r].AD_Group_ID,IsAssignedToUser:u[r].IsAssignedToUser});t(f.find("input")).off("click");t(f.find("input")).on("click",ar)},error:function(){n.ADialog.error("VIS_ErrorLoadingGroups");i[0].style.visibility="hidden"}})}function sr(i){var r,f;if(si=!0,e.length>0){n.ADialog.ask("VIS_SaveGroup")?vt():e=[];return}r=t(i.target);t(t(u.children(".vis-group-selected-op"))[0]).removeClass("vis-group-selected-op vis-group-selected-opbackground");r.hasClass("vis-group-user-wrap")?(r.addClass("vis-group-selected-op vis-group-selected-opbackground"),o=r.data("uid")):o=t(r.parents(".vis-group-user-wrap")).addClass("vis-group-selected-op vis-group-selected-opbackground").data("uid");r.hasClass("vis-group-user-ico vis-group-pointer vis-group-edit")&&(o=r.data("uid"),o=o.split("-"),f=new n.Query,f.addRestriction("AD_Role_ID",n.Query.prototype.EQUAL,o[0]),n.viewManager.startWindow(o[1],f),o=o[0]);o!=undefined&&ni(r);i.originalEvent===undefined&&i.stopPropagation()}function hr(i){var r,u;hi=!0;r=t(i.target);t(t(f.children(".vis-group-selected-op"))[0]).removeClass("vis-group-selected-op");r.hasClass("vis-group-user-wrap")?(r.addClass("vis-group-selected-op"),s=r.data("uid")):(t(r.parents(".vis-group-user-wrap")).addClass("vis-group-selected-op"),s=t(r.parents().find(".vis-group-selected-op")).data("uid"));r.hasClass("vis-group-user-ico vis-group-edit vis-group-pointer")?(s=r.data("uid"),s=s.split("-"),u=new n.Query,u.addRestriction("AD_GroupInfo_ID",n.Query.prototype.EQUAL,s[0]),n.viewManager.startWindow(s[1],u)):r.hasClass("vis-group-user-ico vis-group-info vis-group-pointer")&&(s=r.data("uid"),s=s.split("-"),cr(s[0]));i.originalEvent===undefined&&i.stopPropagation()}function cr(t){var i=new n.groupInfo(t);i.intialize();i.show()}function lr(i){if(e.length>0){n.ADialog.ask("VIS_SaveGroup")?vt():e=[];return}var u=t(i.target),r=t.grep(ft,function(n){return n.AD_Role_ID==u.data("uid")});r!=null&&r.length>0&&(r[0].IsAssignedToUser=u.prop("checked"));r=t.grep(a,function(n){return n==u.data("uid")});r==null||r.length==0?a.push(u.data("uid")):a.splice(a.indexOf(u.data("uid")),1);i.stopPropagation()}function ar(i){if(a.length>0){n.ADialog.ask("VIS_SaveRole")?ti():a=[];return}var u=t(i.target),r=t.grep(et,function(n){return n.AD_Group_ID==u.data("uid")});r!=null&&r.length>0&&(r[0].IsAssignedToUser=u.prop("checked"));r=t.grep(e,function(n){return n==u.data("uid")});r==null||r.length==0?e.push(u.data("uid")):e.splice(e.indexOf(u.data("uid")),1);i.stopPropagation()}function ti(){a=[];t.ajax({url:n.Application.contextUrl+"Group/UpdateUserRoles",type:"Post",data:{AD_User_ID:ct,roles:JSON.stringify(ft)},success:function(){t(t(c.find("h7"))[0]).show();t(t(c.find("h7"))[0]).fadeOut(1600,"linear")},error:function(){n.ADialog.error(n.Msg.getMsg("VIS_ErrorSavingRole"))}})}function vt(){e=[];t.ajax({url:n.Application.contextUrl+"Group/UpdateUserGroups",type:"Post",data:{AD_Role_ID:o,AD_Group_ID:s,groups:JSON.stringify(et)},success:function(){t(t(l.find("h7"))[0]).show();t(t(l.find("h7"))[0]).fadeOut(1600,"linear")},error:function(){n.ADialog.error(n.Msg.getMsg("VIS_ErrorSavingGroups"))}})}function fi(r,u){i[0].style.visibility="visible";var f="";u?(r.removeClass("vis-group-user-ico vis-group-pointer vis-group-inactiveUser"),r.addClass("vis-group-user-ico vis-group-pointer vis-group-activeUser"),f=n.Application.contextUrl+"Group/ActiveUser"):(r.removeClass("vis-group-user-ico vis-group-pointer vis-group-activeUser"),r.addClass("vis-group-user-ico vis-group-pointer vis-group-inactiveUser"),f=n.Application.contextUrl+"Group/InActiveUser");t.ajax({url:f,data:{AD_User_ID:r.data("uid")},success:function(t){var r=JSON.parse(t);r<1&&n.ADialog.error("VIS_UserNotUpdated");i[0].style.visibility="hidden"},error:function(){n.ADialog.error("VIS_UserNotUpdated");i[0].style.visibility="hidden"}})}this.frame=null;this.windowNo=null;var ii=this,h=t('<div class="vis-group-assign-content">'),k=t('<ul class="vis-apanel-rb-ul"><\/ul>'),v=null,c=null,l=null,r=null,y=null,d=null,b=null,st=null,g=null,nt=null,u=null,i=null,p=null,tt=null,w=null,it=null,rt=null,ut=null,f=null,yt,ht,pt,wt,bt,kt,dt=-1,ct=0,ft=[],et=[],a=[],e=[],o=0,s=0,lt=0,ei=0,oi=0,ot=0,ri=20,si=!1,hi=!1;this.initializeComponent=function(){ci();ai();bi()};this.disposeComponent=function(){b!=null&&b!=undefined&&b.off("click");d.off("click");y.off("keydown");nt.off("click");ut.off("click");it.off("click");w.off("keydown");tt.off("click");p.off("keydown");rt.off("click");g.off("click");r.off("scroll");h.off("click");this.frame=null;this.windowNo=null;v.remove();v=null;c.remove();c=null;l.remove();l=null;r.remove();r=null;y.remove();y=null;d.remove();d=null;b.remove();b=null;st.remove();st=null;g.remove();g=null;nt.remove();nt=null;u.remove();u=null;i.remove();i=null;w.remove();w=null;it.remove();it=null;p.remove();p=null;tt.remove();tt=null;rt.remove();rt=null;ut.remove();ut=null;f.remove();f=null;yt.remove();ht.remove();pt.remove();wt.remove();bt.remove();kt.remove();ft=null;et=null;a=null;e=null;h.remove();h=null;k=null;ii=null};this.getRoot=function(){return h}}i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;t.setTitle("VIS_Group");this.frame.getContentGrid().append(this.getRoot());this.initializeComponent()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.GroupForm=i}(VIS,jQuery),function(n,t){function i(){function ft(){i=t("<div class='vis-apanel-busy' style='height:96%; width:98%;'><\/div>");i[0].style.visibility="hidden";r.append(i)}function et(){r=t("<div>");var i='  <div style="overflow:hidden" class="vis-group-assinRole-content"><div class="vis-group-assinRole-data"><label>'+n.Msg.getMsg("EMail")+'<\/label><input  tabindex="1" class="vis-group-email" type="text" name="Name"><\/div><div style="width:auto;float:right;margin-top:5px" class="vis-group-assinRole-data"> <a tabindex="2" class="vis-group-btn vis-group-pointer vis-group-create vis-group-grayBtn" style="float: left;">'+n.Msg.getMsg("Create")+'<\/a><a tabindex="3" class="vis-group-btn vis-group-pointer vis-group-invite vis-group-blueBtn" style="float: right;">'+n.Msg.getMsg("VIS_Invite")+"<\/a><\/div><\/div>";s=t('<div class="vis-group-assignContainer" style="visibility:hidden"><div class="vis-group-assinRole-data"><label>'+n.Msg.getMsg("Name")+'<\/label><input  tabindex="4" type="text" maxlength="60"  class="vis-group-name vis-group-mandatory"  name="Name"><\/div><div class="vis-group-assinRole-data"><label>'+n.Msg.getMsg("VIS_UserID")+'<\/label><input tabindex="5" type="text" maxlength="80"  class="vis-group-uid"  name="Name"><\/div><div class="vis-group-assinRole-data"><label>'+n.Msg.getMsg("Password")+'<\/label><input tabindex="6" type="password" maxlength="250"  class="vis-group-pwd"  name="Name"><\/div><div class="vis-group-assinRole-data"><label>'+n.Msg.getMsg("Mobile")+'<\/label><input tabindex="7" type="text"  maxlength="50" class="vis-group-mobile"  name="Name"><\/div><a tabindex="8" class="vis-group-btn vis-group-Save vis-group-pointer vis-group-grayBtn" style="float: right;">'+n.Msg.getMsg("Save")+"<\/a><\/div>");o=t('<div class="vis-group-roleContainer" ><div> <label >'+n.Msg.getMsg("SelectRole")+"<\/label> <\/div><\/div>");r.append(i);f=r.find(".vis-group-assinRole-content");f.height("100px");c=r.find(".vis-group-create");l=r.find(".vis-group-invite");a=s.find(".vis-group-Save");e=s.find(".vis-group-name");p=s.find(".vis-group-uid");b=s.find(".vis-group-mobile");w=s.find(".vis-group-pwd");v=r.find(".vis-group-email")}function ot(){e.on("change",lt);c.on("click",tt);c.on("keydown",st);l.on("click",it);l.on("keydown",ct);a.on("click",rt);a.on("keydown",ht)}function st(n){(n.keyCode==undefined||n.keyCode==13)&&tt()}function ht(n){(n.keyCode==undefined||n.keyCode==13)&&rt()}function ct(n){(n.keyCode==undefined||n.keyCode==13)&&it()}function lt(){e.val().length>0?e.removeClass("vis-group-mandatory"):e.addClass("vis-group-mandatory")}function at(){g=t(' <script type="text/x-handlebars-template">{{#each this}}<div class="vis-group-user-wrap vis-group-role-pad"  data-UID="{{AD_Role_ID}}"><div class="vis-group-user-profile"><input tabindex="7"  type="checkbox" data-UID="{{AD_Role_ID}}" ><label>{{Name}}<\/label><\/div><\/div>{{/each}}​<\/script>').html();nt=Handlebars.compile(g)}function vt(){i[0].style.visibility="visible";t.ajax({url:n.Application.contextUrl+"Group/GetRoleInfo",data:{AD_User_ID:0},success:function(r){var f=JSON.parse(r),e=t('<div style="height:230px;overflow:auto;margin-bottom:10px">'),u;e.append(nt(f));o.append(e);k=t('<a tabindex="400" class="vis-group-btn vis-group-pointer vis-group-finish vis-group-grayBtn" style="float: right;">'+n.Msg.getMsg("VIS_Finish")+"<\/a>");o.append(k);k.on("click",ut);k.on("keydown",yt);for(t(o.children(".vis-group-user-wrap")).length>0&&t(t(o).children(".vis-group-user-wrap")[0]).trigger("click"),u=0;u<f.length;u++)d.push({AD_Role_ID:f[u].AD_Role_ID,IsAssignedToUser:!1});t(o.find("input")).off("click");t(o.find("input")).on("click",pt);i[0].style.visibility="hidden"},error:function(){n.ADialog.error("VIS_ErrorLoadingRoles");i[0].style.visibility="hidden"}})}function yt(n){(n.keyCode==undefined||n.keyCode==13)&&ut()}function pt(n){var r=t(n.target),i=t.grep(d,function(n){return n.AD_Role_ID==r.data("uid")});i!=null&&i.length>0&&(i[0].IsAssignedToUser=r.prop("checked"));n.stopPropagation()}function tt(){f.find(".vis-group-roleContainer").css("display","none");f.find(".vis-group-assignContainer").css("display","inherit");f.append(s);r.find(".vis-group-assignContainer").css({visibility:"visible"});f.height("369px")}function it(){f.find(".vis-group-assignContainer").css("display","none");f.find(".vis-group-roleContainer").css("display","inherit");f.append(o);f.height("385px")}function rt(){var f,o;if(t(r.find(".vis-group-assignContainer")[0]).css("visibility")=="visible"){if(f=e.val(),f==null||f==undefined||f==""){n.ADialog.info("VIS_PleaseName");return}i[0].style.visibility="visible";(y==null||y==undefined)&&(y=null);o=n.secureEngine.encrypt(w.val());t.ajax({url:n.Application.contextUrl+"Group/SaveNewUser",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!0,data:{Name:f,Email:v.val(),Value:p.val(),password:o,mobile:b.val(),OrgID:JSON.stringify(y)},success:function(t){var r=JSON.parse(t);i[0].style.visibility="hidden";r==!1?n.ADialog.error("VIS_ErrorSavingUser"):u.close()},error:function(){i[0].style.visibility="hidden";n.ADialog.error("VIS_ErrorSavingUser")}})}}function ut(){var r=v.val(),h,s,e,f,o;if(r==null||r==undefined||r==""){n.ADialog.error("NotValidEmail");return}if(h=new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i),r.indexOf(";")==-1){if(f=h.test(r),!f){n.ADialog.error("NotValidEmail",!0,":"+r);return}}else for(s=r.split(";"),e=0;e<s.length;e++)if(f=h.test(s[e]),!f){n.ADialog.error("NotValidEmail",!0,":"+s[e]);return}if(o=t.grep(d,function(n){return n.IsAssignedToUser==!0}),o==null||o==undefined||o.length==0){n.ADialog.info("VIS_SelectRole");return}r!=null&&r!=undefined&&r!=""&&r.length>0&&(i[0].style.visibility="visible",t.ajax({url:n.Application.contextUrl+"Group/InviteUsers",type:"POST",datatype:"json",async:!0,data:{email:r,roles:JSON.stringify(o)},success:function(t){var r=JSON.parse(t);n.ADialog.info(r);i[0].style.visibility="hidden";u.close()},error:function(){n.ADialog.error("VIS_ErrorInvitingUsers");i[0].style.visibility="hidden"}}))}var r=null,f=null,c=null,l=null,a=null,v=null,e=null,p=null,w=null,b=null,u=null,h=this,y=null,i=null,g,nt=null,o=null,d=[],s=null,k=null;this.intialize=function(){et();ot();ft();at();vt()};this.setSelectedOrg=function(n){y=n};this.show=function(){u=new n.ChildDialog;u.setContent(r);u.setWidth(550);u.setTitle(n.Msg.getMsg("VIS_CreateUser"));u.setModal(!0);u.onClose=function(){h.onClose&&h.onClose();h.dispose()};u.show();u.hideButtons()};this.dispose=function(){this.prop=null;$div=null;u=null;h=null;r.remove();r=null;c.remove();c=null;l.remove();l=null;a.remove();a=null;v.remove();v=null;e.remove();e=null;p.remove();p=null;w.remove();w=null;b.remove();b=null;u=null;h=null}}n.createUser=i}(VIS,jQuery),function(n,t){function i(i){function h(){u=t("<div>");t.ajax({url:n.Application.contextUrl+"Group/GetOrgAccess",success:function(n){var i=JSON.parse(n);u.append(s(i));t(u.find("input")).on("click",a)},error:function(){n.ADialog.error("VIS_ErrorLoadingOrg")}})}function c(){o=t(' <script type="text/x-handlebars-template">{{#each this}}<div style="border-bottom:1px solid lightgray" class="vis-group-assinRole-check"><div style="width:100%" class="vis-group-user-profile"><input type="Checkbox" data-uid="{{OrgID}}"> <p style="margin-bottom:2px">{{OrgName}}<\/p><span style="margin-left:30px;float:left">{{Description}}<\/span><\/div><\/div>{{/each}}​<\/script>').html();s=Handlebars.compile(o)}function l(){r.onOkClick=function(){i(f);e.dispose()};r.onCancelClick=function(){e.dispose()}}function a(n){var i=t(n.target);i.prop("checked")?t.inArray(i.data("uid"))==-1&&f.push(i.data("uid")):f.splice(f.indexOf(i.data("uid")),1)}var u=null,o,s=null,r=null,f=[],e=this;this.intialize=function(){c();h()};this.show=function(){r=new n.ChildDialog;r.setContent(u);r.setWidth(450);r.setHeight(350);r.setTitle(n.Msg.getMsg("VIS_OrgAccess"));r.setModal(!0);r.onClose=function(){e.dispose()};r.show();l()};this.dispose=function(){this.prop=null;$div=null;u.remove();u=null;o=null;s=null;r=null;e=null;f=null}}n.orgAccess=i}(VIS,jQuery),function(n,t){function i(i){function f(){u=t("<div>");e()}function e(){t.ajax({url:n.Application.contextUrl+"Group/GetGroupChildInfo",data:{groupID:i},success:function(t){var i=JSON.parse(t),r='<div class="vis-group-gi-content"><label>'+i.GroupName+"<\/label>";i.Description!=null&&i.Description!=undefined&&i.Description!=""&&(r+="<p>"+i.Description+"<\/p>");i.WindowName!=null&&i.WindowName!=undefined&&i.WindowName!=""&&(r+='<div class="vis-group-gi-data"><label>'+n.Msg.getMsg("Windows")+":<\/label><p>"+i.WindowName+"<\/p>","<\/div>");i.FormName!=null&&i.FormName!=undefined&&i.FormName!=""&&(r+='<div class="vis-group-gi-data"><label>'+n.Msg.getMsg("VIS_Forms")+":<\/label><p>"+i.FormName+"<\/p>","<\/div>");i.ProcessName!=null&&i.ProcessName!=undefined&&i.ProcessName!=""&&(r+='<div class="vis-group-gi-data"><label>'+n.Msg.getMsg("VIS_Processes")+":<\/label><p>"+i.ProcessName+"<\/p>","<\/div>");i.WorkflowName!=null&&i.WorkflowName!=undefined&&i.WorkflowName!=""&&(r+='<div class="vis-group-gi-data"><label>'+n.Msg.getMsg("VIS_Workflows")+":<\/label><p>"+i.WorkflowName+"<\/p>","<\/div>");r+="<\/div>";u.append(r)},error:function(){n.ADialog.error("VIS_ErrorGettingGroupInfo")}})}var u=null,r=null;this.intialize=function(){f()};this.show=function(){r=new n.ChildDialog;r.setContent(u);r.setHeight(500);r.setWidth(550);r.setTitle(n.Msg.getMsg("VIS_Groupinfo"));r.setModal(!0);r.onClose=function(){self.onClose&&self.onClose();self.dispose()};r.show();r.hideButtons()};this.dispose=function(){self=null;u.remove();u=null;r=null}}n.groupInfo=i}(VIS,jQuery),function(n,t){function i(){function v(){var i='<div class="vis-group-assinRole-content"><div class="vis-group-assinRole-data"><label>'+n.Msg.getMsg("Role")+'<\/label><input tabindex="1" maxlength="60" class="vis-group-role-text vis-group-mandatory" type="text"><\/div><div class="vis-group-assinRole-data"><label>'+n.Msg.getMsg("VIS_UserLevel")+'<\/label><select  tabindex="2"  class="vis-group-role-select" ><\/select><\/div><div class="vis-group-assinRole-data"><a style="float:left"  tabindex="3"  class="vis-group-btn vis-group-orgAccess vis-group-pointer vis-group-grayBtn">'+n.Msg.getMsg("VIS_OrgAccess")+'<\/a><a  tabindex="4"  class="vis-group-btn vis-group-Save vis-group-pointer vis-group-grayBtn" style="float: right;">'+n.Msg.getMsg("Save")+"<\/a><\/div><\/div>";r.append(i);u=r.find(".vis-group-role-text");o=r.find(".vis-group-role-select");s=r.find(".vis-group-orgAccess");h=r.find(".vis-group-Save");y();f[0].style.visibility="visible";t.ajax({url:n.Application.contextUrl+"Group/GetUserLevel",success:function(n){var t=JSON.parse(n),i;if(t!=null&&t.length>0)for(i=0;i<t.length;i++)o.append('<option value="'+t[i].ID+'">'+t[i].Name+"<\/option>");f[0].style.visibility="hidden"}})}function y(){f=t("<div class='vis-apanel-busy' style='height:96%; width:98%;'><\/div>");f[0].style.visibility="hidden";r.append(f)}function p(){s.on("click",l);s.on("keydown",w);h.on("click",a);h.on("keydown",b);u.on("change",k)}function w(n){(n.keyCode==undefined||n.keyCode==13)&&l()}function b(n){(n.keyCode==undefined||n.keyCode==13)&&a()}function k(){u.val().length>0?u.removeClass("vis-group-mandatory"):u.addClass("vis-group-mandatory")}function l(){var t=new n.orgAccess(c.setSelectedOrg);window.setTimeout(function(){t.intialize();t.show()},20)}function a(){var s=u.val(),r=o.val();if(s==null||s==undefined||s==""){n.ADialog.info("VIS_PleaseName");return}if(e==undefined||e==null||e==""||e.length==0){n.ADialog.info("VIS_SelectOrgAccess");return}if(r==null||r==undefined||r==""||r==-1){n.ADialog.info("VIS_SelectUserLevel");return}f[0].style.visibility="visible";t.ajax({url:n.Application.contextUrl+"Group/AddNewRole",data:{name:s,userLevel:r,orgID:JSON.stringify(e)},success:function(t){var r=JSON.parse(t);r==!1?n.ADialog.error("VIS_ErrorSavingRole"):i.close();f[0].style.visibility="hidden"},error:function(){n.ADialog.error("VIS_ErrorSavingRole");f[0].style.visibility="hidden"}})}var r=t("<div>"),i=null,u=null,o=null,s=null,h=null,e=null,c=this,f=null;this.intialize=function(){v();p()};this.setSelectedOrg=function(n){e=n};this.show=function(){i=new n.ChildDialog;i.setContent(r);i.setWidth(550);i.setTitle(n.Msg.getMsg("VIS_CreateRole"));i.setModal(!0);i.onClose=function(){c.dispose();c=null};i.show();i.hideButtons()};this.dispose=function(){u.remove();u=null;o.remove();o=null;s.remove();s=null;h.remove();h=null;r.remove();r=null;i=null}}n.createrole=i}(VIS,jQuery),function(n,t){function i(){var b,k,d,g,p;this.onClose=null;var nt=this,r=null,u=null,e=null,v=null,o=null,s=null,h=null,i=null,c=[],w=null,y=null,tt=null,l=[],f=[],a=null,it=function(){r=t("<div>");u=t("<div class='vis-apanel-busy' style='width:96%;height:97%;text-align:center;position:absolute;'>");u[0].style.visibility="visible";r.append(u);e=t("<div>");v=t("<div style='height: 388px;width: 100%;background: aliceblue;overflow:auto;'>");e.append(v);h=t("<div>");e.append(h);var i=n.Msg.getMsg("Cancel"),f=n.Msg.getMsg("Ok");s=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(i);o=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(f);h.append(s);h.append(o);r.append(e);a=t("<table>")};it();b=function(){s.on("click",function(){p()});o.on("click",function(){d()})};b();k=function(){var k,e,r,b,o;for(i=[],k=null,e=n.DB.executeReader("SELECT AD_ModuleInfo_ID, Name FROM AD_Moduleinfo WHERE isActive='Y' ");e.read();)k={},k.AD_ModuleInfo_ID=e.getInt(0),k.Name=e.getString(1),i.push(k);if(e=null,c.length==1)for(e=n.DB.executeReader("select AD_moduleinfo_id  from ad_exportdata e  where e.record_id="+c[0]+" and e.ad_table_id="+y);e.read();)l.push(e.getInt(0));e=null;var h=null,p=null,s=null,w=null;if(l.length==0)for(r=0;r<i.length;r++)h=t("<tr>"),p=t("<td>"),s=t('<label class="vis-gc-vpanel-table-label-checkbox" style="display: inline-block; opacity: 1;">'),w=t("<input type='checkbox'>"),s.append(w),s.append(i[r].Name),p.append(s),h.append(p),a.append(h),o={},o.Ctrl=w,o.AD_ModuleInfo_ID=i[r].AD_ModuleInfo_ID,f.push(o);else for(r=0;r<l.length;r++)for(b=0;b<i.length;b++)h=t("<tr>"),p=t("<td>"),s=t('<label class="vis-gc-vpanel-table-label-checkbox" style="display: inline-block; opacity: 1;">'),w=l[r]==i[b].AD_ModuleInfo_ID?t("<input type='checkbox' checked>"):t("<input type='checkbox'>"),s.append(w),s.append(i[b].Name),p.append(s),h.append(p),a.append(h),o={},o.Ctrl=w,o.AD_ModuleInfo_ID=i[b].AD_ModuleInfo_ID,f.push(o);v.append(a);u[0].style.visibility="hidden"};d=function(){var i,t,e,o,r;for(u[0].style.visibility="visible",i=[],t=0;t<f.length;t++)e=f[t].Ctrl,e.prop("checked")&&i.push(f[t].AD_ModuleInfo_ID);o={moduleId:i,_recordID:c,_tableID:y,_strRecordID:w};r=n.dataContext.getJSONData(n.Application.contextUrl+"MarkModule/SaveExportData",o);r.result!="OK"&&alert(r.result);u[0].style.visibility="hidden";p()};this.show=function(){r.dialog({title:n.Msg.getMsg("VIS_MarkModule"),width:400,height:500,resizable:!1,modal:!0,close:g});k()};this.init=function(n,t,i){c=n.toString().split(",");w=n;y=t;tt=i};g=function(){p()};p=function(){nt.onClose&&nt.onClose();e=null;v=null;s.off("click");o.off("click");o=null;s=null;h=null;k=null;d=null;it=null;b=null;g=null;u=null;i=null;c=null;w=null;y=null;tt=null;l=null;f=null;a=null;r!=null&&(r.dialog("destroy"),r.remove());r=null}}n.MarkModule=i}(VIS,jQuery),function(n,t){function r(r){function uf(){di=t('<div style="width:100%;height:100%"><\/div>');ff();ef();su();ki=!0;hu();af(y)}function si(n){n&&pt!=null&&pt.css({display:"block"});n||pt==null||pt.css({display:"none"})}function sf(){rt!=null&&rt.children().find("input").prop("checked",!1)}function yr(n){var t,i;if(n==null||n.length==0)return null;for(t=0;t<h.getFields().length;t++)if(i=h.getFields()[t],n.equals(i.getColumnName()))return i;return null}function vu(t){var i=null,r;return(t&&(i=yt),i!=null)?i.getDisplayType()==n.DisplayType.YesNo?i.getValue().toString().toLowerCase()=="true"?"Y":"N":n.DisplayType.IsDate(i.getDisplayType())?(r=i.getValue(),r&&r.endsWith(".000Z")&&(r=r.replace(".000Z","Z")),r):i.getValue():""}function vf(t){var i=null;if(t&&(i=yt),i!=null){if(i.getDisplayType()==n.DisplayType.YesNo)return i.getValue().toString().toLowerCase()=="true"?"Y":"N";i.setValue("")}}function yu(n){var t=null;return(n&&(t=yt),t!=null)?t.getDisplay():""}function yf(n){var t=null;return(n&&(t=yt),t!=null)?t.getDisplayType(""):""}function pr(n){var t=null;n&&(t=yt);t!=null&&t.setValue(null)}function pu(n){var r=et.children()[1],i=null;et.children().length>2&&(i=et.children()[2]);i?t(i).prop("disabled",!n).prop("readonly",!n):r!=null&&t(r).prop("disabled",!n).prop("readonly",!n)}function pf(n,t){n.prop("disabled",!t)}function wr(i,r){var f,o,u,e;i&&(yt=null);rf=null;f=null;o=null;i&&(f=et.children()[0],et.children().length>1&&(o=et.children()[1]));f!=null&&(t(f).remove(),o!=null&&t(o).remove(),f=null);u=null;u=r!=null?r.getIsKey()?new n.Controls.VNumTextBox(r.getColumnName(),!1,!1,!0,r.getDisplayLength(),r.getFieldLength(),r.getColumnName()):n.VControlFactory.getControl(null,r,!0,!0,!1):new n.Controls.VTextBox("columnName",!1,!0,!1,20,20,"format","GetObscureType",!1);u!=null&&(u.setReadOnly(!1),n.DisplayType.Text==r.getDisplayType()||n.DisplayType.TextLong==r.getDisplayType()?(u.getControl().attr("rows","1"),u.getControl().css("width","100%")):n.DisplayType.YesNo==r.getDisplayType()?u.getControl().css("clear","both"):n.DisplayType.IsDate(r.getDisplayType())&&u.getControl().css("line-height","1"),e=null,u.getBtnCount()>0&&!(u instanceof n.Controls.VComboBox)&&(e=u.getBtn(0)),i&&(et.append(u.getControl().css("width","95%")),yt=u,e&&(et.append(e),u.getControl().css("width","60%"),e.css("max-width","35px"))))}function wf(n){var e={},o,r;nt={};var u="",s="",t=null,i=null,h=null,c=null,l=null,a=null,v=null,y=null;for(o=0;o<n.length;o++){for(nt={},nt.Color=n[o].Color,nt.Condition=[],u=n[o].ConditionValue.split("&"),s=n[o].ConditionText.split("&"),r=0;r<u.length;r++)e={},u[r].contains("!")?(t=u[r].trim().split("!"),i=s[r].trim().split("!"),v="!",y="!=",h=i[0].trim().substring(1,i[0].lastIndexOf("@")),c=t[0].trim().substring(1,t[0].lastIndexOf("@")),a=i[1],l=t[1]):u[r].contains("=")?(t=u[r].split("="),i=s[r].split("="),v="=",y="=",h=i[0].trim().substring(1,i[0].lastIndexOf("@")),c=t[0].trim().substring(1,t[0].lastIndexOf("@")),a=i[1],l=t[1]):u[r].contains("<")?(t=u[r].split("<"),i=s[r].split("<"),v="<",y="<",h=i[0].trim().substring(1,i[0].lastIndexOf("@")),c=t[0].trim().substring(1,t[0].lastIndexOf("@")),a=i[1],l=t[1]):u[r].contains(">")&&(t=u[r].split(">"),i=s[r].split(">"),v=">",y=">",h=i[0].trim().substring(1,i[0].lastIndexOf("@")),c=t[0].trim().substring(1,t[0].lastIndexOf("@")),a=i[1],l=t[1]),e.ColHeader=h,e.ColName=c,e.Operator=v,e.OperatorText=y,e.QueryValue=l,e.QueryText=a,nt.Condition.push(e);f.push(nt)}ki||ni(f)}var wt=r.curGC,h=wt.getMTab(),d=wt.vCardView,br=h.getAD_Window_ID(),kr=h.getAD_Tab_ID(),wu=h.getName(),bu=r.curGC.aPanel.$parentWindow.getName(),e=d.getAD_CardView_ID(),tt=d.getField_Group_ID(),st=0,hi=0,gi=null,nr=null,tr=null,ir=null,bt=null,l=null,ku=[],s=h.getFields(),rr=[],ur=null,ci=null,dr=0,a=-1,li=0,ti=0,ti=0,du=0,ii=[],p=[],gr=[],gu=0,ri="",nf=0,v=0,w=!1,tf=null,ft=null,kt=null,ai=null,vi=null,fr=null,nu=null,tu=null,er=null,or=null,ui=null,yi=null,u=null,o=null,pi=null,sr=null,hr=null,it=null,c=0,g=null,ri="",ht=0,cr=0,iu=[],ru=0,bf=n.context.getAD_User_Name(),wi=null,bi=null,lt=null,at=null,rt=null,ut=[],vt=null,ct="",fi=!1,uu=n.Msg.getMsg("IsDefault"),y=null,yt=null,rf=null,et=null,b=null,fu=h.getFields().slice(),lr=this,ot=null,f=[],nt=null,dt=null,ei=[],oi=null,ki=!1,eu=[],pt=null,di,k,ff=function(){for(var n=0;n<h.getFields().length;n++)rr.push(h.getFields()[n]);for(n=0;n<d.fields.length;n++)iu.push(d.fields[n].getAD_Field_ID())},ef=function(){var i;pt=t("<div class='vis-apanel-busy vis-cardviewmainbusy'><\/div> ");u=t("<div class='vis-cardviewmain'><\/div>");var r=t("<div class='vis-cardviewmainfirstchild vis-pull-left'><\/div>"),e=t("<div class='vis-cardviewmainsecondchild'><\/div>"),f=t("<div class='vis-cardviewCondition'><div class='vis-cardviewConditionControls'> <\/div>  <div class='vis-cardviewConditionGrid'> <\/div> <\/div>"),h=t("<div class='vis-cardviewbtn'><button class='vis-btnDelete'> <\/button> <div class='vis-cdv-customokcancle'><button class='vis-btnOk'>  "+n.Msg.getMsg("Ok")+"  <\/button><button class='vis-btnCardViewCancle'>  "+n.Msg.getMsg("Cancel")+"  <\/button><\/div> <\/div>");u.append(r);r.append("<div class='vis-firstdiv vis-pull-left' ><\/div>");r.append("<div class='vis-seconddiv vis-pull-right'><\/div>");r.append("<div class='vis-thirddiv vis-pull-left' ><\/div>");u.find(".vis-firstdiv").append("<div class='vis-first-divHeader'><label class='vis-ddlcardview'>"+n.Msg.getMsg("SelectCardView")+" <\/label><label style='display:none' class='vis-lbcardviewname'>"+n.Msg.getMsg("CardViewName")+" <\/label><\/div>  ");var s=t("<div class='vis-CardView vis-pull-left'> <div  class='vis-cardviewchild vis-pull-left'><\/div>  <\/div>"),c=t("<input style='width:100%;display:none' class='vis-txtcardviewname' type='text'>"),a=t("<div class='vis-User vis-pull-left'><\/div>"),v=t("<div class='vis-pull-left'><button  class='vis-btnnew vis-cvd-btn'>  <\/button><button style='display:none' class='vis-btncancle vis-cvd-canclebtn'>  <\/button> <button class='vis-btnedit vis-cvd-editbtn'>  <\/button><\/div>");s.find(".vis-cardviewchild").append("<select class='vis-cmbcardview'> <\/select>");a.append("<Select type='text' class='vis-cmbuser'> <\/Select>");n.MRole.isAdministrator?(u.append(e),u.find(".vis-firstdiv").append(" <div style='display:none' class='vis-first-divHeader vis-pull-right'><label >"+n.Msg.getMsg("SelectUser")+"<\/label><\/div>"),u.find(".vis-CardView").append(""),u.find(".vis-firstdiv").append(s),u.find(".vis-cardviewchild").append(c),u.find(".vis-cardviewchild").css({width:"67%"}),u.find(".vis-CardView").append(v),pi=u.find(".vis-cmbuser"),ou(f.find(".vis-cardviewConditionControls")),u.append(f),u.append(h),u.find(".vis-btnDelete").css("display","block")):(u.find(".vis-firstdiv").append(s),u.find(".vis-cardviewchild").append(c),u.find(".vis-cardviewchild").css({width:"92%"}),r.css({width:"100%",float:"left"}),u.find(".k ").css("display","none"),ou(f.find(".vis-cardviewConditionControls")),u.append(f),u.append(h),u.find(".vis-btnDelete").css("display","none"));lf(u.find(".vis-cardviewConditionGrid"));e.append("<label class='vis-pull-left'> "+n.Msg.getMsg("SelectRole")+"<\/label>");e.append("<div style='border: 1px solid #ccc;height: 275px;margin-top: 25px;overflow:auto'><ul class='vis-ulrole'> <\/ul><\/div>");rt=u.find(".vis-ulrole");bi=u.find(".vis-ddlcardview");o=u.find(".vis-cmbcardview");wi=u.find(".vis-lbcardviewname");g=u.find(".vis-txtcardviewname");lt=u.find(".vis-btnnew");at=u.find(".vis-btncancle");btnEdit=u.find(".vis-btnedit");i=t("<div class='vis-divtextcontrol' ><\/div>");i.append("<div style='display:none' class='vis-second-divHeader vis-pull-left' ><div style='width:100%'> <label>"+n.Msg.getMsg("Window")+"<\/label><\/div><div style='width:100%'><input type='text'  class='vis-txtwindowname' style='width:100%' > <\/input><\/div><\/div>");i.append("<div style='display:none' class='vis-second-divHeader vis-pull-left' ><div style='width:100%'><label>"+n.Msg.getMsg("Tab")+"<\/label><\/div><div style='width:100%'><input type='text'  class='vis-txttabname' style='width:100%' > <\/input><\/div><\/div>");i.append("<div class='vis-second-divHeader vis-pull-left' ><div style='width:100%'><label>"+n.Msg.getMsg("GroupByField")+"<\/label><\/div><div style='width:92%'><select   class='vis-cmbgroupfield' style='width:100%;height:31px'> <\/select><\/div><\/div>");u.find(".vis-seconddiv").append(i);sr=i.find(".vis-txtwindowname");hr=i.find(".vis-txttabname");it=i.find(".vis-cmbgroupfield");kt=n.MRole.isAdministrator?t("<div class='vis-third-header vis-pull-left'><\/div>"):t("<div style='width:101%' class='vis-third-header vis-pull-left'><\/div>");ai=t("<div class='vis-left-fields vis-pull-left'><\/div>");vi=t("<div class='vis-left-fields vis-pull-left' ><\/div>");fr=t("<div class='vis-cardviewbutton vis-pull-left' ><button class='vis-btnup'  style='margin-top:10px'><img src='"+n.Application.contextUrl+"Areas/VIS/Images/up-cardview.png'><\/button><button  class='vis-btnright'  style='margin-top:10px'><img  src='"+n.Application.contextUrl+"Areas/VIS/Images/"+(n.Application.isRTL?"left":"right")+"-shift.png' ><\/button><\/div>");fr.append("<button   class='vis-btnleft' style='margin-top:10px'><img src='"+n.Application.contextUrl+"Areas/VIS/Images/"+(n.Application.isRTL?"right":"left")+"-shift.png' ><\/button><button  class='vis-btndown' style='margin-top:10px'><img src='"+n.Application.contextUrl+"Areas/VIS/Images/down arrow.png' ><\/button>");nu=t("<div style='width:100%'><label>"+n.Msg.getMsg("SelectField")+"<\/label><\/div>");tu=t("<div style='width:100%'><label>"+n.Msg.getMsg("IncludedField")+"<\/label><\/div>");er=t("<div style='width:99%;border: 1px solid #ccc;height:89%;overflow:auto'><\/div>");or=t("<div style='width:100%;border: 1px solid #ccc;height:89%;overflow:auto'><\/div>");ui=t("<ul  class='vis-windowfield'><\/ul>");yi=t("<ul  class='vis-cardviewcolumnfield'><\/ul>");er.append(ui);or.append(yi);ai.append(nu);ai.append(er);vi.append(tu);vi.append(or);kt.append(ai);kt.append(fr);kt.append(vi);u.find(".vis-thirddiv").append(kt);di.append(u);u.before(pt);bt=u.find(".vis-windowfield");l=u.find(".vis-cardviewcolumnfield");gi=u.find(".vis-btnright");nr=u.find(".vis-btnleft");tr=u.find(".vis-btnup");ir=u.find(".vis-btndown");btnOk=u.find(".vis-btnOk");btnCardViewCancle=u.find(".vis-btnCardViewCancle");btnDelete=u.find(".vis-btnDelete");y=u.find(".vis-cmbcolumn");et=u.find(".vis-cvd-valcontainer");b=u.find(".vis-cmboperator");btnSave=u.find(".vis-btnsave");ot=u.find(".vis-cv-rowtable");dt=u.find(".vis-cmbcolor");pt.css({display:"none"});of()},ou=function(i){var r=t("<div class='vis-divcvc-cmbcolor'><div style='width:100%'><lable>"+n.Msg.getMsg("BGColor")+"<\/lable><\/div> <div style='width:100%'> <input class='vis-cmbcolor' type='color' /><\/div><\/div>"),u=t("<div class='vis-divcvc-cmbcolumn'><div style='width:100%'><lable>"+n.Msg.getMsg("Column")+"<\/lable><\/div> <div><select class='vis-cmbcolumn'><\/select><\/div><\/div>"),f=t("<div class='vis-divcvc-cmboperator'><div style='width:100%'><lable>"+n.Msg.getMsg("Operator")+"<\/lable><\/div>  <div><select class='vis-cmboperator'><\/select> <\/div><\/div>"),e=t("<div class='vis-divcvc-queryvalue'><div style='width:100%'><lable>"+n.Msg.getMsg("QueryValue")+"<\/lable><\/div> <div class='vis-cvd-valcontainer' style='width:100%'><\/div><\/div>"),o=t("<div class='vis-divcvc-btnsave'><button class='vis-btnsave'><\/button><\/div>");i.append(r);i.append(u);i.append(f);i.append(e);i.append(o)},su=function(i){o.children().remove();var r=n.Application.contextUrl+"CardView/GetCardView";if(t.ajax({type:"GET",async:!1,url:r,dataType:"json",contentType:"application/json; charset=utf-8",data:{ad_Window_ID:br,ad_Tab_ID:kr},success:function(t){if(ft=JSON.parse(t),st=ft[0].lstCardViewData,hi=ft[0].lstRoleData,vt=ft[0].lstCardViewRoleData,oi=ft[0].lstCardViewConditonData,st!=null&&st.length>0)for(var r=0;r<st.length;r++)o.append("<Option ad_user_id="+st[r].UserID+" cardviewid="+st[r].CardViewID+" ad_field_id="+st[r].AD_GroupField_ID+"> "+w2utils.encodeTags(st[r].CardViewName)+"<\/Option>");else lt.trigger("click"),at.prop("disabled",!0),btnEdit.trigger("click"),btnDelete.prop("disabled",!0);o.find("[cardviewid='"+e+"']").attr("selected","selected");ht=e;try{i?(ht=o.find(":selected").attr("cardviewid"),tt=o.find(":selected").attr("ad_field_id"),c=parseInt(o.find(":selected").attr("ad_user_id")),e=ht):(c=parseInt(o.find(":selected").attr("ad_user_id")),v=c,cr=c)}catch(u){}n.MRole.isAdministrator&&vr(rt);v>0&&rt.attr("disabled","disabled")},error:function(n){alert(n.statusText)}}),o!=null)o.on("change",function(){ki=!1;hu()})},hu=function(){var n=o.find(":selected");n.length>0&&(e=parseInt(n.attr("cardviewid")),c=parseInt(n.attr("ad_user_id")));au();cu();e>0?gt(!0,!1):gt(!1,!1);ar();vr(rt)},cu=function(){sr.val(bu);hr.val(wu);sr.prop("disabled","disabled");hr.prop("disabled","disabled")},ar=function(){var u,f,i,r,e;if(it!=null&&it.children().remove(),u=null,f=null,h!=null&&h.getFields().length>0)for(it.append("<Option FieldID=-1><\/Option>"),s=h.getFields(),i=0;i<s.length;i++)(r=s[i].getColumnName().toLower(),r!="created"&&r!="createdby"&&r!="updated"&&r!="updatedby")&&(n.DisplayType.IsLookup(s[i].getDisplayType())&&s[i].getLookup()&&s[i].getLookup().getIsValidated()||s[i].getDisplayType()==n.DisplayType.YesNo)&&it.append("<Option FieldID="+s[i].getAD_Field_ID()+"> "+s[i].getHeader()+"<\/Option>");if(tt!=null&&tt>0&&(e=jQuery.grep(s,function(n){return n.getAD_Field_ID()==tt}),it.find("[FieldID='"+tt+"']").attr("selected","selected"),ru=it.find(":selected").attr("fieldid")),it!=null)it.on("change",function(){tt=parseInt(t(this).find(":selected").attr("fieldid"))})},gt=function(t,i){var r,u,f;if(ui!=null&&ui.children().remove(),tf=null,gt,ft=null,s=h.getFields(),hf(yi,t),h!=null&&h.getFields().length>0)for(r=0;r<s.length;r++)(u=s[r].getColumnName().toLower(),u!="created"&&u!="createdby"&&u!="updated"&&u!="updatedby")&&(n.DisplayType.IsLOB(s[r].getDisplayType())||d.hasIncludedCols&&!i&&(f=jQuery.grep(ii,function(n){return n==s[r].getAD_Field_ID()}),f.length>0)||ui.append("<li index="+r+" FieldID="+s[r].getAD_Field_ID()+"> "+s[r].getHeader()+"<\/li>"))},of=function(){if(lt!=null)lt.on("click",function(n){n.stopPropagation();fi=!1;wi.css({display:"block"});g.css({display:"block"});bi.css({display:"none"});o.css({display:"none"});lt.css({display:"none"});at.css({display:"block"});btnEdit.css({display:"none"});u.find(".vis-cardviewchild").css({width:"81%"});w=!0;ut=[];sf();it.find("[FieldID='-1']").attr("selected","selected");gt(!1,!0);yi.children().remove();rt.find("input[type=checkbox]").attr("disabled",!1);eu=f;f=[];ni(f)});if(at!=null)at.on("click",function(n){n.stopPropagation();fi=!1;bi.css({display:"block"});o.css({display:"block"});wi.css({display:"none"});g.css({display:"none"});lt.css({display:"block"});at.css({display:"none"});g.val("");btnEdit.css({display:"block"});u.find(".vis-cardviewchild").css({width:"67%"});w=!1;gt(!0,!1);ar();vr(rt);ni(eu)});if(btnEdit!=null)btnEdit.on("click",function(n){n.stopPropagation();fi=!0;wi.css({display:"block"});g.css({display:"block"});bi.css({display:"none"});o.css({display:"none"});lt.css({display:"none"});at.css({display:"block"});btnEdit.css({display:"none"});u.find(".vis-cardviewchild").css({width:"81%"});g.val(o.find(":selected").text().trim())});if(pi!=null)pi.on("change",function(){});if(bt!=null)bt.on("click","li",function(){ur!=null&&ur.css("background-color","white");t(this).css("background-color","#1aa0ed");ur=t(this);dr=t(this).index();li=t(this).attr("FieldID");ri=t(this).text()});if(l!=null)l.on("click","li",function(){ci!=null&&ci.css("background-color","white");t(this).css("background-color","#1aa0ed");ci=t(this);a=t(this).index();ti=t(this).attr("FieldID");du=t(this).attr("cardviewcolumnid");ri=t(this).text();gu=t(this).attr("seqno")});if(gi!=null)gi.on("click",function(n){parseInt(li)<=0||(l.append("<li seqno=0 index="+nf+"  FieldID="+li+"> "+ri+"<\/li>"),li=0,bt.children().eq(dr).remove(),n.stopPropagation(),n.preventDefault())});if(nr!=null)nr.on("click",function(n){if(!(parseInt(ti)<=0)){l.children().eq(a).remove();var t=bt.children().length+1;bt.append("<li seqno=0 index="+t+"  FieldID="+ti+"> "+ri+"<\/li>");ti=0;a=-1;n.stopPropagation();n.preventDefault()}});if(tr!=null)tr.on("click",function(n){if(parseInt(a)!=0&&parseInt(a)!=-1){var t=parseInt(a)-1,i=l.children().eq(a),r=l.children().eq(t);l.children().eq(a).remove();l.children().eq(t).before(i);a=t;n.stopPropagation();n.preventDefault()}});if(ir!=null)ir.on("click",function(n){var i=l.children().length-1;if(i!=a&&parseInt(a)!=-1){var t=parseInt(a)+1,r=l.children().eq(a),u=l.children().eq(t);l.children().eq(a).remove();u.after(r);a=t;n.stopPropagation();n.preventDefault()}});if(rt!=null)rt.on("click","li",function(){var i=t(this).attr("ad_role_id"),n;if(t(this).find("input").is(":checked"))t(this).find("input").prop("checked",!0),ut.push({AD_Role_ID:parseInt(i)});else for(t(this).find("input").prop("checked",!1),n=0;n<ut.length;n++)ut[n].AD_Role_ID==i&&ut.splice(n,1)});if(btnOk!=null)btnOk.on("click",function(t){si(!0);window.setTimeout(function(){var u="",o="",s,r;for(ei=[],s="",i=0;i<f.length;i++){for(u="",o="",j=0;j<f[i].Condition.length;j++)j==0?(u+="@"+f[i].Condition[j].ColName+"@"+f[i].Condition[j].Operator+f[i].Condition[j].QueryValue,o+="@"+f[i].Condition[j].ColHeader+"@"+f[i].Condition[j].Operator+f[i].Condition[j].QueryText):(u+=" & @"+f[i].Condition[j].ColName+"@"+f[i].Condition[j].Operator+f[i].Condition[j].QueryValue,o+=" & @"+f[i].Condition[j].ColHeader+"@"+f[i].Condition[j].Operator+f[i].Condition[j].QueryText);ei.push({Color:f[i].Color.toString(),ConditionValue:u,ConditionText:o})}if(w){if(g.val()=="")return n.ADialog.error("FillMandatory",!0,"Name"),si(!1),!1}else if(!w&&e<1&&n.MRole.isAdministrator)return n.ADialog.error("ClickNew",!0,""),si(!1),!1;if(r={},r.FieldGroupID=tt,r.IncludedCols=lu(p),!r.IncludedCols)return!1;r.Conditions=ei;r.AD_CardView_ID=e;w&&parseInt(v)<0&&(r.FieldGroupID=ru,r.IncludedCols=iu,r.Conditions=ei,r.AD_CardView_ID=ht);d.setCardViewData(r);wt.isCardRow&&d.refreshUI(wt.getVCardPanel().width());k.close();t.stopPropagation();t.preventDefault()},50)});if(btnCardViewCancle!=null)btnCardViewCancle.on("click",function(){k.close()});if(btnDelete!=null)btnDelete.on("click",function(t){var i=confirm(n.Msg.getMsg("SureWantToDelete"));i&&(ki=!1,cf(),su(!0),cu(),ar(),gt(!0,!1),c==n.context.getAD_User_ID()&&(v=0,c=0));t.stopPropagation();t.preventDefault()});if(y!=null)y.on("change",function(t){var i,r,f,e,u;t.stopPropagation();i=y.val();pr(!0);i&&i!="-1"&&(r=null,f=null,r=i.endsWith("_ID")||i.endsWith("_Acct")||i.endsWith("_ID_1")||i.endsWith("_ID_2")||i.endsWith("_ID_3")?lr.getOperatorsQuery(n.Query.prototype.CVOPERATORS_ID):i.startsWith("Is")?lr.getOperatorsQuery(n.Query.prototype.OPERATORS_YN):lr.getOperatorsQuery(n.Query.prototype.CVOPERATORS),e=h.getField(i),b.html(r),b[0].SelectedIndex=0,u=yr(i),wr(!0,u),b.prop("disabled",!1));pu(!0)});if(b!=null)b.on("change",function(){var t=b.val(),i,r;t||(t="");i="";r="";t&&t!="0"?n.Query.prototype.BETWEEN.equals(t)&&(i=y.val(),r=yr(i),wr(!1,r)):(pf(btnSave,!1),pr(!0))});if(btnSave!=null)btnSave.on("click",function(){var n,i,r;y.find(":selected").val()!=-1&&(n={},nt={},i="",i=Modernizr.inputtypes.color?dt.val():dt.spectrum("get"),r=t.map(f,function(n,t){if(n.Color==i)return t}),r.length<=0?(nt.Color=i.toString(),nt.Condition=[],n.ColHeader=y.find(":selected").text(),n.ColName=y.find(":selected").val(),n.Operator=b.val(),n.OperatorText=b.find(":selected").text(),n.QueryValue=vu(!0),n.QueryText=yu(!0),nt.Condition.push(n),f.push(nt)):(n.ColHeader=y.find(":selected").text(),n.ColName=y.find(":selected").val(),n.Operator=b.val(),n.OperatorText=b.find(":selected").text(),n.QueryValue=vu(!0),n.QueryText=yu(!0),f[r[0]].Condition.push(n)),ni(f),y.find("[value='-1']").attr("selected","selected"),b[0].SelectedIndex=-1,vf(!0),yf(!0))});if(ot!=null)ot.on("click","tr td img",function(){var r=t(this).parent().parent().index(),u=t(this).parent().parent().children().eq(0).attr("value"),e=t(this).parent().parent().children().eq(1).attr("value"),n;for(ot.find("tr").eq(r).remove(),n=t.map(f,function(n,t){if(n.Color==u)return t}),i=0;i<f[n].Condition.length;i++)if(e==f[n].Condition[i].ColName&&f[n].Condition.splice(i,1),f[n].Condition.length<=0){f.splice(n,1);break}});if(ot!=null)ot.on("click","tr td",function(){var n=t(this).attr("value");typeof n!="undefined"&&n.startsWith("#")&&(Modernizr.inputtypes.color?dt.val(n):dt.spectrum("set",n))})},kf=function(n,t){n!=null&&n.children().remove();for(var i=0;i<p.length;i++)n.append("<li seqno="+p[i].SeqNo+" index="+i+" FieldID="+p[i].AD_Field_ID+"> "+p[i].FieldName+"<\/li>");t>0&&(ci=n.find("[fieldid='"+t+"']"),n.find("[fieldid='"+t+"']").css("background-color","#1aa0ed"))},df=function(n,t){var i,r;for(n!=null&&n.children().remove(),i=0;i<t.length;i++)(r=jQuery.grep(p,function(n){return n.AD_Field_ID==t[i].getAD_Field_ID()}),r.length>0)||n.append("<li index="+i+" FieldID="+t[i].getAD_Field_ID()+"> "+t[i].getHeader()+"<\/li>")},hf=function(i,r){var h,s,u,o;if(i!=null&&i.children().remove(),p=[],ku=[],ii=[],r&&(e>0||typeof e=="undefined"))typeof e=="undefined"&&(e=0),h=n.Application.contextUrl+"CardView/GetCardViewColumns",t.ajax({type:"GET",async:!1,url:h,dataType:"json",contentType:"application/json; charset=utf-8",data:{ad_CardView_ID:e},success:function(n){var t,r,u;if(ft=JSON.parse(n),t=ft[0].lstCardViewData,oi=ft[0].lstCardViewConditonData,t!=null&&t.length>0)for(tt=t[0].AD_GroupField_ID,c=t[0].UserID,r=0;r<t.length;r++)t[r].AD_Field_ID!=0&&(u=jQuery.grep(rr,function(n){return n.getAD_Field_ID()==t[r].AD_Field_ID}),u.length>0&&ii.push(u[0].getAD_Field_ID()),i.append("<li seqno=0 index="+r+" CardViewColumnID=0 FieldID="+t[r].AD_Field_ID+"> "+t[r].FieldName+"<\/li>"));oi!=null&&oi.length>0?(f=[],wf(oi)):(f=[],ni(f))},error:function(n){alert(n.statusText)}});else if(d.hasIncludedCols&&(s=null,ii=[],u=d.fields,u!=null&&u.length>0))for(o=0;o<u.length;o++)s=jQuery.grep(rr,function(n){return n.getAD_Field_ID()==u[o].getAD_Field_ID()}),s.length>0&&ii.push(s[0].getAD_Field_ID()),p.push({AD_Field_ID:u[o].getAD_Field_ID(),CardViewID:e,SeqNo:0,FieldName:u[o].getHeader()}),i.append("<li seqno=0 index="+o+" CardViewColumnID=0 FieldID="+u[o].getAD_Field_ID()+"> "+u[o].getHeader()+"<\/li>")},lu=function(){var f,u,r,i,s;if(n.MRole.isAdministrator)if(w)if(ct=g.val(),ut==null||ut.length<=0)if(v!=n.context.getAD_User_ID()){if(!confirm(n.Msg.getMsg("CardViewWarning")))return v=0,!1;v=n.context.getAD_User_ID()}else v=0;else v=0;else ct=g.val(),v==c||(v=0);else(!c||c<1)&&(w=!0,v=n.context.getAD_User_ID()),w&&(ht>0&&cr>0?(w=!1,e=ht,c=cr,ct=o.find(":selected").text()+" ("+uu+")"):ct=o.find(":selected").text()+" "+uu);for(ct.length<1&&!fi?ct=o.find(":selected").text():fi&&(ct=g.val()),f=l.children().length,p=[],u=[],r=0;r<f;r++)i={},i.AD_Field_ID=l.children().eq(r).attr("fieldid"),i.CardViewID=e,p.push(i),u.push(parseInt(i.AD_Field_ID));return gr.push({AD_Window_ID:br,AD_Tab_ID:kr,UserID:v,AD_GroupField_ID:tt,isNewRecord:w,CardViewName:ct,CardViewID:e}),s=n.Application.contextUrl+"CardView/SaveCardViewColumns",t.ajax({type:"POST",async:!1,url:s,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({lstCardView:gr,lstCardViewColumns:p,LstRoleID:ut,lstCardViewCondition:ei}),success:function(n){var t=JSON.parse(n);e=t;si(!1)},error:function(n){alert(n.statusText);si(!1)}}),u},cf=function(){var i=n.Application.contextUrl+"CardView/DeleteCardViewRecord";t.ajax({type:"POST",async:!1,url:i,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({ad_CardView_ID:e}),success:function(n){var t=JSON.parse(n)},error:function(n){alert(n.statusText)}})},gf=function(n){n!=null&&n.children().remove();n.append("<Option ad_user_id=-1 ><\/Option>");for(var t=0;t<userInfo.length;t++)n.append("<Option ad_user_id="+userInfo[t].AD_User_ID+" > "+userInfo[t].UserName+"<\/Option>");c>0&&pi.find("[ad_user_id='"+c+"']").attr("selected","selected")},vr=function(n){var r,t,i;for(ut=[],r="",c>0&&(r="disabled"),n!=null&&n.children().remove(),t=0;t<hi.length;t++)n.append("<li ad_role_id="+hi[t].AD_Role_ID+" > <input type='checkbox' "+r+"> "+w2utils.encodeTags(hi[t].RoleName)+"<\/li>");for(t=0;t<vt.length;t++)if(vt[t]!=null)for(i=0;i<vt[t].length;i++)vt[t][i].AD_CardView_ID==e&&(n.find("[ad_role_id='"+vt[t][i].AD_Role_ID+"']").find("input").prop("checked",!0),ut.push({AD_Role_ID:vt[t][i].AD_Role_ID}))},au=function(){c>0?k!=null&&k.changeTitle(n.Msg.getMsg("Card")+"("+n.Msg.getMsg("IsPrivate")+")"):k!=null&&k.changeTitle(n.Msg.getMsg("Card"))},lf=function(i){var r=t("<Table class='vis-cv-headertable'><tr class='vis-cv-TableHead'><th >"+n.Msg.getMsg("BGColor")+"<\/th><th>"+n.Msg.getMsg("Column")+"<\/th><th>"+n.Msg.getMsg("Operator")+"<\/th><th>"+n.Msg.getMsg("QueryValue")+"<\/th><th>"+n.Msg.getMsg("Action")+"<\/th><tr><\/Table>"),u=t("<div class='vis-cv-divrowtable'><Table class='vis-cv-rowtable'><\/Table><\/div>");i.append(r);i.append(u)},ni=function(i){var r,f;if(ot!=null&&ot.children().remove(),i!=null){var e=null,o=u.find(".vis-cv-TableHead").children().eq(0).innerWidth(),s=u.find(".vis-cv-TableHead").children().eq(1).innerWidth(),h=u.find(".vis-cv-TableHead").children().eq(2).innerWidth(),c=u.find(".vis-cv-TableHead").children().eq(3).innerWidth(),l=u.find(".vis-cv-TableHead").children().eq(4).innerWidth();for(r=0;r<i.length;r++)for(f=0;f<i[r].Condition.length;f++)e=t("<tr class='vis-cv-TableRow'><\/tr"),e.append("<td value="+i[r].Color+" style='width:"+o+"px'><div class='vis-cvd-bgcolor' style='background-color:"+i[r].Color+";cursor:pointer'>"+i[r].Color+"<\/div><\/td>"),e.append("<td style='width:"+s+"px' value="+i[r].Condition[f].ColName+">"+i[r].Condition[f].ColHeader+"<\/td>"),e.append("<td style='width:"+h+"px' value="+i[r].Condition[f].Operator+">"+i[r].Condition[f].OperatorText+"<\/td>"),e.append("<td style='width:"+c+"px' value="+i[r].Condition[f].QueryValue+">"+i[r].Condition[f].QueryText+"<\/td>"),e.append("<td style='width:"+l+"px'><img  style='cursor:pointer;margin-right:5px;width:20px;height:20px'  src='"+n.Application.contextUrl+"Areas/VIS/Images/delete-ico.png' > <\/td>"),ot.append(e)}},af=function(){for(var f='<option value="-1"> <\/option>',t,u,i,r=0;r<fu.length;r++)if(t=fu[r],!t.getIsEncrypted()){if(u=t.getColumnName(),t.getDisplayType()==n.DisplayType.Button){if(t.getAD_Reference_Value_ID()==0)continue;u.endsWith("_ID")?t.setDisplayType(n.DisplayType.Table):t.setDisplayType(n.DisplayType.List)}(i=t.getHeader(),i!=null&&i.length!=0||(i=n.Msg.getElement(n.context,u),i!=null&&i.Length!=0))&&(t.getIsKey()&&(i+=" (ID)"),f+='<option value="'+u+'">'+i+"<\/option>")}y.html(f)},ne=function(){var n=y.val(),t;pr(!0);n&&n!="-1"&&(t=yr(n),wr(!0,t));pu(!0)};uf();this.getRoot=function(){return di};this.show=function(){k=new n.ChildDialog;k.setTitle(n.Msg.getMsg("Card"));k.setContent(di);k.onOkClick=function(){if(w){if(g.val().trim()=="")return n.ADialog.error("FillMandatory",!0,"Name"),!1}else if(!w&&e<1&&(o.val()==""||o.val()==null)&&n.MRole.isAdministrator)return n.ADialog.error("ClickNew",!0,""),!1;var t={};if(t.FieldGroupID=tt,t.IncludedCols=lu(p),!t.IncludedCols)return!1;t.Conditions=[];t.AD_CardView_ID=e;n.MRole.isAdministrator&&v<1&&ht>0&&(t.Conditions=[],t.AD_CardView_ID=ht);d.setCardViewData(t);wt.isCardRow&&d.refreshUI(wt.getVCardPanel().width())};k.show();k.hideButtons();au();ni(f);Modernizr.inputtypes.color||dt.spectrum({showButtons:!1,preferredFormat:"hex"})}}r.prototype.getOperatorsQuery=function(t,i){var f="",r="",u;for(u in t)r=t[u],i&&(r=n.Msg.getMsg(r)),f+='<option value="'+u+'">'+r+"<\/option>";return f};n.CVDialog=r}(VIS,jQuery),function(n,t){function i(i){function st(i){var e,o;u=t("<div style='overflow: hidden;'>");s=t('<div class="vis-apanel-busy" style="width: 96%; height: 97%; text-align: center; position: absolute; visibility: hidden;"><\/div>');l=t('<div style="display: inline-block; float: left;width:99%;height:auto;margin-top: 2px;">');a=t('<div style="padding-left: 7px;height:88.9%;display: inline-block; float: left;width:100%;height:87.8%;">');w=t("<button class='vis-initial-btn vis-initial-btn-blue' style='border: none;'>"+n.Msg.getMsg("SelectFile")+"<\/button>");b=t("<div class='VIS-form-data' style='width: 100%;height:200px;border: 1px solid #ccc;margin-top: 11px;padding: 10px;overflow:auto;'>");v=t('<div style="display: inline-block; float: left;width:100%;height:auto;margin-top: 2px;">');d=t("<div style='float: left;'>");y=t('<div style="float:right;">');e=n.Msg.getMsg("Cancel");e.indexOf("&")>-1&&(e=e.replace("&",""));o=n.Msg.getMsg("Ok");o.indexOf("&")>-1&&(o=o.replace("&",""));p=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(e);f=t("<button class='VIS_Pref_btn-2' disabled='true' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(o);h=i?t("<input type='file' multiple='true'>"):t("<input type='file'>");a.append(w);a.append(b);l.append(a);v.append(d);y.append(p);y.append(f);v.append(y);l.append(v);u.append(l);u.append(s);r=[]}function ht(){p.on("click",function(){g=!1;et()});f.on("click",function(){ft()});w.on("click",function(){h.val("");h.trigger("click")});h.on("change",function(){ut(this)})}function ct(){g||(k="");ot.onClose(k);et()}this.onClose=null;var u,s,l,a,v,y,p,f,r,h,w,b,d,ot=this,g=!1,tt=0,o=0,k=Date.now().toString()+"_FileCtrl",e=1048576,it=0,c=0,rt=[];st(i);ht();this.show=function(){u.dialog({width:500,height:377,resizable:!1,modal:!0,title:n.Msg.getMsg("Upload"),close:ct})};var ut=function(i){for(var u=[],c,e,o,v,s=0;s<i.files.length;s++){if(file=i.files[s],file==undefined)return;if(file.name.indexOf("&")>-1||file.name.indexOf("?")>-1||file.name.indexOf("#")>-1||file.name.indexOf("/")>-1||file.name.indexOf("\\")>-1){u.push(file.name);continue}for(c in r)if(file.name==r[c].name){window.setTimeout(function(){n.ADialog.info("fileAlreadyAttached")},20);return}if(e={},e.Name=file.name,e.Size=file.size,!(e.Size>17e6)){r.push(file);var h=t("<div class='VIS-file-wrap'>"),y=t("<p>"+e.Name+"<\/p>"),l=r.length-1,a=t("<span class='VIS-close-ico mychoice_"+l+"'  data-index='"+l+"'>");a.on("click",function(){var n=t(this).parent(),i,u;n&&(i=n.children()[0],i&&(u=r.map(function(n){return n.name==t(i).text()}).indexOf(!0),r.splice(u,1),n.remove()));r.length==0?f.attr("disabled","true"):f.removeAttr("disabled")});h.append(y);h.append(a);b.append(h);r.length==0?f.attr("disabled","true"):f.removeAttr("disabled")}}if(u.length>0){o="";for(v in u)o+=u[v].toString()+"\n";o+=u.length==1?"File has":"Files have";o+=" "+n.Msg.getMsg("VIS_InvalidName")+" "+n.Msg.getMsg("VIS_ChangeFileName");n.ADialog.info(o)}},ft=function(){var t,u;s[0].style.visibility="visible";var n=null,i=0;for(t in r)i=parseInt(r[t].size/e),file.size%e>0&&i++,it+=i,n={},n.Name=r[t].name,n.Size=r[t].size,rt.push(n);u=nt()},nt=function(){var t,i,f;if(r==null||r.length==0)return n.ADialog.info("NothingToUpload"),s[0].style.visibility="hidden",!1;if(o>=r.length)return s[0].style.visibility="hidden",g=!0,u.dialog("close"),!0;t=new XMLHttpRequest;i=new FormData;i.append("file",r[o].slice(c*e,c*e+Number(e)));t.open("POST",n.Application.contextUrl+"Attachment/SaveFileinTemp/?filename="+r[o].name+"&folderKey="+k,!1);t.send(i);tt++;c++;f=parseInt(r[o].size/e);r[o].size%e>0&&f++;c==f&&(o++,c=0);window.setTimeout(function(){nt()},2)},et=function(){p.off("click");f.off("click");s=l=a=v=y=p=f=null;r=h=w=b=d=null;tt=o=k=e=it=c=rt=null;ut=ft=nt=loadTables=loadLanguage=loadEDL=loadExportScope=null;u!=null&&(u.dialog("destroy"),u.remove());u=null}}n.VisImportFiles=i}(VIS,jQuery);VIS=window.VIS||{},function(n,t){function i(i,r){function a(n){v.css("display",n?"block":"none")}function w(t){if(t.error==null){var i=JSON.parse(t.result);if(!i.IsError)if(i.ShowParameter)u.pInstanceId=i.AD_PInstance_ID,u.fields=i.ProcessFields;else return i.ReportProcessInfo!=null&&(n.ADialog.info(i.ReportProcessInfo.Summary,!0,"",""),n.Msg.getMsg("ImportedSuccessfully")==i.ReportProcessInfo.Summary)?(y.parentcall(!0),u&&(u.isOkProcess=!0),!0):(u&&(u.isOkProcess=!1),y.parentcall(!1),!1)}}function b(){f=t("<div title='ParameterDialog'>");c=t("<table class='vis-processpara-table'>");f.append(c);s=t('<input type="button" style="margin-right:5px" >').val(n.Msg.getMsg("OK"));s.addClass("VIS_Pref_btn-2");o=t("<input type='button'>").val(n.Msg.getMsg("Close"));o.addClass("VIS_Pref_btn-2");o.css({"margin-bottom":"0px","margin-top":"7px"});s.css({"margin-bottom":"0px","margin-top":"7px"})}function k(i,r){if(i){u.paraList=r;var f={AD_Process_ID:u.processId,AD_PInstance_ID:u.pInstanceId,Name:u.name,AD_Table_ID:0,Record_ID:0,ParameterList:r,csv:!1,pdf:!1},e=n.Application.contextUrl+"JsonData/ExecuteProcess";t.ajax({url:e,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:!0,data:JSON.stringify(f)}).done(function(n){n&&w(n)})}}var y=r,f,c,p,h,l,e,s,o,v,u;this.windowNo=i;this.processId=null;this.name=null;this.entityType=null;this.pInstanceId=0;this.className=null;this.fields=null;this.paraList=null;this.asyncProcess=!0;this.gridFields=[];this.depOnFieldColumn=[];this.depOnField=[];this.vEditors=[];this.vEditors2=[];this.mFields=[];this.mFields2=[];this.isOkClicked=!1;this.onClosed;v=t("<div class='vis-apanel-busy' style='width:95%;height:98%;position:absolute'>");u=this;this.onCloseMain=null;this.isOkProcess=!1;this.process=function(i,r,u){var f={AD_Process_ID:i,Name:r,AD_Table_ID:0,Record_ID:0,WindowNo:u,csv:!1,pdf:!1},e=n.Application.contextUrl+"JsonData/Process";t.ajax({url:e,type:"GET",datatype:"json",async:this.asyncProcess,data:f}).done(function(n){n&&w(n)})};b();this.addLine=function(){p=h=l=e=null;h=t("<td class=''>");l=t("<td class=''>");e=t("<td class='vis-processpara-table-td3'>");c.append(t("<tr>").append(h).append(l).append(e))};this.addFields=function(t,i){if(t&&h.append(t.getControl()),i&&(i.getControl().width("200px"),i.getControl().height("30px"),e.append(i.getControl()),i.getBtnCount()>0)){var r=i.getBtn(0);e.append(r);i.getDisplayType()==n.DisplayType.MultiKey&&e.append(i.getBtn(1))}};this.addButtons=function(){this.addLine();e.append(o).append(s)};this.showDialog=function(){f.append(v);f.dialog({modal:!0,width:"auto",close:function(){if(k(u.isOkClicked,u.parameterList),u.onCloseMain)u.onCloseMain(u.isOkClicked);u.dispose();u=null;a(!1)}});window.setTimeout(function(){o.focus()},200);a(!1)};this.onClose=function(n){u.isOkClicked=n;f.dialog("close")};o.on(n.Events.onTouchStartOrClick,function(){u.onClose(!1)});s.on(n.Events.onTouchStartOrClick,function(){a(!0);var n=u.saveParameters();if(!n){a(!1);return}u.parameterList=n;u.onClose(!0,n)});this.disposeComponent=function(){o.off(n.Events.onTouchStartOrClick);s.off(n.Events.onTouchStartOrClick);f.dialog("destroy");f.remove();u=null;this.gridFields.length=0;this.gridFields=null;this.depOnFieldColumn.length=0;this.depOnFieldColumn-null;this.depOnField.length=0;this.depOnField=null;this.vEditors.length=0;this.vEditors2.length=0;this.mFields.length=0;this.mFields2.length=0;this.parameterList=null;this.addLine=null;this.addFields=null;this.addButtons=null;this.showDialog=null;this.onClose=null;this.isOkClicked=null;f=c=p=h=l=e=s=o=null}}i.prototype.initDialog=function(i,r,u,f,e){var a,o,c,b,p,v,k,s,w,y,h,l;for(this.processId=i,this.name=r,this.entityType=u,this.className=f,typeof e!="undefined"&&(this.asyncProcess=e),this.process(i,r,this.windowNo),a=this.fields,o=null,c=0,b=a.length;c<b;c++){for(o=new n.GridField(a[c]),this.addLine(),this.mFields.push(o),p=o.getDependentOn(!1),v=0;v<p.length;v++)this.depOnField.push(o),this.depOnFieldColumn.push(p[v]);k=n.VControlFactory.getLabel(o);s=n.VControlFactory.getControl(null,o,!1);s&&(l=o.getDefault(n.context,this.windowNo),s.setValue(l),s.addVetoableChangeListener(this));o.setPropertyChangeListener(s);this.vEditors.push(s);this.addFields(k,s);o.getIsRange()?(this.addLine(),w={},t.extend(!0,w,a[c]),y=new n.GridField(w),this.mFields2.push(y),h=n.VControlFactory.getControl(null,y,!1),h&&(l=y.getDefault(n.context,this.windowNo),h.setValue(l),h.addVetoableChangeListener(this)),this.vEditors2.push(h),this.addFields(null,h)):(this.mFields2.push(null),this.vEditors2.push(null))}return this.addButtons(),!0};i.prototype.vetoablechange=function(t){var f,r,e,u,o,i;if(console.log(t),f=t.newValue==null?"":t.newValue.toString(),r=t.propertyName,n.Env.getCtx().setWindowContext(this.windowNo,r,f),this.depOnFieldColumn.indexOf(r)!==-1)for(e=this.getDependantFields(r),u=0,o=e.length;u<o;u++)(i=field,i!=null)&&(i.refreshLookup(),i.setValue(i.getDefault(Env.getCtx(),this.windowNo),!0))};i.prototype.getDependantFields=function(n){var i=[],r,t;if(this.depOnFieldColumn.indexOf(n)!=-1)for(r=this.depOnFieldColumn.length,t=0;t<r;t++)this.depOnFieldColumn[t].equals(n)&&i.indexOf(this.depOnField[t])<0&&i.push(this.depOnField[t]);return i};i.prototype.saveParameters=function(){for(var r=new StringBuilder,v=this.mFields.length,t=0,u,e,o,y,s,h,c,i,a,t=0;t<v;t++)u=this.mFields[t],u.getIsMandatory(!0)&&(e=this.vEditors[t],o=e.getValue(),o==null||o.toString().length==0?(u.setInserting(!0),u.setError(!0),r.length()>0&&r.append(", "),r.append(u.getHeader())):u.setError(!1),y=this.vEditors2[t],y!=null&&(s=e.getValue(),h=this.mFields2[t],s==null||s.toString().length==0?(u.setInserting(!0),h.setError(!0),r.length()>0&&r.append(", "),r.append(u.getHeader())):h.setError(!1)));if(r.length()!=0)return n.ADialog.error("FillMandatory",!0,r.toString()),!1;for(c=[],i={},t=0;t<v;t++){var p=this.vEditors[t],f=this.vEditors2[t],w=p.getValue(),l=null;(f!=null&&(l=f.getValue()),w!=null||l!=null)&&(i={},a=this.mFields[t],i.Name=a.getColumnName(),i.DisplayType=a.getDisplayType(),i.Result=w,i.Result2=l,i.Info=p.getDisplay(),f!=null&&(i.Info_To=f.getDisplay()),c.push(i))}return c};i.prototype.dispose=function(){this.disposeComponent()};n.ParameterDialog=i}(VIS,jQuery),function(n,t){VIS.VApp=function(){function i(){var n=t.context.getAD_Language().replace("_","-");Globalize.culture(n)}function r(){document.getElementById("vis_mainConatiner").removeChild(document.getElementById("vis_busyGrid"));var t=n("#vis_antiForgeryToken").val();n.ajaxSetup({headers:{VerificationToken:t}})}function u(){var n=t.Logging;n.VLogMgt.initialize(!0);n.VLogMgt.setLevel(VIS.Ini.getTraceLevel())}function f(){VIS.Ini.updateLocalContextFromIni()}function e(){r();i();f();u();VIS.desktopMgr.start();VIS.Env.setWINDOW_PAGE_SIZE(VIS.Ini.getLocalStorage(VIS.IniConstants.WIN_PAGESIZE))}return{init:e}}()}(jQuery,VIS)